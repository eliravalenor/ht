const _0x2cf6d4=_0x3a81;(function(_0xcd8265,_0x1a6c6f){const _0x1fb1fe=_0x3a81,_0x893ee4=_0xcd8265();while(!![]){try{const _0x5c4da4=parseInt(_0x1fb1fe(0x9c0))/0x1+-parseInt(_0x1fb1fe(0x430))/0x2+parseInt(_0x1fb1fe(0x1505))/0x3+parseInt(_0x1fb1fe(0x11ce))/0x4+parseInt(_0x1fb1fe(0xadd))/0x5*(-parseInt(_0x1fb1fe(0xc6e))/0x6)+parseInt(_0x1fb1fe(0x1ab7))/0x7+parseInt(_0x1fb1fe(0x22ab))/0x8*(-parseInt(_0x1fb1fe(0x77a))/0x9);if(_0x5c4da4===_0x1a6c6f)break;else _0x893ee4['push'](_0x893ee4['shift']());}catch(_0x21942a){_0x893ee4['push'](_0x893ee4['shift']());}}}(_0x353c,0xb5cac));const isProduction=!![];function checkActivation(){const _0x4fcdfe=_0x3a81,_0x523814=localStorage[_0x4fcdfe(0x2250)](_0x4fcdfe(0x4c4));if(_0x523814!==_0x4fcdfe(0x8f1))return document['getElementById'](_0x4fcdfe(0x1c0d))[_0x4fcdfe(0x226e)][_0x4fcdfe(0x128)](_0x4fcdfe(0x1a2c)),document[_0x4fcdfe(0x566)](_0x4fcdfe(0x2379))[_0x4fcdfe(0x226e)]['add']('hidden'),![];return document[_0x4fcdfe(0x566)](_0x4fcdfe(0x1c0d))[_0x4fcdfe(0x226e)][_0x4fcdfe(0xe1)](_0x4fcdfe(0x1a2c)),document['getElementById'](_0x4fcdfe(0x2379))[_0x4fcdfe(0x226e)][_0x4fcdfe(0x128)](_0x4fcdfe(0x1a2c)),!![];}async function handleActivation(){const _0x379c5e=_0x3a81,_0x5f40d6=_0x379c5e(0x11d1),_0x4b5bcb=document['getElementById'](_0x379c5e(0x1c1b)),_0x516afa=document['getElementById'](_0x379c5e(0xc32));let _0x2c1529=localStorage[_0x379c5e(0x2250)](_0x379c5e(0x1395));!_0x2c1529&&(_0x2c1529=_0x379c5e(0xf8f)+Date[_0x379c5e(0x18e0)]()+'-'+Math['random']()[_0x379c5e(0x9a3)](0x24)[_0x379c5e(0x18cf)](0x2,0x9)[_0x379c5e(0x2110)](),localStorage[_0x379c5e(0x2055)](_0x379c5e(0x1395),_0x2c1529));_0x516afa[_0x379c5e(0x1557)]=_0x2c1529;async function _0x2610f1(_0x4ce748){const _0x52940f=_0x379c5e,_0x4393a1=new TextEncoder()[_0x52940f(0x429)](_0x4ce748),_0xa428e5=await crypto[_0x52940f(0x1c20)]['digest'](_0x52940f(0x508),_0x4393a1),_0x459f84=Array[_0x52940f(0x2308)](new Uint8Array(_0xa428e5)),_0x5b335d=_0x459f84[_0x52940f(0xf6d)](_0x5e21d5=>_0x5e21d5[_0x52940f(0x9a3)](0x10)['padStart'](0x2,'0'))[_0x52940f(0x140c)]('');return'KEY-'+_0x5b335d[_0x52940f(0x4b2)](0x0,0x10)['toUpperCase']();}const _0x34f371=document[_0x379c5e(0x566)](_0x379c5e(0x731));_0x34f371[_0x379c5e(0x167)](_0x379c5e(0x1e62),async function(){const _0x21a3a7=_0x379c5e,_0x49a98d=_0x4b5bcb[_0x21a3a7(0xc34)][_0x21a3a7(0x1424)]();if(!_0x49a98d){alert(_0x21a3a7(0x2560));return;}const _0x37458a=await _0x2610f1(_0x2c1529+_0x5f40d6);_0x49a98d===_0x37458a?(alert(_0x21a3a7(0x500)),localStorage['setItem'](_0x21a3a7(0x4c4),_0x21a3a7(0x8f1)),window['location'][_0x21a3a7(0x128e)]()):alert(_0x21a3a7(0xb13));});}isProduction&&(console[_0x2cf6d4(0xc0d)]=function(){},console[_0x2cf6d4(0x2422)]=function(){},console['warn']=function(){});let dataLoadedPromise,resolveDataLoaded;function initializeDataLoadPromise(){dataLoadedPromise=new Promise(_0x5908bf=>{resolveDataLoaded=_0x5908bf;});}window['db']=new Dexie(_0x2cf6d4(0x41e));var db=window['db'];window[_0x2cf6d4(0xfb9)]=[];async function resetDatabase(){const _0x46eb57=_0x2cf6d4;try{return console[_0x46eb57(0xc0d)](_0x46eb57(0x28b)),db[_0x46eb57(0x2031)]()&&db['close'](),await db[_0x46eb57(0xc2b)](),console['log']('✅\x20数据库已删除'),await db[_0x46eb57(0x11cc)](),console[_0x46eb57(0xc0d)](_0x46eb57(0x1590)),!![];}catch(_0x46a0fd){return console['error']('❌\x20重置数据库失败:',_0x46a0fd),![];}}async function checkDatabaseHealth(){const _0x3e421a=_0x2cf6d4;try{await db['open']();const _0xf74f3c=[_0x3e421a(0x164d),'chatMessages',_0x3e421a(0x530)];for(const _0x36faa5 of _0xf74f3c){await db[_0x36faa5][_0x3e421a(0x35e)]();}return console[_0x3e421a(0xc0d)](_0x3e421a(0x966)),!![];}catch(_0x28b009){return console[_0x3e421a(0x24ab)](_0x3e421a(0x1f4d),_0x28b009),![];}}let characters=[],contacts=[],currentChatCharacter=null,chatMessages={},selectedMessageId=null,pinnedConversations=[],personas=[],editingPersona=null,isMultiSelectMode=![],selectedCharacters=[],currentEditingCharacterId=null,groupChats=[],previousModeBeforeMultiSelect=null;const SoundManager={'sounds':{},'characterSounds':{},'enabled':!![],'currentlyPlaying':{},'isUnlocked':![],'TYPES':{'MESSAGE_RECEIVED':'messageReceived','MESSAGE_SENT':_0x2cf6d4(0x12af),'NOTIFICATION':_0x2cf6d4(0x760),'OUTGOING_CALL':_0x2cf6d4(0x8d6),'INCOMING_CALL':'incomingCall'},async 'init'(){const _0x22539c=_0x2cf6d4;try{const _0x3fc0ac=localStorage['getItem'](_0x22539c(0x16bd));_0x3fc0ac!==null?this[_0x22539c(0x591)]=_0x3fc0ac===_0x22539c(0x8f1):(this[_0x22539c(0x591)]=!![],localStorage[_0x22539c(0x2055)]('soundEnabled',_0x22539c(0x8f1))),await this[_0x22539c(0x18f8)](),console[_0x22539c(0xc0d)](_0x22539c(0xa9d),this[_0x22539c(0x591)]);}catch(_0x12b985){console[_0x22539c(0x24ab)]('❌\x20音效管理器初始化失败:',_0x12b985);}},async 'loadSettings'(){const _0x79a8a7=_0x2cf6d4;try{const _0x30a5cf=await db[_0x79a8a7(0x2071)][_0x79a8a7(0x18c6)]();for(const _0x469d5e of _0x30a5cf){_0x469d5e[_0x79a8a7(0x591)]&&_0x469d5e['sourceUrl']&&await this[_0x79a8a7(0x2354)](_0x469d5e[_0x79a8a7(0xec3)],_0x469d5e['sourceUrl'],_0x469d5e[_0x79a8a7(0x1fbe)]);}const _0x213ce1=await db['characterSounds'][_0x79a8a7(0x18c6)]();for(const _0x133825 of _0x213ce1){_0x133825['enabled']&&_0x133825[_0x79a8a7(0xa65)]&&await this[_0x79a8a7(0xd5d)](_0x133825[_0x79a8a7(0x10df)],_0x133825[_0x79a8a7(0xec3)],_0x133825[_0x79a8a7(0xa65)],_0x133825['sourceType']);}}catch(_0x4c4012){console[_0x79a8a7(0x24ab)](_0x79a8a7(0x6ed),_0x4c4012);}},async 'loadSound'(_0x5b2223,_0x504c6a,_0x49569b='url'){const _0x19275d=_0x2cf6d4;try{if(!_0x504c6a)return![];const _0x58dd6b=new Audio();return _0x58dd6b[_0x19275d(0x210f)]=_0x19275d(0x153f),_0x58dd6b['src']=_0x504c6a,await new Promise((_0x539577,_0x53e441)=>{const _0x46b121=_0x19275d;_0x58dd6b[_0x46b121(0x167)]('canplaythrough',_0x539577,{'once':!![]}),_0x58dd6b[_0x46b121(0x167)]('error',_0x53e441,{'once':!![]}),_0x58dd6b[_0x46b121(0x1f3d)]();}),this[_0x19275d(0x217e)][_0x5b2223]=_0x58dd6b,console[_0x19275d(0xc0d)](_0x19275d(0x1deb)+_0x5b2223),!![];}catch(_0xa89d74){return console[_0x19275d(0x24ab)](_0x19275d(0x400)+_0x5b2223+'):',_0xa89d74),![];}},'play'(_0x27d19a,_0x173461=null){const _0x39167d=_0x2cf6d4;if(!this[_0x39167d(0x591)])return;try{if(_0x173461&&this['characterSounds'][_0x173461]&&this[_0x39167d(0xb0a)][_0x173461]['silent']){console[_0x39167d(0xc0d)](_0x39167d(0xa93)+_0x173461+_0x39167d(0x2316)+_0x27d19a+_0x39167d(0x1abf));return;}let _0x593cda=null;if(_0x173461&&this[_0x39167d(0xb0a)][_0x173461]&&this[_0x39167d(0xb0a)][_0x173461][_0x27d19a])_0x593cda=this['characterSounds'][_0x173461][_0x27d19a]['cloneNode'](),console[_0x39167d(0xc0d)](_0x39167d(0x1f52)+_0x173461+_0x39167d(0x2316)+_0x27d19a);else this[_0x39167d(0x217e)][_0x27d19a]&&(_0x593cda=this[_0x39167d(0x217e)][_0x27d19a]['cloneNode'](),console[_0x39167d(0xc0d)](_0x39167d(0x1891)+_0x27d19a));if(_0x593cda){_0x593cda['volume']=0.7,this[_0x39167d(0x24f9)][_0x27d19a]=_0x593cda,_0x593cda['addEventListener']('ended',()=>{delete this['currentlyPlaying'][_0x27d19a];});const _0x37c766=_0x593cda[_0x39167d(0x10f4)]();_0x37c766!==undefined&&_0x37c766[_0x39167d(0x9e5)](_0x5af488=>{const _0x1d6650=_0x39167d;console[_0x1d6650(0x17cc)]('音效播放失败\x20('+_0x27d19a+'):',_0x5af488),delete this[_0x1d6650(0x24f9)][_0x27d19a],_0x5af488['name']==='NotAllowedError'&&this['scheduleRetryOnUserInteraction'](_0x27d19a,_0x173461);});}}catch(_0x3400ba){console['error'](_0x39167d(0x1529)+_0x27d19a+'):',_0x3400ba);}},'scheduleRetryOnUserInteraction'(_0x176b05,_0x5669c5){const _0x222840=_0x2cf6d4;if(this[_0x222840(0x1ac5)])return;const _0x1ec193=()=>{const _0x1f156b=_0x222840;console[_0x1f156b(0xc0d)](_0x1f156b(0x112f)+_0x176b05),this[_0x1f156b(0x1ac5)]=!![],this[_0x1f156b(0x10f4)](_0x176b05,_0x5669c5),[_0x1f156b(0xf52),_0x1f156b(0xa69),_0x1f156b(0x695),'click'][_0x1f156b(0x900)](_0x4c0ac6=>{const _0x5d2c15=_0x1f156b;document[_0x5d2c15(0x6be)](_0x4c0ac6,_0x1ec193);});};[_0x222840(0xf52),_0x222840(0xa69),_0x222840(0x695),_0x222840(0x1e62)][_0x222840(0x900)](_0xd62c29=>{const _0x3e1da8=_0x222840;document[_0x3e1da8(0x167)](_0xd62c29,_0x1ec193,{'once':!![],'passive':!![]});});},'stopSound'(_0x2f8de5){const _0x53b567=_0x2cf6d4;try{this[_0x53b567(0x24f9)][_0x2f8de5]&&(this['currentlyPlaying'][_0x2f8de5][_0x53b567(0x21f0)](),this[_0x53b567(0x24f9)][_0x2f8de5][_0x53b567(0x1217)]=0x0,delete this[_0x53b567(0x24f9)][_0x2f8de5],console[_0x53b567(0xc0d)](_0x53b567(0x1c35)+_0x2f8de5));}catch(_0x445163){console[_0x53b567(0x24ab)]('停止音效失败\x20('+_0x2f8de5+'):',_0x445163);}},'stopAllSounds'(){const _0x106763=_0x2cf6d4;try{Object[_0x106763(0x16c7)](this[_0x106763(0x24f9)])['forEach'](_0x18fea6=>{const _0x8fee8b=_0x106763;this[_0x8fee8b(0xce0)](_0x18fea6);}),console['log'](_0x106763(0xd13));}catch(_0x3f9d74){console['error'](_0x106763(0x959),_0x3f9d74);}},'test'(_0x298edc){const _0x9a59c0=_0x2cf6d4;if(!this[_0x9a59c0(0x591)]||!this['sounds'][_0x298edc])return;try{const _0x5e0fc8=this[_0x9a59c0(0x217e)][_0x298edc][_0x9a59c0(0x1a21)]();_0x5e0fc8['volume']=0.7;const _0x369120=setTimeout(()=>{const _0x573306=_0x9a59c0;_0x5e0fc8[_0x573306(0x21f0)](),_0x5e0fc8[_0x573306(0x1217)]=0x0;},0x1388);_0x5e0fc8[_0x9a59c0(0x167)](_0x9a59c0(0xccf),()=>{clearTimeout(_0x369120);}),_0x5e0fc8[_0x9a59c0(0x10f4)]()['catch'](_0x34bf80=>{const _0x57c19d=_0x9a59c0;console[_0x57c19d(0x17cc)](_0x57c19d(0xc2)+_0x298edc+'):',_0x34bf80),clearTimeout(_0x369120);});}catch(_0x547d92){console[_0x9a59c0(0x24ab)](_0x9a59c0(0x70c)+_0x298edc+'):',_0x547d92);}},async 'setSound'(_0x3c457f,_0x6c16d7,_0x50f02f=_0x2cf6d4(0x10c6)){const _0x1c5527=_0x2cf6d4;try{this[_0x1c5527(0x217e)][_0x3c457f]&&(this[_0x1c5527(0x217e)][_0x3c457f]=null);if(!_0x6c16d7)return await db[_0x1c5527(0x2071)]['delete'](_0x3c457f),!![];const _0x280daf=await this[_0x1c5527(0x2354)](_0x3c457f,_0x6c16d7,_0x50f02f);return _0x280daf&&await db[_0x1c5527(0x2071)][_0x1c5527(0x53a)]({'id':_0x3c457f,'soundType':_0x3c457f,'sourceType':_0x50f02f,'sourceUrl':_0x6c16d7,'enabled':!![],'timestamp':Date[_0x1c5527(0x18e0)]()}),_0x280daf;}catch(_0x294090){return console[_0x1c5527(0x24ab)](_0x1c5527(0x1612)+_0x3c457f+'):',_0x294090),![];}},async 'clearSound'(_0x13a4d6){const _0x30f736=_0x2cf6d4;try{return this['sounds'][_0x13a4d6]&&(this['sounds'][_0x13a4d6]=null),await db[_0x30f736(0x2071)]['delete'](_0x13a4d6),console['log'](_0x30f736(0x1ff8)+_0x13a4d6),!![];}catch(_0x360b4b){return console[_0x30f736(0x24ab)](_0x30f736(0x1d0d)+_0x13a4d6+'):',_0x360b4b),![];}},'setEnabled'(_0xcf752a){const _0x54005f=_0x2cf6d4;this[_0x54005f(0x591)]=_0xcf752a,localStorage[_0x54005f(0x2055)](_0x54005f(0x16bd),_0xcf752a[_0x54005f(0x9a3)]());},async 'getSetting'(_0x16a89a){const _0xd35a40=_0x2cf6d4;try{return await db['soundSettings'][_0xd35a40(0x46a)](_0x16a89a);}catch(_0x266029){return console['error'](_0xd35a40(0x1ca5)+_0x16a89a+'):',_0x266029),null;}},async 'loadCharacterSound'(_0xe8886c,_0xcfabd,_0x3dde66,_0x1ef039=_0x2cf6d4(0x10c6)){const _0x5c4436=_0x2cf6d4;try{if(!_0x3dde66)return![];if(_0xcfabd===_0x5c4436(0x14b1)&&_0x3dde66===_0x5c4436(0x14b1))return!this[_0x5c4436(0xb0a)][_0xe8886c]&&(this['characterSounds'][_0xe8886c]={}),this[_0x5c4436(0xb0a)][_0xe8886c][_0x5c4436(0x14b1)]=!![],console[_0x5c4436(0xc0d)]('✅\x20角色静音模式设置成功:\x20'+_0xe8886c),!![];if(_0xcfabd===_0x5c4436(0x591)&&_0x3dde66===_0x5c4436(0x591))return!this[_0x5c4436(0xb0a)][_0xe8886c]&&(this[_0x5c4436(0xb0a)][_0xe8886c]={}),this[_0x5c4436(0xb0a)][_0xe8886c][_0x5c4436(0x591)]=!![],console[_0x5c4436(0xc0d)](_0x5c4436(0x827)+_0xe8886c),!![];const _0x23ac71=new Audio();return _0x23ac71[_0x5c4436(0x210f)]=_0x5c4436(0x153f),_0x23ac71[_0x5c4436(0x107)]=_0x3dde66,await new Promise((_0x398398,_0x3b73cb)=>{const _0x2f5810=_0x5c4436;_0x23ac71['addEventListener'](_0x2f5810(0x136e),_0x398398,{'once':!![]}),_0x23ac71['addEventListener']('error',_0x3b73cb,{'once':!![]}),_0x23ac71[_0x2f5810(0x1f3d)]();}),!this[_0x5c4436(0xb0a)][_0xe8886c]&&(this[_0x5c4436(0xb0a)][_0xe8886c]={}),this[_0x5c4436(0xb0a)][_0xe8886c][_0xcfabd]=_0x23ac71,console[_0x5c4436(0xc0d)](_0x5c4436(0xf9a)+_0xe8886c+'\x20-\x20'+_0xcfabd),!![];}catch(_0x519015){return console['error'](_0x5c4436(0x1a4f)+_0xe8886c+_0x5c4436(0x2316)+_0xcfabd+'):',_0x519015),![];}},async 'setCharacterSound'(_0x337c89,_0x11a833,_0x1afcd0,_0x100db6=_0x2cf6d4(0x10c6)){const _0x4ebe0c=_0x2cf6d4;try{this[_0x4ebe0c(0xb0a)][_0x337c89]&&this['characterSounds'][_0x337c89][_0x11a833]&&(this[_0x4ebe0c(0xb0a)][_0x337c89][_0x11a833]=null);if(!_0x1afcd0)return await db['characterSounds'][_0x4ebe0c(0x4a6)]({'characterId':_0x337c89,'soundType':_0x11a833})[_0x4ebe0c(0xc2b)](),!![];const _0x445e5a=await this[_0x4ebe0c(0xd5d)](_0x337c89,_0x11a833,_0x1afcd0,_0x100db6);return _0x445e5a&&await db[_0x4ebe0c(0xb0a)]['put']({'characterId':_0x337c89,'soundType':_0x11a833,'sourceType':_0x100db6,'sourceUrl':_0x1afcd0,'enabled':!![],'timestamp':Date[_0x4ebe0c(0x18e0)]()}),_0x445e5a;}catch(_0x17578d){return console[_0x4ebe0c(0x24ab)](_0x4ebe0c(0x1eed)+_0x337c89+_0x4ebe0c(0x2316)+_0x11a833+'):',_0x17578d),![];}},async 'clearCharacterSound'(_0x3227b4,_0x4b9a0e){const _0x1daa93=_0x2cf6d4;try{return this[_0x1daa93(0xb0a)][_0x3227b4]&&this[_0x1daa93(0xb0a)][_0x3227b4][_0x4b9a0e]&&(_0x4b9a0e==='silent'||_0x4b9a0e===_0x1daa93(0x591)?delete this[_0x1daa93(0xb0a)][_0x3227b4][_0x4b9a0e]:this['characterSounds'][_0x3227b4][_0x4b9a0e]=null),await db[_0x1daa93(0xb0a)][_0x1daa93(0x4a6)]({'characterId':_0x3227b4,'soundType':_0x4b9a0e})['delete'](),console['log']('✅\x20角色专属音效已清除:\x20'+_0x3227b4+_0x1daa93(0x2316)+_0x4b9a0e),!![];}catch(_0x329cde){return console[_0x1daa93(0x24ab)](_0x1daa93(0x2529)+_0x3227b4+'\x20-\x20'+_0x4b9a0e+'):',_0x329cde),![];}},async 'getCharacterSetting'(_0x49e1ef,_0xd93501){const _0x3eb402=_0x2cf6d4;try{return await db[_0x3eb402(0xb0a)]['where']({'characterId':_0x49e1ef,'soundType':_0xd93501})[_0x3eb402(0x2200)]();}catch(_0x2e6433){return console[_0x3eb402(0x24ab)](_0x3eb402(0x10ec)+_0x49e1ef+_0x3eb402(0x2316)+_0xd93501+'):',_0x2e6433),null;}},async 'clearAllCharacterSounds'(_0x2f6990){const _0x1739f=_0x2cf6d4;try{return this[_0x1739f(0xb0a)][_0x2f6990]&&(this[_0x1739f(0xb0a)][_0x2f6990]={}),await db[_0x1739f(0xb0a)][_0x1739f(0x4a6)](_0x1739f(0x10df))[_0x1739f(0x14a)](_0x2f6990)['delete'](),console[_0x1739f(0xc0d)](_0x1739f(0x21ca)+_0x2f6990),!![];}catch(_0x4eb3ee){return console[_0x1739f(0x24ab)]('清除角色所有专属音效失败\x20('+_0x2f6990+'):',_0x4eb3ee),![];}}};function toggleSoundSystem(){const _0x1e48c1=_0x2cf6d4,_0x512516=document[_0x1e48c1(0x566)](_0x1e48c1(0x102));if(!_0x512516){console[_0x1e48c1(0x24ab)](_0x1e48c1(0x241));return;}const _0x12560f=_0x512516[_0x1e48c1(0x306)];console['log'](_0x1e48c1(0x15c4),_0x12560f),SoundManager[_0x1e48c1(0x124e)](_0x12560f);const _0x175fa7=document['getElementById'](_0x1e48c1(0x576));_0x175fa7&&(_0x175fa7[_0x1e48c1(0x655)][_0x1e48c1(0x671)]=_0x12560f?'1':_0x1e48c1(0x1ffd),_0x175fa7[_0x1e48c1(0x655)][_0x1e48c1(0x20d6)]=_0x12560f?'auto':_0x1e48c1(0xfe9)),showToast(_0x12560f?_0x1e48c1(0xc8a):_0x1e48c1(0x14fb),'success');}function handleSoundFileUpload(_0x356834,_0xa573d4){const _0x528c20=_0x2cf6d4,_0x510e3c=_0x356834['files'][0x0];if(!_0x510e3c)return;if(_0x510e3c[_0x528c20(0x41a)]>0x3*0x400*0x400){showToast(_0x528c20(0x1fa7),_0x528c20(0x24ab)),_0x356834[_0x528c20(0xc34)]='';return;}if(!_0x510e3c[_0x528c20(0x23df)][_0x528c20(0x1cab)](_0x528c20(0x1a03))){showToast(_0x528c20(0x1dc3),_0x528c20(0x24ab)),_0x356834[_0x528c20(0xc34)]='';return;}const _0x3f0201=new FileReader();_0x3f0201[_0x528c20(0xc28)]=async _0x407ba9=>{const _0x5cd3e4=_0x528c20,_0x38a8d0=await SoundManager[_0x5cd3e4(0x153a)](_0xa573d4,_0x407ba9[_0x5cd3e4(0x1144)][_0x5cd3e4(0x1fff)],_0x5cd3e4(0x199b));if(_0x38a8d0){showToast(_0x5cd3e4(0x1307),_0x5cd3e4(0xb27));const _0xc8a7fa=document[_0x5cd3e4(0x566)](_0x5cd3e4(0x1327)+_0xa573d4+'-url');_0xc8a7fa&&(_0xc8a7fa['value']=_0x510e3c[_0x5cd3e4(0x222f)],_0xc8a7fa[_0x5cd3e4(0x194e)]=!![]);}else showToast(_0x5cd3e4(0x1629),_0x5cd3e4(0x24ab));_0x356834[_0x5cd3e4(0xc34)]='';},_0x3f0201[_0x528c20(0x145e)](_0x510e3c);}function testSound(_0x46c396){const _0x3cb970=_0x2cf6d4;SoundManager[_0x3cb970(0x17ba)](_0x46c396);}async function clearSound(_0x3b954f){const _0x450e98=_0x2cf6d4,_0x1d953c=await SoundManager[_0x450e98(0x1a89)](_0x3b954f);if(_0x1d953c){showToast(_0x450e98(0x2206),_0x450e98(0xb27));const _0x467aa8=document['getElementById'](_0x450e98(0x1327)+_0x3b954f+_0x450e98(0xe2a));_0x467aa8&&(_0x467aa8[_0x450e98(0xc34)]='',_0x467aa8[_0x450e98(0x194e)]=![]);}else showToast('清除音效失败',_0x450e98(0x24ab));}async function setSoundFromUrl(_0x470479){const _0x53dc58=_0x2cf6d4,_0x280841=document[_0x53dc58(0x566)](_0x53dc58(0x1327)+_0x470479+_0x53dc58(0xe2a));if(!_0x280841)return;const _0x4f4630=_0x280841[_0x53dc58(0xc34)][_0x53dc58(0x1424)]();if(!_0x4f4630){showToast(_0x53dc58(0xf73),_0x53dc58(0x24ab));return;}const _0x56eb1a=await SoundManager['setSound'](_0x470479,_0x4f4630,_0x53dc58(0x10c6));_0x56eb1a?showToast('音效设置成功',_0x53dc58(0xb27)):showToast(_0x53dc58(0x480),_0x53dc58(0x24ab));}async function initSoundSettings(){const _0x5cd5bd=_0x2cf6d4;try{const _0x331682=document['getElementById'](_0x5cd5bd(0x102));_0x331682&&(_0x331682[_0x5cd5bd(0x306)]=SoundManager[_0x5cd5bd(0x591)],console[_0x5cd5bd(0xc0d)]('🔊\x20音效开关状态:',SoundManager[_0x5cd5bd(0x591)]));const _0x1bfa94=[_0x5cd5bd(0x19b),_0x5cd5bd(0x12af),_0x5cd5bd(0x760),_0x5cd5bd(0x8d6),_0x5cd5bd(0x1ee1)];for(const _0x15e540 of _0x1bfa94){const _0x52e306=await SoundManager['getSetting'](_0x15e540),_0x8010b2=document[_0x5cd5bd(0x566)](_0x5cd5bd(0x1327)+_0x15e540+_0x5cd5bd(0xe2a));_0x52e306&&_0x8010b2&&(_0x52e306[_0x5cd5bd(0x1fbe)]===_0x5cd5bd(0x199b)?(_0x8010b2['value']=_0x5cd5bd(0x1498),_0x8010b2[_0x5cd5bd(0x194e)]=!![]):(_0x8010b2[_0x5cd5bd(0xc34)]=_0x52e306[_0x5cd5bd(0xa65)]||'',_0x8010b2[_0x5cd5bd(0x194e)]=![]));}const _0x1bc312=document[_0x5cd5bd(0x566)](_0x5cd5bd(0x576));_0x1bc312&&(_0x1bc312['style'][_0x5cd5bd(0x671)]=SoundManager[_0x5cd5bd(0x591)]?'1':_0x5cd5bd(0x1ffd),_0x1bc312['style'][_0x5cd5bd(0x20d6)]=SoundManager[_0x5cd5bd(0x591)]?_0x5cd5bd(0x153f):'none'),console[_0x5cd5bd(0xc0d)]('✅\x20音效设置界面初始化完成');}catch(_0x421234){console['error'](_0x5cd5bd(0xef4),_0x421234);}}let soundEventListenersInitialized=![];function initSoundEventListeners(){const _0x94053d=_0x2cf6d4;if(soundEventListenersInitialized)return;const _0x37d0a0=[_0x94053d(0x19b),_0x94053d(0x12af),_0x94053d(0x760),_0x94053d(0x8d6),_0x94053d(0x1ee1)];_0x37d0a0[_0x94053d(0x900)](_0x3d9ecd=>{const _0x41c01c=_0x94053d,_0xf1bd98=document[_0x41c01c(0x566)](_0x41c01c(0x1327)+_0x3d9ecd+'-url');_0xf1bd98&&(_0xf1bd98[_0x41c01c(0x167)]('keypress',function(_0x3beee1){const _0x549958=_0x41c01c;_0x3beee1[_0x549958(0x157f)]===_0x549958(0x165c)&&setSoundFromUrl(_0x3d9ecd);}),_0xf1bd98[_0x41c01c(0x167)]('blur',function(){this['value']['trim']()&&setSoundFromUrl(_0x3d9ecd);}));const _0x23ddf2=document[_0x41c01c(0x566)](_0x41c01c(0x1ddd)+_0x3d9ecd+_0x41c01c(0xe2a));_0x23ddf2&&(_0x23ddf2['addEventListener']('keypress',_0x23f9fa=>{const _0x41e590=_0x41c01c;_0x23f9fa[_0x41e590(0x157f)]===_0x41e590(0x165c)&&setCharacterSoundFromUrl(_0x3d9ecd);}),_0x23ddf2[_0x41c01c(0x167)](_0x41c01c(0x1d7b),_0x57659f=>{const _0x4c34ff=_0x41c01c;_0x57659f[_0x4c34ff(0x1144)]['value'][_0x4c34ff(0x1424)]()&&setCharacterSoundFromUrl(_0x3d9ecd);}));}),soundEventListenersInitialized=!![],console[_0x94053d(0xc0d)](_0x94053d(0xcf7));}document[_0x2cf6d4(0x167)](_0x2cf6d4(0x7f7),function(){initSoundEventListeners();});async function toggleCharacterSounds(){const _0x5dba1e=_0x2cf6d4,_0x3ef062=document[_0x5dba1e(0x566)](_0x5dba1e(0x18fd))['checked'],_0x1ffee2=document[_0x5dba1e(0x566)](_0x5dba1e(0x735));_0x1ffee2&&(_0x1ffee2[_0x5dba1e(0x655)][_0x5dba1e(0x2526)]=_0x3ef062?_0x5dba1e(0x2d4):_0x5dba1e(0xfe9));if(!currentChatCharacter){showToast(_0x5dba1e(0x146),'error');return;}try{_0x3ef062?(await SoundManager[_0x5dba1e(0x1458)](currentChatCharacter['id'],'enabled',_0x5dba1e(0x591),_0x5dba1e(0x591)),showToast(_0x5dba1e(0x664),'success')):(await SoundManager[_0x5dba1e(0xa30)](currentChatCharacter['id']),showToast(_0x5dba1e(0x1f87),'success'));}catch(_0x8fe2cb){console['error'](_0x5dba1e(0x19ad),_0x8fe2cb),showToast(_0x5dba1e(0x1bda),_0x5dba1e(0x24ab));}}function handleCharacterSoundFileUpload(_0x1d842,_0x52504d){const _0x15db6f=_0x2cf6d4;if(!currentChatCharacter){showToast(_0x15db6f(0x146),_0x15db6f(0x24ab));return;}const _0x3d87bb=_0x1d842[_0x15db6f(0x173e)][0x0];if(!_0x3d87bb)return;if(_0x3d87bb[_0x15db6f(0x41a)]>0x3*0x400*0x400){showToast(_0x15db6f(0x1fa7),_0x15db6f(0x24ab)),_0x1d842[_0x15db6f(0xc34)]='';return;}if(!_0x3d87bb[_0x15db6f(0x23df)][_0x15db6f(0x1cab)](_0x15db6f(0x1a03))){showToast(_0x15db6f(0x1dc3),'error'),_0x1d842[_0x15db6f(0xc34)]='';return;}const _0xd74d98=new FileReader();_0xd74d98['onload']=async _0x59808f=>{const _0x38ef11=_0x15db6f,_0x78f393=await SoundManager[_0x38ef11(0x1458)](currentChatCharacter['id'],_0x52504d,_0x59808f['target'][_0x38ef11(0x1fff)],'file');if(_0x78f393){showToast(_0x38ef11(0x2332),_0x38ef11(0xb27));const _0x13093f=document[_0x38ef11(0x566)](_0x38ef11(0x1ddd)+_0x52504d+_0x38ef11(0xe2a));_0x13093f&&(_0x13093f['value']=_0x3d87bb[_0x38ef11(0x222f)],_0x13093f[_0x38ef11(0x194e)]=!![]);}else showToast(_0x38ef11(0x5e3),_0x38ef11(0x24ab));_0x1d842[_0x38ef11(0xc34)]='';},_0xd74d98[_0x15db6f(0x145e)](_0x3d87bb);}function testCharacterSound(_0x511011){const _0x197f43=_0x2cf6d4;if(!currentChatCharacter){showToast('请先选择角色','error');return;}if(SoundManager[_0x197f43(0xb0a)][currentChatCharacter['id']]&&SoundManager[_0x197f43(0xb0a)][currentChatCharacter['id']][_0x511011]){const _0x282b50=SoundManager['characterSounds'][currentChatCharacter['id']][_0x511011]['cloneNode']();_0x282b50['volume']=0.7;const _0x31718b=setTimeout(()=>{const _0x187423=_0x197f43;_0x282b50['pause'](),_0x282b50[_0x187423(0x1217)]=0x0;},0x1388);_0x282b50[_0x197f43(0x167)](_0x197f43(0xccf),()=>{clearTimeout(_0x31718b);}),_0x282b50[_0x197f43(0x10f4)]()[_0x197f43(0x9e5)](_0x476614=>{const _0x6c0df6=_0x197f43;console[_0x6c0df6(0x17cc)]('角色专属音效试听失败:',_0x476614),clearTimeout(_0x31718b);});}else showToast(_0x197f43(0x1fc6),_0x197f43(0x24ab));}async function clearCharacterSound(_0x5871fd){const _0x229a0d=_0x2cf6d4;if(!currentChatCharacter){showToast('请先选择角色',_0x229a0d(0x24ab));return;}const _0xcbcaf6=await SoundManager[_0x229a0d(0x1f50)](currentChatCharacter['id'],_0x5871fd);if(_0xcbcaf6){showToast(_0x229a0d(0x1ce0),_0x229a0d(0xb27));const _0xe70eb1=document[_0x229a0d(0x566)](_0x229a0d(0x1ddd)+_0x5871fd+_0x229a0d(0xe2a));_0xe70eb1&&(_0xe70eb1['value']='',_0xe70eb1[_0x229a0d(0x194e)]=![]);}else showToast(_0x229a0d(0x177b),_0x229a0d(0x24ab));}async function setCharacterSoundFromUrl(_0x577c31){const _0x881f63=_0x2cf6d4;if(!currentChatCharacter){showToast(_0x881f63(0x146),_0x881f63(0x24ab));return;}const _0x2612b=document[_0x881f63(0x566)](_0x881f63(0x1ddd)+_0x577c31+_0x881f63(0xe2a));if(!_0x2612b)return;const _0x1975d3=_0x2612b['value'][_0x881f63(0x1424)]();if(!_0x1975d3){showToast(_0x881f63(0xf73),_0x881f63(0x24ab));return;}const _0x13fd32=await SoundManager['setCharacterSound'](currentChatCharacter['id'],_0x577c31,_0x1975d3,_0x881f63(0x10c6));_0x13fd32?showToast(_0x881f63(0x2332),_0x881f63(0xb27)):showToast(_0x881f63(0xc52),_0x881f63(0x24ab));}async function toggleCharacterSilentMode(){const _0x3cb931=_0x2cf6d4;if(!currentChatCharacter){showToast('请先选择角色',_0x3cb931(0x24ab));return;}const _0xaed1a7=document[_0x3cb931(0x566)](_0x3cb931(0x17cb)),_0x5badca=_0xaed1a7[_0x3cb931(0x306)];try{if(_0x5badca){const _0x1456a1=await SoundManager['setCharacterSound'](currentChatCharacter['id'],_0x3cb931(0x14b1),_0x3cb931(0x14b1),_0x3cb931(0x14b1));_0x1456a1?showToast(currentChatCharacter[_0x3cb931(0x222f)]+_0x3cb931(0x503),'success'):(showToast(_0x3cb931(0x1d06),_0x3cb931(0x24ab)),_0xaed1a7[_0x3cb931(0x306)]=![]);}else{const _0x1de630=await SoundManager[_0x3cb931(0x1f50)](currentChatCharacter['id'],_0x3cb931(0x14b1));_0x1de630?showToast(currentChatCharacter[_0x3cb931(0x222f)]+'\x20已取消静音',_0x3cb931(0xb27)):(showToast(_0x3cb931(0xa68),_0x3cb931(0x24ab)),_0xaed1a7[_0x3cb931(0x306)]=!![]);}}catch(_0x3d3f2d){console[_0x3cb931(0x24ab)](_0x3cb931(0x187e),_0x3d3f2d),showToast(_0x3cb931(0x148d),_0x3cb931(0x24ab)),_0xaed1a7[_0x3cb931(0x306)]=!_0x5badca;}}function clearCharacterSoundSettingsUI(){const _0x40bcad=_0x2cf6d4,_0x191820=[_0x40bcad(0x19b),_0x40bcad(0x1ee1),_0x40bcad(0x760)];_0x191820[_0x40bcad(0x900)](_0x4beef6=>{const _0x545587=_0x40bcad,_0x35e7af=document[_0x545587(0x566)](_0x545587(0x1ddd)+_0x4beef6+_0x545587(0xe2a));_0x35e7af&&(_0x35e7af[_0x545587(0xc34)]='',_0x35e7af[_0x545587(0x194e)]=![]);});const _0x4194bb=document[_0x40bcad(0x566)](_0x40bcad(0x18fd));_0x4194bb&&(_0x4194bb[_0x40bcad(0x306)]=![]);const _0x39ddd2=document[_0x40bcad(0x566)](_0x40bcad(0x735));_0x39ddd2&&(_0x39ddd2[_0x40bcad(0x655)]['display']=_0x40bcad(0xfe9));const _0x1086a1=document[_0x40bcad(0x566)](_0x40bcad(0x17cb));_0x1086a1&&(_0x1086a1[_0x40bcad(0x306)]=![]),console[_0x40bcad(0xc0d)]('🧹\x20角色专属音效设置界面已清理');}async function initCharacterSoundSettings(){const _0x7052ed=_0x2cf6d4;if(!currentChatCharacter)return;initSoundEventListeners(),clearCharacterSoundSettingsUI();try{const _0x514200=[_0x7052ed(0x19b),_0x7052ed(0x1ee1),_0x7052ed(0x760)];let _0xbf5fc9=![];const _0x1e5fab=await SoundManager['getCharacterSetting'](currentChatCharacter['id'],_0x7052ed(0x591)),_0x18f90f=!!_0x1e5fab,_0x3f9a8c=await SoundManager[_0x7052ed(0xa19)](currentChatCharacter['id'],_0x7052ed(0x14b1)),_0x3b938a=!!_0x3f9a8c,_0x3b5b4e=document[_0x7052ed(0x566)](_0x7052ed(0x17cb));_0x3b5b4e&&(_0x3b5b4e['checked']=_0x3b938a);for(const _0x21be23 of _0x514200){const _0x16368b=await SoundManager['getCharacterSetting'](currentChatCharacter['id'],_0x21be23),_0x3ad770=document['getElementById']('character-'+_0x21be23+'-url');_0x3ad770&&(_0x3ad770[_0x7052ed(0xc34)]='',_0x3ad770[_0x7052ed(0x194e)]=![],_0x16368b&&(_0xbf5fc9=!![],_0x16368b[_0x7052ed(0x1fbe)]===_0x7052ed(0x199b)?(_0x3ad770[_0x7052ed(0xc34)]=_0x7052ed(0x1498),_0x3ad770[_0x7052ed(0x194e)]=!![]):(_0x3ad770['value']=_0x16368b[_0x7052ed(0xa65)]||'',_0x3ad770[_0x7052ed(0x194e)]=![])));}let _0x356307=![];if(_0x18f90f)_0x356307=!![];else(_0xbf5fc9||_0x3b938a)&&(_0x356307=!![]);const _0x5eec21=document[_0x7052ed(0x566)]('character-sound-enabled'),_0x584a90=document[_0x7052ed(0x566)](_0x7052ed(0x735));_0x5eec21&&(_0x5eec21[_0x7052ed(0x306)]=_0x356307),_0x584a90&&(_0x584a90[_0x7052ed(0x655)][_0x7052ed(0x2526)]=_0x356307?'block':_0x7052ed(0xfe9)),console[_0x7052ed(0xc0d)](_0x7052ed(0xce9)+currentChatCharacter[_0x7052ed(0x222f)]+_0x7052ed(0x2493)+_0x356307+',\x20静音:\x20'+_0x3b938a+')');}catch(_0x298ee9){console[_0x7052ed(0x24ab)](_0x7052ed(0x142d),_0x298ee9);}}db['version'](0x2c)[_0x2cf6d4(0x163a)]({'characters':_0x2cf6d4(0xc74),'contacts':_0x2cf6d4(0x18ff),'chatMessages':_0x2cf6d4(0x231e),'personas':_0x2cf6d4(0x26c),'customEmojis':'&id,\x20name,\x20category,\x20isPersonal','recentEmojis':'&id,\x20lastUsed','worldbooks':_0x2cf6d4(0x1845),'worldbookEntries':_0x2cf6d4(0x24cb),'characterGroups':_0x2cf6d4(0x684),'groupChats':_0x2cf6d4(0x26c),'groupChatMessages':'&id,\x20groupId,\x20timestamp','groupChatMembers':_0x2cf6d4(0x1db8),'moments':'&id,\x20authorId,\x20timestamp','momentLikes':'[momentId+authorId],\x20momentId,\x20authorId','momentComments':_0x2cf6d4(0x2546),'workingMemory':'&id,\x20characterId,\x20timestamp,\x20content,\x20context','episodicMemory':'&id,\x20characterId,\x20date,\x20summary,\x20timestamp,\x20context','episodicMemories':_0x2cf6d4(0xd2f),'memorySummaries':_0x2cf6d4(0xacb),'memoryEvents':_0x2cf6d4(0x174b),'coreMemory':_0x2cf6d4(0x1dce),'coreMemories':_0x2cf6d4(0x1987),'crossAppTimeline':_0x2cf6d4(0x811),'blacklist':_0x2cf6d4(0x1646),'blockedCharacters':_0x2cf6d4(0x92e),'friendRequests':_0x2cf6d4(0xad4),'characterStatus':_0x2cf6d4(0x1936),'characterDiaries':_0x2cf6d4(0x8e7),'offlineHistoryRecords':_0x2cf6d4(0xa8e),'offlineUISettings':_0x2cf6d4(0x18dc),'offlinePresets':_0x2cf6d4(0x268),'musicPlaylist':_0x2cf6d4(0x1976),'musicCovers':_0x2cf6d4(0x1680),'apiSettings':'&id','globalSettings':'&id','wallpapers':_0x2cf6d4(0x26c),'appIcons':_0x2cf6d4(0x1acb),'chatSettings':_0x2cf6d4(0x18cc),'innerThoughts':_0x2cf6d4(0x16ed),'forums':'++id,\x20name','forumPosts':_0x2cf6d4(0x288),'forumReplies':'++id,\x20postId,\x20timestamp','forumFavorites':_0x2cf6d4(0x1b65),'replyLikes':_0x2cf6d4(0xb8f),'forumPostImages':_0x2cf6d4(0x9e3),'forumMountedWorldbooks':_0x2cf6d4(0xa4a),'smsContacts':_0x2cf6d4(0x22e8),'smsMessages':_0x2cf6d4(0xc1),'anniversaries':_0x2cf6d4(0x58a),'appointments':_0x2cf6d4(0x161b),'momentVisibility':'++id,\x20momentId,\x20visibility,\x20visibleGroups,\x20timestamp','momentLocations':_0x2cf6d4(0xa28),'momentMentions':_0x2cf6d4(0x1e21),'characterFootprints':_0x2cf6d4(0xd06),'footprintActivities':'++id,\x20footprintId,\x20time,\x20activity,\x20location,\x20type,\x20mood,\x20timestamp','emojiLibraries':_0x2cf6d4(0x17c7),'emojiLibraryItems':'++id,\x20&[libraryId+emojiId],\x20libraryId,\x20emojiId,\x20addedAt','diarySettings':_0x2cf6d4(0x19ef),'soundSettings':_0x2cf6d4(0xcd7),'characterSounds':'++id,\x20characterId,\x20soundType,\x20sourceType,\x20sourceUrl,\x20enabled,\x20timestamp','globalThemes':_0x2cf6d4(0xbd7),'chatThemes':'++id,\x20chatId,\x20themeData,\x20timestamp','themeSettings':_0x2cf6d4(0x1387),'windowChatSettings':_0x2cf6d4(0x20b3),'videoAvatarSettings':_0x2cf6d4(0x8ac),'groupChatStates':_0x2cf6d4(0x13db)});let selectedGroupMembers=[],currentWorldbookTab=_0x2cf6d4(0x3d8),characterGroups=[],isGroupManageMode=![],selectedGroupId=null,customEmojis=[],recentEmojis=[],currentEmojiTab=_0x2cf6d4(0x1274),pendingPersonalEmojiData=null,isPersonaExpanded=!![],emojiLibraries=[],currentEmojiLibrary=null,isEmojiLibraryExpanded=![],isMessageSelectionMode=![],selectedMessages=new Set(),isMessageListMultiSelectMode=![],selectedConversations=[],commentConversationRounds=new Map(),smsContacts=[],smsMessages={},pendingSMSMessages=[],isSMSMultiSelectMode=![],selectedSMSMessages=new Set();window[_0x2cf6d4(0x68c)]=![];let apiSettings={'type':'openai','base':_0x2cf6d4(0x1f6),'endpoint':_0x2cf6d4(0xb73),'key':'','model':'gpt-3.5-turbo','temperature':0.7},chatSettings={'themeColor':_0x2cf6d4(0x1f03),'theirBubbleColor':_0x2cf6d4(0x1679),'myBubbleColor':'#007AFF','bubbleOpacity':0x1,'timestampEnabled':!![],'timestampPosition':_0x2cf6d4(0x23a1)},selectedAppIcon=null,selectedWallpaper=null,colorPickerContext=null,customIconImage=null;async function loadGlobalWorldbookSettings(){const _0x181039=_0x2cf6d4;try{const _0x4b52aa=await db[_0x181039(0x2217)]['get'](_0x181039(0x9de));_0x4b52aa&&_0x4b52aa[_0x181039(0xfb9)]?window['activeGlobalWorldbooks']=_0x4b52aa['activeGlobalWorldbooks']:(window['activeGlobalWorldbooks']=[],await db[_0x181039(0x2217)][_0x181039(0x53a)]({'id':_0x181039(0x9de),'activeGlobalWorldbooks':[]}));}catch(_0x3faa47){console[_0x181039(0x24ab)]('加载全局世界书设置失败:',_0x3faa47),window[_0x181039(0xfb9)]=[];}}document[_0x2cf6d4(0x167)](_0x2cf6d4(0x7f7),async function(){const _0x4afe06=_0x2cf6d4;handleActivation();const _0x269f8e=checkActivation();if(!_0x269f8e){console['log'](_0x4afe06(0x1798));return;}try{await window['db']['open'](),console[_0x4afe06(0xc0d)](_0x4afe06(0xf18));}catch(_0x552986){console[_0x4afe06(0x24ab)]('❌\x20数据库打开失败:',_0x552986);try{await window['db'][_0x4afe06(0xc2b)](),window['db']=new Dexie(_0x4afe06(0x41e)),db=window['db'],window['db'][_0x4afe06(0x15ec)](0x29)[_0x4afe06(0x163a)]({'characters':_0x4afe06(0xc74),'contacts':_0x4afe06(0x18ff),'chatMessages':_0x4afe06(0x231e),'personas':_0x4afe06(0x26c),'customEmojis':_0x4afe06(0x24d),'recentEmojis':_0x4afe06(0x1da7)}),await window['db'][_0x4afe06(0x11cc)](),console['log'](_0x4afe06(0x1f56));}catch(_0x20ae20){console[_0x4afe06(0x24ab)](_0x4afe06(0xc2f),_0x20ae20);}}initializeDataLoadPromise(),updateTime();const _0x1b0165=()=>{const _0x4d7bd9=_0x4afe06;console['log'](_0x4d7bd9(0x128a)),SoundManager[_0x4d7bd9(0x1ac5)]=!![],[_0x4d7bd9(0xf52),'mousedown',_0x4d7bd9(0x695),_0x4d7bd9(0x1e62)][_0x4d7bd9(0x900)](_0x58c9cf=>{const _0x5a57b1=_0x4d7bd9;document[_0x5a57b1(0x6be)](_0x58c9cf,_0x1b0165);});};[_0x4afe06(0xf52),'mousedown','keydown','click'][_0x4afe06(0x900)](_0x17e263=>{const _0x3bfb0a=_0x4afe06;document[_0x3bfb0a(0x167)](_0x17e263,_0x1b0165,{'once':!![],'passive':!![]});}),console[_0x4afe06(0xc0d)](_0x4afe06(0x1f1f));const _0x28a352=navigator[_0x4afe06(0x473)][_0x4afe06(0x23ec)](_0x4afe06(0x8d0)),_0x1f543e=navigator[_0x4afe06(0x473)][_0x4afe06(0x23ec)](_0x4afe06(0x6fb))&&!navigator[_0x4afe06(0x473)][_0x4afe06(0x23ec)](_0x4afe06(0x8d0)),_0x874430=navigator[_0x4afe06(0x473)][_0x4afe06(0x23ec)](_0x4afe06(0x427));console[_0x4afe06(0xc0d)](_0x4afe06(0x22f0),{'isChrome':_0x28a352,'isSafari':_0x1f543e,'isFirefox':_0x874430});_0x28a352&&(console[_0x4afe06(0xc0d)](_0x4afe06(0xeeb)),window[_0x4afe06(0x167)]('error',function(_0x47a604){const _0x2b087c=_0x4afe06;(_0x47a604[_0x2b087c(0xd7a)][_0x2b087c(0x23ec)](_0x2b087c(0xb51))||_0x47a604[_0x2b087c(0xd7a)][_0x2b087c(0x23ec)](_0x2b087c(0x164d)))&&(console[_0x2b087c(0x17cc)](_0x2b087c(0x18ad),_0x47a604[_0x2b087c(0xd7a)]),setTimeout(()=>{const _0x1672e2=_0x2b087c;typeof forceFixDataConsistency===_0x1672e2(0xb1)&&forceFixDataConsistency();},0x3e8));}));navigator[_0x4afe06(0x473)][_0x4afe06(0x23ec)](_0x4afe06(0x6fb))&&navigator[_0x4afe06(0x473)][_0x4afe06(0x23ec)]('Mobile')&&(document[_0x4afe06(0x167)](_0x4afe06(0xd3e),function(_0x54b64e){const _0x280d94=_0x4afe06;if(_0x54b64e[_0x280d94(0x1144)]&&typeof _0x54b64e[_0x280d94(0x1144)][_0x280d94(0x2026)]===_0x280d94(0xb1)){if(_0x54b64e[_0x280d94(0x1144)][_0x280d94(0x2026)](_0x280d94(0x249d)))return;if(_0x54b64e[_0x280d94(0x1144)][_0x280d94(0x2026)]('.message-bubble,\x20.offline-message-content,\x20.message-item,\x20.contact-item,\x20.sms-message-bubble'))return _0x54b64e[_0x280d94(0x4d9)](),![];}},{'passive':![]}),document['addEventListener'](_0x4afe06(0x164b),function(_0x5ae2bb){const _0x53bb6f=_0x4afe06;if(_0x5ae2bb[_0x53bb6f(0x1144)]&&typeof _0x5ae2bb['target'][_0x53bb6f(0x2026)]===_0x53bb6f(0xb1)){if(_0x5ae2bb[_0x53bb6f(0x1144)][_0x53bb6f(0x2026)]('.message-bubble,\x20.offline-message-content')&&!_0x5ae2bb[_0x53bb6f(0x1144)][_0x53bb6f(0x2026)](_0x53bb6f(0xbcf)))return _0x5ae2bb[_0x53bb6f(0x4d9)](),![];}},{'passive':![]}),document[_0x4afe06(0x167)](_0x4afe06(0x173),function(_0x1b0fb4){const _0x2bf6cc=_0x4afe06;if(_0x1b0fb4[_0x2bf6cc(0x1144)]&&typeof _0x1b0fb4[_0x2bf6cc(0x1144)][_0x2bf6cc(0x2026)]===_0x2bf6cc(0xb1)){if(_0x1b0fb4[_0x2bf6cc(0x1144)]['closest'](_0x2bf6cc(0x17ea))&&!_0x1b0fb4[_0x2bf6cc(0x1144)][_0x2bf6cc(0x2026)](_0x2bf6cc(0x2b7)))return _0x1b0fb4[_0x2bf6cc(0x4d9)](),![];}},{'passive':![]}),console[_0x4afe06(0xc0d)]('✅\x20Safari长按处理已优化'));if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i[_0x4afe06(0x17ba)](navigator['userAgent'])){console['log'](_0x4afe06(0x1478));let _0x57d712=null;document[_0x4afe06(0x167)](_0x4afe06(0xf52),function(_0x406532){const _0x82056b=_0x4afe06;_0x57d712=Date[_0x82056b(0x18e0)](),console[_0x82056b(0xc0d)]('🔍\x20触摸开始:',_0x406532['target']['className']);},{'passive':!![]}),document['addEventListener'](_0x4afe06(0x1263),function(_0x6d27a4){const _0x1ef7b0=_0x4afe06;if(_0x57d712){const _0xdc9403=Date[_0x1ef7b0(0x18e0)]()-_0x57d712;_0xdc9403>0x1f4&&console[_0x1ef7b0(0xc0d)](_0x1ef7b0(0x13b3),_0xdc9403+'ms',_0x6d27a4[_0x1ef7b0(0x1144)][_0x1ef7b0(0x221)]),_0x57d712=null;}},{'passive':!![]});}try{initializeWindowId(),console[_0x4afe06(0xc0d)]('🔍\x20开始数据库健康检查...');const _0x11756a=await checkDatabaseHealth();if(!_0x11756a){console[_0x4afe06(0x17cc)](_0x4afe06(0xe31));const _0x37ebd3=await resetDatabase();if(!_0x37ebd3)throw new Error(_0x4afe06(0x836));console[_0x4afe06(0xc0d)]('✅\x20数据库已重置，继续初始化...');}else console[_0x4afe06(0xc0d)](_0x4afe06(0x966));console[_0x4afe06(0xc0d)](_0x4afe06(0x4fc)),await Promise[_0x4afe06(0x2339)]([loadCharacterGroups(),loadCharacters(),loadChatMessages(),loadMemoryConfig(),loadChatSettings(),loadApiSettings(),loadCustomEmojis(),loadEmojiLibraries(),loadGlobalWorldbookSettings(),initGlobalMemoryDB(),loadCustomAppIcons(),migrateFootprintsFromLocalStorage(),cleanupFootprintsCache()]),console[_0x4afe06(0xc0d)](_0x4afe06(0xce6)),cleanupBlockedSystemMessages(),console[_0x4afe06(0xc0d)]('🔧\x20自动修复损坏的消息...');const _0x4c7bbb=await autoFixCorruptedMessages();_0x4c7bbb>0x0&&console[_0x4afe06(0xc0d)](_0x4afe06(0x16ba)+_0x4c7bbb+_0x4afe06(0x2ee));console['log'](_0x4afe06(0xc8d)),await loadContacts(),console[_0x4afe06(0xc0d)]('🔄\x20加载短信应用数据...'),await loadSMSContacts(),await loadSMSMessages(),loadPinnedSMSConversations(),loadPinnedConversations(),loadPhoneBorderSetting(),loadScreenSize(),loadFontSizeSettings(),loadGlobalFontSettings(),loadStatusIconSetting(),loadHomeFontColorSetting(),loadClockStyleSetting(),updateGlobalMemoryStatusDisplay(),await loadMomentsImages(),await loadWallpaper(),await loadAppIcons(),await loadSavedTheme(),await loadWorldbooks(),await loadPersonas(),await loadGroupChats(),checkLocalStorageUsage(),await initMemoryViewer(),await loadAnniversaryList(),await loadAppointmentList(),initializeWidgets(),initializeForumApp(),await preloadOfflineUISettings();try{console[_0x4afe06(0xc0d)](_0x4afe06(0x1d3),{'charactersCount':characters?characters['length']:_0x4afe06(0x1785),'contactsCount':contacts?contacts[_0x4afe06(0xcbf)]:_0x4afe06(0x1785),'chatMessagesType':typeof chatMessages,'chatMessagesKeys':chatMessages?Object[_0x4afe06(0x16c7)](chatMessages)['length']:_0x4afe06(0x1785)});if(!characters)characters=[];if(!contacts)contacts=[];if(!chatMessages)chatMessages={};if(characters[_0x4afe06(0xcbf)]>0x0&&contacts[_0x4afe06(0xcbf)]===0x0){const _0xbc8392=Object[_0x4afe06(0x16c7)](chatMessages)[_0x4afe06(0xcbf)]>0x0;if(_0xbc8392){console[_0x4afe06(0x17cc)](_0x4afe06(0x142f));const _0x23bc4f=Object['keys'](chatMessages)[_0x4afe06(0x803)](_0x5e16a2=>characters[_0x4afe06(0x184b)](_0xd791b3=>_0xd791b3['id']===_0x5e16a2));_0x23bc4f[_0x4afe06(0xcbf)]>0x0&&(contacts=_0x23bc4f,saveContacts()[_0x4afe06(0x9e5)](_0x3b8f01=>console[_0x4afe06(0x24ab)](_0x4afe06(0x2131),_0x3b8f01)),console[_0x4afe06(0xc0d)]('🔧\x20从聊天记录恢复了\x20'+contacts['length']+_0x4afe06(0x16f6)));}else console[_0x4afe06(0xc0d)](_0x4afe06(0x172a));}renderMessageList(),renderContactList(),renderCharacterList(),renderPersonaList(),setTimeout(()=>{const _0x48e3e4=_0x4afe06,_0x81e1b2=document[_0x48e3e4(0x1ed9)](_0x48e3e4(0x1a15));console['log'](_0x48e3e4(0x5a4)+_0x81e1b2[_0x48e3e4(0xcbf)]+'\x20个对话'),_0x81e1b2[_0x48e3e4(0xcbf)]===0x0&&characters['length']>0x0&&(console[_0x48e3e4(0x17cc)]('⚠️\x20渲染异常检测，执行诊断...'),diagnoseBrowserCompatibility(),setTimeout(()=>{forceFixDataConsistency();},0x3e8));},0x1f4);}catch(_0x5553b8){console[_0x4afe06(0x24ab)](_0x4afe06(0xd10),_0x5553b8),console[_0x4afe06(0xc0d)]('🔧\x20执行降级渲染处理...');if(!chatMessages)chatMessages={};if(!contacts)contacts=[];if(!characters)characters=[];try{renderMessageList(),renderContactList(),renderCharacterList();}catch(_0x4aa621){console[_0x4afe06(0x24ab)]('❌\x20降级渲染也失败:',_0x4aa621),setTimeout(()=>{const _0x3e2535=_0x4afe06;typeof forceFixDataConsistency===_0x3e2535(0xb1)&&forceFixDataConsistency();},0x7d0);}}setTimeout(async()=>{const _0x5ed04e=_0x4afe06;switchChatTab(_0x5ed04e(0xda4));const _0x3db6d5=document['querySelector'](_0x5ed04e(0x11f0));_0x3db6d5&&(_0x3db6d5[_0x5ed04e(0x226e)][_0x5ed04e(0xe1)](_0x5ed04e(0xe85)),_0x3db6d5['textContent']='💬');initChatSettingsUIEvents(),applyBubbleStyle(),applyCustomBubbleCSS();if(currentChatCharacter)initializeChatSettings(),updateWorldbookMountDisplay()[_0x5ed04e(0x9e5)](_0x538342=>console[_0x5ed04e(0x24ab)]('更新世界书挂载显示失败:',_0x538342));else{}await initGlobalBackgroundInteractionSystem(),initEmojiLibraryUpload(),setupMidnightCacheCleanup(),initAnniversaryReminderSystem(),await SoundManager[_0x5ed04e(0xf26)](),initializeFootprintsAutoUpdate();},0x64);const _0x541ff8=document[_0x4afe06(0x566)]('temperature-slider');_0x541ff8&&_0x541ff8[_0x4afe06(0x167)](_0x4afe06(0x627),function(){const _0x57f030=_0x4afe06;document[_0x57f030(0x566)](_0x57f030(0x15a8))[_0x57f030(0x21dc)]=parseFloat(this[_0x57f030(0xc34)])[_0x57f030(0x3cd)](0x2);});initializeApiSettings(),document[_0x4afe06(0x566)](_0x4afe06(0xbb0))[_0x4afe06(0x167)](_0x4afe06(0x627),function(){const _0x4dc0e2=_0x4afe06;document[_0x4dc0e2(0x566)](_0x4dc0e2(0x17e8))[_0x4dc0e2(0x21dc)]=Math[_0x4dc0e2(0x5f3)](this[_0x4dc0e2(0xc34)]*0x64)+'%';});const _0x741099=document[_0x4afe06(0x566)](_0x4afe06(0x1755)),_0x3188db=document[_0x4afe06(0x15b8)](_0x4afe06(0xdb));_0x741099&&_0x3188db&&_0x741099[_0x4afe06(0x167)](_0x4afe06(0x17ef),function(_0x7ec724){const _0x4caa82=_0x4afe06;_0x7ec724[_0x4caa82(0x1144)][_0x4caa82(0x173e)]&&_0x7ec724[_0x4caa82(0x1144)][_0x4caa82(0x173e)][0x0]?_0x3188db[_0x4caa82(0x21dc)]=_0x7ec724[_0x4caa82(0x1144)]['files'][0x0][_0x4caa82(0x222f)]:_0x3188db[_0x4caa82(0x21dc)]=_0x4caa82(0x5f4);});document[_0x4afe06(0x566)](_0x4afe06(0x3c0))[_0x4afe06(0x167)](_0x4afe06(0x1a17),function(_0xf1d2b0){const _0x3d15b8=_0x4afe06;_0xf1d2b0[_0x3d15b8(0x157f)]===_0x3d15b8(0x165c)&&!_0xf1d2b0[_0x3d15b8(0x1dad)]&&(_0xf1d2b0[_0x3d15b8(0x4d9)](),sendApiMessage());});let _0x3f19ca=![],_0x1ace0b=-0x1,_0x25e1d1=-0x1,_0x45bfcd='';document[_0x4afe06(0x566)](_0x4afe06(0x3c0))[_0x4afe06(0x167)](_0x4afe06(0x627),function(_0x19f970){handleMentionInput(_0x19f970);}),document[_0x4afe06(0x566)](_0x4afe06(0x3c0))[_0x4afe06(0x167)](_0x4afe06(0x695),function(_0xd41028){_0x3f19ca&&handleMentionKeydown(_0xd41028);}),document[_0x4afe06(0x167)]('click',function(_0x598e8f){const _0x72364f=_0x4afe06,_0x295718=document['getElementById'](_0x72364f(0x1fb7)),_0x4d36bb=document[_0x72364f(0x566)](_0x72364f(0x3c0));_0x3f19ca&&!_0x295718['contains'](_0x598e8f['target'])&&_0x598e8f[_0x72364f(0x1144)]!==_0x4d36bb&&hideMentionDropdown();}),initializeAvatarUpload(),initializeEmojiUpload(),initializeIconUpload();const _0x1f9838=document[_0x4afe06(0x566)](_0x4afe06(0x90a));_0x1f9838&&(_0x1f9838[_0x4afe06(0x655)][_0x4afe06(0x2526)]=_0x4afe06(0xfe9));isMessageSelectionMode=![],selectedMessages['clear'](),document['getElementById'](_0x4afe06(0x1577))[_0x4afe06(0x167)]('change',function(_0x314ad8){const _0x40ec3e=_0x4afe06;if(_0x314ad8[_0x40ec3e(0x1144)][_0x40ec3e(0x173e)]&&_0x314ad8[_0x40ec3e(0x1144)]['files'][0x0]){const _0x274e6f=_0x314ad8[_0x40ec3e(0x1144)][_0x40ec3e(0x173e)][0x0];if(_0x274e6f[_0x40ec3e(0x23df)]===_0x40ec3e(0x145d)){alert(_0x40ec3e(0x1591)),_0x314ad8['target']['value']='';return;}const _0x29ef12=new FileReader();_0x29ef12[_0x40ec3e(0xc28)]=function(_0x5f1f63){const _0x1d2053=_0x40ec3e;sendImageMessage(_0x5f1f63[_0x1d2053(0x1144)][_0x1d2053(0x1fff)]);},_0x29ef12['readAsDataURL'](_0x274e6f);}_0x314ad8[_0x40ec3e(0x1144)]['value']='';}),document[_0x4afe06(0x566)](_0x4afe06(0xa3f))[_0x4afe06(0x167)](_0x4afe06(0x17ef),function(_0x3c9eb0){const _0xf6f314=_0x4afe06;if(_0x3c9eb0[_0xf6f314(0x1144)]['files']&&_0x3c9eb0[_0xf6f314(0x1144)][_0xf6f314(0x173e)][0x0]){const _0x13f445=new FileReader();_0x13f445[_0xf6f314(0xc28)]=function(_0x416a89){const _0x3f4962=_0xf6f314;selectedWallpaper=_0x416a89[_0x3f4962(0x1144)][_0x3f4962(0x1fff)];const _0x4a5fef=document[_0x3f4962(0x566)](_0x3f4962(0x3c2));_0x4a5fef&&(_0x4a5fef[_0x3f4962(0xc02)]=_0x3f4962(0x2001)+selectedWallpaper+'\x22\x20class=\x22wallpaper-preview-image\x22\x20alt=\x22壁纸预览\x22>');},_0x13f445[_0xf6f314(0x145e)](_0x3c9eb0[_0xf6f314(0x1144)][_0xf6f314(0x173e)][0x0]);}}),document[_0x4afe06(0x566)](_0x4afe06(0xd75))[_0x4afe06(0x167)](_0x4afe06(0x17ef),function(_0x1fc196){const _0x35361e=_0x4afe06;if(_0x1fc196[_0x35361e(0x1144)][_0x35361e(0x173e)]&&_0x1fc196['target'][_0x35361e(0x173e)][0x0]){const _0x4ca077=new FileReader();_0x4ca077['onload']=function(_0x217364){const _0x45a066=_0x35361e;customIconImage=_0x217364[_0x45a066(0x1144)][_0x45a066(0x1fff)];const _0x352094=document[_0x45a066(0x1ed9)](_0x45a066(0xbbb));_0x352094[_0x45a066(0x900)](_0x1d52a1=>{const _0x10e308=_0x45a066;_0x1d52a1[_0x10e308(0x655)][_0x10e308(0x1584)]='url('+customIconImage+')',_0x1d52a1[_0x10e308(0xc02)]='';});},_0x4ca077[_0x35361e(0x145e)](_0x1fc196[_0x35361e(0x1144)][_0x35361e(0x173e)][0x0]);}}),setInterval(updateTime,0x3e8),initBatteryManager(),resolveDataLoaded(),console['log']('✅\x20所有初始数据加载完成，信号已发送。'),setTimeout(async()=>{const _0x12794a=_0x4afe06;try{await initGlobalMomentsSystem(),console[_0x12794a(0xc0d)]('✅\x20全局动态发布系统初始化完成');}catch(_0xba5acf){console[_0x12794a(0x24ab)](_0x12794a(0x24dc),_0xba5acf);}},0xbb8);const _0x2ba61d=sessionStorage[_0x4afe06(0x2250)](_0x4afe06(0x1463));_0x2ba61d&&(console[_0x4afe06(0xc0d)](_0x4afe06(0x1421),_0x2ba61d),dataLoadedPromise[_0x4afe06(0x1ccc)](()=>{const _0x1bd102=_0x4afe06,_0x10bfbd=characters['find'](_0x7ad7af=>_0x7ad7af['id']===_0x2ba61d),_0x10bcd1=groupChats['find'](_0x40b16d=>_0x40b16d['id']===_0x2ba61d),_0x121cd3=_0x10bfbd||_0x10bcd1;_0x121cd3?setTimeout(()=>{startChat(_0x121cd3);},0x64):(console[_0x1bd102(0x17cc)](_0x1bd102(0x140a),_0x2ba61d),sessionStorage[_0x1bd102(0x1c95)](_0x1bd102(0x1463)));}));}catch(_0x174ca9){console[_0x4afe06(0x24ab)](_0x4afe06(0x753),_0x174ca9),console[_0x4afe06(0x24ab)]('错误详情:',_0x174ca9[_0x4afe06(0x181c)]);const _0x5109cb='应用初始化失败:\x20'+_0x174ca9[_0x4afe06(0xd7a)]+_0x4afe06(0x16e7)+_0x174ca9['name'];if(_0x174ca9['name']===_0x4afe06(0x702)||_0x174ca9['name']===_0x4afe06(0x244e)||_0x174ca9[_0x4afe06(0x222f)]==='DexieError'){console['log'](_0x4afe06(0x102b));if(confirm(_0x4afe06(0x11c5)))try{await resetDatabase(),location[_0x4afe06(0x128e)]();}catch(_0x1f6a81){console['error'](_0x4afe06(0x612),_0x1f6a81),alert(_0x4afe06(0x1367));}}else{alert(_0x5109cb);try{if(!characters)characters=[];if(!contacts)contacts=[];if(!chatMessages)chatMessages={};showApp(_0x4afe06(0x1f16)),setTimeout(()=>{const _0x18967d=_0x4afe06;try{const _0xcc3fd0=document[_0x18967d(0x15b8)]('[onclick=\x22showRecoveryModal()\x22]');_0xcc3fd0&&_0xcc3fd0[_0x18967d(0x1e62)]();}catch(_0x354894){console[_0x18967d(0x24ab)](_0x18967d(0x1d5e),_0x354894);}},0x3e8);}catch(_0x30bf2e){console[_0x4afe06(0x24ab)](_0x4afe06(0x1e11),_0x30bf2e);}}}});function showApp(_0x1ed975){const _0x1e2f68=_0x2cf6d4;if(event)event[_0x1e2f68(0x4d9)]();const _0x2e849e=document[_0x1e2f68(0x1ed9)](_0x1e2f68(0x867));_0x2e849e[_0x1e2f68(0x900)](_0x181c76=>{const _0x57aad1=_0x1e2f68;_0x181c76[_0x57aad1(0x655)]['display']=_0x57aad1(0xfe9);});const _0x5b1fac=document[_0x1e2f68(0x566)](_0x1e2f68(0x799)),_0x49ff6f=document[_0x1e2f68(0x566)](_0x1e2f68(0x1615)),_0x52a6b4=document[_0x1e2f68(0x566)]('dock-bar'),_0x29d3c7=document['getElementById'](_0x1e2f68(0x459));if(_0x5b1fac)_0x5b1fac[_0x1e2f68(0x655)][_0x1e2f68(0x2526)]=_0x1e2f68(0xfe9);if(_0x49ff6f)_0x49ff6f[_0x1e2f68(0x655)]['display']=_0x1e2f68(0xfe9);if(_0x52a6b4)_0x52a6b4[_0x1e2f68(0x655)][_0x1e2f68(0x2526)]=_0x1e2f68(0xfe9);_0x29d3c7&&(_0x29d3c7['style'][_0x1e2f68(0x2526)]='none');const _0x334d02=document[_0x1e2f68(0x566)](_0x1ed975);if(!_0x334d02){console[_0x1e2f68(0x24ab)](_0x1e2f68(0x2164)+_0x1ed975),showToast(_0x1e2f68(0x7dc)+_0x1ed975+_0x1e2f68(0x1df1),_0x1e2f68(0x24ab));return;}_0x334d02['style'][_0x1e2f68(0x2526)]=_0x1e2f68(0x1f0b),_0x1ed975===_0x1e2f68(0xa76)&&renderMessageList(),_0x1ed975===_0x1e2f68(0x30f)&&renderSMSMessageList(),_0x1ed975==='anniversary-screen'&&(loadAnniversaryList(),loadAppointmentList()),_0x1ed975==='api-settings-screen'&&setTimeout(()=>{initializeApiSettings();},0x64),_0x1ed975===_0x1e2f68(0x2094)&&setTimeout(()=>{initSoundSettings();},0x64),_0x1ed975===_0x1e2f68(0x213)&&setTimeout(async()=>{await initCustomThemeScreen();},0x64);}function hideCharacterForm(){const _0x58625a=_0x2cf6d4;clearCharacterForm(),hideApp(_0x58625a(0xb53)),showApp('chat-screen'),switchChatTab(_0x58625a(0x1853));const _0x738c5d=document['querySelectorAll'](_0x58625a(0x1c9f));_0x738c5d[_0x58625a(0x900)](_0xe305b8=>{const _0x362a13=_0x58625a;_0xe305b8&&_0xe305b8[_0x362a13(0x226e)]&&_0xe305b8[_0x362a13(0x226e)][_0x362a13(0x128)]('active');}),_0x738c5d[_0x58625a(0xcbf)]>0x1&&_0x738c5d[0x1]&&_0x738c5d[0x1][_0x58625a(0x226e)]&&_0x738c5d[0x1][_0x58625a(0x226e)][_0x58625a(0xe1)](_0x58625a(0x105d));}function hideApp(_0x2ebb07){const _0x13a826=_0x2cf6d4;document[_0x13a826(0x566)](_0x2ebb07)[_0x13a826(0x655)][_0x13a826(0x2526)]=_0x13a826(0xfe9);const _0x2bb0f0=document[_0x13a826(0x1ed9)]('.app-screen'),_0x538b01=Array[_0x13a826(0x2308)](_0x2bb0f0)[_0x13a826(0x184b)](_0x2e438d=>_0x2e438d['style'][_0x13a826(0x2526)]===_0x13a826(0x1f0b)||_0x2e438d[_0x13a826(0x655)][_0x13a826(0x2526)]===_0x13a826(0x2d4));if(!_0x538b01){const _0x2c4fe8=document['getElementById'](_0x13a826(0x799)),_0x4abfc9=document[_0x13a826(0x566)](_0x13a826(0x1615)),_0x5bfb76=document['getElementById'](_0x13a826(0x1280)),_0x5b894f=document[_0x13a826(0x566)](_0x13a826(0x459));if(_0x2c4fe8)_0x2c4fe8['style'][_0x13a826(0x2526)]=_0x13a826(0x2d4);if(_0x4abfc9)_0x4abfc9[_0x13a826(0x655)][_0x13a826(0x2526)]=_0x13a826(0x6bb);if(_0x5bfb76)_0x5bfb76[_0x13a826(0x655)][_0x13a826(0x2526)]=_0x13a826(0x2d4);if(_0x5b894f)_0x5b894f['style'][_0x13a826(0x2526)]=_0x13a826(0x1f0b);}else{const _0x5cf15e=document[_0x13a826(0x566)](_0x13a826(0x459));_0x5cf15e&&(_0x5cf15e[_0x13a826(0x655)][_0x13a826(0x2526)]='none');}}function showModal(_0x153688){const _0xf4fa7f=_0x2cf6d4;console[_0xf4fa7f(0xc0d)](_0xf4fa7f(0x2189),_0x153688);const _0x59e346=document[_0xf4fa7f(0x566)](_0x153688);console[_0xf4fa7f(0xc0d)](_0xf4fa7f(0x132),_0x59e346),_0x59e346?(_0x59e346[_0xf4fa7f(0x655)][_0xf4fa7f(0x2526)]=_0xf4fa7f(0x1f0b),console[_0xf4fa7f(0xc0d)](_0xf4fa7f(0x1027))):console[_0xf4fa7f(0xc0d)](_0xf4fa7f(0x223f));}function hideModal(_0x3d5a66){const _0xc917=_0x2cf6d4;document[_0xc917(0x566)](_0x3d5a66)[_0xc917(0x655)][_0xc917(0x2526)]=_0xc917(0xfe9);}let anniversaries=[],editingAnniversaryId=null,appointments=[],editingAppointmentId=null;function switchAnniversaryTab(_0x5e15ba){const _0x282d3e=_0x2cf6d4;document[_0x282d3e(0x1ed9)](_0x282d3e(0xbb4))[_0x282d3e(0x900)](_0x58c9c9=>{const _0xa563bf=_0x282d3e;_0x58c9c9[_0xa563bf(0x226e)][_0xa563bf(0x128)]('active');}),document['querySelector']('.anniversary-tab[onclick*=\x22'+_0x5e15ba+'\x22]')['classList']['add'](_0x282d3e(0x105d)),document[_0x282d3e(0x566)](_0x282d3e(0xcf3))['style'][_0x282d3e(0x2526)]=_0x5e15ba==='anniversary'?'block':_0x282d3e(0xfe9),document['getElementById'](_0x282d3e(0x193f))['style'][_0x282d3e(0x2526)]=_0x5e15ba===_0x282d3e(0xd84)?_0x282d3e(0x2d4):_0x282d3e(0xfe9);const _0x46f6a0=document[_0x282d3e(0x15b8)]('#anniversary-screen\x20.add-anniversary-btn');_0x5e15ba===_0x282d3e(0xe32)?(_0x46f6a0['onclick']=showAnniversaryForm,_0x46f6a0['innerHTML']=_0x282d3e(0x1f31),_0x46f6a0[_0x282d3e(0x1c18)]=_0x282d3e(0x42d)):(_0x46f6a0[_0x282d3e(0x11cf)]=()=>showAppointmentForm(),_0x46f6a0[_0x282d3e(0xc02)]=_0x282d3e(0x1f31),_0x46f6a0[_0x282d3e(0x1c18)]=_0x282d3e(0x5dd));}function switchShoppingTab(_0x24071f){const _0x179b85=_0x2cf6d4;document[_0x179b85(0x1ed9)]('.shopping-tab')['forEach'](_0x5dd01f=>{const _0x22a10e=_0x179b85;_0x5dd01f[_0x22a10e(0x226e)][_0x22a10e(0x128)]('active');}),document[_0x179b85(0x15b8)]('.shopping-tab[onclick*=\x22'+_0x24071f+'\x22]')[_0x179b85(0x226e)][_0x179b85(0xe1)]('active');const _0x1910f4=document['getElementById'](_0x179b85(0xd81)),_0x322360=document[_0x179b85(0x566)](_0x179b85(0x1f73)),_0x2f3401=document[_0x179b85(0x15b8)](_0x179b85(0x3de)),_0x1671e9=document['querySelector'](_0x179b85(0x2536)),_0x340470=document[_0x179b85(0x15b8)](_0x179b85(0xef1));_0x1910f4[_0x179b85(0x655)]['display']='block',_0x2f3401[_0x179b85(0x655)][_0x179b85(0x2526)]=_0x179b85(0x2d4),_0x322360[_0x179b85(0x655)][_0x179b85(0x2526)]=_0x179b85(0xfe9),_0x340470['classList'][_0x179b85(0x128)](_0x179b85(0x1c39));if(_0x24071f===_0x179b85(0x1a2))_0x1671e9[_0x179b85(0x21dc)]='外卖';else _0x24071f===_0x179b85(0x10cd)&&(_0x1671e9[_0x179b85(0x21dc)]='购物');_0x2f3401[_0x179b85(0x655)][_0x179b85(0x492)]=_0x179b85(0x1b89),_0x2f3401[_0x179b85(0x655)][_0x179b85(0x1466)]='0',_0x2f3401[_0x179b85(0x655)]['transform']=_0x179b85(0xfe9);const _0x27f095=document['getElementById'](_0x179b85(0x24c4)),_0xc8a9c4=document[_0x179b85(0x566)](_0x179b85(0x1398));if(_0x24071f===_0x179b85(0x1a2))_0x27f095[_0x179b85(0x655)]['display']=_0x179b85(0x1f0b),_0xc8a9c4[_0x179b85(0x655)][_0x179b85(0x2526)]=_0x179b85(0xfe9);else _0x24071f===_0x179b85(0x10cd)&&(_0x27f095['style'][_0x179b85(0x2526)]=_0x179b85(0xfe9),_0xc8a9c4[_0x179b85(0x655)][_0x179b85(0x2526)]=_0x179b85(0x1f0b));console['log'](_0x179b85(0x2404),_0x24071f);}const productsData={'美食':[{'name':'麻辣香锅','brand':_0x2cf6d4(0x2207),'price':45.8,'options':{'size':['小份','中份','大份'],'spicy':['不辣','微辣','中辣','特辣']},'prices':{'size':{'小份':0x26,'中份':0x2e,'大份':0x3a}}},{'name':_0x2cf6d4(0xbcd),'brand':_0x2cf6d4(0x213a),'price':28.5,'options':{'size':['小份','大份'],'spicy':['不辣','微辣','中辣']},'prices':{'size':{'小份':0x18,'大份':0x24}}},{'name':_0x2cf6d4(0x125f),'brand':_0x2cf6d4(0xfe0),'price':0x20,'options':{'size':['小份','大份']},'prices':{'size':{'小份':0x1a,'大份':0x2a}}},{'name':_0x2cf6d4(0x2444),'brand':'太二','price':0x44,'options':{'size':['1-2人份',_0x2cf6d4(0x188a)],'spicy':['微辣','中辣','特辣']},'prices':{'size':{'1-2人份':0x44,'3-4人份':0x5d}}},{'name':'兰州拉面','brand':_0x2cf6d4(0xf30),'price':0x12,'options':{'noodle':['细面','宽面'],'soup':['清汤','红汤']},'prices':{'soup':{'清汤':0x12,'红汤':0x14}}},{'name':_0x2cf6d4(0x83b),'brand':_0x2cf6d4(0x169d),'price':0x23,'options':{'count':['6个','8个',_0x2cf6d4(0x1c0c)]},'prices':{'count':{'6个':0x23,'8个':0x2b,'12个':0x35}}},{'name':'烤鸭','brand':_0x2cf6d4(0xc85),'price':0x80,'options':{'size':['半只','整只']},'prices':{'size':{'半只':0x80,'整只':0xbc}}},{'name':_0x2cf6d4(0xa32),'brand':'陈麻婆','price':0x16,'options':{'spicy':['微辣','中辣','特辣']}},{'name':_0x2cf6d4(0x173a),'brand':_0x2cf6d4(0xbb2),'price':0x26,'options':{'size':['小份','大份']}},{'name':_0x2cf6d4(0x24d1),'brand':'巴奴','price':0x3a,'options':{'size':['1-2人份',_0x2cf6d4(0x188a)],'spicy':['中辣','特辣',_0x2cf6d4(0x2193)]}},{'name':'回锅肉','brand':_0x2cf6d4(0x1e3b),'price':0x2a,'options':{'spicy':['微辣','中辣','特辣']}},{'name':_0x2cf6d4(0x15a4),'brand':'老娘舅','price':0xf,'options':{'flavor':['原味','肉末','虾仁']},'prices':{'flavor':{'原味':0xf,'肉末':0x12,'虾仁':0x14}}},{'name':_0x2cf6d4(0xfae),'brand':_0x2cf6d4(0x64a),'price':0x30,'options':{'size':['小份','大份']},'prices':{'size':{'小份':0x26,'大份':0x3f}}},{'name':_0x2cf6d4(0x421),'brand':_0x2cf6d4(0x11d),'price':0x23,'options':{'spicy':['微辣','中辣']}},{'name':_0x2cf6d4(0x15af),'brand':_0x2cf6d4(0x12ed),'price':0x2d,'options':{'size':['半只','整只']},'prices':{'size':{'半只':0x2d,'整只':0x50}}},{'name':_0x2cf6d4(0x186a),'brand':_0x2cf6d4(0x816),'price':0x19,'options':{'ingredients':['普通','虾仁','叉烧','海鲜']},'prices':{'ingredients':{'普通':0x19,'虾仁':0x21,'叉烧':0x1f,'海鲜':0x25}}},{'name':_0x2cf6d4(0x6e6),'brand':'成都小吃','price':0x14,'options':{'spicy':['微辣','中辣','特辣'],'noodle':['细面','宽面']}},{'name':_0x2cf6d4(0x1ebb),'brand':'廖记棒棒鸡','price':0x20,'options':{'spicy':['微辣','中辣','特辣']}},{'name':_0x2cf6d4(0x10c7),'brand':_0x2cf6d4(0x157e),'price':0x12,'options':{'size':['小份','大份']},'prices':{'size':{'小份':0xf,'大份':0x17}}},{'name':'清蒸鲈鱼','brand':_0x2cf6d4(0xe74),'price':0x44,'options':{'weight':['1斤',_0x2cf6d4(0x21e5),'2斤']},'prices':{'weight':{'1斤':0x44,'1.5斤':0x58,'2斤':0x6c}}}],'甜点饮品':[{'name':_0x2cf6d4(0x122b),'brand':'喜茶','price':0x19,'options':{'sugar':['无糖','三分糖',_0x2cf6d4(0x3dc),'七分糖','全糖'],'ice':['多冰','少冰','常温','热'],'size':['小杯','中杯','大杯']},'prices':{'size':{'小杯':0x16,'中杯':0x19,'大杯':0x1e}}},{'name':_0x2cf6d4(0xaf),'brand':'星巴克','price':0x26,'options':{'flavor':['原味','草莓','蓝莓',_0x2cf6d4(0x20a2)]}},{'name':'提拉米苏','brand':_0x2cf6d4(0x1abd),'price':0x20,'options':{'size':['小份','大份']},'prices':{'size':{'小份':0x1b,'大份':0x28}}},{'name':_0x2cf6d4(0x14eb),'brand':_0x2cf6d4(0x72e),'price':0x1c,'options':{'sugar':['无糖','半糖','全糖'],'ice':['多冰','少冰','常温','热'],'size':['小杯','中杯','大杯']}},{'name':_0x2cf6d4(0x1c54),'brand':_0x2cf6d4(0xff8),'price':0x16,'options':{'ice':['多冰','少冰'],'size':['小杯','大杯']}},{'name':'芒果班戟','brand':_0x2cf6d4(0xc9f),'price':0x23,'options':{'count':['1个','2个','4个']},'prices':{'count':{'1个':0x23,'2个':0x32,'4个':0x46}}},{'name':_0x2cf6d4(0x7bf),'brand':_0x2cf6d4(0x1ce8),'price':0x12,'options':{'flavor':['原味','红豆','芒果']}},{'name':_0x2cf6d4(0x1aae),'brand':_0x2cf6d4(0x22e2),'price':0x14,'options':{'sugar':['无糖',_0x2cf6d4(0x13be),_0x2cf6d4(0x3dc),_0x2cf6d4(0x226d)],'ice':['多冰','少冰','常温'],'size':['中杯','大杯']}},{'name':_0x2cf6d4(0x2073),'brand':_0x2cf6d4(0x1b7c),'price':0x2d,'options':{'flavor':['香草',_0x2cf6d4(0x20a2),'草莓','柠檬'],'count':['3个','6个','12个']}},{'name':'布丁','brand':'优格','price':0xf,'options':{'flavor':['原味','焦糖','芒果','草莓']}},{'name':'烧仙草','brand':_0x2cf6d4(0xf2e),'price':0x12,'options':{'sugar':['三分糖',_0x2cf6d4(0x3dc),_0x2cf6d4(0x226d)],'ice':['多冰','少冰','常温'],'size':['中杯','大杯']}},{'name':'芋圆','brand':_0x2cf6d4(0x1a38),'price':0x16,'options':{'ice':['多冰','少冰'],'toppings':['红豆','绿豆','花生','椰果']}},{'name':_0x2cf6d4(0x1589),'brand':'哈根达斯','price':0x3a,'options':{'flavor':['香草',_0x2cf6d4(0x20a2),'草莓','抹茶'],'size':['小杯','大杯']}},{'name':'司康饼','brand':_0x2cf6d4(0x1da9),'price':0x19,'options':{'flavor':['原味','蓝莓',_0x2cf6d4(0x20a2)]}},{'name':'泡芙','brand':_0x2cf6d4(0xfe7),'price':0x1c,'options':{'flavor':['奶油',_0x2cf6d4(0x20a2),'抹茶'],'count':['3个','6个']}},{'name':'果汁','brand':_0x2cf6d4(0x1380),'price':0x14,'options':{'flavor':['橙汁',_0x2cf6d4(0xcf6),_0x2cf6d4(0x23d6),_0x2cf6d4(0xa40)],'size':['中杯','大杯']}},{'name':'咖啡','brand':_0x2cf6d4(0x72e),'price':0x18,'options':{'type':['美式','拿铁',_0x2cf6d4(0x59a)],'sugar':['无糖','半糖','全糖'],'size':['小杯','中杯','大杯']}},{'name':'奶昔','brand':'DQ','price':0x20,'options':{'flavor':['香草',_0x2cf6d4(0x20a2),'草莓','芒果'],'size':['小杯','中杯','大杯']}},{'name':'蛋挞','brand':_0x2cf6d4(0x1595),'price':0x8,'options':{'count':['1个','6个',_0x2cf6d4(0x1c0c)]}},{'name':_0x2cf6d4(0x1cdc),'brand':_0x2cf6d4(0x1836),'price':0x2a,'options':{'flavor':['原味',_0x2cf6d4(0x20a2),'抹茶']}}],'蔬菜水果':[{'name':'有机苹果','brand':'佳沛','price':12.8,'options':{'weight':[_0x2cf6d4(0x234f),_0x2cf6d4(0x1a45),_0x2cf6d4(0x15ce)],'type':[_0x2cf6d4(0x1bed),_0x2cf6d4(0x455)]}},{'name':_0x2cf6d4(0x18f0),'brand':'都乐','price':8.5,'options':{'weight':['500g',_0x2cf6d4(0x1a45)]}},{'name':'新鲜草莓','brand':_0x2cf6d4(0x66c),'price':0x19,'options':{'weight':[_0x2cf6d4(0xbf0),'500g',_0x2cf6d4(0x1a45)]}},{'name':_0x2cf6d4(0x733),'brand':'寿光蔬菜','price':6.8,'options':{'weight':[_0x2cf6d4(0x234f),_0x2cf6d4(0x1a45)],'type':['小番茄',_0x2cf6d4(0x95c)]}},{'name':_0x2cf6d4(0x1fd6),'brand':_0x2cf6d4(0x1998),'price':4.5,'options':{'weight':[_0x2cf6d4(0x234f),_0x2cf6d4(0x1a45)]}},{'name':_0x2cf6d4(0x5bd),'brand':_0x2cf6d4(0x1221),'price':5.2,'options':{'weight':[_0x2cf6d4(0x234f),_0x2cf6d4(0x1a45)]}},{'name':'新鲜菠菜','brand':_0x2cf6d4(0x11f7),'price':3.8,'options':{'weight':[_0x2cf6d4(0xbf0),_0x2cf6d4(0x234f)]}},{'name':_0x2cf6d4(0x1696),'brand':'墨西哥','price':0x12,'options':{'count':['2个','4个','6个'],'ripeness':['生','半熟','熟']}},{'name':'有机白菜','brand':'东北农场','price':3.2,'options':{'weight':[_0x2cf6d4(0x234f),_0x2cf6d4(0x1a45),_0x2cf6d4(0x15ce)]}},{'name':'新鲜芹菜','brand':_0x2cf6d4(0x556),'price':0x4,'options':{'weight':['250g',_0x2cf6d4(0x234f)]}},{'name':'进口橙子','brand':_0x2cf6d4(0x1297),'price':15.8,'options':{'weight':[_0x2cf6d4(0x1a45),_0x2cf6d4(0x15ce)],'type':['脐橙','血橙']}},{'name':_0x2cf6d4(0xa25),'brand':'内蒙古','price':4.8,'options':{'weight':[_0x2cf6d4(0x1a45),'2kg',_0x2cf6d4(0x129f)]}},{'name':_0x2cf6d4(0x16e8),'brand':_0x2cf6d4(0x11f7),'price':0x6,'options':{'weight':[_0x2cf6d4(0xbf0),_0x2cf6d4(0x234f)]}},{'name':_0x2cf6d4(0x1bf9),'brand':'佳沛','price':0x1c,'options':{'count':['6个','12个'],'type':['绿心','黄心','红心']}},{'name':_0x2cf6d4(0x17b5),'brand':_0x2cf6d4(0x1998),'price':7.5,'options':{'weight':[_0x2cf6d4(0x234f),_0x2cf6d4(0x1a45)],'type':['长茄子','圆茄子']}},{'name':'新鲜葡萄','brand':_0x2cf6d4(0x4e2),'price':0x16,'options':{'weight':[_0x2cf6d4(0x234f),_0x2cf6d4(0x1a45)],'type':['红提','青提','巨峰']}},{'name':_0x2cf6d4(0x2451),'brand':_0x2cf6d4(0xd58),'price':0xc,'options':{'weight':['250g','500g']}},{'name':'新鲜柠檬','brand':'四川柠檬','price':8.8,'options':{'count':['3个','6个','10个']}},{'name':_0x2cf6d4(0x1869),'brand':_0x2cf6d4(0x6f4),'price':0x23,'options':{'weight':[_0x2cf6d4(0x233f),'250g']}},{'name':_0x2cf6d4(0x141b),'brand':_0x2cf6d4(0x11f7),'price':5.5,'options':{'weight':['250g',_0x2cf6d4(0x234f)],'type':['球生菜',_0x2cf6d4(0x9b7)]}}],'看病买药':[{'name':'感冒灵颗粒','brand':_0x2cf6d4(0x21e7),'price':18.5,'options':{'package':[_0x2cf6d4(0x1fd1),'12袋装',_0x2cf6d4(0xbe2)]}},{'name':'板蓝根颗粒','brand':_0x2cf6d4(0x1449),'price':0xf,'options':{'package':[_0x2cf6d4(0xcba),_0x2cf6d4(0x704)]}},{'name':'维生素C','brand':'汤臣倍健','price':0x44,'options':{'count':[_0x2cf6d4(0xfc2),_0x2cf6d4(0x12d9)],'type':[_0x2cf6d4(0x248f),_0x2cf6d4(0x1288)]}},{'name':'创可贴','brand':'邦迪','price':0xc,'options':{'size':[_0x2cf6d4(0x236d),'大号',_0x2cf6d4(0x18c8)],'count':[_0x2cf6d4(0x201d),_0x2cf6d4(0xdb3)]}},{'name':'体温计','brand':_0x2cf6d4(0x1705),'price':0x55,'options':{'type':[_0x2cf6d4(0x1d7d),'红外体温计']}},{'name':'碘伏','brand':'利康','price':8.5,'options':{'volume':[_0x2cf6d4(0x1099),'60ml',_0x2cf6d4(0x1178)]}},{'name':_0x2cf6d4(0x255e),'brand':'芬必得','price':0x19,'options':{'count':[_0x2cf6d4(0x144f),_0x2cf6d4(0x19cd)]}},{'name':'胃药','brand':'达喜','price':0x20,'options':{'count':['20片',_0x2cf6d4(0x10ab)]}},{'name':_0x2cf6d4(0x2477),'brand':_0x2cf6d4(0x119a),'price':0x12,'options':{'volume':[_0x2cf6d4(0x51f),_0x2cf6d4(0x1dfe)],'type':['缓解疲劳','抗菌消炎']}},{'name':'口罩','brand':'3M','price':0x2d,'options':{'type':[_0x2cf6d4(0x18c9),_0x2cf6d4(0x194a)],'count':['10个',_0x2cf6d4(0x13f)]}},{'name':_0x2cf6d4(0xba),'brand':'欧姆龙','price':0x12a,'options':{'type':[_0x2cf6d4(0x334),_0x2cf6d4(0x132c)]}},{'name':'钙片','brand':_0x2cf6d4(0x12ec),'price':0x58,'options':{'count':[_0x2cf6d4(0xfc2),_0x2cf6d4(0x12d9)],'type':[_0x2cf6d4(0x1035),_0x2cf6d4(0x2504)]}},{'name':'消毒液','brand':'滴露','price':0x16,'options':{'volume':['500ml','1L'],'type':[_0x2cf6d4(0x1c34),'地面消毒']}},{'name':'纱布','brand':'振德','price':0xf,'options':{'size':[_0x2cf6d4(0x771),_0x2cf6d4(0xd02)],'type':['无菌','普通']}},{'name':_0x2cf6d4(0x23a4),'brand':'美林','price':0x1c,'options':{'type':[_0x2cf6d4(0x1b11),_0x2cf6d4(0xd26)],'volume':[_0x2cf6d4(0x1178),_0x2cf6d4(0x14fe)]}},{'name':_0x2cf6d4(0xda2),'brand':'葵花','price':0x2d,'options':{'count':['36片',_0x2cf6d4(0x1b20)]}},{'name':'止咳糖浆','brand':_0x2cf6d4(0xcb3),'price':0x18,'options':{'volume':[_0x2cf6d4(0x1178),'200ml']}},{'name':_0x2cf6d4(0x9a),'brand':_0x2cf6d4(0x1e15),'price':0xb4,'options':{'type':['速效','长效']}},{'name':'血糖试纸','brand':'强生','price':0x78,'options':{'count':[_0x2cf6d4(0x1838),_0x2cf6d4(0x1d01)]}},{'name':'维生素D','brand':'自然之宝','price':0x4e,'options':{'count':[_0x2cf6d4(0x1404),'100粒'],'strength':[_0x2cf6d4(0xf01),_0x2cf6d4(0x1667)]}}],'数码产品':[{'name':'iPhone\x2015','brand':_0x2cf6d4(0xf04),'price':0x176f,'options':{'storage':[_0x2cf6d4(0xf2b),'256GB',_0x2cf6d4(0xcc8)],'color':['黑色','白色','蓝色','粉色']}},{'name':'小米13','brand':'小米','price':0xf9f,'options':{'storage':[_0x2cf6d4(0xf2b),'256GB'],'color':['黑色','白色','绿色']}},{'name':_0x2cf6d4(0x23a3),'brand':_0x2cf6d4(0xf04),'price':0x2327,'options':{'chip':['M2','M3'],'storage':[_0x2cf6d4(0x9c2),'512GB','1TB'],'color':['银色',_0x2cf6d4(0x1306),_0x2cf6d4(0x19b1)]}},{'name':_0x2cf6d4(0x14f8),'brand':'华为','price':0x1188,'options':{'storage':[_0x2cf6d4(0xf2b),_0x2cf6d4(0x9c2),_0x2cf6d4(0xcc8)],'color':['黑色','白色','紫色']}},{'name':_0x2cf6d4(0x243e),'brand':_0x2cf6d4(0xf04),'price':0x1a8f,'options':{'size':[_0x2cf6d4(0x1078),_0x2cf6d4(0x7a4)],'storage':[_0x2cf6d4(0xf2b),_0x2cf6d4(0x9c2),'512GB',_0x2cf6d4(0x1e2b)]}},{'name':_0x2cf6d4(0x9be),'brand':_0x2cf6d4(0xf04),'price':0x76b,'options':{'generation':[_0x2cf6d4(0x1cc8),_0x2cf6d4(0x81a)]}},{'name':_0x2cf6d4(0x2405),'brand':'Dell','price':0x1f3f,'options':{'processor':['i5','i7'],'ram':[_0x2cf6d4(0x89a),'16GB',_0x2cf6d4(0x131)],'storage':[_0x2cf6d4(0x9c2),_0x2cf6d4(0xcc8),_0x2cf6d4(0x1e2b)]}},{'name':'索尼WH-1000XM5','brand':_0x2cf6d4(0x1509),'price':0x95f,'options':{'color':['黑色','银色']}},{'name':_0x2cf6d4(0x1c7),'brand':_0x2cf6d4(0x1c22),'price':0x833,'options':{'type':['标准版',_0x2cf6d4(0x192c)],'color':['红蓝','灰色','白色']}},{'name':_0x2cf6d4(0x16a4),'brand':'小米','price':0x12b,'options':{'color':['黑色','蓝色','粉色'],'strap':[_0x2cf6d4(0x1052),_0x2cf6d4(0x9cd)]}},{'name':_0x2cf6d4(0x149f),'brand':_0x2cf6d4(0x805),'price':0x383,'options':{'storage':[_0x2cf6d4(0x89a),_0x2cf6d4(0x131)],'type':['标准版',_0x2cf6d4(0x1a5e),_0x2cf6d4(0x15c3)]}},{'name':'罗技鼠标','brand':'罗技','price':0x12b,'options':{'type':['有线','无线'],'dpi':[_0x2cf6d4(0x759),'2000DPI',_0x2cf6d4(0x3a9)]}},{'name':_0x2cf6d4(0x2c7),'brand':'雷蛇','price':0x383,'options':{'switch':['青轴','红轴','茶轴'],'backlight':[_0x2cf6d4(0x1d82),_0x2cf6d4(0xffa)]}},{'name':_0x2cf6d4(0x171a),'brand':_0x2cf6d4(0x59d),'price':0x257,'options':{'capacity':[_0x2cf6d4(0x1e2b),_0x2cf6d4(0x144e),_0x2cf6d4(0x1f12)],'type':['USB3.0',_0x2cf6d4(0x883)]}},{'name':_0x2cf6d4(0xdcf),'brand':'小米','price':0x95,'options':{'capacity':[_0x2cf6d4(0x2346),_0x2cf6d4(0x1829)],'type':[_0x2cf6d4(0x7a5),_0x2cf6d4(0x1b09)]}},{'name':_0x2cf6d4(0x1048),'brand':_0x2cf6d4(0x8e2),'price':0x2bb,'options':{'size':[_0x2cf6d4(0x143),_0x2cf6d4(0x994)],'color':['黑色','蓝色','红色']}},{'name':_0x2cf6d4(0x60a),'brand':_0x2cf6d4(0x20c4),'price':0xbb7,'options':{'size':[_0x2cf6d4(0x355),_0x2cf6d4(0xb5e)],'band':[_0x2cf6d4(0x1052),_0x2cf6d4(0x9cd),_0x2cf6d4(0x1de8)]}},{'name':_0x2cf6d4(0x1686),'brand':_0x2cf6d4(0x1f5e),'price':0x12b,'options':{'power':['5W',_0x2cf6d4(0x179d),_0x2cf6d4(0xb9d)],'type':['立式',_0x2cf6d4(0x1aba)]}},{'name':_0x2cf6d4(0x1740),'brand':'罗技','price':0x257,'options':{'resolution':[_0x2cf6d4(0x18ab),'4K'],'type':['普通版',_0x2cf6d4(0xabc)]}},{'name':'路由器','brand':'华硕','price':0x383,'options':{'speed':['AC1200',_0x2cf6d4(0x21f4),_0x2cf6d4(0xd3d)],'antenna':[_0x2cf6d4(0x2554),'4天线','6天线']}}],'家居百货':[{'name':_0x2cf6d4(0x24b6),'brand':_0x2cf6d4(0x74e),'price':0x12b,'options':{'height':['低枕','中枕','高枕'],'hardness':['软','中等','硬']}},{'name':_0x2cf6d4(0x1320),'brand':_0x2cf6d4(0x11a8),'price':0x18f,'options':{'size':[_0x2cf6d4(0x3e4),'1.8m床',_0x2cf6d4(0x3a1)],'material':['纯棉','天丝','真丝']}},{'name':'电饭煲','brand':'美的','price':0x257,'options':{'capacity':['3L','4L','5L'],'type':['普通版',_0x2cf6d4(0x53e)]}},{'name':'吸尘器','brand':'戴森','price':0xbb7,'options':{'type':[_0x2cf6d4(0xebf),'立式',_0x2cf6d4(0x1f80)],'power':['标准版',_0x2cf6d4(0x1f43)]}},{'name':_0x2cf6d4(0x1029),'brand':'小米','price':0x513,'options':{'coverage':[_0x2cf6d4(0xb47),_0x2cf6d4(0x3f8),_0x2cf6d4(0x6c1)],'filter':[_0x2cf6d4(0x1ace),_0x2cf6d4(0x1a7e)]}},{'name':'台灯','brand':_0x2cf6d4(0x1618),'price':0x12b,'options':{'type':[_0x2cf6d4(0x1f4f),_0x2cf6d4(0x21b4)],'brightness':[_0x2cf6d4(0xaa3),_0x2cf6d4(0x4f5)]}},{'name':_0x2cf6d4(0x68d),'brand':_0x2cf6d4(0x211e),'price':0xc7,'options':{'capacity':['350ml',_0x2cf6d4(0x8ae),_0x2cf6d4(0x14b0)],'color':['黑色','白色','蓝色','粉色']}},{'name':'毛巾','brand':'洁丽雅','price':0x27,'options':{'size':['面巾','浴巾'],'material':['纯棉','竹纤维'],'color':['白色','蓝色','粉色']}},{'name':'垃圾桶','brand':'拓牌','price':0x59,'options':{'capacity':['8L',_0x2cf6d4(0xb0f),_0x2cf6d4(0x14a3)],'type':[_0x2cf6d4(0x5bf),_0x2cf6d4(0xa06)]}},{'name':_0x2cf6d4(0x4a9),'brand':_0x2cf6d4(0x962),'price':0x3b,'options':{'size':['小号','中号','大号'],'material':['塑料','布艺'],'color':['透明','白色','灰色']}},{'name':'拖鞋','brand':_0x2cf6d4(0x2341),'price':0x1d,'options':{'size':[_0x2cf6d4(0x117d),_0x2cf6d4(0x3b9),_0x2cf6d4(0x19be),_0x2cf6d4(0x1c57)],'type':[_0x2cf6d4(0xe1f),'浴室拖鞋']}},{'name':'衣架','brand':'太力','price':0x19,'options':{'material':['塑料',_0x2cf6d4(0x1f1c)],'type':[_0x2cf6d4(0x13ca),_0x2cf6d4(0x2443)],'count':['10个',_0x2cf6d4(0x1f0a),'50个']}},{'name':_0x2cf6d4(0x3a5),'brand':_0x2cf6d4(0x50b),'price':0x2d,'options':{'volume':[_0x2cf6d4(0x1a45),_0x2cf6d4(0x15ce),_0x2cf6d4(0xa84)],'type':[_0x2cf6d4(0x1ec1),'护色',_0x2cf6d4(0x1107)]}},{'name':'纸巾','brand':'维达','price':0x23,'options':{'type':['抽纸','卷纸'],'layers':['3层','4层'],'count':['12包','24包']}},{'name':_0x2cf6d4(0x1259),'brand':'立白','price':0x12,'options':{'volume':[_0x2cf6d4(0x8ae),'1L','2L'],'type':['普通','柠檬香','芦荟']}},{'name':'床垫','brand':'慕思','price':0xbb7,'options':{'size':[_0x2cf6d4(0x1735),_0x2cf6d4(0x1f86),_0x2cf6d4(0x23b)],'type':[_0x2cf6d4(0x10fa),_0x2cf6d4(0x37f),_0x2cf6d4(0x1712)]}},{'name':'窗帘','brand':_0x2cf6d4(0x1aa8),'price':0x12b,'options':{'size':[_0x2cf6d4(0xfb6),_0x2cf6d4(0x1ed6),_0x2cf6d4(0xe8e)],'material':['棉麻',_0x2cf6d4(0x1bcd),_0x2cf6d4(0x808)]}},{'name':'地毯','brand':'山花','price':0xc7,'options':{'size':[_0x2cf6d4(0x1381),_0x2cf6d4(0x134a),_0x2cf6d4(0x1524)],'material':['化纤','羊毛']}},{'name':'花洒','brand':'九牧','price':0x18f,'options':{'type':[_0x2cf6d4(0x245e),'顶喷花洒'],'function':['普通','按摩','节水']}},{'name':_0x2cf6d4(0x1ed7),'brand':'好人','price':0x19,'options':{'type':[_0x2cf6d4(0x1567),_0x2cf6d4(0x734)],'handle':['长柄','短柄']}}],'女装男装':[{'name':_0x2cf6d4(0x1cca),'brand':'ZARA','price':0x12b,'options':{'size':['S','M','L','XL'],'color':['黑色','白色','蓝色','红色'],'style':[_0x2cf6d4(0x175e),'直筒裙']}},{'name':_0x2cf6d4(0xc0a),'brand':_0x2cf6d4(0x64d),'price':0x257,'options':{'size':['28','29','30','31','32','33','34'],'color':['深蓝','浅蓝','黑色'],'fit':['修身','直筒','宽松']}},{'name':'T恤','brand':_0x2cf6d4(0x11c0),'price':0x63,'options':{'size':['S','M','L','XL',_0x2cf6d4(0x1fe4)],'color':['白色','黑色','灰色','蓝色','红色'],'sleeve':['短袖','长袖']}},{'name':'西装','brand':_0x2cf6d4(0x204c),'price':0xbb7,'options':{'size':['46','48','50','52','54'],'color':['黑色','深蓝','灰色'],'style':['修身','经典']}},{'name':_0x2cf6d4(0x1e46),'brand':_0x2cf6d4(0x1aff),'price':0x1387,'options':{'size':['S','M','L','XL'],'color':['黑色','军绿',_0x2cf6d4(0x489)],'length':['短款',_0x2cf6d4(0x1c82),'长款']}},{'name':'毛衣','brand':_0x2cf6d4(0x169e),'price':0xc7,'options':{'size':['S','M','L','XL'],'color':['米色','灰色','黑色','红色'],'material':['羊毛','棉质','混纺']}},{'name':'衬衫','brand':'CK','price':0x18f,'options':{'size':['S','M','L','XL',_0x2cf6d4(0x1fe4)],'color':['白色','蓝色','粉色'],'collar':['尖领','圆领'],'sleeve':['长袖','短袖']}},{'name':'短裤','brand':_0x2cf6d4(0xdf4),'price':0x12b,'options':{'size':['S','M','L','XL'],'color':['黑色','灰色','蓝色'],'length':['5分','7分'],'type':['运动','休闲']}},{'name':'裙子','brand':_0x2cf6d4(0x5b2),'price':0x103,'options':{'size':['S','M','L','XL'],'color':['黑色','白色','花色'],'length':['短裙','中裙','长裙']}},{'name':'外套','brand':'Adidas','price':0x2bb,'options':{'size':['S','M','L','XL',_0x2cf6d4(0x1fe4)],'color':['黑色','白色','蓝色'],'type':['夹克','卫衣','风衣']}},{'name':'内衣','brand':_0x2cf6d4(0x1729),'price':0xc7,'options':{'size':[_0x2cf6d4(0x1224),_0x2cf6d4(0x1127),_0x2cf6d4(0x10c3),_0x2cf6d4(0x31f),_0x2cf6d4(0xef0),_0x2cf6d4(0x1d81)],'color':['黑色','白色','肉色'],'type':[_0x2cf6d4(0xd55),'有钢圈']}},{'name':'内裤','brand':'CK','price':0x59,'options':{'size':['S','M','L','XL'],'color':['黑色','白色','灰色'],'type':['三角','平角'],'count':['1条','3条装']}},{'name':'袜子','brand':'浪莎','price':0x19,'options':{'size':['均码'],'color':['黑色','白色','灰色','肉色'],'type':['短袜',_0x2cf6d4(0x648),_0x2cf6d4(0x1984)],'count':['1双',_0x2cf6d4(0x2456)]}},{'name':'睡衣','brand':'安之伴','price':0x9f,'options':{'size':['S','M','L','XL'],'color':['粉色','蓝色','白色'],'material':['纯棉','丝绸',_0x2cf6d4(0x1c61)],'style':['套装','连体']}},{'name':_0x2cf6d4(0xb2c),'brand':_0x2cf6d4(0x7f4),'price':0x257,'options':{'size':['S','M','L','XL','XXL'],'color':['黑色','灰色','蓝色'],'type':['套装','单件'],'function':['速干','保暖']}},{'name':'泳衣','brand':_0x2cf6d4(0x1b0d),'price':0x12b,'options':{'size':['S','M','L','XL'],'color':['黑色','蓝色','红色'],'type':['连体','分体'],'style':['运动','休闲']}},{'name':'围巾','brand':_0x2cf6d4(0x1170),'price':0x513,'options':{'material':['羊毛','羊绒','丝绸'],'color':['经典格纹','纯色'],'size':['标准','加长']}},{'name':'帽子','brand':'New\x20Era','price':0xc7,'options':{'type':[_0x2cf6d4(0x14d4),_0x2cf6d4(0x19a7),_0x2cf6d4(0x978)],'color':['黑色','白色','蓝色','红色'],'size':['均码',_0x2cf6d4(0x1afc)]}},{'name':'手套','brand':_0x2cf6d4(0x10a5),'price':0xc7,'options':{'size':['S','M','L'],'color':['黑色','灰色','蓝色'],'type':[_0x2cf6d4(0x12d7),_0x2cf6d4(0xe09)],'material':['羊毛','抓绒']}},{'name':'腰带','brand':_0x2cf6d4(0x231a),'price':0xbb7,'options':{'size':[_0x2cf6d4(0x1964),'95cm',_0x2cf6d4(0x15b6),_0x2cf6d4(0x1b5c),_0x2cf6d4(0x1da6)],'color':['黑色','棕色'],'material':['真皮','帆布'],'buckle':['金扣','银扣']}}],'饰品箱包':[{'name':_0x2cf6d4(0x136f),'brand':'LV','price':0x3e7f,'options':{'size':['小号','中号','大号'],'color':[_0x2cf6d4(0x1833),'黑色','白色'],'material':['帆布','真皮']}},{'name':_0x2cf6d4(0x1e54),'brand':_0x2cf6d4(0x1151),'price':0x2bb,'options':{'size':[_0x2cf6d4(0x970),'20L',_0x2cf6d4(0x1293)],'color':['黑色','灰色','蓝色','红色'],'material':['帆布','尼龙']}},{'name':'钱包','brand':_0x2cf6d4(0x21e4),'price':0x513,'options':{'type':['长款','短款'],'color':['黑色','棕色','红色'],'material':['真皮','帆布']}},{'name':'手表','brand':'Rolex','price':0x15f8f,'options':{'type':[_0x2cf6d4(0x1c38),_0x2cf6d4(0x22a5)],'material':[_0x2cf6d4(0x1f1c),'黄金',_0x2cf6d4(0x147f)],'size':[_0x2cf6d4(0x11f9),_0x2cf6d4(0xe9b)]}},{'name':'项链','brand':_0x2cf6d4(0x11c8),'price':0xf9f,'options':{'material':['银','金','铂金'],'length':[_0x2cf6d4(0x1599),_0x2cf6d4(0x1f8b),_0x2cf6d4(0x1e4a)],'style':['简约','镶钻']}},{'name':'耳环','brand':_0x2cf6d4(0x22d3),'price':0x257,'options':{'type':['耳钉','耳环','耳夹'],'material':['银','金'],'style':['简约','镶钻','珍珠']}},{'name':'戒指','brand':_0x2cf6d4(0x6ab),'price':0x2327,'options':{'size':['6号','7号','8号','9号',_0x2cf6d4(0x349)],'material':['银','金','铂金'],'style':['简约','镶钻']}},{'name':'手镯','brand':_0x2cf6d4(0x10c),'price':0xbb7,'options':{'material':['银','金','玉'],'style':['简约','雕花','镶钻'],'size':['标准','加大']}},{'name':'太阳镜','brand':'Ray-Ban','price':0x513,'options':{'style':[_0x2cf6d4(0xdfe),'方框','圆框'],'color':['黑色','棕色','蓝色'],'lens':['偏光','普通']}},{'name':'丝巾','brand':_0x2cf6d4(0x248),'price':0xbb7,'options':{'size':[_0x2cf6d4(0x2ed),_0x2cf6d4(0x16e9)],'color':['经典橙','蓝色','粉色'],'material':['真丝','羊绒']}},{'name':'发夹','brand':'施华洛世奇','price':0x12b,'options':{'type':['发卡','发箍','发绳'],'color':['金色','银色',_0x2cf6d4(0x147f)],'style':['简约','镶钻']}},{'name':'胸针','brand':'Chanel','price':0x1387,'options':{'material':['金属','珍珠'],'style':['经典CC','花朵','动物'],'color':['金色','银色']}},{'name':_0x2cf6d4(0x167f),'brand':_0x2cf6d4(0x45e),'price':0x7cf,'options':{'size':[_0x2cf6d4(0x2441),_0x2cf6d4(0x235b),_0x2cf6d4(0x1d74)],'color':['黑色','银色','蓝色'],'type':['硬壳','软壳'],'wheels':[_0x2cf6d4(0x20b0),'定向轮']}},{'name':_0x2cf6d4(0x1f2c),'brand':_0x2cf6d4(0x1206),'price':0x383,'options':{'size':['小号','中号','大号'],'color':['黑色','粉色','白色'],'material':['皮质','帆布']}},{'name':_0x2cf6d4(0x15e6),'brand':_0x2cf6d4(0x15a5),'price':0x257,'options':{'material':['金属','皮质'],'color':['黑色','银色','金色'],'style':['简约','品牌logo']}},{'name':_0x2cf6d4(0x1558),'brand':_0x2cf6d4(0xf04),'price':0x18f,'options':{'model':[_0x2cf6d4(0x12a9),_0x2cf6d4(0x1a75)],'color':['透明','黑色','白色','蓝色'],'material':['硅胶','皮质','透明']}},{'name':_0x2cf6d4(0x20fc),'brand':_0x2cf6d4(0x1137),'price':0x12b,'options':{'size':['小号','中号','大号'],'color':['红色','黑色','白色'],'material':['绒布','皮质']}},{'name':'香水','brand':'Chanel\x20No.5','price':0x383,'options':{'volume':[_0x2cf6d4(0x1099),_0x2cf6d4(0xb19),_0x2cf6d4(0x1178)],'type':['淡香水','香水'],'packaging':[_0x2cf6d4(0x135c),_0x2cf6d4(0x1ecb)]}},{'name':'口红','brand':_0x2cf6d4(0x15cd),'price':0x12b,'options':{'color':['正红','玫红','橘红','豆沙色'],'finish':['哑光','丝绒','水润'],'series':['方管','圆管']}},{'name':'指甲油','brand':'OPI','price':0x59,'options':{'color':['红色','粉色','蓝色','黑色','透明'],'finish':['普通','珠光','哑光'],'volume':[_0x2cf6d4(0x1dfe),_0x2cf6d4(0x1099)]}}]};function showCategoryProducts(_0x3eed04){const _0x4c4f25=_0x2cf6d4,_0x1120ad=document['getElementById'](_0x4c4f25(0xd81)),_0x377164=document[_0x4c4f25(0x566)](_0x4c4f25(0x1f73)),_0x5323a6=document['querySelector'](_0x4c4f25(0x3de)),_0x34a277=document[_0x4c4f25(0x15b8)]('#shopping-screen\x20.app-title'),_0x136024=document[_0x4c4f25(0x566)](_0x4c4f25(0xad6)),_0x473862=document[_0x4c4f25(0x15b8)](_0x4c4f25(0xef1));_0x1120ad[_0x4c4f25(0x655)]['display']=_0x4c4f25(0xfe9),_0x5323a6['style'][_0x4c4f25(0x2526)]=_0x4c4f25(0xfe9),_0x377164[_0x4c4f25(0x655)][_0x4c4f25(0x2526)]=_0x4c4f25(0x2d4),_0x473862[_0x4c4f25(0x226e)][_0x4c4f25(0xe1)](_0x4c4f25(0x1c39)),_0x34a277[_0x4c4f25(0x21dc)]=_0x3eed04,_0x136024['innerHTML']='';const _0x538e8e=productsData[_0x3eed04]||[];_0x538e8e[_0x4c4f25(0x900)]((_0x395a6d,_0x131438)=>{const _0x2f5353=_0x4c4f25,_0xea63d4=_0x395a6d['prices']&&Object[_0x2f5353(0x16c7)](_0x395a6d[_0x2f5353(0x728)])[_0x2f5353(0xcbf)]>0x0,_0x478a66=_0xea63d4?'¥'+_0x395a6d['price']+'起':'¥'+_0x395a6d[_0x2f5353(0xbfc)],_0x1993fa='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22product-item\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22product-name\x22>'+_0x395a6d['name']+_0x2f5353(0x422)+_0x395a6d[_0x2f5353(0x5bb)]+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22product-price\x22>'+_0x478a66+_0x2f5353(0x19b0)+_0x3eed04+_0x2f5353(0x18a3)+_0x131438+_0x2f5353(0x10c5);_0x136024[_0x2f5353(0xc02)]+=_0x1993fa;});}function backToCategories(){const _0x5e4587=_0x2cf6d4,_0x5f1421=document[_0x5e4587(0x566)](_0x5e4587(0xd81)),_0x16d62f=document[_0x5e4587(0x566)](_0x5e4587(0x1f73)),_0x19ab93=document[_0x5e4587(0x15b8)]('.shopping-search-container'),_0x4317e1=document[_0x5e4587(0x15b8)](_0x5e4587(0x2536)),_0x3c0532=document[_0x5e4587(0x15b8)](_0x5e4587(0xef1));_0x5f1421[_0x5e4587(0x655)][_0x5e4587(0x2526)]=_0x5e4587(0x2d4),_0x19ab93['style'][_0x5e4587(0x2526)]=_0x5e4587(0x1f0b),_0x16d62f[_0x5e4587(0x655)][_0x5e4587(0x2526)]=_0x5e4587(0xfe9),_0x3c0532[_0x5e4587(0x226e)][_0x5e4587(0x128)](_0x5e4587(0x1c39));const _0x3b2ac2=document[_0x5e4587(0x15b8)](_0x5e4587(0xa60));_0x3b2ac2&&_0x3b2ac2[_0x5e4587(0x21dc)][_0x5e4587(0x1424)]()==='外卖'?_0x4317e1[_0x5e4587(0x21dc)]='外卖':_0x4317e1[_0x5e4587(0x21dc)]='购物';}function handleShoppingBack(){const _0x2b8738=_0x2cf6d4,_0x1653e1=document[_0x2b8738(0x566)]('products-container');_0x1653e1['style']['display']===_0x2b8738(0x2d4)?backToCategories():(hideApp('shopping-screen'),showApp(previousScreenBeforeShopping));}let shoppingCart=[];function addToCart(_0x19e4fc,_0x482b36){const _0x3139ba=_0x2cf6d4,_0x9856eb=productsData[_0x19e4fc][_0x482b36];if(!_0x9856eb)return;if(_0x9856eb[_0x3139ba(0x32b)]&&Object[_0x3139ba(0x16c7)](_0x9856eb['options'])['length']>0x0)showProductOptions(_0x19e4fc,_0x482b36);else{const _0x503d01=shoppingCart[_0x3139ba(0x23ba)](_0x4cc41a=>_0x4cc41a[_0x3139ba(0x222f)]===_0x9856eb[_0x3139ba(0x222f)]&&_0x4cc41a['brand']===_0x9856eb['brand']&&Object[_0x3139ba(0x16c7)](_0x4cc41a[_0x3139ba(0xebe)]||{})[_0x3139ba(0xcbf)]===0x0);if(_0x503d01!==-0x1)shoppingCart[_0x503d01]['quantity']+=0x1;else{const _0x2a88ab=getProductPrice(_0x9856eb,{}),_0x16aab2={'name':_0x9856eb['name'],'brand':_0x9856eb[_0x3139ba(0x5bb)],'price':_0x2a88ab,'category':_0x19e4fc,'selectedOptions':{},'quantity':0x1};shoppingCart['push'](_0x16aab2);}updateCartBadge(getTotalCartItems()),showCustomToast(_0x9856eb['name']+_0x3139ba(0x1855),_0x3139ba(0xb27));}}function showProductOptions(_0x40d74a,_0x39868b){const _0x5d3ce5=_0x2cf6d4,_0x3b4c3f=productsData[_0x40d74a][_0x39868b];let _0x45600d='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22position:\x20fixed;\x20top:\x200;\x20left:\x200;\x20width:\x20100%;\x20height:\x20100%;\x20background:\x20rgba(0,0,0,0.5);\x20z-index:\x2010000;\x20display:\x20flex;\x20justify-content:\x20center;\x20align-items:\x20center;\x22\x20onclick=\x22closeProductOptions(event)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22background:\x20white;\x20border-radius:\x2015px;\x20padding:\x2020px;\x20max-width:\x20350px;\x20width:\x2090%;\x20max-height:\x2080vh;\x20overflow-y:\x20auto;\x22\x20onclick=\x22event.stopPropagation()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20style=\x22margin:\x200\x200\x2015px\x200;\x20color:\x20#333;\x22>'+_0x3b4c3f[_0x5d3ce5(0x222f)]+'</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22margin:\x200\x200\x2010px\x200;\x20color:\x20#666;\x20font-size:\x2014px;\x22>'+_0x3b4c3f[_0x5d3ce5(0x5bb)]+_0x5d3ce5(0x1c76)+_0x3b4c3f[_0x5d3ce5(0xbfc)]+_0x5d3ce5(0xf53);for(const [_0x172cb9,_0x37d470]of Object[_0x5d3ce5(0x230e)](_0x3b4c3f[_0x5d3ce5(0x32b)])){const _0x30e85b=getOptionLabel(_0x172cb9);_0x45600d+=_0x5d3ce5(0x2432)+_0x30e85b+_0x5d3ce5(0x2226)+_0x172cb9+_0x5d3ce5(0x1d9)+_0x40d74a+_0x5d3ce5(0x18a3)+_0x39868b+_0x5d3ce5(0x24db),_0x37d470[_0x5d3ce5(0x900)](_0x19d109=>{const _0x30fa27=_0x5d3ce5;_0x45600d+=_0x30fa27(0x53f)+_0x19d109+'\x22>'+_0x19d109+'</option>';}),_0x45600d+=_0x5d3ce5(0x19aa);}_0x45600d+=_0x5d3ce5(0x24bd)+_0x40d74a+_0x5d3ce5(0x18a3)+_0x39868b+_0x5d3ce5(0xde6),document['body']['insertAdjacentHTML']('beforeend',_0x45600d);}function getOptionLabel(_0x53780c){const _0x4bd897=_0x2cf6d4,_0x2b43c6={'size':'尺寸','color':'颜色','sugar':'糖度','ice':'冰度','spicy':'辣度','flavor':'口味','count':'数量','weight':'重量','type':'类型','storage':'存储','material':'材质','style':'款式','volume':'容量','package':'包装','capacity':'容量','strength':'强度','noodle':'面条','soup':'汤底','ingredients':'配料','ripeness':_0x4bd897(0x6f9),'toppings':'配菜','finish':'质地','series':'系列','model':'型号','chip':'芯片','processor':_0x4bd897(0x2298),'ram':'内存','generation':'代数','switch':'轴体','backlight':'背光','dpi':_0x4bd897(0x1d1f),'power':'功率','resolution':_0x4bd897(0xd6d),'antenna':'天线','speed':'速度','hardness':_0x4bd897(0x21a8),'layers':'层数','function':'功能','coverage':'覆盖面积','filter':'滤网','brightness':'亮度','fit':'版型','sleeve':'袖长','collar':'领型','length':'长度','buckle':'扣子','lens':'镜片','wheels':'轮子','packaging':'包装','handle':'手柄'};return _0x2b43c6[_0x53780c]||_0x53780c;}function confirmAddToCart(_0x5037e3,_0x306f){const _0x385baf=_0x2cf6d4,_0x1aed9a=productsData[_0x5037e3][_0x306f],_0x45639a={};for(const _0x2e0b84 of Object[_0x385baf(0x16c7)](_0x1aed9a[_0x385baf(0x32b)])){const _0x2a6f1a=document[_0x385baf(0x566)](_0x385baf(0xecb)+_0x2e0b84);_0x2a6f1a&&(_0x45639a[_0x2e0b84]=_0x2a6f1a[_0x385baf(0xc34)]);}const _0x56a2ab=shoppingCart['findIndex'](_0x478195=>_0x478195['name']===_0x1aed9a[_0x385baf(0x222f)]&&_0x478195[_0x385baf(0x5bb)]===_0x1aed9a[_0x385baf(0x5bb)]&&JSON[_0x385baf(0x7fb)](_0x478195[_0x385baf(0xebe)])===JSON[_0x385baf(0x7fb)](_0x45639a));if(_0x56a2ab!==-0x1)shoppingCart[_0x56a2ab]['quantity']+=0x1;else{const _0x3e525a=getProductPrice(_0x1aed9a,_0x45639a),_0x1014d1={'name':_0x1aed9a[_0x385baf(0x222f)],'brand':_0x1aed9a['brand'],'price':_0x3e525a,'category':_0x5037e3,'selectedOptions':_0x45639a,'quantity':0x1};shoppingCart['push'](_0x1014d1);}updateCartBadge(getTotalCartItems()),closeProductOptions();const _0x11579d=Object[_0x385baf(0x230e)](_0x45639a)['map'](([_0x576920,_0x35d883])=>getOptionLabel(_0x576920)+':\x20'+_0x35d883)[_0x385baf(0x140c)](',\x20'),_0x7d7e62=_0x11579d?'\x20('+_0x11579d+')':'';showCustomToast(''+_0x1aed9a[_0x385baf(0x222f)]+_0x7d7e62+_0x385baf(0x1855),_0x385baf(0xb27));}function closeProductOptions(_0x3b0eff){const _0x462660=_0x2cf6d4;if(_0x3b0eff&&_0x3b0eff['target']!==_0x3b0eff[_0x462660(0x52b)])return;const _0x49e7c0=document[_0x462660(0x15b8)](_0x462660(0x182b));_0x49e7c0&&_0x49e7c0['remove']();}function addCustomItem(){showCustomItemModal();}function showCustomItemModal(){const _0x425330=_0x2cf6d4,_0x465ebf=document[_0x425330(0x566)]('custom-item-modal'),_0x52c3ca=document[_0x425330(0x566)](_0x425330(0x12e1)),_0x4af956=document['getElementById']('custom-item-description'),_0x24356d=document['getElementById'](_0x425330(0x323));_0x52c3ca[_0x425330(0xc34)]='',_0x4af956[_0x425330(0xc34)]='',_0x24356d[_0x425330(0xc34)]='',_0x465ebf[_0x425330(0x655)][_0x425330(0x2526)]=_0x425330(0x1f0b),setTimeout(()=>{const _0x58c51e=_0x425330;_0x52c3ca[_0x58c51e(0x1b12)]();},0x64);}function hideCustomItemModal(_0x22068f){const _0x473bc8=_0x2cf6d4;if(_0x22068f&&_0x22068f[_0x473bc8(0x1144)]!==_0x22068f[_0x473bc8(0x52b)])return;const _0x1389a1=document[_0x473bc8(0x566)]('custom-item-modal');_0x1389a1[_0x473bc8(0x655)][_0x473bc8(0x2526)]='none';}function confirmAddCustomItem(){const _0x243cf0=_0x2cf6d4,_0x49b381=document[_0x243cf0(0x566)](_0x243cf0(0x12e1)),_0x59c69a=document[_0x243cf0(0x566)](_0x243cf0(0x1bb4)),_0xafe9bc=document[_0x243cf0(0x566)](_0x243cf0(0x323)),_0x29b3c3=_0x49b381[_0x243cf0(0xc34)][_0x243cf0(0x1424)](),_0x7b9d04=_0x59c69a[_0x243cf0(0xc34)][_0x243cf0(0x1424)](),_0x2065c8=_0xafe9bc[_0x243cf0(0xc34)][_0x243cf0(0x1424)]();if(!_0x29b3c3){showCustomToast(_0x243cf0(0x1f76),_0x243cf0(0x24ab)),_0x49b381[_0x243cf0(0x1b12)]();return;}if(!_0x2065c8||isNaN(_0x2065c8)||parseFloat(_0x2065c8)<=0x0){showCustomToast('请输入有效的价格',_0x243cf0(0x24ab)),_0xafe9bc['focus']();return;}const _0x2a630a=shoppingCart[_0x243cf0(0x23ba)](_0x1a8274=>_0x1a8274[_0x243cf0(0x222f)]===_0x29b3c3&&_0x1a8274[_0x243cf0(0x5bb)]==='自定义');if(_0x2a630a!==-0x1)shoppingCart[_0x2a630a][_0x243cf0(0x20dd)]+=0x1;else{const _0x416474={'name':_0x29b3c3,'brand':'自定义','description':_0x7b9d04||'','unit':'','price':parseFloat(_0x2065c8),'category':_0x243cf0(0x1b6c),'selectedOptions':{},'quantity':0x1};shoppingCart[_0x243cf0(0x6ee)](_0x416474);}updateCartBadge(getTotalCartItems()),showCustomToast(_0x29b3c3+_0x243cf0(0x1855),'success'),hideCustomItemModal();}function handleCustomItemKeydown(_0xd26e0f){const _0x133bc6=_0x2cf6d4;if(_0xd26e0f['key']===_0x133bc6(0x165c))_0xd26e0f['preventDefault'](),confirmAddCustomItem();else _0xd26e0f[_0x133bc6(0x157f)]===_0x133bc6(0x1cdd)&&(_0xd26e0f[_0x133bc6(0x4d9)](),hideCustomItemModal());}let previousScreenBeforeCart=_0x2cf6d4(0xdd6),previousScreenBeforeShopping=_0x2cf6d4(0xa76),selectedPaymentMethod='self_pay';function openShoppingScreen(){const _0x1ffdbe=_0x2cf6d4,_0x562397=document['querySelector'](_0x1ffdbe(0x1f2e));_0x562397&&(previousScreenBeforeShopping=_0x562397['id']),showApp(_0x1ffdbe(0xdd6)),switchShoppingTab(_0x1ffdbe(0x1a2));}function openShoppingCart(){const _0x53fa53=_0x2cf6d4,_0x4213a5=document['querySelector']('.app-screen:not([style*=\x22display:\x20none\x22])');_0x4213a5&&(previousScreenBeforeCart=_0x4213a5['id']),showApp(_0x53fa53(0x1cf9)),renderShoppingCart();}function renderShoppingCart(){const _0x1b46fa=_0x2cf6d4,_0x8c2eaa=document['getElementById'](_0x1b46fa(0x658)),_0x497e22=document['getElementById']('cart-empty-state'),_0x28f1d9=document[_0x1b46fa(0x566)](_0x1b46fa(0x1854)),_0xb5bfd5=document[_0x1b46fa(0x566)](_0x1b46fa(0x277)),_0x3b23dd=document[_0x1b46fa(0x566)]('cart-items-count');if(shoppingCart['length']===0x0){_0x8c2eaa['style'][_0x1b46fa(0x2526)]=_0x1b46fa(0xfe9),_0x497e22[_0x1b46fa(0x655)][_0x1b46fa(0x2526)]=_0x1b46fa(0x1f0b),_0x28f1d9[_0x1b46fa(0x655)][_0x1b46fa(0x2526)]=_0x1b46fa(0xfe9);return;}_0x8c2eaa[_0x1b46fa(0x655)][_0x1b46fa(0x2526)]=_0x1b46fa(0x2d4),_0x497e22[_0x1b46fa(0x655)][_0x1b46fa(0x2526)]='none',_0x28f1d9[_0x1b46fa(0x655)][_0x1b46fa(0x2526)]='block',_0x8c2eaa['innerHTML']='';let _0xe92b95=0x0,_0x39264d=0x0;shoppingCart[_0x1b46fa(0x900)]((_0x273642,_0x4aef22)=>{const _0x435fb5=_0x1b46fa,_0x162469=_0x273642[_0x435fb5(0xbfc)]*_0x273642['quantity'];_0xe92b95+=_0x162469,_0x39264d+=_0x273642[_0x435fb5(0x20dd)];const _0x10bee7=Object[_0x435fb5(0x230e)](_0x273642[_0x435fb5(0xebe)]||{})['map'](([_0xd61c27,_0xf07c1b])=>getOptionLabel(_0xd61c27)+':\x20'+_0xf07c1b)[_0x435fb5(0x140c)](',\x20');let _0x3f9886=_0x273642['brand'];_0x273642[_0x435fb5(0x5bb)]!==_0x435fb5(0x1b6c)&&_0x273642[_0x435fb5(0x21bb)]&&(_0x3f9886+=_0x435fb5(0x792)+_0x273642['unit']);const _0x96f5ca=_0x435fb5(0x1730)+_0x273642['name']+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22cart-item-brand\x22>'+_0x3f9886+_0x435fb5(0x136d)+(_0x273642[_0x435fb5(0x1c6f)]?_0x435fb5(0x2120)+_0x273642[_0x435fb5(0x1c6f)]+_0x435fb5(0xa54):'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x10bee7?'<div\x20class=\x22cart-item-options\x22>'+_0x10bee7+_0x435fb5(0xa54):'')+_0x435fb5(0xcf5)+_0x4aef22+_0x435fb5(0x199f)+_0x162469[_0x435fb5(0x3cd)](0x2)+_0x435fb5(0x1197)+_0x4aef22+',\x20'+(_0x273642[_0x435fb5(0x20dd)]-0x1)+_0x435fb5(0x247d)+(_0x273642[_0x435fb5(0x20dd)]<=0x1?_0x435fb5(0x194e):'')+_0x435fb5(0xf66)+_0x273642['quantity']+_0x435fb5(0x4db)+_0x4aef22+',\x20'+(_0x273642[_0x435fb5(0x20dd)]+0x1)+_0x435fb5(0xf28);_0x8c2eaa[_0x435fb5(0xc02)]+=_0x96f5ca;}),_0xb5bfd5[_0x1b46fa(0x21dc)]='¥'+_0xe92b95[_0x1b46fa(0x3cd)](0x2),_0x3b23dd[_0x1b46fa(0x21dc)]=_0x39264d;}function removeFromCart(_0x3aef69){const _0x3bbaf4=_0x2cf6d4,_0x41d54c=shoppingCart[_0x3aef69],_0x2917dc=_0x41d54c?_0x41d54c[_0x3bbaf4(0x222f)]:'商品';showCustomConfirm(_0x3bbaf4(0x2c1),_0x3bbaf4(0x1ab8)+_0x2917dc+'\x22\x20吗？',()=>{const _0x55b021=_0x3bbaf4;shoppingCart['splice'](_0x3aef69,0x1),renderShoppingCart(),updateCartBadge(getTotalCartItems()),showCustomToast(_0x55b021(0x7a9),'success');});}function updateCartItemQuantity(_0x10056f,_0x58d277){if(_0x58d277<=0x0){removeFromCart(_0x10056f);return;}shoppingCart[_0x10056f]['quantity']=_0x58d277,renderShoppingCart(),updateCartBadge(getTotalCartItems());}function clearShoppingCart(){const _0x5a4b42=_0x2cf6d4;if(shoppingCart[_0x5a4b42(0xcbf)]===0x0)return;const _0x2417b1=getTotalCartItems();showCustomConfirm(_0x5a4b42(0x628),_0x5a4b42(0xeab)+_0x2417b1+_0x5a4b42(0x114c),()=>{shoppingCart=[],renderShoppingCart(),updateCartBadge(0x0),showCustomToast('购物车已清空','success');});}function getTotalCartItems(){const _0x225cb8=_0x2cf6d4;return shoppingCart[_0x225cb8(0x14f5)]((_0x495a55,_0x1f20a7)=>_0x495a55+_0x1f20a7[_0x225cb8(0x20dd)],0x0);}function requestPayment(){showRecipientModal('request_pay');}function showRecipientModal(_0x85168e){const _0x4fdf1d=_0x2cf6d4;if(shoppingCart[_0x4fdf1d(0xcbf)]===0x0){showCustomToast(_0x4fdf1d(0x17b0),'error');return;}if(!currentChatCharacter){showCustomToast(_0x4fdf1d(0xe66),_0x4fdf1d(0x24ab));return;}selectedPaymentMethod=_0x85168e;const _0x495daa=shoppingCart[_0x4fdf1d(0x14f5)]((_0x5a8e8a,_0x18febf)=>_0x5a8e8a+_0x18febf[_0x4fdf1d(0xbfc)]*_0x18febf['quantity'],0x0),_0x464807=getTotalCartItems();document[_0x4fdf1d(0x566)](_0x4fdf1d(0x1adb))[_0x4fdf1d(0x21dc)]='¥'+_0x495daa[_0x4fdf1d(0x3cd)](0x2),document['getElementById']('payment-modal-items-count')[_0x4fdf1d(0x21dc)]=_0x464807,document[_0x4fdf1d(0x566)](_0x4fdf1d(0x23f4))[_0x4fdf1d(0x655)][_0x4fdf1d(0x2526)]='flex';}function proceedToCheckout(){showRecipientModal('self_pay');}function handleShoppingCartBack(){hideApp('shopping-cart-screen'),showApp(previousScreenBeforeCart);}function hidePaymentRequestModal(_0x20a485){const _0x1b4159=_0x2cf6d4;if(_0x20a485&&_0x20a485['target']!==_0x20a485['currentTarget'])return;document[_0x1b4159(0x566)]('payment-request-modal')[_0x1b4159(0x655)][_0x1b4159(0x2526)]='none';}function processOrder(_0x303b28){const _0x3a7cfd=_0x2cf6d4,_0x1e1b63=shoppingCart['reduce']((_0x32f7b8,_0x540ba5)=>_0x32f7b8+_0x540ba5[_0x3a7cfd(0xbfc)]*_0x540ba5[_0x3a7cfd(0x20dd)],0x0),_0x44bc1e=getTotalCartItems(),_0x571662=generateOrderDetails();hidePaymentRequestModal(),_0x303b28==='for_self'?selectedPaymentMethod==='self_pay'?(showCustomToast(_0x3a7cfd(0x18de),'info',0x3e8),setTimeout(()=>{const _0x27db3f=_0x3a7cfd;sendOrderMessage(_0x571662,'self_pay_self'),clearShoppingCart(),showCustomToast(_0x27db3f(0x952)+_0x1e1b63[_0x27db3f(0x3cd)](0x2),_0x27db3f(0xb27)),setTimeout(()=>handleShoppingCartBack(),0x3e8);},0x5dc)):(sendPaymentRequestMessage(_0x571662,_0x3a7cfd(0x2448)),showCustomToast('已发送代付请求给\x20'+currentChatCharacter[_0x3a7cfd(0x222f)],_0x3a7cfd(0xb27)),clearShoppingCart(),setTimeout(()=>handleShoppingCartBack(),0x3e8)):selectedPaymentMethod==='self_pay'?(showCustomToast(_0x3a7cfd(0x1698)+currentChatCharacter[_0x3a7cfd(0x222f)]+_0x3a7cfd(0x31b),_0x3a7cfd(0x2422)),setTimeout(()=>{const _0x5451b3=_0x3a7cfd;sendOrderMessage(_0x571662,'self_pay_ta'),clearShoppingCart(),showCustomToast(_0x5451b3(0x11f1)+currentChatCharacter[_0x5451b3(0x222f)]+_0x5451b3(0x19e),_0x5451b3(0xb27)),setTimeout(()=>handleShoppingCartBack(),0x3e8);},0x5dc)):(sendPaymentRequestMessage(_0x571662,_0x3a7cfd(0x870)),showCustomToast(_0x3a7cfd(0x2199)+currentChatCharacter[_0x3a7cfd(0x222f)],_0x3a7cfd(0xb27)),clearShoppingCart(),setTimeout(()=>handleShoppingCartBack(),0x3e8));}function generateOrderDetails(){const _0x353a71=_0x2cf6d4,_0x50e3f1=shoppingCart[_0x353a71(0x14f5)]((_0x3e3ba3,_0x4a6184)=>_0x3e3ba3+_0x4a6184[_0x353a71(0xbfc)]*_0x4a6184[_0x353a71(0x20dd)],0x0),_0x53db69=getTotalCartItems(),_0x54e4a3='SP'+Date['now']()[_0x353a71(0x9a3)]()[_0x353a71(0x136)](-0x8);return{'orderNumber':_0x54e4a3,'items':[...shoppingCart],'total':_0x50e3f1,'itemsCount':_0x53db69,'timestamp':Date[_0x353a71(0x18e0)]()};}function sendPaymentRequestMessage(_0x3ed442,_0x1c1b2a){const _0x3aee29=_0x2cf6d4;if(!currentChatCharacter)return;const _0x34ff22=_0x3ed442[_0x3aee29(0x24ef)][_0x3aee29(0xf6d)](_0x4c88eb=>_0x3aee29(0x79e)+_0x4c88eb[_0x3aee29(0x222f)]+_0x3aee29(0xc16)+(_0x4c88eb[_0x3aee29(0xbfc)]*_0x4c88eb[_0x3aee29(0x20dd)])[_0x3aee29(0x3cd)](0x2)+_0x3aee29(0xff4))['join'](''),_0x53b4ce=_0x1c1b2a===_0x3aee29(0x2448)?_0x3aee29(0xb14):currentChatCharacter['name'],_0x44d820=_0x1c1b2a===_0x3aee29(0x2448)?_0x3aee29(0x1f10):_0x3aee29(0x2246),_0x399017=_0x1c1b2a[_0x3aee29(0xd7e)](_0x3aee29(0x155b))?'我':currentChatCharacter?.['name']||'用户',_0xf44f2b=_0x1c1b2a[_0x3aee29(0xd7e)](_0x3aee29(0x155b))?currentChatCharacter?.[_0x3aee29(0x222f)]||_0x3aee29(0x1bee):'我',_0x237e95=_0x1c1b2a['endsWith'](_0x3aee29(0x155b));let _0x979ac1;_0x237e95&&(_0x979ac1='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-request-user-card\x22\x20data-order-id=\x22'+_0x3ed442[_0x3aee29(0x4de)]+_0x3aee29(0x165f)+_0x3ed442[_0x3aee29(0x1dbe)]['toFixed'](0x2)+_0x3aee29(0x1c9c)+_0x3ed442['orderNumber']+'\x22>15:00</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22payment-request-details-btn\x22\x20onclick=\x22showPaymentDetails(\x27'+_0x3ed442[_0x3aee29(0x4de)]+_0x3aee29(0x509),setTimeout(()=>{const _0x2cd2f9=_0x3aee29;startPaymentCountdown(_0x3ed442[_0x2cd2f9(0x4de)]);},0x64));const _0xfd8a11={'id':Date[_0x3aee29(0x18e0)](),'content':_0x979ac1,'sender':_0x3aee29(0xfda),'timestamp':Date[_0x3aee29(0x18e0)](),'type':'payment_request','orderDetails':_0x3ed442,'orderType':_0x1c1b2a,'paymentStatus':null,'paidBy':null,'rejectedBy':null};addMessageToChat(_0xfd8a11),window[_0x3aee29(0xfde)]=window[_0x3aee29(0xfde)]||{};}function startPaymentCountdown(_0x14b4fe){const _0x587555=_0x2cf6d4;window['paymentCountdowns']&&window[_0x587555(0xfde)][_0x14b4fe]&&clearInterval(window[_0x587555(0xfde)][_0x14b4fe]);let _0x7dc56a=0xf*0x3c;const _0x40e347=document['getElementById'](_0x587555(0x94b)+_0x14b4fe);if(!_0x40e347)return;const _0x3c2746=setInterval(()=>{const _0x31fd3d=_0x587555,_0x5bbef1=Math[_0x31fd3d(0x1dac)](_0x7dc56a/0x3c),_0x3b6bb5=_0x7dc56a%0x3c,_0x46539c=_0x5bbef1[_0x31fd3d(0x9a3)]()[_0x31fd3d(0x863)](0x2,'0')+':'+_0x3b6bb5['toString']()[_0x31fd3d(0x863)](0x2,'0');_0x40e347[_0x31fd3d(0x21dc)]=_0x46539c;if(_0x7dc56a<=0x0){clearInterval(_0x3c2746),_0x40e347['textContent']='已超时',_0x40e347[_0x31fd3d(0x655)]['background']='#ff4444';const _0x3edec7=_0x40e347[_0x31fd3d(0x2026)](_0x31fd3d(0x2359))[_0x31fd3d(0x15b8)](_0x31fd3d(0x1b7));_0x3edec7&&(_0x3edec7[_0x31fd3d(0x194e)]=!![],_0x3edec7[_0x31fd3d(0x21dc)]=_0x31fd3d(0xbda),_0x3edec7[_0x31fd3d(0x655)]['opacity']=_0x31fd3d(0x1ffd)),delete window[_0x31fd3d(0xfde)][_0x14b4fe];}_0x7dc56a--;},0x3e8);window[_0x587555(0xfde)]=window[_0x587555(0xfde)]||{},window[_0x587555(0xfde)][_0x14b4fe]=_0x3c2746;}async function processPaymentRequestResponse(_0x36a7d2,_0x30561a,_0x8c27f3){const _0x1c500b=_0x2cf6d4;console[_0x1c500b(0xc0d)](_0x1c500b(0x54f),{'paymentMessage':_0x36a7d2,'aiMessages':_0x30561a,'characterId':_0x8c27f3});let _0x4270d2='';for(const _0x3d4d9b of _0x30561a){if(typeof _0x3d4d9b===_0x1c500b(0xb97))_0x4270d2+=_0x3d4d9b+'\x20';else typeof _0x3d4d9b===_0x1c500b(0x3c4)&&_0x3d4d9b[_0x1c500b(0x1423)]&&(_0x4270d2+=_0x3d4d9b[_0x1c500b(0x1423)]+'\x20');}_0x4270d2=_0x4270d2[_0x1c500b(0x1424)](),console['log']('🛒\x20[代付响应处理]\x20AI完整回复内容:',_0x4270d2);const _0x3a3593=[_0x1c500b(0x18eb),'我付',_0x1c500b(0xb78),'我帮你付','我帮你买',_0x1c500b(0xc9a),_0x1c500b(0x991),_0x1c500b(0x3fc),_0x1c500b(0x272),_0x1c500b(0x1e96),_0x1c500b(0x4c2),'我来结账',_0x1c500b(0x41f),_0x1c500b(0x4d0),_0x1c500b(0x11ea),'我给你付款',_0x1c500b(0x1209),'我来付款',_0x1c500b(0x971),_0x1c500b(0x2fb),'我替你买',_0x1c500b(0x17f9),_0x1c500b(0x15e2),_0x1c500b(0x13f8),_0x1c500b(0x9b6),_0x1c500b(0x1d04),_0x1c500b(0x1655),'我来给钱',_0x1c500b(0xbf9),_0x1c500b(0xa2a),_0x1c500b(0x4dc),'我来购买',_0x1c500b(0x393),_0x1c500b(0x1992),'我结账','我来结账',_0x1c500b(0x3ef),_0x1c500b(0x1d1),_0x1c500b(0x559),_0x1c500b(0x1165),_0x1c500b(0x21f1),_0x1c500b(0x85e),_0x1c500b(0xfc0),_0x1c500b(0x1500),_0x1c500b(0x14cd),_0x1c500b(0x1b7b),_0x1c500b(0x105f),_0x1c500b(0x1c36),_0x1c500b(0x1992),'我替你下单',_0x1c500b(0x98b),_0x1c500b(0x1d4a),_0x1c500b(0x1c4b),'我来购买',_0x1c500b(0x126e),_0x1c500b(0x1ec4),_0x1c500b(0xbf7)],_0x30eae9=['不付','不买',_0x1c500b(0x1774),_0x1c500b(0x1001),_0x1c500b(0x2220),_0x1c500b(0xa72),_0x1c500b(0xa49),_0x1c500b(0x1df4),_0x1c500b(0x1e7a),'不给钱',_0x1c500b(0x1444),_0x1c500b(0x7c2),_0x1c500b(0x2c3),_0x1c500b(0xec1),_0x1c500b(0x24e3),_0x1c500b(0x205e),_0x1c500b(0x2481),_0x1c500b(0xae0),_0x1c500b(0x18cd),_0x1c500b(0x8d5),'拒绝买单',_0x1c500b(0x1187),_0x1c500b(0xf19),_0x1c500b(0x1368),_0x1c500b(0x2150),_0x1c500b(0x16e2),_0x1c500b(0x12d6),_0x1c500b(0xda5),_0x1c500b(0x2416),_0x1c500b(0x1fd4),_0x1c500b(0x11a6),_0x1c500b(0x266),'不愿意下单',_0x1c500b(0x460),_0x1c500b(0x821),_0x1c500b(0x1f5c),_0x1c500b(0x304),_0x1c500b(0x114f),_0x1c500b(0xb95),'不想给钱',_0x1c500b(0x309),_0x1c500b(0x13a4),_0x1c500b(0x984),_0x1c500b(0xb33),'没钱','没有钱',_0x1c500b(0x206e),_0x1c500b(0x11bd),_0x1c500b(0x1f96),_0x1c500b(0x111f),'太贵',_0x1c500b(0x1dcf),'承担不起',_0x1c500b(0x134)],_0x44536e=_0x3a3593['some'](_0x45f435=>_0x4270d2[_0x1c500b(0x23ec)](_0x45f435)),_0x38fca8=_0x30eae9[_0x1c500b(0x184b)](_0xdadfda=>_0x4270d2['includes'](_0xdadfda));console[_0x1c500b(0xc0d)](_0x1c500b(0xe36),{'isAccepted':_0x44536e,'isRejected':_0x38fca8,'fullAiResponse':_0x4270d2[_0x1c500b(0x4b2)](0x0,0x64)+'...'});if(_0x44536e)_0x36a7d2[_0x1c500b(0x20c6)]='paid',_0x36a7d2[_0x1c500b(0x8ce)]=currentChatCharacter?.['name']||'角色',console[_0x1c500b(0xc0d)](_0x1c500b(0x2054)),updatePaymentRequestDisplay(_0x36a7d2['orderDetails'][_0x1c500b(0x4de)],'paid');else _0x38fca8&&(_0x36a7d2['paymentStatus']=_0x1c500b(0x1164),_0x36a7d2[_0x1c500b(0x18e8)]=currentChatCharacter?.[_0x1c500b(0x222f)]||'角色',console['log'](_0x1c500b(0x1e63)),updatePaymentRequestDisplay(_0x36a7d2['orderDetails'][_0x1c500b(0x4de)],_0x1c500b(0x1164)));if(_0x44536e||_0x38fca8)try{const _0x430ad8=chatMessages[_0x8c27f3]['findIndex'](_0x5f3bea=>_0x5f3bea['orderDetails']&&_0x5f3bea['orderDetails'][_0x1c500b(0x4de)]===_0x36a7d2[_0x1c500b(0x103c)]['orderNumber']);if(_0x430ad8!==-0x1){const _0x48dc45=_0x8c27f3+'_'+_0x36a7d2['id']+'_'+_0x430ad8;await db[_0x1c500b(0x464)][_0x1c500b(0x53a)]({'id':_0x48dc45,'characterId':_0x8c27f3,'timestamp':_0x36a7d2[_0x1c500b(0x7aa)],'messageOrder':_0x430ad8,'originalMessageId':_0x36a7d2['id'],'messageData':_0x36a7d2}),console['log'](_0x1c500b(0x96e));}else console[_0x1c500b(0x17cc)](_0x1c500b(0xe3f));}catch(_0xcb5ce2){console['error'](_0x1c500b(0x21b3),_0xcb5ce2),await saveChatMessagesImmediate();}}function generatePaymentRequestContent(_0x307475){const _0x39f9c0=_0x2cf6d4,_0xcadc52=_0x307475[_0x39f9c0(0x103c)],_0x399f7c=_0x307475[_0x39f9c0(0x20c6)];if(!_0xcadc52)return _0x307475['content'];let _0x2e3e62='';if(_0x399f7c===_0x39f9c0(0x46e))_0x2e3e62=_0x39f9c0(0x186)+_0xcadc52[_0x39f9c0(0x1dbe)][_0x39f9c0(0x3cd)](0x2)+_0x39f9c0(0x1b0b)+_0xcadc52[_0x39f9c0(0x4de)]+_0x39f9c0(0x392);else _0x399f7c==='rejected'?_0x2e3e62=_0x39f9c0(0x186)+_0xcadc52['total']['toFixed'](0x2)+_0x39f9c0(0x2487)+_0xcadc52[_0x39f9c0(0x4de)]+_0x39f9c0(0x392):_0x2e3e62='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-request-user-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-request-amount-label\x22>需付款</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-request-amount-value\x22>¥'+_0xcadc52[_0x39f9c0(0x1dbe)][_0x39f9c0(0x3cd)](0x2)+_0x39f9c0(0x1374)+_0xcadc52['orderNumber']+'\x22>15:00</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22payment-request-details-btn\x22\x20onclick=\x22showPaymentDetails(\x27'+_0xcadc52['orderNumber']+'\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20查看详情\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';const _0x201f96=_0x39f9c0(0x62d)+_0xcadc52[_0x39f9c0(0x4de)]+_0x39f9c0(0x1290)+_0x2e3e62+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';return!_0x399f7c&&setTimeout(()=>{const _0x5d0eea=_0x39f9c0;startPaymentCountdown(_0xcadc52[_0x5d0eea(0x4de)]);},0x64),_0x201f96;}function updatePaymentRequestDisplay(_0x3f3be5,_0x369ac5){const _0x19ae81=_0x2cf6d4;console[_0x19ae81(0xc0d)](_0x19ae81(0x118c),{'orderNumber':_0x3f3be5,'status':_0x369ac5});const _0x363771=document['querySelector'](_0x19ae81(0xf5)+_0x3f3be5+'\x22]');if(!_0x363771){console['log'](_0x19ae81(0x1488),_0x3f3be5);return;}window[_0x19ae81(0xfde)]&&window[_0x19ae81(0xfde)][_0x3f3be5]&&(clearInterval(window[_0x19ae81(0xfde)][_0x3f3be5]),delete window[_0x19ae81(0xfde)][_0x3f3be5]);const _0x3e0a3e=chatMessages[currentChatCharacter?.['id']]||[];let _0x213096=null;for(const _0x5d3a0d of _0x3e0a3e){if(_0x5d3a0d[_0x19ae81(0x23df)]===_0x19ae81(0x674)&&_0x5d3a0d[_0x19ae81(0x103c)]&&_0x5d3a0d[_0x19ae81(0x103c)]['orderNumber']===_0x3f3be5){_0x213096=_0x5d3a0d['orderDetails'];break;}}if(!_0x213096){console[_0x19ae81(0xc0d)]('🛒\x20[界面更新]\x20未找到订单详情');return;}let _0x49d6f2='';if(_0x369ac5===_0x19ae81(0x46e))_0x49d6f2=_0x19ae81(0x186)+_0x213096[_0x19ae81(0x1dbe)]['toFixed'](0x2)+_0x19ae81(0x1b0b)+_0x3f3be5+_0x19ae81(0x392);else _0x369ac5===_0x19ae81(0x1164)&&(_0x49d6f2=_0x19ae81(0x186)+_0x213096[_0x19ae81(0x1dbe)][_0x19ae81(0x3cd)](0x2)+_0x19ae81(0x2487)+_0x3f3be5+_0x19ae81(0x392));_0x363771['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-request-user-title\x22>发起订单代付请求</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x49d6f2+_0x19ae81(0xc9d),console[_0x19ae81(0xc0d)](_0x19ae81(0x13b0));}function showPaymentDetails(_0x42bfbb){const _0x1c69ce=_0x2cf6d4;let _0x5afd8e=null;const _0x462fb1=chatMessages[currentChatCharacter?.['id']]||[];for(const _0x2b4bda of _0x462fb1){if(_0x2b4bda[_0x1c69ce(0x23df)]===_0x1c69ce(0x674)&&_0x2b4bda['orderDetails']&&_0x2b4bda[_0x1c69ce(0x103c)]['orderNumber']===_0x42bfbb){_0x5afd8e=_0x2b4bda['orderDetails'];break;}}if(!_0x5afd8e){alert(_0x1c69ce(0x86f));return;}const _0x3feb0a=_0x5afd8e[_0x1c69ce(0x24ef)]['map'](_0xfafc70=>{const _0x10f310=_0x1c69ce;let _0x2e7f8a=_0xfafc70[_0x10f310(0x222f)]+'\x20x'+_0xfafc70[_0x10f310(0x20dd)];if(_0xfafc70[_0x10f310(0xebe)]&&Object[_0x10f310(0x16c7)](_0xfafc70[_0x10f310(0xebe)])[_0x10f310(0xcbf)]>0x0){const _0x35eca6=Object[_0x10f310(0x230e)](_0xfafc70[_0x10f310(0xebe)])[_0x10f310(0xf6d)](([_0x2018f9,_0x1e8bb9])=>getOptionLabel(_0x2018f9)+':\x20'+_0x1e8bb9)[_0x10f310(0x140c)](',\x20');_0x2e7f8a+='<br><small\x20style=\x22color:\x20#666;\x20font-size:\x2012px;\x22>'+_0x35eca6+_0x10f310(0x2fa);}return _0x10f310(0x1bbf)+_0x2e7f8a+_0x10f310(0x917)+(_0xfafc70[_0x10f310(0xbfc)]*_0xfafc70[_0x10f310(0x20dd)])[_0x10f310(0x3cd)](0x2)+_0x10f310(0x1c88);})['join']('');window['closePaymentModal']=function(){const _0x5be8e6=_0x1c69ce,_0xe96e56=document['getElementById'](_0x5be8e6(0x1626));_0xe96e56&&(_0xe96e56['style']['display']=_0x5be8e6(0xfe9));};const _0x443a6e=_0x1c69ce(0xb74)+_0x5afd8e[_0x1c69ce(0x4de)]+_0x1c69ce(0xdba)+_0x3feb0a+_0x1c69ce(0x17bd)+_0x5afd8e[_0x1c69ce(0x1dbe)][_0x1c69ce(0x3cd)](0x2)+_0x1c69ce(0xb38);let _0x1a525b=document['getElementById'](_0x1c69ce(0x1626));!_0x1a525b&&(_0x1a525b=document[_0x1c69ce(0x1ad8)](_0x1c69ce(0x526)),_0x1a525b['id']=_0x1c69ce(0x1626),_0x1a525b[_0x1c69ce(0x221)]=_0x1c69ce(0x269),document[_0x1c69ce(0x172c)][_0x1c69ce(0x1925)](_0x1a525b)),_0x1a525b[_0x1c69ce(0xc02)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x443a6e+_0x1c69ce(0x897),_0x1a525b['onclick']=function(_0x3303d8){const _0x40a0a5=_0x1c69ce;_0x3303d8[_0x40a0a5(0x1144)]===_0x1a525b&&window[_0x40a0a5(0x16af)]();},_0x1a525b[_0x1c69ce(0x655)][_0x1c69ce(0x2526)]='flex';}function sendOrderMessage(_0x46f664,_0x439e51){const _0x56f4c1=_0x2cf6d4;if(!currentChatCharacter)return;const _0x34f94f=_0x46f664['items'][_0x56f4c1(0xf6d)](_0x315e5a=>{const _0x4c609b=_0x56f4c1;let _0x2430d6=_0x315e5a['name']+'\x20x'+_0x315e5a[_0x4c609b(0x20dd)];if(_0x315e5a[_0x4c609b(0xebe)]&&Object[_0x4c609b(0x16c7)](_0x315e5a[_0x4c609b(0xebe)])[_0x4c609b(0xcbf)]>0x0){const _0x588247=Object[_0x4c609b(0x230e)](_0x315e5a[_0x4c609b(0xebe)])[_0x4c609b(0xf6d)](([_0x2b8efc,_0xfd4712])=>getOptionLabel(_0x2b8efc)+':\x20'+_0xfd4712)['join'](',\x20');_0x2430d6+='\x20('+_0x588247+')';}return _0x2430d6;})['join']('、');let _0x3a8d53='订单确认';const _0xd4ba4e={'id':Date[_0x56f4c1(0x18e0)](),'content':_0x3a8d53,'sender':'sent','timestamp':Date[_0x56f4c1(0x18e0)](),'type':_0x56f4c1(0x8fa),'orderDetails':_0x46f664,'orderType':_0x439e51};addMessageToChat(_0xd4ba4e);}function showCustomToast(_0x476250,_0x46a6af=_0x2cf6d4(0xbf),_0x1ab74a=0x5dc){const _0x104565=_0x2cf6d4,_0x53503b=document[_0x104565(0x15b8)](_0x104565(0x60f));_0x53503b&&_0x53503b[_0x104565(0x128)]();const _0x138d81=document[_0x104565(0x1ad8)](_0x104565(0x526));_0x138d81['className']=_0x104565(0x2459)+_0x46a6af,_0x138d81[_0x104565(0x21dc)]=_0x476250,document[_0x104565(0x172c)][_0x104565(0x1925)](_0x138d81),setTimeout(()=>{const _0x57ced4=_0x104565;_0x138d81[_0x57ced4(0xe9)]&&(_0x138d81['classList'][_0x57ced4(0xe1)](_0x57ced4(0x1f05)),setTimeout(()=>{const _0x588df3=_0x57ced4;_0x138d81[_0x588df3(0xe9)]&&_0x138d81[_0x588df3(0x128)]();},0x12c));},_0x1ab74a);}function generateAIOrderConfirmationContent(_0x2aab77){const _0x115e25=_0x2cf6d4,_0x5beb99=_0x2aab77[_0x115e25(0x103c)],_0x3368f8=_0x2aab77[_0x115e25(0x87a)];if(!_0x5beb99)return _0x115e25(0x8d1)+_0x2aab77[_0x115e25(0x1423)]+_0x115e25(0xa54);const _0x5d8513=_0x5beb99[_0x115e25(0x24ef)][_0x115e25(0xf6d)](_0x1475d2=>{const _0x784752=_0x115e25;let _0x1f2460=_0x1475d2[_0x784752(0x222f)]+'\x20x'+_0x1475d2[_0x784752(0x20dd)];if(_0x1475d2[_0x784752(0xebe)]&&Object['keys'](_0x1475d2[_0x784752(0xebe)])['length']>0x0){const _0x5d424b=Object[_0x784752(0x230e)](_0x1475d2[_0x784752(0xebe)])[_0x784752(0xf6d)](([_0x19f4ba,_0x23b78d])=>getOptionLabel(_0x19f4ba)+':\x20'+_0x23b78d)[_0x784752(0x140c)](',\x20');_0x1f2460+='\x20('+_0x5d424b+')';}return _0x784752(0x165e)+_0x1f2460+'\x20<span\x20class=\x22receipt-item-price\x22>¥'+_0x1475d2[_0x784752(0xbfc)]+_0x784752(0xeb9);})[_0x115e25(0x140c)]('');let _0x131215='',_0x2f5be3='';return _0x3368f8===_0x115e25(0xfd3)?(_0x131215='我的订单',_0x2f5be3=_0x115e25(0x1bc)):(_0x131215=_0x115e25(0x2549),_0x2f5be3='📋'),'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22order-confirmation-container\x20ai-order\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-card\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-title\x22>'+_0x2f5be3+'\x20'+_0x131215+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-subtitle\x22>订单支付成功</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-order-number\x22>订单号：'+_0x5beb99[_0x115e25(0x4de)]+_0x115e25(0x16bb)+_0x5d8513+_0x115e25(0x17e)+_0x5beb99[_0x115e25(0x1dbe)][_0x115e25(0x3cd)](0x2)+_0x115e25(0x703)+new Date(_0x5beb99['timestamp'])['toLocaleString']()+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thank-you\x22>感谢购买！</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';}function getProductPrice(_0x405c26,_0x4ee5a1={}){const _0x38acb5=_0x2cf6d4;if(!_0x405c26[_0x38acb5(0x728)])return _0x405c26[_0x38acb5(0xbfc)];for(const [_0x1d1657,_0x33356a]of Object[_0x38acb5(0x230e)](_0x4ee5a1)){if(_0x405c26[_0x38acb5(0x728)][_0x1d1657]&&_0x405c26[_0x38acb5(0x728)][_0x1d1657][_0x33356a]!==undefined)return _0x405c26[_0x38acb5(0x728)][_0x1d1657][_0x33356a];}return _0x405c26[_0x38acb5(0xbfc)];}function updateProductPrice(_0x2e1819,_0x38b79c){const _0x51a606=_0x2cf6d4,_0x464203=productsData[_0x2e1819][_0x38b79c],_0x5b22ab={};for(const _0x370ece of Object[_0x51a606(0x16c7)](_0x464203[_0x51a606(0x32b)])){const _0x52724f=document['getElementById'](_0x51a606(0xecb)+_0x370ece);_0x52724f&&(_0x5b22ab[_0x370ece]=_0x52724f[_0x51a606(0xc34)]);}const _0x54cbe1=getProductPrice(_0x464203,_0x5b22ab),_0x1f785d=document['getElementById'](_0x51a606(0x54e));_0x1f785d&&(_0x1f785d[_0x51a606(0x21dc)]='¥'+_0x54cbe1);}function showCustomConfirm(_0x48d061,_0x18785a,_0x31955f,_0x142304){const _0x35b86d=_0x2cf6d4,_0x5015bd=document[_0x35b86d(0x15b8)](_0x35b86d(0x9d0));_0x5015bd&&_0x5015bd[_0x35b86d(0x128)]();const _0x74f02b=document['createElement'](_0x35b86d(0x526));_0x74f02b[_0x35b86d(0x221)]=_0x35b86d(0xf0d),_0x74f02b[_0x35b86d(0xc02)]=_0x35b86d(0x17a7)+_0x48d061+_0x35b86d(0x1ef2)+_0x18785a+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22custom-confirm-buttons\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22custom-confirm-btn\x20cancel\x22\x20onclick=\x22closeCustomConfirm()\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22custom-confirm-btn\x20confirm\x22\x20onclick=\x22confirmCustomAction()\x22>确定</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',document[_0x35b86d(0x172c)]['appendChild'](_0x74f02b),window[_0x35b86d(0x14ab)]={'onConfirm':_0x31955f||(()=>{}),'onCancel':_0x142304||(()=>{})},_0x74f02b[_0x35b86d(0x167)](_0x35b86d(0x1e62),_0x2caa95=>{const _0x5d1275=_0x35b86d;_0x2caa95[_0x5d1275(0x1144)]===_0x74f02b&&closeCustomConfirm();});}function closeCustomConfirm(){const _0x421084=_0x2cf6d4,_0x1c038d=document['querySelector'](_0x421084(0x9d0));_0x1c038d&&_0x1c038d['remove'](),window[_0x421084(0x14ab)]&&window[_0x421084(0x14ab)]['onCancel']&&window['customConfirmCallbacks'][_0x421084(0x20d9)]();}function confirmCustomAction(){const _0x18927d=_0x2cf6d4,_0x5c38b9=document[_0x18927d(0x15b8)](_0x18927d(0x9d0));_0x5c38b9&&_0x5c38b9['remove'](),window[_0x18927d(0x14ab)]&&window[_0x18927d(0x14ab)][_0x18927d(0x1566)]&&window['customConfirmCallbacks'][_0x18927d(0x1566)]();}function updateCartBadge(_0x581568){const _0xfb510=_0x2cf6d4,_0x45d299=document[_0xfb510(0x566)](_0xfb510(0xe79));_0x45d299&&(_0x581568>0x0?(_0x45d299[_0xfb510(0x21dc)]=_0x581568>0x63?_0xfb510(0x2330):_0x581568[_0xfb510(0x9a3)](),_0x45d299[_0xfb510(0x655)][_0xfb510(0x2526)]=_0xfb510(0x1f0b)):_0x45d299['style'][_0xfb510(0x2526)]=_0xfb510(0xfe9));}function showAppointmentForm(_0x334769=null){const _0x59fddc=_0x2cf6d4;editingAppointmentId=_0x334769;const _0x5e0868=document[_0x59fddc(0x566)]('appointment-form-modal'),_0x5a0b5f=document[_0x59fddc(0x566)](_0x59fddc(0xb28));populateCharacterSelect(_0x59fddc(0x1d9d));if(_0x334769){_0x5a0b5f[_0x59fddc(0x21dc)]='编辑约定';const _0x5833a5=appointments[_0x59fddc(0x1aeb)](_0x2aba84=>_0x2aba84['id']===_0x334769);_0x5833a5&&(document[_0x59fddc(0x566)](_0x59fddc(0x163d))['value']=_0x5833a5[_0x59fddc(0x222f)],document[_0x59fddc(0x566)](_0x59fddc(0x2076))[_0x59fddc(0xc34)]=_0x5833a5[_0x59fddc(0x1c5b)],document['getElementById']('appointment-time')['value']=_0x5833a5[_0x59fddc(0x8e1)]||'',_0x5833a5['customType']?(document[_0x59fddc(0x566)]('appointment-type')[_0x59fddc(0xc34)]=_0x59fddc(0x9dd),document[_0x59fddc(0x566)]('appointment-custom-type')[_0x59fddc(0xc34)]=_0x5833a5[_0x59fddc(0x46c)],toggleCustomTypeInput(_0x59fddc(0xd84))):document['getElementById'](_0x59fddc(0x220d))[_0x59fddc(0xc34)]=_0x5833a5[_0x59fddc(0x23df)],document[_0x59fddc(0x566)](_0x59fddc(0x1d9d))[_0x59fddc(0xc34)]=_0x5833a5['characterId']||'',document[_0x59fddc(0x566)](_0x59fddc(0xe8b))[_0x59fddc(0xc34)]=_0x5833a5['priority']||'medium',document['getElementById'](_0x59fddc(0x3d3))[_0x59fddc(0xc34)]=_0x5833a5[_0x59fddc(0x1c6f)]||'',document[_0x59fddc(0x566)](_0x59fddc(0x149))['value']=_0x5833a5[_0x59fddc(0x229c)]||'',document[_0x59fddc(0x566)](_0x59fddc(0x291))[_0x59fddc(0xc34)]=_0x5833a5[_0x59fddc(0x129a)]||'',document[_0x59fddc(0x566)]('appointment-shared')[_0x59fddc(0x306)]=_0x5833a5[_0x59fddc(0x7e7)]===!![],document['getElementById']('appointment-pinned')['checked']=_0x5833a5[_0x59fddc(0x23bd)]===!![],document[_0x59fddc(0x566)](_0x59fddc(0x211d))[_0x59fddc(0xc34)]=_0x5833a5[_0x59fddc(0x103e)]||_0x59fddc(0xcd4),document[_0x59fddc(0x566)](_0x59fddc(0x1b8e))[_0x59fddc(0x306)]=_0x5833a5['neverExpires']===!![],_0x5833a5[_0x59fddc(0x517)]&&toggleNeverExpires(_0x59fddc(0xd84)),_0x5833a5[_0x59fddc(0x1584)]&&(document[_0x59fddc(0x566)](_0x59fddc(0xbb6))[_0x59fddc(0x107)]=_0x5833a5['backgroundImage'],document['getElementById'](_0x59fddc(0x2a4))[_0x59fddc(0x655)][_0x59fddc(0x2526)]=_0x59fddc(0x2d4)),_0x5833a5[_0x59fddc(0x21cd)]&&(document[_0x59fddc(0x566)]('appointment-user-avatar-img')[_0x59fddc(0x107)]=_0x5833a5[_0x59fddc(0x21cd)],document['getElementById'](_0x59fddc(0x776))[_0x59fddc(0x655)][_0x59fddc(0x2526)]='block'),toggleCharacterQuoteGroup(_0x59fddc(0xd84),_0x5833a5[_0x59fddc(0x10df)]));}else _0x5a0b5f['textContent']=_0x59fddc(0x5dd),clearAppointmentForm();_0x5e0868[_0x59fddc(0x655)][_0x59fddc(0x2526)]='flex';}function closeAppointmentForm(){const _0x48b7b4=_0x2cf6d4;document[_0x48b7b4(0x566)](_0x48b7b4(0x2261))[_0x48b7b4(0x655)][_0x48b7b4(0x2526)]=_0x48b7b4(0xfe9),clearAppointmentForm(),editingAppointmentId=null;}function clearAppointmentForm(){const _0x208b10=_0x2cf6d4;document[_0x208b10(0x566)](_0x208b10(0x163d))[_0x208b10(0xc34)]='',document[_0x208b10(0x566)](_0x208b10(0x2076))['value']='',document[_0x208b10(0x566)](_0x208b10(0x84d))[_0x208b10(0xc34)]='',document[_0x208b10(0x566)]('appointment-type')[_0x208b10(0xc34)]=_0x208b10(0x1c5b),document[_0x208b10(0x566)]('appointment-custom-type')[_0x208b10(0xc34)]='',document['getElementById'](_0x208b10(0x1d9d))[_0x208b10(0xc34)]='',document['getElementById'](_0x208b10(0xe8b))['value']=_0x208b10(0x1e86),document[_0x208b10(0x566)](_0x208b10(0x3d3))[_0x208b10(0xc34)]='',document[_0x208b10(0x566)]('appointment-user-quote')[_0x208b10(0xc34)]='',document['getElementById'](_0x208b10(0x291))[_0x208b10(0xc34)]='',document[_0x208b10(0x566)](_0x208b10(0x138f))[_0x208b10(0x306)]=![],document[_0x208b10(0x566)](_0x208b10(0x1834))[_0x208b10(0x306)]=![],document[_0x208b10(0x566)](_0x208b10(0x211d))[_0x208b10(0xc34)]=_0x208b10(0xcd4),document[_0x208b10(0x566)](_0x208b10(0x1b8e))['checked']=![];const _0x5119de=document['getElementById']('appointment-date'),_0x56af29=document['getElementById'](_0x208b10(0x84d));_0x5119de['disabled']=![],_0x56af29[_0x208b10(0x194e)]=![],_0x5119de[_0x208b10(0x655)][_0x208b10(0x671)]='1',_0x56af29['style'][_0x208b10(0x671)]='1',document[_0x208b10(0x566)](_0x208b10(0x9b4))[_0x208b10(0xc34)]='',document[_0x208b10(0x566)](_0x208b10(0x15be))[_0x208b10(0xc34)]='',document['getElementById'](_0x208b10(0x2a4))[_0x208b10(0x655)][_0x208b10(0x2526)]=_0x208b10(0xfe9),document[_0x208b10(0x566)]('appointment-user-avatar-preview')[_0x208b10(0x655)][_0x208b10(0x2526)]=_0x208b10(0xfe9),document[_0x208b10(0x566)]('appointment-background-img')['src']='',document[_0x208b10(0x566)](_0x208b10(0x197))[_0x208b10(0x107)]='',toggleCharacterQuoteGroup(_0x208b10(0xd84),''),toggleCustomTypeInput(_0x208b10(0xd84));}async function saveAppointment(_0x4b4f62){const _0x301f0c=_0x2cf6d4;_0x4b4f62&&(_0x4b4f62[_0x301f0c(0x4d9)](),_0x4b4f62['stopPropagation']());const _0x1f69bd=document[_0x301f0c(0x566)](_0x301f0c(0x163d)),_0x4e723e=document[_0x301f0c(0x566)](_0x301f0c(0x2076)),_0xe82069=document[_0x301f0c(0x566)](_0x301f0c(0x84d)),_0x578dcc=document[_0x301f0c(0x566)](_0x301f0c(0x220d)),_0xa93f6c=document['getElementById'](_0x301f0c(0x1d3a)),_0x16e915=document[_0x301f0c(0x566)](_0x301f0c(0x1d9d)),_0x5a6a72=document[_0x301f0c(0x566)](_0x301f0c(0xe8b)),_0x15ff4a=document[_0x301f0c(0x566)](_0x301f0c(0x3d3)),_0x3d4cfb=document[_0x301f0c(0x566)](_0x301f0c(0x149)),_0x5980c4=document[_0x301f0c(0x566)](_0x301f0c(0x291)),_0x35f1e6=document['getElementById'](_0x301f0c(0x138f)),_0x378b4c=document[_0x301f0c(0x566)](_0x301f0c(0x1834)),_0x17fd4e=document[_0x301f0c(0x566)](_0x301f0c(0x211d)),_0x58ee6b=document[_0x301f0c(0x566)]('appointment-never-expires'),_0xcd6adc=_0x1f69bd?String(_0x1f69bd[_0x301f0c(0xc34)]||'')[_0x301f0c(0x1424)]():'',_0x4556be=_0x4e723e?String(_0x4e723e[_0x301f0c(0xc34)]||''):'',_0x44dc10=_0xe82069?String(_0xe82069['value']||''):'',_0x5dd7f5=_0x578dcc?String(_0x578dcc[_0x301f0c(0xc34)]||''):'',_0x27164c=_0xa93f6c?String(_0xa93f6c[_0x301f0c(0xc34)]||'')[_0x301f0c(0x1424)]():'',_0x276c69=_0x16e915?String(_0x16e915[_0x301f0c(0xc34)]||''):'',_0x5e27c6=_0x5a6a72?String(_0x5a6a72['value']||_0x301f0c(0x1e86)):_0x301f0c(0x1e86),_0x1e7b8f=_0x15ff4a?String(_0x15ff4a[_0x301f0c(0xc34)]||'')['trim']():'',_0x162043=_0x3d4cfb?String(_0x3d4cfb[_0x301f0c(0xc34)]||'')[_0x301f0c(0x1424)]():'',_0x55fe5c=_0x5980c4?String(_0x5980c4['value']||'')[_0x301f0c(0x1424)]():'',_0x4fe655=_0x35f1e6?Boolean(_0x35f1e6[_0x301f0c(0x306)]):![],_0x82bd8a=_0x378b4c?Boolean(_0x378b4c[_0x301f0c(0x306)]):![],_0x4fc507=_0x17fd4e?String(_0x17fd4e[_0x301f0c(0xc34)]||_0x301f0c(0xcd4)):_0x301f0c(0xcd4),_0x563090=_0x58ee6b?Boolean(_0x58ee6b['checked']):![];console[_0x301f0c(0xc0d)](_0x301f0c(0xb69),{'name':_0xcd6adc,'date':_0x4556be,'time':_0x44dc10,'type':_0x5dd7f5,'customType':_0x27164c,'characterId':_0x276c69,'priority':_0x5e27c6,'description':_0x1e7b8f,'userQuote':_0x162043,'characterQuote':_0x55fe5c,'isShared':_0x4fe655,'isPinned':_0x82bd8a,'countType':_0x4fc507,'neverExpires':_0x563090});if(!_0xcd6adc||!_0x563090&&!_0x4556be){showToast(_0x563090?_0x301f0c(0xbc3):'请填写约定名称和日期','error');return;}if(_0x5dd7f5===_0x301f0c(0x9dd)&&!_0x27164c){showToast(_0x301f0c(0x825),_0x301f0c(0x24ab));return;}const _0x59ea26=document['getElementById']('appointment-background-img'),_0x23887e=document[_0x301f0c(0x566)]('appointment-user-avatar-img'),_0x3ec607=_0x59ea26&&_0x59ea26['src']&&_0x59ea26[_0x301f0c(0x107)]!==window[_0x301f0c(0x63b)]['href']?_0x59ea26[_0x301f0c(0x107)]:null,_0x57d860=_0x23887e&&_0x23887e['src']&&_0x23887e[_0x301f0c(0x107)]!==window[_0x301f0c(0x63b)][_0x301f0c(0xe1d)]?_0x23887e[_0x301f0c(0x107)]:null;try{const _0xd637d={'name':String(_0xcd6adc||''),'date':_0x563090?null:String(_0x4556be||''),'time':_0x563090?null:String(_0x44dc10||''),'type':String(_0x5dd7f5===_0x301f0c(0x9dd)?'other':_0x5dd7f5||''),'customType':_0x5dd7f5===_0x301f0c(0x9dd)?String(_0x27164c||''):null,'characterId':_0x276c69?String(_0x276c69):null,'priority':String(_0x5e27c6||'medium'),'description':String(_0x1e7b8f||''),'userQuote':_0x162043?String(_0x162043):null,'characterQuote':_0x55fe5c?String(_0x55fe5c):null,'isShared':Boolean(_0x4fe655),'isPinned':Boolean(_0x82bd8a),'backgroundImage':_0x3ec607?String(_0x3ec607):null,'userAvatar':_0x57d860?String(_0x57d860):null,'countType':String(_0x4fc507||_0x301f0c(0xcd4)),'neverExpires':Boolean(_0x563090),'completed':![],'createdBy':_0x301f0c(0x23b2),'timestamp':Date[_0x301f0c(0x18e0)]()};if(_0x82bd8a){const _0xd52e39=appointments[_0x301f0c(0x803)](_0xc5c8f9=>_0xc5c8f9[_0x301f0c(0x23bd)]&&_0xc5c8f9['id']!==_0xd637d['id']);for(const _0x3adbdc of _0xd52e39){_0x3adbdc[_0x301f0c(0x23bd)]=![],await db[_0x301f0c(0x1ae2)][_0x301f0c(0x53a)](_0x3adbdc);}_0xd52e39[_0x301f0c(0xcbf)]>0x0&&console[_0x301f0c(0xc0d)](_0x301f0c(0x1efc)+_0xd52e39[_0x301f0c(0xcbf)]+_0x301f0c(0x35a));}if(editingAppointmentId){_0xd637d['id']=String(editingAppointmentId),console[_0x301f0c(0xc0d)](_0x301f0c(0x10a9),JSON['stringify'](_0xd637d,null,0x2)),await db['appointments'][_0x301f0c(0x53a)](_0xd637d);const _0x48e292=appointments['findIndex'](_0x1343a6=>_0x1343a6['id']===editingAppointmentId);_0x48e292!==-0x1&&(appointments[_0x48e292]=_0xd637d);showToast(_0x301f0c(0xc51),'success'),closeAppointmentForm(),loadAppointmentList();if(_0xd637d['isShared']&&_0xd637d['characterId'])try{await recordCrossAppEvent(_0xd637d[_0x301f0c(0x10df)],_0x301f0c(0xd84),_0x301f0c(0x2180),{'id':_0xd637d['id'],'type':_0x301f0c(0x184d),'content':_0x301f0c(0x18e6)+_0xd637d[_0x301f0c(0x222f)]+'\x22（'+_0xd637d[_0x301f0c(0x1c5b)]+(_0xd637d[_0x301f0c(0x8e1)]?'\x20'+_0xd637d[_0x301f0c(0x8e1)]:'')+'）'+(_0xd637d[_0x301f0c(0x1c6f)]?'：'+_0xd637d[_0x301f0c(0x1c6f)]:''),'appointmentName':_0xd637d[_0x301f0c(0x222f)],'appointmentDate':_0xd637d['date'],'appointmentTime':_0xd637d[_0x301f0c(0x8e1)],'appointmentType':_0xd637d[_0x301f0c(0x23df)],'description':_0xd637d[_0x301f0c(0x1c6f)],'priority':_0xd637d['priority']}),console['log'](_0x301f0c(0x185e));}catch(_0x48b924){console[_0x301f0c(0x24ab)](_0x301f0c(0x18ef),_0x48b924);}}else{_0xd637d['id']=Date['now']()[_0x301f0c(0x9a3)]()+'_'+Math[_0x301f0c(0x191c)]()[_0x301f0c(0x9a3)](0x24)[_0x301f0c(0x18cf)](0x2,0x9),console['log'](_0x301f0c(0x11ca),JSON[_0x301f0c(0x7fb)](_0xd637d,null,0x2)),await db[_0x301f0c(0x1ae2)][_0x301f0c(0xe1)](_0xd637d),appointments['push'](_0xd637d),showToast(_0x301f0c(0xdd7),_0x301f0c(0xb27));const _0x501622=await db[_0x301f0c(0x1ae2)]['toArray']();console[_0x301f0c(0xc0d)](_0x301f0c(0x221b),_0x501622['length'],_0x501622);if(_0xd637d[_0x301f0c(0x7e7)]&&_0xd637d[_0x301f0c(0x10df)])try{await recordCrossAppEvent(_0xd637d[_0x301f0c(0x10df)],_0x301f0c(0xd84),'create',{'id':_0xd637d['id'],'type':_0x301f0c(0x108d),'content':'用户创建了约定\x22'+_0xd637d['name']+'\x22（'+_0xd637d[_0x301f0c(0x1c5b)]+(_0xd637d[_0x301f0c(0x8e1)]?'\x20'+_0xd637d['time']:'')+'）'+(_0xd637d[_0x301f0c(0x1c6f)]?'：'+_0xd637d[_0x301f0c(0x1c6f)]:''),'appointmentName':_0xd637d[_0x301f0c(0x222f)],'appointmentDate':_0xd637d[_0x301f0c(0x1c5b)],'appointmentTime':_0xd637d['time'],'appointmentType':_0xd637d[_0x301f0c(0x23df)],'description':_0xd637d[_0x301f0c(0x1c6f)],'priority':_0xd637d['priority']},_0xd637d['id']),console['log'](_0x301f0c(0x1ffb));}catch(_0x1968ef){console['error'](_0x301f0c(0x2276),_0x1968ef);}}!editingAppointmentId&&(closeAppointmentForm(),loadAppointmentList());}catch(_0x1718e9){console[_0x301f0c(0x24ab)]('保存约定失败:',_0x1718e9),showToast(_0x301f0c(0x1647),_0x301f0c(0x24ab));}}function showAnniversaryForm(_0x5ce71f=null){const _0x4912b4=_0x2cf6d4;editingAnniversaryId=_0x5ce71f;const _0x359863=document[_0x4912b4(0x566)](_0x4912b4(0x2130)),_0x36fdaf=document[_0x4912b4(0x566)](_0x4912b4(0x1feb));populateCharacterSelect('anniversary-character');if(_0x5ce71f){_0x36fdaf[_0x4912b4(0x21dc)]='编辑纪念日';const _0x2b892f=anniversaries[_0x4912b4(0x1aeb)](_0x5774a3=>_0x5774a3['id']===_0x5ce71f);_0x2b892f&&(document[_0x4912b4(0x566)](_0x4912b4(0x17c2))['value']=_0x2b892f[_0x4912b4(0x222f)],document[_0x4912b4(0x566)](_0x4912b4(0x4b6))['value']=_0x2b892f[_0x4912b4(0x1c5b)],_0x2b892f[_0x4912b4(0x46c)]?(document[_0x4912b4(0x566)](_0x4912b4(0x1bfe))[_0x4912b4(0xc34)]=_0x4912b4(0x9dd),document['getElementById'](_0x4912b4(0x1563))[_0x4912b4(0xc34)]=_0x2b892f[_0x4912b4(0x46c)],toggleCustomTypeInput('anniversary')):document[_0x4912b4(0x566)](_0x4912b4(0x1bfe))[_0x4912b4(0xc34)]=_0x2b892f['type'],document['getElementById'](_0x4912b4(0x2296))[_0x4912b4(0xc34)]=_0x2b892f[_0x4912b4(0x10df)]||'',document['getElementById'](_0x4912b4(0x844))[_0x4912b4(0xc34)]=_0x2b892f[_0x4912b4(0x1c6f)]||'',document[_0x4912b4(0x566)](_0x4912b4(0x5c0))[_0x4912b4(0xc34)]=_0x2b892f[_0x4912b4(0x229c)]||'',document['getElementById'](_0x4912b4(0x1ffa))[_0x4912b4(0xc34)]=_0x2b892f[_0x4912b4(0x129a)]||'',document[_0x4912b4(0x566)](_0x4912b4(0x1867))['checked']=_0x2b892f[_0x4912b4(0xb4b)]!==![],document['getElementById'](_0x4912b4(0x1bce))[_0x4912b4(0x306)]=_0x2b892f['isShared']===!![],document[_0x4912b4(0x566)]('anniversary-pinned')[_0x4912b4(0x306)]=_0x2b892f[_0x4912b4(0x23bd)]===!![],document[_0x4912b4(0x566)](_0x4912b4(0x954))[_0x4912b4(0xc34)]=_0x2b892f[_0x4912b4(0x103e)]||'countdown',_0x2b892f[_0x4912b4(0x1584)]&&(document['getElementById'](_0x4912b4(0x3c3))[_0x4912b4(0x107)]=_0x2b892f[_0x4912b4(0x1584)],document['getElementById'](_0x4912b4(0x227e))[_0x4912b4(0x655)][_0x4912b4(0x2526)]=_0x4912b4(0x2d4)),_0x2b892f[_0x4912b4(0x21cd)]&&(document[_0x4912b4(0x566)](_0x4912b4(0x22a))[_0x4912b4(0x107)]=_0x2b892f['userAvatar'],document[_0x4912b4(0x566)](_0x4912b4(0x1ce5))[_0x4912b4(0x655)][_0x4912b4(0x2526)]=_0x4912b4(0x2d4)),toggleCharacterQuoteGroup('anniversary',_0x2b892f['characterId']));}else _0x36fdaf['textContent']='添加纪念日',clearAnniversaryForm();_0x359863[_0x4912b4(0x655)][_0x4912b4(0x2526)]=_0x4912b4(0x1f0b);}function closeAnniversaryForm(){const _0x4def14=_0x2cf6d4;document[_0x4def14(0x566)](_0x4def14(0x2130))[_0x4def14(0x655)][_0x4def14(0x2526)]=_0x4def14(0xfe9),clearAnniversaryForm(),editingAnniversaryId=null;}function clearAnniversaryForm(){const _0x5fbe29=_0x2cf6d4;document[_0x5fbe29(0x566)](_0x5fbe29(0x17c2))[_0x5fbe29(0xc34)]='',document[_0x5fbe29(0x566)](_0x5fbe29(0x4b6))[_0x5fbe29(0xc34)]='',document['getElementById']('anniversary-type')[_0x5fbe29(0xc34)]=_0x5fbe29(0x8ad),document[_0x5fbe29(0x566)](_0x5fbe29(0x1563))[_0x5fbe29(0xc34)]='',document[_0x5fbe29(0x566)](_0x5fbe29(0x2296))['value']='',document[_0x5fbe29(0x566)](_0x5fbe29(0x844))[_0x5fbe29(0xc34)]='',document[_0x5fbe29(0x566)]('anniversary-user-quote')[_0x5fbe29(0xc34)]='',document[_0x5fbe29(0x566)](_0x5fbe29(0x1ffa))['value']='',document[_0x5fbe29(0x566)]('anniversary-yearly')[_0x5fbe29(0x306)]=!![],document[_0x5fbe29(0x566)](_0x5fbe29(0x1bce))[_0x5fbe29(0x306)]=![],document[_0x5fbe29(0x566)](_0x5fbe29(0x371))[_0x5fbe29(0x306)]=![],document['getElementById'](_0x5fbe29(0x954))['value']=_0x5fbe29(0xcd4),document[_0x5fbe29(0x566)](_0x5fbe29(0x1c71))[_0x5fbe29(0xc34)]='',document[_0x5fbe29(0x566)](_0x5fbe29(0xea0))[_0x5fbe29(0xc34)]='',document[_0x5fbe29(0x566)]('anniversary-background-preview')['style'][_0x5fbe29(0x2526)]=_0x5fbe29(0xfe9),document['getElementById'](_0x5fbe29(0x1ce5))[_0x5fbe29(0x655)][_0x5fbe29(0x2526)]=_0x5fbe29(0xfe9),toggleCharacterQuoteGroup(_0x5fbe29(0xe32),''),toggleCustomTypeInput(_0x5fbe29(0xe32));}function populateCharacterSelect(_0x324c8e){const _0xdb7d6=_0x2cf6d4,_0xf0aa72=document['getElementById'](_0x324c8e),_0x4471e8=_0xf0aa72['value'];_0xf0aa72[_0xdb7d6(0xc02)]=_0xdb7d6(0xa2),characters[_0xdb7d6(0x900)](_0x7f3db7=>{const _0x78a090=_0xdb7d6,_0xc3eee6=document[_0x78a090(0x1ad8)]('option');_0xc3eee6['value']=_0x7f3db7['id'],_0xc3eee6['textContent']=_0x7f3db7[_0x78a090(0x222f)],_0xf0aa72[_0x78a090(0x1925)](_0xc3eee6);}),_0x4471e8&&(_0xf0aa72[_0xdb7d6(0xc34)]=_0x4471e8);}function toggleCharacterQuoteGroup(_0x49256,_0x2ca675){const _0x39b698=_0x2cf6d4,_0x238d64=document[_0x39b698(0x566)](_0x49256+_0x39b698(0xc30)),_0x2aafde=document['getElementById'](_0x49256+_0x39b698(0x273)),_0x2aceb0=document[_0x39b698(0x566)](_0x49256+_0x39b698(0x1b24));if(_0x2ca675){const _0xbc7702=characters['find'](_0x24cf4b=>_0x24cf4b['id']===_0x2ca675);_0xbc7702&&(_0x238d64[_0x39b698(0x655)][_0x39b698(0x2526)]='block',_0x2aceb0[_0x39b698(0x21dc)]=_0x39b698(0x6f3),_0x2aafde['placeholder']=_0xbc7702['name']+_0x39b698(0x1d0b)+(_0x49256===_0x39b698(0xe32)?'纪念日':'约定')+_0x39b698(0xb0b));}else _0x238d64[_0x39b698(0x655)][_0x39b698(0x2526)]=_0x39b698(0xfe9),_0x2aafde[_0x39b698(0xc34)]='';}function toggleCustomTypeInput(_0x95fd99){const _0x3314f4=_0x2cf6d4,_0x4f4f85=document[_0x3314f4(0x566)](_0x95fd99+_0x3314f4(0xb26)),_0x10f1dd=document['getElementById'](_0x95fd99+_0x3314f4(0x1f8d)),_0x2451e3=document['getElementById'](_0x95fd99+_0x3314f4(0x567));_0x4f4f85[_0x3314f4(0xc34)]==='other'?(_0x10f1dd[_0x3314f4(0x655)][_0x3314f4(0x2526)]=_0x3314f4(0x2d4),_0x2451e3['focus']()):(_0x10f1dd['style'][_0x3314f4(0x2526)]='none',_0x2451e3['value']='');}function toggleNeverExpires(_0x4ba7ef){const _0x57f986=_0x2cf6d4,_0x4b5bef=document['getElementById'](_0x4ba7ef+'-never-expires'),_0x2b4f6=document['getElementById'](_0x4ba7ef+_0x57f986(0x7e9)),_0x2bba2a=document['getElementById'](_0x4ba7ef+'-time');_0x4b5bef[_0x57f986(0x306)]?(_0x2b4f6[_0x57f986(0x194e)]=!![],_0x2bba2a[_0x57f986(0x194e)]=!![],_0x2b4f6[_0x57f986(0x655)][_0x57f986(0x671)]=_0x57f986(0x1ffd),_0x2bba2a[_0x57f986(0x655)][_0x57f986(0x671)]=_0x57f986(0x1ffd),_0x2b4f6['value']='',_0x2bba2a['value']=''):(_0x2b4f6[_0x57f986(0x194e)]=![],_0x2bba2a[_0x57f986(0x194e)]=![],_0x2b4f6[_0x57f986(0x655)][_0x57f986(0x671)]='1',_0x2bba2a[_0x57f986(0x655)]['opacity']='1');}async function saveAnniversary(_0x1ec89a){const _0x140aaf=_0x2cf6d4;_0x1ec89a&&(_0x1ec89a[_0x140aaf(0x4d9)](),_0x1ec89a[_0x140aaf(0x1023)]());const _0x2cef5c=document['getElementById'](_0x140aaf(0x17c2))[_0x140aaf(0xc34)][_0x140aaf(0x1424)](),_0x3de999=document[_0x140aaf(0x566)]('anniversary-date')[_0x140aaf(0xc34)],_0x43aac0=document[_0x140aaf(0x566)]('anniversary-type')[_0x140aaf(0xc34)],_0x1e6c91=document[_0x140aaf(0x566)](_0x140aaf(0x1563))[_0x140aaf(0xc34)][_0x140aaf(0x1424)](),_0x1058dc=document[_0x140aaf(0x566)](_0x140aaf(0x2296))['value'],_0xcf90cd=document[_0x140aaf(0x566)]('anniversary-description')[_0x140aaf(0xc34)]['trim'](),_0x2264a7=document[_0x140aaf(0x566)](_0x140aaf(0x5c0))[_0x140aaf(0xc34)]['trim'](),_0x4f0ebc=document['getElementById'](_0x140aaf(0x1ffa))[_0x140aaf(0xc34)]['trim'](),_0x180474=document['getElementById']('anniversary-yearly')['checked'],_0x545e3f=document['getElementById'](_0x140aaf(0x1bce))[_0x140aaf(0x306)],_0x27be71=document['getElementById'](_0x140aaf(0x371))[_0x140aaf(0x306)],_0x3efd86=document[_0x140aaf(0x566)](_0x140aaf(0x954))[_0x140aaf(0xc34)];if(!_0x2cef5c||!_0x3de999){showToast(_0x140aaf(0x4ee),'error');return;}if(_0x43aac0==='other'&&!_0x1e6c91){showToast(_0x140aaf(0x825),'error');return;}const _0x1b2cde=document[_0x140aaf(0x566)](_0x140aaf(0x3c3)),_0x897f85=document[_0x140aaf(0x566)](_0x140aaf(0x22a)),_0x337ec8=_0x1b2cde&&_0x1b2cde[_0x140aaf(0x107)]&&_0x1b2cde[_0x140aaf(0x107)]!==window[_0x140aaf(0x63b)][_0x140aaf(0xe1d)]?_0x1b2cde[_0x140aaf(0x107)]:null,_0xdfc615=_0x897f85&&_0x897f85[_0x140aaf(0x107)]&&_0x897f85[_0x140aaf(0x107)]!==window[_0x140aaf(0x63b)][_0x140aaf(0xe1d)]?_0x897f85[_0x140aaf(0x107)]:null,_0x34b206={'id':String(editingAnniversaryId||Date['now']()[_0x140aaf(0x9a3)]()),'name':String(_0x2cef5c||''),'date':String(_0x3de999||''),'type':String(_0x43aac0===_0x140aaf(0x9dd)?_0x140aaf(0x9dd):_0x43aac0||''),'customType':_0x43aac0===_0x140aaf(0x9dd)?String(_0x1e6c91||''):null,'characterId':_0x1058dc?String(_0x1058dc):null,'description':String(_0xcf90cd||''),'userQuote':_0x2264a7?String(_0x2264a7):null,'characterQuote':_0x4f0ebc?String(_0x4f0ebc):null,'yearly':Boolean(_0x180474),'isShared':Boolean(_0x545e3f),'isPinned':Boolean(_0x27be71),'backgroundImage':_0x337ec8?String(_0x337ec8):null,'userAvatar':_0xdfc615?String(_0xdfc615):null,'countType':String(_0x3efd86||_0x140aaf(0xcd4)),'createdBy':_0x140aaf(0x23b2),'createdAt':editingAnniversaryId?anniversaries[_0x140aaf(0x1aeb)](_0x4c360e=>_0x4c360e['id']===editingAnniversaryId)?.[_0x140aaf(0xd70)]||new Date()[_0x140aaf(0xa4b)]():new Date()[_0x140aaf(0xa4b)]()};try{if(_0x27be71){const _0x486dbf=anniversaries[_0x140aaf(0x803)](_0x5514f2=>_0x5514f2[_0x140aaf(0x23bd)]&&_0x5514f2['id']!==_0x34b206['id']);for(const _0xff3c09 of _0x486dbf){_0xff3c09[_0x140aaf(0x23bd)]=![],await db[_0x140aaf(0x2c5)][_0x140aaf(0x53a)](_0xff3c09);}_0x486dbf[_0x140aaf(0xcbf)]>0x0&&console['log']('取消了\x20'+_0x486dbf['length']+_0x140aaf(0x1fde));}if(editingAnniversaryId){await db[_0x140aaf(0x2c5)]['put'](_0x34b206);const _0x1290a4=anniversaries[_0x140aaf(0x23ba)](_0x5cc2f6=>_0x5cc2f6['id']===editingAnniversaryId);_0x1290a4!==-0x1&&(anniversaries[_0x1290a4]=_0x34b206);showToast('纪念日已更新',_0x140aaf(0xb27));if(_0x34b206[_0x140aaf(0x7e7)]&&_0x34b206['characterId'])try{await recordCrossAppEvent(_0x34b206['characterId'],_0x140aaf(0xe32),_0x140aaf(0x2180),{'id':_0x34b206['id'],'type':_0x140aaf(0x52a),'content':'用户更新了纪念日\x22'+_0x34b206['name']+'\x22（'+_0x34b206[_0x140aaf(0x1c5b)]+'）'+(_0x34b206['description']?'：'+_0x34b206[_0x140aaf(0x1c6f)]:''),'anniversaryName':_0x34b206[_0x140aaf(0x222f)],'anniversaryDate':_0x34b206[_0x140aaf(0x1c5b)],'anniversaryType':_0x34b206['type'],'description':_0x34b206['description'],'countType':_0x34b206[_0x140aaf(0x103e)]}),console[_0x140aaf(0xc0d)](_0x140aaf(0x740));}catch(_0xda4439){console[_0x140aaf(0x24ab)]('❌\x20[纪念日时间线]\x20记录纪念日更新事件失败:',_0xda4439);}}else{await db['anniversaries'][_0x140aaf(0xe1)](_0x34b206),anniversaries[_0x140aaf(0x6ee)](_0x34b206),showToast('纪念日已添加',_0x140aaf(0xb27));if(_0x34b206[_0x140aaf(0x7e7)]&&_0x34b206['characterId'])try{await recordCrossAppEvent(_0x34b206[_0x140aaf(0x10df)],_0x140aaf(0xe32),'create',{'id':_0x34b206['id'],'type':_0x140aaf(0x1a4b),'content':_0x140aaf(0x1639)+_0x34b206[_0x140aaf(0x222f)]+'\x22（'+_0x34b206['date']+'）'+(_0x34b206[_0x140aaf(0x1c6f)]?'：'+_0x34b206[_0x140aaf(0x1c6f)]:''),'anniversaryName':_0x34b206[_0x140aaf(0x222f)],'anniversaryDate':_0x34b206[_0x140aaf(0x1c5b)],'anniversaryType':_0x34b206['type'],'description':_0x34b206[_0x140aaf(0x1c6f)],'countType':_0x34b206[_0x140aaf(0x103e)]},_0x34b206['id']),console[_0x140aaf(0xc0d)](_0x140aaf(0x97f));}catch(_0x4ffcde){console['error']('❌\x20[纪念日时间线]\x20记录纪念日创建事件失败:',_0x4ffcde);}}closeAnniversaryForm(),loadAnniversaryList(),_0x34b206[_0x140aaf(0x23bd)]&&setTimeout(()=>{const _0x4bf33d=_0x140aaf;localStorage[_0x4bf33d(0x2055)](_0x4bf33d(0xc8e),_0x34b206['id']),displayAnniversaryWidget(_0x34b206);},0x64);}catch(_0x316634){console[_0x140aaf(0x24ab)](_0x140aaf(0x13d4),_0x316634),showToast(_0x140aaf(0x1647),_0x140aaf(0x24ab));}}async function loadAnniversaryList(){const _0x16245c=_0x2cf6d4;try{if(!db||!db[_0x16245c(0x2c5)]){console[_0x16245c(0x17cc)]('数据库未初始化，跳过纪念日加载'),anniversaries=[],renderAnniversaryList();return;}anniversaries=await db[_0x16245c(0x2c5)][_0x16245c(0x1902)](_0x16245c(0x1c5b))[_0x16245c(0x18c6)](),renderAnniversaryList();}catch(_0x147b57){console[_0x16245c(0x24ab)](_0x16245c(0x11ed),_0x147b57),anniversaries=[],renderAnniversaryList();}}function renderAnniversaryList(){const _0x51518e=_0x2cf6d4,_0x4cd20e=document[_0x51518e(0x566)](_0x51518e(0x265)),_0x171e8d=document[_0x51518e(0x566)](_0x51518e(0x9f0)),_0x56bea5=document[_0x51518e(0x566)](_0x51518e(0x1e4f)),_0x2e5939=anniversaries[_0x51518e(0x803)](_0x5abb8f=>_0x5abb8f[_0x51518e(0x23bd)]),_0x2193ad=anniversaries['filter'](_0x11cdb5=>!_0x11cdb5[_0x51518e(0x23bd)]);if(_0x2e5939['length']>0x0){const _0x3ca9e2=_0x2e5939[0x0];renderPinnedAnniversary(_0x3ca9e2),_0x171e8d[_0x51518e(0x655)]['display']=_0x51518e(0x2d4);}else _0x171e8d[_0x51518e(0x655)]['display']=_0x51518e(0xfe9);if(_0x2193ad['length']===0x0&&_0x2e5939[_0x51518e(0xcbf)]===0x0){_0x4cd20e['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22anniversary-empty-state\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-heart\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>还没有纪念日</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>点击右上角\x20+\x20添加重要的日子</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';return;}const _0xfcb3bd=new Date(),_0x3a4127=_0xfcb3bd['getFullYear']();_0x4cd20e[_0x51518e(0xc02)]=_0x2193ad[_0x51518e(0xf6d)](_0x27e3df=>{const _0x14eb2e=_0x51518e,_0x2eeb82=new Date(_0x27e3df[_0x14eb2e(0x1c5b)]),_0x10f33e=_0x27e3df[_0x14eb2e(0x103e)]||_0x14eb2e(0xcd4);let _0x296765='';if(_0x10f33e==='countup'){const _0x467730=new Date(_0xfcb3bd[_0x14eb2e(0x885)](),_0xfcb3bd[_0x14eb2e(0x17f3)](),_0xfcb3bd[_0x14eb2e(0x1d02)]()),_0x100a95=new Date(_0x2eeb82[_0x14eb2e(0x885)](),_0x2eeb82[_0x14eb2e(0x17f3)](),_0x2eeb82['getDate']()),_0x38f8ec=Math['floor']((_0x467730-_0x100a95)/(0x3e8*0x3c*0x3c*0x18));_0x296765=_0x38f8ec===0x0?'今天':_0x14eb2e(0x98d)+_0x38f8ec+'\x20天';}else{const _0x5e71f0=new Date(_0xfcb3bd['getFullYear'](),_0xfcb3bd[_0x14eb2e(0x17f3)](),_0xfcb3bd['getDate']());let _0x30e1c1=new Date(_0x3a4127,_0x2eeb82[_0x14eb2e(0x17f3)](),_0x2eeb82['getDate']());_0x30e1c1<_0x5e71f0&&_0x30e1c1[_0x14eb2e(0x20b9)](_0x3a4127+0x1);const _0x2ae4ce=Math['floor']((_0x30e1c1-_0x5e71f0)/(0x3e8*0x3c*0x3c*0x18));_0x296765=_0x2ae4ce===0x0?'今天':_0x2ae4ce===0x1?'明天':_0x14eb2e(0x10ee)+_0x2ae4ce+'\x20天';}const _0xcdd9bf=_0x27e3df['characterId']?characters['find'](_0x1fb75f=>_0x1fb75f['id']===_0x27e3df[_0x14eb2e(0x10df)]):null,_0x4ebdcb=_0xcdd9bf?'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22anniversary-character-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22character-avatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22'+(_0xcdd9bf[_0x14eb2e(0x107f)]||_0xcdd9bf[_0x14eb2e(0x10f9)]||createDefaultAvatar(_0xcdd9bf[_0x14eb2e(0x222f)]))+_0x14eb2e(0x1ca8)+_0xcdd9bf[_0x14eb2e(0x222f)]+_0x14eb2e(0x215f)+_0xcdd9bf[_0x14eb2e(0x222f)][_0x14eb2e(0x1518)](0x0)+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22character-name\x22>与\x20'+_0xcdd9bf['name']+_0x14eb2e(0x1c88):'',_0x29ba34=_0x27e3df[_0x14eb2e(0x229c)]?_0x14eb2e(0x24cd)+escapeHtml(_0x27e3df['userQuote'])+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20':'',_0x352fe6=_0x27e3df['characterQuote']?_0x14eb2e(0x2b4)+escapeHtml(_0x27e3df['characterQuote'])+_0x14eb2e(0x1c88):'';return _0x14eb2e(0x2323)+(_0x27e3df[_0x14eb2e(0x7e7)]?'shared':'')+_0x14eb2e(0x1c23)+_0x27e3df['id']+_0x14eb2e(0xe4a)+_0x27e3df['id']+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20简洁条状显示\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22anniversary-item-compact\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22anniversary-item-compact-left\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22anniversary-item-compact-name\x22>'+escapeHtml(_0x27e3df[_0x14eb2e(0x222f)])+_0x14eb2e(0x1892)+_0x296765+_0x14eb2e(0x6e8)+escapeHtml(_0x27e3df[_0x14eb2e(0x222f)])+_0x14eb2e(0xc23)+formatDate(_0x27e3df[_0x14eb2e(0x1c5b)])+_0x14eb2e(0x1e0f)+_0x4ebdcb+_0x14eb2e(0x1fdc)+_0x27e3df[_0x14eb2e(0x23df)]+'\x22>'+getTypeText(_0x27e3df)+_0x14eb2e(0x16fe)+(_0x27e3df[_0x14eb2e(0x1c6f)]?_0x14eb2e(0x14fc)+escapeHtml(_0x27e3df[_0x14eb2e(0x1c6f)])+_0x14eb2e(0xa54):'')+_0x14eb2e(0xbc6)+_0x29ba34+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x352fe6+_0x14eb2e(0x1aa2)+_0x27e3df['id']+_0x14eb2e(0x1953)+_0x27e3df['id']+_0x14eb2e(0xf6c);})['join']('');const _0x4b08bd=localStorage['getItem']('anniversaryWidgetSelection');let _0x5e1104=null;_0x4b08bd&&(_0x5e1104=anniversaries[_0x51518e(0x1aeb)](_0x147d7f=>_0x147d7f['id']===_0x4b08bd));if(!_0x5e1104&&anniversaries[_0x51518e(0xcbf)]>0x0){const _0x562c62=anniversaries[_0x51518e(0x1aeb)](_0x67ad31=>_0x67ad31[_0x51518e(0x23bd)]);_0x562c62&&(_0x5e1104=_0x562c62,localStorage[_0x51518e(0x2055)](_0x51518e(0xc8e),_0x562c62['id']));}if(_0x5e1104)displayAnniversaryWidget(_0x5e1104);else anniversaries['length']===0x0&&clearAnniversaryWidget();}async function deleteAnniversary(_0x3018b3){const _0x5aebbd=_0x2cf6d4;if(confirm(_0x5aebbd(0x2430)))try{await db['anniversaries'][_0x5aebbd(0xc2b)](_0x3018b3),anniversaries=anniversaries[_0x5aebbd(0x803)](_0x3b41ef=>_0x3b41ef['id']!==_0x3018b3),renderAnniversaryList(),setTimeout(()=>{refreshAnniversaryWidget();},0x64),showToast(_0x5aebbd(0xc59),_0x5aebbd(0xb27));}catch(_0x232e8a){console[_0x5aebbd(0x24ab)](_0x5aebbd(0x435),_0x232e8a),showToast(_0x5aebbd(0x315),_0x5aebbd(0x24ab));}}async function unpinAnniversary(_0x2a8aa9){const _0x132ca3=_0x2cf6d4;try{const _0x30b714=anniversaries[_0x132ca3(0x1aeb)](_0x4fd246=>_0x4fd246['id']===_0x2a8aa9);_0x30b714&&(_0x30b714[_0x132ca3(0x23bd)]=![],await db[_0x132ca3(0x2c5)][_0x132ca3(0x53a)](_0x30b714),renderAnniversaryList(),showToast(_0x132ca3(0x1a30),_0x132ca3(0xb27)));}catch(_0x5c4e27){console[_0x132ca3(0x24ab)](_0x132ca3(0x17e2),_0x5c4e27),showToast('操作失败，请重试',_0x132ca3(0x24ab));}}function toggleAnniversaryItem(_0x446038,_0x3cde4a){const _0x116da1=_0x2cf6d4;_0x446038[_0x116da1(0x1023)]();const _0x510508=_0x446038['currentTarget'],_0x5d36d5=_0x510508[_0x116da1(0x226e)]['contains'](_0x116da1(0x5c2));document['querySelectorAll'](_0x116da1(0x2517))['forEach'](_0x3a75d4=>{const _0x5d1874=_0x116da1;_0x3a75d4!==_0x510508&&_0x3a75d4[_0x5d1874(0x226e)]['remove'](_0x5d1874(0x5c2));}),_0x5d36d5?_0x510508['classList']['remove'](_0x116da1(0x5c2)):_0x510508[_0x116da1(0x226e)][_0x116da1(0xe1)](_0x116da1(0x5c2));}async function loadAppointmentList(){const _0x4a815a=_0x2cf6d4;try{if(!db||!db[_0x4a815a(0x1ae2)]){console[_0x4a815a(0x17cc)](_0x4a815a(0x1715)),appointments=[],renderAppointmentList();return;}appointments=await db[_0x4a815a(0x1ae2)][_0x4a815a(0x18c6)](),console[_0x4a815a(0xc0d)](_0x4a815a(0x22a2),appointments[_0x4a815a(0xcbf)]),console[_0x4a815a(0xc0d)]('📋\x20约定详情:',appointments),renderAppointmentList();}catch(_0x16a18a){console[_0x4a815a(0x24ab)]('加载约定列表失败:',_0x16a18a),appointments=[],renderAppointmentList();}}function renderAppointmentList(){const _0x2bb8c1=_0x2cf6d4,_0x3347ab=document[_0x2bb8c1(0x566)](_0x2bb8c1(0x709));if(appointments[_0x2bb8c1(0xcbf)]===0x0){_0x3347ab[_0x2bb8c1(0xc02)]=_0x2bb8c1(0x1a3c);return;}const _0x531214=appointments[_0x2bb8c1(0x803)](_0x22ded6=>_0x22ded6[_0x2bb8c1(0x23bd)]),_0x5db154=appointments[_0x2bb8c1(0x803)](_0x3c4aa5=>!_0x3c4aa5[_0x2bb8c1(0x23bd)]);if(_0x531214[_0x2bb8c1(0xcbf)]>0x0){const _0x88c1e1=_0x531214[0x0];renderPinnedAppointment(_0x88c1e1),document[_0x2bb8c1(0x566)]('pinned-appointment-section')[_0x2bb8c1(0x655)][_0x2bb8c1(0x2526)]=_0x2bb8c1(0x2d4);}else document[_0x2bb8c1(0x566)](_0x2bb8c1(0x1e49))[_0x2bb8c1(0x655)]['display']=_0x2bb8c1(0xfe9);const _0x313588=[..._0x5db154][_0x2bb8c1(0x1f0d)]((_0x504e91,_0x4b833f)=>{const _0x5d9092=_0x2bb8c1;if(_0x504e91[_0x5d9092(0x1604)]!==_0x4b833f[_0x5d9092(0x1604)])return _0x504e91['completed']?0x1:-0x1;if(_0x504e91['neverExpires']!==_0x4b833f[_0x5d9092(0x517)])return _0x504e91[_0x5d9092(0x517)]?0x1:-0x1;if(!_0x504e91['neverExpires']&&!_0x4b833f[_0x5d9092(0x517)])return new Date(_0x504e91[_0x5d9092(0x1c5b)]+'\x20'+(_0x504e91[_0x5d9092(0x8e1)]||'00:00'))-new Date(_0x4b833f[_0x5d9092(0x1c5b)]+'\x20'+(_0x4b833f[_0x5d9092(0x8e1)]||'00:00'));return(_0x504e91['timestamp']||0x0)-(_0x4b833f['timestamp']||0x0);});_0x3347ab['innerHTML']=_0x313588[_0x2bb8c1(0xf6d)](_0x109abb=>{const _0x24ca9e=_0x2bb8c1;let _0x4b2c7b=_0x24ca9e(0x1638),_0x2c744e='',_0x29b65e=![];if(_0x109abb['neverExpires'])_0x4b2c7b=_0x109abb[_0x24ca9e(0x1604)]?_0x24ca9e(0x1604):_0x24ca9e(0xecc),_0x2c744e=_0x109abb['completed']?_0x24ca9e(0x1938):_0x24ca9e(0xff0);else{const _0x561eb1=new Date(_0x109abb[_0x24ca9e(0x1c5b)]+'\x20'+(_0x109abb[_0x24ca9e(0x8e1)]||_0x24ca9e(0x8d3))),_0x4667ab=new Date();_0x29b65e=_0x561eb1<_0x4667ab&&!_0x109abb['completed'];if(_0x109abb['completed'])_0x4b2c7b='completed',_0x2c744e=_0x24ca9e(0x1938);else{if(_0x29b65e){_0x4b2c7b=_0x24ca9e(0x1a68);const _0x32d1e3=Math['floor']((_0x4667ab-_0x561eb1)/(0x3e8*0x3c*0x3c*0x18));_0x2c744e=_0x24ca9e(0x14d3)+_0x32d1e3+'\x20天';}else{const _0x3f550b=_0x561eb1-_0x4667ab,_0x4b1f3f=Math[_0x24ca9e(0x1462)](_0x3f550b/(0x3e8*0x3c*0x3c*0x18));if(_0x4b1f3f===0x0)_0x2c744e='今天';else _0x4b1f3f===0x1?_0x2c744e='明天':_0x2c744e='还有\x20'+_0x4b1f3f+'\x20天';}}}const _0x2c1c1f=_0x109abb[_0x24ca9e(0x10df)]?characters[_0x24ca9e(0x1aeb)](_0x1b3681=>_0x1b3681['id']===_0x109abb[_0x24ca9e(0x10df)]):null,_0xc54218=_0x109abb[_0x24ca9e(0x229c)]?_0x24ca9e(0x851)+escapeHtml(_0x109abb[_0x24ca9e(0x229c)])+_0x24ca9e(0x1c88):'';return _0x24ca9e(0x1bac)+(_0x109abb[_0x24ca9e(0x1604)]?_0x24ca9e(0x1604):'')+'\x20'+(_0x29b65e?_0x24ca9e(0x1a68):'')+'\x20'+(_0x109abb['isShared']?_0x24ca9e(0xcec):'')+_0x24ca9e(0x964)+_0x109abb['id']+_0x24ca9e(0x360)+escapeHtml(_0x109abb[_0x24ca9e(0x222f)])+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22appointment-item-right\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22appointment-countdown\x20'+_0x4b2c7b+'\x22>'+_0x2c744e+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22appointment-item-details\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22appointment-detail-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22appointment-detail-left\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22appointment-detail-name\x22>'+escapeHtml(_0x109abb[_0x24ca9e(0x222f)])+_0x24ca9e(0xb3d)+(_0x109abb['neverExpires']?'长期约定':formatAppointmentDate(_0x109abb[_0x24ca9e(0x1c5b)],_0x109abb[_0x24ca9e(0x8e1)]))+_0x24ca9e(0xbaf)+getAppointmentTypeText(_0x109abb)+_0x24ca9e(0x2277)+_0x109abb['id']+'\x27)\x22\x20title=\x22编辑约定\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-edit\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x109abb[_0x24ca9e(0x1c6f)]?_0x24ca9e(0x16c6)+escapeHtml(_0x109abb[_0x24ca9e(0x1c6f)])+_0x24ca9e(0x12f8):'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x2c1c1f?'<p><strong>相关角色：</strong>'+_0x2c1c1f['name']+_0x24ca9e(0x12f8):'')+_0x24ca9e(0xbc6)+(_0x109abb[_0x24ca9e(0x129a)]?_0x24ca9e(0xdde)+escapeHtml(_0x109abb['characterQuote'])+_0x24ca9e(0x2223):'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22appointment-item-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(!_0x109abb['completed']?_0x24ca9e(0x19b5)+_0x109abb['id']+'\x27)\x22>完成</button>':_0x24ca9e(0xf48))+_0x24ca9e(0x1770)+_0x109abb['id']+_0x24ca9e(0x15b1);})[_0x2bb8c1(0x140c)]('');}function getStatusText(_0x293eb9){const _0x1b969e=_0x2cf6d4;switch(_0x293eb9){case _0x1b969e(0x1604):return'已完成';case _0x1b969e(0x1a68):return _0x1b969e(0x1d27);case'pending':return _0x1b969e(0x398);default:return _0x1b969e(0x398);}}function toggleAppointmentExpansion(_0x178a4e){const _0x55c5d9=_0x2cf6d4,_0x955db8=document[_0x55c5d9(0x15b8)](_0x55c5d9(0x10af)+_0x178a4e+'\x22]');_0x955db8&&_0x955db8[_0x55c5d9(0x226e)]['toggle'](_0x55c5d9(0x5c2));}function renderPinnedAppointment(_0x35741b){const _0xb3f72=_0x2cf6d4,_0x559aef=document['getElementById'](_0xb3f72(0x1ece)),_0x4aa176=new Date(),_0x308d4d=_0x4aa176['getFullYear'](),_0x19e01f=_0x35741b[_0xb3f72(0x103e)]||_0xb3f72(0xcd4);let _0x19631d='',_0x536f32='';if(_0x35741b[_0xb3f72(0x517)])_0x19631d='∞',_0x536f32='';else{const _0x112d6f=new Date(_0x35741b[_0xb3f72(0x1c5b)]+'\x20'+(_0x35741b[_0xb3f72(0x8e1)]||_0xb3f72(0x8d3)));if(_0x19e01f===_0xb3f72(0x762)){const _0x5940fd=new Date(_0x4aa176[_0xb3f72(0x885)](),_0x4aa176[_0xb3f72(0x17f3)](),_0x4aa176[_0xb3f72(0x1d02)]()),_0x2cd70c=new Date(_0x112d6f['getFullYear'](),_0x112d6f[_0xb3f72(0x17f3)](),_0x112d6f['getDate']()),_0x2baa95=Math[_0xb3f72(0x1dac)]((_0x5940fd-_0x2cd70c)/(0x3e8*0x3c*0x3c*0x18));_0x19631d=_0x2baa95===0x0?'今天':''+_0x2baa95,_0x536f32=_0x2baa95===0x0?'':'天';}else{const _0x3ddf2e=new Date(_0x4aa176[_0xb3f72(0x885)](),_0x4aa176[_0xb3f72(0x17f3)](),_0x4aa176[_0xb3f72(0x1d02)]()),_0x560238=new Date(_0x112d6f[_0xb3f72(0x885)](),_0x112d6f[_0xb3f72(0x17f3)](),_0x112d6f['getDate']()),_0xa7ff78=Math[_0xb3f72(0x1dac)]((_0x560238-_0x3ddf2e)/(0x3e8*0x3c*0x3c*0x18));_0x19631d=_0xa7ff78===0x0?'今天':_0xa7ff78===0x1?'明天':_0xa7ff78<0x0?''+Math[_0xb3f72(0x2424)](_0xa7ff78):''+_0xa7ff78,_0x536f32=_0xa7ff78===0x0?'':_0xa7ff78===0x1?'':_0xa7ff78<0x0?'天前':'天';}}const _0x558a35=_0x35741b[_0xb3f72(0x10df)]?characters[_0xb3f72(0x1aeb)](_0x126c64=>_0x126c64['id']===_0x35741b[_0xb3f72(0x10df)]):null,_0xaf40cf=_0x35741b['backgroundImage']?'<div\x20class=\x22pinned-card-background\x22\x20style=\x22background-image:\x20url(\x27'+_0x35741b[_0xb3f72(0x1584)]+_0xb3f72(0x1b54):'';let _0x540cc8='';(_0x35741b[_0xb3f72(0x21cd)]||_0x558a35)&&(_0x540cc8=_0xb3f72(0x240),_0x558a35&&(_0x540cc8+='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-avatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22'+(_0x558a35[_0xb3f72(0x107f)]||_0x558a35[_0xb3f72(0x10f9)]||createDefaultAvatar(_0x558a35[_0xb3f72(0x222f)]))+_0xb3f72(0x1ca8)+_0x558a35[_0xb3f72(0x222f)]+_0xb3f72(0x248c)+_0x558a35['name'][_0xb3f72(0x1518)](0x0)+_0xb3f72(0xc9e)),_0x35741b['userAvatar']&&(_0x540cc8+=_0xb3f72(0x1ca4)+_0x35741b[_0xb3f72(0x21cd)]+_0xb3f72(0x1cb8)),_0x540cc8+=_0xb3f72(0xa54));const _0x24d716=_0x35741b[_0xb3f72(0x23df)]||_0xb3f72(0x9dd),_0x3d3d11=getAppointmentTypeText(_0x35741b),_0x3aba94=getPriorityText(_0x35741b[_0xb3f72(0x1d2d)]),_0x26e7b0=_0x35741b[_0xb3f72(0x1d2d)]||_0xb3f72(0x1e86),_0xbef196=_0x35741b[_0xb3f72(0x229c)]?_0xb3f72(0x16d6)+escapeHtml(_0x35741b['userQuote'])+_0xb3f72(0x897):'',_0x4bb28d=_0x35741b[_0xb3f72(0x129a)]?_0xb3f72(0x8a6)+(_0x558a35?_0x558a35[_0xb3f72(0x222f)]:'角色')+_0xb3f72(0x743)+escapeHtml(_0x35741b[_0xb3f72(0x129a)])+_0xb3f72(0x897):'';_0x559aef[_0xb3f72(0xc02)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0xaf40cf+_0xb3f72(0x207a)+_0x540cc8+_0xb3f72(0x1228)+_0x24d716+'\x22>'+_0x3d3d11+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-main\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-title\x22>'+escapeHtml(_0x35741b['name'])+_0xb3f72(0xc79)+_0x19631d+_0xb3f72(0x1fa1)+_0x536f32+_0xb3f72(0xf2c)+(_0x35741b['neverExpires']?_0xb3f72(0x16f4):(_0x19e01f===_0xb3f72(0x762)?_0xb3f72(0x1e05):_0xb3f72(0x6a5))+'\x20'+formatAppointmentDate(_0x35741b[_0xb3f72(0x1c5b)],_0x35741b[_0xb3f72(0x8e1)]))+_0xb3f72(0xdeb)+_0xbef196+_0xb3f72(0x529)+_0x4bb28d+_0xb3f72(0x2245)+_0x35741b['id']+'\x27)\x22\x20title=\x22取消置顶\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-thumbtack\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-priority-badge\x20'+_0x26e7b0+'\x22>'+_0x3aba94+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x559aef[_0xb3f72(0x1f26)]['appointmentId']=_0x35741b['id'],_0x559aef['onclick']=function(_0x4c3c46){const _0x5c9ebe=_0xb3f72;!_0x4c3c46[_0x5c9ebe(0x1144)][_0x5c9ebe(0x2026)](_0x5c9ebe(0x247f))&&showAppointmentForm(_0x35741b['id']);};}async function toggleAppointmentComplete(_0x1e1257){const _0x5f5a3a=_0x2cf6d4;try{const _0x4cd843=appointments[_0x5f5a3a(0x1aeb)](_0x266c8b=>_0x266c8b['id']===_0x1e1257);_0x4cd843&&(_0x4cd843[_0x5f5a3a(0x1604)]=!_0x4cd843['completed'],await db[_0x5f5a3a(0x1ae2)][_0x5f5a3a(0x53a)](_0x4cd843),renderAppointmentList(),showToast(_0x4cd843[_0x5f5a3a(0x1604)]?_0x5f5a3a(0x2314):_0x5f5a3a(0x1067),_0x5f5a3a(0xb27)));}catch(_0x5235df){console[_0x5f5a3a(0x24ab)](_0x5f5a3a(0x1eba),_0x5235df),showToast(_0x5f5a3a(0x2ba),'error');}}async function deleteAppointment(_0x2e19cb){const _0x29b2c1=_0x2cf6d4;if(confirm(_0x29b2c1(0xff6)))try{await db[_0x29b2c1(0x1ae2)][_0x29b2c1(0xc2b)](_0x2e19cb),appointments=appointments['filter'](_0x5f05a7=>_0x5f05a7['id']!==_0x2e19cb),renderAppointmentList(),showToast(_0x29b2c1(0xa0),_0x29b2c1(0xb27));}catch(_0x563756){console[_0x29b2c1(0x24ab)](_0x29b2c1(0x1131),_0x563756),showToast(_0x29b2c1(0x315),_0x29b2c1(0x24ab));}}async function unpinAppointment(_0x5ae639){const _0x5b81a3=_0x2cf6d4;try{const _0x50ab0b=appointments[_0x5b81a3(0x1aeb)](_0x1bceff=>_0x1bceff['id']===_0x5ae639);_0x50ab0b&&(_0x50ab0b[_0x5b81a3(0x23bd)]=![],await db[_0x5b81a3(0x1ae2)][_0x5b81a3(0x53a)](_0x50ab0b),renderAppointmentList(),showToast('已取消置顶，现在可以删除了',_0x5b81a3(0xb27)));}catch(_0xe3bf0e){console[_0x5b81a3(0x24ab)](_0x5b81a3(0x17e2),_0xe3bf0e),showToast(_0x5b81a3(0x2ba),'error');}}function formatAppointmentDate(_0x2b987,_0x45a31a){const _0x3f9ad9=_0x2cf6d4,_0x39af32=new Date(_0x2b987);let _0x2d3af0=_0x39af32[_0x3f9ad9(0x17f3)]()+0x1+'月'+_0x39af32[_0x3f9ad9(0x1d02)]()+'日';if(_0x45a31a){const [_0x9cc3b,_0x25eb51]=_0x45a31a[_0x3f9ad9(0x633)](':');_0x2d3af0+='\x20'+_0x9cc3b+':'+_0x25eb51;}return _0x2d3af0;}function getPriorityText(_0x31cfcf){const _0x5935bd={'low':'低','medium':'中','high':'高','urgent':'紧急'};return _0x5935bd[_0x31cfcf]||'中';}function getAppointmentTypeText(_0x38ab59){const _0x580653=_0x2cf6d4;if(_0x38ab59[_0x580653(0x46c)])return _0x38ab59['customType'];const _0x450be3={'date':'约会','promise':'承诺','activity':'活动','meeting':'见面','task':'任务','other':'其他'};return _0x450be3[_0x38ab59[_0x580653(0x23df)]]||'其他';}async function createAnniversaryByCharacter(_0x42fc00,_0x1e402c){const _0xea3293=_0x2cf6d4;try{const _0x3409e3=characters[_0xea3293(0x1aeb)](_0x57cdda=>_0x57cdda['id']===_0x42fc00);if(!_0x3409e3)return console[_0xea3293(0x24ab)](_0xea3293(0x23db),_0x42fc00),![];let _0x401382=_0x1e402c['characterQuote'];!_0x401382&&(_0x401382=generatePersonalizedQuote(_0x3409e3,_0xea3293(0xe32),_0x1e402c));const _0x520110={'id':'anniversary_'+Date[_0xea3293(0x18e0)]()+'_'+Math[_0xea3293(0x191c)]()[_0xea3293(0x9a3)](0x24)[_0xea3293(0x18cf)](0x2,0x9),'name':_0x1e402c[_0xea3293(0x222f)],'date':_0x1e402c[_0xea3293(0x1c5b)],'type':_0x1e402c[_0xea3293(0x23df)]||_0xea3293(0x9dd),'characterId':_0x42fc00,'description':_0x1e402c[_0xea3293(0x1c6f)]||'','characterQuote':_0x401382,'yearly':_0x1e402c[_0xea3293(0xb4b)]!==![],'isShared':!![],'createdBy':_0xea3293(0xfbe),'timestamp':Date[_0xea3293(0x18e0)]()};return await db[_0xea3293(0x2c5)]['add'](_0x520110),anniversaries[_0xea3293(0x6ee)](_0x520110),document[_0xea3293(0x566)]('anniversary-screen')[_0xea3293(0x655)][_0xea3293(0x2526)]!==_0xea3293(0xfe9)&&renderAnniversaryList(),createAnniversaryNotification(_0x3409e3,_0x520110,_0xea3293(0x9a6)),console[_0xea3293(0xc0d)]('✅\x20'+_0x3409e3[_0xea3293(0x222f)]+_0xea3293(0x15ef)+_0x1e402c[_0xea3293(0x222f)]),!![];}catch(_0x57d992){return console[_0xea3293(0x24ab)](_0xea3293(0xa02),_0x57d992),![];}}async function createAppointmentByCharacter(_0x42d5c7,_0x2b8fa1){const _0x211892=_0x2cf6d4;try{const _0x72e93c=characters['find'](_0x3b5430=>_0x3b5430['id']===_0x42d5c7);if(!_0x72e93c)return console[_0x211892(0x24ab)]('角色不存在:',_0x42d5c7),![];let _0x4b171f=_0x2b8fa1[_0x211892(0x129a)];!_0x4b171f&&(_0x4b171f=generatePersonalizedQuote(_0x72e93c,_0x211892(0xd84),_0x2b8fa1));const _0x3ca5c5=_0x2b8fa1[_0x211892(0x517)]===!![],_0x2fa8f6={'id':_0x211892(0x1083)+Date[_0x211892(0x18e0)]()+'_'+Math['random']()[_0x211892(0x9a3)](0x24)[_0x211892(0x18cf)](0x2,0x9),'name':_0x2b8fa1['name'],'date':_0x3ca5c5?null:_0x2b8fa1[_0x211892(0x1c5b)],'time':_0x3ca5c5?null:_0x2b8fa1[_0x211892(0x8e1)]||'','type':_0x2b8fa1[_0x211892(0x23df)]||_0x211892(0x9dd),'characterId':_0x42d5c7,'description':_0x2b8fa1[_0x211892(0x1c6f)]||'','characterQuote':_0x4b171f,'priority':_0x2b8fa1[_0x211892(0x1d2d)]||_0x211892(0x1e86),'completed':![],'isShared':!![],'createdBy':'character','neverExpires':_0x3ca5c5,'timestamp':Date[_0x211892(0x18e0)]()};return await db[_0x211892(0x1ae2)][_0x211892(0xe1)](_0x2fa8f6),appointments['push'](_0x2fa8f6),document['getElementById']('anniversary-screen')[_0x211892(0x655)][_0x211892(0x2526)]!=='none'&&renderAppointmentList(),createAppointmentNotification(_0x72e93c,_0x2fa8f6,_0x211892(0x9a6)),console['log']('✅\x20'+_0x72e93c[_0x211892(0x222f)]+_0x211892(0x1412)+_0x2b8fa1[_0x211892(0x222f)]),!![];}catch(_0x3f20e3){return console['error'](_0x211892(0x23ea),_0x3f20e3),![];}}function generatePersonalizedQuote(_0x8cb898,_0x588a4c,_0x2b7637){const _0x24b557=_0x2cf6d4,_0x51b539=_0x8cb898[_0x24b557(0x222f)],_0x5eb211=_0x8cb898[_0x24b557(0x205)]||'',_0x1b9056=_0x5eb211[_0x24b557(0x23ec)]('温柔')||_0x5eb211['includes']('温和')||_0x5eb211[_0x24b557(0x23ec)]('善良'),_0x73f3a=_0x5eb211[_0x24b557(0x23ec)]('活泼')||_0x5eb211[_0x24b557(0x23ec)]('开朗')||_0x5eb211[_0x24b557(0x23ec)]('调皮'),_0x4d353b=_0x5eb211[_0x24b557(0x23ec)]('冷酷')||_0x5eb211['includes']('高冷')||_0x5eb211[_0x24b557(0x23ec)]('傲娇'),_0x5a32e0=_0x5eb211[_0x24b557(0x23ec)]('严肃')||_0x5eb211[_0x24b557(0x23ec)]('认真')||_0x5eb211[_0x24b557(0x23ec)]('正经'),_0x35652b={'anniversary':{'birthday':[..._0x1b9056?[_0x51b539+_0x24b557(0x1aca),_0x51b539+'：\x22又是一年生日，希望你每天都开心。\x22',_0x51b539+_0x24b557(0x2304)]:[],..._0x73f3a?[_0x51b539+_0x24b557(0x16d3),_0x51b539+'：\x22哇！又是生日了，时间过得好快呀！\x22',_0x51b539+'：\x22生日耶！我们一定要好好庆祝！\x22']:[],..._0x4d353b?[_0x51b539+_0x24b557(0x16a2),_0x51b539+_0x24b557(0x1146),_0x51b539+_0x24b557(0x154d)]:[],..._0x5a32e0?[_0x51b539+_0x24b557(0xd71),_0x51b539+'：\x22又是一年生日，时间的流逝让人深思。\x22',_0x51b539+_0x24b557(0x233)]:[],_0x51b539+_0x24b557(0xc00),_0x51b539+'：\x22又是一年生日，时间过得真快啊。\x22',_0x51b539+'：\x22生日是值得庆祝的日子，我会记住的。\x22'],'relationship':[..._0x1b9056?[_0x51b539+_0x24b557(0x20a8),_0x51b539+_0x24b557(0x10c1)]:[],..._0x73f3a?[_0x51b539+'：\x22从那天开始，我们就是特别的关系啦！\x22',_0x51b539+'：\x22那一刻超级重要的！我永远不会忘记！\x22']:[],..._0x4d353b?[_0x51b539+_0x24b557(0x1d1d),_0x51b539+_0x24b557(0x15f5)]:[],_0x51b539+'：\x22从那天开始，我们的关系就不一样了。\x22',_0x51b539+_0x24b557(0x1476)],'anniversary':[_0x51b539+'：\x22这个日子对我们来说意义非凡。\x22',_0x51b539+_0x24b557(0x18bb),_0x51b539+'：\x22这是值得纪念的美好时光。\x22'],'other':[_0x51b539+_0x24b557(0x2398),_0x51b539+'：\x22我想把这个日子记录下来。\x22',_0x51b539+_0x24b557(0x21fc)]},'appointment':{'date':[..._0x1b9056?[_0x51b539+_0x24b557(0xae7),_0x51b539+_0x24b557(0x1047)]:[],..._0x73f3a?[_0x51b539+'：\x22约会约会！不见不散哦～\x22',_0x51b539+_0x24b557(0xf60)]:[],..._0x4d353b?[_0x51b539+'：\x22约定就是约定，我会去的。\x22',_0x51b539+'：\x22这个时间，我记住了。\x22']:[],_0x51b539+_0x24b557(0xe23),_0x51b539+_0x24b557(0xf12)],'promise':[..._0x5a32e0?[_0x51b539+_0x24b557(0x1501),_0x51b539+_0x24b557(0x2b6)]:[],_0x51b539+_0x24b557(0x22db),_0x51b539+_0x24b557(0x2a9)],'activity':[_0x51b539+_0x24b557(0x1fa9),_0x51b539+_0x24b557(0x1fe8)],'other':[_0x51b539+_0x24b557(0x12c),_0x51b539+_0x24b557(0x236b)]}},_0x1d5520=_0x35652b[_0x588a4c]||{},_0xde830f=_0x1d5520[_0x2b7637[_0x24b557(0x23df)]]||_0x1d5520[_0x24b557(0x9dd)]||[];if(_0xde830f[_0x24b557(0xcbf)]===0x0)return _0x588a4c==='anniversary'?_0x51b539+_0x24b557(0x2398):_0x51b539+_0x24b557(0x12c);return _0xde830f[Math[_0x24b557(0x1dac)](Math[_0x24b557(0x191c)]()*_0xde830f[_0x24b557(0xcbf)])];}function createAnniversaryNotification(_0x5a488a,_0x5bb3bb,_0x351032){const _0x1eaeaf=_0x2cf6d4;let _0x22059e='',_0x5dccb1='';if(_0x351032===_0x1eaeaf(0x9a6)){_0x5dccb1='🎉';switch(_0x5bb3bb[_0x1eaeaf(0x23df)]){case _0x1eaeaf(0x8ad):_0x22059e=_0x5dccb1+'\x20'+_0x5a488a['name']+'\x20记录了生日：'+_0x5bb3bb[_0x1eaeaf(0x222f)];break;case _0x1eaeaf(0x18ba):_0x22059e=_0x5dccb1+'\x20'+_0x5a488a[_0x1eaeaf(0x222f)]+_0x1eaeaf(0x428)+_0x5bb3bb[_0x1eaeaf(0x222f)];break;case _0x1eaeaf(0xe32):_0x22059e=_0x5dccb1+'\x20'+_0x5a488a[_0x1eaeaf(0x222f)]+_0x1eaeaf(0x99d)+_0x5bb3bb[_0x1eaeaf(0x222f)];break;default:_0x22059e=_0x5dccb1+'\x20'+_0x5a488a['name']+_0x1eaeaf(0x553)+_0x5bb3bb[_0x1eaeaf(0x222f)];}}else{if(_0x351032==='reminder'){_0x5dccb1='📅';const _0x1c2b6d=new Date(),_0x314554=new Date(_0x5bb3bb['date']),_0xf03a17=_0x314554[_0x1eaeaf(0x111b)]()===_0x1c2b6d[_0x1eaeaf(0x111b)]();_0xf03a17?_0x22059e=_0x5dccb1+_0x1eaeaf(0x182c)+_0x5bb3bb[_0x1eaeaf(0x222f)]+'！'+_0x5a488a['name']+'想和你一起纪念':_0x22059e=_0x5dccb1+'\x20'+_0x5a488a[_0x1eaeaf(0x222f)]+_0x1eaeaf(0x2372)+_0x5bb3bb[_0x1eaeaf(0x222f)];}}createPushNotification(_0x5a488a,_0x22059e,0x96);}function createAppointmentNotification(_0x585482,_0x59bdcd,_0x46692d){const _0x68621a=_0x2cf6d4;let _0x1c477d='',_0x5877ee='';if(_0x46692d===_0x68621a(0x9a6)){_0x5877ee='📝';switch(_0x59bdcd[_0x68621a(0x23df)]){case _0x68621a(0x1c5b):_0x1c477d=_0x5877ee+'\x20'+_0x585482[_0x68621a(0x222f)]+_0x68621a(0x1111)+_0x59bdcd[_0x68621a(0x222f)];break;case'promise':_0x1c477d=_0x5877ee+'\x20'+_0x585482['name']+_0x68621a(0x2461)+_0x59bdcd['name'];break;case _0x68621a(0x1ccb):_0x1c477d=_0x5877ee+'\x20'+_0x585482[_0x68621a(0x222f)]+_0x68621a(0x1329)+_0x59bdcd[_0x68621a(0x222f)];break;case _0x68621a(0x2016):_0x1c477d=_0x5877ee+'\x20'+_0x585482[_0x68621a(0x222f)]+_0x68621a(0x1757)+_0x59bdcd['name'];break;default:_0x1c477d=_0x5877ee+'\x20'+_0x585482[_0x68621a(0x222f)]+_0x68621a(0x21a2)+_0x59bdcd['name'];}}else{if(_0x46692d===_0x68621a(0xa07)){_0x5877ee='⏰';const _0x2845b2=new Date(),_0x128aba=new Date(_0x59bdcd['date']),_0x216a02=_0x128aba[_0x68621a(0x111b)]()===_0x2845b2['toDateString']();if(_0x216a02){const _0x31cf28=_0x59bdcd[_0x68621a(0x8e1)]?'\x20'+_0x59bdcd[_0x68621a(0x8e1)]:'';_0x1c477d=_0x5877ee+_0x68621a(0xff)+_0x31cf28+'是'+_0x59bdcd['name']+'！'+_0x585482[_0x68621a(0x222f)]+'在等你';}else _0x1c477d=_0x5877ee+'\x20'+_0x585482[_0x68621a(0x222f)]+_0x68621a(0x2372)+_0x59bdcd[_0x68621a(0x222f)];}}createPushNotification(_0x585482,_0x1c477d,0x96);}async function detectAnniversaryCreationInAIReply(_0x4cb589,_0x351fa3,_0x26f573){const _0x5dd712=_0x2cf6d4,_0x78c383=characters[_0x5dd712(0x1aeb)](_0xa121fc=>_0xa121fc['id']===_0x4cb589);if(!_0x78c383)return;console['log']('🔍\x20检测AI回复中的纪念日创建意图...'),console[_0x5dd712(0xc0d)]('AI回复:',_0x351fa3),console[_0x5dd712(0xc0d)](_0x5dd712(0x22ef),_0x26f573);const _0x3db059=['创建纪念日',_0x5dd712(0x22b2),_0x5dd712(0x1ade),_0x5dd712(0x147b),_0x5dd712(0x1ab4),_0x5dd712(0xce),_0x5dd712(0x210d),_0x5dd712(0x107c),_0x5dd712(0x790),_0x5dd712(0x139f),_0x5dd712(0x1cce),_0x5dd712(0x518)],_0x3a1d5c=_0x3db059[_0x5dd712(0x184b)](_0x2c55f9=>_0x351fa3[_0x5dd712(0x23ec)](_0x2c55f9));if(_0x3a1d5c){console[_0x5dd712(0xc0d)](_0x5dd712(0x45a));let _0x1d0bfd='特别的日子',_0x57de8b=_0x5dd712(0x9dd),_0x4a8bb4=new Date()[_0x5dd712(0xa4b)]()[_0x5dd712(0x633)]('T')[0x0];const _0x3f7ccb=_0x351fa3['match'](/(\d{4})年(\d{1,2})月(\d{1,2})日|(\d{1,2})月(\d{1,2})日/);if(_0x3f7ccb){if(_0x3f7ccb[0x1]&&_0x3f7ccb[0x2]&&_0x3f7ccb[0x3])_0x4a8bb4=_0x3f7ccb[0x1]+'-'+_0x3f7ccb[0x2][_0x5dd712(0x863)](0x2,'0')+'-'+_0x3f7ccb[0x3][_0x5dd712(0x863)](0x2,'0');else{if(_0x3f7ccb[0x4]&&_0x3f7ccb[0x5]){const _0x1e1225=new Date()['getFullYear']();_0x4a8bb4=_0x1e1225+'-'+_0x3f7ccb[0x4][_0x5dd712(0x863)](0x2,'0')+'-'+_0x3f7ccb[0x5][_0x5dd712(0x863)](0x2,'0');}}}const _0x4a19d8=_0x351fa3[_0x5dd712(0x1316)](/纪念日.*?[：:]\s*([^。！？\n]+)|名称.*?[：:]\s*([^。！？\n]+)|叫做\s*([^。！？\n]+)/);_0x4a19d8&&(_0x1d0bfd=(_0x4a19d8[0x1]||_0x4a19d8[0x2]||_0x4a19d8[0x3])['trim']());if(_0x351fa3['includes']('生日')||_0x26f573[_0x5dd712(0x23ec)]('生日')){_0x57de8b=_0x5dd712(0x8ad);if(!_0x4a19d8)_0x1d0bfd='生日';}else{if(_0x351fa3[_0x5dd712(0x23ec)](_0x5dd712(0x1e45))||_0x26f573[_0x5dd712(0x23ec)](_0x5dd712(0x1e45))){_0x57de8b=_0x5dd712(0x894);if(!_0x4a19d8)_0x1d0bfd='我们的第一次';}else{if(_0x351fa3['includes']('相遇')||_0x351fa3['includes']('认识')){_0x57de8b='meeting';if(!_0x4a19d8)_0x1d0bfd=_0x5dd712(0x1bf);}}}console[_0x5dd712(0xc0d)]('📝\x20解析出的纪念日信息:',{'name':_0x1d0bfd,'date':_0x4a8bb4,'type':_0x57de8b});const _0x30a396={'name':_0x1d0bfd,'date':_0x4a8bb4,'type':_0x57de8b,'description':'由'+_0x78c383[_0x5dd712(0x222f)]+_0x5dd712(0x236e)},_0xdc892e=await createAnniversaryByCharacter(_0x4cb589,_0x30a396);_0xdc892e?console[_0x5dd712(0xc0d)]('✅\x20纪念日创建成功！'):console[_0x5dd712(0x24ab)](_0x5dd712(0x1479));}}async function checkAnniversaryReminders(){const _0x170254=_0x2cf6d4,_0x3af654=new Date(),_0x33a42e=_0x3af654[_0x170254(0xa4b)]()[_0x170254(0x633)]('T')[0x0],_0x31d840=new Date(_0x3af654);_0x31d840['setDate'](_0x31d840[_0x170254(0x1d02)]()+0x1);const _0x2fb4bf=_0x31d840[_0x170254(0xa4b)]()[_0x170254(0x633)]('T')[0x0];console[_0x170254(0xc0d)](_0x170254(0x2182));const _0x5dff8d=_0x3af654[_0x170254(0x1471)](),_0x2655b1=_0x5dff8d===0x8||_0x5dff8d===0x14;for(const _0x2831d3 of anniversaries){if(_0x2831d3[_0x170254(0x10df)]&&_0x2831d3[_0x170254(0x7e7)]){const _0x37f1c9=characters[_0x170254(0x1aeb)](_0x4cc6e2=>_0x4cc6e2['id']===_0x2831d3[_0x170254(0x10df)]);if(!_0x37f1c9)continue;const _0x26c155=new Date(_0x2831d3[_0x170254(0x1c5b)]),_0x1fdca0=new Date(_0x3af654[_0x170254(0x885)](),_0x26c155[_0x170254(0x17f3)](),_0x26c155[_0x170254(0x1d02)]()),_0xc1685=_0x1fdca0[_0x170254(0xa4b)]()[_0x170254(0x633)]('T')[0x0];if(_0xc1685===_0x33a42e&&_0x2655b1){const _0x37ba45=await checkIfAlreadyReminded(_0x37f1c9['id'],_0x2831d3['id'],_0x170254(0x1b45));!_0x37ba45&&(await triggerAnniversaryReminder(_0x37f1c9,_0x2831d3,_0x170254(0x1b45)),await markAsReminded(_0x37f1c9['id'],_0x2831d3['id'],_0x170254(0x1b45)));}else{if(_0xc1685===_0x2fb4bf&&_0x5dff8d===0x14){const _0x43208f=await checkIfAlreadyReminded(_0x37f1c9['id'],_0x2831d3['id'],_0x170254(0x69b));!_0x43208f&&(await triggerAnniversaryReminder(_0x37f1c9,_0x2831d3,_0x170254(0x69b)),await markAsReminded(_0x37f1c9['id'],_0x2831d3['id'],_0x170254(0x69b)));}}}}for(const _0x5dcf49 of appointments){if(_0x5dcf49[_0x170254(0x10df)]&&_0x5dcf49[_0x170254(0x7e7)]&&!_0x5dcf49[_0x170254(0x1604)]&&!_0x5dcf49[_0x170254(0x517)]){const _0x3d3dc5=characters[_0x170254(0x1aeb)](_0x5d478b=>_0x5d478b['id']===_0x5dcf49[_0x170254(0x10df)]);if(!_0x3d3dc5)continue;if(_0x5dcf49[_0x170254(0x1c5b)]===_0x33a42e&&_0x2655b1){const _0x23bb78=await checkIfAlreadyReminded(_0x3d3dc5['id'],_0x5dcf49['id'],_0x170254(0x1b45));!_0x23bb78&&(await triggerAppointmentReminder(_0x3d3dc5,_0x5dcf49,_0x170254(0x1b45)),await markAsReminded(_0x3d3dc5['id'],_0x5dcf49['id'],'today'));}else{if(_0x5dcf49['date']===_0x2fb4bf&&_0x5dff8d===0x14){const _0x19f023=await checkIfAlreadyReminded(_0x3d3dc5['id'],_0x5dcf49['id'],'tomorrow');!_0x19f023&&(await triggerAppointmentReminder(_0x3d3dc5,_0x5dcf49,_0x170254(0x69b)),await markAsReminded(_0x3d3dc5['id'],_0x5dcf49['id'],_0x170254(0x69b)));}}}}}async function checkIfAlreadyReminded(_0x1b3d44,_0x321c39,_0x5bbb7e){const _0x1f85e0=_0x2cf6d4,_0x11ca9c=new Date()[_0x1f85e0(0xa4b)]()[_0x1f85e0(0x633)]('T')[0x0],_0x2b511f=_0x1f85e0(0x544)+_0x1b3d44+'_'+_0x321c39+'_'+_0x5bbb7e+'_'+_0x11ca9c;return localStorage[_0x1f85e0(0x2250)](_0x2b511f)!==null;}async function markAsReminded(_0x296877,_0x1cd930,_0x389402){const _0x31453a=_0x2cf6d4,_0x5e47b9=new Date()['toISOString']()[_0x31453a(0x633)]('T')[0x0],_0xda3518=_0x31453a(0x544)+_0x296877+'_'+_0x1cd930+'_'+_0x389402+'_'+_0x5e47b9;localStorage['setItem'](_0xda3518,'true');}async function triggerAnniversaryReminder(_0x15e717,_0x1a5904,_0x458d2a){const _0x4236a6=_0x2cf6d4,_0x3942ef=_0x458d2a==='today'?'今天':'明天',_0x2a5519=_0x15e717['personality']||'',_0x4afdfa=_0x2a5519[_0x4236a6(0x23ec)]('温柔')||_0x2a5519[_0x4236a6(0x23ec)]('温和'),_0x5a5975=_0x2a5519[_0x4236a6(0x23ec)]('活泼')||_0x2a5519[_0x4236a6(0x23ec)]('开朗'),_0x5a62a5=_0x2a5519['includes']('冷酷')||_0x2a5519[_0x4236a6(0x23ec)]('高冷');let _0x204cdb=[];if(_0x4afdfa)_0x204cdb=[_0x3942ef+'是'+_0x1a5904['name']+'呢，你还记得吗？',_0x3942ef+_0x4236a6(0x18af)+_0x1a5904['name']+'。',_0x4236a6(0x2472)+_0x3942ef+'是'+_0x1a5904[_0x4236a6(0x222f)]+'，心情有点特别呢。'];else{if(_0x5a5975)_0x204cdb=[_0x4236a6(0x1aea)+_0x3942ef+'是'+_0x1a5904[_0x4236a6(0x222f)]+_0x4236a6(0x1a19),_0x3942ef+'是'+_0x1a5904[_0x4236a6(0x222f)]+_0x4236a6(0xc8b),_0x1a5904[_0x4236a6(0x222f)]+'就在'+_0x3942ef+'！要庆祝一下吗？'];else _0x5a62a5?_0x204cdb=[_0x3942ef+'是'+_0x1a5904[_0x4236a6(0x222f)]+_0x4236a6(0x1ca0),_0x1a5904[_0x4236a6(0x222f)]+'，'+_0x3942ef+'。',_0x3942ef+_0x4236a6(0x12da)+_0x1a5904[_0x4236a6(0x222f)]+'呢。']:_0x204cdb=[_0x3942ef+'是'+_0x1a5904[_0x4236a6(0x222f)]+'呢，你还记得吗？',_0x3942ef+'是个特别的日子——'+_0x1a5904[_0x4236a6(0x222f)]+'。',_0x4236a6(0x210e)+_0x3942ef+'是'+_0x1a5904[_0x4236a6(0x222f)]+'哦。',_0x1a5904[_0x4236a6(0x222f)]+'就在'+_0x3942ef+_0x4236a6(0xd4f)];}const _0x4e1c25=_0x204cdb[Math[_0x4236a6(0x1dac)](Math['random']()*_0x204cdb[_0x4236a6(0xcbf)])];await sendCharacterReminderMessage(_0x15e717['id'],_0x4e1c25),createAnniversaryNotification(_0x15e717,_0x1a5904,_0x4236a6(0xa07));}async function triggerAppointmentReminder(_0x5212cf,_0xb754a7,_0x2963cc){const _0x3e3b86=_0x2cf6d4,_0x2ed6c9=_0x2963cc===_0x3e3b86(0x1b45)?'今天':'明天',_0x5c5ae7=_0xb754a7[_0x3e3b86(0x8e1)]?'\x20'+_0xb754a7[_0x3e3b86(0x8e1)]:'',_0x2834a7=_0x5212cf[_0x3e3b86(0x205)]||'',_0x210bd2=_0x2834a7['includes']('温柔')||_0x2834a7[_0x3e3b86(0x23ec)]('温和'),_0x8e009c=_0x2834a7['includes']('活泼')||_0x2834a7[_0x3e3b86(0x23ec)]('开朗'),_0x3aef6c=_0x2834a7[_0x3e3b86(0x23ec)]('冷酷')||_0x2834a7['includes']('高冷');let _0x20f875=[];if(_0x210bd2)_0x20f875=[''+_0x2ed6c9+_0x5c5ae7+'我们有约定——'+_0xb754a7[_0x3e3b86(0x222f)]+_0x3e3b86(0x2350),_0x3e3b86(0x23a9)+_0x2ed6c9+_0x5c5ae7+'是'+_0xb754a7['name']+'的时间。',_0xb754a7[_0x3e3b86(0x222f)]+'就在'+_0x2ed6c9+_0x5c5ae7+'，我很期待呢。'];else{if(_0x8e009c)_0x20f875=[''+_0x2ed6c9+_0x5c5ae7+_0x3e3b86(0x1adc)+_0xb754a7[_0x3e3b86(0x222f)]+_0x3e3b86(0xfb8),'哇！'+_0xb754a7[_0x3e3b86(0x222f)]+'就在'+_0x2ed6c9+_0x5c5ae7+_0x3e3b86(0x512),_0x3e3b86(0x1212)+_0xb754a7[_0x3e3b86(0x222f)]+'是'+_0x2ed6c9+_0x5c5ae7+_0x3e3b86(0x2072)];else _0x3aef6c?_0x20f875=[''+_0x2ed6c9+_0x5c5ae7+_0x3e3b86(0x12da)+_0xb754a7[_0x3e3b86(0x222f)]+'。',_0xb754a7[_0x3e3b86(0x222f)]+'，'+_0x2ed6c9+_0x5c5ae7+_0x3e3b86(0x40b),_0x3e3b86(0xb5a)+_0x2ed6c9+_0x5c5ae7+'。']:_0x20f875=[''+_0x2ed6c9+_0x5c5ae7+'我们有约定——'+_0xb754a7[_0x3e3b86(0x222f)]+_0x3e3b86(0x22e3),_0x3e3b86(0x1e19)+_0x2ed6c9+_0x5c5ae7+'是'+_0xb754a7[_0x3e3b86(0x222f)]+'的时间。',_0xb754a7[_0x3e3b86(0x222f)]+'就在'+_0x2ed6c9+_0x5c5ae7+_0x3e3b86(0x512),_0x3e3b86(0x1212)+_0xb754a7[_0x3e3b86(0x222f)]+'是'+_0x2ed6c9+_0x5c5ae7+'呢。'];}const _0x2c19f5=_0x20f875[Math[_0x3e3b86(0x1dac)](Math[_0x3e3b86(0x191c)]()*_0x20f875[_0x3e3b86(0xcbf)])];await sendCharacterReminderMessage(_0x5212cf['id'],_0x2c19f5),createAppointmentNotification(_0x5212cf,_0xb754a7,_0x3e3b86(0xa07));}async function sendCharacterReminderMessage(_0x296845,_0xa09f29){const _0x2a4e78=_0x2cf6d4,_0x3d7f35=characters[_0x2a4e78(0x1aeb)](_0x51a729=>_0x51a729['id']===_0x296845);if(!_0x3d7f35)return;const _0x3779c5={'id':_0x2a4e78(0x1b01)+Date[_0x2a4e78(0x18e0)]()+'-'+Math[_0x2a4e78(0x191c)]()[_0x2a4e78(0x9a3)](0x24)['substr'](0x2,0x9),'content':[{'type':_0x2a4e78(0x1e58),'text':_0xa09f29}],'text':_0xa09f29,'timestamp':Date['now'](),'isUser':![],'isReminder':!![],'sender':_0x2a4e78(0x232)};!chatMessages[_0x296845]&&(chatMessages[_0x296845]=[]);chatMessages[_0x296845][_0x2a4e78(0x6ee)](_0x3779c5);try{const _0x410cec=_0x296845+_0x2a4e78(0x24fe)+_0x3779c5[_0x2a4e78(0x7aa)]+'_'+Math[_0x2a4e78(0x191c)]()[_0x2a4e78(0x9a3)](0x24)['substr'](0x2,0x9)+'_'+(chatMessages[_0x296845][_0x2a4e78(0xcbf)]-0x1);await db[_0x2a4e78(0x464)][_0x2a4e78(0xe1)]({'id':_0x410cec,'characterId':_0x296845,'timestamp':_0x3779c5[_0x2a4e78(0x7aa)],'messageOrder':chatMessages[_0x296845][_0x2a4e78(0xcbf)]-0x1,'originalMessageId':_0x3779c5['id'],'messageData':_0x3779c5});}catch(_0x9f70a){console['error'](_0x2a4e78(0x1f17),_0x9f70a);}currentChatCharacter&&currentChatCharacter['id']===_0x296845&&(addMessageWithAnimation(_0x3779c5,_0x296845),setTimeout(()=>{const _0x2e1642=_0x2a4e78,_0x29086b=document['querySelectorAll'](_0x2e1642(0x1407)),_0x15b782=_0x29086b[_0x29086b[_0x2e1642(0xcbf)]-0x1];if(_0x15b782){const _0x3ec3ed=_0x15b782[_0x2e1642(0x15b8)]('.message-bubble');_0x3ec3ed&&_0x3ec3ed[_0x2e1642(0x226e)][_0x2e1642(0xe1)](_0x2e1642(0x1a64));}},0x64));renderMessageList();const _0x4a7f4c=_0x2a4e78(0xe38)+_0x3d7f35[_0x2a4e78(0x222f)]+':\x20'+_0xa09f29;createPushNotification(_0x3d7f35,_0x4a7f4c,0xb4);}function initAnniversaryReminderSystem(){const _0x210366=_0x2cf6d4;console['log'](_0x210366(0x8b4));const _0x5adccd=()=>{const _0x208493=_0x210366,_0x398a31=new Date(),_0x391084=_0x398a31[_0x208493(0x1471)](),_0x173548=_0x398a31[_0x208493(0x21c6)]();(_0x391084===0x8||_0x391084===0x14)&&_0x173548<0x5&&(console[_0x208493(0xc0d)](_0x208493(0x9bb)+_0x391084+':'+_0x173548[_0x208493(0x9a3)]()['padStart'](0x2,'0')),checkAnniversaryReminders());};setTimeout(()=>{_0x5adccd();},0x1388),setInterval(_0x5adccd,0x5*0x3c*0x3e8),console[_0x210366(0xc0d)](_0x210366(0x2122));}window[_0x2cf6d4(0x18d5)]=createAnniversaryByCharacter,window[_0x2cf6d4(0x829)]=createAppointmentByCharacter,window[_0x2cf6d4(0x2a2)]=async function(_0x5ee1c6){const _0x53651f=_0x2cf6d4,_0x58b5c1=characters[_0x53651f(0x1aeb)](_0xc7411e=>_0xc7411e['id']===_0x5ee1c6);if(!_0x58b5c1){console[_0x53651f(0x24ab)]('角色不存在');return;}const _0x388972={'name':_0x53651f(0x217a),'date':new Date()[_0x53651f(0xa4b)]()['split']('T')[0x0],'type':'other','description':_0x53651f(0x10db)};await createAnniversaryByCharacter(_0x5ee1c6,_0x388972),console[_0x53651f(0xc0d)](_0x53651f(0x7d0));},window[_0x2cf6d4(0x16ec)]=async function(_0xd231b7){const _0x361497=_0x2cf6d4,_0x567457=characters[_0x361497(0x1aeb)](_0x304350=>_0x304350['id']===_0xd231b7);if(!_0x567457){console[_0x361497(0x24ab)]('角色不存在');return;}const _0xd38ca0={'name':_0x361497(0x248b),'date':new Date()[_0x361497(0xa4b)]()[_0x361497(0x633)]('T')[0x0],'type':_0x361497(0x9dd),'description':_0x361497(0x22b5)};await createAppointmentByCharacter(_0xd231b7,_0xd38ca0),console[_0x361497(0xc0d)]('✅\x20测试约定创建成功');};async function checkForNaturalAnniversaryMention(_0x566eda,_0x5bf7c5){const _0x4a90a6=_0x2cf6d4,_0x1d1b08=characters[_0x4a90a6(0x1aeb)](_0x29493a=>_0x29493a['id']===_0x566eda);if(!_0x1d1b08)return;const _0x33c0a2=['今天是几号',_0x4a90a6(0x579),_0x4a90a6(0x1bbd),_0x4a90a6(0x15a9),'哪天',_0x4a90a6(0x1075),'有什么安排',_0x4a90a6(0x16cc)],_0x3b9ffb=_0x33c0a2[_0x4a90a6(0x184b)](_0x2b6a69=>_0x5bf7c5[_0x4a90a6(0x23ec)](_0x2b6a69));if(_0x3b9ffb&&Math[_0x4a90a6(0x191c)]()<0.1){const _0xa7397b=new Date(),_0x3a0668=anniversaries[_0x4a90a6(0x803)](_0x3c17c4=>_0x3c17c4['characterId']===_0x566eda&&_0x3c17c4['isShared']),_0x29ecbc=appointments[_0x4a90a6(0x803)](_0x35ede3=>_0x35ede3['characterId']===_0x566eda&&_0x35ede3[_0x4a90a6(0x7e7)]&&!_0x35ede3[_0x4a90a6(0x1604)]),_0x5d2718=[..._0x3a0668,..._0x29ecbc][_0x4a90a6(0xf6d)](_0x51bd41=>{const _0x5ccd68=_0x4a90a6,_0x5d1f3a=new Date(_0x51bd41[_0x5ccd68(0x1c5b)]),_0x4d76b5=Math[_0x5ccd68(0x1462)]((_0x5d1f3a-_0xa7397b)/(0x3e8*0x3c*0x3c*0x18));return{..._0x51bd41,'daysDiff':_0x4d76b5,'isAnniversary':!!_0x51bd41['yearly']};})['filter'](_0xa43837=>_0xa43837[_0x4a90a6(0x3bf)]>=0x0&&_0xa43837[_0x4a90a6(0x3bf)]<=0x3)[_0x4a90a6(0x1f0d)]((_0xe40c,_0x20a262)=>_0xe40c[_0x4a90a6(0x3bf)]-_0x20a262[_0x4a90a6(0x3bf)]);if(_0x5d2718[_0x4a90a6(0xcbf)]>0x0){const _0xc28f1e=_0x5d2718[0x0];let _0x197df5='';if(_0xc28f1e[_0x4a90a6(0x3bf)]===0x0)_0x197df5=_0x4a90a6(0xdf7)+_0xc28f1e[_0x4a90a6(0x222f)]+'呢。';else _0xc28f1e['daysDiff']===0x1?_0x197df5=_0x4a90a6(0x1ce2)+_0xc28f1e[_0x4a90a6(0x222f)]+'。':_0x197df5=_0x4a90a6(0x1d45)+_0xc28f1e['daysDiff']+_0x4a90a6(0xe1b)+_0xc28f1e['name']+'。';await sendCharacterReminderMessage(_0x566eda,_0x197df5);}}}window['manualCreateAnniversary']=async function(_0x10d3b5,_0x203ec3,_0x183165,_0x553000='other'){const _0x35183d=_0x2cf6d4,_0x2495d9={'name':_0x203ec3,'date':_0x183165,'type':_0x553000,'description':_0x35183d(0x11e)+(_0x553000===_0x35183d(0x8ad)?'生日':_0x35183d(0xad0))};return await createAnniversaryByCharacter(_0x10d3b5,_0x2495d9);},window['manualCreateAppointment']=async function(_0x1b65de,_0x5c3ee1,_0x35cb95,_0x4a0939='other',_0x17aac3=![]){const _0x22a438=_0x2cf6d4,_0x884021={'name':_0x5c3ee1,'date':_0x35cb95,'type':_0x4a0939,'description':_0x22a438(0x1555),'neverExpires':_0x17aac3};return await createAppointmentByCharacter(_0x1b65de,_0x884021);},window[_0x2cf6d4(0x1ea3)]={'checkReminders':()=>checkAnniversaryReminders(),'createTestAnniversary':async(_0x4d407e,_0x2c4084=_0x2cf6d4(0x217a))=>{const _0x45a0a4=_0x2cf6d4,_0x1dce7b=new Date()['toISOString']()[_0x45a0a4(0x633)]('T')[0x0];return await window[_0x45a0a4(0x2057)](_0x4d407e,_0x2c4084,_0x1dce7b,'other');},'createTestAppointment':async(_0x20128d,_0x42fb46='测试约定',_0xcbf580=![])=>{const _0x16a858=_0x2cf6d4,_0x3c12a5=new Date()[_0x16a858(0xa4b)]()[_0x16a858(0x633)]('T')[0x0];return await window[_0x16a858(0x1771)](_0x20128d,_0x42fb46,_0x3c12a5,_0x16a858(0x9dd),_0xcbf580);},'listAnniversaries':()=>{const _0x4c7304=_0x2cf6d4;console[_0x4c7304(0xf98)](anniversaries[_0x4c7304(0xf6d)](_0x543f5d=>({'id':_0x543f5d['id'],'name':_0x543f5d[_0x4c7304(0x222f)],'date':_0x543f5d['date'],'character':characters[_0x4c7304(0x1aeb)](_0x2efe83=>_0x2efe83['id']===_0x543f5d[_0x4c7304(0x10df)])?.[_0x4c7304(0x222f)]||'未知','quote':_0x543f5d[_0x4c7304(0x129a)]})));},'listAppointments':()=>{const _0x8e3b8b=_0x2cf6d4;console[_0x8e3b8b(0xf98)](appointments[_0x8e3b8b(0xf6d)](_0x372c80=>({'id':_0x372c80['id'],'name':_0x372c80[_0x8e3b8b(0x222f)],'date':_0x372c80['date'],'character':characters['find'](_0x20c668=>_0x20c668['id']===_0x372c80[_0x8e3b8b(0x10df)])?.[_0x8e3b8b(0x222f)]||'未知','quote':_0x372c80[_0x8e3b8b(0x129a)],'completed':_0x372c80[_0x8e3b8b(0x1604)]})));}},console['log'](_0x2cf6d4(0x340)),window[_0x2cf6d4(0x17cf)]=async function(){const _0x454134=_0x2cf6d4;if(characters[_0x454134(0xcbf)]===0x0){console[_0x454134(0x24ab)]('❌\x20没有角色可用于测试');return;}const _0x5726a6=characters[0x0];console[_0x454134(0xc0d)](_0x454134(0x175),_0x5726a6[_0x454134(0x222f)]);const _0x3d55cb={'name':_0x454134(0x217a),'date':new Date()[_0x454134(0xa4b)]()[_0x454134(0x633)]('T')[0x0],'type':_0x454134(0x9dd),'description':_0x454134(0x10db)};console[_0x454134(0xc0d)](_0x454134(0x552),_0x3d55cb);try{const _0x4c1b93=await createAnniversaryByCharacter(_0x5726a6['id'],_0x3d55cb);return console['log'](_0x454134(0x21ec),_0x4c1b93),console[_0x454134(0xc0d)](_0x454134(0x452),anniversaries[_0x454134(0xcbf)]),console[_0x454134(0xc0d)]('📋\x20最新的纪念日:',anniversaries[anniversaries[_0x454134(0xcbf)]-0x1]),_0x4c1b93;}catch(_0x56886a){return console['error'](_0x454134(0x2155),_0x56886a),![];}},window[_0x2cf6d4(0xa6)]=async function(){const _0x2a6968=_0x2cf6d4;if(characters[_0x2a6968(0xcbf)]===0x0){console['error'](_0x2a6968(0x6a6));return;}const _0x1a4742=characters[0x0];console[_0x2a6968(0xc0d)](_0x2a6968(0x175),_0x1a4742[_0x2a6968(0x222f)]);const _0x24002e={'name':_0x2a6968(0x248b),'date':new Date()[_0x2a6968(0xa4b)]()[_0x2a6968(0x633)]('T')[0x0],'type':_0x2a6968(0x9dd),'description':_0x2a6968(0x22b5)};console[_0x2a6968(0xc0d)](_0x2a6968(0x2406),_0x24002e);try{const _0x46d242=await createAppointmentByCharacter(_0x1a4742['id'],_0x24002e);return console[_0x2a6968(0xc0d)](_0x2a6968(0x21ec),_0x46d242),console[_0x2a6968(0xc0d)]('📊\x20当前约定数量:',appointments[_0x2a6968(0xcbf)]),console['log'](_0x2a6968(0x183c),appointments[appointments[_0x2a6968(0xcbf)]-0x1]),_0x46d242;}catch(_0x2038f7){return console[_0x2a6968(0x24ab)]('❌\x20测试失败:',_0x2038f7),![];}};function formatDate(_0xddf92){const _0x4d2810=_0x2cf6d4,_0xb9f0ea=new Date(_0xddf92),_0x2a17bf=[_0x4d2810(0x28f),'星期一','星期二',_0x4d2810(0x194),'星期四',_0x4d2810(0x13ec),_0x4d2810(0x1081)],_0x386984=_0xb9f0ea[_0x4d2810(0x885)](),_0x311641=_0xb9f0ea['getMonth']()+0x1,_0x2b1bac=_0xb9f0ea[_0x4d2810(0x1d02)](),_0x1e1a1f=_0x2a17bf[_0xb9f0ea['getDay']()];return _0x386984+'-'+_0x311641+'-'+_0x2b1bac+'\x20'+_0x1e1a1f;}function getTypeText(_0x9b0e60){const _0x863ad0=_0x2cf6d4;if(_0x9b0e60[_0x863ad0(0x46c)])return _0x9b0e60['customType'];const _0x34a04b={'birthday':'生日','relationship':_0x863ad0(0x1b81),'anniversary':_0x863ad0(0xad0),'holiday':'节日','family':'家人生日','other':'其他'};return _0x34a04b[_0x9b0e60['type']]||'其他';}function getAppointmentTypeText(_0x1413b0){const _0x19d4a1=_0x2cf6d4;if(_0x1413b0[_0x19d4a1(0x46c)])return _0x1413b0['customType'];const _0x553820={'date':'约会','meeting':'会面','travel':'旅行','event':'活动','work':'工作','study':'学习','health':'健康','other':'其他'};return _0x553820[_0x1413b0[_0x19d4a1(0x23df)]]||'其他';}function handleAnniversaryBackgroundUpload(_0x41e4bc){const _0x39d57c=_0x2cf6d4;if(_0x41e4bc[_0x39d57c(0x173e)]&&_0x41e4bc[_0x39d57c(0x173e)][0x0]){const _0x34eb55=_0x41e4bc[_0x39d57c(0x173e)][0x0],_0x3defae=new FileReader();_0x3defae['onload']=function(_0x39a55b){const _0x56d05e=_0x39d57c;document[_0x56d05e(0x566)]('anniversary-background-img')[_0x56d05e(0x107)]=_0x39a55b[_0x56d05e(0x1144)]['result'],document['getElementById'](_0x56d05e(0x227e))['style'][_0x56d05e(0x2526)]=_0x56d05e(0x2d4);},_0x3defae[_0x39d57c(0x145e)](_0x34eb55);}}function handleAnniversaryUserAvatarUpload(_0x4d5de9){const _0x891e9b=_0x2cf6d4;if(_0x4d5de9[_0x891e9b(0x173e)]&&_0x4d5de9[_0x891e9b(0x173e)][0x0]){const _0x3fe5c0=_0x4d5de9['files'][0x0],_0x32f766=new FileReader();_0x32f766['onload']=function(_0x5495ca){const _0x1647a0=_0x891e9b;document['getElementById'](_0x1647a0(0x22a))[_0x1647a0(0x107)]=_0x5495ca[_0x1647a0(0x1144)][_0x1647a0(0x1fff)],document[_0x1647a0(0x566)](_0x1647a0(0x1ce5))['style'][_0x1647a0(0x2526)]=_0x1647a0(0x2d4);},_0x32f766[_0x891e9b(0x145e)](_0x3fe5c0);}}function removeAnniversaryBackground(){const _0x143e95=_0x2cf6d4;document[_0x143e95(0x566)](_0x143e95(0x1c71))[_0x143e95(0xc34)]='',document['getElementById'](_0x143e95(0x227e))[_0x143e95(0x655)][_0x143e95(0x2526)]=_0x143e95(0xfe9),document[_0x143e95(0x566)]('anniversary-background-img')['src']='';}function removeAnniversaryUserAvatar(){const _0x5b64cd=_0x2cf6d4;document['getElementById'](_0x5b64cd(0xea0))[_0x5b64cd(0xc34)]='',document[_0x5b64cd(0x566)]('anniversary-user-avatar-preview')[_0x5b64cd(0x655)][_0x5b64cd(0x2526)]=_0x5b64cd(0xfe9),document[_0x5b64cd(0x566)]('anniversary-user-avatar-img')['src']='';}function handleAppointmentBackgroundUpload(_0x395e21){const _0x587914=_0x2cf6d4;if(_0x395e21[_0x587914(0x173e)]&&_0x395e21[_0x587914(0x173e)][0x0]){const _0x1fcbd6=_0x395e21['files'][0x0],_0x4ed107=new FileReader();_0x4ed107[_0x587914(0xc28)]=function(_0x5dc1b6){const _0x567344=_0x587914;document['getElementById']('appointment-background-img')[_0x567344(0x107)]=_0x5dc1b6[_0x567344(0x1144)][_0x567344(0x1fff)],document['getElementById'](_0x567344(0x2a4))[_0x567344(0x655)][_0x567344(0x2526)]=_0x567344(0x2d4);},_0x4ed107[_0x587914(0x145e)](_0x1fcbd6);}}function handleAppointmentUserAvatarUpload(_0x36046d){const _0x11ff4b=_0x2cf6d4;if(_0x36046d[_0x11ff4b(0x173e)]&&_0x36046d[_0x11ff4b(0x173e)][0x0]){const _0xd1e474=_0x36046d[_0x11ff4b(0x173e)][0x0],_0x407231=new FileReader();_0x407231[_0x11ff4b(0xc28)]=function(_0xf8f84c){const _0x2ad46b=_0x11ff4b;document[_0x2ad46b(0x566)]('appointment-user-avatar-img')['src']=_0xf8f84c[_0x2ad46b(0x1144)][_0x2ad46b(0x1fff)],document[_0x2ad46b(0x566)](_0x2ad46b(0x776))[_0x2ad46b(0x655)][_0x2ad46b(0x2526)]='block';},_0x407231[_0x11ff4b(0x145e)](_0xd1e474);}}function removeAppointmentBackground(){const _0x2fa325=_0x2cf6d4;document[_0x2fa325(0x566)](_0x2fa325(0x9b4))[_0x2fa325(0xc34)]='',document[_0x2fa325(0x566)](_0x2fa325(0x2a4))['style'][_0x2fa325(0x2526)]=_0x2fa325(0xfe9),document['getElementById'](_0x2fa325(0xbb6))['src']='';}function removeAppointmentUserAvatar(){const _0x1e7ee6=_0x2cf6d4;document['getElementById'](_0x1e7ee6(0x15be))[_0x1e7ee6(0xc34)]='',document[_0x1e7ee6(0x566)](_0x1e7ee6(0x776))[_0x1e7ee6(0x655)][_0x1e7ee6(0x2526)]='none',document[_0x1e7ee6(0x566)]('appointment-user-avatar-img')[_0x1e7ee6(0x107)]='';}function renderPinnedAnniversary(_0x13f323){const _0x3fc74a=_0x2cf6d4,_0x3e6919=document['getElementById']('pinned-anniversary-card'),_0x5781be=new Date(),_0x2bdac6=_0x5781be[_0x3fc74a(0x885)](),_0x5d0983=new Date(_0x13f323[_0x3fc74a(0x1c5b)]),_0x116610=_0x13f323[_0x3fc74a(0x103e)]||'countdown';let _0x5c577f='',_0x4482f4='';if(_0x116610===_0x3fc74a(0x762)){const _0x41b4c4=new Date(_0x5781be['getFullYear'](),_0x5781be[_0x3fc74a(0x17f3)](),_0x5781be[_0x3fc74a(0x1d02)]()),_0x500546=new Date(_0x5d0983[_0x3fc74a(0x885)](),_0x5d0983['getMonth'](),_0x5d0983[_0x3fc74a(0x1d02)]()),_0x38d896=Math['floor']((_0x41b4c4-_0x500546)/(0x3e8*0x3c*0x3c*0x18));_0x5c577f=_0x38d896===0x0?'今天':''+_0x38d896,_0x4482f4=_0x38d896===0x0?'':'天';}else{const _0x32d7e8=new Date(_0x5781be[_0x3fc74a(0x885)](),_0x5781be['getMonth'](),_0x5781be['getDate']());let _0x373350=new Date(_0x2bdac6,_0x5d0983[_0x3fc74a(0x17f3)](),_0x5d0983['getDate']());_0x373350<_0x32d7e8&&_0x373350[_0x3fc74a(0x20b9)](_0x2bdac6+0x1);const _0x610a5b=Math[_0x3fc74a(0x1dac)]((_0x373350-_0x32d7e8)/(0x3e8*0x3c*0x3c*0x18));_0x5c577f=_0x610a5b===0x0?'今天':_0x610a5b===0x1?'明天':''+_0x610a5b,_0x4482f4=_0x610a5b===0x0?'':_0x610a5b===0x1?'':'天';}const _0x38c29f=_0x13f323['characterId']?characters['find'](_0x3999f3=>_0x3999f3['id']===_0x13f323[_0x3fc74a(0x10df)]):null,_0x28c4a2=_0x13f323[_0x3fc74a(0x1584)]?'<div\x20class=\x22pinned-card-background\x22\x20style=\x22background-image:\x20url(\x27'+_0x13f323[_0x3fc74a(0x1584)]+_0x3fc74a(0x1b54):'';let _0x418e63='';(_0x13f323['userAvatar']||_0x38c29f)&&(_0x418e63=_0x3fc74a(0x240),_0x38c29f&&(_0x418e63+=_0x3fc74a(0x1ca4)+(_0x38c29f[_0x3fc74a(0x107f)]||_0x38c29f['avatarUrl']||createDefaultAvatar(_0x38c29f[_0x3fc74a(0x222f)]))+'\x22\x20alt=\x22'+_0x38c29f[_0x3fc74a(0x222f)]+_0x3fc74a(0x248c)+_0x38c29f[_0x3fc74a(0x222f)][_0x3fc74a(0x1518)](0x0)+_0x3fc74a(0xc9e)),_0x13f323[_0x3fc74a(0x21cd)]&&(_0x418e63+='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-avatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22'+_0x13f323[_0x3fc74a(0x21cd)]+_0x3fc74a(0x1cb8)),_0x418e63+=_0x3fc74a(0xa54));const _0x264185=_0x13f323['type']||'other',_0x35c404=getTypeText(_0x13f323),_0x24ef5a=_0x13f323[_0x3fc74a(0x229c)]?_0x3fc74a(0x16d6)+escapeHtml(_0x13f323[_0x3fc74a(0x229c)])+_0x3fc74a(0x897):'',_0x4c8167=_0x13f323[_0x3fc74a(0x129a)]?_0x3fc74a(0x8a6)+(_0x38c29f?_0x38c29f[_0x3fc74a(0x222f)]:'角色')+'：</span>'+escapeHtml(_0x13f323[_0x3fc74a(0x129a)])+_0x3fc74a(0x897):'';_0x3e6919['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x28c4a2+_0x3fc74a(0x207a)+_0x418e63+_0x3fc74a(0x1228)+_0x264185+'\x22>'+_0x35c404+_0x3fc74a(0xcf1)+escapeHtml(_0x13f323[_0x3fc74a(0x222f)])+_0x3fc74a(0xc79)+_0x5c577f+_0x3fc74a(0x1fa1)+_0x4482f4+_0x3fc74a(0xf2c)+(_0x116610===_0x3fc74a(0x762)?_0x3fc74a(0x1e05):_0x3fc74a(0x6a5))+'\x20'+formatDate(_0x13f323[_0x3fc74a(0x1c5b)])+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x24ef5a+_0x3fc74a(0x529)+_0x4c8167+_0x3fc74a(0x1830)+_0x13f323['id']+_0x3fc74a(0x8a5),_0x3e6919['dataset'][_0x3fc74a(0x110e)]=_0x13f323['id'],_0x3e6919['onclick']=function(_0x6fc2f4){const _0xbe056c=_0x3fc74a;!_0x6fc2f4[_0xbe056c(0x1144)][_0xbe056c(0x2026)](_0xbe056c(0x247f))&&showAnniversaryForm(_0x13f323['id']);};}function showNewMessageForm(){const _0x4eeffc=_0x2cf6d4;window[_0x4eeffc(0xcb4)]=null,window['selectedCharacterForSMS']=null,showSMSPersonaSelector();}function showSMSPersonaSelector(){const _0x5de654=_0x2cf6d4;renderSMSPersonaSelector(),document[_0x5de654(0x566)](_0x5de654(0x1256))['style'][_0x5de654(0x2526)]=_0x5de654(0x1f0b);}function hideSMSPersonaSelector(_0x5557ff){const _0x5ae289=_0x2cf6d4;if(_0x5557ff&&_0x5557ff[_0x5ae289(0x1144)]!==_0x5557ff[_0x5ae289(0x52b)])return;document[_0x5ae289(0x566)](_0x5ae289(0x1256))['style'][_0x5ae289(0x2526)]=_0x5ae289(0xfe9);}function showSMSCharacterSelector(){const _0x401129=_0x2cf6d4;renderSMSCharacterSelector(),document[_0x401129(0x566)](_0x401129(0xa6a))[_0x401129(0x655)]['display']=_0x401129(0x1f0b);}function hideSMSCharacterSelector(_0x31afa7){const _0x582e04=_0x2cf6d4;if(_0x31afa7&&_0x31afa7[_0x582e04(0x1144)]!==_0x31afa7[_0x582e04(0x52b)])return;document[_0x582e04(0x566)](_0x582e04(0xa6a))[_0x582e04(0x655)]['display']=_0x582e04(0xfe9);}function renderSMSPersonaSelector(){const _0x59b86d=_0x2cf6d4,_0x402edf=document[_0x59b86d(0x566)](_0x59b86d(0x1d6a));if(!_0x402edf)return;if(!personas||personas[_0x59b86d(0xcbf)]===0x0){_0x402edf[_0x59b86d(0xc02)]=_0x59b86d(0xf80);return;}const _0x5dda0c=personas[_0x59b86d(0xf6d)](_0x32e1b0=>'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-persona-item\x22\x20onclick=\x22selectSMSPersona(\x27'+_0x32e1b0['id']+_0x59b86d(0xc4)+(_0x32e1b0[_0x59b86d(0x10f9)]?_0x59b86d(0x2001)+_0x32e1b0[_0x59b86d(0x10f9)]+_0x59b86d(0x1ca8)+_0x32e1b0[_0x59b86d(0x222f)]+'\x22>':_0x59b86d(0x976))+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-item-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-item-name\x22>'+_0x32e1b0[_0x59b86d(0x222f)]+_0x59b86d(0x69d)+(_0x32e1b0[_0x59b86d(0x1c6f)]?_0x32e1b0[_0x59b86d(0x1c6f)]['substring'](0x0,0x32)+_0x59b86d(0x12da):_0x59b86d(0x2420))+_0x59b86d(0x21e3))[_0x59b86d(0x140c)]('');_0x402edf[_0x59b86d(0xc02)]=_0x5dda0c;}function renderSMSCharacterSelector(){const _0x13d720=_0x2cf6d4,_0x611eb2=document[_0x13d720(0x566)](_0x13d720(0x80f));if(!_0x611eb2)return;if(!characters||characters['length']===0x0){_0x611eb2[_0x13d720(0xc02)]='<div\x20class=\x22sms-empty-state\x22>暂无角色</div>';return;}_0x611eb2[_0x13d720(0xc02)]=characters[_0x13d720(0xf6d)](_0x440206=>_0x13d720(0x1e32)+_0x440206['id']+_0x13d720(0xc4)+(_0x440206['avatarUrl']?_0x13d720(0x2001)+_0x440206[_0x13d720(0x10f9)]+_0x13d720(0x1ca8)+_0x440206[_0x13d720(0x222f)]+'\x22>':_0x13d720(0x976))+_0x13d720(0x42c)+_0x440206['name']+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-item-desc\x22>'+(_0x440206[_0x13d720(0x1a84)]?_0x440206['bio'][_0x13d720(0x4b2)](0x0,0x32)+_0x13d720(0x12da):_0x13d720(0xc8f))+_0x13d720(0x21e3))[_0x13d720(0x140c)]('');}function selectSMSPersona(_0x4b1089){const _0x189dba=_0x2cf6d4,_0x3c4204=personas[_0x189dba(0x1aeb)](_0x411ac2=>_0x411ac2['id']===_0x4b1089);if(!_0x3c4204){showToast(_0x189dba(0x2051),_0x189dba(0x24ab));return;}window['selectedPersonaForSMS']=_0x3c4204,hideSMSPersonaSelector(),showSMSCharacterSelector();}function selectSMSCharacter(_0x5070ef){const _0x4ea7c7=_0x2cf6d4,_0x2e0873=characters[_0x4ea7c7(0x1aeb)](_0x3c5d1f=>_0x3c5d1f['id']===_0x5070ef);if(!_0x2e0873)return;window[_0x4ea7c7(0x2299)]=_0x2e0873,hideSMSCharacterSelector(),createSMSChatWithPersona(_0x2e0873,window[_0x4ea7c7(0xcb4)]);}async function createSMSChatWithPersona(_0x546614,_0x2b98a9){const _0xc6fcef=_0x2cf6d4;try{if(!_0x2b98a9){showToast(_0xc6fcef(0xecf),_0xc6fcef(0x24ab));return;}if(smsContacts[_0xc6fcef(0x23ec)](_0x546614['id'])){startSMSChat(_0x546614),showToast(_0xc6fcef(0x10f7)+_0x546614[_0xc6fcef(0x222f)]+_0xc6fcef(0x9b9),_0xc6fcef(0xb27));return;}const _0x285879=_0x546614['id'];!chatSettings[_0x285879]&&(chatSettings[_0x285879]={}),chatSettings[_0x285879][_0xc6fcef(0x6a0)]=_0x2b98a9['id'],await saveChatSettings(_0x546614['id'],chatSettings[_0x285879]),console[_0xc6fcef(0xc0d)](_0xc6fcef(0x6f8),_0x2b98a9[_0xc6fcef(0x222f)]),!smsContacts[_0xc6fcef(0x23ec)](_0x546614['id'])&&(smsContacts[_0xc6fcef(0x6ee)](_0x546614['id']),await saveSMSContacts()),!smsMessages[_0x546614['id']]&&(smsMessages[_0x546614['id']]=[]),renderSMSMessageList(),startSMSChat(_0x546614),showToast(_0xc6fcef(0xe4c)+_0x546614[_0xc6fcef(0x222f)]+_0xc6fcef(0x1897)+_0x2b98a9[_0xc6fcef(0x222f)]+'）',_0xc6fcef(0xb27));}catch(_0x13f1ff){console[_0xc6fcef(0x24ab)]('创建短信聊天失败:',_0x13f1ff),showToast('创建短信聊天失败',_0xc6fcef(0x24ab));}}function startSMSChat(_0x3f6129){const _0x4a9c2f=_0x2cf6d4;window[_0x4a9c2f(0x1bad)]=_0x3f6129,updateSMSChatHeader(_0x3f6129),renderSMSMessages(_0x3f6129['id']),document[_0x4a9c2f(0x566)](_0x4a9c2f(0x30f))[_0x4a9c2f(0x655)][_0x4a9c2f(0x2526)]='none',document['getElementById']('sms-chat-screen')[_0x4a9c2f(0x655)][_0x4a9c2f(0x2526)]=_0x4a9c2f(0x2d4),initSMSInput();}function updateSMSChatHeader(_0x212d1f){const _0x5dbca0=_0x2cf6d4,_0x132e3a=document[_0x5dbca0(0x566)](_0x5dbca0(0x5b5)),_0x3a3c21=document[_0x5dbca0(0x566)](_0x5dbca0(0x17af));_0x132e3a['textContent']=_0x212d1f[_0x5dbca0(0x222f)],_0x212d1f[_0x5dbca0(0x10f9)]?(_0x3a3c21[_0x5dbca0(0x655)]['backgroundImage']=_0x5dbca0(0xcb5)+_0x212d1f[_0x5dbca0(0x10f9)]+')',_0x3a3c21['innerHTML']=''):(_0x3a3c21[_0x5dbca0(0x655)][_0x5dbca0(0x1584)]='',_0x3a3c21[_0x5dbca0(0xc02)]=_0x5dbca0(0x976));}function updateChatHeader(){const _0x210ccc=_0x2cf6d4;if(!currentChatCharacter){console['log'](_0x210ccc(0x1ee6));return;}const _0x4756e8=document['getElementById']('api-chat-title');if(!_0x4756e8){console['log'](_0x210ccc(0x748));return;}const _0x3e7bd6=getCurrentChatSettings();console[_0x210ccc(0xc0d)](_0x210ccc(0x248e),{'aiChatNickname':_0x3e7bd6[_0x210ccc(0x1967)],'characterName':currentChatCharacter[_0x210ccc(0x222f)]});let _0x475d61=_0x3e7bd6[_0x210ccc(0x1967)]||currentChatCharacter[_0x210ccc(0x222f)];if(currentChatCharacter[_0x210ccc(0x4b7)]&&currentChatCharacter[_0x210ccc(0xcaa)]){const _0x118b39=currentChatCharacter[_0x210ccc(0xcaa)]['length']+0x1;_0x475d61=_0x475d61+'（'+_0x118b39+'）';}_0x4756e8['textContent']=_0x475d61,_0x4756e8[_0x210ccc(0x1f26)]['originalTitle']=_0x475d61,_0x4756e8[_0x210ccc(0x1f26)]['aiNicknameUpdated']='true',console['log']('✅\x20[updateChatHeader]\x20聊天头部已更新:',_0x475d61);}function showSMSTypingIndicator(){const _0x196880=_0x2cf6d4,_0xa68450=document[_0x196880(0x566)](_0x196880(0xf1));if(!_0xa68450)return;hideSMSTypingIndicator();const _0x29f5b8=document[_0x196880(0x1ad8)](_0x196880(0x526));_0x29f5b8[_0x196880(0x221)]=_0x196880(0x1310),_0x29f5b8['id']=_0x196880(0x1310),_0x29f5b8['innerHTML']=_0x196880(0x19d),_0xa68450[_0x196880(0x1925)](_0x29f5b8),setTimeout(()=>{const _0x53383b=_0x196880;_0xa68450[_0x53383b(0x5e5)]=_0xa68450[_0x53383b(0x14c8)];},0x64);}function hideSMSTypingIndicator(){const _0x5b0043=_0x2cf6d4,_0x4c8ec6=document[_0x5b0043(0x566)](_0x5b0043(0x1310));_0x4c8ec6&&_0x4c8ec6[_0x5b0043(0x128)]();}function enterSMSMultiSelectMode(_0x4a2181){const _0x37e31b=_0x2cf6d4;console[_0x37e31b(0xc0d)]('触发短信长按多选模式，消息ID:',_0x4a2181),isSMSMultiSelectMode=!![],selectedSMSMessages=new Set([_0x4a2181]);const _0x35a7b6=document[_0x37e31b(0x566)]('sms-chat-normal-actions'),_0x2ae507=document[_0x37e31b(0x566)](_0x37e31b(0x1066));if(_0x35a7b6)_0x35a7b6['style'][_0x37e31b(0x2526)]=_0x37e31b(0xfe9);if(_0x2ae507)_0x2ae507['style'][_0x37e31b(0x2526)]=_0x37e31b(0x1f0b);const _0x2b294f=window['currentSMSCharacter']?.['id'];_0x2b294f&&renderSMSMessages(_0x2b294f);}function exitSMSMultiSelectMode(){const _0x13a2a1=_0x2cf6d4;isSMSMultiSelectMode=![],selectedSMSMessages['clear']();const _0xb77c7d=document[_0x13a2a1(0x566)]('sms-chat-normal-actions'),_0x5917a7=document[_0x13a2a1(0x566)]('sms-chat-multiselect-actions');if(_0xb77c7d)_0xb77c7d[_0x13a2a1(0x655)][_0x13a2a1(0x2526)]=_0x13a2a1(0x1f0b);if(_0x5917a7)_0x5917a7['style'][_0x13a2a1(0x2526)]=_0x13a2a1(0xfe9);const _0x27eca6=window[_0x13a2a1(0x1bad)]?.['id'];_0x27eca6&&renderSMSMessages(_0x27eca6);}function toggleSMSMessageSelection(_0x4ccaf6){const _0x32fb2e=_0x2cf6d4;selectedSMSMessages[_0x32fb2e(0x1af1)](_0x4ccaf6)?selectedSMSMessages[_0x32fb2e(0xc2b)](_0x4ccaf6):selectedSMSMessages[_0x32fb2e(0xe1)](_0x4ccaf6);const _0x48536f=window[_0x32fb2e(0x1bad)]?.['id'];_0x48536f&&renderSMSMessages(_0x48536f),selectedSMSMessages[_0x32fb2e(0x41a)]===0x0&&exitSMSMultiSelectMode();}async function deleteSelectedSMSMessages(){const _0x2ad391=_0x2cf6d4;if(selectedSMSMessages[_0x2ad391(0x41a)]===0x0){showToast(_0x2ad391(0x2f5),_0x2ad391(0x24ab));return;}const _0x302ade=selectedSMSMessages['size'],_0x3c2f99=_0x2ad391(0x5d1)+_0x302ade+_0x2ad391(0x1dfb);if(confirm(_0x3c2f99))try{const _0x30d513=window[_0x2ad391(0x1bad)]?.['id'];if(!_0x30d513)return;for(const _0x29cdb2 of selectedSMSMessages){let _0x1a655c=null;if(smsMessages[_0x30d513]){const _0x603cb8=smsMessages[_0x30d513][_0x2ad391(0x23ba)](_0x40a9b8=>_0x40a9b8['id']===_0x29cdb2);_0x603cb8>-0x1&&(_0x1a655c=smsMessages[_0x30d513][_0x603cb8]);}if(_0x1a655c)try{await deleteSMSRelatedTimelineEvents(_0x1a655c,_0x30d513),console['log'](_0x2ad391(0xc80));}catch(_0x271fbc){console['error'](_0x2ad391(0xced),_0x271fbc);}if(smsMessages[_0x30d513]){const _0x48b843=smsMessages[_0x30d513]['findIndex'](_0x1abb9e=>_0x1abb9e['id']===_0x29cdb2);_0x48b843>-0x1&&smsMessages[_0x30d513][_0x2ad391(0x220f)](_0x48b843,0x1);}await db[_0x2ad391(0xd94)][_0x2ad391(0x4a6)]('id')['equals'](_0x29cdb2)[_0x2ad391(0xc2b)]();}exitSMSMultiSelectMode(),renderSMSMessages(_0x30d513),renderSMSMessageList(),showToast(_0x2ad391(0x2272)+_0x302ade+_0x2ad391(0x568),'success');}catch(_0x4edd40){console[_0x2ad391(0x24ab)](_0x2ad391(0x227),_0x4edd40),showToast(_0x2ad391(0x1c9e),_0x2ad391(0x24ab));}}async function deleteSMSMessage(_0x4d8b71,_0x899feb){const _0x4c40d9=_0x2cf6d4;try{if(!confirm(_0x4c40d9(0xe0e)))return;let _0x129baa=null;if(smsMessages[_0x899feb]){const _0xf0d5ba=smsMessages[_0x899feb][_0x4c40d9(0x23ba)](_0x300a95=>_0x300a95['id']===_0x4d8b71);_0xf0d5ba>-0x1&&(_0x129baa=smsMessages[_0x899feb][_0xf0d5ba]);}if(_0x129baa)try{await deleteSMSRelatedTimelineEvents(_0x129baa,_0x899feb),console['log'](_0x4c40d9(0xc80));}catch(_0x1621ad){console[_0x4c40d9(0x24ab)](_0x4c40d9(0xced),_0x1621ad);}if(smsMessages[_0x899feb]){const _0x35ebde=smsMessages[_0x899feb][_0x4c40d9(0x23ba)](_0x50ce27=>_0x50ce27['id']===_0x4d8b71);_0x35ebde>-0x1&&smsMessages[_0x899feb][_0x4c40d9(0x220f)](_0x35ebde,0x1);}await db[_0x4c40d9(0xd94)][_0x4c40d9(0x4a6)]('id')[_0x4c40d9(0x14a)](_0x4d8b71)[_0x4c40d9(0xc2b)](),renderSMSMessages(_0x899feb),renderSMSMessageList(),console[_0x4c40d9(0xc0d)](_0x4c40d9(0x53c)+_0x4d8b71);}catch(_0x6c0bce){console['error'](_0x4c40d9(0xa3),_0x6c0bce),showToast(_0x4c40d9(0x1c9e),_0x4c40d9(0x24ab));}}function renderSMSMessages(_0x56048c){const _0x316b35=_0x2cf6d4,_0x89d1dc=document[_0x316b35(0x566)]('sms-messages-container');if(!_0x89d1dc)return;const _0x24f4e2=getSMSChatSetting(_0x316b35(0x19f9),_0x316b35(0x1c29));_0x89d1dc[_0x316b35(0x226e)]['remove'](_0x316b35(0x131b));_0x24f4e2===_0x316b35(0x9a4)&&_0x89d1dc[_0x316b35(0x226e)]['add'](_0x316b35(0x131b));const _0x55bee4=smsMessages[_0x56048c]||[];if(_0x55bee4[_0x316b35(0xcbf)]===0x0){_0x89d1dc[_0x316b35(0xc02)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-empty-chat\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22text-align:\x20center;\x20color:\x20#999;\x20font-size:\x2014px;\x20margin-top:\x2050px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20还没有消息，开始聊天吧！\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';return;}let _0x4037c4='',_0xa16e39=null;_0x55bee4[_0x316b35(0x900)]((_0x3e3134,_0x562acb)=>{const _0x44d6ac=_0x316b35,_0xfbaa=_0x3e3134['isUser']?_0x44d6ac(0x955):_0x44d6ac(0x7fd),_0x5c77ef=new Date(_0x3e3134[_0x44d6ac(0x7aa)]),_0x740560=new Date(),_0x5724ef=new Date(_0x740560['getFullYear'](),_0x740560['getMonth'](),_0x740560[_0x44d6ac(0x1d02)]()),_0xe2bbfa=new Date(_0x5724ef[_0x44d6ac(0xa57)]()-0x18*0x3c*0x3c*0x3e8),_0x8e2962=new Date(_0x5724ef[_0x44d6ac(0xa57)]()-0x2*0x18*0x3c*0x3c*0x3e8),_0x44b15d=new Date(_0x5c77ef[_0x44d6ac(0x885)](),_0x5c77ef[_0x44d6ac(0x17f3)](),_0x5c77ef['getDate']()),_0x1879b5=_0x5724ef[_0x44d6ac(0xa57)]()-_0x44b15d[_0x44d6ac(0xa57)](),_0x29d6c6=Math[_0x44d6ac(0x1dac)](_0x1879b5/(0x3e8*0x3c*0x3c*0x18));let _0x109b82='';const _0x1814b7=_0x5c77ef[_0x44d6ac(0xd4a)](_0x44d6ac(0x1c0b),{'hour':_0x44d6ac(0x19f3),'minute':'2-digit'});if(_0x44b15d['getTime']()===_0x5724ef['getTime']())_0x109b82=_0x1814b7;else{if(_0x44b15d['getTime']()===_0xe2bbfa[_0x44d6ac(0xa57)]())_0x109b82='昨天\x20'+_0x1814b7;else{if(_0x44b15d[_0x44d6ac(0xa57)]()===_0x8e2962[_0x44d6ac(0xa57)]())_0x109b82=_0x44d6ac(0x596)+_0x1814b7;else{if(_0x29d6c6<0x7){const _0x35035b=[_0x44d6ac(0x28f),_0x44d6ac(0x1fef),_0x44d6ac(0x1e04),_0x44d6ac(0x194),'星期四',_0x44d6ac(0x13ec),_0x44d6ac(0x1081)],_0x48f4c7=_0x35035b[_0x5c77ef['getDay']()];_0x109b82=_0x48f4c7+'\x20'+_0x1814b7;}else{const _0x4e0ae1=_0x5c77ef[_0x44d6ac(0x177f)](_0x44d6ac(0x1c0b),{'month':_0x44d6ac(0xf4e),'day':_0x44d6ac(0xf4e)});_0x109b82=_0x4e0ae1+'\x20'+_0x1814b7;}}}}const _0x519e6a=!_0xa16e39||_0x5c77ef-_0xa16e39>0x5*0x3c*0x3e8||_0x562acb===0x0;_0x519e6a&&(_0x4037c4+=_0x44d6ac(0x2f3)+_0x109b82+_0x44d6ac(0xa54),_0xa16e39=_0x5c77ef);let _0x31796e='',_0x23fc6d='';if(Array[_0x44d6ac(0x1bcc)](_0x3e3134[_0x44d6ac(0x1423)])){const _0x50305c=_0x3e3134[_0x44d6ac(0x1423)][_0x44d6ac(0x1aeb)](_0x4c35b8=>_0x4c35b8[_0x44d6ac(0x23df)]===_0x44d6ac(0x1e58));_0x23fc6d=_0x50305c?_0x50305c[_0x44d6ac(0x1e58)]:'';}else _0x3e3134[_0x44d6ac(0x1e58)]&&(_0x23fc6d=_0x3e3134['text']);if(_0x3e3134[_0x44d6ac(0xfd1)]&&_0x3e3134[_0x44d6ac(0xd59)]){const _0x3f7a9f=isSMSMultiSelectMode?'':_0x44d6ac(0x1dc7)+_0x3e3134[_0x44d6ac(0xd59)]+_0x44d6ac(0x1799)+(_0x3e3134['fileName']||'图片')+_0x44d6ac(0x2274);_0x31796e=_0x44d6ac(0x9d1)+_0x3e3134[_0x44d6ac(0xd59)]+_0x44d6ac(0x1ca8)+(_0x3e3134[_0x44d6ac(0x2335)]||'图片')+_0x44d6ac(0x45b)+_0x3f7a9f+'>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';}else{const _0x2d7cac=_0x23fc6d[_0x44d6ac(0x882)](/&/g,'&amp;')[_0x44d6ac(0x882)](/</g,'&lt;')[_0x44d6ac(0x882)](/>/g,_0x44d6ac(0x571))[_0x44d6ac(0x882)](/"/g,_0x44d6ac(0xca))[_0x44d6ac(0x882)](/'/g,'&#39;');_0x31796e=_0x44d6ac(0x2468)+_0x2d7cac+_0x44d6ac(0x9ca);}_0x4037c4+='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-message\x20'+_0xfbaa+'\x20'+(selectedSMSMessages[_0x44d6ac(0x1af1)](_0x3e3134['id'])?'selected':'')+_0x44d6ac(0x793)+_0x3e3134['id']+_0x44d6ac(0x15bd)+_0x56048c+_0x44d6ac(0x2105)+_0x31796e+_0x44d6ac(0x13b);}),_0x89d1dc[_0x316b35(0xc02)]=_0x4037c4,addSMSMessageEventListeners(_0x56048c),setTimeout(()=>{const _0xe506fc=_0x316b35;_0x89d1dc[_0xe506fc(0x5e5)]=_0x89d1dc['scrollHeight'];},0x64);}function addSingleSMSMessageEventListener(_0x27ecaa,_0x535b0b){const _0x4cbc35=_0x2cf6d4,_0x1023f7=_0x27ecaa[_0x4cbc35(0x1f26)][_0x4cbc35(0x61f)];if(!_0x1023f7)return;if(isSMSMultiSelectMode)_0x27ecaa['addEventListener']('click',_0x1ddef7=>{const _0x292d00=_0x4cbc35;_0x1ddef7[_0x292d00(0x4d9)](),_0x1ddef7[_0x292d00(0x1023)](),toggleSMSMessageSelection(_0x1023f7);});else{let _0x390813=null,_0x3c7d78={'x':0x0,'y':0x0};_0x27ecaa[_0x4cbc35(0x167)]('touchstart',_0x659f7e=>{const _0x274be3=_0x4cbc35,_0x1a4dba=_0x659f7e[_0x274be3(0x1278)][0x0];_0x3c7d78['x']=_0x1a4dba['clientX'],_0x3c7d78['y']=_0x1a4dba[_0x274be3(0x11cd)],_0x390813=setTimeout(()=>{const _0x5edc98=_0x274be3;navigator[_0x5edc98(0xd8f)]&&navigator[_0x5edc98(0xd8f)](0x32),enterSMSMultiSelectMode(_0x1023f7);},0x320);}),_0x27ecaa[_0x4cbc35(0x167)](_0x4cbc35(0x1263),_0x61c0cc=>{_0x390813&&(clearTimeout(_0x390813),_0x390813=null);}),_0x27ecaa['addEventListener'](_0x4cbc35(0x1e8f),_0x48aa1a=>{const _0x3e65a7=_0x4cbc35;if(_0x390813){const _0x3908c0=_0x48aa1a[_0x3e65a7(0x1278)][0x0],_0xfad4fe=Math[_0x3e65a7(0x2424)](_0x3908c0[_0x3e65a7(0x1c1c)]-_0x3c7d78['x']),_0x405ca8=Math['abs'](_0x3908c0[_0x3e65a7(0x11cd)]-_0x3c7d78['y']);(_0xfad4fe>0xa||_0x405ca8>0xa)&&(clearTimeout(_0x390813),_0x390813=null);}}),_0x27ecaa['addEventListener']('mousedown',_0x2f1773=>{_0x2f1773['button']===0x0&&(_0x390813=setTimeout(()=>{enterSMSMultiSelectMode(_0x1023f7);},0x320));}),_0x27ecaa['addEventListener'](_0x4cbc35(0x1fb0),_0x2741c9=>{_0x390813&&(clearTimeout(_0x390813),_0x390813=null);}),_0x27ecaa[_0x4cbc35(0x167)]('mouseleave',_0x3c6538=>{_0x390813&&(clearTimeout(_0x390813),_0x390813=null);});}}function addSMSMessageEventListeners(_0x2b95a3){const _0x52e0aa=_0x2cf6d4,_0x223ec1=document[_0x52e0aa(0x1ed9)](_0x52e0aa(0x1893));_0x223ec1[_0x52e0aa(0x900)](_0x1ba6c0=>{const _0x1e60b4=_0x52e0aa,_0x5e3b20=_0x1ba6c0[_0x1e60b4(0x1f26)][_0x1e60b4(0x61f)];if(!_0x5e3b20)return;addSingleSMSMessageEventListener(_0x1ba6c0,_0x2b95a3);});}function addSMSMessageWithAnimation(_0x53ce73,_0x3bec53){const _0x23e718=_0x2cf6d4,_0x3adf7a=document['getElementById'](_0x23e718(0xf1));if(!_0x3adf7a||!window[_0x23e718(0x1bad)]||_0x3bec53!==window[_0x23e718(0x1bad)]['id'])return;!_0x53ce73['isUser']&&SoundManager[_0x23e718(0x10f4)](SoundManager[_0x23e718(0x24a1)][_0x23e718(0xca3)],_0x3bec53);const _0x5b931a=getSMSChatSetting(_0x23e718(0x19f9),_0x23e718(0x1c29));_0x3adf7a[_0x23e718(0x226e)][_0x23e718(0x128)](_0x23e718(0x131b));_0x5b931a==='green'&&_0x3adf7a['classList']['add'](_0x23e718(0x131b));const _0x1d8fc2=_0x53ce73[_0x23e718(0xc7)]?_0x23e718(0x955):'character-message',_0x2b9afc=new Date(_0x53ce73[_0x23e718(0x7aa)]),_0x2044d0=_0x2b9afc['toLocaleTimeString'](_0x23e718(0x1c0b),{'hour':_0x23e718(0x19f3),'minute':'2-digit'}),_0x1edc03=_0x3adf7a[_0x23e718(0x1ed9)](_0x23e718(0x1893));let _0x408776=![];if(_0x1edc03['length']===0x0)_0x408776=!![];else{const _0x55fc8f=_0x1edc03[_0x1edc03[_0x23e718(0xcbf)]-0x1],_0x267cbe=_0x55fc8f[_0x23e718(0x1f26)][_0x23e718(0x7aa)];(!_0x267cbe||_0x2b9afc-new Date(parseInt(_0x267cbe))>0x5*0x3c*0x3e8)&&(_0x408776=!![]);}if(_0x408776){const _0x36305e=document[_0x23e718(0x1ad8)](_0x23e718(0x526));_0x36305e[_0x23e718(0x221)]=_0x23e718(0x18c7),_0x36305e[_0x23e718(0x21dc)]=_0x2044d0,_0x3adf7a[_0x23e718(0x1925)](_0x36305e);}const _0x375b7b=document[_0x23e718(0x1ad8)](_0x23e718(0x526));_0x375b7b[_0x23e718(0x221)]=_0x23e718(0x1973)+_0x1d8fc2,_0x375b7b['dataset']['messageId']=_0x53ce73['id'],_0x375b7b[_0x23e718(0x1f26)][_0x23e718(0x10df)]=_0x3bec53,_0x375b7b[_0x23e718(0x1f26)][_0x23e718(0x7aa)]=_0x53ce73[_0x23e718(0x7aa)];let _0x11778e='',_0x15b155='';if(Array[_0x23e718(0x1bcc)](_0x53ce73['content'])){const _0x55f1cc=_0x53ce73['content'][_0x23e718(0x1aeb)](_0x5d786c=>_0x5d786c[_0x23e718(0x23df)]===_0x23e718(0x1e58));_0x15b155=_0x55f1cc?_0x55f1cc[_0x23e718(0x1e58)]:'';}else _0x53ce73[_0x23e718(0x1e58)]&&(_0x15b155=_0x53ce73[_0x23e718(0x1e58)]);if(_0x53ce73['isImage']&&_0x53ce73[_0x23e718(0xd59)]){const _0x36cfd6=isSMSMultiSelectMode?'':'onclick=\x22showImagePreview(\x27'+_0x53ce73[_0x23e718(0xd59)]+_0x23e718(0x1799)+(_0x53ce73[_0x23e718(0x2335)]||'图片')+_0x23e718(0x2274);_0x11778e=_0x23e718(0xcc6)+_0x53ce73[_0x23e718(0xd59)]+_0x23e718(0x1ca8)+(_0x53ce73['fileName']||'图片')+'\x22\x20class=\x22sms-image\x22\x20'+_0x36cfd6+_0x23e718(0x1582);}else{const _0x201c70=_0x15b155[_0x23e718(0x882)](/&/g,'&amp;')[_0x23e718(0x882)](/</g,_0x23e718(0x8bd))['replace'](/>/g,_0x23e718(0x571))[_0x23e718(0x882)](/"/g,'&quot;')[_0x23e718(0x882)](/'/g,'&#39;');_0x11778e=_0x23e718(0x11ae)+_0x201c70+_0x23e718(0x13b);}_0x375b7b['innerHTML']=_0x11778e,selectedSMSMessages[_0x23e718(0x1af1)](_0x53ce73['id'])?_0x375b7b[_0x23e718(0x226e)][_0x23e718(0xe1)]('selected'):_0x375b7b[_0x23e718(0x226e)][_0x23e718(0x128)](_0x23e718(0x876)),_0x375b7b[_0x23e718(0x655)][_0x23e718(0x671)]='0',_0x375b7b['style'][_0x23e718(0x2006)]='translateY(20px)',_0x3adf7a[_0x23e718(0x1925)](_0x375b7b),addSingleSMSMessageEventListener(_0x375b7b,_0x3bec53),requestAnimationFrame(()=>{const _0x1b378e=_0x23e718;_0x375b7b[_0x1b378e(0x655)][_0x1b378e(0x671)]='1',_0x375b7b[_0x1b378e(0x655)]['transform']=_0x1b378e(0x2429),_0x375b7b[_0x1b378e(0x655)][_0x1b378e(0x2175)]=_0x1b378e(0x2061);}),setTimeout(()=>{const _0x26accf=_0x23e718;_0x3adf7a[_0x26accf(0x5e5)]=_0x3adf7a[_0x26accf(0x14c8)];},0x64);}function hideSMSChat(){const _0x333dae=_0x2cf6d4;isSMSMultiSelectMode&&exitSMSMultiSelectMode(),document['getElementById'](_0x333dae(0x1315))[_0x333dae(0x655)]['display']='none',document[_0x333dae(0x566)](_0x333dae(0x30f))[_0x333dae(0x655)][_0x333dae(0x2526)]='block',window[_0x333dae(0x1bad)]=null;}function initSMSInput(){const _0x474878=_0x2cf6d4,_0x8f44af=document[_0x474878(0x566)](_0x474878(0x723));if(!_0x8f44af)return;_0x8f44af['addEventListener'](_0x474878(0x627),function(){const _0x152541=_0x474878,_0x3c68cc=document[_0x152541(0x566)](_0x152541(0x50e));this['value'][_0x152541(0x1424)]()?_0x3c68cc['style'][_0x152541(0x2526)]=_0x152541(0x1f0b):_0x3c68cc['style']['display']=_0x152541(0xfe9);});}function openSMSImagePicker(){const _0x1e86d0=_0x2cf6d4,_0x1e04ac=document['getElementById'](_0x1e86d0(0x1b0f));_0x1e04ac&&_0x1e04ac[_0x1e86d0(0x1e62)]();}function handleSMSImageSelect(_0x1cd933){const _0xfdc836=_0x2cf6d4,_0xb08c77=_0x1cd933[_0xfdc836(0x1144)][_0xfdc836(0x173e)][0x0];if(!_0xb08c77)return;if(!_0xb08c77[_0xfdc836(0x23df)][_0xfdc836(0x1cab)](_0xfdc836(0x1183))){showToast('请选择图片文件',_0xfdc836(0x13bb));return;}const _0x20d53d=0x5*0x400*0x400;if(_0xb08c77[_0xfdc836(0x41a)]>_0x20d53d){showToast(_0xfdc836(0x1c09),_0xfdc836(0x13bb));return;}if(!window['currentSMSCharacter']){showToast(_0xfdc836(0x1268),_0xfdc836(0x24ab));return;}const _0x76c98b=new FileReader();_0x76c98b[_0xfdc836(0xc28)]=function(_0x1c4e70){const _0xb2222d=_0xfdc836;sendSMSImage(_0x1c4e70[_0xb2222d(0x1144)][_0xb2222d(0x1fff)],_0xb08c77[_0xb2222d(0x222f)]);},_0x76c98b['readAsDataURL'](_0xb08c77),_0x1cd933[_0xfdc836(0x1144)][_0xfdc836(0xc34)]='';}async function sendSMSImage(_0x1b6620,_0x4492b7){const _0x30433b=_0x2cf6d4;if(!window['currentSMSCharacter']){showToast(_0x30433b(0x1250),_0x30433b(0x24ab));return;}const _0x1dbdd1=window[_0x30433b(0x1bad)]['id'];try{const _0x5eb592=document[_0x30433b(0x566)](_0x30433b(0x723)),_0x192f24=_0x5eb592?_0x5eb592[_0x30433b(0xc34)][_0x30433b(0x1424)]():'';console[_0x30433b(0xc0d)]('🔍\x20[sendSMSImage]\x20文本内容:',_0x192f24),console[_0x30433b(0xc0d)](_0x30433b(0x1cd9),_0x1b6620?_0x1b6620['length']:0x0);const _0x21374f=[{'type':_0x30433b(0x1e58),'text':_0x192f24}];_0x1b6620&&_0x21374f[_0x30433b(0x6ee)]({'type':_0x30433b(0x1cfa),'image_url':{'url':_0x1b6620}});console[_0x30433b(0xc0d)](_0x30433b(0x1593),_0x21374f),console[_0x30433b(0xc0d)]('🔍\x20[sendSMSImage]\x20消息内容数组长度:',_0x21374f[_0x30433b(0xcbf)]);const _0x7dd6f={'id':_0x30433b(0x1745)+Date[_0x30433b(0x18e0)]()+'-'+Math[_0x30433b(0x191c)]()[_0x30433b(0x9a3)](0x24)['substr'](0x2,0x9),'content':_0x21374f,'text':_0x192f24,'timestamp':Date['now'](),'isUser':!![],'isImage':!![],'imageUrl':_0x1b6620,'fileName':_0x4492b7};_0x5eb592&&(_0x5eb592['value']='',_0x5eb592[_0x30433b(0x2391)](new Event(_0x30433b(0x627))));!smsMessages[_0x1dbdd1]&&(smsMessages[_0x1dbdd1]=[]);smsMessages[_0x1dbdd1][_0x30433b(0x6ee)](_0x7dd6f),await saveSingleSMSMessage(_0x1dbdd1,_0x7dd6f);try{await recordCrossAppEvent(_0x1dbdd1,_0x30433b(0x1bc6),_0x30433b(0x410),{'id':_0x1dbdd1,'type':_0x30433b(0x1965),'fileName':_0x4492b7,'fileSize':_0x1b6620[_0x30433b(0xcbf)],'chatId':_0x1dbdd1,'sender':_0x30433b(0x23b2)},_0x7dd6f['id']),console[_0x30433b(0xc0d)]('📝\x20[短信时间线]\x20已记录用户发送图片事件到跨应用时间线');}catch(_0x2c1a57){console[_0x30433b(0x24ab)]('❌\x20[短信时间线]\x20记录用户发送图片事件失败:',_0x2c1a57);}addSMSMessageWithAnimation(_0x7dd6f,_0x1dbdd1),renderSMSMessageList(),console[_0x30433b(0xc0d)](_0x30433b(0x1e97));}catch(_0x47ea19){console[_0x30433b(0x24ab)](_0x30433b(0x2528),_0x47ea19),showToast(_0x30433b(0x494),'error');}}function showImagePreview(_0x4aae41,_0x1c4ff7){showImage(_0x4aae41);}function handleSMSInputKeydown(_0x345aca){const _0x3f26f1=_0x2cf6d4;_0x345aca[_0x3f26f1(0x157f)]==='Enter'&&(_0x345aca[_0x3f26f1(0x4d9)](),sendSMSMessage());}async function sendSMSMessage(){const _0x35cc78=_0x2cf6d4,_0x452770=document[_0x35cc78(0x566)](_0x35cc78(0x723)),_0x4b6b1d=_0x452770['value'][_0x35cc78(0x1424)]();if(!_0x4b6b1d){showToast('请输入消息内容',_0x35cc78(0x13bb));return;}if(!window[_0x35cc78(0x1bad)]){showToast(_0x35cc78(0x1250),_0x35cc78(0x24ab));return;}SoundManager[_0x35cc78(0x10f4)](SoundManager[_0x35cc78(0x24a1)][_0x35cc78(0x864)],window[_0x35cc78(0x1bad)]?.['id']);const _0x149ccc=window[_0x35cc78(0x1bad)]['id'],_0x10d61e={'id':'sms-'+Date[_0x35cc78(0x18e0)]()+'-'+Math[_0x35cc78(0x191c)]()[_0x35cc78(0x9a3)](0x24)['substr'](0x2,0x9),'content':[{'type':_0x35cc78(0x1e58),'text':_0x4b6b1d}],'text':_0x4b6b1d,'timestamp':Date[_0x35cc78(0x18e0)](),'isUser':!![]};!smsMessages[_0x149ccc]&&(smsMessages[_0x149ccc]=[]);smsMessages[_0x149ccc][_0x35cc78(0x6ee)](_0x10d61e),await saveSingleSMSMessage(_0x149ccc,_0x10d61e);try{await recordCrossAppEvent(_0x149ccc,_0x35cc78(0x1bc6),_0x35cc78(0x12b4),{'id':_0x149ccc,'type':_0x35cc78(0x216f),'content':_0x4b6b1d[_0x35cc78(0x4b2)](0x0,0x64),'messageLength':_0x4b6b1d[_0x35cc78(0xcbf)],'chatId':_0x149ccc,'sender':_0x35cc78(0x23b2)},_0x10d61e['id']),console['log'](_0x35cc78(0x27b));}catch(_0x1beb06){console['error']('❌\x20[短信时间线]\x20记录用户发送短信事件失败:',_0x1beb06);}_0x452770[_0x35cc78(0xc34)]='',document[_0x35cc78(0x566)](_0x35cc78(0x50e))[_0x35cc78(0x655)][_0x35cc78(0x2526)]='none',addSMSMessageWithAnimation(_0x10d61e,_0x149ccc),renderSMSMessageList();}async function triggerSMSReply(){const _0x2b9217=_0x2cf6d4;if(!window[_0x2b9217(0x1bad)]){showToast('请先选择一个角色','error');return;}const _0x2da3e3=window['currentSMSCharacter']['id'],_0x49f6c2=smsMessages[_0x2da3e3]||[];if(_0x49f6c2[_0x2b9217(0xcbf)]===0x0){showToast(_0x2b9217(0x1451),_0x2b9217(0x2422));return;}const _0x180074=_0x49f6c2[_0x49f6c2[_0x2b9217(0xcbf)]-0x1];if(!_0x180074||!_0x180074['isUser']){showToast('请先发送消息',_0x2b9217(0x2422));return;}const _0x53567b=[];for(let _0x563af4=_0x49f6c2[_0x2b9217(0xcbf)]-0x1;_0x563af4>=0x0;_0x563af4--){const _0x1d677a=_0x49f6c2[_0x563af4];if(_0x1d677a[_0x2b9217(0xc7)])_0x53567b['unshift'](_0x1d677a);else break;}try{await generateSMSReply(window[_0x2b9217(0x1bad)],_0x53567b);}catch(_0x55b0b7){console[_0x2b9217(0x24ab)](_0x2b9217(0x1c8b),_0x55b0b7),showToast('AI回复失败:\x20'+_0x55b0b7[_0x2b9217(0xd7a)],'error');}}async function buildSMSPrompt(_0x51e9c1,_0x261211){const _0x17922a=_0x2cf6d4;console['log'](_0x17922a(0x1499),_0x51e9c1['name']);const _0x31a3ef=getSMSChatSetting('historyRounds',0x32);console['log'](_0x17922a(0x2213),_0x31a3ef);const _0x5c8d0a=_0x51e9c1['id'],_0x57985d=smsMessages[_0x5c8d0a]||[],_0x312a94=_0x57985d[_0x17922a(0x136)](-_0x31a3ef);console[_0x17922a(0xc0d)]('🔥\x20[短信提示词]\x20短信历史消息数量:',_0x312a94[_0x17922a(0xcbf)]);const _0x33d52f=_0x51e9c1['id'],_0x483637=chatSettings[_0x33d52f]||{},_0x15a1f6=_0x483637['selectedIdentityId']?personas[_0x17922a(0x1aeb)](_0x5de738=>_0x5de738['id']===_0x483637['selectedIdentityId']):null;console[_0x17922a(0xc0d)](_0x17922a(0xd67),_0x15a1f6?.[_0x17922a(0x222f)]||_0x17922a(0xc2a));const _0x2c9050=isBlocked(_0x17922a(0x23b2),_0x51e9c1['id']),_0x32b9fa=isBlocked(_0x51e9c1['id'],'user'),_0x5a11d1=new Date(),_0x29d7f1=_0x5a11d1[_0x17922a(0x133a)](_0x17922a(0x1c0b),{'year':_0x17922a(0xf4e),'month':_0x17922a(0x2040),'day':_0x17922a(0xf4e),'hour':_0x17922a(0x19f3),'minute':_0x17922a(0x19f3),'weekday':_0x17922a(0x2040)}),_0x346b14=_0x5a11d1[_0x17922a(0x17f3)]()+0x1;let _0x1d0874='';if(_0x346b14>=0x3&&_0x346b14<=0x5)_0x1d0874='春季';else{if(_0x346b14>=0x6&&_0x346b14<=0x8)_0x1d0874='夏季';else{if(_0x346b14>=0x9&&_0x346b14<=0xb)_0x1d0874='秋季';else _0x1d0874='冬季';}}const _0x51886e=_0x5a11d1[_0x17922a(0x1471)]();let _0xf4bae3='';if(_0x51886e>=0x5&&_0x51886e<0x8)_0xf4bae3='清晨';else{if(_0x51886e>=0x8&&_0x51886e<0xb)_0xf4bae3='上午';else{if(_0x51886e>=0xb&&_0x51886e<0xe)_0xf4bae3='中午';else{if(_0x51886e>=0xe&&_0x51886e<0x11)_0xf4bae3='下午';else{if(_0x51886e>=0x11&&_0x51886e<0x13)_0xf4bae3='傍晚';else{if(_0x51886e>=0x13&&_0x51886e<0x16)_0xf4bae3='晚上';else{if(_0x51886e>=0x16||_0x51886e<0x2)_0xf4bae3='深夜';else _0xf4bae3='凌晨';}}}}}}const _0x4633da=_0x17922a(0x168)+_0x29d7f1+_0x17922a(0x2124)+_0x1d0874+'，'+_0xf4bae3+'时分';let _0x15af3c=_0x17922a(0xbc)+_0x51e9c1['name']+_0x17922a(0x23a2)+_0x51e9c1[_0x17922a(0x222f)]+_0x17922a(0x3b3)+(_0x51e9c1[_0x17922a(0x1a84)]||_0x51e9c1['prompt']||'暂无详细人设')+_0x17922a(0x1005)+_0x4633da+_0x17922a(0x20e0);if(_0x2c9050)_0x15af3c+=_0x17922a(0x1677);else _0x32b9fa&&(_0x15af3c+=_0x17922a(0x1c30));_0x15a1f6&&(_0x15af3c+='\x0a\x0a##\x20对话者身份\x0a用户在这个短信聊天中的身份是：'+_0x15a1f6[_0x17922a(0x222f)]+_0x17922a(0x214c)+(_0x15a1f6['description']||_0x17922a(0xafd))+'\x0a请根据用户的这个身份来进行短信对话。');const _0x46050c=_0x483637[_0x17922a(0x9af)]&&_0x483637[_0x17922a(0xefa)]?_0x483637['selectedWorldbooks']:[],_0x3eb65c=window['activeGlobalWorldbooks']||[],_0x157099=[...new Set([..._0x3eb65c,..._0x46050c])];return _0x157099[_0x17922a(0xcbf)]>0x0&&(_0x15af3c+=_0x17922a(0xca9),_0x157099[_0x17922a(0x900)](_0x2eda0f=>{const _0x56e69f=_0x17922a,_0x493cc5=worldbooks[_0x56e69f(0x1aeb)](_0xd9511d=>_0xd9511d['id']===_0x2eda0f);_0x493cc5&&(_0x15af3c+=_0x56e69f(0x104)+_0x493cc5['title']+_0x56e69f(0xa9c)+_0x493cc5[_0x56e69f(0x1423)]+'\x0a');})),_0x483637[_0x17922a(0x1de6)]!==![]&&(_0x15af3c+=_0x17922a(0x247)),_0x15af3c;}async function callSMSAPI(_0x39c5fb,_0x475fe6){const _0x6907ce=_0x2cf6d4;try{console[_0x6907ce(0xc0d)](_0x6907ce(0x2306),_0x475fe6[_0x6907ce(0x222f)]);const _0x19e89e=_0x475fe6['id'],_0x36ba7a=smsMessages[_0x19e89e]||[],_0x11c430=getSMSChatSetting(_0x6907ce(0xe90),0x32),_0x23160d=_0x36ba7a[_0x6907ce(0x136)](-_0x11c430);let _0x18b8c3='';_0x23160d[_0x6907ce(0xcbf)]>0x0&&(_0x18b8c3='\x0a\x0a##\x20短信对话历史\x0a',_0x23160d[_0x6907ce(0x900)](_0x45c63f=>{const _0x4456cd=_0x6907ce,_0x21d461=_0x45c63f[_0x4456cd(0xc7)]?'用户':_0x475fe6[_0x4456cd(0x222f)];_0x18b8c3+=_0x21d461+':\x20'+_0x45c63f['text']+'\x0a';}));let _0x3767c7='';if(_0x39c5fb[_0x6907ce(0x23ec)](_0x6907ce(0x1fb5))||_0x39c5fb[_0x6907ce(0x23ec)](_0x6907ce(0xe50))||_0x39c5fb['includes'](_0x6907ce(0xeec))){const _0x3400a9=await buildSMSPrompt(_0x475fe6,'');_0x3767c7=_0x3400a9+_0x18b8c3+(_0x6907ce(0x2184)+_0x39c5fb+_0x6907ce(0x9e9)+_0x475fe6[_0x6907ce(0x222f)]+'的身份发送短信消息。要求：\x0a-\x20体现短信聊天的简洁特点，通常1-3条消息\x0a-\x20保持与ChatApp中相同的角色性格和记忆连贯性\x0a-\x20可以延续之前在ChatApp中的话题或情感状态\x0a-\x20【重要】必须使用JSON数组格式回复\x0a-\x20体现\x22真人对话\x22的自然感\x0a-\x20如果需要发送多条消息，请分别放在数组中\x0a\x0a请回复JSON格式的短信内容：');}else{const _0x4e9ec4=await buildSMSPrompt(_0x475fe6,_0x39c5fb);_0x3767c7=_0x4e9ec4+_0x18b8c3+(_0x6907ce(0xc43)+_0x39c5fb+_0x6907ce(0x9e9)+_0x475fe6['name']+_0x6907ce(0x17ae));}if(_0x3767c7['includes'](_0x6907ce(0x23a8)))try{let _0x376953='';const _0x4c7c11=await db[_0x6907ce(0xa1b)][_0x6907ce(0x4a6)](_0x6907ce(0x10df))[_0x6907ce(0x14a)](_0x475fe6['id'])[_0x6907ce(0x18c6)]();if(_0x4c7c11[_0x6907ce(0xcbf)]>0x0){const _0x477aa2=_0x4c7c11['sort']((_0x1b8e69,_0x19271c)=>_0x19271c['importance']-_0x1b8e69[_0x6907ce(0x3d1)]);_0x376953+=_0x6907ce(0x1f45),_0x477aa2['forEach']((_0x323200,_0x28611a)=>{const _0x27ba47=_0x6907ce;_0x376953+=_0x28611a+0x1+'.\x20'+_0x323200[_0x27ba47(0x77b)]+'\x0a';});}const _0x4a710b=await db[_0x6907ce(0x222e)][_0x6907ce(0x4a6)](_0x6907ce(0x10df))[_0x6907ce(0x14a)](_0x475fe6['id'])[_0x6907ce(0x18c6)](),_0x26be95=_0x4a710b[_0x6907ce(0x1f0d)]((_0x3ab96f,_0x20962f)=>_0x20962f[_0x6907ce(0x7aa)]-_0x3ab96f[_0x6907ce(0x7aa)])['slice'](0x0,0x5);_0x26be95[_0x6907ce(0xcbf)]>0x0&&(_0x376953+='\x0a\x0a【情景记忆】以下是最近的重要经历：\x0a',_0x26be95[_0x6907ce(0x900)]((_0x4730c9,_0x4b3a80)=>{const _0x463d65=_0x6907ce;_0x376953+=_0x4b3a80+0x1+'.\x20'+_0x4730c9[_0x463d65(0x77b)]+'\x0a';}));const _0x2bd967=await getVisibleMomentsForCharacter(_0x475fe6['id'],0x3);_0x2bd967[_0x6907ce(0xcbf)]>0x0&&(_0x376953+='\x0a\x0a【动态记忆】以下是最近的动态和讨论：\x0a',_0x2bd967[_0x6907ce(0x900)]((_0x3481ca,_0x401068)=>{const _0x451fc2=_0x6907ce,_0x592976=_0x3481ca['authorId']===_0x451fc2(0x23b2)?'用户':_0x3481ca[_0x451fc2(0x201a)];let _0x405d32='';if(_0x3481ca[_0x451fc2(0x7aa)]){const _0x25305e=Date[_0x451fc2(0x18e0)](),_0xe26136=_0x25305e-_0x3481ca[_0x451fc2(0x7aa)],_0xace32f=Math[_0x451fc2(0x1dac)](_0xe26136/(0x3e8*0x3c*0x3c)),_0x1308c0=Math[_0x451fc2(0x1dac)](_0xe26136/(0x3e8*0x3c*0x3c*0x18));if(_0x1308c0>0x0)_0x405d32='\x20('+_0x1308c0+_0x451fc2(0xead);else _0xace32f>0x0?_0x405d32='\x20('+_0xace32f+_0x451fc2(0xa01):_0x405d32=_0x451fc2(0x192e);}const _0x4bfed8=_0x401068+0x1+'.\x20'+_0x592976+':\x20'+_0x3481ca[_0x451fc2(0x1e58)]+_0x405d32+(_0x3481ca[_0x451fc2(0x6a7)]||'');_0x376953+=_0x4bfed8;}));const _0x534813=await getCrossAppTimeline(_0x475fe6['id'],0x5);_0x534813[_0x6907ce(0xcbf)]>0x0&&(_0x376953+='\x0a\x0a【最近活动】以下是最近的跨应用活动：\x0a',_0x534813['forEach']((_0x5dd522,_0x5f384b)=>{const _0xe83692=_0x6907ce,_0x59804d=new Date(_0x5dd522[_0xe83692(0x7aa)])[_0xe83692(0xd4a)](_0xe83692(0x1c0b),{'hour':'2-digit','minute':_0xe83692(0x19f3)});let _0x187149='';switch(_0x5dd522[_0xe83692(0x12e0)]){case _0xe83692(0x35d):_0x187149=_0xe83692(0x3c5)+(_0x5dd522[_0xe83692(0x30b)]['action']===_0xe83692(0xb0e)?_0xe83692(0xe4):_0xe83692(0x16bf));break;case _0xe83692(0xe67):_0x187149=_0xe83692(0x179a)+(_0x5dd522[_0xe83692(0x30b)]['action']===_0xe83692(0x595)?_0xe83692(0x1840):'互动');break;case'chat':_0x187149=_0x5dd522[_0xe83692(0x23af)]===_0xe83692(0xd7a)?'用户发送消息':_0xe83692(0xfdf);break;case'sms':if(_0x5dd522[_0xe83692(0x23af)]===_0xe83692(0x12b4))_0x187149='用户发送短信';else{if(_0x5dd522[_0xe83692(0x23af)]===_0xe83692(0x10bd))_0x187149=_0xe83692(0x437);else _0x5dd522['action']==='character_initiate'?_0x187149=_0xe83692(0x1eae):_0x187149=_0xe83692(0x1bba);}break;default:_0x187149='在'+_0x5dd522[_0xe83692(0x12e0)]+'中进行'+_0x5dd522[_0xe83692(0x23af)];}_0x376953+=_0x59804d+_0xe83692(0x2316)+_0x187149+'\x0a';})),_0x376953?_0x3767c7=_0x3767c7['replace'](_0x6907ce(0x23a8),_0x376953):_0x3767c7=_0x3767c7[_0x6907ce(0x882)](_0x6907ce(0x23a8),'');}catch(_0x4f53d4){console[_0x6907ce(0x24ab)](_0x6907ce(0xd97),_0x4f53d4),_0x3767c7=_0x3767c7[_0x6907ce(0x882)]('<!--\x20DYNAMIC_MEMORY_PLACEHOLDER\x20-->','');}console[_0x6907ce(0xc0d)]('🔥\x20[短信API]\x20构建的完整提示词:',_0x3767c7);const _0x23e882=apiSettings[_0x6907ce(0x90b)][_0x6907ce(0x23ec)](_0x6907ce(0xad8));let _0x6d862d,_0x2ee17d,_0x193ff8;if(_0x23e882){const _0xdd4863=apiSettings[_0x6907ce(0x90b)]+_0x6907ce(0x1f4e)+apiSettings[_0x6907ce(0xeea)]+_0x6907ce(0x23aa)+apiSettings[_0x6907ce(0x157f)];_0x6d862d=await fetch(_0xdd4863,{'method':_0x6907ce(0x227d),'headers':{'Content-Type':'application/json'},'body':JSON['stringify']({'contents':[{'role':_0x6907ce(0x23b2),'parts':[{'text':_0x3767c7}]}],'generationConfig':{'temperature':0.8}})});if(!_0x6d862d['ok'])throw new Error('Gemini\x20API请求失败:\x20'+_0x6d862d['status']+'\x20'+_0x6d862d['statusText']);_0x2ee17d=await _0x6d862d['json'](),_0x193ff8=_0x2ee17d[_0x6907ce(0x1d23)]?.[0x0]?.[_0x6907ce(0x1423)]?.[_0x6907ce(0x23c1)]?.[0x0]?.['text'];if(!_0x193ff8){console[_0x6907ce(0xc0d)](_0x6907ce(0x13b4),_0x2ee17d);throw new Error('Gemini\x20API返回了空内容');}}else{let _0x550dc4;if(apiSettings[_0x6907ce(0x90b)][_0x6907ce(0xd7e)]('/v1'))_0x550dc4=apiSettings['base']+'/chat/completions';else apiSettings['base']['includes'](_0x6907ce(0x193c))?_0x550dc4=apiSettings[_0x6907ce(0x90b)]+_0x6907ce(0xb73):_0x550dc4=apiSettings[_0x6907ce(0x90b)]+_0x6907ce(0xce8);_0x6d862d=await fetch(_0x550dc4,{'method':_0x6907ce(0x227d),'headers':{'Content-Type':_0x6907ce(0x302),'Authorization':_0x6907ce(0x858)+apiSettings[_0x6907ce(0x157f)]},'body':JSON['stringify']({'model':apiSettings[_0x6907ce(0xeea)],'messages':[{'role':_0x6907ce(0x23b2),'content':_0x3767c7}],'temperature':0.8,'max_tokens':0xc8,'stream':![]})});if(!_0x6d862d['ok'])throw new Error(_0x6907ce(0x1cf0)+_0x6d862d[_0x6907ce(0xe54)]+'\x20'+_0x6d862d['statusText']);_0x2ee17d=await _0x6d862d[_0x6907ce(0x2318)](),_0x193ff8=_0x2ee17d['choices']?.[0x0]?.['message']?.['content'];if(!_0x193ff8){console[_0x6907ce(0xc0d)](_0x6907ce(0x20e9),_0x2ee17d);throw new Error(_0x6907ce(0x2564));}}return _0x193ff8=_0x193ff8['trim'](),console[_0x6907ce(0xc0d)](_0x6907ce(0x890),_0x193ff8),_0x193ff8;}catch(_0x2bf2b1){console[_0x6907ce(0x24ab)]('短信API调用失败:',_0x2bf2b1);throw _0x2bf2b1;}}async function generateSMSReply(_0x135def,_0x63c1c2){const _0x13ccee=_0x2cf6d4;try{console[_0x13ccee(0xc0d)](_0x13ccee(0x1922),_0x135def[_0x13ccee(0x222f)],_0x13ccee(0x22ef),_0x63c1c2),showSMSTypingIndicator(),console['log'](_0x13ccee(0x55c),_0x63c1c2);let _0x4340d2=![],_0x1916ca=[];Array[_0x13ccee(0x1bcc)](_0x63c1c2)?_0x63c1c2[_0x13ccee(0x900)](_0x2a1871=>{const _0x4520a0=_0x13ccee;if(Array['isArray'](_0x2a1871[_0x4520a0(0x1423)])){_0x1916ca[_0x4520a0(0x6ee)](..._0x2a1871[_0x4520a0(0x1423)]);const _0x3a3db7=_0x2a1871[_0x4520a0(0x1423)]['some'](_0x5a87cd=>_0x5a87cd[_0x4520a0(0x23df)]===_0x4520a0(0x1cfa));_0x3a3db7&&(_0x4340d2=!![],console[_0x4520a0(0xc0d)]('🔍\x20[generateSMSReply]\x20检测到图片消息'));}else _0x1916ca[_0x4520a0(0x6ee)]({'type':'text','text':_0x2a1871[_0x4520a0(0x1e58)]||_0x2a1871});}):Array[_0x13ccee(0x1bcc)](_0x63c1c2[_0x13ccee(0x1423)])?(_0x1916ca=_0x63c1c2['content'],_0x4340d2=_0x63c1c2[_0x13ccee(0x1423)][_0x13ccee(0x184b)](_0x19ec78=>_0x19ec78['type']==='image_url')):_0x1916ca=[{'type':'text','text':_0x63c1c2[_0x13ccee(0x1e58)]||_0x63c1c2}];console[_0x13ccee(0xc0d)](_0x13ccee(0x2364),_0x1916ca),console[_0x13ccee(0xc0d)]('🔍\x20[generateSMSReply]\x20是否包含图片:',_0x4340d2);let _0x307dfb;if(_0x4340d2){console['log'](_0x13ccee(0x1999));const _0x5e2f9e=await buildSMSPrompt(_0x135def,_0x63c1c2),_0x51d010=_0x1916ca['find'](_0x509c41=>_0x509c41[_0x13ccee(0x23df)]===_0x13ccee(0x1e58))?.[_0x13ccee(0x1e58)]||'',_0x47697b=_0x1916ca[_0x13ccee(0x1aeb)](_0x2c6099=>_0x2c6099[_0x13ccee(0x23df)]===_0x13ccee(0x1cfa)),_0x27c834=[{'type':_0x13ccee(0x1e58),'text':_0x5e2f9e+_0x13ccee(0x17b6)+(_0x51d010?_0x13ccee(0x1554)+_0x51d010:'')+_0x13ccee(0x9e9)+_0x135def[_0x13ccee(0x222f)]+'的身份回复这条短信：\x0a-\x20发送1-3条简洁的短信\x0a-\x20保持角色性格和记忆连贯性\x0a-\x20仔细观察图片内容并给出相应回复\x0a-\x20【重要】必须输出纯字符串JSON数组，不要代码块标记\x0a-\x20【重要】只能包含纯文本字符串，不能有任何对象\x0a-\x20【禁止】不要使用\x20{\x22type\x22:\x20\x22reply_to\x22}\x20等对象格式\x0a-\x20正确格式：[\x22回复内容1\x22,\x20\x22回复内容2\x22]\x0a-\x20错误格式：[{\x22type\x22:\x20\x22reply_to\x22,\x20\x22content\x22:\x20\x22...\x22}]\x0a\x0a请回复：'}];_0x47697b&&_0x27c834[_0x13ccee(0x6ee)](_0x47697b),_0x307dfb=await callChatAPI(_0x27c834,_0x135def);}else{console['log'](_0x13ccee(0x10c0));const _0x236b79=await buildSMSPrompt(_0x135def,_0x63c1c2),_0x572c59=_0x135def['id'],_0x4d211b=smsMessages[_0x572c59]||[],_0x23d4b5=getSMSChatSetting('historyRounds',0x32),_0xd5539d=_0x4d211b[_0x13ccee(0x136)](-_0x23d4b5);let _0x5c2de6='';_0xd5539d[_0x13ccee(0xcbf)]>0x0&&(_0x5c2de6=_0x13ccee(0x1f25),_0xd5539d[_0x13ccee(0x900)](_0x4d038c=>{const _0x3d5255=_0x13ccee,_0x5eecc6=_0x4d038c[_0x3d5255(0xc7)]?getCurrentPersonaName()||'用户':_0x135def[_0x3d5255(0x222f)],_0x4c7e19=Array[_0x3d5255(0x1bcc)](_0x4d038c[_0x3d5255(0x1423)])?_0x4d038c[_0x3d5255(0x1423)]['find'](_0x433959=>_0x433959[_0x3d5255(0x23df)]===_0x3d5255(0x1e58))?.['text']||_0x3d5255(0x1f6f):_0x4d038c[_0x3d5255(0x1e58)]||_0x3d5255(0x10ed);_0x5c2de6+=_0x5eecc6+':\x20'+_0x4c7e19+'\x0a';}));let _0x518ef4='\x0a\x0a##\x20当前用户消息\x0a';const _0x609260=getCurrentPersonaName()||'用户';Array[_0x13ccee(0x1bcc)](_0x63c1c2)?_0x63c1c2[_0x13ccee(0x900)](_0x1ca56e=>{const _0x348118=_0x13ccee,_0x43de40=Array['isArray'](_0x1ca56e['content'])?_0x1ca56e[_0x348118(0x1423)][_0x348118(0x1aeb)](_0x505735=>_0x505735['type']==='text')?.[_0x348118(0x1e58)]||_0x348118(0x1f6f):_0x1ca56e['text']||_0x1ca56e;_0x518ef4+=_0x609260+':\x20'+_0x43de40+'\x0a';}):_0x518ef4+=_0x609260+':\x20'+_0x63c1c2+'\x0a';const _0x19af3c=_0x236b79+_0x5c2de6+_0x518ef4+(_0x13ccee(0x15c)+_0x135def[_0x13ccee(0x222f)]+_0x13ccee(0x22ea));_0x307dfb=await generateAIResponse(_0x19af3c,_0x135def);}console['log'](_0x13ccee(0x19bb),_0x307dfb);if(_0x307dfb&&_0x307dfb[_0x13ccee(0x1424)]()){let _0x588fa4=[];try{let _0x14e124=_0x307dfb[_0x13ccee(0x1424)]();_0x14e124=_0x14e124[_0x13ccee(0x882)](/^```json\s*/,'')[_0x13ccee(0x882)](/\s*```$/,''),_0x14e124=_0x14e124[_0x13ccee(0x882)](/^```\s*/,'')[_0x13ccee(0x882)](/\s*```$/,'');const _0x34fd55=JSON[_0x13ccee(0x168e)](_0x14e124);if(Array[_0x13ccee(0x1bcc)](_0x34fd55))_0x588fa4=_0x34fd55['filter'](_0xa1db64=>{const _0x12ecf8=_0x13ccee;return _0xa1db64&&typeof _0xa1db64===_0x12ecf8(0xb97)&&_0xa1db64[_0x12ecf8(0x1424)]();});else typeof _0x34fd55===_0x13ccee(0xb97)?_0x588fa4=[_0x34fd55]:_0x588fa4=[_0x307dfb[_0x13ccee(0x1424)]()];}catch(_0x219c41){console[_0x13ccee(0xc0d)](_0x13ccee(0x16ae),_0x219c41);const _0x15f43f=_0x307dfb['match'](/"([^"]+)"/g);_0x15f43f?_0x588fa4=_0x15f43f[_0x13ccee(0xf6d)](_0xcb9415=>_0xcb9415[_0x13ccee(0x136)](0x1,-0x1))['filter'](_0x4e6a45=>_0x4e6a45[_0x13ccee(0x1424)]()):_0x588fa4=_0x307dfb[_0x13ccee(0x1424)]()[_0x13ccee(0x633)]('\x0a')['filter'](_0x139c14=>_0x139c14[_0x13ccee(0x1424)]());}!smsMessages[_0x135def['id']]&&(smsMessages[_0x135def['id']]=[]);for(let _0x36b615=0x0;_0x36b615<_0x588fa4['length'];_0x36b615++){const _0x4054aa=_0x588fa4[_0x36b615][_0x13ccee(0x1424)]();if(_0x4054aa){if(_0x36b615>0x0){showSMSTypingIndicator();const _0x1c9ef1=Math[_0x13ccee(0x191c)]()*0x3e8+0x1f4;await new Promise(_0x2acd1b=>setTimeout(_0x2acd1b,_0x1c9ef1)),hideSMSTypingIndicator();}const _0x1073ae={'id':_0x13ccee(0x23a0)+Date[_0x13ccee(0x18e0)]()+'-'+_0x36b615+'-'+Math['random']()[_0x13ccee(0x9a3)](0x24)[_0x13ccee(0x18cf)](0x2,0x9),'content':[{'type':'text','text':_0x4054aa}],'text':_0x4054aa,'timestamp':Date['now']()+_0x36b615*0x64,'isUser':![]};smsMessages[_0x135def['id']]['push'](_0x1073ae),await saveSingleSMSMessage(_0x135def['id'],_0x1073ae),addSMSMessageWithAnimation(_0x1073ae,_0x135def['id']),createSMSPushNotification(_0x135def,_0x1073ae[_0x13ccee(0x1e58)],_0x36b615*0x1f4),await new Promise(_0x356597=>setTimeout(_0x356597,0xc8));}}console[_0x13ccee(0xc0d)](_0x13ccee(0x11ff)+_0x588fa4[_0x13ccee(0xcbf)]+_0x13ccee(0x6cc));try{await recordCrossAppEvent(_0x135def['id'],'sms',_0x13ccee(0x10bd),{'id':_0x135def['id'],'type':_0x13ccee(0x727),'content':_0x307dfb[_0x13ccee(0x1424)]()['substring'](0x0,0x64),'messageCount':_0x588fa4[_0x13ccee(0xcbf)],'userMessage':Array[_0x13ccee(0x1bcc)](_0x63c1c2)?_0x63c1c2[_0x13ccee(0x140c)]('\x20')[_0x13ccee(0x4b2)](0x0,0x32):_0x63c1c2[_0x13ccee(0x4b2)](0x0,0x32),'chatId':_0x135def['id'],'sender':'ai'},smsMessages[_0x135def['id']][smsMessages[_0x135def['id']][_0x13ccee(0xcbf)]-0x1]['id']),console[_0x13ccee(0xc0d)]('📝\x20[短信时间线]\x20已记录AI回复事件到跨应用时间线');}catch(_0x398c47){console[_0x13ccee(0x24ab)]('❌\x20[短信时间线]\x20记录AI回复事件失败:',_0x398c47);}}hideSMSTypingIndicator(),renderSMSMessageList();}catch(_0x30088e){console[_0x13ccee(0x24ab)]('生成短信AI回复失败:',_0x30088e),hideSMSTypingIndicator();throw _0x30088e;}}async function characterInitiateSMS(_0x24d7f8,_0x2b359e=_0x2cf6d4(0x1db5)){const _0x540191=_0x2cf6d4;try{const _0x558cd8=characters[_0x540191(0x1aeb)](_0x270d19=>_0x270d19['id']===_0x24d7f8);if(!_0x558cd8){console['error'](_0x540191(0x23db),_0x24d7f8);return;}console[_0x540191(0xc0d)]('🔥\x20[角色主动短信]\x20角色主动发送短信，原因:',_0x2b359e);!smsContacts[_0x540191(0x23ec)](_0x24d7f8)&&(smsContacts[_0x540191(0x6ee)](_0x24d7f8),await saveSMSContacts());!smsMessages[_0x24d7f8]&&(smsMessages[_0x24d7f8]=[]);let _0x2c22f1='';if(_0x2b359e==='blocked')_0x2c22f1='你被用户在聊天应用中拉黑了，但你想通过短信主动联系用户，希望能够和解或解释。请发送一条真诚的短信给用户，表达你的想法。消息要简短、真诚，符合短信的特点。';else _0x2b359e===_0x540191(0x162f)?_0x2c22f1=_0x540191(0x24d5):_0x2c22f1='你想主动通过短信联系用户。请发送一条自然的短信给用户。';const _0x4bc940=await buildSMSPrompt(_0x558cd8,''),_0x2ee7d5=_0x4bc940+(_0x540191(0x2184)+_0x2c22f1+_0x540191(0x9e9)+_0x558cd8[_0x540191(0x222f)]+_0x540191(0x116a)),_0x5b021b=await generateAIResponse(_0x2ee7d5,_0x558cd8);if(_0x5b021b&&_0x5b021b[_0x540191(0x1424)]()){let _0x4f909e=_0x5b021b['trim']();try{let _0x5bf134=_0x5b021b[_0x540191(0x1424)]();_0x5bf134=_0x5bf134[_0x540191(0x882)](/^```json\s*/,'')[_0x540191(0x882)](/\s*```$/,''),_0x5bf134=_0x5bf134[_0x540191(0x882)](/^```\s*/,'')[_0x540191(0x882)](/\s*```$/,'');const _0xcc94fc=JSON[_0x540191(0x168e)](_0x5bf134);if(Array['isArray'](_0xcc94fc)&&_0xcc94fc[_0x540191(0xcbf)]>0x0){const _0x15913b=_0xcc94fc[_0x540191(0x1aeb)](_0x1c6e3b=>typeof _0x1c6e3b===_0x540191(0xb97)&&_0x1c6e3b[_0x540191(0x1424)]());_0x15913b&&(_0x4f909e=_0x15913b);}else typeof _0xcc94fc===_0x540191(0xb97)&&(_0x4f909e=_0xcc94fc);}catch(_0x1c9d20){console[_0x540191(0xc0d)](_0x540191(0xf24),_0x1c9d20);const _0x39b856=_0x5b021b['match'](/"([^"]+)"/);_0x39b856&&(_0x4f909e=_0x39b856[0x1]);}const _0x5d716c={'id':_0x540191(0xf46)+Date['now']()+'-'+Math[_0x540191(0x191c)]()[_0x540191(0x9a3)](0x24)['substr'](0x2,0x9),'content':[{'type':_0x540191(0x1e58),'text':_0x4f909e}],'text':_0x4f909e,'timestamp':Date[_0x540191(0x18e0)](),'isUser':![]};smsMessages[_0x24d7f8][_0x540191(0x6ee)](_0x5d716c),await saveSingleSMSMessage(_0x24d7f8,_0x5d716c);window[_0x540191(0x1bad)]&&window[_0x540191(0x1bad)]['id']===_0x24d7f8&&addSMSMessageWithAnimation(_0x5d716c,_0x24d7f8);createSMSPushNotification(_0x558cd8,_0x5d716c[_0x540191(0x1e58)],0x64);try{await recordCrossAppEvent(_0x24d7f8,_0x540191(0x1bc6),_0x540191(0x17a9),{'id':_0x24d7f8,'type':_0x540191(0x1ae0),'content':_0x5b021b['trim']()['substring'](0x0,0x64),'reason':_0x2b359e,'initiateType':'character_proactive','chatId':_0x24d7f8,'sender':'ai'},_0x5d716c['id']),console[_0x540191(0xc0d)]('📝\x20[短信时间线]\x20已记录角色主动发送短信事件到跨应用时间线');}catch(_0x478700){console[_0x540191(0x24ab)]('❌\x20[短信时间线]\x20记录角色主动发送短信事件失败:',_0x478700);}}await saveSMSContacts(),renderSMSMessageList(),console[_0x540191(0xc0d)]('🔥\x20[角色主动短信]\x20'+_0x558cd8[_0x540191(0x222f)]+_0x540191(0x1ca)),showToast(_0x558cd8['name']+'\x20通过短信联系了你',_0x540191(0x2422));}catch(_0x2a16){console[_0x540191(0x24ab)](_0x540191(0x3da),_0x2a16);}}window[_0x2cf6d4(0x1fa6)]=async function(_0x349990){const _0x2c1b24=_0x2cf6d4;console[_0x2c1b24(0xc0d)](_0x2c1b24(0x1714)+_0x349990+_0x2c1b24(0x7a1));if(Math[_0x2c1b24(0x191c)]()<0.75){const _0x193926=Math[_0x2c1b24(0x191c)]()*0x5a*0x3e8+0x1e*0x3e8;setTimeout(()=>{const _0x5bfdc8=_0x2c1b24;characterInitiateSMS(_0x349990,_0x5bfdc8(0x1db5));},_0x193926),console[_0x2c1b24(0xc0d)]('🔥\x20[拉黑触发]\x20'+_0x349990+'\x20将在\x20'+Math[_0x2c1b24(0x5f3)](_0x193926/0x3e8)+'\x20秒后通过短信联系用户');}if(Math[_0x2c1b24(0x191c)]()<0.6){const _0x102d48=Math[_0x2c1b24(0x191c)]()*0x7*0x3c*0x3e8+0x3*0x3c*0x3e8;setTimeout(async()=>{const _0x53bf68=_0x2c1b24;await characterRetryFriendRequest(_0x349990,0x0,_0x53bf68(0x1db5));},_0x102d48),console[_0x2c1b24(0xc0d)](_0x2c1b24(0x417)+_0x349990+_0x2c1b24(0x2a5)+Math[_0x2c1b24(0x5f3)](_0x102d48/0x3e8/0x3c)+_0x2c1b24(0x180e));}},window['onFriendRequestRejected']=async function(_0xf6192d){const _0x594632=_0x2cf6d4;console[_0x594632(0xc0d)](_0x594632(0xe92)+_0xf6192d+_0x594632(0x1c10));const _0xe9fcf2=_0x594632(0x1366)+_0xf6192d;let _0xfb4c5a=parseInt(localStorage[_0x594632(0x2250)](_0xe9fcf2)||'0')+0x1;localStorage[_0x594632(0x2055)](_0xe9fcf2,_0xfb4c5a['toString']());let _0x4f44a3=0.85,_0x2fa2a2=0.7;_0xfb4c5a>=0x2&&(_0x4f44a3=0.95,_0x2fa2a2=0.8);_0xfb4c5a>=0x3&&(_0x4f44a3=0.98,_0x2fa2a2=0.6);if(Math[_0x594632(0x191c)]()<_0x4f44a3){const _0x36c0de=Math[_0x594632(0x191c)]()*0x7*0x3c*0x3e8+0x1*0x3c*0x3e8;setTimeout(()=>{const _0x321f24=_0x594632;characterInitiateSMS(_0xf6192d,_0x321f24(0x162f));},_0x36c0de),console[_0x594632(0xc0d)](_0x594632(0x124)+_0xf6192d+_0x594632(0x2a5)+Math[_0x594632(0x5f3)](_0x36c0de/0x3e8/0x3c)+_0x594632(0x7ce));}if(Math[_0x594632(0x191c)]()<_0x2fa2a2&&_0xfb4c5a<0x5){const _0x134c38=Math['random']()*0xf*0x3c*0x3e8+0x5*0x3c*0x3e8;setTimeout(async()=>{await characterRetryFriendRequest(_0xf6192d,_0xfb4c5a,'rejected');},_0x134c38),console['log'](_0x594632(0xcfb)+_0xf6192d+_0x594632(0x2a5)+Math[_0x594632(0x5f3)](_0x134c38/0x3e8/0x3c)+_0x594632(0x15ab));}setTimeout(async()=>{await expressRejectionFeelings(_0xf6192d,_0xfb4c5a);},Math['random']()*0xa*0x3c*0x3e8+0x5*0x3c*0x3e8);};async function characterRetryFriendRequest(_0x337f57,_0x22e3b4,_0x4cf74b=_0x2cf6d4(0x1164)){const _0x1e1382=_0x2cf6d4;try{const _0x348adc=characters[_0x1e1382(0x1aeb)](_0x1a4f70=>_0x1a4f70['id']===_0x337f57);if(!_0x348adc)return;let _0x4c9b25='';_0x4cf74b===_0x1e1382(0x1db5)?_0x4c9b25='你是'+_0x348adc[_0x1e1382(0x222f)]+'，你被用户拉黑了。\x0a\x0a你的性格：'+_0x348adc[_0x1e1382(0x1a84)]+'\x0a\x0a现在你想通过发送好友申请来修复关系。请根据你的性格决定：\x0a1.\x20是否要尝试发送好友申请\x0a2.\x20如果尝试，应该说什么来道歉和请求原谅\x0a\x0a考虑因素：\x0a-\x20你被拉黑了，说明用户对你很不满\x0a-\x20你的性格是否会主动道歉\x0a-\x20你是否真的想修复这段关系\x0a-\x20你应该如何真诚地道歉':_0x4c9b25='你是'+_0x348adc[_0x1e1382(0x222f)]+_0x1e1382(0x1d8d)+_0x22e3b4+_0x1e1382(0x20d2)+_0x348adc[_0x1e1382(0x1a84)]+'\x0a\x0a现在你想再次尝试发送好友申请。请根据你的性格决定：\x0a1.\x20是否要再次尝试\x0a2.\x20如果尝试，应该说什么\x0a\x0a考虑因素：\x0a-\x20你已经被拒绝了'+_0x22e3b4+_0x1e1382(0x471);_0x4c9b25+=_0x1e1382(0x23da);const _0x9955c7=await generateAIResponse(_0x4c9b25,_0x348adc),_0x3cd3f3=await parseAiResponse(_0x9955c7);for(const _0x4c8336 of _0x3cd3f3){if(typeof _0x4c8336==='object'&&_0x4c8336[_0x1e1382(0x23df)]===_0x1e1382(0x14f2)){const _0x288a93={'id':Date[_0x1e1382(0x18e0)]()[_0x1e1382(0x9a3)](),'sender':_0x1e1382(0x232),'type':_0x1e1382(0x14f2),'message':_0x4c8336[_0x1e1382(0xd7a)]||_0x1e1382(0x17c9),'timestamp':Date[_0x1e1382(0x18e0)](),'isRetryRequest':!![],'retryCount':_0x22e3b4};!chatMessages[_0x337f57]&&(chatMessages[_0x337f57]=[]);chatMessages[_0x337f57][_0x1e1382(0x6ee)](_0x288a93);currentChatCharacter&&currentChatCharacter['id']===_0x337f57&&addMessageWithAnimation(_0x288a93,_0x337f57);await saveChatMessagesImmediate([_0x337f57]);_0x4cf74b===_0x1e1382(0x1db5)?console[_0x1e1382(0xc0d)](_0x1e1382(0x12ff)+_0x348adc[_0x1e1382(0x222f)]+_0x1e1382(0x1f7)):console[_0x1e1382(0xc0d)](_0x1e1382(0x12ff)+_0x348adc['name']+_0x1e1382(0x6a1)+(_0x22e3b4+0x1)+'次好友申请');break;}else{if(typeof _0x4c8336===_0x1e1382(0xb97)){const _0x24ff5b={'id':Date[_0x1e1382(0x18e0)]()[_0x1e1382(0x9a3)](),'sender':_0x1e1382(0x232),'content':_0x4c8336,'timestamp':Date['now'](),'isGiveUpMessage':!![]};!chatMessages[_0x337f57]&&(chatMessages[_0x337f57]=[]);chatMessages[_0x337f57][_0x1e1382(0x6ee)](_0x24ff5b);currentChatCharacter&&currentChatCharacter['id']===_0x337f57&&addMessageWithAnimation(_0x24ff5b,_0x337f57);await saveChatMessagesImmediate([_0x337f57]),console[_0x1e1382(0xc0d)](_0x1e1382(0x1742)+_0x348adc[_0x1e1382(0x222f)]+'\x20决定放弃重试好友申请');break;}}}}catch(_0x4c5e1f){console[_0x1e1382(0x24ab)]('角色重试好友申请失败:',_0x4c5e1f);}}async function expressRejectionFeelings(_0x2ad82c,_0x190c6b){const _0xc209ea=_0x2cf6d4;try{const _0x55ae50=characters[_0xc209ea(0x1aeb)](_0x17ba78=>_0x17ba78['id']===_0x2ad82c);if(!_0x55ae50)return;const _0x40156c='你是'+_0x55ae50[_0xc209ea(0x222f)]+'，你的好友申请刚刚被用户拒绝了（这是第'+_0x190c6b+_0xc209ea(0x157b)+_0x55ae50[_0xc209ea(0x1a84)]+_0xc209ea(0x206),_0xac3515=await generateAIResponse(_0x40156c,_0x55ae50),_0x55999e=await parseAiResponse(_0xac3515);for(const _0x1eba08 of _0x55999e){if(typeof _0x1eba08===_0xc209ea(0xb97)){const _0x2271ab={'id':Date[_0xc209ea(0x18e0)]()['toString'](),'sender':_0xc209ea(0x232),'content':_0x1eba08,'timestamp':Date[_0xc209ea(0x18e0)](),'isRejectionFeeling':!![]};!chatMessages[_0x2ad82c]&&(chatMessages[_0x2ad82c]=[]),chatMessages[_0x2ad82c][_0xc209ea(0x6ee)](_0x2271ab),currentChatCharacter&&currentChatCharacter['id']===_0x2ad82c&&addMessageWithAnimation(_0x2271ab,_0x2ad82c),await saveChatMessagesImmediate([_0x2ad82c]),console[_0xc209ea(0xc0d)](_0xc209ea(0xe38)+_0x55ae50[_0xc209ea(0x222f)]+'\x20表达了被拒绝的感受');}}}catch(_0x5ea994){console[_0xc209ea(0x24ab)](_0xc209ea(0x120),_0x5ea994);}}function showSMSChatInfo(){const _0x130b72=_0x2cf6d4;if(!window[_0x130b72(0x1bad)])return;document[_0x130b72(0x566)](_0x130b72(0x1315))[_0x130b72(0x655)][_0x130b72(0x2526)]=_0x130b72(0xfe9),document['getElementById'](_0x130b72(0x141d))['style'][_0x130b72(0x2526)]='block',initSMSChatSettings();}function hideSMSChatSettings(){const _0x5b744b=_0x2cf6d4;document['getElementById'](_0x5b744b(0x141d))[_0x5b744b(0x655)]['display']='none',document[_0x5b744b(0x566)](_0x5b744b(0x1315))[_0x5b744b(0x655)]['display']=_0x5b744b(0x2d4);}function initSMSChatSettings(){const _0x45c24f=_0x2cf6d4;if(!window[_0x45c24f(0x1bad)])return;const _0xdf29cb=getSMSChatSetting(_0x45c24f(0xe90),0x32);document[_0x45c24f(0x566)](_0x45c24f(0x139b))[_0x45c24f(0xc34)]=_0xdf29cb,document[_0x45c24f(0x566)](_0x45c24f(0xee4))[_0x45c24f(0x21dc)]=_0xdf29cb+'轮';const _0x3d247a=getSMSChatSetting(_0x45c24f(0x19f9),_0x45c24f(0x1c29));updateBubbleColorSelection(_0x3d247a);}function getSMSChatSetting(_0x5871be,_0x470bd0){const _0x361e75=_0x2cf6d4;if(!window[_0x361e75(0x1bad)])return _0x470bd0;const _0x273f18='sms-chat-'+window[_0x361e75(0x1bad)]['id']+'-'+_0x5871be,_0x381aa1=localStorage['getItem'](_0x273f18);return _0x381aa1!==null?_0x381aa1:_0x470bd0;}function setSMSChatSetting(_0x3ff949,_0x5322c3){const _0xcc25=_0x2cf6d4;if(!window[_0xcc25(0x1bad)])return;const _0x5928d2=_0xcc25(0x1d2e)+window[_0xcc25(0x1bad)]['id']+'-'+_0x3ff949;localStorage[_0xcc25(0x2055)](_0x5928d2,_0x5322c3);}function updateSMSHistoryRounds(){const _0x46e4c8=_0x2cf6d4,_0x110e37=document[_0x46e4c8(0x566)](_0x46e4c8(0x139b)),_0x4584e1=_0x110e37[_0x46e4c8(0xc34)];document[_0x46e4c8(0x566)]('sms-history-rounds-value')[_0x46e4c8(0x21dc)]=_0x4584e1+'轮',setSMSChatSetting('historyRounds',_0x4584e1);}function setSMSBubbleColor(_0x43777b){const _0x178ed0=_0x2cf6d4;setSMSChatSetting(_0x178ed0(0x19f9),_0x43777b),updateBubbleColorSelection(_0x43777b),updateSMSChatBubbleColors(_0x43777b);}function updateBubbleColorSelection(_0x2ac807){const _0xc391d0=_0x2cf6d4;document[_0xc391d0(0x1ed9)](_0xc391d0(0xbe0))['forEach'](_0x3131dc=>{const _0x2e1e1d=_0xc391d0;_0x3131dc[_0x2e1e1d(0x226e)][_0x2e1e1d(0x128)]('active');}),document['querySelector'](_0xc391d0(0x2211)+_0x2ac807+'\x22]')['classList'][_0xc391d0(0xe1)]('active');}function updateSMSChatBubbleColors(_0x28bcf9){const _0x5c1c47=_0x2cf6d4,_0x124cb2=document[_0x5c1c47(0x566)](_0x5c1c47(0xf1));_0x124cb2&&(_0x124cb2[_0x5c1c47(0x226e)]['remove']('green-bubble'),_0x28bcf9===_0x5c1c47(0x9a4)&&_0x124cb2[_0x5c1c47(0x226e)][_0x5c1c47(0xe1)](_0x5c1c47(0x131b)));}async function clearSMSChatHistory(){const _0x239fda=_0x2cf6d4;if(!window[_0x239fda(0x1bad)]){showToast(_0x239fda(0x275),_0x239fda(0x24ab));return;}const _0x2daabd=window['currentSMSCharacter'],_0x88be92=_0x239fda(0x1b6)+_0x2daabd[_0x239fda(0x222f)]+_0x239fda(0xeb2);if(confirm(_0x88be92))try{const _0x2c7f21=_0x2daabd['id'];console[_0x239fda(0xc0d)](_0x239fda(0x1fae)+_0x2daabd[_0x239fda(0x222f)]+_0x239fda(0x169c));smsMessages[_0x2c7f21]&&delete smsMessages[_0x2c7f21];await db['smsMessages'][_0x239fda(0x4a6)]('characterId')[_0x239fda(0x14a)](_0x2c7f21)[_0x239fda(0xc2b)]();const _0x51cb91=await db[_0x239fda(0x75b)][_0x239fda(0x4a6)](_0x239fda(0x10df))[_0x239fda(0x14a)](_0x2c7f21)[_0x239fda(0x1534)](_0x4c4379=>_0x4c4379[_0x239fda(0x12e0)]===_0x239fda(0x1bc6))['toArray']();if(_0x51cb91[_0x239fda(0xcbf)]>0x0){const _0x547ba7=_0x51cb91['map'](_0x290f2a=>_0x290f2a['id']);await db[_0x239fda(0x75b)][_0x239fda(0xf71)](_0x547ba7),console[_0x239fda(0xc0d)](_0x239fda(0x1f36)+_0x51cb91[_0x239fda(0xcbf)]+'\x20条短信相关时间线记忆');}const _0x33ba16=await db[_0x239fda(0x222e)][_0x239fda(0x4a6)]('characterId')[_0x239fda(0x14a)](_0x2c7f21)[_0x239fda(0x18c6)]();if(_0x33ba16[_0x239fda(0xcbf)]>0x0){const _0x2fec92=_0x33ba16[_0x239fda(0xf6d)](_0x5c3b9b=>_0x5c3b9b['id']);await db[_0x239fda(0x222e)][_0x239fda(0xf71)](_0x2fec92),console[_0x239fda(0xc0d)](_0x239fda(0x1f36)+_0x33ba16['length']+_0x239fda(0xc25));}const _0x14886a=await db[_0x239fda(0xa1b)][_0x239fda(0x4a6)](_0x239fda(0x10df))[_0x239fda(0x14a)](_0x2c7f21)['toArray']();if(_0x14886a[_0x239fda(0xcbf)]>0x0){const _0x435536=_0x14886a['map'](_0x1ca386=>_0x1ca386['id']);await db[_0x239fda(0xa1b)][_0x239fda(0xf71)](_0x435536),console[_0x239fda(0xc0d)](_0x239fda(0x1f36)+_0x14886a[_0x239fda(0xcbf)]+_0x239fda(0x1d65));}renderSMSMessages(_0x2c7f21),renderSMSMessageList(),showToast('✅\x20已清空与\x20'+_0x2daabd[_0x239fda(0x222f)]+_0x239fda(0x1cc4),'success'),console[_0x239fda(0xc0d)](_0x239fda(0x19e7)+_0x51cb91[_0x239fda(0xcbf)]+_0x239fda(0xe2)+_0x33ba16[_0x239fda(0xcbf)]+'条情景记忆、'+_0x14886a[_0x239fda(0xcbf)]+_0x239fda(0x126d));}catch(_0x18a5fe){console[_0x239fda(0x24ab)]('清空短信聊天记录失败:',_0x18a5fe),showToast(_0x239fda(0x15ba),_0x239fda(0x24ab));}}function renderSMSMessageList(){const _0x1c9c22=_0x2cf6d4,_0x47aa33=document[_0x1c9c22(0x566)]('messages-list');if(!_0x47aa33)return;_0x47aa33[_0x1c9c22(0xc02)]='';if(!smsContacts||smsContacts[_0x1c9c22(0xcbf)]===0x0){_0x47aa33[_0x1c9c22(0xc02)]=_0x1c9c22(0xf6f);return;}const _0x53fce7=[...smsContacts]['sort']((_0x346c06,_0x414931)=>{const _0x136d3a=_0x1c9c22,_0x5816c4=pinnedSMSConversations[_0x136d3a(0x1af1)](_0x346c06),_0x253a44=pinnedSMSConversations['has'](_0x414931);if(_0x5816c4&&!_0x253a44)return-0x1;if(!_0x5816c4&&_0x253a44)return 0x1;return 0x0;});_0x53fce7[_0x1c9c22(0x900)](_0x319b61=>{const _0xbc8703=_0x1c9c22,_0x3c8f67=characters['find'](_0x22247f=>_0x22247f['id']===_0x319b61);if(!_0x3c8f67)return;const _0x58d960=smsMessages[_0x319b61]||[],_0x192844=_0x58d960[_0x58d960[_0xbc8703(0xcbf)]-0x1];let _0xb67aef='';if(_0x192844){const _0x3e3be8=new Date(_0x192844[_0xbc8703(0x7aa)]),_0x1b5e6b=new Date(),_0x12a496=new Date(_0x1b5e6b['getFullYear'](),_0x1b5e6b[_0xbc8703(0x17f3)](),_0x1b5e6b['getDate']()),_0x592715=new Date(_0x12a496[_0xbc8703(0xa57)]()-0x18*0x3c*0x3c*0x3e8),_0x4c6d6f=new Date(_0x3e3be8[_0xbc8703(0x885)](),_0x3e3be8[_0xbc8703(0x17f3)](),_0x3e3be8[_0xbc8703(0x1d02)]()),_0x54ffff=_0x1b5e6b[_0xbc8703(0xa57)]()-_0x3e3be8[_0xbc8703(0xa57)](),_0x44e3d5=Math['floor'](_0x54ffff/(0x3e8*0x3c*0x3c*0x18));if(_0x4c6d6f[_0xbc8703(0xa57)]()===_0x12a496[_0xbc8703(0xa57)]())_0xb67aef=_0x3e3be8[_0xbc8703(0xd4a)]('zh-CN',{'hour':_0xbc8703(0x19f3),'minute':_0xbc8703(0x19f3)});else{if(_0x4c6d6f[_0xbc8703(0xa57)]()===_0x592715[_0xbc8703(0xa57)]())_0xb67aef='昨天';else{if(_0x44e3d5<0x7){const _0x497f3f=['星期日',_0xbc8703(0x1fef),_0xbc8703(0x1e04),_0xbc8703(0x194),'星期四','星期五','星期六'];_0xb67aef=_0x497f3f[_0x3e3be8[_0xbc8703(0x1993)]()];}else _0xb67aef=_0x3e3be8['toLocaleDateString'](_0xbc8703(0x1c0b),{'year':_0xbc8703(0xf4e),'month':'numeric','day':'numeric'});}}}else _0xb67aef=new Date()[_0xbc8703(0x177f)]('zh-CN',{'year':'numeric','month':_0xbc8703(0xf4e),'day':'numeric'});let _0x8cdc8e='';if(_0x192844){if(_0x192844[_0xbc8703(0xfd1)])_0x8cdc8e='[图片]';else{let _0xf70de9='';if(Array[_0xbc8703(0x1bcc)](_0x192844[_0xbc8703(0x1423)])){const _0x4ea1a1=_0x192844[_0xbc8703(0x1423)]['find'](_0x481b42=>_0x481b42[_0xbc8703(0x23df)]===_0xbc8703(0x1e58));_0xf70de9=_0x4ea1a1?_0x4ea1a1[_0xbc8703(0x1e58)]:'';}else _0x192844[_0xbc8703(0x1e58)]&&(_0xf70de9=_0x192844['text']);_0xf70de9?_0x8cdc8e=_0xf70de9[_0xbc8703(0xcbf)]>0x14?_0xf70de9[_0xbc8703(0x4b2)](0x0,0x14)+_0xbc8703(0x12da):_0xf70de9:_0x8cdc8e='[图片]';}}else _0x8cdc8e=_0xbc8703(0x148f);const _0x1ec338=document[_0xbc8703(0x1ad8)](_0xbc8703(0x526)),_0x128729=pinnedSMSConversations['has'](_0x319b61),_0x40ad29=selectedSMSConversations[_0xbc8703(0x1af1)](_0x319b61);_0x1ec338[_0xbc8703(0x221)]=_0xbc8703(0x117b)+(_0x128729?'pinned':'')+'\x20'+(_0x40ad29?'selected':''),isSMSListMultiSelectMode?_0x1ec338['onclick']=()=>toggleSMSConversationSelection(_0x319b61):_0x1ec338[_0xbc8703(0x11cf)]=()=>startSMSChat(_0x3c8f67),_0x1ec338['innerHTML']=_0xbc8703(0xf70)+(_0x3c8f67['avatarUrl']?_0xbc8703(0x2001)+_0x3c8f67[_0xbc8703(0x10f9)]+_0xbc8703(0x1ca8)+_0x3c8f67[_0xbc8703(0x222f)]+'\x22>':'<div\x20class=\x22sms-avatar-placeholder\x22>'+_0x3c8f67[_0xbc8703(0x222f)][_0xbc8703(0x1518)](0x0)+_0xbc8703(0xa54))+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-message-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-message-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-message-name\x22>'+_0x3c8f67['name']+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-message-time\x22>'+_0xb67aef+_0xbc8703(0x3f2)+_0x8cdc8e+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(!isSMSListMultiSelectMode?_0xbc8703(0x1683):'')+_0xbc8703(0x1edd),_0x47aa33[_0xbc8703(0x1925)](_0x1ec338);});}async function deleteSMSConversation(_0x4b766a){const _0x35467b=_0x2cf6d4,_0xcd024e=characters[_0x35467b(0x1aeb)](_0x124de9=>_0x124de9['id']===_0x4b766a);if(!_0xcd024e)return;const _0x23c164=_0x35467b(0x211f)+_0xcd024e[_0x35467b(0x222f)]+_0x35467b(0xc60);if(confirm(_0x23c164))try{console['log'](_0x35467b(0x523)+_0xcd024e[_0x35467b(0x222f)]+'\x20的短信对话和记忆...');const _0x14950c=smsContacts[_0x35467b(0x167a)](_0x4b766a);_0x14950c>-0x1&&smsContacts[_0x35467b(0x220f)](_0x14950c,0x1);smsMessages[_0x4b766a]&&delete smsMessages[_0x4b766a];await db[_0x35467b(0x174a)]('rw',[db[_0x35467b(0x111c)],db[_0x35467b(0xd94)]],async()=>{const _0x431464=_0x35467b;await db[_0x431464(0x111c)]['where'](_0x431464(0x10df))[_0x431464(0x14a)](_0x4b766a)[_0x431464(0xc2b)](),await db[_0x431464(0xd94)][_0x431464(0x4a6)](_0x431464(0x10df))['equals'](_0x4b766a)[_0x431464(0xc2b)]();});const _0x3aaf7d=await db['crossAppTimeline'][_0x35467b(0x4a6)](_0x35467b(0x10df))[_0x35467b(0x14a)](_0x4b766a)['and'](_0x271457=>_0x271457['appType']===_0x35467b(0x1bc6))['toArray']();if(_0x3aaf7d[_0x35467b(0xcbf)]>0x0){const _0x9ceef8=_0x3aaf7d[_0x35467b(0xf6d)](_0x549681=>_0x549681['id']);await db[_0x35467b(0x75b)][_0x35467b(0xf71)](_0x9ceef8),console[_0x35467b(0xc0d)]('✅\x20删除了\x20'+_0x3aaf7d[_0x35467b(0xcbf)]+_0x35467b(0xb85));}const _0x2a3cb7=await db[_0x35467b(0x222e)][_0x35467b(0x4a6)]('characterId')[_0x35467b(0x14a)](_0x4b766a)['toArray']();if(_0x2a3cb7[_0x35467b(0xcbf)]>0x0){const _0x5009ea=_0x2a3cb7[_0x35467b(0xf6d)](_0x1762f7=>_0x1762f7['id']);await db[_0x35467b(0x222e)][_0x35467b(0xf71)](_0x5009ea),console['log']('✅\x20删除了\x20'+_0x2a3cb7[_0x35467b(0xcbf)]+_0x35467b(0xc25));}const _0x536ef6=await db['coreMemories'][_0x35467b(0x4a6)](_0x35467b(0x10df))[_0x35467b(0x14a)](_0x4b766a)[_0x35467b(0x18c6)]();if(_0x536ef6[_0x35467b(0xcbf)]>0x0){const _0x19d9b1=_0x536ef6['map'](_0x32d4ea=>_0x32d4ea['id']);await db[_0x35467b(0xa1b)][_0x35467b(0xf71)](_0x19d9b1),console[_0x35467b(0xc0d)](_0x35467b(0x1f36)+_0x536ef6[_0x35467b(0xcbf)]+'\x20条核心记忆');}renderSMSMessageList(),window[_0x35467b(0x1bad)]&&window[_0x35467b(0x1bad)]['id']===_0x4b766a&&hideSMSChat(),showToast('✅\x20已删除与\x20'+_0xcd024e[_0x35467b(0x222f)]+_0x35467b(0x615),'success'),console[_0x35467b(0xc0d)](_0x35467b(0xab8)+_0x3aaf7d[_0x35467b(0xcbf)]+_0x35467b(0xe2)+_0x2a3cb7[_0x35467b(0xcbf)]+_0x35467b(0x9d9)+_0x536ef6[_0x35467b(0xcbf)]+_0x35467b(0x126d));}catch(_0x1ea92d){console[_0x35467b(0x24ab)](_0x35467b(0xf35),_0x1ea92d),showToast(_0x35467b(0x606),_0x35467b(0x24ab));}}let isSMSListMultiSelectMode=![],selectedSMSConversations=new Set(),pinnedSMSConversations=new Set();function showSMSManageOptions(){const _0x48212f=_0x2cf6d4,_0x30ffec=document[_0x48212f(0x566)](_0x48212f(0x1af8));_0x30ffec&&(_0x30ffec[_0x48212f(0x655)][_0x48212f(0x2526)]=_0x48212f(0x1f0b));}function hideSMSManageOptions(_0x31c75b){const _0x41f29a=_0x2cf6d4;if(_0x31c75b&&_0x31c75b[_0x41f29a(0x1144)]!==_0x31c75b[_0x41f29a(0x52b)])return;const _0x77ded6=document[_0x41f29a(0x566)]('sms-manage-modal');_0x77ded6&&(_0x77ded6[_0x41f29a(0x655)]['display']=_0x41f29a(0xfe9));}function enterSMSListMultiSelectMode(){const _0x16c241=_0x2cf6d4;hideSMSManageOptions(),isSMSListMultiSelectMode=!![],selectedSMSConversations[_0x16c241(0x2215)]();const _0x35a8ab=document['getElementById'](_0x16c241(0x2039)),_0x46885e=document[_0x16c241(0x566)](_0x16c241(0x126b));if(_0x35a8ab)_0x35a8ab[_0x16c241(0x655)][_0x16c241(0x2526)]=_0x16c241(0xfe9);if(_0x46885e)_0x46885e[_0x16c241(0x655)][_0x16c241(0x2526)]=_0x16c241(0x1f0b);renderSMSMessageList();}function enterSMSPinMode(){const _0x4e45e0=_0x2cf6d4;hideSMSManageOptions(),isSMSListMultiSelectMode=!![],selectedSMSConversations[_0x4e45e0(0x2215)]();const _0x46a27d=document[_0x4e45e0(0x566)]('sms-normal-actions'),_0xa817a0=document[_0x4e45e0(0x566)](_0x4e45e0(0x126b));if(_0x46a27d)_0x46a27d['style'][_0x4e45e0(0x2526)]=_0x4e45e0(0xfe9);if(_0xa817a0){_0xa817a0[_0x4e45e0(0x655)][_0x4e45e0(0x2526)]=_0x4e45e0(0x1f0b);const _0x570986=_0xa817a0[_0x4e45e0(0x15b8)]('.delete-btn');_0x570986&&(_0x570986['innerHTML']=_0x4e45e0(0x1096),_0x570986[_0x4e45e0(0x11cf)]=pinSelectedSMSConversations,_0x570986[_0x4e45e0(0x655)][_0x4e45e0(0xc3c)]='rgba(255,\x20193,\x207,\x200.12)',_0x570986[_0x4e45e0(0x655)][_0x4e45e0(0x2099)]=_0x4e45e0(0x1474));}renderSMSMessageList();}function exitSMSListMultiSelectMode(){const _0x218031=_0x2cf6d4;isSMSListMultiSelectMode=![],selectedSMSConversations[_0x218031(0x2215)]();const _0x281594=document[_0x218031(0x566)](_0x218031(0x2039)),_0x446a09=document[_0x218031(0x566)]('sms-list-multiselect-actions');if(_0x281594)_0x281594[_0x218031(0x655)][_0x218031(0x2526)]=_0x218031(0x1f0b);if(_0x446a09){_0x446a09[_0x218031(0x655)][_0x218031(0x2526)]='none';const _0x218358=_0x446a09[_0x218031(0x15b8)](_0x218031(0x10b4));_0x218358&&(_0x218358[_0x218031(0xc02)]=_0x218031(0xa11),_0x218358['onclick']=deleteSelectedSMSConversations,_0x218358[_0x218031(0x655)][_0x218031(0xc3c)]=_0x218031(0x219d),_0x218358[_0x218031(0x655)][_0x218031(0x2099)]=_0x218031(0x21e9));}renderSMSMessageList();}function toggleSMSConversationSelection(_0x22f8ff){const _0x463de2=_0x2cf6d4;selectedSMSConversations['has'](_0x22f8ff)?selectedSMSConversations[_0x463de2(0xc2b)](_0x22f8ff):selectedSMSConversations[_0x463de2(0xe1)](_0x22f8ff),renderSMSMessageList(),selectedSMSConversations[_0x463de2(0x41a)]===0x0&&exitSMSListMultiSelectMode();}async function deleteSelectedSMSConversations(){const _0x139232=_0x2cf6d4;if(selectedSMSConversations[_0x139232(0x41a)]===0x0){showToast('请先选择要删除的对话',_0x139232(0x24ab));return;}const _0x1ae7bd=selectedSMSConversations[_0x139232(0x41a)],_0x446bbf=_0x139232(0x5d1)+_0x1ae7bd+_0x139232(0x1caa);if(confirm(_0x446bbf))try{console[_0x139232(0xc0d)](_0x139232(0x737)+_0x1ae7bd+'\x20个短信对话和相关记忆...');let _0x1a6534=0x0,_0x246310=0x0,_0x4618b5=0x0;for(const _0x1f59f2 of selectedSMSConversations){const _0x1b191d=smsContacts[_0x139232(0x167a)](_0x1f59f2);_0x1b191d>-0x1&&smsContacts[_0x139232(0x220f)](_0x1b191d,0x1);smsMessages[_0x1f59f2]&&delete smsMessages[_0x1f59f2];await db[_0x139232(0x174a)]('rw',[db[_0x139232(0x111c)],db[_0x139232(0xd94)]],async()=>{const _0x2df124=_0x139232;await db['smsContacts'][_0x2df124(0x4a6)]('characterId')[_0x2df124(0x14a)](_0x1f59f2)[_0x2df124(0xc2b)](),await db[_0x2df124(0xd94)][_0x2df124(0x4a6)](_0x2df124(0x10df))[_0x2df124(0x14a)](_0x1f59f2)[_0x2df124(0xc2b)]();});const _0x14bf6c=await db[_0x139232(0x75b)][_0x139232(0x4a6)](_0x139232(0x10df))[_0x139232(0x14a)](_0x1f59f2)[_0x139232(0x1534)](_0x116f18=>_0x116f18[_0x139232(0x12e0)]===_0x139232(0x1bc6))[_0x139232(0x18c6)]();if(_0x14bf6c[_0x139232(0xcbf)]>0x0){const _0x29846b=_0x14bf6c[_0x139232(0xf6d)](_0x49a40=>_0x49a40['id']);await db[_0x139232(0x75b)][_0x139232(0xf71)](_0x29846b),_0x1a6534+=_0x14bf6c[_0x139232(0xcbf)];}const _0x303992=await db[_0x139232(0x222e)][_0x139232(0x4a6)](_0x139232(0x10df))[_0x139232(0x14a)](_0x1f59f2)[_0x139232(0x18c6)]();if(_0x303992[_0x139232(0xcbf)]>0x0){const _0xc5828a=_0x303992[_0x139232(0xf6d)](_0x1c8084=>_0x1c8084['id']);await db['episodicMemories']['bulkDelete'](_0xc5828a),_0x246310+=_0x303992[_0x139232(0xcbf)];}const _0x5d60ec=await db[_0x139232(0xa1b)][_0x139232(0x4a6)](_0x139232(0x10df))[_0x139232(0x14a)](_0x1f59f2)[_0x139232(0x18c6)]();if(_0x5d60ec[_0x139232(0xcbf)]>0x0){const _0x1837a9=_0x5d60ec[_0x139232(0xf6d)](_0x27d32b=>_0x27d32b['id']);await db[_0x139232(0xa1b)]['bulkDelete'](_0x1837a9),_0x4618b5+=_0x5d60ec[_0x139232(0xcbf)];}}exitSMSListMultiSelectMode(),showToast('✅\x20已删除\x20'+_0x1ae7bd+'\x20个短信对话和所有相关记忆',_0x139232(0xb27)),console[_0x139232(0xc0d)](_0x139232(0xa50)+_0x1ae7bd+_0x139232(0x1e31)+_0x1a6534+_0x139232(0xe2)+_0x246310+_0x139232(0x9d9)+_0x4618b5+'条核心记忆');}catch(_0x4f083e){console[_0x139232(0x24ab)](_0x139232(0x840),_0x4f083e),showToast(_0x139232(0x1681),_0x139232(0x24ab));}}async function pinSelectedSMSConversations(){const _0x346830=_0x2cf6d4;if(selectedSMSConversations[_0x346830(0x41a)]===0x0){showToast(_0x346830(0x260),'error');return;}try{for(const _0x409ced of selectedSMSConversations){pinnedSMSConversations['has'](_0x409ced)?pinnedSMSConversations['delete'](_0x409ced):pinnedSMSConversations[_0x346830(0xe1)](_0x409ced);}localStorage['setItem'](_0x346830(0x2214),JSON['stringify']([...pinnedSMSConversations])),exitSMSListMultiSelectMode();const _0x3809fb=selectedSMSConversations[_0x346830(0x41a)];showToast('✅\x20已更新\x20'+_0x3809fb+'\x20个对话的置顶状态',_0x346830(0xb27));}catch(_0x538356){console['error'](_0x346830(0x103b),_0x538356),showToast('置顶对话失败',_0x346830(0x24ab));}}function loadPinnedSMSConversations(){const _0x750572=_0x2cf6d4;try{const _0x57944a=localStorage[_0x750572(0x2250)](_0x750572(0x2214));_0x57944a&&(pinnedSMSConversations=new Set(JSON[_0x750572(0x168e)](_0x57944a)));}catch(_0x2c9ed1){console['error'](_0x750572(0x205f),_0x2c9ed1),pinnedSMSConversations=new Set();}}function showPhotoWidgetOptions(){const _0x3e52dd=_0x2cf6d4;document[_0x3e52dd(0x566)](_0x3e52dd(0x2356))[_0x3e52dd(0x655)][_0x3e52dd(0x2526)]=_0x3e52dd(0x1f0b);}function closePhotoWidgetModal(){const _0xb5fb23=_0x2cf6d4;document[_0xb5fb23(0x566)](_0xb5fb23(0x2356))[_0xb5fb23(0x655)][_0xb5fb23(0x2526)]=_0xb5fb23(0xfe9);}function handlePhotoWidgetUpload(_0x51eed4){const _0x3ca23a=_0x2cf6d4;if(_0x51eed4[_0x3ca23a(0x173e)]&&_0x51eed4[_0x3ca23a(0x173e)][0x0]){const _0x294f76=_0x51eed4['files'][0x0],_0x46f09e=new FileReader();_0x46f09e[_0x3ca23a(0xc28)]=function(_0x1517dd){const _0x6128fa=_0x3ca23a,_0x1d6afb=_0x1517dd['target'][_0x6128fa(0x1fff)];localStorage['setItem'](_0x6128fa(0x91b),_0x1d6afb),updatePhotoWidget(_0x1d6afb),showToast(_0x6128fa(0x1871),_0x6128fa(0xb27)),closePhotoWidgetModal();},_0x46f09e[_0x3ca23a(0x145e)](_0x294f76);}}function updatePhotoWidget(_0x889fe8){const _0x520489=_0x2cf6d4,_0x55ae30=document[_0x520489(0x566)](_0x520489(0x14be)),_0x38c305=document[_0x520489(0x566)]('photo-widget-image');_0x889fe8?(_0x55ae30[_0x520489(0x655)][_0x520489(0x2526)]=_0x520489(0xfe9),_0x38c305[_0x520489(0x107)]=_0x889fe8,_0x38c305[_0x520489(0x655)][_0x520489(0x2526)]='block',_0x38c305[_0x520489(0xc28)]=function(){}):(_0x55ae30['style']['display']=_0x520489(0x2d4),_0x38c305[_0x520489(0x655)][_0x520489(0x2526)]=_0x520489(0xfe9));}function clearPhotoWidget(){const _0x3b0c2d=_0x2cf6d4;localStorage['removeItem']('photoWidgetImage'),updatePhotoWidget(null),showToast(_0x3b0c2d(0x297),_0x3b0c2d(0xb27)),closePhotoWidgetModal();}function showAnniversaryWidgetOptions(){const _0x405329=_0x2cf6d4;updateAnniversaryWidgetSelect(),document[_0x405329(0x566)](_0x405329(0x1649))[_0x405329(0x655)][_0x405329(0x2526)]=_0x405329(0x1f0b);}function closeAnniversaryWidgetModal(){const _0x126a8b=_0x2cf6d4;document[_0x126a8b(0x566)](_0x126a8b(0x1649))[_0x126a8b(0x655)][_0x126a8b(0x2526)]=_0x126a8b(0xfe9);}function updateAnniversaryWidgetSelect(){const _0x509dcc=_0x2cf6d4,_0x298d42=document['getElementById']('widget-anniversary-select'),_0x32e81f=localStorage[_0x509dcc(0x2250)](_0x509dcc(0xc8e));_0x298d42[_0x509dcc(0xc02)]=_0x509dcc(0x2533);const _0x103fbd=anniversaries[_0x509dcc(0x803)](_0x3b5b7b=>_0x3b5b7b[_0x509dcc(0x23bd)]),_0x7d8c84=anniversaries[_0x509dcc(0x803)](_0x26c000=>!_0x26c000['isPinned']);if(_0x103fbd[_0x509dcc(0xcbf)]>0x0){const _0x1424be=document[_0x509dcc(0x1ad8)](_0x509dcc(0xceb));_0x1424be[_0x509dcc(0x20f7)]=_0x509dcc(0x7cb),_0x103fbd[_0x509dcc(0x900)](_0x57faa8=>{const _0x5bb312=_0x509dcc,_0x77ef6a=document['createElement'](_0x5bb312(0x1e6c));_0x77ef6a['value']=_0x57faa8['id'],_0x77ef6a[_0x5bb312(0x21dc)]=_0x57faa8[_0x5bb312(0x222f)],_0x57faa8['id']===_0x32e81f&&(_0x77ef6a[_0x5bb312(0x876)]=!![]),_0x1424be[_0x5bb312(0x1925)](_0x77ef6a);}),_0x298d42['appendChild'](_0x1424be);}if(_0x7d8c84[_0x509dcc(0xcbf)]>0x0){const _0x5f2542=document['createElement'](_0x509dcc(0xceb));_0x5f2542['label']=_0x509dcc(0x2047),_0x7d8c84['forEach'](_0x5bc5c2=>{const _0x34162e=_0x509dcc,_0x3fd5e7=document[_0x34162e(0x1ad8)]('option');_0x3fd5e7[_0x34162e(0xc34)]=_0x5bc5c2['id'],_0x3fd5e7[_0x34162e(0x21dc)]=_0x5bc5c2[_0x34162e(0x222f)],_0x5bc5c2['id']===_0x32e81f&&(_0x3fd5e7[_0x34162e(0x876)]=!![]),_0x5f2542['appendChild'](_0x3fd5e7);}),_0x298d42['appendChild'](_0x5f2542);}}function updateAnniversaryWidget(){const _0x27237d=_0x2cf6d4,_0x2e8a0c=document['getElementById'](_0x27237d(0x215b)),_0x4b52fc=_0x2e8a0c[_0x27237d(0xc34)];if(_0x4b52fc){const _0x5d8ecb=anniversaries[_0x27237d(0x1aeb)](_0x50a61f=>_0x50a61f['id']===_0x4b52fc);_0x5d8ecb&&(localStorage[_0x27237d(0x2055)](_0x27237d(0xc8e),_0x4b52fc),displayAnniversaryWidget(_0x5d8ecb),showToast(_0x27237d(0x2309),_0x27237d(0xb27)));}else clearAnniversaryWidget();}function displayAnniversaryWidget(_0x169eed){const _0x2a1773=_0x2cf6d4,_0x2d01b3=document[_0x2a1773(0x566)](_0x2a1773(0xf3)),_0x2f0719=document[_0x2a1773(0x566)]('anniversary-display'),_0x4770db=document[_0x2a1773(0x566)](_0x2a1773(0x23f9)),_0x4e06c3=document['getElementById'](_0x2a1773(0x3ca)),_0x517506=document['getElementById'](_0x2a1773(0xfe3)),_0x39684a=document[_0x2a1773(0x15b8)]('.anniversary-widget-content')[_0x2a1773(0x666)],_0x574459=new Date(),_0x23b052=_0x574459[_0x2a1773(0x885)](),_0x5b0f91=new Date(_0x169eed[_0x2a1773(0x1c5b)]),_0x401554=_0x169eed[_0x2a1773(0x103e)]||'countdown';let _0x27c163='';if(_0x401554===_0x2a1773(0x762)){const _0x5ad1f2=new Date(_0x574459[_0x2a1773(0x885)](),_0x574459[_0x2a1773(0x17f3)](),_0x574459[_0x2a1773(0x1d02)]()),_0x15ed16=new Date(_0x5b0f91[_0x2a1773(0x885)](),_0x5b0f91[_0x2a1773(0x17f3)](),_0x5b0f91[_0x2a1773(0x1d02)]()),_0xedd479=Math[_0x2a1773(0x1dac)]((_0x5ad1f2-_0x15ed16)/(0x3e8*0x3c*0x3c*0x18));_0x27c163=_0xedd479===0x0?'今天':''+_0xedd479;}else{const _0x24a746=new Date(_0x574459['getFullYear'](),_0x574459[_0x2a1773(0x17f3)](),_0x574459[_0x2a1773(0x1d02)]());let _0x46d66f=new Date(_0x23b052,_0x5b0f91[_0x2a1773(0x17f3)](),_0x5b0f91['getDate']());_0x46d66f<_0x24a746&&_0x46d66f['setFullYear'](_0x23b052+0x1);const _0x2437b4=Math[_0x2a1773(0x1dac)]((_0x46d66f-_0x24a746)/(0x3e8*0x3c*0x3c*0x18));_0x27c163=_0x2437b4===0x0?'今天':_0x2437b4===0x1?'明天':''+_0x2437b4;}_0x4770db[_0x2a1773(0x21dc)]=_0x169eed[_0x2a1773(0x222f)],_0x4e06c3[_0x2a1773(0x21dc)]=_0x27c163,_0x517506[_0x2a1773(0x21dc)]=formatDate(_0x169eed[_0x2a1773(0x1c5b)]);if(_0x169eed['backgroundImage']){_0x39684a[_0x2a1773(0x655)][_0x2a1773(0x1584)]=_0x2a1773(0xa80)+_0x169eed['backgroundImage']+'\x27)',_0x39684a[_0x2a1773(0x655)][_0x2a1773(0x2000)]='cover',_0x39684a[_0x2a1773(0x655)][_0x2a1773(0x18b3)]=_0x2a1773(0x23a1),_0x39684a['style'][_0x2a1773(0x12be)]='no-repeat',_0x39684a['style'][_0x2a1773(0x492)]='relative';if(!_0x39684a['querySelector'](_0x2a1773(0x7ca))){const _0x4490d5=document[_0x2a1773(0x1ad8)](_0x2a1773(0x526));_0x4490d5[_0x2a1773(0x221)]=_0x2a1773(0x11dc),_0x4490d5['style'][_0x2a1773(0x17a3)]=_0x2a1773(0x2b5),_0x39684a[_0x2a1773(0x1925)](_0x4490d5);}const _0x1369f0=_0x39684a['querySelector'](_0x2a1773(0x1cc1));if(_0x1369f0){_0x1369f0['style'][_0x2a1773(0x492)]='relative',_0x1369f0[_0x2a1773(0x655)][_0x2a1773(0x8bc)]='2';const _0x2a9e8d=_0x1369f0[_0x2a1773(0x15b8)](_0x2a1773(0x444)),_0x52f94b=_0x1369f0[_0x2a1773(0x15b8)](_0x2a1773(0x22e)),_0x47f59a=_0x1369f0[_0x2a1773(0x15b8)]('#widget-anniversary-date');_0x2a9e8d&&(_0x2a9e8d['style'][_0x2a1773(0x17a3)]+=_0x2a1773(0x1e98)),_0x52f94b&&(_0x52f94b['style'][_0x2a1773(0x17a3)]+=_0x2a1773(0x1fba)),_0x47f59a&&(_0x47f59a['style']['cssText']+=_0x2a1773(0x85a));}}else{_0x39684a['style'][_0x2a1773(0x1584)]='';const _0x4a7366=_0x39684a[_0x2a1773(0x15b8)](_0x2a1773(0x7ca));_0x4a7366&&_0x4a7366[_0x2a1773(0x128)]();}_0x2d01b3[_0x2a1773(0x655)][_0x2a1773(0x2526)]=_0x2a1773(0xfe9),_0x2f0719['style'][_0x2a1773(0x2526)]='block';}function clearAnniversaryWidget(){const _0x557b20=_0x2cf6d4;localStorage[_0x557b20(0x1c95)](_0x557b20(0xc8e));const _0x62824d=document[_0x557b20(0x566)](_0x557b20(0xf3)),_0x246aec=document[_0x557b20(0x566)](_0x557b20(0x2497)),_0xcd3180=document[_0x557b20(0x15b8)](_0x557b20(0x1cc1))[_0x557b20(0x666)];if(_0xcd3180){_0xcd3180[_0x557b20(0x655)][_0x557b20(0x1584)]='';const _0x5c7d0a=_0xcd3180['querySelector'](_0x557b20(0x7ca));_0x5c7d0a&&_0x5c7d0a[_0x557b20(0x128)]();}_0x62824d[_0x557b20(0x655)][_0x557b20(0x2526)]=_0x557b20(0x2d4),_0x246aec[_0x557b20(0x655)][_0x557b20(0x2526)]=_0x557b20(0xfe9),showToast(_0x557b20(0x202a),'success');}function refreshAnniversaryWidget(){const _0x2bd308=_0x2cf6d4;if(anniversaries&&anniversaries['length']>0x0){const _0x3e7ca8=anniversaries['find'](_0x481f34=>_0x481f34[_0x2bd308(0x23bd)]);if(_0x3e7ca8){localStorage[_0x2bd308(0x2055)](_0x2bd308(0xc8e),_0x3e7ca8['id']),displayAnniversaryWidget(_0x3e7ca8);return;}const _0x59475b=anniversaries[0x0];_0x59475b&&(localStorage[_0x2bd308(0x2055)](_0x2bd308(0xc8e),_0x59475b['id']),displayAnniversaryWidget(_0x59475b));}else clearAnniversaryWidget();}window['refreshWidget']=refreshAnniversaryWidget,window[_0x2cf6d4(0x13c0)]={'listAnniversaries':()=>{const _0x617dd0=_0x2cf6d4;console[_0x617dd0(0xf98)](anniversaries[_0x617dd0(0xf6d)](_0x1dd1f6=>({'id':_0x1dd1f6['id'],'name':_0x1dd1f6[_0x617dd0(0x222f)],'isPinned':_0x1dd1f6[_0x617dd0(0x23bd)],'hasBackground':!!_0x1dd1f6[_0x617dd0(0x1584)],'hasUserAvatar':!!_0x1dd1f6[_0x617dd0(0x21cd)]})));},'checkWidget':()=>{const _0x411d96=_0x2cf6d4,_0x5f42e6=localStorage['getItem'](_0x411d96(0xc8e)),_0x2e297=anniversaries[_0x411d96(0x1aeb)](_0x50eaab=>_0x50eaab['id']===_0x5f42e6);console[_0x411d96(0xc0d)](_0x411d96(0x2106),{'savedId':_0x5f42e6,'currentAnniversary':_0x2e297?_0x2e297['name']:'未找到','isPinned':_0x2e297?_0x2e297['isPinned']:![],'hasBackground':_0x2e297?!!_0x2e297[_0x411d96(0x1584)]:![]});},'refresh':refreshAnniversaryWidget,'clear':clearAnniversaryWidget};function initializeWidgets(){const _0x43ed01=_0x2cf6d4;try{const _0x26ec11=localStorage[_0x43ed01(0x2250)](_0x43ed01(0x91b));_0x26ec11&&updatePhotoWidget(_0x26ec11);const _0xbeeece=localStorage['getItem'](_0x43ed01(0xc8e));if(anniversaries&&anniversaries['length']>0x0){let _0x1aaa6e=null;_0xbeeece&&(_0x1aaa6e=anniversaries[_0x43ed01(0x1aeb)](_0x1455a5=>_0x1455a5['id']===_0xbeeece));if(!_0x1aaa6e){const _0x2366f4=anniversaries['find'](_0x4f0d62=>_0x4f0d62['isPinned']);_0x2366f4&&(_0x1aaa6e=_0x2366f4,localStorage[_0x43ed01(0x2055)](_0x43ed01(0xc8e),_0x2366f4['id']));}_0x1aaa6e&&displayAnniversaryWidget(_0x1aaa6e);}}catch(_0x3629b6){console[_0x43ed01(0x24ab)](_0x43ed01(0xb40),_0x3629b6);}}function togglePhotoText(_0x10e879,_0x115ba2){const _0x31ebb9=_0x2cf6d4,_0x4031c1=_0x10e879[_0x31ebb9(0x15b8)](_0x31ebb9(0x5f8)),_0x50a42c=_0x10e879[_0x31ebb9(0x15b8)](_0x31ebb9(0x21b7)),_0x11c23c=_0x10e879['querySelector'](_0x31ebb9(0x1e17));_0x4031c1[_0x31ebb9(0x655)][_0x31ebb9(0x2526)]===_0x31ebb9(0xfe9)?(_0x4031c1['style']['display']=_0x31ebb9(0x1f0b),_0x50a42c['style']['opacity']='0',_0x11c23c[_0x31ebb9(0x655)][_0x31ebb9(0x671)]=_0x31ebb9(0x1783)):(_0x4031c1[_0x31ebb9(0x655)]['display']=_0x31ebb9(0xfe9),_0x50a42c[_0x31ebb9(0x655)]['opacity']='1',_0x11c23c['style'][_0x31ebb9(0x671)]='1');}function showUserPhotoDescription(_0x1a5d00){const _0x104f95=_0x2cf6d4,_0x351593='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22photo-description-modal\x22\x20class=\x22modal\x22\x20style=\x22display:\x20flex;\x20z-index:\x2010000;\x20background:\x20rgba(0,\x200,\x200,\x200.8);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22magical-photo-modal\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22photo-modal-bg\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22photo-modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22photo-modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-camera\x20photo-modal-icon\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22photo-modal-title\x22>照片内容</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22photo-modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22photo-description-text\x22>'+_0x1a5d00+_0x104f95(0x14ec);document[_0x104f95(0x172c)][_0x104f95(0x22ba)](_0x104f95(0x580),_0x351593);const _0x37d17a=document['getElementById'](_0x104f95(0x1410)),_0x134713=document[_0x104f95(0x566)](_0x104f95(0x182e));_0x134713[_0x104f95(0x11cf)]=()=>{const _0x846778=_0x104f95;_0x37d17a[_0x846778(0x128)]();},_0x37d17a[_0x104f95(0x11cf)]=_0x2228e5=>{const _0x523d49=_0x104f95;_0x2228e5[_0x523d49(0x1144)]===_0x37d17a&&_0x37d17a[_0x523d49(0x128)]();};}function showCustomPrompt(_0x4cdc81,_0x6c0931,_0xb2293b='',_0x563cc8=_0x2cf6d4(0x1e58)){return new Promise(_0x5849f1=>{const _0x54f840=_0x3a81,_0x3fe7a9=_0x4cdc81===_0x54f840(0x131a)||_0x4cdc81===_0x54f840(0x174c),_0x28af8c=_0x54f840(0x1d9c)+(_0x3fe7a9?'500px':_0x54f840(0x2387))+_0x54f840(0x245c)+_0x4cdc81+_0x54f840(0x1409)+(_0x3fe7a9?_0x54f840(0x23c9)+_0x6c0931+_0x54f840(0x1c31)+_0xb2293b+_0x54f840(0xca4):_0x54f840(0x12d3)+_0x563cc8+'\x22\x20id=\x22custom-prompt-input\x22\x20class=\x22form-input\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20placeholder=\x22'+_0x6c0931+_0x54f840(0x8c3)+_0xb2293b+_0x54f840(0xa8f))+_0x54f840(0xccd);document[_0x54f840(0x172c)][_0x54f840(0x22ba)](_0x54f840(0x580),_0x28af8c);const _0x2ce8f2=document['getElementById'](_0x54f840(0x1cb9)),_0x1ae40c=document['getElementById'](_0x54f840(0x2091)),_0x10ca6c=document[_0x54f840(0x566)]('custom-prompt-confirm'),_0xb317d=document[_0x54f840(0x566)]('custom-prompt-cancel');_0x10ca6c[_0x54f840(0x11cf)]=()=>{const _0x47e6f3=_0x54f840,_0x48e71f=_0x1ae40c[_0x47e6f3(0xc34)];_0x2ce8f2[_0x47e6f3(0x128)](),_0x5849f1(_0x48e71f);},_0xb317d[_0x54f840(0x11cf)]=()=>{const _0x1f1a81=_0x54f840;_0x2ce8f2[_0x1f1a81(0x128)](),_0x5849f1(null);},_0x1ae40c['onkeydown']=_0xa2bbbf=>{const _0x3c02b1=_0x54f840;_0x3fe7a9?_0xa2bbbf['key']==='Enter'&&_0xa2bbbf['ctrlKey']&&(_0xa2bbbf[_0x3c02b1(0x4d9)](),_0x10ca6c[_0x3c02b1(0x1e62)]()):_0xa2bbbf[_0x3c02b1(0x157f)]==='Enter'&&_0x10ca6c[_0x3c02b1(0x1e62)]();},setTimeout(()=>_0x1ae40c[_0x54f840(0x1b12)](),0x64);});}function switchChatTab(_0x4be2bd){const _0x1fdc9a=_0x2cf6d4;document['querySelectorAll'](_0x1fdc9a(0x1c9f))[_0x1fdc9a(0x900)](_0x56f217=>{const _0x49bc94=_0x1fdc9a;_0x56f217&&_0x56f217[_0x49bc94(0x226e)]&&_0x56f217[_0x49bc94(0x226e)][_0x49bc94(0x128)](_0x49bc94(0x105d));});if(event&&event[_0x1fdc9a(0x52b)]&&event[_0x1fdc9a(0x52b)]['classList'])event[_0x1fdc9a(0x52b)][_0x1fdc9a(0x226e)]['add']('active');else{if(_0x4be2bd==='message-list'){const _0x4a0b6e=document[_0x1fdc9a(0x566)](_0x1fdc9a(0x1e36));_0x4a0b6e&&_0x4a0b6e[_0x1fdc9a(0x226e)]&&_0x4a0b6e[_0x1fdc9a(0x226e)][_0x1fdc9a(0xe1)](_0x1fdc9a(0x105d));}else{if(_0x4be2bd===_0x1fdc9a(0x1853)){const _0x47d87d=document[_0x1fdc9a(0x1ed9)](_0x1fdc9a(0x1c9f));_0x47d87d['length']>0x1&&_0x47d87d[0x1]&&_0x47d87d[0x1][_0x1fdc9a(0x226e)]&&_0x47d87d[0x1][_0x1fdc9a(0x226e)]['add'](_0x1fdc9a(0x105d));}else{if(_0x4be2bd===_0x1fdc9a(0xbdc)){const _0xb76328=document[_0x1fdc9a(0x1ed9)](_0x1fdc9a(0x1c9f));_0xb76328[_0x1fdc9a(0xcbf)]>0x2&&_0xb76328[0x2]&&_0xb76328[0x2]['classList']&&_0xb76328[0x2][_0x1fdc9a(0x226e)][_0x1fdc9a(0xe1)](_0x1fdc9a(0x105d));}else{if(_0x4be2bd===_0x1fdc9a(0x10de)){const _0x773393=document[_0x1fdc9a(0x1ed9)](_0x1fdc9a(0x1c9f));_0x773393[_0x1fdc9a(0xcbf)]>0x3&&_0x773393[0x3]&&_0x773393[0x3]['classList']&&_0x773393[0x3][_0x1fdc9a(0x226e)]['add']('active');}}}}}const _0x1cafc1=document[_0x1fdc9a(0x566)](_0x1fdc9a(0xda4)),_0xcef7db=document[_0x1fdc9a(0x566)]('contact-list'),_0x426486=document[_0x1fdc9a(0x566)](_0x1fdc9a(0x10de)),_0x2958be=document['getElementById']('moments-page'),_0x4ac06e=document[_0x1fdc9a(0x566)](_0x4be2bd);if(_0x1cafc1)_0x1cafc1[_0x1fdc9a(0x655)]['display']='none';if(_0xcef7db)_0xcef7db[_0x1fdc9a(0x655)][_0x1fdc9a(0x2526)]=_0x1fdc9a(0xfe9);if(_0x426486)_0x426486['style']['display']=_0x1fdc9a(0xfe9);if(_0x2958be)_0x2958be['style']['display']='none';if(_0x4ac06e)_0x4ac06e[_0x1fdc9a(0x655)][_0x1fdc9a(0x2526)]=_0x1fdc9a(0x2d4);const _0x2c3e74=document[_0x1fdc9a(0x15b8)]('#chat-screen\x20.app-title');if(_0x2c3e74){if(_0x4be2bd===_0x1fdc9a(0xda4))_0x2c3e74[_0x1fdc9a(0x226e)][_0x1fdc9a(0xe1)]('chat-mode'),_0x2c3e74[_0x1fdc9a(0x21dc)]='💬';else{if(_0x4be2bd===_0x1fdc9a(0x1853))_0x2c3e74['classList']['remove'](_0x1fdc9a(0xe85)),_0x2c3e74[_0x1fdc9a(0x21dc)]='角色';else{if(_0x4be2bd===_0x1fdc9a(0xbdc))_0x2c3e74['classList'][_0x1fdc9a(0x128)](_0x1fdc9a(0xe85)),_0x2c3e74[_0x1fdc9a(0x21dc)]='动态',loadMomentsImages();else _0x4be2bd===_0x1fdc9a(0x10de)&&(_0x2c3e74[_0x1fdc9a(0x226e)]['remove'](_0x1fdc9a(0xe85)),_0x2c3e74[_0x1fdc9a(0x21dc)]='我');}}}const _0xf0b2be=document[_0x1fdc9a(0x566)](_0x1fdc9a(0xfdc)),_0x2bf287=document[_0x1fdc9a(0x566)](_0x1fdc9a(0x66b)),_0x134bca=document[_0x1fdc9a(0x566)]('group-manage-btn');if(_0xf0b2be&&_0x2bf287&&_0x134bca){if(_0x4be2bd===_0x1fdc9a(0x1853))_0xf0b2be[_0x1fdc9a(0x655)][_0x1fdc9a(0x2526)]=_0x1fdc9a(0x1f0b),_0x2bf287['style']['display']=_0x1fdc9a(0xfe9),_0x134bca[_0x1fdc9a(0x655)]['display']=isGroupManageMode?_0x1fdc9a(0xfe9):_0x1fdc9a(0x1f0b),_0xf0b2be['onclick']=()=>showCharacterForm();else{if(_0x4be2bd===_0x1fdc9a(0xda4))_0xf0b2be['style'][_0x1fdc9a(0x2526)]='none',_0x2bf287[_0x1fdc9a(0x655)][_0x1fdc9a(0x2526)]=_0x1fdc9a(0x1f0b),_0x134bca['style'][_0x1fdc9a(0x2526)]=_0x1fdc9a(0xfe9);else _0x4be2bd===_0x1fdc9a(0xbdc)?(_0xf0b2be[_0x1fdc9a(0x655)][_0x1fdc9a(0x2526)]=_0x1fdc9a(0x1f0b),_0x2bf287[_0x1fdc9a(0x655)][_0x1fdc9a(0x2526)]=_0x1fdc9a(0xfe9),_0x134bca[_0x1fdc9a(0x655)][_0x1fdc9a(0x2526)]='none',_0xf0b2be[_0x1fdc9a(0x11cf)]=()=>showPublishMoment()):(_0xf0b2be[_0x1fdc9a(0x655)][_0x1fdc9a(0x2526)]=_0x1fdc9a(0xfe9),_0x2bf287['style'][_0x1fdc9a(0x2526)]='none',_0x134bca[_0x1fdc9a(0x655)]['display']='none');}}if(_0x4be2bd===_0x1fdc9a(0xbdc)){const _0x5182fe=document[_0x1fdc9a(0x566)]('moments-list');_0x5182fe&&_0x5182fe[_0x1fdc9a(0xebd)]['length']===0x0&&loadMoments();const _0x4f587a=document['getElementById'](_0x1fdc9a(0x1dc6));_0x4f587a&&(_0x4f587a[_0x1fdc9a(0x655)][_0x1fdc9a(0x856)]='0');}else{const _0x3c0205=document[_0x1fdc9a(0x566)](_0x1fdc9a(0x1dc6));_0x3c0205&&(_0x3c0205[_0x1fdc9a(0x655)]['padding']='15px'),stopTimeUpdater();}}function updateTime(){const _0x2bce73=_0x2cf6d4,_0x45d2d7=new Date(),_0x44a994=_0x45d2d7[_0x2bce73(0x1471)]()['toString']()[_0x2bce73(0x863)](0x2,'0'),_0x5c752e=_0x45d2d7[_0x2bce73(0x21c6)]()['toString']()[_0x2bce73(0x863)](0x2,'0'),_0x4a79df=_0x44a994+':'+_0x5c752e,_0x1efcc9=document[_0x2bce73(0x566)](_0x2bce73(0x1538));_0x1efcc9&&(_0x1efcc9['textContent']=_0x4a79df);const _0x1c4d3f=document[_0x2bce73(0x1ed9)](_0x2bce73(0xf6e));_0x1c4d3f[_0x2bce73(0x900)](_0x598f5c=>{const _0x191488=_0x2bce73;_0x598f5c[_0x191488(0x21dc)]=_0x4a79df;});const _0x35f25b=document['getElementById'](_0x2bce73(0x2498));_0x35f25b&&(_0x35f25b[_0x2bce73(0x21dc)]=_0x4a79df);const _0x2dba3f=document[_0x2bce73(0x566)](_0x2bce73(0x69e));if(_0x2dba3f){const _0x3b16f4=document[_0x2bce73(0x172c)][_0x2bce73(0x1add)](_0x2bce73(0x31a))||_0x2bce73(0xbf);let _0xf791a='';switch(_0x3b16f4){case'modern':_0xf791a=_0x45d2d7[_0x2bce73(0x177f)](_0x2bce73(0x1b75),{'weekday':'short','month':'short','day':'numeric'})[_0x2bce73(0x2110)]();break;case'compact':const _0x4366c7=_0x45d2d7[_0x2bce73(0x177f)](_0x2bce73(0x1c0b),{'month':_0x2bce73(0xf4e),'day':'numeric'}),_0x283308=_0x45d2d7[_0x2bce73(0x177f)](_0x2bce73(0x1c0b),{'weekday':_0x2bce73(0x1469)});_0xf791a=_0x4366c7+'\x20'+_0x283308;break;case _0x2bce73(0x1807):_0xf791a=_0x45d2d7[_0x2bce73(0x177f)](_0x2bce73(0x1c0b),{'month':_0x2bce73(0x2040),'day':_0x2bce73(0xf4e),'weekday':_0x2bce73(0x2040)});break;default:_0xf791a=_0x45d2d7[_0x2bce73(0x177f)](_0x2bce73(0x1c0b),{'month':'long','day':'numeric','weekday':_0x2bce73(0x2040)});break;}_0x2dba3f['textContent']=_0xf791a;}}async function loadCharacterGroups(){const _0x242ee4=_0x2cf6d4;try{const _0x2f79f8=await db[_0x242ee4(0x15e0)][_0x242ee4(0x1902)](_0x242ee4(0x2003))[_0x242ee4(0x18c6)]();if(_0x2f79f8[_0x242ee4(0xcbf)]===0x0){const _0x526fc8=[{'id':_0x242ee4(0xf58),'name':_0x242ee4(0xa8a),'order':0x3e7,'isDefault':!![],'canInteract':![]},{'id':_0x242ee4(0xb23),'name':'特别关心','order':0x1,'isDefault':![],'canInteract':!![]},{'id':_0x242ee4(0x329),'name':_0x242ee4(0x1edc),'order':0x2,'isDefault':![],'canInteract':!![]},{'id':'family','name':'家人','order':0x3,'isDefault':![],'canInteract':!![]},{'id':_0x242ee4(0xd2e),'name':'同学','order':0x4,'isDefault':![],'canInteract':!![]},{'id':_0x242ee4(0x5ca),'name':'同事','order':0x5,'isDefault':![],'canInteract':!![]}];await db[_0x242ee4(0x15e0)][_0x242ee4(0x24c8)](_0x526fc8),characterGroups=_0x526fc8;}else characterGroups=_0x2f79f8;}catch(_0x1a2022){console[_0x242ee4(0x24ab)](_0x242ee4(0x1d79),_0x1a2022),characterGroups=[{'id':_0x242ee4(0xf58),'name':'我的好友','order':0x3e7,'isDefault':!![],'canInteract':![]}];}}async function saveCharacterGroups(){const _0x52ff2d=_0x2cf6d4;try{await db[_0x52ff2d(0x15e0)]['clear'](),await db[_0x52ff2d(0x15e0)][_0x52ff2d(0x24c8)](characterGroups);}catch(_0x10c3af){console[_0x52ff2d(0x24ab)](_0x52ff2d(0x1c17),_0x10c3af);}}async function loadCharacters(){const _0x46f7ce=_0x2cf6d4;try{const _0x179102=await db[_0x46f7ce(0x164d)]['toArray']();if(_0x179102[_0x46f7ce(0xcbf)]===0x0){const _0x3e2d7e=localStorage[_0x46f7ce(0x2250)](_0x46f7ce(0x164d));if(_0x3e2d7e){const _0x22c460=JSON['parse'](_0x3e2d7e);_0x22c460['length']>0x0?(_0x22c460['forEach'](_0x34969f=>{const _0x1e0f50=_0x46f7ce;!_0x34969f[_0x1e0f50(0x1eb)]&&(_0x34969f['groupId']=_0x1e0f50(0xf58));}),await db['characters'][_0x46f7ce(0x24c8)](_0x22c460),characters=_0x22c460):characters=[];}else characters=[];}else _0x179102[_0x46f7ce(0x900)](_0x19a9ee=>{const _0x7f52cb=_0x46f7ce;!_0x19a9ee['groupId']&&(_0x19a9ee[_0x7f52cb(0x1eb)]=_0x7f52cb(0xf58));}),characters=_0x179102;}catch(_0x4aea1a){console[_0x46f7ce(0x24ab)]('加载角色数据失败:',_0x4aea1a);const _0x4363f8=localStorage[_0x46f7ce(0x2250)](_0x46f7ce(0x164d));_0x4363f8?(characters=JSON[_0x46f7ce(0x168e)](_0x4363f8),characters['forEach'](_0x42dfde=>{const _0x13e091=_0x46f7ce;!_0x42dfde[_0x13e091(0x1eb)]&&(_0x42dfde[_0x13e091(0x1eb)]=_0x13e091(0xf58));})):characters=[];}}async function saveCharacters(){const _0x32946f=_0x2cf6d4;try{const _0x3cf4f=new Set(),_0x46a8f7=[];for(const _0x47b0c3 of characters){if(!_0x47b0c3['id']){console[_0x32946f(0x17cc)]('发现没有ID的角色，跳过保存:',_0x47b0c3);continue;}!_0x3cf4f[_0x32946f(0x1af1)](_0x47b0c3['id'])?(_0x3cf4f[_0x32946f(0xe1)](_0x47b0c3['id']),_0x46a8f7[_0x32946f(0x6ee)](_0x47b0c3)):console[_0x32946f(0x17cc)](_0x32946f(0x1a04)+_0x47b0c3['id']+_0x32946f(0x1e94),_0x47b0c3);}if(_0x46a8f7[_0x32946f(0xcbf)]===0x0){console[_0x32946f(0x17cc)]('⚠️\x20拒绝保存空角色数据，可能存在数据丢失风险');return;}await db[_0x32946f(0x174a)]('rw',db[_0x32946f(0x164d)],async()=>{const _0x15abf5=_0x32946f;await db[_0x15abf5(0x164d)][_0x15abf5(0x2215)](),await db[_0x15abf5(0x164d)][_0x15abf5(0x4c5)](_0x46a8f7);}),console[_0x32946f(0xc0d)]('✅\x20安全保存了\x20'+_0x46a8f7[_0x32946f(0xcbf)]+_0x32946f(0x5d2));}catch(_0x5d233f){console[_0x32946f(0x24ab)](_0x32946f(0x109e),_0x5d233f),alert(_0x32946f(0x1bfc)+_0x5d233f[_0x32946f(0xd7a)]);throw _0x5d233f;}}function showStorageUsage(){const _0x38b8cf=_0x2cf6d4,_0x2c0a99=[],_0x5171c4=localStorage[_0x38b8cf(0x2250)](_0x38b8cf(0x164d))||'[]',_0x1524d8=localStorage[_0x38b8cf(0x2250)](_0x38b8cf(0x464))||'{}',_0x112e9b=localStorage[_0x38b8cf(0x2250)](_0x38b8cf(0x20c7))||'[]';_0x2c0a99[_0x38b8cf(0x6ee)](_0x38b8cf(0x24c1)+(_0x5171c4[_0x38b8cf(0xcbf)]/0x400)['toFixed'](0x1)+_0x38b8cf(0x9e6)),_0x2c0a99[_0x38b8cf(0x6ee)](_0x38b8cf(0x26d)+(_0x1524d8[_0x38b8cf(0xcbf)]/0x400)['toFixed'](0x1)+_0x38b8cf(0x9e6)),_0x2c0a99[_0x38b8cf(0x6ee)](_0x38b8cf(0xbe1)+(_0x112e9b['length']/0x400)[_0x38b8cf(0x3cd)](0x1)+_0x38b8cf(0x9e6));const _0x59d9ed=_0x5171c4[_0x38b8cf(0xcbf)]+_0x1524d8['length']+_0x112e9b[_0x38b8cf(0xcbf)];_0x2c0a99[_0x38b8cf(0x6ee)](_0x38b8cf(0x242c)+(_0x59d9ed/0x400)[_0x38b8cf(0x3cd)](0x1)+_0x38b8cf(0x9e6)),alert(_0x38b8cf(0x151b)+_0x2c0a99['join']('\x0a'));}async function loadContacts(){const _0x6aa4de=_0x2cf6d4;try{console[_0x6aa4de(0xc0d)](_0x6aa4de(0x24b1));const _0x518706=await db[_0x6aa4de(0xb51)]['toArray']();if(_0x518706[_0x6aa4de(0xcbf)]===0x0){const _0x80f4d=localStorage['getItem']('contacts');if(_0x80f4d){const _0x35e747=JSON[_0x6aa4de(0x168e)](_0x80f4d);contacts=Array[_0x6aa4de(0x1bcc)](_0x35e747)?_0x35e747:[],console[_0x6aa4de(0xc0d)](_0x6aa4de(0x14d)+contacts[_0x6aa4de(0xcbf)]+_0x6aa4de(0x16f6)),await saveContacts();}else contacts=[],console[_0x6aa4de(0xc0d)](_0x6aa4de(0x147e));}else{contacts=_0x518706['map'](_0x541423=>_0x541423[_0x6aa4de(0x10df)])[_0x6aa4de(0x803)](_0x2238e0=>_0x2238e0),console[_0x6aa4de(0xc0d)]('✅\x20从数据库加载了\x20'+contacts[_0x6aa4de(0xcbf)]+_0x6aa4de(0x16f6));if(characters&&characters[_0x6aa4de(0xcbf)]>0x0){const _0x3c92ce=characters[_0x6aa4de(0xf6d)](_0x3ac763=>_0x3ac763['id']),_0x5e6afc=contacts[_0x6aa4de(0x803)](_0x200e62=>_0x3c92ce['includes'](_0x200e62));if(_0x5e6afc[_0x6aa4de(0xcbf)]!==contacts[_0x6aa4de(0xcbf)]){const _0x376952=contacts[_0x6aa4de(0xcbf)]-_0x5e6afc[_0x6aa4de(0xcbf)];console[_0x6aa4de(0xc0d)](_0x6aa4de(0x1600)+_0x376952+_0x6aa4de(0x18dd)),contacts=_0x5e6afc,await saveContacts();}}}}catch(_0xbfd4b3){console['error'](_0x6aa4de(0x1156),_0xbfd4b3),characters&&characters[_0x6aa4de(0xcbf)]>0x0?(console[_0x6aa4de(0xc0d)]('🔧\x20出错时从角色列表重建联系人'),contacts=characters[_0x6aa4de(0xf6d)](_0x4f3de7=>_0x4f3de7['id'])):contacts=[];}}async function saveContacts(){const _0x239474=_0x2cf6d4;try{const _0x236a32=contacts['filter'](_0x2ce0d5=>_0x2ce0d5),_0xeb8614=_0x236a32[_0x239474(0xf6d)](_0x32acf6=>({'characterId':_0x32acf6}));await db[_0x239474(0x174a)]('rw',db[_0x239474(0xb51)],async()=>{const _0x453efd=_0x239474;await db[_0x453efd(0xb51)]['clear'](),_0xeb8614[_0x453efd(0xcbf)]>0x0&&await db[_0x453efd(0xb51)][_0x453efd(0x24c8)](_0xeb8614);});}catch(_0x209a24){console['error'](_0x239474(0x2131),_0x209a24);}}async function loadSMSContacts(){const _0x4f25ac=_0x2cf6d4;try{console[_0x4f25ac(0xc0d)](_0x4f25ac(0x198e));const _0x4b8991=await db['smsContacts'][_0x4f25ac(0x18c6)]();smsContacts=_0x4b8991[_0x4f25ac(0xf6d)](_0x197e2c=>_0x197e2c[_0x4f25ac(0x10df)])[_0x4f25ac(0x803)](_0x202f95=>_0x202f95),console[_0x4f25ac(0xc0d)](_0x4f25ac(0x2068)+smsContacts[_0x4f25ac(0xcbf)]+_0x4f25ac(0x1699));if(characters&&characters[_0x4f25ac(0xcbf)]>0x0){const _0x17bb4a=characters['map'](_0x351244=>_0x351244['id']),_0x487c79=smsContacts[_0x4f25ac(0x803)](_0x55e723=>_0x17bb4a[_0x4f25ac(0x23ec)](_0x55e723));if(_0x487c79[_0x4f25ac(0xcbf)]!==smsContacts['length']){const _0x213cd8=smsContacts[_0x4f25ac(0xcbf)]-_0x487c79[_0x4f25ac(0xcbf)];console[_0x4f25ac(0xc0d)]('🔧\x20清理了\x20'+_0x213cd8+_0x4f25ac(0x2d5)),smsContacts=_0x487c79,await saveSMSContacts();}}}catch(_0x2515b8){console[_0x4f25ac(0x24ab)]('加载短信联系人失败:',_0x2515b8),smsContacts=[];}}async function saveSMSContacts(){const _0x21bf07=_0x2cf6d4;try{const _0x4b67e3=smsContacts[_0x21bf07(0x803)](_0x500b13=>_0x500b13),_0x4aff50=_0x4b67e3['map'](_0x597c46=>({'characterId':_0x597c46,'createdAt':Date[_0x21bf07(0x18e0)]()}));await db[_0x21bf07(0x174a)]('rw',db[_0x21bf07(0x111c)],async()=>{const _0x367b39=_0x21bf07;await db['smsContacts']['clear'](),_0x4aff50['length']>0x0&&await db[_0x367b39(0x111c)][_0x367b39(0x24c8)](_0x4aff50);}),console[_0x21bf07(0xc0d)](_0x21bf07(0x150c)+_0x4b67e3['length']+_0x21bf07(0x1699));}catch(_0x41202d){console[_0x21bf07(0x24ab)]('保存短信联系人失败:',_0x41202d);}}async function loadSMSMessages(){const _0x3b167f=_0x2cf6d4;try{console[_0x3b167f(0xc0d)](_0x3b167f(0x15f6));const _0xaea325=await db[_0x3b167f(0xd94)][_0x3b167f(0x18c6)]();smsMessages={},_0xaea325[_0x3b167f(0x900)](_0x288f5d=>{const _0x4a25f0=_0x3b167f;!smsMessages[_0x288f5d['characterId']]&&(smsMessages[_0x288f5d[_0x4a25f0(0x10df)]]=[]);let _0x3e3361=[];_0x288f5d['isImage']&&_0x288f5d[_0x4a25f0(0xd59)]?_0x3e3361=[{'type':_0x4a25f0(0x1e58),'text':_0x288f5d[_0x4a25f0(0x1423)]||''},{'type':'image_url','image_url':{'url':_0x288f5d[_0x4a25f0(0xd59)]}}]:_0x3e3361=[{'type':_0x4a25f0(0x1e58),'text':_0x288f5d['content']||''}];const _0x630de2={'id':_0x288f5d['id'],'content':_0x3e3361,'text':_0x288f5d[_0x4a25f0(0x1423)],'timestamp':_0x288f5d[_0x4a25f0(0x7aa)],'isUser':_0x288f5d[_0x4a25f0(0xc7)],'isImage':_0x288f5d[_0x4a25f0(0xfd1)]||![],'imageUrl':_0x288f5d['imageUrl']||null,'fileName':_0x288f5d['fileName']||null};smsMessages[_0x288f5d[_0x4a25f0(0x10df)]][_0x4a25f0(0x6ee)](_0x630de2);}),Object[_0x3b167f(0x16c7)](smsMessages)['forEach'](_0x51583c=>{const _0x4a3ed8=_0x3b167f;smsMessages[_0x51583c]['sort']((_0x71de5d,_0x8c3ec3)=>_0x71de5d[_0x4a3ed8(0x7aa)]-_0x8c3ec3[_0x4a3ed8(0x7aa)]);});const _0x1218f5=_0xaea325[_0x3b167f(0x803)](_0x1761aa=>_0x1761aa[_0x3b167f(0xfd1)])['length'];console[_0x3b167f(0xc0d)](_0x3b167f(0x2068)+_0xaea325[_0x3b167f(0xcbf)]+'\x20条短信消息'+(_0x1218f5>0x0?_0x3b167f(0xa5c)+_0x1218f5+'\x20张图片）':''));}catch(_0x54eb0a){console['error'](_0x3b167f(0xde9),_0x54eb0a),smsMessages={};}}async function saveSingleSMSMessage(_0x44a6e1,_0x5b2e41){const _0x2baced=_0x2cf6d4;try{let _0x2e2575='';if(Array[_0x2baced(0x1bcc)](_0x5b2e41[_0x2baced(0x1423)])){const _0x10f3b4=_0x5b2e41[_0x2baced(0x1423)][_0x2baced(0x1aeb)](_0xd4fe2d=>_0xd4fe2d['type']===_0x2baced(0x1e58));_0x2e2575=_0x10f3b4?_0x10f3b4[_0x2baced(0x1e58)]:'';}else _0x5b2e41[_0x2baced(0x1e58)]?_0x2e2575=_0x5b2e41[_0x2baced(0x1e58)]:_0x2e2575='';const _0x456fc2={'id':_0x5b2e41['id'],'characterId':_0x44a6e1,'timestamp':_0x5b2e41[_0x2baced(0x7aa)],'content':_0x2e2575,'isUser':_0x5b2e41[_0x2baced(0xc7)],'isImage':_0x5b2e41[_0x2baced(0xfd1)]||![],'imageUrl':_0x5b2e41[_0x2baced(0xd59)]||null,'fileName':_0x5b2e41[_0x2baced(0x2335)]||null};await db[_0x2baced(0xd94)][_0x2baced(0xe1)](_0x456fc2),console[_0x2baced(0xc0d)](_0x2baced(0x2288)+_0x44a6e1+'\x20的单条短信消息'+(_0x5b2e41[_0x2baced(0xfd1)]?'（包含图片）':''));}catch(_0x2bd562){console[_0x2baced(0x24ab)](_0x2baced(0x1d05),_0x2bd562);throw _0x2bd562;}}async function saveSMSMessages(_0x45d55d){const _0x1230f6=_0x2cf6d4;try{if(!smsMessages[_0x45d55d])return;const _0x5ea18b=smsMessages[_0x45d55d][_0x1230f6(0xf6d)](_0x53b4eb=>{const _0x4d48c3=_0x1230f6;let _0x3ea60='';if(Array['isArray'](_0x53b4eb[_0x4d48c3(0x1423)])){const _0x2268b0=_0x53b4eb['content'][_0x4d48c3(0x1aeb)](_0x45cb64=>_0x45cb64[_0x4d48c3(0x23df)]===_0x4d48c3(0x1e58));_0x3ea60=_0x2268b0?_0x2268b0[_0x4d48c3(0x1e58)]:'';}else _0x53b4eb['text']?_0x3ea60=_0x53b4eb[_0x4d48c3(0x1e58)]:_0x3ea60='';return{'id':_0x53b4eb['id'],'characterId':_0x45d55d,'timestamp':_0x53b4eb['timestamp'],'content':_0x3ea60,'isUser':_0x53b4eb[_0x4d48c3(0xc7)],'isImage':_0x53b4eb[_0x4d48c3(0xfd1)]||![],'imageUrl':_0x53b4eb[_0x4d48c3(0xd59)]||null,'fileName':_0x53b4eb[_0x4d48c3(0x2335)]||null};});await db[_0x1230f6(0x174a)]('rw',db[_0x1230f6(0xd94)],async()=>{const _0x1db677=_0x1230f6;await db[_0x1db677(0xd94)][_0x1db677(0x4a6)](_0x1db677(0x10df))[_0x1db677(0x14a)](_0x45d55d)[_0x1db677(0xc2b)](),_0x5ea18b[_0x1db677(0xcbf)]>0x0&&await db[_0x1db677(0xd94)][_0x1db677(0x24c8)](_0x5ea18b);});const _0x511715=_0x5ea18b[_0x1230f6(0x803)](_0x44f331=>_0x44f331[_0x1230f6(0xfd1)])[_0x1230f6(0xcbf)];console[_0x1230f6(0xc0d)](_0x1230f6(0x305)+_0x45d55d+_0x1230f6(0x114b)+_0x5ea18b[_0x1230f6(0xcbf)]+_0x1230f6(0x568)+(_0x511715>0x0?'（包含\x20'+_0x511715+_0x1230f6(0x13cb):''));}catch(_0x58f742){console[_0x1230f6(0x24ab)](_0x1230f6(0x1f9d),_0x58f742);}}async function loadChatMessages(){const _0x27ba60=_0x2cf6d4;try{const _0xef8b1c=await db['chatMessages']['toArray']();chatMessages={};if(_0xef8b1c['length']===0x0){const _0x16876a=localStorage[_0x27ba60(0x2250)](_0x27ba60(0x464));if(_0x16876a){const _0x1da8c6=JSON[_0x27ba60(0x168e)](_0x16876a),_0x6b75d3=[];for(const [_0x8b7329,_0x3d3753]of Object['entries'](_0x1da8c6)){for(const _0x11e13c of _0x3d3753){_0x6b75d3['push']({'id':_0x8b7329+'_'+(_0x11e13c['id']||_0x11e13c[_0x27ba60(0x7aa)]),'characterId':_0x8b7329,'timestamp':_0x11e13c[_0x27ba60(0x7aa)],'messageData':_0x11e13c});}}_0x6b75d3['length']>0x0&&await db['chatMessages'][_0x27ba60(0x24c8)](_0x6b75d3),chatMessages=_0x1da8c6;}}else{for(const _0x25f416 of _0xef8b1c){const _0x8ec421=_0x25f416[_0x27ba60(0x10df)];!chatMessages[_0x8ec421]&&(chatMessages[_0x8ec421]=[]);if(_0x25f416[_0x27ba60(0x1110)]&&typeof _0x25f416[_0x27ba60(0x1110)]==='object'){const _0x359350={..._0x25f416['messageData']};_0x25f416['originalMessageId']&&!_0x359350['id']&&(_0x359350['id']=_0x25f416[_0x27ba60(0xc48)]),chatMessages[_0x8ec421][_0x27ba60(0x6ee)](_0x359350);}}for(const _0x451ace in chatMessages){console[_0x27ba60(0xc0d)]('🔧\x20[去重修复]\x20处理角色\x20'+_0x451ace+':\x20'+chatMessages[_0x451ace][_0x27ba60(0xcbf)]+_0x27ba60(0x2543));const _0x65cb03=[],_0x5aba24=new Set(),_0x545941=new Set();chatMessages[_0x451ace]['filter'](_0x3e224c=>{const _0x44c027=_0x27ba60;if(!_0x3e224c||typeof _0x3e224c!==_0x44c027(0x3c4)||!_0x3e224c['timestamp'])return![];return!![];})['sort']((_0xc4a1b9,_0x5c83e1)=>_0xc4a1b9[_0x27ba60(0x7aa)]-_0x5c83e1['timestamp'])[_0x27ba60(0x900)](_0x2f8466=>{const _0x13eca1=_0x27ba60;if(_0x2f8466['id']&&_0x5aba24[_0x13eca1(0x1af1)](_0x2f8466['id']))return;const _0xc00baa=(_0x2f8466[_0x13eca1(0x1423)]||'')+'_'+_0x2f8466['timestamp']+'_'+(_0x2f8466[_0x13eca1(0xf75)]||'')+'_'+(_0x2f8466[_0x13eca1(0x106c)]||'')+'_'+(_0x2f8466[_0x13eca1(0x14ad)]||'');if(_0x545941[_0x13eca1(0x1af1)](_0xc00baa))return;if(_0x2f8466['id'])_0x5aba24[_0x13eca1(0xe1)](_0x2f8466['id']);_0x545941[_0x13eca1(0xe1)](_0xc00baa),_0x65cb03[_0x13eca1(0x6ee)](_0x2f8466);}),chatMessages[_0x451ace]=_0x65cb03,console['log'](_0x27ba60(0x9ce)+_0x451ace+':\x20'+_0x65cb03['length']+_0x27ba60(0xbfa)+(_0xef8b1c[_0x27ba60(0x803)](_0x327d53=>_0x327d53[_0x27ba60(0x10df)]===_0x451ace)[_0x27ba60(0xcbf)]-_0x65cb03[_0x27ba60(0xcbf)])+_0x27ba60(0x18c5));}await cleanupBlockedSystemMessages();}lastSavedMessageHashes={};for(const [_0x39f28a,_0x3c9635]of Object[_0x27ba60(0x230e)](chatMessages)){lastSavedMessageHashes[_0x39f28a]=generateMessagesHash(_0x3c9635);}console['log'](_0x27ba60(0x8a0),Object[_0x27ba60(0x16c7)](lastSavedMessageHashes));}catch(_0x16a2f5){console[_0x27ba60(0x24ab)]('加载聊天消息失败:',_0x16a2f5);const _0x4d1b60=localStorage[_0x27ba60(0x2250)](_0x27ba60(0x464));_0x4d1b60?chatMessages=JSON[_0x27ba60(0x168e)](_0x4d1b60):chatMessages={};}}async function cleanupBlockedSystemMessages(){const _0xc3643b=_0x2cf6d4;try{const _0x205210=await db[_0xc3643b(0x464)][_0xc3643b(0x18c6)](),_0x4ab5b9=[],_0x33fe26={};for(const _0x154ce6 of _0x205210){if(_0x154ce6[_0xc3643b(0x1110)]&&_0x154ce6[_0xc3643b(0x1110)][_0xc3643b(0xf75)]===_0xc3643b(0x212)&&_0x154ce6['messageData'][_0xc3643b(0x245d)]){const _0x5c4156=_0x154ce6[_0xc3643b(0x10df)];!_0x33fe26[_0x5c4156]&&(_0x33fe26[_0x5c4156]=[]),_0x33fe26[_0x5c4156][_0xc3643b(0x6ee)](_0x154ce6);}}for(const _0x3720e1 in _0x33fe26){const _0x12baeb=_0x33fe26[_0x3720e1];if(_0x12baeb[_0xc3643b(0xcbf)]>0x1){_0x12baeb[_0xc3643b(0x1f0d)]((_0x3e8c39,_0xcefff0)=>(_0xcefff0['messageData'][_0xc3643b(0x7aa)]||0x0)-(_0x3e8c39[_0xc3643b(0x1110)][_0xc3643b(0x7aa)]||0x0));const _0x3b4eb8=_0x12baeb['slice'](0x1);_0x4ab5b9[_0xc3643b(0x6ee)](..._0x3b4eb8['map'](_0x38efd7=>_0x38efd7['id']));}}_0x4ab5b9[_0xc3643b(0xcbf)]>0x0&&(await db[_0xc3643b(0x464)][_0xc3643b(0xf71)](_0x4ab5b9),console[_0xc3643b(0xc0d)]('已清理\x20'+_0x4ab5b9[_0xc3643b(0xcbf)]+_0xc3643b(0x307)));}catch(_0x252d06){console[_0xc3643b(0x24ab)](_0xc3643b(0x227a),_0x252d06);}}let saveMessagesTimer=null,isSaving=![],saveQueue=[],lastSavedMessageHashes={},nextSequentialId=0x0;function generateMessagesHash(_0x528792){const _0x3813a5=_0x2cf6d4;if(!_0x528792||_0x528792[_0x3813a5(0xcbf)]===0x0)return'';const _0x3a46fe=_0x528792['map'](_0x1258f3=>(_0x1258f3['id']||'')+':'+(_0x1258f3['content']||'')+':'+(_0x1258f3[_0x3813a5(0x23df)]||'')+':'+(_0x1258f3['sender']||'')+':'+(_0x1258f3[_0x3813a5(0x106c)]||'')+':'+(_0x1258f3['isOfflineMode']||''))[_0x3813a5(0x140c)]('|');let _0x4547e1=0x0;for(let _0x2a342d=0x0;_0x2a342d<_0x3a46fe[_0x3813a5(0xcbf)];_0x2a342d++){const _0x1941ce=_0x3a46fe[_0x3813a5(0x1270)](_0x2a342d);_0x4547e1=(_0x4547e1<<0x5)-_0x4547e1+_0x1941ce,_0x4547e1=_0x4547e1&_0x4547e1;}return _0x4547e1[_0x3813a5(0x9a3)]();}function saveChatMessages(_0x3c3fa5=null){const _0x2f7852=_0x2cf6d4,_0x37f87b={'timestamp':Date['now'](),'id':Math['random']()[_0x2f7852(0x9a3)](0x24)[_0x2f7852(0x18cf)](0x2,0x9),'forceResyncFor':_0x3c3fa5};saveQueue[_0x2f7852(0x6ee)](_0x37f87b),saveMessagesTimer&&clearTimeout(saveMessagesTimer),saveMessagesTimer=setTimeout(async()=>{const _0x4adb32=_0x2f7852;if(isSaving){setTimeout(()=>saveChatMessages(),0x64);return;}const _0x1f2dee=new Set();saveQueue[_0x4adb32(0x900)](_0x53d650=>{const _0x28beda=_0x4adb32;_0x53d650[_0x28beda(0x208b)]&&_0x1f2dee[_0x28beda(0xe1)](_0x53d650[_0x28beda(0x208b)]);});const _0x2ca801=[...saveQueue];saveQueue=[],_0x2ca801[_0x4adb32(0xcbf)]>0x0&&(console[_0x4adb32(0xc0d)](_0x4adb32(0x1daf)+_0x2ca801[_0x4adb32(0xcbf)]+'\x20个请求'),await saveChatMessagesImmediate(Array[_0x4adb32(0x2308)](_0x1f2dee),!![]));},0x1f4);}async function saveChatMessagesImmediate(_0x8a9fef=[],_0x38f550=![]){const _0x584b2d=_0x2cf6d4;if(isSaving)return;isSaving=!![];try{if(!_0x38f550){const _0x51da8b=await checkStorageUsage();_0x51da8b&&_0x51da8b[_0x584b2d(0x19c8)]&&(console['warn']('⚠️\x20存储空间不足，尝试清理数据...'),await performSmartDataCleanup());}else console[_0x584b2d(0xc0d)](_0x584b2d(0x1356));const _0x4cc535=[],_0x4aa309=new Set(_0x8a9fef);if(nextSequentialId===0x0){const _0x2dcf7f=await db[_0x584b2d(0x464)][_0x584b2d(0x18c6)]();nextSequentialId=_0x2dcf7f[_0x584b2d(0xcbf)];}for(const [_0xdbe4c1,_0x56634c]of Object['entries'](chatMessages)){const _0x39803c=generateMessagesHash(_0x56634c),_0x42c125=lastSavedMessageHashes[_0xdbe4c1]||'';if(_0x4aa309[_0x584b2d(0x1af1)](_0xdbe4c1)){console[_0x584b2d(0xc0d)](_0x584b2d(0xa46)+_0xdbe4c1+_0x584b2d(0x1f1)),_0x4aa309[_0x584b2d(0xe1)](_0xdbe4c1);for(let _0x280beb=0x0;_0x280beb<_0x56634c['length'];_0x280beb++){const _0x447a98=_0x56634c[_0x280beb],_0x393507=_0xdbe4c1+'_sync_'+(_0x447a98[_0x584b2d(0x7aa)]||Date[_0x584b2d(0x18e0)]())+'_'+_0x280beb+'_'+Math[_0x584b2d(0x191c)]()['toString'](0x24)['substr'](0x2,0x6);_0x4cc535[_0x584b2d(0x6ee)]({'id':_0x393507,'characterId':_0xdbe4c1,'timestamp':_0x447a98[_0x584b2d(0x7aa)],'messageOrder':_0x280beb,'originalMessageId':_0x447a98['id'],'messageData':_0x447a98});}lastSavedMessageHashes[_0xdbe4c1]=_0x39803c;continue;}if(_0x39803c!==_0x42c125){console[_0x584b2d(0xc0d)](_0x584b2d(0x197f)+_0xdbe4c1+_0x584b2d(0x6dd)),_0x4aa309[_0x584b2d(0xe1)](_0xdbe4c1);for(let _0x277885=0x0;_0x277885<_0x56634c[_0x584b2d(0xcbf)];_0x277885++){const _0x25019c=_0x56634c[_0x277885],_0x529388=_0xdbe4c1+_0x584b2d(0x161d)+(_0x25019c[_0x584b2d(0x7aa)]||Date[_0x584b2d(0x18e0)]())+'_'+_0x277885+'_'+Math[_0x584b2d(0x191c)]()['toString'](0x24)['substr'](0x2,0x6);_0x4cc535[_0x584b2d(0x6ee)]({'id':_0x529388,'characterId':_0xdbe4c1,'timestamp':_0x25019c['timestamp'],'messageOrder':_0x277885,'originalMessageId':_0x25019c['id'],'messageData':_0x25019c});}lastSavedMessageHashes[_0xdbe4c1]=_0x39803c;}}const _0x51c7e0=Array[_0x584b2d(0x2308)](_0x4aa309);if(_0x51c7e0['length']===0x0&&_0x4cc535[_0x584b2d(0xcbf)]===0x0){console[_0x584b2d(0xc0d)]('📝\x20没有消息变化需要保存'),isSaving=![];return;}let _0x18f74d=0x0;const _0x2a2450=0x3;while(_0x18f74d<_0x2a2450){try{await db[_0x584b2d(0x174a)]('rw',db[_0x584b2d(0x464)],async()=>{const _0x47cef6=_0x584b2d;if(_0x51c7e0[_0x47cef6(0xcbf)]>0x0)for(const _0x28387e of _0x51c7e0){const _0x528a45=await db['chatMessages']['where'](_0x47cef6(0x10df))[_0x47cef6(0x14a)](_0x28387e)['delete']();console[_0x47cef6(0xc0d)](_0x47cef6(0x1bdc)+_0x28387e+_0x47cef6(0x114b)+_0x528a45+_0x47cef6(0x2117));}_0x4cc535[_0x47cef6(0xcbf)]>0x0&&(await db[_0x47cef6(0x464)][_0x47cef6(0x24c8)](_0x4cc535),console[_0x47cef6(0xc0d)](_0x47cef6(0x1b49)+_0x4cc535[_0x47cef6(0xcbf)]+_0x47cef6(0x564)));});break;}catch(_0xd7814e){_0x18f74d++,console['warn'](_0x584b2d(0x1d6d)+_0x18f74d+'/'+_0x2a2450+':',_0xd7814e);if(_0x18f74d>=_0x2a2450)throw _0xd7814e;await new Promise(_0x218d65=>setTimeout(_0x218d65,0x64*_0x18f74d));}}console[_0x584b2d(0xc0d)](_0x584b2d(0x9bc)+_0x51c7e0[_0x584b2d(0xcbf)]+_0x584b2d(0x1e91)+_0x4cc535[_0x584b2d(0xcbf)]+_0x584b2d(0x16d2));}catch(_0x29d29e){console[_0x584b2d(0x24ab)](_0x584b2d(0x2484),_0x29d29e);}finally{isSaving=![];}}async function loadChatSettings(){const _0x315f6a=_0x2cf6d4;try{const _0x6aa1ec=await db[_0x315f6a(0xb08)]['toArray'](),_0x5c4e96=await db[_0x315f6a(0x243d)][_0x315f6a(0x18c6)]();if(_0x6aa1ec[_0x315f6a(0xcbf)]>0x0||_0x5c4e96[_0x315f6a(0xcbf)]>0x0){console[_0x315f6a(0xc0d)](_0x315f6a(0x663)+_0x6aa1ec['length']+_0x315f6a(0x1339)+_0x5c4e96[_0x315f6a(0xcbf)]+_0x315f6a(0x865)),chatSettings={},_0x6aa1ec[_0x315f6a(0x900)](_0x1bb1f5=>{chatSettings[_0x1bb1f5['chatId']]=_0x1bb1f5['settings'];}),_0x5c4e96[_0x315f6a(0x900)](_0x5b0d73=>{const _0x4527b9=_0x315f6a,_0x2ba009=_0x5b0d73[_0x4527b9(0x956)]+'_'+_0x5b0d73[_0x4527b9(0x30e)];chatSettings[_0x2ba009]=_0x5b0d73[_0x4527b9(0x1fbb)];});return;}console[_0x315f6a(0xc0d)](_0x315f6a(0x1eef));const _0x1a4726=localStorage[_0x315f6a(0x2250)](_0x315f6a(0xb08));if(_0x1a4726){const _0x31bb20=JSON[_0x315f6a(0x168e)](_0x1a4726);await migrateChatSettingsToIndexedDB(_0x31bb20);return;}const _0x13c85e={};let _0x1555cc=![];for(let _0x393bc5=0x0;_0x393bc5<localStorage['length'];_0x393bc5++){const _0x345937=localStorage[_0x315f6a(0x157f)](_0x393bc5);if(_0x345937&&_0x345937[_0x315f6a(0x1cab)]('chatSettings_')&&!_0x345937['includes'](_0x315f6a(0xbd1)))try{const _0x42d846=_0x345937[_0x315f6a(0x882)]('chatSettings_',''),_0x204464=localStorage[_0x315f6a(0x2250)](_0x345937);_0x204464&&(_0x13c85e[_0x42d846]=JSON[_0x315f6a(0x168e)](_0x204464),_0x1555cc=!![]);}catch(_0x3c6e13){console[_0x315f6a(0x17cc)](_0x315f6a(0x1dd0)+_0x345937,_0x3c6e13);}}if(_0x1555cc){console[_0x315f6a(0xc0d)](_0x315f6a(0x491)),await migrateChatSettingsToIndexedDB(_0x13c85e);return;}chatSettings={},console[_0x315f6a(0xc0d)](_0x315f6a(0xea9));}catch(_0x35bb70){console[_0x315f6a(0x24ab)](_0x315f6a(0x6eb),_0x35bb70);try{const _0x3009d1=localStorage[_0x315f6a(0x2250)](_0x315f6a(0xc96));if(_0x3009d1){chatSettings=JSON[_0x315f6a(0x168e)](_0x3009d1),console[_0x315f6a(0xc0d)](_0x315f6a(0x16fa)),showToast(_0x315f6a(0x1f9e),_0x315f6a(0x13bb));return;}}catch(_0x32bc43){console[_0x315f6a(0x24ab)](_0x315f6a(0xc37),_0x32bc43);}chatSettings={},showToast(_0x315f6a(0x15d0),_0x315f6a(0x24ab));}}async function migrateChatSettingsToIndexedDB(_0x1e1ed3){const _0x567692=_0x2cf6d4;try{const _0x3cfc20=Object[_0x567692(0x16c7)](_0x1e1ed3)[_0x567692(0xf6d)](_0x3d5f06=>({'id':_0x3d5f06,'chatId':_0x3d5f06,'settings':_0x1e1ed3[_0x3d5f06]}));_0x3cfc20[_0x567692(0xcbf)]>0x0&&(await db['chatSettings']['bulkPut'](_0x3cfc20),console['log'](_0x567692(0x694)+_0x3cfc20[_0x567692(0xcbf)]+_0x567692(0x1804)),chatSettings=_0x1e1ed3);}catch(_0x5bf917){console[_0x567692(0x24ab)](_0x567692(0x1631),_0x5bf917),chatSettings=_0x1e1ed3;}}let autoSaveTimer=null,pendingSettingsChanges=new Set(),saveRetryCount=0x0;const MAX_SAVE_RETRIES=0x3;function scheduleAutoSave(_0x3a5f3e){const _0x19b8ba=_0x2cf6d4;_0x3a5f3e&&pendingSettingsChanges[_0x19b8ba(0xe1)](_0x3a5f3e),autoSaveTimer&&clearTimeout(autoSaveTimer),autoSaveTimer=setTimeout(async()=>{const _0x23f04a=_0x19b8ba;if(pendingSettingsChanges[_0x23f04a(0x41a)]>0x0)try{await saveChatSettings(),pendingSettingsChanges[_0x23f04a(0x2215)](),saveRetryCount=0x0;}catch(_0x55f06b){console['error'](_0x23f04a(0x8f2),_0x55f06b),saveRetryCount++,saveRetryCount<MAX_SAVE_RETRIES?(console[_0x23f04a(0xc0d)](_0x23f04a(0x13b8)+saveRetryCount*0x2+'\x20秒后重试保存...'),setTimeout(()=>{scheduleAutoSave();},saveRetryCount*0x7d0)):(console[_0x23f04a(0x24ab)](_0x23f04a(0x368)),saveRetryCount=0x0);}autoSaveTimer=null;},0x7d0);}window[_0x2cf6d4(0x167)](_0x2cf6d4(0x77d),async _0x1c27cb=>{const _0x460c06=_0x2cf6d4;if(pendingSettingsChanges[_0x460c06(0x41a)]>0x0){console[_0x460c06(0xc0d)]('🔄\x20页面卸载前强制保存设置...');try{await saveChatSettings(),console[_0x460c06(0xc0d)](_0x460c06(0x1d4d));}catch(_0x667cf5){console[_0x460c06(0x24ab)]('🚨\x20页面卸载前保存失败:',_0x667cf5);}}}),document[_0x2cf6d4(0x167)](_0x2cf6d4(0x346),async()=>{const _0x6dbcf9=_0x2cf6d4;if(document[_0x6dbcf9(0x1a2c)]&&pendingSettingsChanges[_0x6dbcf9(0x41a)]>0x0){console[_0x6dbcf9(0xc0d)](_0x6dbcf9(0x2238));try{await saveChatSettings(),console['log'](_0x6dbcf9(0x16d5)),pendingSettingsChanges[_0x6dbcf9(0x2215)]();}catch(_0xf96622){console[_0x6dbcf9(0x24ab)](_0x6dbcf9(0xaf5),_0xf96622);}}});async function debugChatMessagesFormat(){const _0x43c642=_0x2cf6d4;try{const _0x5a9237=await db[_0x43c642(0x464)][_0x43c642(0x18c6)]();console[_0x43c642(0xc0d)](_0x43c642(0x1d17)),console[_0x43c642(0xc0d)]('总数:\x20'+_0x5a9237[_0x43c642(0xcbf)]+'\x20条');if(_0x5a9237['length']>0x0){const _0x54e7e8=_0x5a9237[0x0];console['log'](_0x43c642(0x96c),Object[_0x43c642(0x16c7)](_0x54e7e8)),console[_0x43c642(0xc0d)](_0x43c642(0x1ad5),_0x54e7e8);const _0x446fd0=_0x5a9237[_0x43c642(0x184b)](_0x2e4973=>_0x2e4973[_0x43c642(0x1110)]),_0x5606d2=_0x5a9237[_0x43c642(0x184b)](_0xbaa9d9=>_0xbaa9d9['content']);console[_0x43c642(0xc0d)](_0x43c642(0x1abb)+_0x446fd0),console[_0x43c642(0xc0d)](_0x43c642(0xa08)+_0x5606d2);}console['log'](_0x43c642(0x133d));const _0x102345=Object[_0x43c642(0x1efb)](chatMessages)['reduce']((_0x12044b,_0x306f40)=>_0x12044b+_0x306f40[_0x43c642(0xcbf)],0x0);console['log']('总数:\x20'+_0x102345+'\x20条');if(_0x102345>0x0){const _0x12db4a=Object['keys'](chatMessages)[0x0],_0x521617=chatMessages[_0x12db4a]?.[0x0];_0x521617&&(console['log'](_0x43c642(0x7e3),Object[_0x43c642(0x16c7)](_0x521617)),console['log'](_0x43c642(0xc20),_0x521617));}showToast(_0x43c642(0x1b3b),'info');}catch(_0xfa3d29){console[_0x43c642(0x24ab)]('调试聊天记录格式失败:',_0xfa3d29),showToast(_0x43c642(0x2009)+_0xfa3d29['message'],_0x43c642(0x24ab));}}async function cleanupOldChatSettingsFromLocalStorage(){const _0x2ced6d=_0x2cf6d4;try{let _0x5dd1cc=0x0;const _0x59e216=[];for(let _0x305c46=0x0;_0x305c46<localStorage[_0x2ced6d(0xcbf)];_0x305c46++){const _0x5d1e51=localStorage[_0x2ced6d(0x157f)](_0x305c46);_0x5d1e51&&(_0x5d1e51===_0x2ced6d(0xb08)||_0x5d1e51[_0x2ced6d(0x1cab)](_0x2ced6d(0xc63)))&&!_0x5d1e51[_0x2ced6d(0x23ec)](_0x2ced6d(0xbd1))&&_0x59e216[_0x2ced6d(0x6ee)](_0x5d1e51);}const _0x17dff8=await db[_0x2ced6d(0xb08)][_0x2ced6d(0x18c6)]();if(_0x17dff8[_0x2ced6d(0xcbf)]>0x0&&_0x59e216['length']>0x0){const _0x331cf3=confirm(_0x2ced6d(0x18f7)+_0x59e216[_0x2ced6d(0xcbf)]+_0x2ced6d(0x88a)+(_0x2ced6d(0x1330)+_0x17dff8[_0x2ced6d(0xcbf)]+_0x2ced6d(0xd44))+_0x2ced6d(0x117e));_0x331cf3&&(_0x59e216[_0x2ced6d(0x900)](_0x1446ce=>{const _0x21a073=_0x2ced6d;localStorage[_0x21a073(0x1c95)](_0x1446ce),_0x5dd1cc++;}),console[_0x2ced6d(0xc0d)](_0x2ced6d(0x505)+_0x5dd1cc+_0x2ced6d(0xb7c)),showToast(_0x2ced6d(0x1be9)+_0x5dd1cc+_0x2ced6d(0x258),_0x2ced6d(0xb27)));}}catch(_0xbc68f9){console[_0x2ced6d(0x24ab)](_0x2ced6d(0x17ce),_0xbc68f9);}}async function saveChatSettings(){const _0x5c6abb=_0x2cf6d4;try{const _0x3fcdef=Object[_0x5c6abb(0x16c7)](chatSettings)[_0x5c6abb(0xf6d)](_0x1b2dad=>({'id':_0x1b2dad,'chatId':_0x1b2dad,'settings':chatSettings[_0x1b2dad]}));if(_0x3fcdef[_0x5c6abb(0xcbf)]===0x0){console[_0x5c6abb(0x17cc)](_0x5c6abb(0x2311));return;}await db[_0x5c6abb(0xb08)][_0x5c6abb(0x4c5)](_0x3fcdef),console['log'](_0x5c6abb(0x1453)+_0x3fcdef[_0x5c6abb(0xcbf)]+'\x20个聊天设置到IndexedDB');}catch(_0x5bb225){console[_0x5c6abb(0x24ab)](_0x5c6abb(0x1f54),_0x5bb225);try{console['warn'](_0x5c6abb(0x13ad));const _0x3be4de={};Object['keys'](chatSettings)[_0x5c6abb(0x900)](_0x2b8bf6=>{const _0x239d74=_0x5c6abb;_0x3be4de[_0x2b8bf6]={'bubbleStyle':chatSettings[_0x2b8bf6][_0x239d74(0xa7e)],'aiChatAvatar':chatSettings[_0x2b8bf6][_0x239d74(0x23e0)],'myChatAvatar':chatSettings[_0x2b8bf6][_0x239d74(0x13af)],'aiChatNickname':chatSettings[_0x2b8bf6][_0x239d74(0x1967)],'myChatNickname':chatSettings[_0x2b8bf6][_0x239d74(0xb42)],'hideAvatars':chatSettings[_0x2b8bf6][_0x239d74(0x1e22)],'selectedIdentityId':chatSettings[_0x2b8bf6][_0x239d74(0x6a0)],'timestampEnabled':chatSettings[_0x2b8bf6][_0x239d74(0x9c1)],'timestampPosition':chatSettings[_0x2b8bf6][_0x239d74(0x19ec)]};}),localStorage[_0x5c6abb(0x2055)](_0x5c6abb(0xc96),JSON[_0x5c6abb(0x7fb)](_0x3be4de)),console[_0x5c6abb(0xc0d)](_0x5c6abb(0x16e1)),showToast(_0x5c6abb(0x1861),_0x5c6abb(0x13bb));}catch(_0x56833a){console[_0x5c6abb(0x24ab)](_0x5c6abb(0xa85),_0x56833a),showToast(_0x5c6abb(0x5d0),'error');throw _0x56833a;}}}let backgroundTimers={};async function initGlobalBackgroundInteractionSystem(){const _0x41bc1c=_0x2cf6d4;console['log'](_0x41bc1c(0x201c));for(const _0x238941 of characters){try{const _0x36a7b8=await getChatSettings(_0x238941['id']),_0x5845bd=_0x36a7b8[_0x41bc1c(0x961)]===!![],_0x26a880=_0x36a7b8[_0x41bc1c(0x1bb5)]===!![],_0x243240=_0x36a7b8['backgroundMomentsEnabled']===!![];if(!_0x5845bd){console[_0x41bc1c(0xc0d)]('角色\x20'+_0x238941['name']+'\x20的后台互动已禁用，跳过');continue;}console[_0x41bc1c(0xc0d)](_0x41bc1c(0x1d55)+_0x238941[_0x41bc1c(0x222f)]+_0x41bc1c(0x2107));if(_0x5845bd&&_0x26a880){const _0x25f29c=chatMessages[_0x238941['id']]||[],_0x4ebdfb=_0x25f29c[_0x41bc1c(0x184b)](_0x22dacd=>_0x22dacd[_0x41bc1c(0xf75)]===_0x41bc1c(0xfda));_0x4ebdfb?(await scheduleProactiveChatForCharacter(_0x238941['id']),console['log'](_0x41bc1c(0x1569)+_0x238941[_0x41bc1c(0x222f)]+'\x20动态主动聊天定时器已设置')):console[_0x41bc1c(0xc0d)](_0x41bc1c(0x1f0e)+_0x238941[_0x41bc1c(0x222f)]+_0x41bc1c(0x6e0));}else console[_0x41bc1c(0xc0d)](_0x41bc1c(0x1d8e)+_0x238941['name']+_0x41bc1c(0x18b));if(_0x5845bd&&_0x243240){const _0x32a779=getBackgroundMomentsInterval(_0x36a7b8[_0x41bc1c(0x383)]||_0x41bc1c(0x222d));backgroundTimers[_0x238941['id']+_0x41bc1c(0x1f6e)]=setInterval(()=>{triggerBackgroundMoments(_0x238941['id']);},_0x32a779),console[_0x41bc1c(0xc0d)](_0x238941[_0x41bc1c(0x222f)]+_0x41bc1c(0x140f)+_0x32a779+'ms');}await initBackgroundDiarySystem(_0x238941['id']);}catch(_0x99b7e8){console[_0x41bc1c(0x24ab)](_0x41bc1c(0x1d55)+_0x238941[_0x41bc1c(0x222f)]+'\x20设置后台互动定时器失败:',_0x99b7e8);}}}async function initBackgroundInteractionSystem(){const _0x37ca56=_0x2cf6d4;console[_0x37ca56(0xc0d)](_0x37ca56(0x1721)),console[_0x37ca56(0xc0d)](_0x37ca56(0x1868));}function clearAllBackgroundTimers(){const _0xa731b6=_0x2cf6d4;Object['values'](backgroundTimers)[_0xa731b6(0x900)](_0x3220ca=>{if(_0x3220ca)clearInterval(_0x3220ca);}),backgroundTimers={},Object[_0xa731b6(0x1efb)](backgroundDiaryTimers)[_0xa731b6(0x900)](_0x1195fa=>{if(_0x1195fa)clearTimeout(_0x1195fa);}),backgroundDiaryTimers={};}let backgroundDiaryTimers={};async function saveDiaryTime(){const _0x4cf63c=_0x2cf6d4;if(!currentChatCharacter){showToast(_0x4cf63c(0x146),_0x4cf63c(0x24ab));return;}const _0x9c1130=document[_0x4cf63c(0x566)](_0x4cf63c(0x1a69)),_0x29fa1a=_0x9c1130[_0x4cf63c(0xc34)];if(!_0x29fa1a){showToast(_0x4cf63c(0x1636),_0x4cf63c(0x24ab));return;}const _0x6c671a=getCurrentChatSettings();_0x6c671a[_0x4cf63c(0x1f8a)]=_0x29fa1a,await saveCurrentChatSettings(_0x6c671a),currentChatCharacter&&(backgroundDiaryTimers[currentChatCharacter['id']]&&(clearTimeout(backgroundDiaryTimers[currentChatCharacter['id']]),delete backgroundDiaryTimers[currentChatCharacter['id']]),_0x6c671a[_0x4cf63c(0x961)]&&_0x6c671a['backgroundDiaryEnabled']&&(console[_0x4cf63c(0xc0d)]('⏰\x20重新为\x20'+currentChatCharacter['name']+_0x4cf63c(0x45f)+_0x29fa1a),scheduleBackgroundDiary(currentChatCharacter['id'],_0x29fa1a))),showToast(_0x4cf63c(0xdd5)+currentChatCharacter[_0x4cf63c(0x222f)]+_0x4cf63c(0xcea)+_0x29fa1a+'\x20写日记','success');}async function initBackgroundDiarySystem(_0x2ea662){const _0x27c0c7=_0x2cf6d4;backgroundDiaryTimers[_0x2ea662]&&(clearTimeout(backgroundDiaryTimers[_0x2ea662]),delete backgroundDiaryTimers[_0x2ea662]);const _0x410770=characters[_0x27c0c7(0x1aeb)](_0xd605e6=>_0xd605e6['id']===_0x2ea662);if(!_0x410770)return;if(_0x410770[_0x27c0c7(0x4b7)]){console[_0x27c0c7(0xc0d)]('🚫\x20群聊\x20'+_0x410770[_0x27c0c7(0x222f)]+'\x20不支持后台写日记功能');return;}const _0x469c28=await getChatSettings(_0x2ea662),_0x3381cb=_0x469c28[_0x27c0c7(0x961)]===!![],_0x3baf77=_0x469c28['backgroundDiaryEnabled']===!![],_0x5a6359=_0x469c28[_0x27c0c7(0x1f8a)];if(!_0x3381cb||!_0x3baf77||!_0x5a6359){console[_0x27c0c7(0xc0d)]('🚫\x20'+_0x410770[_0x27c0c7(0x222f)]+_0x27c0c7(0x1122));return;}console[_0x27c0c7(0xc0d)](_0x27c0c7(0x1a08)+_0x410770[_0x27c0c7(0x222f)]+'\x20设置后台写日记定时器，时间:\x20'+_0x5a6359),scheduleBackgroundDiary(_0x2ea662,_0x5a6359);}function scheduleBackgroundDiary(_0x26fbdb,_0x5c2812){const _0x1abecb=_0x2cf6d4,_0x14d59c=characters[_0x1abecb(0x1aeb)](_0x543ef8=>_0x543ef8['id']===_0x26fbdb);if(!_0x14d59c)return;const [_0x3cf65d,_0x461965]=_0x5c2812[_0x1abecb(0x633)](':')['map'](Number);console[_0x1abecb(0xc0d)]('⏰\x20[日记定时器]\x20解析时间:\x20'+_0x3cf65d+':'+_0x461965);const _0x7ae020=new Date(),_0xed60d9=new Date();_0xed60d9[_0x1abecb(0x482)](_0x3cf65d,_0x461965,0x0,0x0),console['log']('⏰\x20[日记定时器]\x20当前时间:\x20'+_0x7ae020[_0x1abecb(0x133a)]()),console[_0x1abecb(0xc0d)](_0x1abecb(0x74c)+_0xed60d9[_0x1abecb(0x133a)]());_0xed60d9<=_0x7ae020&&(_0xed60d9[_0x1abecb(0x1cd4)](_0xed60d9[_0x1abecb(0x1d02)]()+0x1),console[_0x1abecb(0xc0d)](_0x1abecb(0x24b8)+_0xed60d9[_0x1abecb(0x133a)]()));const _0x2c32a5=(Math[_0x1abecb(0x191c)]()-0.5)*0xa*0x3c*0x3e8;_0xed60d9[_0x1abecb(0x3ea)](_0xed60d9[_0x1abecb(0xa57)]()+_0x2c32a5);const _0x11fe4d=_0xed60d9[_0x1abecb(0xa57)]()-_0x7ae020[_0x1abecb(0xa57)]();console['log'](_0x1abecb(0x127e)+_0x14d59c['name']+_0x1abecb(0x2a5)+_0xed60d9[_0x1abecb(0x133a)]()+_0x1abecb(0x3cf)+Math[_0x1abecb(0x5f3)](_0x11fe4d/0xea60)+_0x1abecb(0x84e)),console['log'](_0x1abecb(0x6b6)+_0x11fe4d+'ms');if(_0x11fe4d<=0x0){console['warn'](_0x1abecb(0x2463)),setTimeout(async()=>{await triggerBackgroundDiary(_0x26fbdb);},0x3e8);return;}backgroundDiaryTimers[_0x26fbdb]=setTimeout(async()=>{const _0x3f1433=_0x1abecb;console[_0x3f1433(0xc0d)](_0x3f1433(0xe5)+_0x14d59c[_0x3f1433(0x222f)]+_0x3f1433(0x3a3)),await triggerBackgroundDiary(_0x26fbdb),scheduleBackgroundDiary(_0x26fbdb,_0x5c2812);},_0x11fe4d),console['log'](_0x1abecb(0x23cc)+_0x14d59c[_0x1abecb(0x222f)]+'\x20定时器已设置，ID:\x20'+backgroundDiaryTimers[_0x26fbdb]);}async function triggerBackgroundDiary(_0x1186b3){const _0x5739d=_0x2cf6d4,_0x2b0d9d=characters['find'](_0x20c7e8=>_0x20c7e8['id']===_0x1186b3);if(!_0x2b0d9d){console['error'](_0x5739d(0x626)+_0x1186b3);return;}console[_0x5739d(0xc0d)](_0x5739d(0x127e)+_0x2b0d9d[_0x5739d(0x222f)]+'\x20开始后台写日记...');try{const _0x314c7b=new Date()[_0x5739d(0xa4b)]()['split']('T')[0x0],_0x13ba3f=_0x1186b3+'_'+_0x314c7b;console['log'](_0x5739d(0x9fc)+_0x13ba3f);const _0x14314a=await db[_0x5739d(0x8e3)][_0x5739d(0x46a)](_0x13ba3f);if(_0x14314a&&_0x14314a[_0x5739d(0x1423)]){console[_0x5739d(0xc0d)](_0x5739d(0x127e)+_0x2b0d9d[_0x5739d(0x222f)]+_0x5739d(0x10a2));return;}console[_0x5739d(0xc0d)](_0x5739d(0x127e)+_0x2b0d9d['name']+_0x5739d(0x24c9));const _0x4f7ff3=await generateBackgroundDiary(_0x2b0d9d);console['log'](_0x5739d(0x127e)+_0x2b0d9d[_0x5739d(0x222f)]+'\x20日记内容生成结果:',_0x4f7ff3?'成功':'失败');if(_0x4f7ff3){const _0x28b663={'id':_0x13ba3f,'characterId':_0x1186b3,'date':_0x314c7b,'content':_0x4f7ff3,'timestamp':Date['now'](),'weather':getRandomWeather()};console[_0x5739d(0xc0d)]('📝\x20'+_0x2b0d9d[_0x5739d(0x222f)]+'\x20保存日记到数据库...',_0x28b663),await db[_0x5739d(0x8e3)]['put'](_0x28b663),console[_0x5739d(0xc0d)]('✅\x20'+_0x2b0d9d['name']+_0x5739d(0x1e64)+_0x4f7ff3['substring'](0x0,0x32)+_0x5739d(0x12da)),createDiaryNotification(_0x2b0d9d);}else console[_0x5739d(0x24ab)]('❌\x20'+_0x2b0d9d['name']+'\x20后台写日记失败：内容生成失败');}catch(_0x37a9cf){console['error']('❌\x20'+_0x2b0d9d['name']+_0x5739d(0x3bc),_0x37a9cf);}}async function generateBackgroundDiary(_0x5e46c5){const _0x4ccc24=_0x2cf6d4;try{console[_0x4ccc24(0xc0d)](_0x4ccc24(0x8f0)+_0x5e46c5[_0x4ccc24(0x222f)]+'\x20生成日记内容...');const _0x4e086d=chatMessages[_0x5e46c5['id']]||[],_0x113bc1=_0x4e086d[_0x4ccc24(0x136)](-0x14);console[_0x4ccc24(0xc0d)](_0x4ccc24(0x73a)+_0x113bc1[_0x4ccc24(0xcbf)]+_0x4ccc24(0x7b7));const _0x2201f5=new Date()[_0x4ccc24(0x177f)](_0x4ccc24(0x1c0b),{'year':'numeric','month':'long','day':_0x4ccc24(0xf4e),'weekday':_0x4ccc24(0x2040)}),_0x293e7c=getRandomWeather();let _0x38f897='';_0x113bc1[_0x4ccc24(0xcbf)]>0x0&&(_0x38f897=_0x4ccc24(0x2315)+_0x113bc1['map'](_0x228784=>{const _0x246163=_0x4ccc24,_0xfc5781=_0x228784['sender']==='sent'?'用户':_0x5e46c5[_0x246163(0x222f)];return _0xfc5781+':\x20'+(_0x228784[_0x246163(0x1e58)]||_0x228784[_0x246163(0x1423)]||_0x246163(0xf1a));})['join']('\x0a'));const _0x3e47d7='你是'+_0x5e46c5[_0x4ccc24(0x222f)]+'，你的人设如下：'+_0x5e46c5['bio']+_0x4ccc24(0x193b)+_0x2201f5+_0x4ccc24(0x1818)+_0x2201f5+_0x4ccc24(0x11ef)+_0x293e7c+_0x4ccc24(0x3ac)+_0x38f897+_0x4ccc24(0x9ab)+_0x5e46c5[_0x4ccc24(0x222f)]+_0x4ccc24(0x1bc2);console[_0x4ccc24(0xc0d)]('📝\x20[日记生成]\x20调用API生成日记，prompt长度:\x20'+_0x3e47d7[_0x4ccc24(0xcbf)]);const _0x1de4a4=await generateAIResponse(_0x3e47d7,_0x5e46c5);console[_0x4ccc24(0xc0d)](_0x4ccc24(0x119),_0x1de4a4?_0x4ccc24(0x1c9b)+_0x1de4a4[_0x4ccc24(0xcbf)]:_0x4ccc24(0xe25));if(_0x1de4a4&&_0x1de4a4[_0x4ccc24(0x1424)]()){let _0x27912d=_0x1de4a4['trim']();return _0x27912d=cleanDiaryContent(_0x27912d),console[_0x4ccc24(0xc0d)]('📝\x20[日记生成]\x20'+_0x5e46c5['name']+'\x20日记内容生成成功'),_0x27912d;}return console[_0x4ccc24(0x17cc)](_0x4ccc24(0xc95)+_0x5e46c5['name']+_0x4ccc24(0xb1e)),null;}catch(_0x3bac8c){return console[_0x4ccc24(0x24ab)](_0x4ccc24(0xc95)+_0x5e46c5[_0x4ccc24(0x222f)]+_0x4ccc24(0xd45),_0x3bac8c),null;}}function createDiaryNotification(_0x467c21){const _0x210847=_0x2cf6d4,_0x36621f=_0x210847(0xed6)+_0x467c21[_0x210847(0x222f)]+_0x210847(0x1fe),_0x4b9b25='[日记]\x20'+_0x36621f;createPushNotification(_0x467c21,_0x4b9b25,0x64);}function getRandomWeather(){const _0x504340=_0x2cf6d4,_0x7f79b1=['☀️','⛅','☁️',_0x504340(0x1b3c),'⛈️',_0x504340(0x1432),'🌤️',_0x504340(0x256)];return _0x7f79b1[Math[_0x504340(0x1dac)](Math[_0x504340(0x191c)]()*_0x7f79b1[_0x504340(0xcbf)])];}async function testBackgroundDiary(){const _0x52dbd0=_0x2cf6d4;if(!currentChatCharacter){showToast(_0x52dbd0(0x146),_0x52dbd0(0x24ab));return;}if(currentChatCharacter[_0x52dbd0(0x4b7)]){showToast('群聊不支持日记功能',_0x52dbd0(0x24ab));return;}console[_0x52dbd0(0xc0d)](_0x52dbd0(0x1ac3)+currentChatCharacter[_0x52dbd0(0x222f)]+_0x52dbd0(0x7db)),await triggerBackgroundDiary(currentChatCharacter['id']);}function debugBackgroundTimers(){const _0x574a84=_0x2cf6d4;console[_0x574a84(0xc0d)]('🔍\x20[调试]\x20当前后台定时器状态:'),console[_0x574a84(0xc0d)](_0x574a84(0xdb8),Object[_0x574a84(0x16c7)](backgroundTimers)),console[_0x574a84(0xc0d)](_0x574a84(0x11a3),Object['keys'](backgroundDiaryTimers)),Object[_0x574a84(0x16c7)](backgroundDiaryTimers)[_0x574a84(0x900)](_0x200be7=>{const _0x258d7f=_0x574a84,_0x384bb9=characters[_0x258d7f(0x1aeb)](_0x4321fc=>_0x4321fc['id']===_0x200be7),_0x4c87c0=backgroundDiaryTimers[_0x200be7]!==null&&backgroundDiaryTimers[_0x200be7]!==undefined;console[_0x258d7f(0xc0d)](_0x258d7f(0x127e)+(_0x384bb9?.['name']||_0x200be7)+':\x20定时器'+(_0x4c87c0?'存在':'不存在'));});}let globalMomentsTimers={},globalMomentsCheckInterval=null;async function initGlobalMomentsSystem(){const _0x5bac03=_0x2cf6d4;console['log'](_0x5bac03(0xec8)),clearGlobalMomentsTimers();let _0x1ccafa=0x0;if(characters&&characters['length']>0x0)for(const _0x39b341 of characters){const _0x5c3741=await getChatSettings(_0x39b341['id']);if(_0x5c3741[_0x5bac03(0x961)]===!![]&&_0x5c3741['backgroundMomentsEnabled']===!![]){const _0x366212=_0x5c3741['backgroundMomentsFrequency']||_0x5bac03(0x222d),_0x45b803=getBackgroundMomentsInterval(_0x366212);globalMomentsTimers[_0x39b341['id']]=setInterval(async()=>{const _0x39087b=_0x5bac03;console[_0x39087b(0xc0d)](_0x39087b(0x2312)+_0x39b341['name']+'\x20准备发布动态'),await triggerBackgroundMoments(_0x39b341['id']);},_0x45b803),_0x1ccafa++,console[_0x5bac03(0xc0d)]('✅\x20为角色\x20'+_0x39b341[_0x5bac03(0x222f)]+_0x5bac03(0x1f19)+Math[_0x5bac03(0x5f3)](_0x45b803/0x3e8/0x3c)+'分钟');}_0x5c3741[_0x5bac03(0x4c6)]&&_0x5c3741['scheduledMomentsTimes']&&_0x5c3741[_0x5bac03(0x11f3)][_0x5bac03(0xcbf)]>0x0&&console['log'](_0x5bac03(0x1f7b)+_0x39b341[_0x5bac03(0x222f)]+_0x5bac03(0x22ce),_0x5c3741[_0x5bac03(0x11f3)]);}!globalMomentsCheckInterval&&(globalMomentsCheckInterval=setInterval(async()=>{await checkScheduledMomentsTime();},0xea60),console[_0x5bac03(0xc0d)](_0x5bac03(0x1860))),console[_0x5bac03(0xc0d)](_0x5bac03(0x23c5)+_0x1ccafa+_0x5bac03(0x17aa));}async function checkScheduledMomentsTime(){const _0x5157d8=_0x2cf6d4,_0x415fbf=new Date(),_0x2aeaa7=String(_0x415fbf['getHours']())[_0x5157d8(0x863)](0x2,'0')+':'+String(_0x415fbf[_0x5157d8(0x21c6)]())[_0x5157d8(0x863)](0x2,'0');if(characters&&characters['length']>0x0)for(const _0x2237b6 of characters){const _0x831d4=await getChatSettings(_0x2237b6['id']);_0x831d4['scheduledMomentsEnabled']&&_0x831d4[_0x5157d8(0x11f3)]&&_0x831d4[_0x5157d8(0x11f3)][_0x5157d8(0x23ec)](_0x2aeaa7)&&(console[_0x5157d8(0xc0d)](_0x5157d8(0x8df)+_0x2237b6[_0x5157d8(0x222f)]+_0x5157d8(0xcea)+_0x2aeaa7+'\x20发布动态'),await triggerBackgroundMoments(_0x2237b6['id'],!![]));}}function clearGlobalMomentsTimers(){const _0x5d5807=_0x2cf6d4;Object[_0x5d5807(0x1efb)](globalMomentsTimers)['forEach'](_0x2fa9ac=>{if(_0x2fa9ac)clearInterval(_0x2fa9ac);}),globalMomentsTimers={},globalMomentsCheckInterval&&(clearInterval(globalMomentsCheckInterval),globalMomentsCheckInterval=null);}function getBackgroundInterval(_0x6db017){const _0x158c90=_0x2cf6d4;switch(_0x6db017){case _0x158c90(0x222d):return Math[_0x158c90(0x191c)]()*0x3c*0x3c*0x3e8+0x3c*0x3c*0x3e8;case'medium':return Math[_0x158c90(0x191c)]()*0x1e*0x3c*0x3e8+0x1e*0x3c*0x3e8;case'high':return Math[_0x158c90(0x191c)]()*0x14*0x3c*0x3e8+0xa*0x3c*0x3e8;default:return Math['random']()*0x3c*0x3c*0x3e8+0x3c*0x3c*0x3e8;}}async function scheduleProactiveChatForCharacter(_0x5dac29){const _0x2e0677=_0x2cf6d4;backgroundTimers[_0x5dac29+'_chat']&&(clearTimeout(backgroundTimers[_0x5dac29+'_chat']),delete backgroundTimers[_0x5dac29+_0x2e0677(0x15c5)]);const _0x562da4=characters[_0x2e0677(0x1aeb)](_0x1d7839=>_0x1d7839['id']===_0x5dac29);if(!_0x562da4){console['log'](_0x2e0677(0x1d9e)+_0x5dac29);return;}const _0xe11b72=await getAsyncChatSettings(_0x5dac29),_0x2f7f50=_0xe11b72[_0x2e0677(0x961)]===!![],_0x54bc91=_0xe11b72[_0x2e0677(0x1bb5)]===!![];console[_0x2e0677(0xc0d)](_0x2e0677(0x10ca)+_0x562da4[_0x2e0677(0x222f)]+':',{'backgroundInteractionEnabled':_0x2f7f50,'backgroundChatEnabled':_0x54bc91});if(!_0x2f7f50||!_0x54bc91){console[_0x2e0677(0xc0d)](_0x2e0677(0x19f2)+_0x562da4[_0x2e0677(0x222f)]+_0x2e0677(0x147d));return;}const _0x830a06=chatMessages[_0x5dac29]||[],_0x162b39=_0x830a06[_0x2e0677(0x136)]()[_0x2e0677(0x2253)]()['find'](_0x1b9a59=>_0x1b9a59[_0x2e0677(0xf75)]===_0x2e0677(0xfda));if(!_0x162b39){console[_0x2e0677(0xc0d)](_0x2e0677(0x19f2)+_0x562da4[_0x2e0677(0x222f)]+_0x2e0677(0x1b2d));return;}const _0x488713=Date[_0x2e0677(0x18e0)]()-_0x162b39[_0x2e0677(0x7aa)],_0x5b26eb=0xa*0x3c*0x3e8;console[_0x2e0677(0xc0d)](_0x2e0677(0x1428)+_0x562da4[_0x2e0677(0x222f)]+_0x2e0677(0x2462)+Math['round'](_0x488713/0xea60)+_0x2e0677(0x1e3f));let _0x56a823;_0x488713<_0x5b26eb?(_0x56a823=_0x5b26eb-_0x488713,console[_0x2e0677(0xc0d)]('⏰\x20[定时器设置]\x20'+_0x562da4[_0x2e0677(0x222f)]+_0x2e0677(0xdb5)+Math[_0x2e0677(0x5f3)](_0x56a823/0xea60)+_0x2e0677(0x1033))):(_0x56a823=0x0,console['log'](_0x2e0677(0x183e)+_0x562da4[_0x2e0677(0x222f)]+_0x2e0677(0x12ce))),backgroundTimers[_0x5dac29+'_chat']=setTimeout(async()=>{const _0x8bc658=_0x2e0677,_0x3c6bfa=characters[_0x8bc658(0x1aeb)](_0x20b688=>_0x20b688['id']===_0x5dac29);if(!_0x3c6bfa)return;const _0x1ac2f7=await getAsyncChatSettings(_0x5dac29),_0x9934f=_0x1ac2f7['backgroundInteractionEnabled']===!![],_0x46c5c2=_0x1ac2f7[_0x8bc658(0x1bb5)]===!![];console['log'](_0x8bc658(0x280)+_0x3c6bfa['name']+':',{'currentBackgroundInteractionEnabled':_0x9934f,'currentBackgroundChatEnabled':_0x46c5c2});if(!_0x9934f||!_0x46c5c2){console[_0x8bc658(0xc0d)](_0x8bc658(0x1693)+_0x3c6bfa[_0x8bc658(0x222f)]+_0x8bc658(0x217));return;}const _0x4746c8=getBackgroundInterval(_0x1ac2f7['backgroundChatFrequency']||_0x8bc658(0x222d));console[_0x8bc658(0xc0d)](_0x8bc658(0x189a)+_0x3c6bfa[_0x8bc658(0x222f)]+'\x20将在'+Math[_0x8bc658(0x5f3)](_0x4746c8/0xea60)+_0x8bc658(0x218d)),backgroundTimers[_0x5dac29+_0x8bc658(0x15c5)]=setTimeout(()=>{triggerBackgroundChat(_0x5dac29),scheduleProactiveChatForCharacter(_0x5dac29);},_0x4746c8);},_0x56a823);}function onUserMessageSent(_0x10624c){const _0x25ff2d=_0x2cf6d4,_0x1575ec=characters[_0x25ff2d(0x1aeb)](_0x509e35=>_0x509e35['id']===_0x10624c);console['log'](_0x25ff2d(0x15e3)+_0x1575ec?.[_0x25ff2d(0x222f)]+_0x25ff2d(0x1af3)),scheduleProactiveChatForCharacter(_0x10624c);}async function reinitializeProactiveChatTimers(){const _0x1cfc90=_0x2cf6d4;console[_0x1cfc90(0xc0d)](_0x1cfc90(0x24ce));for(const _0x22cdad of characters){try{const _0x98f658=await getChatSettings(_0x22cdad['id']),_0x1dc1a3=_0x98f658[_0x1cfc90(0x961)]===!![],_0x2a018b=_0x98f658[_0x1cfc90(0x1bb5)]===!![];if(_0x1dc1a3&&_0x2a018b){const _0x502422=chatMessages[_0x22cdad['id']]||[],_0x12d3c1=_0x502422[_0x1cfc90(0x184b)](_0x1e265b=>_0x1e265b[_0x1cfc90(0xf75)]===_0x1cfc90(0xfda));_0x12d3c1?(await scheduleProactiveChatForCharacter(_0x22cdad['id']),console[_0x1cfc90(0xc0d)]('✅\x20'+_0x22cdad[_0x1cfc90(0x222f)]+_0x1cfc90(0x2282))):console['log'](_0x1cfc90(0xca6)+_0x22cdad[_0x1cfc90(0x222f)]+_0x1cfc90(0x618));}else console['log'](_0x1cfc90(0x76d)+_0x22cdad[_0x1cfc90(0x222f)]+_0x1cfc90(0x892));}catch(_0x58a0f4){console[_0x1cfc90(0x24ab)](_0x1cfc90(0x110)+_0x22cdad[_0x1cfc90(0x222f)]+_0x1cfc90(0x1a9a),_0x58a0f4);}}console[_0x1cfc90(0xc0d)](_0x1cfc90(0x1b94));}function getBackgroundMomentsInterval(_0x271876){const _0x50f102=_0x2cf6d4;switch(_0x271876){case _0x50f102(0x222d):return Math[_0x50f102(0x191c)]()*0x4*0x3c*0x3c*0x3e8+0x4*0x3c*0x3c*0x3e8;case'medium':return Math[_0x50f102(0x191c)]()*0x2*0x3c*0x3c*0x3e8+0x2*0x3c*0x3c*0x3e8;case _0x50f102(0x105a):return Math[_0x50f102(0x191c)]()*0x3c*0x3c*0x3e8+0x3c*0x3c*0x3e8;default:return Math[_0x50f102(0x191c)]()*0x4*0x3c*0x3c*0x3e8+0x4*0x3c*0x3c*0x3e8;}}async function triggerBackgroundChat(_0x56c3c7,_0x5707ad=![]){const _0x2a4536=_0x2cf6d4;try{let _0x609f04=characters['find'](_0x1153c9=>_0x1153c9['id']===_0x56c3c7);!_0x609f04&&(_0x609f04=groupChats[_0x2a4536(0x1aeb)](_0x8d0d1=>_0x8d0d1['id']===_0x56c3c7),_0x609f04&&console[_0x2a4536(0xc0d)](_0x2a4536(0x33c)+_0x609f04[_0x2a4536(0x222f)]));if(!_0x609f04){console[_0x2a4536(0xc0d)](_0x2a4536(0x13d5)+_0x56c3c7);return;}const _0x39fe0c=currentChatCharacter,_0x3ad883=await getAsyncChatSettings(_0x56c3c7),_0x53b556=_0x3ad883[_0x2a4536(0x961)]===!![],_0x35c5da=_0x3ad883[_0x2a4536(0x1bb5)]===!![];console[_0x2a4536(0xc0d)](_0x2a4536(0x1f82)+_0x609f04['name']+':',{'backgroundInteractionEnabled':_0x53b556,'backgroundChatEnabled':_0x35c5da,'skipTimeCheck':_0x5707ad});if(!_0x53b556||!_0x35c5da){console[_0x2a4536(0xc0d)](_0x2a4536(0x1542)+_0x609f04['name']+_0x2a4536(0x24ae));return;}if(!_0x5707ad){const _0x172bae=chatMessages[_0x56c3c7]||[],_0x33237a=_0x172bae[_0x2a4536(0x136)]()[_0x2a4536(0x2253)]()['find'](_0x574363=>_0x574363[_0x2a4536(0xf75)]==='sent');if(_0x33237a){const _0x8e57c9=Date[_0x2a4536(0x18e0)]()-_0x33237a[_0x2a4536(0x7aa)],_0x524f2e=0xa*0x3c*0x3e8;console['log'](_0x2a4536(0x1b3e)+_0x609f04[_0x2a4536(0x222f)]+_0x2a4536(0x2462)+Math[_0x2a4536(0x5f3)](_0x8e57c9/0xea60)+_0x2a4536(0x1e3f));if(_0x8e57c9<_0x524f2e){console[_0x2a4536(0xc0d)]('🚫\x20[主动聊天]\x20'+_0x609f04[_0x2a4536(0x222f)]+'\x20跳过：用户最近'+Math[_0x2a4536(0x5f3)](_0x8e57c9/0xea60)+_0x2a4536(0x225d));return;}const _0x49ff32=_0x172bae[_0x2a4536(0x136)]()[_0x2a4536(0x2253)]()[_0x2a4536(0x1aeb)](_0x1eb779=>_0x1eb779[_0x2a4536(0xf75)]==='received');if(_0x49ff32&&_0x49ff32[_0x2a4536(0x106c)]){const _0x340245=Date[_0x2a4536(0x18e0)]()-_0x49ff32[_0x2a4536(0x7aa)],_0x389a0b=getBackgroundInterval(_0x3ad883[_0x2a4536(0x22c9)]||'low');if(_0x340245<_0x389a0b){console['log'](_0x609f04[_0x2a4536(0x222f)]+_0x2a4536(0x785)+Math[_0x2a4536(0x5f3)](_0x340245/0xea60)+'分钟');return;}}}}else console[_0x2a4536(0xc0d)](_0x609f04[_0x2a4536(0x222f)]+_0x2a4536(0x2355));const _0x8b458f=_0x3ad883[_0x2a4536(0xe03)]||0x5,_0x4cf497=_0x3ad883[_0x2a4536(0xabf)]||0x3,_0x277e37=chatMessages[_0x56c3c7]||[];let _0x113981;_0x277e37[_0x2a4536(0xcbf)]>0x0?_0x113981=calculateMessagesByRounds(_0x277e37,_0x8b458f):_0x113981=[];const _0x5c2826=await getVisibleMomentsForCharacter(_0x56c3c7,_0x4cf497);let _0x3a87d3='';_0x5c2826[_0x2a4536(0xcbf)]>0x0&&(_0x3a87d3=_0x2a4536(0x1504),_0x5c2826[_0x2a4536(0x900)]((_0x38cde7,_0x30403b)=>{const _0x235163=_0x2a4536,_0x4ad0d8=_0x38cde7[_0x235163(0x3df)]===_0x235163(0x23b2)?'用户':_0x38cde7[_0x235163(0x201a)];let _0x1e5f85='';if(_0x38cde7[_0x235163(0x7aa)]){const _0x1739be=Date[_0x235163(0x18e0)](),_0x3e1a06=_0x1739be-_0x38cde7[_0x235163(0x7aa)],_0x4cb4f5=Math[_0x235163(0x1dac)](_0x3e1a06/(0x3e8*0x3c)),_0x22416d=Math[_0x235163(0x1dac)](_0x3e1a06/(0x3e8*0x3c*0x3c)),_0x3a413b=Math[_0x235163(0x1dac)](_0x3e1a06/(0x3e8*0x3c*0x3c*0x18));if(_0x3a413b>0x0)_0x1e5f85='（'+_0x3a413b+_0x235163(0x22c4);else{if(_0x22416d>0x0)_0x1e5f85='（'+_0x22416d+_0x235163(0x19a);else _0x4cb4f5>0x0?_0x1e5f85='（'+_0x4cb4f5+'分钟前发布）':_0x1e5f85='（刚刚发布）';}}const _0x556a21=_0x4ad0d8+':\x20'+_0x38cde7['text']+_0x1e5f85+(_0x38cde7[_0x235163(0x6a7)]||'');_0x3a87d3+=_0x556a21;}));let _0x13b41a='';_0x113981[_0x2a4536(0xcbf)]>0x0&&(_0x13b41a=_0x2a4536(0x244)+_0x113981[_0x2a4536(0xf6d)](_0x315c0d=>{const _0x5e94d3=_0x2a4536;let _0x7c3f83='';if(typeof _0x315c0d[_0x5e94d3(0x1423)]==='string')_0x7c3f83=_0x315c0d[_0x5e94d3(0x1423)];else typeof _0x315c0d[_0x5e94d3(0x1423)]===_0x5e94d3(0x3c4)&&_0x315c0d[_0x5e94d3(0x1423)]!==null?_0x7c3f83=_0x315c0d[_0x5e94d3(0x1423)][_0x5e94d3(0x1e58)]||_0x315c0d['content'][_0x5e94d3(0xd7a)]||JSON['stringify'](_0x315c0d[_0x5e94d3(0x1423)]):_0x7c3f83=String(_0x315c0d[_0x5e94d3(0x1423)]||'');if(_0x315c0d[_0x5e94d3(0xf75)]===_0x5e94d3(0xfda))return _0x5e94d3(0x1e7e)+_0x7c3f83;if(_0x315c0d['sender']==='received')return _0x609f04['name']+'：'+_0x7c3f83;return'';})[_0x2a4536(0x803)](Boolean)[_0x2a4536(0x140c)]('\x0a'));console[_0x2a4536(0xc0d)](_0x2a4536(0x1654)+_0x609f04[_0x2a4536(0x222f)]+':'),console['log'](_0x2a4536(0x1fc0)+_0x277e37[_0x2a4536(0xcbf)]),console[_0x2a4536(0xc0d)](_0x2a4536(0x1fb8)+_0x113981[_0x2a4536(0xcbf)]),console[_0x2a4536(0xc0d)](_0x2a4536(0x10a4)+_0x13b41a[_0x2a4536(0xcbf)]);if(_0x113981[_0x2a4536(0xcbf)]>0x0){const _0x416a8e=_0x113981[_0x113981[_0x2a4536(0xcbf)]-0x1];let _0x1411f9='';if(typeof _0x416a8e[_0x2a4536(0x1423)]===_0x2a4536(0xb97))_0x1411f9=_0x416a8e[_0x2a4536(0x1423)];else typeof _0x416a8e[_0x2a4536(0x1423)]===_0x2a4536(0x3c4)&&_0x416a8e['content']!==null?_0x1411f9=_0x416a8e['content']['text']||_0x416a8e[_0x2a4536(0x1423)][_0x2a4536(0xd7a)]||JSON[_0x2a4536(0x7fb)](_0x416a8e[_0x2a4536(0x1423)]):_0x1411f9=String(_0x416a8e[_0x2a4536(0x1423)]||'');console[_0x2a4536(0xc0d)]('\x20\x20🕐\x20最后一条消息:\x20'+_0x1411f9[_0x2a4536(0x4b2)](0x0,0x32)+_0x2a4536(0x12da)),console[_0x2a4536(0xc0d)]('\x20\x20📜\x20完整聊天历史:',_0x13b41a);}let _0x31b04a='';_0x609f04[_0x2a4536(0xff5)]&&_0x609f04['worldbook'][_0x2a4536(0xcbf)]>0x0&&(_0x31b04a=_0x2a4536(0xe6e)+_0x609f04[_0x2a4536(0xff5)][_0x2a4536(0xf6d)](_0x2cdc83=>_0x2cdc83[_0x2a4536(0x157f)]+':\x20'+_0x2cdc83[_0x2a4536(0xc34)])[_0x2a4536(0x140c)]('\x0a'));const _0x25e267='你是'+_0x609f04['name']+_0x2a4536(0x1da8)+_0x609f04[_0x2a4536(0x1a84)]+_0x31b04a+_0x2a4536(0x2b2)+_0x13b41a+_0x3a87d3+'\x0a\x0a请生成主动聊天的消息（可以是1-12条），以JSON数组格式返回：',_0x2333d2=await generateAIResponse(_0x25e267,_0x609f04);if(_0x2333d2&&_0x2333d2[_0x2a4536(0x1424)]()){const _0x285ae7=await parseAiResponse(_0x2333d2);!chatMessages[_0x56c3c7]&&(chatMessages[_0x56c3c7]=[]);for(let _0x208e7c=0x0;_0x208e7c<_0x285ae7['length'];_0x208e7c++){const _0x7c14cc=_0x285ae7[_0x208e7c];let _0x4f2939;if(typeof _0x7c14cc===_0x2a4536(0x3c4)&&_0x7c14cc!==null&&_0x7c14cc[_0x2a4536(0x23df)]===_0x2a4536(0x1db6)){console['log']('🚫\x20跳过拉黑指令对象，不显示为消息:',_0x7c14cc);continue;}if(typeof _0x7c14cc===_0x2a4536(0x3c4)&&_0x7c14cc!==null){if(_0x7c14cc['type']===_0x2a4536(0x1bfd))_0x4f2939={'id':(Date['now']()+_0x208e7c)[_0x2a4536(0x9a3)](),'sender':_0x2a4536(0x232),'type':'voice_message','content':_0x7c14cc[_0x2a4536(0x1423)],'timestamp':Date[_0x2a4536(0x18e0)]()+_0x208e7c*0x64};else{if(_0x7c14cc[_0x2a4536(0x23df)]===_0x2a4536(0xb93))_0x4f2939={'id':(Date[_0x2a4536(0x18e0)]()+_0x208e7c)[_0x2a4536(0x9a3)](),'sender':_0x2a4536(0x232),'type':_0x2a4536(0xb93),'content':_0x7c14cc[_0x2a4536(0x1c6f)]||_0x2a4536(0x44e),'imageDescription':_0x7c14cc['description'],'timestamp':Date[_0x2a4536(0x18e0)]()+_0x208e7c*0x64};else{if(_0x7c14cc['type']===_0x2a4536(0xd8)){_0x4f2939={'id':(Date[_0x2a4536(0x18e0)]()+_0x208e7c)[_0x2a4536(0x9a3)](),'sender':_0x2a4536(0x232),'type':_0x2a4536(0xd8),'amount':_0x7c14cc[_0x2a4536(0xca8)],'note':_0x7c14cc['note'],'timestamp':Date[_0x2a4536(0x18e0)]()+_0x208e7c*0x64};if(_0x7c14cc[_0x2a4536(0x222f)]){const _0x1b8e36=currentChatCharacter[_0x2a4536(0xcaa)][_0x2a4536(0x1aeb)](_0x2bb036=>_0x2bb036[_0x2a4536(0x222f)]===_0x7c14cc[_0x2a4536(0x222f)]);_0x1b8e36&&(_0x4f2939['senderId']=_0x1b8e36['id'],_0x4f2939['name']=_0x7c14cc['name']);}}else{if(_0x7c14cc['type']===_0x2a4536(0x252a)){console[_0x2a4536(0xc0d)](_0x2a4536(0x1fca),_0x7c14cc);const _0x2fcbb9=getCurrentChatSettings(),_0x2df1e9=_0x2fcbb9['myChatNickname']||'你',_0xd26364=_0x2fcbb9[_0x2a4536(0x582)]||'';_0x4f2939={'id':(Date[_0x2a4536(0x18e0)]()+_0x208e7c)[_0x2a4536(0x9a3)](),'sender':_0x2a4536(0x212),'content':currentChatCharacter[_0x2a4536(0x222f)]+'戳了戳'+_0x2df1e9+_0xd26364,'timestamp':Date[_0x2a4536(0x18e0)]()+_0x208e7c*0x64,'isPoke':!![]};}else{if(_0x7c14cc[_0x2a4536(0x23df)]===_0x2a4536(0x1f41)){const _0x40479c=await findEmojiForAI(_0x7c14cc['description']);if(_0x40479c){_0x4f2939={'id':(Date[_0x2a4536(0x18e0)]()+_0x208e7c)[_0x2a4536(0x9a3)](),'sender':_0x2a4536(0x232),'content':'','image':_0x40479c[_0x2a4536(0x10c6)],'isEmoji':!![],'emojiDescription':_0x40479c[_0x2a4536(0x1c6f)],'timestamp':Date[_0x2a4536(0x18e0)]()+_0x208e7c*0x64};if(_0x7c14cc[_0x2a4536(0x222f)]){_0x4f2939[_0x2a4536(0x222f)]=_0x7c14cc[_0x2a4536(0x222f)];const _0x4549bc=groupChats['find'](_0x362737=>_0x362737['id']===_0x56c3c7);if(_0x4549bc&&_0x4549bc[_0x2a4536(0xcaa)]){const _0x557a4a=_0x4549bc[_0x2a4536(0xcaa)]['find'](_0x57d8c4=>_0x57d8c4[_0x2a4536(0x222f)]===_0x7c14cc[_0x2a4536(0x222f)]);_0x557a4a&&(_0x4f2939[_0x2a4536(0x210b)]=_0x557a4a['id']);}}}else _0x4f2939={'id':(Date['now']()+_0x208e7c)[_0x2a4536(0x9a3)](),'sender':_0x2a4536(0x232),'content':_0x2a4536(0xc7b)+_0x7c14cc[_0x2a4536(0x1c6f)]+_0x2a4536(0x1d49),'timestamp':Date[_0x2a4536(0x18e0)]()+_0x208e7c*0x64};}else{if(_0x7c14cc[_0x2a4536(0x1423)]){let _0x3f2ac1;if(typeof _0x7c14cc[_0x2a4536(0x1423)]===_0x2a4536(0xb97))_0x3f2ac1=_0x7c14cc['content'];else{if(Array[_0x2a4536(0x1bcc)](_0x7c14cc['content'])&&_0x7c14cc[_0x2a4536(0x1423)][_0x2a4536(0xcbf)]>0x0){const _0xa75283=_0x7c14cc[_0x2a4536(0x1423)][0x0];_0xa75283&&_0xa75283[_0x2a4536(0x23df)]===_0x2a4536(0x1e58)&&_0xa75283[_0x2a4536(0x1e58)]?_0x3f2ac1=_0xa75283[_0x2a4536(0x1e58)]:_0x3f2ac1=_0x2a4536(0x1f6f);}else{if(_0x7c14cc[_0x2a4536(0x1423)]&&typeof _0x7c14cc[_0x2a4536(0x1423)]===_0x2a4536(0x3c4)){if(_0x7c14cc['content'][_0x2a4536(0x222f)]&&typeof _0x7c14cc[_0x2a4536(0x1423)][_0x2a4536(0x222f)]===_0x2a4536(0xb97)){if(_0x7c14cc[_0x2a4536(0x1423)][_0x2a4536(0x23df)]===_0x2a4536(0xb18))_0x3f2ac1=_0x2a4536(0x16b9)+_0x7c14cc['content'][_0x2a4536(0x222f)];else _0x7c14cc[_0x2a4536(0x1423)]['type']==='create_anniversary'?_0x3f2ac1='创建了纪念日：'+_0x7c14cc['content'][_0x2a4536(0x222f)]:_0x3f2ac1=_0x2a4536(0x150d)+_0x7c14cc[_0x2a4536(0x1423)][_0x2a4536(0x222f)];}else _0x3f2ac1=_0x7c14cc[_0x2a4536(0x1423)]['message']||_0x7c14cc[_0x2a4536(0x1423)][_0x2a4536(0x1e58)]||_0x2a4536(0x1f6f);}else _0x3f2ac1=String(_0x7c14cc[_0x2a4536(0x1423)]||'');}}_0x4f2939={'id':(Date[_0x2a4536(0x18e0)]()+_0x208e7c)[_0x2a4536(0x9a3)](),'sender':_0x2a4536(0x232),'content':_0x3f2ac1,'timestamp':Date['now']()+_0x208e7c*0x64};}else{console[_0x2a4536(0xc0d)](_0x2a4536(0x86b),_0x7c14cc);continue;}}}}}}}else{if(typeof _0x7c14cc===_0x2a4536(0xb97))_0x4f2939={'id':(Date[_0x2a4536(0x18e0)]()+_0x208e7c)[_0x2a4536(0x9a3)](),'sender':_0x2a4536(0x232),'content':_0x7c14cc,'timestamp':Date['now']()+_0x208e7c*0x64};else{console[_0x2a4536(0xc0d)](_0x2a4536(0x3c7),_0x7c14cc);continue;}}_0x4f2939&&(_0x4f2939['isProactive']=!![],chatMessages[_0x56c3c7][_0x2a4536(0x6ee)](_0x4f2939));}try{const _0xe969ae=[],_0x1eb550=chatMessages[_0x56c3c7][_0x2a4536(0x136)](-_0x285ae7[_0x2a4536(0xcbf)]),_0x1a2d6f=chatMessages[_0x56c3c7][_0x2a4536(0xcbf)]-_0x285ae7[_0x2a4536(0xcbf)];for(let _0x29b5ac=0x0;_0x29b5ac<_0x1eb550[_0x2a4536(0xcbf)];_0x29b5ac++){const _0x144345=_0x1eb550[_0x29b5ac],_0x4c1e47=_0x56c3c7+_0x2a4536(0x1dc0)+_0x144345['timestamp']+'_'+Math[_0x2a4536(0x191c)]()[_0x2a4536(0x9a3)](0x24)[_0x2a4536(0x18cf)](0x2,0x9)+'_'+(_0x1a2d6f+_0x29b5ac);_0xe969ae[_0x2a4536(0x6ee)]({'id':_0x4c1e47,'characterId':_0x56c3c7,'timestamp':_0x144345[_0x2a4536(0x7aa)],'messageOrder':_0x1a2d6f+_0x29b5ac,'originalMessageId':_0x144345['id'],'messageData':_0x144345});}await db[_0x2a4536(0x464)][_0x2a4536(0x24c8)](_0xe969ae),console['log'](_0x2a4536(0x2375)+_0x1eb550['length']+_0x2a4536(0x16b0));}catch(_0x247208){console[_0x2a4536(0x24ab)](_0x2a4536(0x1ea7),_0x247208);try{await saveChatMessagesImmediate([_0x56c3c7]),console[_0x2a4536(0xc0d)](_0x2a4536(0x1f48));}catch(_0xcd8086){console['error'](_0x2a4536(0x1df2),_0xcd8086);}}console[_0x2a4536(0xc0d)]('🔥\x20[主动聊天]\x20'+_0x609f04[_0x2a4536(0x222f)]+_0x2a4536(0x1a34)+_0x285ae7['length']+'\x20条消息'),setTimeout(async()=>{const _0x3b7bd0=_0x2a4536;try{for(let _0x495684=0x0;_0x495684<_0x285ae7['length'];_0x495684++){const _0x3e78aa=_0x285ae7[_0x495684];let _0xfc7f0c='';if(typeof _0x3e78aa===_0x3b7bd0(0xb97))_0xfc7f0c=_0x3e78aa;else{if(typeof _0x3e78aa==='object'&&_0x3e78aa[_0x3b7bd0(0x1423)])_0xfc7f0c=_0x3e78aa['content'];else{if(typeof _0x3e78aa==='object'&&_0x3e78aa['type']===_0x3b7bd0(0x1bfd))_0xfc7f0c=_0x3e78aa[_0x3b7bd0(0x1423)];else{if(typeof _0x3e78aa===_0x3b7bd0(0x3c4)&&_0x3e78aa['type']===_0x3b7bd0(0xd8))_0xfc7f0c=_0x3b7bd0(0x3d5)+_0x3e78aa[_0x3b7bd0(0xca8)]+(_0x3e78aa[_0x3b7bd0(0x15fe)]?_0x3b7bd0(0x2316)+_0x3e78aa['note']:'');else{if(typeof _0x3e78aa===_0x3b7bd0(0x3c4)&&_0x3e78aa[_0x3b7bd0(0x23df)]==='poke')_0xfc7f0c='戳了戳用户';else typeof _0x3e78aa===_0x3b7bd0(0x3c4)&&_0x3e78aa['type']===_0x3b7bd0(0x1f41)&&(_0xfc7f0c=_0x3b7bd0(0x17e6)+_0x3e78aa[_0x3b7bd0(0x1c6f)]);}}}}_0xfc7f0c&&(await recordCrossAppEvent(_0x56c3c7,_0x3b7bd0(0x23b3),'ai_message',{'id':_0x56c3c7,'type':_0x3b7bd0(0x10d7),'sender':'ai','content':_0xfc7f0c,'chatType':_0x3b7bd0(0xc1e),'isProactive':!![]}),console[_0x3b7bd0(0xc0d)](_0x3b7bd0(0x35f)+_0x609f04[_0x3b7bd0(0x222f)]+_0x3b7bd0(0x594)+_0xfc7f0c['substring'](0x0,0x32)+_0x3b7bd0(0x12da)));}}catch(_0xe89b54){console['error']('🔥\x20[主动聊天]\x20记录时间线事件失败:',_0xe89b54);}},0x3e8),_0x39fe0c&&_0x39fe0c['id']===_0x56c3c7?(renderChatMessages(_0x56c3c7),console[_0x2a4536(0xc0d)](_0x2a4536(0x1502)+_0x609f04[_0x2a4536(0x222f)]+_0x2a4536(0x16d4))):console[_0x2a4536(0xc0d)](_0x2a4536(0x1502)+_0x609f04[_0x2a4536(0x222f)]+_0x2a4536(0x15ed)),renderMessageList();}}catch(_0x1fe2d4){console[_0x2a4536(0x24ab)](_0x2a4536(0x977),_0x1fe2d4);}}async function testActiveChat(){const _0x571b16=_0x2cf6d4;if(!currentChatCharacter){showToast(_0x571b16(0x1207),_0x571b16(0x24ab));return;}console[_0x571b16(0xc0d)]('🧪\x20测试主动聊天功能\x20-\x20角色:\x20'+currentChatCharacter['name']),showToast(_0x571b16(0xe3c)+currentChatCharacter[_0x571b16(0x222f)]+_0x571b16(0x2260),_0x571b16(0x2422));try{const _0x2a03d3=(chatMessages[currentChatCharacter['id']]||[])[_0x571b16(0xcbf)];console[_0x571b16(0xc0d)](_0x571b16(0xc66)+_0x2a03d3),await triggerBackgroundChat(currentChatCharacter['id'],!![]);const _0x504e80=(chatMessages[currentChatCharacter['id']]||[])[_0x571b16(0xcbf)];console[_0x571b16(0xc0d)](_0x571b16(0x2556)+_0x504e80),_0x504e80>_0x2a03d3?showToast(_0x571b16(0x2063),_0x571b16(0xb27)):showToast(_0x571b16(0xfc8),_0x571b16(0x13bb));}catch(_0x377e9e){console['error'](_0x571b16(0x186b),_0x377e9e),showToast(_0x571b16(0xf74)+_0x377e9e['message'],_0x571b16(0x24ab));}}async function testActiveMoments(){const _0x3fe94c=_0x2cf6d4;if(!currentChatCharacter){showToast(_0x3fe94c(0x1207),_0x3fe94c(0x24ab));return;}console[_0x3fe94c(0xc0d)](_0x3fe94c(0xfa6)+currentChatCharacter['name']),showToast(_0x3fe94c(0xe3c)+currentChatCharacter['name']+_0x3fe94c(0x21f2),'info');try{const _0xe015ac=await getRecentMoments(0x32),_0xb278f5=_0xe015ac['length'];console[_0x3fe94c(0xc0d)](_0x3fe94c(0x1014)+_0xb278f5),await triggerBackgroundMoments(currentChatCharacter['id'],!![]);const _0x388756=await getRecentMoments(0x32),_0x3b60f5=_0x388756['length'];console[_0x3fe94c(0xc0d)](_0x3fe94c(0x1f62)+_0x3b60f5),_0x3b60f5>_0xb278f5?showToast(_0x3fe94c(0x675),_0x3fe94c(0xb27)):showToast(_0x3fe94c(0x1098),_0x3fe94c(0x13bb));}catch(_0x1c2793){console[_0x3fe94c(0x24ab)]('主动发动态测试失败:',_0x1c2793),showToast(_0x3fe94c(0x1e9d)+_0x1c2793[_0x3fe94c(0xd7a)],_0x3fe94c(0x24ab));}}function checkBackgroundTimers(){const _0x1850da=_0x2cf6d4;console[_0x1850da(0xc0d)]('🔍\x20当前后台定时器状态:'),console['log']('backgroundTimers:',backgroundTimers);const _0x2ca68c=Object[_0x1850da(0x16c7)](backgroundTimers)['length'];console[_0x1850da(0xc0d)]('活跃定时器数量:\x20'+_0x2ca68c);if(_0x2ca68c===0x0)console[_0x1850da(0xc0d)](_0x1850da(0x1f29)),console['log'](_0x1850da(0xc05));else for(const [_0x3bf555,_0x32aed2]of Object[_0x1850da(0x230e)](backgroundTimers)){console['log']('-\x20'+_0x3bf555+':\x20'+(_0x32aed2?_0x1850da(0x8c4):'已停止'));}showToast('当前有\x20'+_0x2ca68c+_0x1850da(0x1857),_0x1850da(0x2422));}async function restartBackgroundSystem(){const _0x42c768=_0x2cf6d4;console[_0x42c768(0xc0d)](_0x42c768(0x1878)),await initGlobalBackgroundInteractionSystem(),checkBackgroundTimers();}function pauseProactiveChatTimer(_0x1ae13e){const _0xc0ecd=_0x2cf6d4,_0x233476=_0x1ae13e+'_chat';backgroundTimers[_0x233476]&&(clearTimeout(backgroundTimers[_0x233476]),backgroundTimers[_0x233476+_0xc0ecd(0x1c51)]=!![],delete backgroundTimers[_0x233476],console[_0xc0ecd(0xc0d)]('⏸️\x20已暂停角色\x20'+characters[_0xc0ecd(0x1aeb)](_0x20a519=>_0x20a519['id']===_0x1ae13e)?.[_0xc0ecd(0x222f)]+'\x20的主动发消息计时器'));}function resumeProactiveChatTimer(_0x385b95){const _0xe66ec6=_0x2cf6d4,_0x156614=_0x385b95+_0xe66ec6(0x175f);backgroundTimers[_0x156614]&&(delete backgroundTimers[_0x156614],scheduleProactiveChatForCharacter(_0x385b95),console[_0xe66ec6(0xc0d)](_0xe66ec6(0x2539)+characters[_0xe66ec6(0x1aeb)](_0x3b11a4=>_0x3b11a4['id']===_0x385b95)?.[_0xe66ec6(0x222f)]+_0xe66ec6(0xc71)));}window['reinitializeProactiveChatTimers']=reinitializeProactiveChatTimers,window['testActiveChat']=testActiveChat,window[_0x2cf6d4(0xe4f)]=testActiveMoments,window[_0x2cf6d4(0x12eb)]=checkBackgroundTimers,window[_0x2cf6d4(0x12ac)]=initGlobalBackgroundInteractionSystem,window[_0x2cf6d4(0x1872)]=restartBackgroundSystem,window['triggerPublisherReplyToComments']=triggerPublisherReplyToComments,window[_0x2cf6d4(0x1c37)]=async function(_0x7869ba){const _0xf628f2=_0x2cf6d4;try{console[_0xf628f2(0xc0d)](_0xf628f2(0xb67));const _0x9954f5=typeof _0x7869ba===_0xf628f2(0xb97)?parseInt(_0x7869ba):_0x7869ba;console[_0xf628f2(0xc0d)](_0xf628f2(0x1b4f)+_0x9954f5+_0xf628f2(0x1cfb)+_0x7869ba+')');const _0x17c495=await db[_0xf628f2(0x1a72)][_0xf628f2(0x46a)](_0x9954f5);if(!_0x17c495){console[_0xf628f2(0x24ab)]('❌\x20未找到动态:',_0x9954f5);const _0x3bef5b=await db['moments'][_0xf628f2(0x18c6)]();console[_0xf628f2(0xc0d)](_0xf628f2(0x1a77),_0x3bef5b[_0xf628f2(0xf6d)](_0x5f5cf9=>_0x5f5cf9['id']+'\x20('+typeof _0x5f5cf9['id']+')'));return;}const _0x42a876=characters[_0xf628f2(0x1aeb)](_0x5d29f0=>_0x5d29f0['id']===_0x17c495['characterId']);if(!_0x42a876){console['error']('❌\x20未找到发布者角色:',_0x17c495[_0xf628f2(0x10df)]),console[_0xf628f2(0xc0d)](_0xf628f2(0x16c1),characters[_0xf628f2(0xf6d)](_0x2e1a9a=>_0x2e1a9a[_0xf628f2(0x222f)]+_0xf628f2(0x192)+_0x2e1a9a['id']+')'));return;}console[_0xf628f2(0xc0d)](_0xf628f2(0x42e)+_0x17c495[_0xf628f2(0x1e58)]),console['log'](_0xf628f2(0x21c7)+_0x42a876[_0xf628f2(0x222f)]+_0xf628f2(0x192)+_0x42a876['id']+')'),await triggerPublisherReplyToComments(_0x9954f5,_0x42a876),console[_0xf628f2(0xc0d)](_0xf628f2(0x242f));}catch(_0x16a6dd){console[_0xf628f2(0x24ab)](_0xf628f2(0x2155),_0x16a6dd);}},window[_0x2cf6d4(0xb09)]=async function(){const _0x645879=_0x2cf6d4;try{const _0xc55df8=await db[_0x645879(0x1a72)][_0x645879(0x1902)](_0x645879(0x7aa))['reverse']()[_0x645879(0x149c)](0xa)[_0x645879(0x18c6)]();console[_0x645879(0xc0d)](_0x645879(0x62f)),_0xc55df8[_0x645879(0x900)]((_0x1596df,_0x217f94)=>{const _0x2e5fbe=_0x645879;console[_0x2e5fbe(0xc0d)](_0x217f94+0x1+'.\x20ID:\x20'+_0x1596df['id']+'\x20|\x20发布者:\x20'+_0x1596df[_0x2e5fbe(0x201a)]+'\x20|\x20内容:\x20'+_0x1596df[_0x2e5fbe(0x1e58)][_0x2e5fbe(0x4b2)](0x0,0x1e)+_0x2e5fbe(0x12da));}),console[_0x645879(0xc0d)](_0x645879(0x1a95)),console[_0x645879(0xc0d)]('💡\x20使用\x20forcePublisherReply(动态ID)\x20来强制发布者回复');}catch(_0x23d711){console['error']('❌\x20获取动态列表失败:',_0x23d711);}},window[_0x2cf6d4(0x465)]=async function(_0x41a2a6){const _0x54e39f=_0x2cf6d4;try{console[_0x54e39f(0xc0d)](_0x54e39f(0x1ab1));const _0xcaaf0a=typeof _0x41a2a6==='string'?parseInt(_0x41a2a6):_0x41a2a6,_0x39a662=await db[_0x54e39f(0x1a72)]['get'](_0xcaaf0a);if(!_0x39a662){console['error'](_0x54e39f(0x1b60),_0xcaaf0a);return;}const _0x4d1e14=characters[_0x54e39f(0x1aeb)](_0x17e0a7=>_0x17e0a7['id']===_0x39a662[_0x54e39f(0x10df)]);if(!_0x4d1e14){console['error']('❌\x20未找到发布者角色:',_0x39a662[_0x54e39f(0x10df)]);return;}const _0x3353ac=await db[_0x54e39f(0x1733)][_0x54e39f(0x4a6)](_0x54e39f(0x2289))[_0x54e39f(0x14a)](_0xcaaf0a)[_0x54e39f(0x18c6)](),_0x3e715a=_0x3353ac[_0x54e39f(0x803)](_0x5a45f8=>_0x5a45f8[_0x54e39f(0x3df)]!==_0x4d1e14['id']&&_0x5a45f8['authorId']!=='user'&&_0x5a45f8['authorId']);if(_0x3e715a[_0x54e39f(0xcbf)]===0x0){console[_0x54e39f(0xc0d)](_0x54e39f(0x469));return;}const _0x6fdae4=_0x3e715a[Math['floor'](Math['random']()*_0x3e715a[_0x54e39f(0xcbf)])];console['log'](_0x54e39f(0x23e3)+_0x4d1e14[_0x54e39f(0x222f)]+_0x54e39f(0x1c5e)+_0x6fdae4[_0x54e39f(0x201a)]+'\x20的评论');const _0x2040d8=await generatePublisherReply(_0x4d1e14,_0x6fdae4,_0xcaaf0a);if(_0x2040d8){const _0x5d8fd5={'id':Date['now']()+Math[_0x54e39f(0x191c)](),'nickname':_0x4d1e14[_0x54e39f(0x222f)],'avatar':_0x4d1e14['avatarUrl'],'text':_0x2040d8,'time':formatTime(new Date()),'timestamp':Date[_0x54e39f(0x18e0)](),'characterId':_0x4d1e14['id'],'replyTo':_0x6fdae4[_0x54e39f(0x201a)]};await saveCommentToMoment(_0xcaaf0a,_0x5d8fd5),await updateMomentCommentCount(_0xcaaf0a),displayCommentUnderMoment(_0xcaaf0a,_0x5d8fd5),console[_0x54e39f(0xc0d)](_0x54e39f(0x18ee)+_0x2040d8+'\x22');}else console[_0x54e39f(0xc0d)](_0x54e39f(0x2475));}catch(_0x576cce){console['error']('❌\x20强制回复测试失败:',_0x576cce);}};async function triggerBackgroundMomentsTest(_0x460308){await triggerBackgroundMoments(_0x460308,!![]);}async function triggerBackgroundMoments(_0x318540,_0x2b501e=![]){const _0x316869=_0x2cf6d4;try{let _0x79cb5=characters[_0x316869(0x1aeb)](_0x2c0d2d=>_0x2c0d2d['id']===_0x318540);!_0x79cb5&&(_0x79cb5=groupChats['find'](_0x4f92ee=>_0x4f92ee['id']===_0x318540));if(!_0x79cb5)return;if(_0x79cb5[_0x316869(0x4b7)]){console['log'](_0x316869(0x588)+_0x79cb5[_0x316869(0x222f)]);return;}if(!_0x2b501e){const _0x51b223=_0x79cb5['lastMomentTime']||0x0,_0x5db382=0x1e*0x3c*0x3e8;if(Date['now']()-_0x51b223<_0x5db382)return;}else{}const _0x5750f1=await getAsyncChatSettings(_0x318540),_0x250b5d=chatMessages[_0x318540]||[],_0x18e946=_0x5750f1[_0x316869(0xe03)]||0x5,_0x4db8b8=_0x250b5d[_0x316869(0x136)](-_0x18e946),_0x2f7d44=await getVisibleMomentsForCharacter(_0x318540,0x5);let _0x45502f='';_0x4db8b8[_0x316869(0xcbf)]>0x0&&(_0x45502f=_0x316869(0x244)+_0x4db8b8['map'](_0x20ebd4=>{const _0x5a8b2d=_0x316869;let _0x281c4f='';if(typeof _0x20ebd4[_0x5a8b2d(0x1423)]===_0x5a8b2d(0xb97))_0x281c4f=_0x20ebd4['content'];else typeof _0x20ebd4['content']===_0x5a8b2d(0x3c4)&&_0x20ebd4[_0x5a8b2d(0x1423)]!==null?_0x281c4f=_0x20ebd4['content']['text']||_0x20ebd4['content'][_0x5a8b2d(0xd7a)]||JSON[_0x5a8b2d(0x7fb)](_0x20ebd4[_0x5a8b2d(0x1423)]):_0x281c4f=String(_0x20ebd4[_0x5a8b2d(0x1423)]||'');if(_0x20ebd4[_0x5a8b2d(0xf75)]===_0x5a8b2d(0xfda))return _0x5a8b2d(0x1e7e)+_0x281c4f;if(_0x20ebd4[_0x5a8b2d(0xf75)]==='received')return _0x79cb5[_0x5a8b2d(0x222f)]+'：'+_0x281c4f;return'';})[_0x316869(0x803)](Boolean)[_0x316869(0x140c)]('\x0a'));let _0x315b50='';_0x2f7d44['length']>0x0&&(_0x315b50=_0x316869(0x1504),_0x2f7d44[_0x316869(0x900)]((_0x5bac1c,_0x266bd5)=>{const _0x300a46=_0x316869,_0x557deb=_0x5bac1c[_0x300a46(0x3df)]===_0x300a46(0x23b2)?'用户':_0x5bac1c[_0x300a46(0x201a)];let _0x1ef9e8='';if(_0x5bac1c[_0x300a46(0x7aa)]){const _0x3d6ddc=Date[_0x300a46(0x18e0)](),_0x60eb5=_0x3d6ddc-_0x5bac1c[_0x300a46(0x7aa)],_0x17afb5=Math['floor'](_0x60eb5/(0x3e8*0x3c)),_0x5bc7bb=Math[_0x300a46(0x1dac)](_0x60eb5/(0x3e8*0x3c*0x3c)),_0x54b969=Math[_0x300a46(0x1dac)](_0x60eb5/(0x3e8*0x3c*0x3c*0x18));if(_0x54b969>0x0)_0x1ef9e8='（'+_0x54b969+_0x300a46(0x22c4);else{if(_0x5bc7bb>0x0)_0x1ef9e8='（'+_0x5bc7bb+_0x300a46(0x19a);else _0x17afb5>0x0?_0x1ef9e8='（'+_0x17afb5+'分钟前发布）':_0x1ef9e8='（刚刚发布）';}}const _0x18cab8=_0x557deb+':\x20'+_0x5bac1c['text']+_0x1ef9e8+(_0x5bac1c[_0x300a46(0x6a7)]||'');_0x315b50+=_0x18cab8;}));const _0x1e4e12='你是'+_0x79cb5['name']+_0x316869(0x188e)+_0x79cb5[_0x316869(0x1a84)]+_0x316869(0x26a)+_0x45502f+_0x315b50+'\x0a\x0a##\x20重要格式要求：\x0a-\x20直接返回动态文本内容，不要使用JSON格式\x0a-\x20不要添加任何代码块标记\x0a-\x20不要添加\x22动态内容：\x22等前缀\x0a-\x20直接以动态正文开始\x0a\x0a请生成一条符合你人设的动态内容：',_0x12108c=await generateAIResponse(_0x1e4e12,_0x79cb5);if(_0x12108c&&_0x12108c['trim']()){let _0x1f18aa=_0x12108c[_0x316869(0x1424)]();if(_0x1f18aa['startsWith']('[')||_0x1f18aa['startsWith']('{'))try{const _0x4e3d9e=JSON[_0x316869(0x168e)](_0x1f18aa);console[_0x316869(0xc0d)](_0x79cb5[_0x316869(0x222f)]+_0x316869(0xe72),_0x4e3d9e);if(Array['isArray'](_0x4e3d9e)&&_0x4e3d9e[_0x316869(0xcbf)]>0x0)_0x1f18aa=_0x4e3d9e[_0x316869(0xf6d)](_0x41b47d=>{const _0x19b352=_0x316869;if(typeof _0x41b47d===_0x19b352(0xb97))return _0x41b47d['trim']();else{if(typeof _0x41b47d===_0x19b352(0x3c4)&&_0x41b47d[_0x19b352(0x1423)])return _0x41b47d[_0x19b352(0x1423)][_0x19b352(0x1424)]();else{if(typeof _0x41b47d==='object'&&_0x41b47d[_0x19b352(0x1e58)])return _0x41b47d[_0x19b352(0x1e58)][_0x19b352(0x1424)]();}}return'';})[_0x316869(0x803)](_0x416905=>_0x416905)[_0x316869(0x140c)]('\x0a');else typeof _0x4e3d9e==='object'&&(_0x1f18aa=_0x4e3d9e[_0x316869(0x1423)]||_0x4e3d9e[_0x316869(0x1e58)]||_0x4e3d9e['message']||JSON[_0x316869(0x7fb)](_0x4e3d9e));console[_0x316869(0xc0d)](_0x79cb5['name']+_0x316869(0x17a),_0x1f18aa);}catch(_0x5871d0){console['log'](_0x79cb5['name']+_0x316869(0x213e)),_0x1f18aa=_0x12108c['trim']();}_0x1f18aa=_0x1f18aa[_0x316869(0x882)](/^```[\s\S]*?\n/,'')['replace'](/\n```$/,'')[_0x316869(0x882)](/^\*\*动态内容\*\*:?\s*/i,'')[_0x316869(0x882)](/^动态内容:?\s*/i,'')['trim']();if(_0x1f18aa){const _0x566b31={'id':Date[_0x316869(0x18e0)](),'authorId':_0x318540,'nickname':_0x79cb5[_0x316869(0x222f)],'text':_0x1f18aa,'time':formatTime(new Date()),'timestamp':Date[_0x316869(0x18e0)](),'characterId':_0x318540};await db[_0x316869(0x1a72)][_0x316869(0xe1)](_0x566b31),_0x79cb5[_0x316869(0x1eb)]&&await db[_0x316869(0x18da)][_0x316869(0xe1)]({'momentId':_0x566b31['id'],'visibility':'partial','visibleGroups':[_0x79cb5[_0x316869(0x1eb)]],'timestamp':new Date()}),createPushNotification(_0x79cb5,_0x316869(0x1223)+(_0x1f18aa[_0x316869(0xcbf)]>0xf?_0x1f18aa[_0x316869(0x4b2)](0x0,0xf)+_0x316869(0x12da):_0x1f18aa),0x1f4),_0x79cb5[_0x316869(0x1a1b)]=Date[_0x316869(0x18e0)](),saveCharacters(),setTimeout(()=>{loadMoments();},0x64),setTimeout(()=>{const _0x4ba170=_0x316869;triggerAIInteractions(_0x566b31['id'],_0x4ba170(0x166a));},0x7d0+Math['random']()*0xbb8),setTimeout(()=>{const _0x37ce44=_0x316869;triggerAIInteractions(_0x566b31['id'],_0x37ce44(0x8a4));},0x1388+Math[_0x316869(0x191c)]()*0x1388);}}}catch(_0x126416){console[_0x316869(0x24ab)](_0x316869(0x1c73),_0x126416);}}async function getRecentMoments(_0x325ff7=0x5){const _0x206612=_0x2cf6d4;try{const _0x41c5ca=await db[_0x206612(0x1a72)][_0x206612(0x1902)](_0x206612(0x7aa))[_0x206612(0x2253)]()[_0x206612(0x149c)](_0x325ff7)[_0x206612(0x18c6)]();return _0x41c5ca||[];}catch(_0x55bb48){return console['error'](_0x206612(0x1427),_0x55bb48),[];}}async function getVisibleMomentsForCharacter(_0x4d72c6,_0x3e7583=0x5){const _0x5b06c8=_0x2cf6d4;try{const _0x5ed1ac=await db['moments'][_0x5b06c8(0x1902)](_0x5b06c8(0x7aa))[_0x5b06c8(0x2253)]()[_0x5b06c8(0x149c)](_0x3e7583*0x3)[_0x5b06c8(0x18c6)](),_0x12bb40=[],_0xd7d22f=characters['find'](_0x47555a=>_0x47555a['id']===_0x4d72c6);for(const _0x78e072 of _0x5ed1ac){if(_0x12bb40[_0x5b06c8(0xcbf)]>=_0x3e7583)break;const _0x13bf34=await checkMomentVisibilityForCharacter(_0x78e072['id'],_0x4d72c6);if(!_0x13bf34)continue;if(_0x78e072[_0x5b06c8(0x3df)]===_0x5b06c8(0x23b2)){const _0x53ec48=await enrichMomentWithComments(_0x78e072,_0x4d72c6);_0x12bb40['push'](_0x53ec48);continue;}if(_0x78e072[_0x5b06c8(0x3df)]===_0x4d72c6||_0x78e072[_0x5b06c8(0x10df)]===_0x4d72c6){const _0xd3f87e=await enrichMomentWithComments(_0x78e072,_0x4d72c6);_0x12bb40['push'](_0xd3f87e);continue;}if(_0xd7d22f&&_0x78e072[_0x5b06c8(0x10df)]){const _0x134e8c=characters[_0x5b06c8(0x1aeb)](_0x359583=>_0x359583['id']===_0x78e072[_0x5b06c8(0x10df)]);if(_0x134e8c&&areCharactersInSameGroup(_0xd7d22f,_0x134e8c)){const _0x1c62b7=await enrichMomentWithComments(_0x78e072,_0x4d72c6);_0x12bb40[_0x5b06c8(0x6ee)](_0x1c62b7);continue;}}}return _0x12bb40;}catch(_0x11bd6f){return console['error'](_0x5b06c8(0x1f70),_0x11bd6f),[];}}async function enrichMomentWithComments(_0x24e8f0,_0x528948){const _0x113e5b=_0x2cf6d4;try{const _0x41ee2b=await db['momentComments']['where'](_0x113e5b(0x2289))[_0x113e5b(0x14a)](_0x24e8f0['id'])[_0x113e5b(0x18c6)]();_0x41ee2b[_0x113e5b(0x1f0d)]((_0x29535f,_0x2fd591)=>_0x29535f['timestamp']-_0x2fd591[_0x113e5b(0x7aa)]);const _0x5190c5=[],_0x4f4496=characters[_0x113e5b(0x1aeb)](_0x5398d1=>_0x5398d1['id']===_0x528948);for(const _0x2d653c of _0x41ee2b){if(_0x2d653c[_0x113e5b(0x3df)]===_0x113e5b(0x23b2)){_0x5190c5[_0x113e5b(0x6ee)](_0x2d653c);continue;}if(_0x2d653c[_0x113e5b(0x3df)]===_0x528948){_0x5190c5['push'](_0x2d653c);continue;}if(_0x4f4496&&_0x2d653c[_0x113e5b(0x3df)]){const _0x2bc301=characters[_0x113e5b(0x1aeb)](_0x379825=>_0x379825['id']===_0x2d653c[_0x113e5b(0x3df)]);_0x2bc301&&areCharactersInSameGroup(_0x4f4496,_0x2bc301)&&_0x5190c5[_0x113e5b(0x6ee)](_0x2d653c);}}let _0x1c35db='';return _0x5190c5[_0x113e5b(0xcbf)]>0x0&&(_0x1c35db=_0x113e5b(0x2464),_0x5190c5['forEach']((_0x3be86c,_0x313269)=>{const _0x4163c2=_0x113e5b,_0x394a86=_0x3be86c[_0x4163c2(0x3df)]===_0x4163c2(0x23b2)?'用户':_0x3be86c['nickname'];_0x1c35db+='\x20\x20'+(_0x313269+0x1)+'.\x20'+_0x394a86+':\x20'+_0x3be86c[_0x4163c2(0x1e58)]+'\x0a';})),{..._0x24e8f0,'commentsText':_0x1c35db,'commentsCount':_0x5190c5[_0x113e5b(0xcbf)],'visibleComments':_0x5190c5};}catch(_0x5743a7){return console[_0x113e5b(0x24ab)](_0x113e5b(0xf88),_0x5743a7),{..._0x24e8f0,'commentsText':'','commentsCount':0x0,'visibleComments':[]};}}async function checkMomentVisibilityForCharacter(_0x4e5572,_0x187d10){const _0x37f7c6=_0x2cf6d4;try{const _0x386e7e=await db[_0x37f7c6(0x18da)]['where'](_0x37f7c6(0x2289))[_0x37f7c6(0x14a)](_0x4e5572)[_0x37f7c6(0x2200)]();if(!_0x386e7e)return!![];const {visibility:_0x467b9e,visibleGroups:_0x2851b8}=_0x386e7e;if(_0x467b9e===_0x37f7c6(0x2a3))return!![];if(_0x467b9e===_0x37f7c6(0xda9)){const _0x2a9e5c=await db[_0x37f7c6(0x1a72)]['get'](_0x4e5572),_0x29ea73=_0x2a9e5c&&(_0x2a9e5c[_0x37f7c6(0x3df)]===_0x187d10||_0x2a9e5c[_0x37f7c6(0x10df)]===_0x187d10);return _0x29ea73;}if(_0x467b9e===_0x37f7c6(0x2132)){const _0x1200f1=characters[_0x37f7c6(0x1aeb)](_0x5a29d6=>_0x5a29d6['id']===_0x187d10);if(!_0x1200f1||!_0x1200f1[_0x37f7c6(0x1eb)])return![];const _0x532b93=_0x2851b8['includes'](_0x1200f1[_0x37f7c6(0x1eb)]);return _0x532b93;}return![];}catch(_0x12f8f8){return console[_0x37f7c6(0x24ab)](_0x37f7c6(0xbd0),_0x12f8f8),!![];}}function areCharactersInSameGroup(_0x570291,_0x591502){const _0x364e5d=_0x2cf6d4;if(_0x570291[_0x364e5d(0x1eb)]&&_0x591502[_0x364e5d(0x1eb)]&&_0x570291[_0x364e5d(0x1eb)]===_0x591502[_0x364e5d(0x1eb)])return!![];return contacts[_0x364e5d(0x23ec)](_0x570291['id'])&&contacts['includes'](_0x591502['id']);}async function generateStatusAPI(_0x1a310e,_0x4d3423){const _0x32d177=_0x2cf6d4;try{if(!apiSettings['key'])throw new Error(_0x32d177(0x1789));console[_0x32d177(0xc0d)]('🔥\x20[状态API]\x20开始生成状态，角色:',_0x4d3423[_0x32d177(0x222f)]),console[_0x32d177(0xc0d)]('🔥\x20[状态API]\x20API设置:',{'base':apiSettings[_0x32d177(0x90b)],'model':apiSettings[_0x32d177(0xeea)]});const _0x183c7f=apiSettings[_0x32d177(0x90b)][_0x32d177(0x23ec)](_0x32d177(0xad8));let _0x1d775c,_0x2fb0b4,_0x286d41;if(_0x183c7f)_0x1d775c=apiSettings[_0x32d177(0x90b)]+_0x32d177(0x1f4e)+apiSettings[_0x32d177(0xeea)]+':generateContent?key='+apiSettings[_0x32d177(0x157f)],_0x2fb0b4={'contents':[{'parts':[{'text':_0x1a310e}]}],'generationConfig':{'temperature':0.8}},_0x286d41={'Content-Type':_0x32d177(0x302)};else{let _0x29d981=apiSettings[_0x32d177(0x90b)];if(_0x29d981['includes'](_0x32d177(0x779)))_0x1d775c=_0x29d981;else _0x29d981['includes']('v1')?_0x1d775c=_0x29d981['replace'](/\/$/,'')+_0x32d177(0xb73):_0x1d775c=_0x29d981[_0x32d177(0x882)](/\/$/,'')+_0x32d177(0xce8);_0x2fb0b4={'model':apiSettings[_0x32d177(0xeea)],'messages':[{'role':_0x32d177(0x23b2),'content':_0x1a310e}],'temperature':0.8,'stream':![]},_0x286d41={'Content-Type':'application/json','Authorization':_0x32d177(0x858)+apiSettings['key']};}console[_0x32d177(0xc0d)](_0x32d177(0x1181),_0x1d775c),console[_0x32d177(0xc0d)]('🔥\x20[状态API]\x20请求体:',JSON[_0x32d177(0x7fb)](_0x2fb0b4,null,0x2));const _0x169d58=await fetch(_0x1d775c,{'method':_0x32d177(0x227d),'headers':_0x286d41,'body':JSON[_0x32d177(0x7fb)](_0x2fb0b4)});console[_0x32d177(0xc0d)]('🔥\x20[状态API]\x20响应状态:',_0x169d58[_0x32d177(0xe54)],_0x169d58[_0x32d177(0x1e30)]);if(!_0x169d58['ok']){let _0x1d3c31=_0x32d177(0x669)+_0x169d58[_0x32d177(0xe54)];try{const _0x5bc8fb=await _0x169d58[_0x32d177(0x2318)]();_0x1d3c31+=_0x32d177(0x2316)+(_0x5bc8fb[_0x32d177(0x24ab)]?.[_0x32d177(0xd7a)]||JSON[_0x32d177(0x7fb)](_0x5bc8fb));}catch(_0x3bf74f){_0x1d3c31+=_0x32d177(0x2316)+_0x169d58[_0x32d177(0x1e30)];}throw new Error(_0x1d3c31);}const _0x26c6b7=await _0x169d58[_0x32d177(0x2318)]();console[_0x32d177(0xc0d)](_0x32d177(0x89f),_0x26c6b7);let _0x4f45a9;_0x183c7f?_0x4f45a9=_0x26c6b7['candidates']?.[0x0]?.[_0x32d177(0x1423)]?.['parts']?.[0x0]?.['text']:_0x4f45a9=_0x26c6b7[_0x32d177(0x13cf)]?.[0x0]?.['message']?.[_0x32d177(0x1423)]||_0x26c6b7[_0x32d177(0xd7a)]||_0x26c6b7['text']||_0x26c6b7[_0x32d177(0xc35)]||_0x26c6b7['content']||_0x26c6b7[_0x32d177(0x1fff)];console[_0x32d177(0xc0d)]('🔥\x20[状态API]\x20提取的内容:',_0x4f45a9);if(!_0x4f45a9){console['error'](_0x32d177(0x1f8e),_0x26c6b7);throw new Error('API返回了空内容');}let _0xadd80a=_0x4f45a9[_0x32d177(0x1424)]()[_0x32d177(0x882)](/^["""''「」『』【】]|["""''「」『』【】]$/g,'')['replace'](/^状态[：:]\s*/,'')['replace'](/^我现在\s*/,'')[_0x32d177(0x882)](/^当前\s*/,'')[_0x32d177(0x882)](/^请直接输出.*[：:]\s*/,'')[_0x32d177(0x882)](/^直接输出.*[：:]\s*/,'')[_0x32d177(0x633)]('\x0a')[0x0][_0x32d177(0x1424)]();if(_0xadd80a[_0x32d177(0x23ec)]('：')&&_0xadd80a[_0x32d177(0xcbf)]>0x14){const _0x5b43ba=_0xadd80a[_0x32d177(0x633)]('：');_0x5b43ba[_0x32d177(0xcbf)]>0x1&&(_0xadd80a=_0x5b43ba[_0x5b43ba[_0x32d177(0xcbf)]-0x1][_0x32d177(0x1424)]());}return _0xadd80a=_0xadd80a['substring'](0x0,0x1e),console['log'](_0x32d177(0x1fd3),_0xadd80a),_0xadd80a||'在线';}catch(_0x79ea1a){return console['error'](_0x32d177(0x1f51),_0x79ea1a),'在线';}}async function generateAIResponse(_0x3c01b1,_0x275ad4){const _0x290bd8=_0x2cf6d4;try{const _0x5d1372=await callChatAPI(_0x3c01b1,_0x275ad4);return _0x5d1372;}catch(_0xf3a956){return console[_0x290bd8(0x24ab)](_0x290bd8(0x9d6),_0xf3a956),_0x290bd8(0x65b);}}function isValidAvatarUrl(_0x584697){const _0x50a5b8=_0x2cf6d4;if(!_0x584697||typeof _0x584697!=='string')return![];if(_0x584697[_0x50a5b8(0x1cab)](_0x50a5b8(0xc14))){const _0x48640a=_0x584697['split'](',');if(_0x48640a[_0x50a5b8(0xcbf)]!==0x2)return console[_0x50a5b8(0x17cc)](_0x50a5b8(0x4fe),_0x584697[_0x50a5b8(0x4b2)](0x0,0x32)+_0x50a5b8(0x12da)),![];const _0x33d47f=_0x48640a[0x0],_0x236034=_0x48640a[0x1];if(!_0x33d47f[_0x50a5b8(0x23ec)]('data:image/')||!_0x33d47f[_0x50a5b8(0x23ec)](_0x50a5b8(0x18e9)))return console[_0x50a5b8(0x17cc)]('base64头像URL头部格式错误:',_0x33d47f),![];if(!_0x236034||_0x236034[_0x50a5b8(0xcbf)]<0x32)return console[_0x50a5b8(0x17cc)](_0x50a5b8(0x50c),_0x236034[_0x50a5b8(0xcbf)]),![];_0x236034[_0x50a5b8(0xcbf)]>0x1e8480&&console[_0x50a5b8(0x17cc)]('base64头像数据过大:',_0x236034[_0x50a5b8(0xcbf)],_0x50a5b8(0x150f));const _0x419b79=/^[A-Za-z0-9+/]*={0,2}$/;if(!_0x419b79[_0x50a5b8(0x17ba)](_0x236034))return console[_0x50a5b8(0x17cc)](_0x50a5b8(0x135f)),![];return!![];}if(_0x584697[_0x50a5b8(0x1cab)](_0x50a5b8(0x1c85))||_0x584697[_0x50a5b8(0x1cab)]('https://'))try{return new URL(_0x584697),!![];}catch(_0x4e1f1d){return console[_0x50a5b8(0x17cc)](_0x50a5b8(0x1f9b),_0x584697),![];}return console[_0x50a5b8(0x17cc)](_0x50a5b8(0x5b0),_0x584697['substring'](0x0,0x32)+_0x50a5b8(0x12da)),![];}function getCharacterAvatar(_0x590f6d){const _0x315a68=_0x2cf6d4,_0x2d16b0=getChatSettingsSync(_0x590f6d['id']);if(_0x2d16b0[_0x315a68(0x23e0)]&&_0x2d16b0[_0x315a68(0x23e0)][_0x315a68(0x1424)]()){const _0x136285=_0x2d16b0['aiChatAvatar'];if(isValidAvatarUrl(_0x136285))return _0x136285;else console[_0x315a68(0x17cc)]('角色'+_0x590f6d[_0x315a68(0x222f)]+_0x315a68(0x1954));}if(_0x590f6d['avatarUrl']&&_0x590f6d[_0x315a68(0x10f9)][_0x315a68(0x1424)]()){const _0x3411d0=_0x590f6d[_0x315a68(0x10f9)];if(isValidAvatarUrl(_0x3411d0))return _0x3411d0;else console[_0x315a68(0x17cc)]('角色'+_0x590f6d[_0x315a68(0x222f)]+_0x315a68(0x22c2));}return console[_0x315a68(0xc0d)]('角色'+_0x590f6d[_0x315a68(0x222f)]+_0x315a68(0x4f4)),null;}async function getChatSettings(_0x1a44d2){const _0xfba2f4=_0x2cf6d4;try{const _0x2d856f=await db['chatSettings'][_0xfba2f4(0x46a)](_0x1a44d2);if(_0x2d856f)return _0x2d856f[_0xfba2f4(0x1fbb)];const _0x169bd4=localStorage[_0xfba2f4(0x2250)](_0xfba2f4(0xc63)+_0x1a44d2);if(_0x169bd4){console[_0xfba2f4(0xc0d)]('迁移角色\x20'+_0x1a44d2+_0xfba2f4(0x122));const _0x3e2495=JSON['parse'](_0x169bd4);return await db[_0xfba2f4(0xb08)]['put']({'id':_0x1a44d2,'chatId':_0x1a44d2,'settings':_0x3e2495}),_0x3e2495;}return{};}catch(_0x4a587a){console['error']('获取聊天设置失败:',_0x4a587a);const _0x33e8fd=localStorage[_0xfba2f4(0x2250)](_0xfba2f4(0xc63)+_0x1a44d2);return _0x33e8fd?JSON['parse'](_0x33e8fd):{};}}function getChatSettingsSync(_0x2470a3){const _0x2050a4=_0x2cf6d4,_0x16ac13=localStorage[_0x2050a4(0x2250)](_0x2050a4(0xc63)+_0x2470a3);return _0x16ac13?JSON[_0x2050a4(0x168e)](_0x16ac13):{};}function formatMomentText(_0x500232){const _0x96bff7=_0x2cf6d4;if(!_0x500232)return'';let _0x1b401f=_0x500232[_0x96bff7(0x882)](/\n/g,_0x96bff7(0x365));return _0x1b401f=_0x1b401f[_0x96bff7(0x882)](/\*\[配图：([^\]]+)\]\*/g,function(_0xdfb0b8,_0x449f3e){const _0x1aa647=_0x96bff7;return _0x1aa647(0x16ce)+_0x449f3e+']</span>';}),_0x1b401f;}function debugMomentAvatar(_0x62d5){const _0x4d4158=_0x2cf6d4,_0x928843=document[_0x4d4158(0x15b8)]('[data-moment-id=\x22'+_0x62d5+'\x22]');if(!_0x928843){console[_0x4d4158(0xc0d)]('找不到动态元素');return;}db[_0x4d4158(0x1a72)][_0x4d4158(0x46a)](parseInt(_0x62d5))[_0x4d4158(0x1ccc)](_0x29a562=>{const _0x6da861=_0x4d4158;console['log'](_0x6da861(0x14da)),console[_0x6da861(0xc0d)](_0x6da861(0x1605),_0x62d5),console[_0x6da861(0xc0d)](_0x6da861(0x1898),_0x29a562[_0x6da861(0x10df)]),console[_0x6da861(0xc0d)](_0x6da861(0x10cf),_0x29a562[_0x6da861(0x107f)]?_0x29a562['avatar'][_0x6da861(0x4b2)](0x0,0x32)+_0x6da861(0x12da):_0x6da861(0x107e));if(_0x29a562[_0x6da861(0x10df)]&&_0x29a562[_0x6da861(0x10df)]!==_0x6da861(0x23b2)){const _0x106590=characters['find'](_0x21a83f=>_0x21a83f['id']===_0x29a562[_0x6da861(0x10df)]);_0x106590?(console[_0x6da861(0xc0d)]('找到角色:',_0x106590[_0x6da861(0x222f)]),console['log'](_0x6da861(0x1601),_0x106590[_0x6da861(0x10f9)]?_0x106590['avatarUrl'][_0x6da861(0x4b2)](0x0,0x32)+_0x6da861(0x12da):_0x6da861(0x107e))):console['log'](_0x6da861(0x520));}const _0xcc29b9=_0x928843[_0x6da861(0x15b8)](_0x6da861(0x1e2d));_0xcc29b9&&console[_0x6da861(0xc0d)](_0x6da861(0xfcf),_0xcc29b9[_0x6da861(0x107)]?_0xcc29b9[_0x6da861(0x107)][_0x6da861(0x4b2)](0x0,0x32)+_0x6da861(0x12da):_0x6da861(0x107e));});}async function fixAvatarData(){const _0x64794c=_0x2cf6d4;console[_0x64794c(0xc0d)](_0x64794c(0x61e));let _0x35f51f=0x0;try{for(const _0x1a4c89 of characters){const _0x32a675=await getChatSettings(_0x1a4c89['id']);let _0x4ba91d=![];if(_0x32a675['aiChatAvatar']){const _0x5f20bf=_0x32a675['aiChatAvatar'];_0x5f20bf[_0x64794c(0x1cab)](_0x64794c(0xc14))&&!_0x5f20bf[_0x64794c(0x23ec)]('=')&&_0x5f20bf[_0x64794c(0x633)](',')['length']===0x2&&(console[_0x64794c(0xc0d)]('清理'+_0x1a4c89[_0x64794c(0x222f)]+'的聊天头像设置'),delete _0x32a675['aiChatAvatar'],_0x4ba91d=!![],_0x35f51f++);}if(_0x32a675[_0x64794c(0x23e0)]){const _0x530425=_0x32a675[_0x64794c(0x23e0)];_0x530425['startsWith'](_0x64794c(0xc14))&&!_0x530425[_0x64794c(0x23ec)]('=')&&_0x530425[_0x64794c(0x633)](',')[_0x64794c(0xcbf)]===0x2&&(console['log']('清理'+_0x1a4c89['name']+_0x64794c(0x59c)),delete _0x32a675[_0x64794c(0x23e0)],_0x4ba91d=!![],_0x35f51f++);}_0x4ba91d&&await db[_0x64794c(0xb08)]['put']({'id':_0x1a4c89['id'],'chatId':_0x1a4c89['id'],'settings':_0x32a675});}const _0x187182=await db[_0x64794c(0x1a72)][_0x64794c(0x18c6)]();let _0x5617e7=0x0;for(const _0x58b828 of _0x187182){_0x58b828[_0x64794c(0x107f)]&&_0x58b828[_0x64794c(0x107f)][_0x64794c(0x1cab)](_0x64794c(0xc14))&&((_0x58b828[_0x64794c(0x107f)][_0x64794c(0xd7e)]('VNEKhsVJik')||_0x58b828[_0x64794c(0x107f)][_0x64794c(0xd7e)](_0x64794c(0x969))||!_0x58b828[_0x64794c(0x107f)][_0x64794c(0x23ec)]('=')&&_0x58b828['avatar'][_0x64794c(0x633)](',')[_0x64794c(0xcbf)]===0x2)&&(console[_0x64794c(0xc0d)](_0x64794c(0xaff)+_0x58b828['id']+_0x64794c(0x1981)),await db[_0x64794c(0x1a72)][_0x64794c(0x2180)](_0x58b828['id'],{'avatar':null}),_0x5617e7++));}const _0x4a5323=_0x35f51f+_0x5617e7;console[_0x64794c(0xc0d)]('修复完成:\x20清理了'+_0x35f51f+_0x64794c(0x9e)+_0x5617e7+_0x64794c(0x2f6)),alert(_0x64794c(0x495)+_0x35f51f+'\x20个设置中的截断头像\x0a清理了\x20'+_0x5617e7+_0x64794c(0x188)),_0x4a5323>0x0&&loadMoments();}catch(_0xc5dcb){console[_0x64794c(0x24ab)](_0x64794c(0x5cf),_0xc5dcb),alert(_0x64794c(0x475)+_0xc5dcb['message']);}}window[_0x2cf6d4(0x167)]('beforeunload',function(){clearAllBackgroundTimers(),clearGlobalMomentsTimers();}),window[_0x2cf6d4(0x137e)]=async function(){const _0x3914c5=_0x2cf6d4;try{const _0x3836cc=await db[_0x3914c5(0x1a72)][_0x3914c5(0x18c6)](),_0x84392f=await db[_0x3914c5(0x18da)][_0x3914c5(0x18c6)]();console[_0x3914c5(0xc0d)](_0x3914c5(0xe2f)+_0x84392f[_0x3914c5(0xcbf)]+'\x20条可见性设置');for(const _0x5d5b76 of characters){const _0x3c79f1=await getVisibleMomentsForCharacter(_0x5d5b76['id'],0xa);console['log'](_0x3914c5(0x122f)+_0x5d5b76['name']+_0x3914c5(0x2563)+_0x5d5b76[_0x3914c5(0x1eb)]+_0x3914c5(0x1bdb)+_0x3c79f1['length']+_0x3914c5(0x1bca)),_0x3c79f1[_0x3914c5(0x900)]((_0x436544,_0x55a093)=>{const _0x442d93=_0x3914c5,_0xe519=_0x436544[_0x442d93(0x3df)]==='user'?'用户':_0x436544['nickname'];console[_0x442d93(0xc0d)]('\x20\x20'+(_0x55a093+0x1)+'.\x20'+_0xe519+':\x20'+_0x436544['text'][_0x442d93(0x4b2)](0x0,0x1e)+_0x442d93(0x12da));});}}catch(_0x24430c){console[_0x3914c5(0x24ab)]('❌\x20动态可见性测试失败:',_0x24430c);}};function debugMomentsSystem(){const _0x55ff81=_0x2cf6d4;console['log']('===\x20动态系统调试信息\x20==='),console[_0x55ff81(0xc0d)]('角色数量:',characters?characters[_0x55ff81(0xcbf)]:0x0),console[_0x55ff81(0xc0d)]('全局定时器:',Object[_0x55ff81(0x16c7)](globalMomentsTimers)),console[_0x55ff81(0xc0d)](_0x55ff81(0x31c),globalMomentsCheckInterval?_0x55ff81(0x8c4):_0x55ff81(0x1d16)),characters&&characters[_0x55ff81(0xcbf)]>0x0&&(console[_0x55ff81(0xc0d)]('各角色设置:'),characters[_0x55ff81(0x900)](async(_0x5ba6e3,_0x41e310)=>{const _0x531915=_0x55ff81,_0x52f3d6=await getChatSettings(_0x5ba6e3['id']);console[_0x531915(0xc0d)](_0x41e310+0x1+'.\x20'+_0x5ba6e3[_0x531915(0x222f)]+':',{'backgroundMomentsEnabled':_0x52f3d6['backgroundMomentsEnabled'],'backgroundMomentsFrequency':_0x52f3d6[_0x531915(0x383)],'scheduledMomentsEnabled':_0x52f3d6['scheduledMomentsEnabled'],'scheduledMomentsTimes':_0x52f3d6[_0x531915(0x11f3)]});})),console[_0x55ff81(0xc0d)](_0x55ff81(0x409));}window[_0x2cf6d4(0x42b)]=debugMomentsSystem;async function loadWallpaper(){const _0x5de12a=_0x2cf6d4;try{const _0x56cde7=await db[_0x5de12a(0x229d)][_0x5de12a(0x46a)](_0x5de12a(0x9de));if(_0x56cde7){selectedWallpaper=_0x56cde7[_0x5de12a(0x4f2)];if(_0x56cde7[_0x5de12a(0x23df)]===_0x5de12a(0xe5b)&&_0x56cde7[_0x5de12a(0x4f2)][_0x5de12a(0x1cab)](_0x5de12a(0xf15)))document[_0x5de12a(0x15b8)]('.wallpaper')[_0x5de12a(0x655)][_0x5de12a(0x1584)]=_0x5de12a(0xcb5)+_0x56cde7['data']+')';else _0x56cde7['type']===_0x5de12a(0x114a)||_0x56cde7[_0x5de12a(0x4f2)][_0x5de12a(0x1cab)](_0x5de12a(0x172f))?document['querySelector']('.wallpaper')['style'][_0x5de12a(0x1584)]=_0x56cde7[_0x5de12a(0x4f2)]:(document['querySelector']('.wallpaper')[_0x5de12a(0x655)][_0x5de12a(0xacd)]=_0x56cde7[_0x5de12a(0x4f2)],document['querySelector'](_0x5de12a(0x14a0))[_0x5de12a(0x655)][_0x5de12a(0x1584)]=_0x5de12a(0xfe9));document[_0x5de12a(0x15b8)](_0x5de12a(0x14a0))['style'][_0x5de12a(0x2000)]=_0x5de12a(0x2158),document['querySelector'](_0x5de12a(0x14a0))[_0x5de12a(0x655)][_0x5de12a(0x18b3)]=_0x5de12a(0x23a1);}else{const _0x121f59=localStorage['getItem'](_0x5de12a(0x1c2)),_0x18761f=localStorage[_0x5de12a(0x2250)]('wallpaperType');if(_0x121f59){console[_0x5de12a(0xc0d)](_0x5de12a(0x528)),selectedWallpaper=_0x121f59,await db[_0x5de12a(0x229d)]['add']({'id':_0x5de12a(0x9de),'type':_0x18761f||_0x5de12a(0x114a),'data':_0x121f59});if(_0x18761f===_0x5de12a(0xe5b)&&_0x121f59[_0x5de12a(0x1cab)](_0x5de12a(0xf15)))document[_0x5de12a(0x15b8)](_0x5de12a(0x14a0))[_0x5de12a(0x655)][_0x5de12a(0x1584)]='url('+_0x121f59+')';else _0x18761f==='gradient'||_0x121f59[_0x5de12a(0x1cab)](_0x5de12a(0x172f))?document[_0x5de12a(0x15b8)](_0x5de12a(0x14a0))[_0x5de12a(0x655)][_0x5de12a(0x1584)]=_0x121f59:(document[_0x5de12a(0x15b8)](_0x5de12a(0x14a0))['style']['backgroundColor']=_0x121f59,document[_0x5de12a(0x15b8)](_0x5de12a(0x14a0))[_0x5de12a(0x655)]['backgroundImage']='none');document[_0x5de12a(0x15b8)](_0x5de12a(0x14a0))[_0x5de12a(0x655)][_0x5de12a(0x2000)]=_0x5de12a(0x2158),document[_0x5de12a(0x15b8)]('.wallpaper')[_0x5de12a(0x655)][_0x5de12a(0x18b3)]=_0x5de12a(0x23a1),console[_0x5de12a(0xc0d)](_0x5de12a(0xa14));}}}catch(_0x595a62){console[_0x5de12a(0x24ab)]('加载壁纸失败:',_0x595a62);const _0x55f97b=localStorage[_0x5de12a(0x2250)]('wallpaper'),_0x24fdfb=localStorage[_0x5de12a(0x2250)](_0x5de12a(0x386));if(_0x55f97b){selectedWallpaper=_0x55f97b;if(_0x24fdfb==='image'&&_0x55f97b[_0x5de12a(0x1cab)](_0x5de12a(0xf15)))document['querySelector'](_0x5de12a(0x14a0))['style'][_0x5de12a(0x1584)]=_0x5de12a(0xcb5)+_0x55f97b+')';else _0x24fdfb===_0x5de12a(0x114a)||_0x55f97b[_0x5de12a(0x1cab)](_0x5de12a(0x172f))?document[_0x5de12a(0x15b8)](_0x5de12a(0x14a0))['style'][_0x5de12a(0x1584)]=_0x55f97b:(document[_0x5de12a(0x15b8)](_0x5de12a(0x14a0))[_0x5de12a(0x655)][_0x5de12a(0xacd)]=_0x55f97b,document[_0x5de12a(0x15b8)]('.wallpaper')[_0x5de12a(0x655)][_0x5de12a(0x1584)]=_0x5de12a(0xfe9));document['querySelector'](_0x5de12a(0x14a0))[_0x5de12a(0x655)][_0x5de12a(0x2000)]=_0x5de12a(0x2158),document['querySelector']('.wallpaper')[_0x5de12a(0x655)][_0x5de12a(0x18b3)]=_0x5de12a(0x23a1);}}}async function loadAppIcons(){const _0x1f8b66=_0x2cf6d4;try{const _0x28b140=await db['appIcons'][_0x1f8b66(0x18c6)]();if(_0x28b140['length']===0x0){const _0x3e0b21=localStorage['getItem'](_0x1f8b66(0x1f22));if(_0x3e0b21){console[_0x1f8b66(0xc0d)](_0x1f8b66(0x908));const _0x38d40a=JSON[_0x1f8b66(0x168e)](_0x3e0b21),_0x1b2712=Object[_0x1f8b66(0x16c7)](_0x38d40a)['map'](_0x4f964b=>({'id':_0x4f964b,'appId':_0x4f964b,'iconClass':_0x38d40a[_0x4f964b]}));_0x1b2712['length']>0x0&&(await db[_0x1f8b66(0x1f22)][_0x1f8b66(0x24c8)](_0x1b2712),console['log'](_0x1f8b66(0x1a5b),_0x1b2712)),Object[_0x1f8b66(0x16c7)](_0x38d40a)[_0x1f8b66(0x900)](_0xe274d1=>{const _0x2ed289=_0x1f8b66,_0x58646f=document['querySelector'](_0x2ed289(0x20e8)+_0xe274d1+_0x2ed289(0x1104));_0x58646f&&(_0x58646f['className']=_0x38d40a[_0xe274d1]);});}}else console[_0x1f8b66(0xc0d)]('从IndexedDB加载应用图标数据:',_0x28b140),_0x28b140[_0x1f8b66(0x900)](_0x1011a5=>{const _0x5e3649=_0x1f8b66,_0x3be7a7=document['querySelector'](_0x5e3649(0x20e8)+_0x1011a5[_0x5e3649(0x233d)]+_0x5e3649(0x1104));_0x3be7a7&&(_0x3be7a7[_0x5e3649(0x221)]=_0x1011a5[_0x5e3649(0x180f)]);});}catch(_0x500f45){console[_0x1f8b66(0x24ab)](_0x1f8b66(0x1b7e),_0x500f45);const _0x41ac9f=localStorage[_0x1f8b66(0x2250)](_0x1f8b66(0x1f22));if(_0x41ac9f){const _0x3775ae=JSON[_0x1f8b66(0x168e)](_0x41ac9f);Object[_0x1f8b66(0x16c7)](_0x3775ae)[_0x1f8b66(0x900)](_0x2250eb=>{const _0x524c09=_0x1f8b66,_0x3177db=document[_0x524c09(0x15b8)]('.app[onclick=\x22showApp(\x27'+_0x2250eb+_0x524c09(0x1104));_0x3177db&&(_0x3177db[_0x524c09(0x221)]=_0x3775ae[_0x2250eb]);});}}}async function loadApiSettings(){const _0x68e78a=_0x2cf6d4;try{const _0x45c2ae=await db[_0x68e78a(0x530)][_0x68e78a(0x46a)]('main');if(_0x45c2ae)apiSettings=_0x45c2ae['settings'],console[_0x68e78a(0xc0d)]('🔧\x20[应用启动]\x20从IndexedDB加载API设置:',apiSettings);else{const _0x5c40af=localStorage[_0x68e78a(0x2250)](_0x68e78a(0x530));_0x5c40af?(console[_0x68e78a(0xc0d)](_0x68e78a(0x1ba0)),apiSettings=JSON[_0x68e78a(0x168e)](_0x5c40af),await db[_0x68e78a(0x530)][_0x68e78a(0x53a)]({'id':_0x68e78a(0x9de),'settings':apiSettings}),console[_0x68e78a(0xc0d)]('🔧\x20[应用启动]\x20迁移完成，当前API设置:',apiSettings)):(console[_0x68e78a(0xc0d)](_0x68e78a(0x1939)),apiSettings={'type':_0x68e78a(0x21c9),'base':_0x68e78a(0x1fb4),'endpoint':_0x68e78a(0xb73),'key':'','model':_0x68e78a(0x1e47),'temperature':0.7});}}catch(_0xf16172){console[_0x68e78a(0x24ab)](_0x68e78a(0x1abc),_0xf16172);}}async function saveAppIcons(){const _0x55a5bd=_0x2cf6d4;try{console[_0x55a5bd(0xc0d)](_0x55a5bd(0x12c7));const _0x4c9f17={'chat-screen':_0x55a5bd(0x15ad),'forum-screen':_0x55a5bd(0xab5),'diary-book-screen':_0x55a5bd(0x502),'characters-screen':_0x55a5bd(0xe4d),'shop-screen':_0x55a5bd(0x353),'settings-screen':_0x55a5bd(0x21a0)};selectedAppIcon&&(_0x4c9f17[selectedAppIcon[_0x55a5bd(0x233d)]]=selectedAppIcon[_0x55a5bd(0x180f)]);const _0x1f36c3=Object['keys'](_0x4c9f17)[_0x55a5bd(0xf6d)](_0x5701d4=>({'id':_0x5701d4,'appId':_0x5701d4,'iconClass':_0x4c9f17[_0x5701d4]}));await db['appIcons'][_0x55a5bd(0x2215)](),await db[_0x55a5bd(0x1f22)]['bulkAdd'](_0x1f36c3),console[_0x55a5bd(0xc0d)](_0x55a5bd(0x18a5)),await loadAppIcons();}catch(_0x1d55dc){console[_0x55a5bd(0x24ab)](_0x55a5bd(0x86c),_0x1d55dc);const _0x2d6c47={'chat-screen':_0x55a5bd(0x15ad),'weibo-screen':_0x55a5bd(0x1918),'album-screen':_0x55a5bd(0xc82),'characters-screen':_0x55a5bd(0xe4d),'shop-screen':'fas\x20fa-shopping-bag','settings-screen':'fas\x20fa-cog'};selectedAppIcon&&(_0x2d6c47[selectedAppIcon[_0x55a5bd(0x233d)]]=selectedAppIcon[_0x55a5bd(0x180f)]),localStorage[_0x55a5bd(0x2055)]('appIcons',JSON[_0x55a5bd(0x7fb)](_0x2d6c47)),loadAppIcons();}}function renderMessageList(){const _0x184882=_0x2cf6d4,_0x27b5b4=document[_0x184882(0x566)](_0x184882(0xda4));_0x27b5b4[_0x184882(0xc02)]='';const _0x17aeb9=document[_0x184882(0x15b8)](_0x184882(0xeed));if(isMessageListMultiSelectMode){_0x17aeb9&&(_0x17aeb9[_0x184882(0x655)][_0x184882(0x2526)]=_0x184882(0xfe9));let _0x427b9f=document['querySelector'](_0x184882(0x1c83));if(!_0x427b9f){const _0x1c5ed7=document[_0x184882(0x1ad8)](_0x184882(0x526));_0x1c5ed7[_0x184882(0x221)]=_0x184882(0xd7c),_0x1c5ed7[_0x184882(0xc02)]=_0x184882(0x1e51),_0x1c5ed7[_0x184882(0x11cf)]=function(_0x32d7bc){const _0x306a8f=_0x184882,_0x2d7a3a=_0x32d7bc[_0x306a8f(0x1144)]['closest'](_0x306a8f(0x1ee2))?.[_0x306a8f(0x1f26)][_0x306a8f(0x23af)];if(_0x2d7a3a===_0x306a8f(0xc2b))deleteSelectedConversations();else{if(_0x2d7a3a==='cancel')exitMessageListMultiSelectMode();else _0x2d7a3a===_0x306a8f(0x2160)&&pinSelectedConversations();}};const _0x131c75=document[_0x184882(0x15b8)]('#chat-screen\x20.app-header');_0x131c75&&_0x131c75[_0x184882(0x1925)](_0x1c5ed7);}}else{_0x17aeb9&&(_0x17aeb9[_0x184882(0x655)][_0x184882(0x2526)]=_0x184882(0x1f0b));const _0x106228=document[_0x184882(0x15b8)](_0x184882(0x1c83));_0x106228&&_0x106228[_0x184882(0x128)]();}console[_0x184882(0xc0d)](_0x184882(0x1456),{'charactersCount':characters['length'],'contactsCount':contacts['length'],'contactsArray':contacts,'chatMessagesKeys':Object[_0x184882(0x16c7)](chatMessages)[_0x184882(0xcbf)]});if(contacts['length']===0x0&&characters['length']>0x0){const _0xdccee6=Object['keys'](chatMessages)['length']>0x0;if(_0xdccee6){console[_0x184882(0x17cc)](_0x184882(0x1ef3));const _0x101778=Object[_0x184882(0x16c7)](chatMessages),_0xad3423=_0x101778[_0x184882(0x803)](_0x5dfe03=>characters['some'](_0x105c8d=>_0x105c8d['id']===_0x5dfe03));_0xad3423['length']>0x0&&(contacts=_0xad3423,saveContacts()[_0x184882(0x9e5)](_0x3668b2=>console[_0x184882(0x24ab)](_0x184882(0x2131),_0x3668b2)),console[_0x184882(0xc0d)](_0x184882(0x1b02)+_0xad3423[_0x184882(0xcbf)]+_0x184882(0x16f6)));}else console[_0x184882(0xc0d)](_0x184882(0x31d));}const _0x48a623=characters[_0x184882(0x803)](_0x544081=>{if(!_0x544081||!_0x544081['id'])return![];return contacts['includes'](_0x544081['id']);}),_0x4fa2e5=_0x48a623[_0x184882(0x1f0d)]((_0x5d045b,_0x39b316)=>{const _0x18b761=isPinned(_0x5d045b['id']),_0x43e8ff=isPinned(_0x39b316['id']);if(_0x18b761&&!_0x43e8ff)return-0x1;if(!_0x18b761&&_0x43e8ff)return 0x1;return 0x0;});_0x4fa2e5[_0x184882(0x900)](_0x47e1d2=>{const _0x53c0c5=_0x184882;if(_0x47e1d2){const _0x55123a=window['chatSettings']&&window[_0x53c0c5(0xb08)][_0x47e1d2['id']]?window[_0x53c0c5(0xb08)][_0x47e1d2['id']]:{},_0xd979e6=_0x55123a[_0x53c0c5(0x1967)]||_0x47e1d2[_0x53c0c5(0x222f)],_0x47fb19=chatMessages[_0x47e1d2['id']]||[],_0x6808fa=_0x55123a[_0x53c0c5(0x14f7)]===!![],_0x1388f0=_0x47fb19[_0x53c0c5(0x803)](_0x2a4348=>{const _0x1c7243=_0x53c0c5;if(_0x2a4348['isGameMessage']||_0x2a4348['isGameContext'])return![];if(_0x2a4348[_0x1c7243(0x14ad)]&&!_0x6808fa)return![];return!![];});let _0x3f5f33=_0x53c0c5(0x18a0);if(_0x1388f0[_0x53c0c5(0xcbf)]>0x0){const _0x5a917b=_0x1388f0[_0x1388f0[_0x53c0c5(0xcbf)]-0x1];if(!_0x5a917b)_0x3f5f33=_0x53c0c5(0x18a0);else{if(_0x5a917b[_0x53c0c5(0x23df)]===_0x53c0c5(0x14a6))_0x3f5f33=_0x53c0c5(0x369);else{if(_0x5a917b['type']===_0x53c0c5(0xb93))_0x3f5f33=_0x53c0c5(0xff7);else{if(_0x5a917b[_0x53c0c5(0x23df)]===_0x53c0c5(0x1bfd))_0x3f5f33='[语音]';else{if(_0x5a917b['type']===_0x53c0c5(0xd8))_0x3f5f33=_0x53c0c5(0x21d9);else{if(_0x5a917b[_0x53c0c5(0x23df)]===_0x53c0c5(0x1e4b))_0x3f5f33='[撤回了一条消息]';else{if(_0x5a917b[_0x53c0c5(0x23df)]==='location')_0x3f5f33=_0x53c0c5(0x1481);else{if(_0x5a917b[_0x53c0c5(0x23df)]===_0x53c0c5(0xc11))_0x3f5f33=_0x53c0c5(0x1674);else{if(_0x5a917b[_0x53c0c5(0xf75)]==='system')_0x3f5f33=_0x5a917b[_0x53c0c5(0x1423)]||_0x53c0c5(0x6cd);else{if(_0x5a917b[_0x53c0c5(0xe29)])_0x3f5f33=_0x53c0c5(0x146b);else{if(typeof _0x5a917b[_0x53c0c5(0x1423)]==='string')_0x3f5f33=_0x5a917b[_0x53c0c5(0x1423)];else{if(Array[_0x53c0c5(0x1bcc)](_0x5a917b[_0x53c0c5(0x1423)])){const _0x5cebcb=_0x5a917b['content'][_0x53c0c5(0x1aeb)](_0x39b747=>_0x39b747[_0x53c0c5(0x23df)]===_0x53c0c5(0x1e58));_0x3f5f33=_0x5cebcb?_0x5cebcb['text']:'[多媒体消息]';}else{if(typeof _0x5a917b[_0x53c0c5(0x1423)]===_0x53c0c5(0x3c4)&&_0x5a917b[_0x53c0c5(0x1423)]!==null){if(_0x5a917b[_0x53c0c5(0x1423)][_0x53c0c5(0x1e58)])_0x3f5f33=_0x5a917b['content']['text'];else _0x5a917b[_0x53c0c5(0x1423)][_0x53c0c5(0x1423)]?_0x3f5f33=_0x5a917b['content'][_0x53c0c5(0x1423)]:_0x3f5f33=_0x53c0c5(0xf1a);}else _0x3f5f33=_0x5a917b['content']||'';}}}}}}}}}}}}}const _0x54cc80=truncateText(String(_0x3f5f33||'暂无消息'),0x1e),_0x1cb670=_0x47fb19[_0x53c0c5(0xcbf)]>0x0?formatTime(_0x47fb19[_0x47fb19[_0x53c0c5(0xcbf)]-0x1][_0x53c0c5(0x7aa)]):'刚刚',_0x3fc2bc=document['createElement'](_0x53c0c5(0x526)),_0x44bd5a=isPinned(_0x47e1d2['id']);_0x3fc2bc[_0x53c0c5(0x221)]='message-item\x20'+(_0x44bd5a?_0x53c0c5(0x12e2):'')+'\x20'+(isMessageListMultiSelectMode&&selectedConversations[_0x53c0c5(0x23ec)](_0x47e1d2['id'])?'selected':''),_0x3fc2bc['dataset']['conversationId']=_0x47e1d2['id'];if(isMessageListMultiSelectMode)_0x3fc2bc['onclick']=()=>toggleConversationSelection(_0x47e1d2['id']);else{let _0x3f641c=![];_0x3fc2bc[_0x53c0c5(0x11cf)]=_0x308b1f=>{!_0x3f641c&&startChat(_0x47e1d2),_0x3f641c=![];};let _0xf41e78;_0x3fc2bc[_0x53c0c5(0x167)](_0x53c0c5(0xf52),_0x5898dc=>{const _0x17d118=_0x53c0c5;_0x5898dc[_0x17d118(0x1023)](),_0xf41e78=setTimeout(()=>{const _0x4a0d9d=_0x17d118;console[_0x4a0d9d(0xc0d)](_0x4a0d9d(0x237a),_0x47e1d2['id']),_0x3f641c=!![],enterMessageListMultiSelectMode(_0x47e1d2['id']),_0x5898dc[_0x4a0d9d(0x4d9)]();},0x320);}),_0x3fc2bc[_0x53c0c5(0x167)]('touchend',_0x4c837a=>{_0xf41e78&&(clearTimeout(_0xf41e78),_0xf41e78=null);}),_0x3fc2bc['addEventListener'](_0x53c0c5(0x1e8f),_0x34ec11=>{_0xf41e78&&(clearTimeout(_0xf41e78),_0xf41e78=null);}),_0x3fc2bc[_0x53c0c5(0x167)](_0x53c0c5(0xa69),_0x5bf517=>{const _0x8f3a54=_0x53c0c5;_0x5bf517[_0x8f3a54(0x217f)]===0x0&&(_0x5bf517[_0x8f3a54(0x1023)](),_0xf41e78=setTimeout(()=>{const _0x27f9a7=_0x8f3a54;console[_0x27f9a7(0xc0d)](_0x27f9a7(0x20dc),_0x47e1d2['id']),_0x3f641c=!![],enterMessageListMultiSelectMode(_0x47e1d2['id']),_0x5bf517[_0x27f9a7(0x4d9)]();},0x320));}),_0x3fc2bc[_0x53c0c5(0x167)](_0x53c0c5(0x1fb0),_0x248dec=>{_0xf41e78&&(clearTimeout(_0xf41e78),_0xf41e78=null);}),_0x3fc2bc['addEventListener'](_0x53c0c5(0x1761),_0x34b633=>{_0xf41e78&&(clearTimeout(_0xf41e78),_0xf41e78=null);}),_0x3fc2bc[_0x53c0c5(0x167)](_0x53c0c5(0xd3e),_0x1055e9=>{const _0x4bc208=_0x53c0c5;_0x1055e9[_0x4bc208(0x4d9)](),enterMessageListMultiSelectMode(_0x47e1d2['id']);});}let _0x13989a='';if(_0x47e1d2[_0x53c0c5(0x4b7)]===!![]){const _0x43adc7=isGroupMuted(_0x47e1d2['id']);_0x43adc7&&(_0x13989a=_0x53c0c5(0xded));}else{const _0x4c576f=isBlocked(_0x53c0c5(0x23b2),_0x47e1d2['id']),_0x14f21f=isBlocked(_0x47e1d2['id'],_0x53c0c5(0x23b2));if(_0x4c576f)_0x13989a=_0x53c0c5(0x1df5);else _0x14f21f&&(_0x13989a=_0x53c0c5(0x12f));}let _0x181e75='';const _0x266ebd=getUnreadCount(_0x47e1d2['id']);if(_0x266ebd>0x0){const _0xf909b9=_0x266ebd>0x63?_0x53c0c5(0x2330):_0x266ebd[_0x53c0c5(0x9a3)](),_0x51912b=_0x266ebd>0x63?'unread-badge\x20large-count':'unread-badge';_0x181e75=_0x53c0c5(0xc53)+_0x51912b+_0x53c0c5(0x14e7)+_0x266ebd+'条未读消息\x22>'+_0xf909b9+'</div>';}_0x3fc2bc[_0x53c0c5(0xc02)]=_0x53c0c5(0x529)+(_0x44bd5a?_0x53c0c5(0x9fd):'')+_0x53c0c5(0x529)+(isMessageListMultiSelectMode?_0x53c0c5(0x12e5)+(selectedConversations[_0x53c0c5(0x23ec)](_0x47e1d2['id'])?_0x53c0c5(0x876):'')+_0x53c0c5(0x101b)+(selectedConversations[_0x53c0c5(0x23ec)](_0x47e1d2['id'])?_0x53c0c5(0x1ea1):'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20':'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-avatar-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-avatar\x22\x20style=\x22background-color:\x20'+_0x47e1d2[_0x53c0c5(0x2099)]+';\x20'+(_0x47e1d2[_0x53c0c5(0x10f9)]?'background-image:\x20url('+_0x47e1d2[_0x53c0c5(0x10f9)]+');\x20background-size:\x20cover;\x20background-position:\x20center;':'')+_0x53c0c5(0x101b)+(_0x47e1d2[_0x53c0c5(0x10f9)]?'':_0xd979e6[_0x53c0c5(0x1518)](0x0))+_0x53c0c5(0x677)+_0x181e75+_0x53c0c5(0xbc6)+_0x13989a+_0x53c0c5(0x10ae)+_0xd979e6+_0x53c0c5(0x1c1f)+_0x54cc80+_0x53c0c5(0x1c8a)+_0x1cb670+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x27b5b4[_0x53c0c5(0x1925)](_0x3fc2bc),_0x44bd5a&&(_0x3fc2bc[_0x53c0c5(0x655)][_0x53c0c5(0xc3c)]=_0x53c0c5(0x38c),_0x3fc2bc[_0x53c0c5(0x655)]['borderLeft']='none');}});const _0x36a9f7=[...groupChats][_0x184882(0x1f0d)]((_0x14e7e0,_0x438829)=>{const _0x5c1dac=isPinned(_0x14e7e0['id']),_0x2d295a=isPinned(_0x438829['id']);if(_0x5c1dac&&!_0x2d295a)return-0x1;if(!_0x5c1dac&&_0x2d295a)return 0x1;return 0x0;});_0x36a9f7['forEach'](_0xa67856=>{const _0x30b396=_0x184882,_0x5e1ed4=chatMessages[_0xa67856['id']]||[];let _0x1ec104=_0x30b396(0x18a0);if(_0x5e1ed4[_0x30b396(0xcbf)]>0x0){const _0x401ef8=_0x5e1ed4[_0x5e1ed4[_0x30b396(0xcbf)]-0x1];if(!_0x401ef8)_0x1ec104='暂无消息';else{if(_0x401ef8[_0x30b396(0x23df)]===_0x30b396(0x14a6))_0x1ec104='[照片]';else{if(_0x401ef8[_0x30b396(0x23df)]===_0x30b396(0xb93))_0x1ec104='[图片]';else{if(_0x401ef8[_0x30b396(0x23df)]===_0x30b396(0x1bfd))_0x1ec104=_0x30b396(0xf4a);else{if(_0x401ef8['type']==='transfer')_0x1ec104=_0x30b396(0x21d9);else{if(_0x401ef8[_0x30b396(0x23df)]===_0x30b396(0x1e4b))_0x1ec104=_0x30b396(0x8ca);else{if(_0x401ef8[_0x30b396(0x23df)]===_0x30b396(0x63b))_0x1ec104='[位置]';else{if(_0x401ef8[_0x30b396(0x23df)]==='call_message')_0x1ec104=_0x30b396(0x1674);else{if(_0x401ef8[_0x30b396(0xf75)]===_0x30b396(0x212))_0x1ec104=_0x401ef8[_0x30b396(0x1423)]||_0x30b396(0x6cd);else{if(_0x401ef8[_0x30b396(0xe29)])_0x1ec104=_0x30b396(0x146b);else{if(typeof _0x401ef8[_0x30b396(0x1423)]===_0x30b396(0xb97))_0x1ec104=_0x401ef8['content'];else{if(Array[_0x30b396(0x1bcc)](_0x401ef8[_0x30b396(0x1423)])){const _0x1de648=_0x401ef8['content'][_0x30b396(0x1aeb)](_0x428429=>_0x428429[_0x30b396(0x23df)]===_0x30b396(0x1e58)&&_0x428429['text']);if(_0x1de648&&_0x1de648[_0x30b396(0x1e58)])_0x1ec104=_0x1de648[_0x30b396(0x1e58)];else{const _0x9878cb=_0x401ef8[_0x30b396(0x1423)][_0x30b396(0x1aeb)](_0x200bf8=>_0x200bf8[_0x30b396(0x23df)]===_0x30b396(0x1cfa));_0x9878cb?_0x1ec104='[图片]':_0x1ec104=_0x30b396(0x1f6f);}}else{if(typeof _0x401ef8[_0x30b396(0x1423)]===_0x30b396(0x3c4)&&_0x401ef8['content']!==null){if(_0x401ef8['content']['text'])_0x1ec104=_0x401ef8[_0x30b396(0x1423)][_0x30b396(0x1e58)];else _0x401ef8['content']['content']?_0x1ec104=_0x401ef8[_0x30b396(0x1423)][_0x30b396(0x1423)]:_0x1ec104=_0x30b396(0xf1a);}else _0x1ec104=_0x401ef8[_0x30b396(0x1423)]||'';}}}}}}}}}}}}}const _0x33bafb=truncateText(String(_0x1ec104||'暂无消息'),0x1e),_0xff3f50=_0x5e1ed4[_0x30b396(0xcbf)]>0x0?formatTime(_0x5e1ed4[_0x5e1ed4[_0x30b396(0xcbf)]-0x1][_0x30b396(0x7aa)]):'刚刚',_0x493706=document[_0x30b396(0x1ad8)](_0x30b396(0x526)),_0x2bd131=isPinned(_0xa67856['id']);_0x493706['className']=_0x30b396(0x1b6e)+(_0x2bd131?_0x30b396(0x12e2):'')+'\x20'+(isMessageListMultiSelectMode&&selectedConversations['includes'](_0xa67856['id'])?'selected':''),_0x493706[_0x30b396(0x1f26)][_0x30b396(0xe58)]=_0xa67856['id'];if(isMessageListMultiSelectMode)_0x493706[_0x30b396(0x11cf)]=()=>toggleConversationSelection(_0xa67856['id']);else{_0x493706['onclick']=()=>startChat(_0xa67856);let _0x41c637;_0x493706[_0x30b396(0x167)]('touchstart',_0x4d1d83=>{const _0x4c46af=_0x30b396;_0x4d1d83[_0x4c46af(0x1023)](),_0x41c637=setTimeout(()=>{const _0x752704=_0x4c46af;console[_0x752704(0xc0d)](_0x752704(0xb35),_0xa67856['id']),enterMessageListMultiSelectMode(_0xa67856['id']),_0x4d1d83[_0x752704(0x4d9)]();},0x320);}),_0x493706['addEventListener'](_0x30b396(0x1263),_0x194075=>{_0x41c637&&(clearTimeout(_0x41c637),_0x41c637=null);}),_0x493706['addEventListener'](_0x30b396(0x1e8f),_0x3b79a5=>{_0x41c637&&(clearTimeout(_0x41c637),_0x41c637=null);}),_0x493706[_0x30b396(0x167)](_0x30b396(0xa69),_0xb6e7f8=>{const _0x47688a=_0x30b396;_0xb6e7f8['button']===0x0&&(_0xb6e7f8[_0x47688a(0x1023)](),_0x41c637=setTimeout(()=>{const _0x4fd081=_0x47688a;console[_0x4fd081(0xc0d)](_0x4fd081(0xe73),_0xa67856['id']),enterMessageListMultiSelectMode(_0xa67856['id']),_0xb6e7f8['preventDefault']();},0x320));}),_0x493706['addEventListener'](_0x30b396(0x1fb0),_0x1fcfc2=>{_0x41c637&&(clearTimeout(_0x41c637),_0x41c637=null);}),_0x493706['addEventListener'](_0x30b396(0x1761),_0x280099=>{_0x41c637&&(clearTimeout(_0x41c637),_0x41c637=null);}),_0x493706['addEventListener'](_0x30b396(0xd3e),_0x14c30a=>{const _0x55e28c=_0x30b396;_0x14c30a[_0x55e28c(0x4d9)](),enterMessageListMultiSelectMode(_0xa67856['id']);});}let _0x19a287='';const _0x302b93=isGroupMuted(_0xa67856['id']);_0x302b93&&(_0x19a287=_0x30b396(0xded));let _0x3d5c7e='';const _0x35a416=getUnreadCount(_0xa67856['id']);if(_0x35a416>0x0){const _0xb75b9d=_0x35a416>0x63?_0x30b396(0x2330):_0x35a416[_0x30b396(0x9a3)](),_0x3a9023=_0x35a416>0x63?'unread-badge\x20large-count':_0x30b396(0x17f4);_0x3d5c7e='<div\x20class=\x22'+_0x3a9023+_0x30b396(0x14e7)+_0x35a416+_0x30b396(0x1c02)+_0xb75b9d+_0x30b396(0xa54);}_0x493706[_0x30b396(0xc02)]=_0x30b396(0xf39)+(_0x2bd131?_0x30b396(0x9fd):'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(isMessageListMultiSelectMode?_0x30b396(0xa29)+(selectedConversations['includes'](_0xa67856['id'])?_0x30b396(0x876):'')+_0x30b396(0x1496)+(selectedConversations[_0x30b396(0x23ec)](_0xa67856['id'])?_0x30b396(0x1ea1):'')+_0x30b396(0x9ca):'')+_0x30b396(0xec6)+(_0xa67856['avatarUrl']?_0x30b396(0x1910)+_0xa67856[_0x30b396(0x10f9)]+_0x30b396(0x1051):_0x30b396(0x1011))+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0xa67856['avatarUrl']?'':'群')+_0x30b396(0x1021)+_0x3d5c7e+_0x30b396(0x529)+_0x19a287+_0x30b396(0x1079)+_0xa67856[_0x30b396(0x222f)]+_0x30b396(0x1e29)+(_0xa67856[_0x30b396(0xcaa)]?_0xa67856[_0x30b396(0xcaa)][_0x30b396(0xcbf)]+0x1:0x1)+_0x30b396(0x1a22)+_0x33bafb+_0x30b396(0xee0)+_0xff3f50+_0x30b396(0x1416),_0x27b5b4[_0x30b396(0x1925)](_0x493706),_0x2bd131&&(_0x493706[_0x30b396(0x655)]['background']=_0x30b396(0x38c),_0x493706['style'][_0x30b396(0xd78)]='none');});if(window[_0x184882(0x63b)]['hash']==='#test-unread'){const _0x267282=characters[_0x184882(0x1aeb)](_0x4c438=>_0x4c438[_0x184882(0x222f)]==='一号');if(_0x267282){const _0x279f11=Date['now']()-0x3c*0x3c*0x3e8;localStorage[_0x184882(0x2055)](_0x184882(0x109d)+_0x267282['id'],_0x279f11[_0x184882(0x9a3)]());}}}function getUnreadCount(_0x24d04a){const _0x1e8672=_0x2cf6d4,_0x5cd90b=chatMessages[_0x24d04a]||[],_0x592cbe=localStorage[_0x1e8672(0x2250)]('lastRead_'+_0x24d04a);if(!_0x592cbe)return 0x0;const _0x4c96d3=parseInt(_0x592cbe),_0x5491db=_0x5cd90b[_0x1e8672(0x803)](_0xfcf216=>_0xfcf216[_0x1e8672(0x7aa)]>_0x4c96d3&&_0xfcf216[_0x1e8672(0xf75)]!==_0x1e8672(0x23b2));return _0x5491db['length'];}function markAsRead(_0x4cc40d){const _0x344817=_0x2cf6d4,_0x37414a=Date[_0x344817(0x18e0)]();localStorage[_0x344817(0x2055)](_0x344817(0x109d)+_0x4cc40d,_0x37414a[_0x344817(0x9a3)]());}function loadPinnedConversations(){const _0x4dabce=_0x2cf6d4,_0x2c33b2=localStorage[_0x4dabce(0x2250)](_0x4dabce(0x3dd));pinnedConversations=_0x2c33b2?JSON['parse'](_0x2c33b2):[];}function savePinnedConversations(){const _0x106c13=_0x2cf6d4;localStorage[_0x106c13(0x2055)](_0x106c13(0x3dd),JSON[_0x106c13(0x7fb)](pinnedConversations));}function togglePinConversation(_0x485973){const _0x42275c=_0x2cf6d4,_0x30abcc=pinnedConversations[_0x42275c(0x167a)](_0x485973);_0x30abcc>-0x1?pinnedConversations['splice'](_0x30abcc,0x1):pinnedConversations[_0x42275c(0x6ee)](_0x485973),savePinnedConversations();}function isPinned(_0x220cfa){return pinnedConversations['includes'](_0x220cfa);}async function pinSelectedConversations(){const _0x1ac2dd=_0x2cf6d4;pinnedConversations=[...selectedConversations],savePinnedConversations(),renderMessageList(),exitMessageListMultiSelectMode();const _0x4005e0=selectedConversations[_0x1ac2dd(0xcbf)];showToast(_0x1ac2dd(0x1490)+_0x4005e0+_0x1ac2dd(0x2265),_0x1ac2dd(0xb27));}function renderContactList(){const _0x5b7442=_0x2cf6d4,_0x2a3496=document[_0x5b7442(0x15b8)]('#contact-list\x20.contact-section');if(!_0x2a3496)return;_0x2a3496[_0x5b7442(0xc02)]='';if(isMultiSelectMode){const _0x5da0e3=document['createElement'](_0x5b7442(0x526));_0x5da0e3[_0x5b7442(0x221)]='multiselect-header',_0x5da0e3[_0x5b7442(0xc02)]=_0x5b7442(0x1bef)+selectedCharacters[_0x5b7442(0xcbf)]+_0x5b7442(0xd72),_0x2a3496[_0x5b7442(0x1925)](_0x5da0e3);}if(isGroupManageMode){const _0x5b56bd=document['createElement'](_0x5b7442(0x526));_0x5b56bd[_0x5b7442(0x221)]=_0x5b7442(0x190a),_0x5b56bd['innerHTML']=_0x5b7442(0x1e2a),_0x2a3496[_0x5b7442(0x1925)](_0x5b56bd);}const _0x1af131=characterGroups[_0x5b7442(0x1f0d)]((_0x10f621,_0x41ac3f)=>_0x10f621[_0x5b7442(0x2003)]-_0x41ac3f[_0x5b7442(0x2003)]);_0x1af131['forEach'](_0x326799=>{const _0x284f02=_0x5b7442,_0x3137ec=characters['filter'](_0x5c3cb6=>_0x5c3cb6[_0x284f02(0x1eb)]===_0x326799['id']);if(_0x3137ec['length']===0x0&&!isGroupManageMode)return;const _0x5a27da=document[_0x284f02(0x1ad8)](_0x284f02(0x526));_0x5a27da[_0x284f02(0x221)]=_0x284f02(0xdc4)+(_0x326799[_0x284f02(0x1b5)]?_0x284f02(0x5db):'custom-group');let _0x432910='';_0x326799[_0x284f02(0xd0)]&&!_0x326799['isDefault']&&(_0x432910=_0x284f02(0x899));if(isGroupManageMode)_0x5a27da['innerHTML']=_0x284f02(0x2505)+_0x326799['name']+'\x20('+_0x3137ec[_0x284f02(0xcbf)]+_0x284f02(0x7b5)+_0x432910+_0x284f02(0x2204)+(!_0x326799['isDefault']?'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22editGroup(\x27'+_0x326799['id']+'\x27)\x22\x20class=\x22edit-group-btn\x22\x20title=\x22编辑分组\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-edit\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22deleteGroup(\x27'+_0x326799['id']+'\x27)\x22\x20class=\x22delete-group-btn\x22\x20title=\x22删除分组\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-trash\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20':'')+_0x284f02(0x9ca);else{const _0x18171f=localStorage['getItem'](_0x284f02(0x766)+_0x326799['id'])===_0x284f02(0x8f1);_0x5a27da[_0x284f02(0xc02)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22group-title-area\x22\x20onclick=\x22toggleGroupCollapse(\x27'+_0x326799['id']+_0x284f02(0x1e43)+(_0x18171f?_0x284f02(0x1417):_0x284f02(0x1f2b))+_0x284f02(0xe18)+_0x326799[_0x284f02(0x222f)]+_0x284f02(0x23d4)+_0x432910+_0x284f02(0x256f)+_0x3137ec[_0x284f02(0xcbf)]+'/'+_0x3137ec['length']+_0x284f02(0x14d8);}_0x2a3496[_0x284f02(0x1925)](_0x5a27da);const _0x4cecbf=document['createElement']('div');_0x4cecbf[_0x284f02(0x221)]=_0x284f02(0x2408),_0x4cecbf['id']=_0x284f02(0x337)+_0x326799['id'];const _0x48a46d=localStorage[_0x284f02(0x2250)](_0x284f02(0x766)+_0x326799['id'])===_0x284f02(0x8f1);_0x48a46d&&!isGroupManageMode&&(_0x4cecbf[_0x284f02(0x655)][_0x284f02(0x2526)]=_0x284f02(0xfe9));_0x3137ec[_0x284f02(0x900)](_0x31f5a1=>{const _0x5bfafd=_0x284f02,_0x2598ea=window[_0x5bfafd(0xb08)]&&window[_0x5bfafd(0xb08)][_0x31f5a1['id']]?window[_0x5bfafd(0xb08)][_0x31f5a1['id']]:{},_0x43350f=_0x2598ea['aiChatNickname']||_0x31f5a1[_0x5bfafd(0x222f)],_0x338c57=_0x2598ea['avatarShape']||_0x5bfafd(0x1887),_0x10c847=_0x338c57===_0x5bfafd(0x1fdd)?'\x20rounded-square':'',_0x15c237=document[_0x5bfafd(0x1ad8)](_0x5bfafd(0x526));_0x15c237[_0x5bfafd(0x221)]='contact-item\x20'+(isMultiSelectMode&&selectedCharacters[_0x5bfafd(0x23ec)](_0x31f5a1['id'])?_0x5bfafd(0x876):''),_0x15c237[_0x5bfafd(0x1f26)]['characterId']=_0x31f5a1['id'];if(isMultiSelectMode)_0x15c237['onclick']=()=>toggleCharacterSelection(_0x31f5a1['id']);else{if(isGroupManageMode)_0x15c237[_0x5bfafd(0x11cf)]=()=>showMoveCharacterModal(_0x31f5a1['id']);else{_0x15c237['onclick']=()=>editCharacterFromContactList(_0x31f5a1['id']);let _0x2c1405;const _0x500222=_0x22a73d=>{_0x2c1405=setTimeout(()=>{const _0x4a1883=_0x3a81;showMoveCharacterModal(_0x31f5a1['id']),_0x22a73d[_0x4a1883(0x4d9)]();},0x320);},_0x28a7c0=()=>{clearTimeout(_0x2c1405);};_0x15c237[_0x5bfafd(0x167)](_0x5bfafd(0xf52),_0x500222),_0x15c237[_0x5bfafd(0x167)](_0x5bfafd(0x1263),_0x28a7c0),_0x15c237[_0x5bfafd(0x167)](_0x5bfafd(0x1e8f),_0x28a7c0),_0x15c237['addEventListener'](_0x5bfafd(0xa69),_0x500222),_0x15c237[_0x5bfafd(0x167)](_0x5bfafd(0x1fb0),_0x28a7c0),_0x15c237['addEventListener'](_0x5bfafd(0x1761),_0x28a7c0),_0x15c237[_0x5bfafd(0x167)](_0x5bfafd(0xd3e),_0x3f99f4=>{const _0x2a7cb6=_0x5bfafd;_0x3f99f4[_0x2a7cb6(0x4d9)](),showMoveCharacterModal(_0x31f5a1['id']);});}}let _0x381477='';if(_0x31f5a1[_0x5bfafd(0x4b7)]===!![]){const _0x44fa35=isGroupMuted(_0x31f5a1['id']);_0x44fa35&&(_0x381477=_0x5bfafd(0x114d));}else{const _0x478e51=isBlocked(_0x5bfafd(0x23b2),_0x31f5a1['id']),_0x425137=isBlocked(_0x31f5a1['id'],_0x5bfafd(0x23b2));if(_0x478e51)_0x381477=_0x5bfafd(0x2176);else _0x425137&&(_0x381477=_0x5bfafd(0x32f));}_0x15c237[_0x5bfafd(0xc02)]=_0x5bfafd(0x529)+(isMultiSelectMode?_0x5bfafd(0x12e5)+(selectedCharacters[_0x5bfafd(0x23ec)](_0x31f5a1['id'])?_0x5bfafd(0x876):'')+_0x5bfafd(0x101b)+(selectedCharacters[_0x5bfafd(0x23ec)](_0x31f5a1['id'])?_0x5bfafd(0x1ea1):'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20':'')+_0x5bfafd(0x21fd)+_0x10c847+_0x5bfafd(0x4d7)+_0x31f5a1[_0x5bfafd(0x2099)]+';\x20'+(_0x31f5a1[_0x5bfafd(0x10f9)]?'background-image:\x20url('+_0x31f5a1[_0x5bfafd(0x10f9)]+_0x5bfafd(0x1051):'')+_0x5bfafd(0x1496)+(_0x31f5a1['avatarUrl']?'':_0x43350f['charAt'](0x0))+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contact-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-name\x22>'+_0x43350f+_0x5bfafd(0xa05)+truncateText(_0x31f5a1[_0x5bfafd(0x1a84)]||_0x5bfafd(0xc8f),0x19)+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x381477+_0x5bfafd(0x529)+(isGroupManageMode?_0x5bfafd(0x228b)+_0x31f5a1['id']+_0x5bfafd(0xb06):'')+_0x5bfafd(0xf39),_0x4cecbf[_0x5bfafd(0x1925)](_0x15c237);});if(_0x3137ec['length']===0x0&&isGroupManageMode){const _0x3f9f32=document[_0x284f02(0x1ad8)]('div');_0x3f9f32[_0x284f02(0x221)]='empty-group-message',_0x3f9f32['textContent']=_0x284f02(0x24de),_0x4cecbf['appendChild'](_0x3f9f32);}_0x2a3496[_0x284f02(0x1925)](_0x4cecbf);});if(characters[_0x5b7442(0xcbf)]===0x0){const _0x3ee0e0=document['createElement'](_0x5b7442(0x526));_0x3ee0e0[_0x5b7442(0x221)]=_0x5b7442(0x2225),_0x3ee0e0[_0x5b7442(0x21dc)]=_0x5b7442(0x1598),_0x2a3496[_0x5b7442(0x1925)](_0x3ee0e0);}}function enterGroupManageMode(){const _0x1ebcef=_0x2cf6d4;isGroupManageMode=!![],renderContactList();const _0x56b08d=document[_0x1ebcef(0x566)]('group-manage-btn');_0x56b08d&&(_0x56b08d[_0x1ebcef(0x655)][_0x1ebcef(0x2526)]=_0x1ebcef(0xfe9));}function exitGroupManageMode(){const _0x3b44d1=_0x2cf6d4;isGroupManageMode=![],renderContactList();const _0x51d497=document['getElementById']('group-manage-btn');_0x51d497&&(_0x51d497['style']['display']=_0x3b44d1(0x1f0b));}function toggleGroupCollapse(_0x4c5d8c){const _0x355138=_0x2cf6d4,_0x5d94f6=document[_0x355138(0x566)]('group-characters-'+_0x4c5d8c);if(!_0x5d94f6)return;const _0x1de3a3=_0x5d94f6['style']['display']===_0x355138(0xfe9);_0x5d94f6[_0x355138(0x655)][_0x355138(0x2526)]=_0x1de3a3?_0x355138(0x2d4):_0x355138(0xfe9),localStorage['setItem']('group_collapsed_'+_0x4c5d8c,!_0x1de3a3);const _0x2a1df4=document[_0x355138(0x15b8)](_0x355138(0x1025)+_0x4c5d8c+_0x355138(0x22cf));_0x2a1df4&&(_0x2a1df4[_0x355138(0x221)]=_0x355138(0x15e8)+(_0x1de3a3?_0x355138(0x1f2b):_0x355138(0x1417))+'\x20group-chevron');}function showCreateGroupModal(){const _0x513df6=_0x2cf6d4,_0x4657b0='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22create-group-modal\x22\x20class=\x22modal\x22\x20style=\x22display:\x20flex;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-title\x22>新建分组</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label>分组名称</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20id=\x22new-group-name\x22\x20class=\x22form-input\x22\x20placeholder=\x22请输入分组名称\x22\x20maxlength=\x2210\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22checkbox\x22\x20id=\x22new-group-interaction\x22\x20class=\x22form-checkbox\x22\x20checked>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20允许该分组角色在动态中互动\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22form-help-text\x22>开启后，该分组的角色可以在动态页面相互点赞、评论。<br>关闭后仍可在发布动态时选择该分组作为可见范围。</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-button\x20modal-secondary\x22\x20onclick=\x22hideCreateGroupModal()\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-button\x20modal-primary\x22\x20onclick=\x22createNewGroup()\x22>创建</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';document[_0x513df6(0x172c)]['insertAdjacentHTML'](_0x513df6(0x580),_0x4657b0),setTimeout(()=>{const _0x4b5cf3=_0x513df6;document[_0x4b5cf3(0x566)](_0x4b5cf3(0x1a37))[_0x4b5cf3(0x1b12)]();},0x64);}function hideCreateGroupModal(){const _0x1fdedc=_0x2cf6d4,_0x1cd2c8=document['getElementById'](_0x1fdedc(0x1b5f));if(_0x1cd2c8)_0x1cd2c8[_0x1fdedc(0x128)]();}async function createNewGroup(){const _0x4da0b5=_0x2cf6d4,_0x5914cb=document[_0x4da0b5(0x566)]('new-group-name'),_0x36faa3=document['getElementById'](_0x4da0b5(0xd3b)),_0x1df976=_0x5914cb[_0x4da0b5(0xc34)]['trim']();if(!_0x1df976){alert(_0x4da0b5(0x1002)),_0x5914cb[_0x4da0b5(0x1b12)]();return;}if(characterGroups[_0x4da0b5(0x1aeb)](_0x4c5ff6=>_0x4c5ff6[_0x4da0b5(0x222f)]===_0x1df976)){alert(_0x4da0b5(0x3bb)),_0x5914cb[_0x4da0b5(0x1b12)]();return;}const _0x3a0f61={'id':_0x4da0b5(0x74a)+Date[_0x4da0b5(0x18e0)](),'name':_0x1df976,'order':characterGroups[_0x4da0b5(0xcbf)]+0x1,'isDefault':![],'canInteract':_0x36faa3['checked']};characterGroups[_0x4da0b5(0x6ee)](_0x3a0f61),await saveCharacterGroups(),hideCreateGroupModal(),renderContactList(),showToast(_0x4da0b5(0x1d39),_0x4da0b5(0xb27));}function editGroup(_0x152814){const _0x11f51d=_0x2cf6d4,_0x44df02=characterGroups['find'](_0x493bba=>_0x493bba['id']===_0x152814);if(!_0x44df02||_0x44df02['isDefault'])return;const _0x3635f2=_0x11f51d(0x185f)+_0x44df02[_0x11f51d(0x222f)]+_0x11f51d(0x126)+(_0x44df02['canInteract']?_0x11f51d(0x306):'')+_0x11f51d(0x1a26)+_0x152814+_0x11f51d(0x99f);document[_0x11f51d(0x172c)]['insertAdjacentHTML']('beforeend',_0x3635f2),setTimeout(()=>{const _0x5ed698=_0x11f51d;document['getElementById']('edit-group-name')[_0x5ed698(0x1b12)]();},0x64);}function hideEditGroupModal(){const _0x189608=_0x2cf6d4,_0x362fe3=document['getElementById'](_0x189608(0x1da1));if(_0x362fe3)_0x362fe3[_0x189608(0x128)]();}async function updateGroup(_0x561531){const _0x251f89=_0x2cf6d4,_0x25e27f=document['getElementById'](_0x251f89(0xe82)),_0x335aa2=document[_0x251f89(0x566)](_0x251f89(0x4ae)),_0x56c375=_0x25e27f[_0x251f89(0xc34)][_0x251f89(0x1424)]();if(!_0x56c375){alert(_0x251f89(0x1002)),_0x25e27f[_0x251f89(0x1b12)]();return;}if(characterGroups[_0x251f89(0x1aeb)](_0x1fafb5=>_0x1fafb5[_0x251f89(0x222f)]===_0x56c375&&_0x1fafb5['id']!==_0x561531)){alert('分组名称已存在'),_0x25e27f[_0x251f89(0x1b12)]();return;}const _0x15e5be=characterGroups[_0x251f89(0x23ba)](_0x210992=>_0x210992['id']===_0x561531);_0x15e5be!==-0x1&&(characterGroups[_0x15e5be][_0x251f89(0x222f)]=_0x56c375,characterGroups[_0x15e5be][_0x251f89(0xd0)]=_0x335aa2[_0x251f89(0x306)],await saveCharacterGroups(),hideEditGroupModal(),renderContactList(),showToast('分组更新成功','success'));}async function deleteGroup(_0x21ef9e){const _0x194a76=_0x2cf6d4,_0x1172d0=characterGroups[_0x194a76(0x1aeb)](_0x54b68c=>_0x54b68c['id']===_0x21ef9e);if(!_0x1172d0||_0x1172d0['isDefault'])return;const _0x450d44=characters[_0x194a76(0x803)](_0x45efdd=>_0x45efdd[_0x194a76(0x1eb)]===_0x21ef9e);let _0x2f9623=_0x194a76(0x1bf6)+_0x1172d0[_0x194a76(0x222f)]+'\x22吗？';_0x450d44['length']>0x0&&(_0x2f9623+=_0x194a76(0x1750)+_0x450d44[_0x194a76(0xcbf)]+_0x194a76(0x20ca));if(!confirm(_0x2f9623))return;_0x450d44['forEach'](_0x1a3b7a=>{const _0x2b6d99=_0x194a76;_0x1a3b7a[_0x2b6d99(0x1eb)]='my_friends';});const _0x16c950=characterGroups[_0x194a76(0x23ba)](_0x140a89=>_0x140a89['id']===_0x21ef9e);_0x16c950!==-0x1&&characterGroups[_0x194a76(0x220f)](_0x16c950,0x1),await Promise[_0x194a76(0x2339)]([saveCharacterGroups(),saveCharacters()]),renderContactList(),showToast(_0x194a76(0x1b6d),_0x194a76(0xb27));}function showMoveCharacterModal(_0x42eef1){const _0x4075b5=_0x2cf6d4,_0x26cc7f=characters[_0x4075b5(0x1aeb)](_0x529d08=>_0x529d08['id']===_0x42eef1);if(!_0x26cc7f)return;const _0x14213e=characterGroups[_0x4075b5(0x803)](_0x16cdb7=>_0x16cdb7['id']!==_0x26cc7f[_0x4075b5(0x1eb)]),_0x3229d0=_0x4075b5(0x5f5)+_0x26cc7f['name']+_0x4075b5(0x185d)+_0x14213e[_0x4075b5(0xf6d)](_0x156a1b=>_0x4075b5(0x17bf)+_0x42eef1+'\x27,\x20\x27'+_0x156a1b['id']+'\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22group-name\x22>'+_0x156a1b[_0x4075b5(0x222f)]+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-chevron-right\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20')[_0x4075b5(0x140c)]('')+_0x4075b5(0x1bd3)+_0x42eef1+_0x4075b5(0xfb7);document[_0x4075b5(0x172c)][_0x4075b5(0x22ba)](_0x4075b5(0x580),_0x3229d0);}function hideMoveCharacterModal(){const _0x48115a=_0x2cf6d4,_0x17d196=document['getElementById']('move-character-modal');if(_0x17d196)_0x17d196[_0x48115a(0x128)]();}async function moveCharacterToGroup(_0x2d5270,_0x3407ee){const _0x2f5337=_0x2cf6d4,_0x238d05=characters[_0x2f5337(0x23ba)](_0x58f8f0=>_0x58f8f0['id']===_0x2d5270);if(_0x238d05!==-0x1){const _0x8b87ed=characters[_0x238d05][_0x2f5337(0x1eb)];characters[_0x238d05]['groupId']=_0x3407ee,await saveCharacters(),hideMoveCharacterModal(),renderContactList();const _0x391dd7=characterGroups[_0x2f5337(0x1aeb)](_0x6d2c0d=>_0x6d2c0d['id']===_0x3407ee);showToast(_0x2f5337(0x7ee)+_0x391dd7[_0x2f5337(0x222f)]+'\x22分组',_0x2f5337(0xb27));}}function showMoveToGroupModal(){const _0x13b9dd=_0x2cf6d4;if(selectedCharacters['length']===0x0){alert(_0x13b9dd(0x121b));return;}const _0x2a2960=_0x13b9dd(0x2018)+selectedCharacters[_0x13b9dd(0xcbf)]+_0x13b9dd(0x17d6)+characterGroups[_0x13b9dd(0xf6d)](_0xa22f0a=>_0x13b9dd(0x453)+_0xa22f0a['id']+'\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22group-name\x22>'+_0xa22f0a['name']+_0x13b9dd(0x1885))[_0x13b9dd(0x140c)]('')+_0x13b9dd(0x102d);document[_0x13b9dd(0x172c)][_0x13b9dd(0x22ba)]('beforeend',_0x2a2960);}function hideMoveToGroupModal(){const _0x547f2c=_0x2cf6d4,_0x4c445f=document[_0x547f2c(0x566)]('move-to-group-modal');if(_0x4c445f)_0x4c445f['remove']();}async function moveSelectedCharactersToGroup(_0x5af18d){const _0x4458b7=_0x2cf6d4;selectedCharacters['forEach'](_0x3396ca=>{const _0x3d696e=_0x3a81,_0xe4ea37=characters[_0x3d696e(0x23ba)](_0x94151c=>_0x94151c['id']===_0x3396ca);_0xe4ea37!==-0x1&&(characters[_0xe4ea37][_0x3d696e(0x1eb)]=_0x5af18d);}),await saveCharacters(),hideMoveToGroupModal(),exitMultiSelectMode();const _0x6a002d=characterGroups[_0x4458b7(0x1aeb)](_0x50d849=>_0x50d849['id']===_0x5af18d);showToast(_0x4458b7(0xb5b)+selectedCharacters[_0x4458b7(0xcbf)]+_0x4458b7(0x7d1)+_0x6a002d['name']+'\x22分组',_0x4458b7(0xb27));}function renderCharacterList(){const _0x2fabf5=_0x2cf6d4,_0x497070=document[_0x2fabf5(0x566)](_0x2fabf5(0x1fb));if(!_0x497070){console[_0x2fabf5(0xc0d)](_0x2fabf5(0x1859));return;}_0x497070[_0x2fabf5(0xc02)]='',characters[_0x2fabf5(0x900)](_0x263baf=>{const _0x4a587b=_0x2fabf5,_0x17045f=document[_0x4a587b(0x1ad8)](_0x4a587b(0x526));_0x17045f[_0x4a587b(0x221)]=_0x4a587b(0x68f),_0x17045f[_0x4a587b(0x11cf)]=()=>editCharacter(_0x263baf['id']),_0x17045f[_0x4a587b(0xc02)]=_0x4a587b(0x681)+_0x263baf[_0x4a587b(0x2099)]+';\x20'+(_0x263baf[_0x4a587b(0x10f9)]?_0x4a587b(0x1910)+_0x263baf[_0x4a587b(0x10f9)]+_0x4a587b(0x1051):'')+_0x4a587b(0x2105)+(_0x263baf['avatarUrl']?'':_0x263baf[_0x4a587b(0x222f)][_0x4a587b(0x1518)](0x0))+_0x4a587b(0x878)+_0x263baf['name']+_0x4a587b(0x1cd6)+truncateText(_0x263baf[_0x4a587b(0x1a84)],0x32)+_0x4a587b(0x92d),_0x497070['appendChild'](_0x17045f);});}let currentMessageOffset=0x0;const MESSAGE_LIMIT=0x32;function renderChatMessages(_0x350f3a,_0x20ab76=![]){renderChatMessagesAsync(_0x350f3a,_0x20ab76)['catch'](_0x21add0=>{const _0x2be77a=_0x3a81;console[_0x2be77a(0x24ab)](_0x2be77a(0x1a7d),_0x21add0);});}function addBubbleTail(_0x3d0e61,_0x40b3da){const _0x3c4682=_0x2cf6d4,_0x401067=document[_0x3c4682(0x15b8)](_0x3c4682(0xedf));if(!_0x401067||!_0x401067[_0x3c4682(0x226e)][_0x3c4682(0x1f9)](_0x3c4682(0xef2)))return;const _0x270f45=_0x3d0e61['querySelector'](_0x3c4682(0x37c));if(!_0x270f45)return;const _0x233daa=document[_0x3c4682(0x1ad8)](_0x3c4682(0x526));_0x233daa[_0x3c4682(0x221)]=_0x3c4682(0x1cd0),_0x233daa[_0x3c4682(0x655)][_0x3c4682(0x17a3)]=_0x3c4682(0x66f);if(_0x40b3da[_0x3c4682(0xf75)]===_0x3c4682(0x232))_0x233daa[_0x3c4682(0x655)][_0x3c4682(0x17a3)]+='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left:\x20-8px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20top:\x2010px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-width:\x200\x208px\x2010px\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-color:\x20transparent\x20'+getComputedStyle(_0x270f45)['backgroundColor']+_0x3c4682(0x11b5);else _0x40b3da['sender']===_0x3c4682(0xfda)&&(_0x233daa[_0x3c4682(0x655)][_0x3c4682(0x17a3)]+='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20right:\x20-8px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20top:\x2010px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-width:\x2010px\x208px\x200\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-color:\x20'+getComputedStyle(_0x270f45)[_0x3c4682(0xacd)]+_0x3c4682(0xfdd));_0x270f45[_0x3c4682(0x1925)](_0x233daa);}async function renderChatMessagesAsync(_0x2d86f9,_0x5579d4=![]){const _0x379f2f=_0x2cf6d4,_0x2d230e=document['getElementById'](_0x379f2f(0x24e7)),_0x49d207=chatMessages[_0x2d86f9]||[],_0x36bd7c=await getAsyncChatSettings(_0x2d86f9);if(!_0x5579d4){_0x2d230e[_0x379f2f(0xc02)]='';const _0x7fc1b1=getCurrentChatSettings(),_0x50b80b=_0x7fc1b1[_0x379f2f(0x14f7)]===!![],_0x1f53a3=_0x49d207[_0x379f2f(0x803)](_0xc24bdc=>{const _0x494a3a=_0x379f2f;if(_0xc24bdc[_0x494a3a(0x2022)]||_0xc24bdc['isGameContext'])return![];if(_0xc24bdc[_0x494a3a(0x14ad)]&&!_0x50b80b)return![];return!![];});currentMessageOffset=Math[_0x379f2f(0x910)](0x0,_0x1f53a3['length']-MESSAGE_LIMIT);}applyChatBackground(undefined,!![]),applyBubbleStyle();if(_0x49d207['length']===0x0){const _0x301bd3=_0x36bd7c[_0x379f2f(0x1967)]||currentChatCharacter[_0x379f2f(0x222f)],_0x4c2305=document[_0x379f2f(0x1ad8)](_0x379f2f(0x526));_0x4c2305[_0x379f2f(0x221)]=_0x379f2f(0x14af),_0x4c2305[_0x379f2f(0xc02)]=_0x379f2f(0x431)+_0x301bd3+_0x379f2f(0xe1c),_0x2d230e[_0x379f2f(0x1925)](_0x4c2305);return;}if(!_0x5579d4&&currentMessageOffset>0x0){const _0xa24573=document['createElement']('div');_0xa24573[_0x379f2f(0x221)]=_0x379f2f(0xd1d),_0xa24573[_0x379f2f(0xc02)]=_0x379f2f(0x1c93)+currentMessageOffset+_0x379f2f(0x949),_0xa24573[_0x379f2f(0x11cf)]=()=>loadMoreMessages(_0x2d86f9),_0x2d230e[_0x379f2f(0x1925)](_0xa24573);}const _0x3a4a55=getCurrentChatSettings(),_0x254ef2=_0x3a4a55[_0x379f2f(0x14f7)]===!![],_0x5f14fb=_0x49d207[_0x379f2f(0x803)](_0x3636b3=>{const _0x5fa45d=_0x379f2f;if(_0x3636b3[_0x5fa45d(0x2022)]||_0x3636b3[_0x5fa45d(0x15ca)])return![];if(_0x3636b3[_0x5fa45d(0x14ad)]&&!_0x254ef2)return![];return!![];}),_0xce4ba5=_0x5579d4?Math['max'](0x0,_0x5f14fb[_0x379f2f(0xcbf)]-MESSAGE_LIMIT):Math['max'](0x0,_0x5f14fb[_0x379f2f(0xcbf)]-MESSAGE_LIMIT),_0x55db9d=_0x5579d4?_0x5f14fb[_0x379f2f(0x136)](Math['max'](0x0,_0xce4ba5-MESSAGE_LIMIT),_0xce4ba5):_0x5f14fb[_0x379f2f(0x136)](_0xce4ba5),_0x41d74d=_0x36bd7c[_0x379f2f(0x9c1)]!==![],_0x47214c=_0x36bd7c[_0x379f2f(0x19ec)]||_0x379f2f(0x23a1);let _0x2d70e9=0x0;_0x55db9d[_0x379f2f(0x900)]((_0x17f570,_0xc3502e)=>{const _0x495b91=_0x379f2f;if(_0x17f570[_0x495b91(0xf75)]===_0x495b91(0x212)){if(_0x17f570['isPoke']){const _0x369022=document[_0x495b91(0x1ad8)]('div');_0x369022[_0x495b91(0x221)]='poke-system-container';const _0x2201cb=document[_0x495b91(0x1ad8)](_0x495b91(0x526));_0x2201cb[_0x495b91(0x221)]='poke-system-message',_0x2201cb['textContent']=_0x17f570[_0x495b91(0x1423)],_0x369022[_0x495b91(0x1925)](_0x2201cb),_0x2d230e[_0x495b91(0x1925)](_0x369022);}else{if(_0x17f570['type']===_0x495b91(0x1cbd)){const _0x538fdd=document[_0x495b91(0x1ad8)](_0x495b91(0x526));_0x538fdd[_0x495b91(0x655)][_0x495b91(0x2526)]='flex',_0x538fdd['style'][_0x495b91(0x1571)]='center',_0x538fdd[_0x495b91(0x655)]['margin']=_0x495b91(0x23dd),_0x538fdd[_0x495b91(0x1f26)][_0x495b91(0x61f)]=_0x17f570['id'];const _0x9eaa22=document[_0x495b91(0x1ad8)](_0x495b91(0x526));_0x9eaa22[_0x495b91(0x221)]=_0x495b91(0x22fd),_0x9eaa22[_0x495b91(0x655)]['cssText']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#999;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x204px\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20rgba(0,0,0,0.05);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20max-width:\x2080%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20text-align:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';const _0x4a9297=typeof _0x17f570[_0x495b91(0x1423)]===_0x495b91(0xb97)?_0x17f570[_0x495b91(0x1423)]:_0x17f570[_0x495b91(0x1423)]&&typeof _0x17f570['content']==='object'?JSON['stringify'](_0x17f570['content']):String(_0x17f570['content']||'');_0x9eaa22['textContent']=_0x4a9297,typeof _0x17f570['content']!==_0x495b91(0xb97)&&console['warn']('🔍\x20[system_notification]\x20发现非字符串content:',{'messageId':_0x17f570['id'],'contentType':typeof _0x17f570['content'],'content':_0x17f570['content']}),_0x538fdd['appendChild'](_0x9eaa22),_0x2d230e['appendChild'](_0x538fdd);}else{if(_0x17f570[_0x495b91(0x23df)]===_0x495b91(0x1e4b)){const _0x437762=document[_0x495b91(0x1ad8)]('div');_0x437762[_0x495b91(0x655)][_0x495b91(0x2526)]=_0x495b91(0x1f0b),_0x437762[_0x495b91(0x655)][_0x495b91(0x1571)]=_0x495b91(0x23a1),_0x437762[_0x495b91(0x655)]['margin']=_0x495b91(0x23dd),_0x437762[_0x495b91(0x1f26)][_0x495b91(0x61f)]=_0x17f570['id'];const _0x33f923=document['createElement'](_0x495b91(0x526));_0x33f923[_0x495b91(0x221)]=_0x495b91(0x11af);const _0x507aca=_0x17f570['content'][_0x495b91(0x633)]('\x0a'),_0x569230=_0x507aca[0x0];let _0x662ad7=_0x507aca[0x1];_0x33f923[_0x495b91(0x21dc)]=_0x569230;if(_0x662ad7){if(_0x662ad7[_0x495b91(0x1cab)]('原文：')){const _0x237078=document[_0x495b91(0x1ad8)]('div');_0x237078[_0x495b91(0x221)]=_0x495b91(0x7a8),_0x237078[_0x495b91(0x21dc)]=_0x662ad7,_0x33f923[_0x495b91(0x1925)](_0x237078);}else{const _0x3e3ddf=document[_0x495b91(0x1ad8)](_0x495b91(0x526));_0x3e3ddf[_0x495b91(0x221)]=_0x495b91(0x7a8),_0x3e3ddf['textContent']=_0x495b91(0xce4)+_0x662ad7,_0x33f923['appendChild'](_0x3e3ddf);}}else{if(_0x17f570[_0x495b91(0x1739)]){const _0x44f320=document['createElement'](_0x495b91(0x526));_0x44f320[_0x495b91(0x221)]=_0x495b91(0x7a8),_0x44f320[_0x495b91(0x21dc)]=_0x495b91(0xce4)+_0x17f570['originalContent'],_0x33f923['appendChild'](_0x44f320);}}_0x437762[_0x495b91(0x1925)](_0x33f923),_0x2d230e['appendChild'](_0x437762),addMessageLongPressListener(_0x437762,_0x17f570['id']);}else{if(_0x17f570[_0x495b91(0x23df)]===_0x495b91(0x1776)){const _0x2ceb92=document['createElement'](_0x495b91(0x526));_0x2ceb92[_0x495b91(0x221)]=_0x495b91(0x1b4e),_0x2ceb92['dataset'][_0x495b91(0x61f)]=_0x17f570['id'];const _0x4adae3=document[_0x495b91(0x1ad8)]('div');_0x4adae3['className']=_0x495b91(0x1e1c),_0x4adae3['style'][_0x495b91(0xd2d)]=_0x495b91(0x23a1),_0x4adae3[_0x495b91(0x655)][_0x495b91(0x2099)]=_0x495b91(0xb6c),_0x4adae3['style'][_0x495b91(0x1ae6)]=_0x495b91(0x1e08),_0x4adae3[_0x495b91(0x655)]['padding']=_0x495b91(0x1c05),_0x4adae3['textContent']=_0x17f570['content'],_0x2ceb92[_0x495b91(0x1925)](_0x4adae3),_0x2d230e['appendChild'](_0x2ceb92),addMessageLongPressListener(_0x2ceb92,_0x17f570['id']);}else{if(_0x17f570[_0x495b91(0x23df)]===_0x495b91(0xc11)){const _0x384529=document['createElement'](_0x495b91(0x526));_0x384529['className']=_0x495b91(0x1b4e),_0x384529[_0x495b91(0x1f26)][_0x495b91(0x61f)]=_0x17f570['id'];const _0x29a3b5=document[_0x495b91(0x1ad8)](_0x495b91(0x526));_0x29a3b5[_0x495b91(0x221)]=_0x495b91(0xaf4),_0x29a3b5[_0x495b91(0x655)][_0x495b91(0x2099)]='#888',_0x29a3b5[_0x495b91(0x655)][_0x495b91(0x1ae6)]=_0x495b91(0x1e08),_0x29a3b5['style'][_0x495b91(0xd2d)]=_0x495b91(0x23a1),_0x29a3b5[_0x495b91(0x655)][_0x495b91(0x856)]=_0x495b91(0x1c05),_0x29a3b5[_0x495b91(0x21dc)]=_0x17f570[_0x495b91(0x1423)],_0x384529[_0x495b91(0x1925)](_0x29a3b5),_0x2d230e[_0x495b91(0x1925)](_0x384529),addMessageLongPressListener(_0x384529,_0x17f570['id']);}else{const _0x4e342d=document[_0x495b91(0x1ad8)](_0x495b91(0x526));_0x4e342d[_0x495b91(0x655)][_0x495b91(0x2526)]=_0x495b91(0x1f0b),_0x4e342d[_0x495b91(0x655)][_0x495b91(0x1571)]='center',_0x4e342d[_0x495b91(0x655)]['margin']='4px\x200';const _0x4e2d11=document[_0x495b91(0x1ad8)](_0x495b91(0x526));_0x17f570['isFriendAddedMessage']?_0x4e2d11[_0x495b91(0x221)]='friend-added-system-message':_0x4e2d11[_0x495b91(0x221)]=_0x495b91(0x21a7),_0x4e2d11['textContent']=_0x17f570[_0x495b91(0x1423)],_0x4e342d['appendChild'](_0x4e2d11),_0x2d230e[_0x495b91(0x1925)](_0x4e342d);}}}}}return;}if(_0x41d74d&&_0x47214c==='center'){const _0x3c05f8=new Date(_0x17f570[_0x495b91(0x7aa)]),_0x32d091=_0x3c05f8-_0x2d70e9;if(_0xc3502e===0x0||_0x32d091>0x5*0x3c*0x3e8){const _0x525ed0=document[_0x495b91(0x1ad8)](_0x495b91(0x526));_0x525ed0['className']=_0x495b91(0x14db),_0x525ed0[_0x495b91(0x21dc)]=formatTimestamp(_0x17f570['timestamp']),_0x2d230e[_0x495b91(0x1925)](_0x525ed0),_0x2d70e9=_0x3c05f8;}}const _0x20013e=document['createElement'](_0x495b91(0x526)),_0xb53f63=_0x17f570['isEmoji']&&!_0x17f570[_0x495b91(0x1423)];_0x20013e['className']=_0x495b91(0x51a)+_0x17f570[_0x495b91(0xf75)]+(_0x36bd7c[_0x495b91(0x1e22)]?_0x495b91(0x2125):'')+(_0xb53f63?_0x495b91(0x6b4):'')+(_0x41d74d&&_0x47214c===_0x495b91(0x107f)?_0x495b91(0x17ad):''),_0x20013e[_0x495b91(0x1f26)][_0x495b91(0x61f)]=_0x17f570['id'];if(_0x17f570[_0x495b91(0xf75)]===_0x495b91(0x232)){let _0x1387de=characters[_0x495b91(0x1aeb)](_0x36a48d=>_0x36a48d['id']===_0x2d86f9),_0x3c4a16=![],_0x14673a=null;!_0x1387de&&(_0x14673a=groupChats[_0x495b91(0x1aeb)](_0x4119e3=>_0x4119e3['id']===_0x2d86f9),_0x14673a&&(_0x3c4a16=!![]));let _0xca050d='',_0x33ce9c='',_0x1993e0=_0x495b91(0x23b8),_0x582cf2=null;if(_0x3c4a16&&_0x14673a){console[_0x495b91(0xc0d)](_0x495b91(0xaa2),_0x17f570[_0x495b91(0x210b)],_0x495b91(0x5fb),_0x17f570[_0x495b91(0x222f)]),console[_0x495b91(0xc0d)](_0x495b91(0xa75),_0x14673a['members']),console[_0x495b91(0xc0d)](_0x495b91(0x189b),_0x17f570);if(_0x17f570[_0x495b91(0x210b)])_0x582cf2=_0x14673a[_0x495b91(0xcaa)][_0x495b91(0x1aeb)](_0x26b6cf=>_0x26b6cf['id']===_0x17f570[_0x495b91(0x210b)]),console[_0x495b91(0xc0d)]('🔍\x20[消息渲染]\x20通过senderId找到成员:',_0x582cf2),console[_0x495b91(0xc0d)](_0x495b91(0x2331),{'messageSenderId':_0x17f570[_0x495b91(0x210b)],'memberIds':_0x14673a[_0x495b91(0xcaa)][_0x495b91(0xf6d)](_0x16f6c6=>_0x16f6c6['id']),'foundMember':_0x582cf2});else _0x17f570[_0x495b91(0x222f)]&&(_0x582cf2=_0x14673a[_0x495b91(0xcaa)][_0x495b91(0x1aeb)](_0x290490=>_0x290490['name']===_0x17f570[_0x495b91(0x222f)]),console[_0x495b91(0xc0d)](_0x495b91(0x1adf),_0x582cf2),console[_0x495b91(0xc0d)](_0x495b91(0xb64),{'messageName':_0x17f570[_0x495b91(0x222f)],'memberNames':_0x14673a['members']['map'](_0x35c51a=>_0x35c51a['name']),'foundMember':_0x582cf2}));_0x582cf2?(_0xca050d=_0x582cf2[_0x495b91(0x10f9)]||'',_0x33ce9c=_0x582cf2[_0x495b91(0x222f)],_0x1993e0=_0x582cf2[_0x495b91(0x2099)]||_0x495b91(0x23b8)):(_0xca050d='',_0x33ce9c=_0x17f570[_0x495b91(0x222f)]||'群成员',_0x1993e0=_0x495b91(0x23b8),console[_0x495b91(0x17cc)]('🔍\x20[消息渲染]\x20未找到群成员，使用消息name:',_0x17f570[_0x495b91(0x222f)]));}else _0x1387de?(_0xca050d=_0x36bd7c['aiChatAvatar']||_0x1387de['avatarUrl'],_0x33ce9c=_0x36bd7c[_0x495b91(0x1967)]||_0x1387de['name'],_0x1993e0=_0x1387de[_0x495b91(0x2099)]||'#4CAF50'):(_0xca050d='',_0x33ce9c='未知',_0x1993e0=_0x495b91(0x23b8));let _0x286e03=_0x36bd7c[_0x495b91(0x2116)]||_0x495b91(0x1679);if(_0x3c4a16&&_0x14673a&&_0x17f570['senderId']&&_0x36bd7c['memberBubbleColors']){const _0x517cd3=_0x36bd7c['memberBubbleColors'][_0x17f570[_0x495b91(0x210b)]];_0x517cd3&&(_0x286e03=_0x517cd3);}const _0x1abd9e=_0x36bd7c[_0x495b91(0xaf0)]||'1',_0xdfd1f4=isLightColor(_0x286e03)?_0x495b91(0x194f):_0x495b91(0x18a7),_0x46763f=_0x36bd7c[_0x495b91(0x1068)]||'12',_0x41544c=convertColorWithOpacity(_0x286e03,_0x1abd9e);let _0x6d33ec='';if(_0x17f570[_0x495b91(0x23df)]==='user_photo')_0x6d33ec=_0x495b91(0x106d)+(_0x17f570[_0x495b91(0x18cb)]||_0x17f570['content'])['replace'](/'/g,'\x5c\x27')[_0x495b91(0x882)](/"/g,_0x495b91(0xca))+_0x495b91(0x1651)+(_0x17f570[_0x495b91(0x18cb)]||_0x17f570[_0x495b91(0x1423)])+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';else{if(_0x17f570[_0x495b91(0x23df)]===_0x495b91(0x63b))_0x6d33ec=_0x495b91(0xea7)+_0x17f570[_0x495b91(0xf7e)]+_0x495b91(0x50d)+_0x17f570['locationName']+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22location-card-map\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22map-background\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22map-roads\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22road\x20road-horizontal\x22\x20style=\x22top:\x2035%;\x20width:\x20100%;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22road\x20road-vertical\x22\x20style=\x22left:\x2040%;\x20height:\x20100%;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22road\x20road-horizontal\x22\x20style=\x22top:\x2065%;\x20width:\x2070%;\x20left:\x2030%;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22map-buildings\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22building\x22\x20style=\x22top:\x2015%;\x20left:\x2020%;\x20width:\x2012px;\x20height:\x2010px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22building\x22\x20style=\x22top:\x2025%;\x20left:\x2060%;\x20width:\x2014px;\x20height:\x2012px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22building\x20green\x22\x20style=\x22top:\x2050%;\x20left:\x2015%;\x20width:\x208px;\x20height:\x208px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22building\x22\x20style=\x22top:\x2070%;\x20left:\x2070%;\x20width:\x2010px;\x20height:\x208px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22building\x20green\x22\x20style=\x22top:\x2010%;\x20left:\x2075%;\x20width:\x206px;\x20height:\x206px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22building\x20green\x22\x20style=\x22top:\x2075%;\x20left:\x2025%;\x20width:\x207px;\x20height:\x207px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22map-marker\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22marker-pin\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20width=\x2220\x22\x20height=\x2220\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M12\x202C8.13\x202\x205\x205.13\x205\x209c0\x205.25\x207\x2013\x207\x2013s7-7.75\x207-13c0-3.87-3.13-7-7-7zm0\x209.5c-1.38\x200-2.5-1.12-2.5-2.5s1.12-2.5\x202.5-2.5\x202.5\x201.12\x202.5\x202.5-1.12\x202.5-2.5\x202.5z\x22\x20fill=\x22#1890ff\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';else{if(_0x17f570[_0x495b91(0x23df)]===_0x495b91(0x1bfd)){const _0x3450e0=_0x17f570[_0x495b91(0x1423)][_0x495b91(0x882)](/\([^)]*\)\s*/g,'')[_0x495b91(0x1424)](),_0x4f0b51=_0x17f570[_0x495b91(0x1ff)]||Math[_0x495b91(0x910)](0x1,Math[_0x495b91(0x1462)](_0x3450e0[_0x495b91(0xcbf)]/0x8));_0x6d33ec='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-message-container\x20received\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-bubble\x22\x20style=\x22background-color:\x20'+_0x41544c+_0x495b91(0x1ad7)+_0xdfd1f4+_0x495b91(0x1de5)+_0x46763f+'px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-message\x22\x20onclick=\x22toggleVoiceText(this)\x22\x20data-text=\x22'+_0x3450e0+_0x495b91(0x24da)+_0x4f0b51+_0x495b91(0x1f37)+_0x3450e0+_0x495b91(0x931);}else{if(_0x17f570[_0x495b91(0x23df)]===_0x495b91(0xb93)){const _0x5a17db=_0x17f570[_0x495b91(0x18d1)]||_0x17f570[_0x495b91(0x1423)]||_0x495b91(0x44e);_0x6d33ec=_0x495b91(0x106d)+_0x5a17db['replace'](/'/g,'\x5c\x27')[_0x495b91(0x882)](/"/g,'&quot;')+'\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22dreamy-photo\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22photo-misty-bg\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22photo-badge\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-image\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sparkle-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sparkle\x20sparkle-1\x22>✨</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sparkle\x20sparkle-2\x22>⭐</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sparkle\x20sparkle-3\x22>✨</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sparkle\x20sparkle-4\x22>⭐</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sparkle\x20sparkle-5\x22>💫</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22photo-text-overlay\x22\x20style=\x22display:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22photo-description\x22>'+_0x5a17db+_0x495b91(0x10dc);}else{if(_0x17f570['type']==='transfer'){const _0x391e22=_0x17f570['role']==='user',_0x337d8e=_0x391e22?'💕':'💖',_0x280338=_0x391e22?_0x495b91(0xe7f):_0x495b91(0x1169);let _0x430fb6='',_0x7f6fb8='',_0x2166ab='';if(_0x17f570[_0x495b91(0xe54)]===_0x495b91(0x15d2))_0x7f6fb8=_0x495b91(0x1f14)+(_0x391e22?'对方已收款':_0x495b91(0x1dde))+_0x495b91(0xa54),_0x430fb6='accepted';else{if(_0x17f570[_0x495b91(0xe54)]===_0x495b91(0x1164))_0x7f6fb8=_0x495b91(0x1f14)+(_0x391e22?'对方已退回':_0x495b91(0x939))+_0x495b91(0xa54),_0x430fb6=_0x495b91(0x1164);else!_0x391e22&&(_0x2166ab=_0x495b91(0x120e)+JSON['stringify'](_0x17f570)['replace'](/"/g,_0x495b91(0xca))+')\x22');}_0x6d33ec=_0x495b91(0x22b1)+_0x430fb6+'\x22\x20data-transfer-id=\x22'+_0x17f570[_0x495b91(0x7aa)]+'\x22\x20'+_0x2166ab+_0x495b91(0x1b4)+_0x337d8e+'\x20'+_0x280338+_0x495b91(0x1824)+Number(_0x17f570['amount'])[_0x495b91(0x3cd)](0x2)+_0x495b91(0x745)+(_0x17f570[_0x495b91(0x15fe)]||'转账')+_0x495b91(0x1e0f)+_0x7f6fb8+_0x495b91(0xdbd);}else{if(_0x17f570[_0x495b91(0x23df)]===_0x495b91(0x14f2)){let _0x2f9d23;if(_0x17f570[_0x495b91(0xcc9)]){const _0x42d4e1=_0x17f570[_0x495b91(0xe45)]?_0x495b91(0x5e0):_0x495b91(0x8a7),_0x38fb26=_0x17f570[_0x495b91(0xe45)]?'accepted':_0x495b91(0x1164);_0x2f9d23=_0x495b91(0x93e)+_0x38fb26+'\x22>'+_0x42d4e1+_0x495b91(0xa54),console[_0x495b91(0xc0d)]('🔄\x20渲染已处理的好友申请:',_0x17f570['id'],_0x42d4e1);}else _0x2f9d23=_0x495b91(0x21a4)+currentChatCharacter?.['id']+_0x495b91(0x2525)+_0x17f570['id']+_0x495b91(0x22ae)+currentChatCharacter?.['id']+_0x495b91(0x1f0c)+_0x17f570['id']+_0x495b91(0x1087),console[_0x495b91(0xc0d)](_0x495b91(0x81c),_0x17f570['id']);_0x6d33ec=_0x495b91(0x13b6)+(_0x17f570[_0x495b91(0xd7a)]||_0x495b91(0x12e7))+_0x495b91(0x1eb8)+_0x2f9d23+_0x495b91(0x861);}else{const _0x52ef3f=_0x36bd7c[_0x495b91(0x1ba)]||'online';let _0xeb845f;if(typeof _0x17f570[_0x495b91(0x1423)]===_0x495b91(0xb97))_0xeb845f=_0x17f570[_0x495b91(0x1423)];else{if(Array[_0x495b91(0x1bcc)](_0x17f570[_0x495b91(0x1423)])&&_0x17f570[_0x495b91(0x1423)][_0x495b91(0xcbf)]>0x0){const _0x50ddb0=_0x17f570[_0x495b91(0x1423)][0x0];_0x50ddb0&&_0x50ddb0[_0x495b91(0x23df)]===_0x495b91(0x1e58)&&_0x50ddb0[_0x495b91(0x1e58)]?_0xeb845f=_0x50ddb0[_0x495b91(0x1e58)]:_0xeb845f='[多媒体消息]';}else{if(_0x17f570[_0x495b91(0x1423)]&&typeof _0x17f570['content']===_0x495b91(0x3c4)){if(_0x17f570['content']['name']&&typeof _0x17f570['content']['name']==='string'){if(_0x17f570['content'][_0x495b91(0x23df)]===_0x495b91(0xb18))_0xeb845f=_0x495b91(0x16b9)+_0x17f570[_0x495b91(0x1423)][_0x495b91(0x222f)];else _0x17f570[_0x495b91(0x1423)][_0x495b91(0x23df)]===_0x495b91(0x20b8)?_0xeb845f=_0x495b91(0x16fd)+_0x17f570[_0x495b91(0x1423)]['name']:_0xeb845f='提及了：'+_0x17f570[_0x495b91(0x1423)]['name'];}else _0xeb845f=_0x17f570['content'][_0x495b91(0xd7a)]||_0x17f570[_0x495b91(0x1423)][_0x495b91(0x1e58)]||'[多媒体消息]';}else _0xeb845f=String(_0x17f570[_0x495b91(0x1423)]||'');}}_0x52ef3f==='offline'&&(_0xeb845f=processOfflineContent(_0xeb845f)),_0xeb845f=processMentions(_0xeb845f),_0x17f570['replyTo']?_0x6d33ec=generateReplyHTML(_0x17f570[_0x495b91(0x180)])+_0xeb845f:_0x6d33ec=_0xeb845f;}}}}}}let _0x2028ca='';if(!_0x36bd7c[_0x495b91(0x1e22)]){let _0x353f7a='';if(_0x3c4a16&&_0x14673a&&_0x582cf2)_0x353f7a=_0x495b91(0x72b)+_0x582cf2['id']+'\x27)';else _0x1387de&&(_0x353f7a=_0x495b91(0x72b)+_0x1387de['id']+'\x27)');_0x2028ca=generateAvatarHtml({'avatarUrl':_0xca050d,'backgroundColor':_0x1993e0,'displayName':_0x33ce9c,'timestamp':_0x17f570[_0x495b91(0x7aa)],'timestampEnabled':_0x41d74d,'timestampPosition':_0x47214c,'chatSettings':_0x36bd7c,'onClick':_0x353f7a,'title':_0x3c4a16&&_0x582cf2?_0x495b91(0x2351)+_0x582cf2['name']:_0x1387de?_0x495b91(0x58f):_0x33ce9c});}let _0x5c196c='';_0x17f570[_0x495b91(0x23df)]===_0x495b91(0x1bfd)||_0x17f570['type']==='transfer'||_0x17f570['type']==='user_photo'||_0x17f570[_0x495b91(0x23df)]===_0x495b91(0x63b)||_0x17f570['type']===_0x495b91(0xb93)||_0x17f570[_0x495b91(0x23df)]===_0x495b91(0x14f2)?_0x5c196c=_0x6d33ec:_0x5c196c=_0x495b91(0x22a1)+_0x41544c+_0x495b91(0x1ad7)+_0xdfd1f4+_0x495b91(0x1de5)+_0x46763f+_0x495b91(0x4fb)+_0x6d33ec+_0x495b91(0x1e0b)+(_0x17f570['image']&&!_0x17f570['type']?'<img\x20src=\x22'+_0x17f570['image']+_0x495b91(0x2183)+(_0x17f570['isEmoji']?_0x495b91(0x1665):_0x495b91(0x548))+'\x22\x20onclick=\x22showImage(\x27'+_0x17f570[_0x495b91(0xe5b)]+_0x495b91(0x1ccf):'')+_0x495b91(0x843)+(_0x41d74d&&_0x47214c==='bubble'?'<div\x20class=\x22timestamp\x20timestamp-bubble\x22>'+formatTimeOnly(_0x17f570[_0x495b91(0x7aa)])+_0x495b91(0xa54):'')+_0x495b91(0x1e0b)+(_0x41d74d&&_0x47214c==='inside'?'<div\x20class=\x22timestamp\x20timestamp-inside\x22>'+formatTimeOnly(_0x17f570[_0x495b91(0x7aa)])+_0x495b91(0xa54):'')+_0x495b91(0x229e);if(_0x3c4a16&&_0x14673a&&_0x33ce9c!==_0x495b91(0xd61)){_0x20013e[_0x495b91(0x226e)][_0x495b91(0xe1)](_0x495b91(0x2e1));const _0x2d896e=_0x495b91(0xb81)+_0x33ce9c+_0x495b91(0xa54);_0x17f570[_0x495b91(0x23df)]==='voice_message'||_0x17f570[_0x495b91(0x23df)]===_0x495b91(0xd8)||_0x17f570[_0x495b91(0x23df)]===_0x495b91(0xb93)||_0x17f570['type']==='user_photo'||_0x17f570['type']===_0x495b91(0x63b)||_0x17f570[_0x495b91(0x23df)]===_0x495b91(0x14f2)||_0x17f570[_0x495b91(0x23df)]===_0x495b91(0x8fa)?_0x20013e[_0x495b91(0xc02)]=_0x2028ca+(_0x495b91(0x1e74)+_0x2d896e+_0x5c196c+'</div>'):_0x20013e[_0x495b91(0xc02)]=_0x2028ca+('<div\x20class=\x22bubble-wrapper\x22>'+_0x2d896e+_0x5c196c+_0x495b91(0xa54));}else _0x20013e[_0x495b91(0xc02)]=_0x2028ca+_0x5c196c;}else{let _0xfc3e48=_0x36bd7c[_0x495b91(0x13af)],_0x181b19=_0x36bd7c['myChatNickname'];if((!_0xfc3e48||!_0x181b19)&&_0x36bd7c['selectedIdentityId']){const _0xf52b27=personas[_0x495b91(0x1aeb)](_0x50c41f=>_0x50c41f['id']===_0x36bd7c['selectedIdentityId']);if(_0xf52b27){if(!_0xfc3e48)_0xfc3e48=_0xf52b27[_0x495b91(0x10f9)];if(!_0x181b19)_0x181b19=_0xf52b27[_0x495b91(0x222f)];}}const _0x8ca3dc=_0x36bd7c[_0x495b91(0x1aab)]||_0x495b91(0x1f03),_0x1b9c9e=_0x36bd7c[_0x495b91(0x24c3)]||'1',_0x479cf0=isLightColor(_0x8ca3dc)?'#333':_0x495b91(0x18a7),_0x57c918=_0x36bd7c[_0x495b91(0x1068)]||'12',_0x4e9d7c=convertColorWithOpacity(_0x8ca3dc,_0x1b9c9e);let _0x551f78='';if(_0x17f570[_0x495b91(0x23df)]===_0x495b91(0x14a6))_0x551f78=_0x495b91(0x106d)+(_0x17f570[_0x495b91(0x18cb)]||_0x17f570[_0x495b91(0x1423)])[_0x495b91(0x882)](/'/g,'\x5c\x27')['replace'](/"/g,_0x495b91(0xca))+_0x495b91(0x1651)+(_0x17f570[_0x495b91(0x18cb)]||_0x17f570[_0x495b91(0x1423)])+_0x495b91(0x10dc);else{if(_0x17f570[_0x495b91(0x23df)]===_0x495b91(0x2c2))_0x551f78=_0x495b91(0xdc2)+_0x4e9d7c+';\x20color:\x20'+_0x479cf0+';\x20position:\x20relative;\x20padding:\x20'+_0x57c918+_0x495b91(0x1b14)+_0x17f570[_0x495b91(0x1423)]+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-wave\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-duration\x22>'+(_0x17f570[_0x495b91(0x1ff)]||Math[_0x495b91(0x910)](0x1,Math['ceil'](_0x17f570[_0x495b91(0x1423)][_0x495b91(0xcbf)]/0x8)))+_0x495b91(0x256c)+(_0x41d74d&&_0x47214c===_0x495b91(0x849)?_0x495b91(0xe44)+formatTimeOnly(_0x17f570[_0x495b91(0x7aa)])+_0x495b91(0xa54):'')+_0x495b91(0x2010)+(_0x41d74d&&_0x47214c===_0x495b91(0x151c)?'<div\x20class=\x22timestamp\x20timestamp-inside\x22>'+formatTimeOnly(_0x17f570[_0x495b91(0x7aa)])+_0x495b91(0xa54):'')+_0x495b91(0x9a8)+_0x17f570['content']+_0x495b91(0x931);else{if(_0x17f570[_0x495b91(0x23df)]===_0x495b91(0xd8)){let _0x547a83='',_0x1ea982='';if(_0x17f570['status']===_0x495b91(0x15d2)){const _0x462dc=_0x17f570['recipientName']?_0x17f570[_0x495b91(0x65d)]+'已收款':_0x495b91(0x1dd9);_0x1ea982='<div\x20class=\x22transfer-status\x22>'+_0x462dc+_0x495b91(0xa54),_0x547a83='accepted';}else{if(_0x17f570[_0x495b91(0xe54)]===_0x495b91(0x1164)){const _0x1077d3=_0x17f570[_0x495b91(0x65d)]?_0x17f570[_0x495b91(0x65d)]+_0x495b91(0x939):_0x495b91(0x1213);_0x1ea982='<div\x20class=\x22transfer-status\x22>'+_0x1077d3+_0x495b91(0xa54),_0x547a83=_0x495b91(0x1164);}}let _0x5b9112=_0x495b91(0x1578);_0x17f570[_0x495b91(0x65d)]&&(_0x5b9112=_0x495b91(0x2268)+_0x17f570[_0x495b91(0x65d)]),_0x551f78=_0x495b91(0x4be)+_0x547a83+_0x495b91(0x21c4)+_0x17f570[_0x495b91(0x7aa)]+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22transfer-title\x22>'+_0x5b9112+_0x495b91(0x1824)+Number(_0x17f570[_0x495b91(0xca8)])[_0x495b91(0x3cd)](0x2)+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22transfer-note\x22>'+(_0x17f570[_0x495b91(0x15fe)]||'转账')+_0x495b91(0x1e0f)+_0x1ea982+_0x495b91(0xdbd);}else{if(_0x17f570[_0x495b91(0x23df)]===_0x495b91(0x8fa)){const _0x25c51e=_0x17f570['orderDetails']||{},_0x5c1349=_0x17f570[_0x495b91(0x87a)]||'';let _0x5493e6='',_0x1a55c3='',_0x2d73db='';if(_0x5c1349===_0x495b91(0x1c4e))_0x5493e6='订单支付成功',_0x1a55c3='',_0x2d73db='success';else _0x5c1349===_0x495b91(0x589)&&(_0x5493e6='订单下单成功',_0x1a55c3='',_0x2d73db='success');const _0x847add=_0x25c51e[_0x495b91(0x24ef)]?_0x25c51e[_0x495b91(0x24ef)][_0x495b91(0xf6d)](_0x18de89=>{const _0x43fd06=_0x495b91;let _0xf6cf16=_0x18de89['name'];if(_0x18de89['selectedOptions']&&Object[_0x43fd06(0x16c7)](_0x18de89[_0x43fd06(0xebe)])[_0x43fd06(0xcbf)]>0x0){const _0x2bb7c0=Object[_0x43fd06(0x230e)](_0x18de89[_0x43fd06(0xebe)])[_0x43fd06(0xf6d)](([_0x418b59,_0x5f824a])=>getOptionLabel(_0x418b59)+':\x20'+_0x5f824a)[_0x43fd06(0x140c)](',\x20');_0xf6cf16+=_0x43fd06(0x4d2)+_0x2bb7c0+_0x43fd06(0x2fa);}return'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-item\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22item-name\x22>'+_0xf6cf16+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22item-quantity\x22>x'+_0x18de89[_0x43fd06(0x20dd)]+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22item-price\x22>¥'+(_0x18de89[_0x43fd06(0xbfc)]*_0x18de89[_0x43fd06(0x20dd)])[_0x43fd06(0x3cd)](0x2)+_0x43fd06(0x2223);})['join'](''):'';_0x551f78='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22order-receipt-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-card\x20'+_0x2d73db+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-title\x22>'+_0x5493e6+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-divider\x22></div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-row\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22label\x22>订单号</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22value\x22>'+(_0x25c51e[_0x495b91(0x4de)]||_0x495b91(0x16c2))+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-row\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22label\x22>收货人</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22value\x22>'+(_0x5c1349[_0x495b91(0xd7e)](_0x495b91(0x155b))?'我自己':currentChatCharacter?.['name']||'Ta')+_0x495b91(0x930)+new Date(_0x17f570['timestamp'])[_0x495b91(0x133a)](_0x495b91(0x1c0b),{'month':_0x495b91(0x19f3),'day':_0x495b91(0x19f3),'hour':_0x495b91(0x19f3),'minute':_0x495b91(0x19f3)})+_0x495b91(0x1cb5)+_0x847add+_0x495b91(0x1684)+(_0x25c51e[_0x495b91(0x1dbe)]?_0x25c51e['total'][_0x495b91(0x3cd)](0x2):_0x495b91(0x1220))+_0x495b91(0x7cd);}else{if(_0x17f570[_0x495b91(0x23df)]===_0x495b91(0x674))_0x551f78=generatePaymentRequestContent(_0x17f570);else{if(_0x17f570[_0x495b91(0x23df)]===_0x495b91(0xe70)){const _0xe88c44=_0x17f570[_0x495b91(0x1560)]||{};_0x551f78=_0x495b91(0x245a)+_0xe88c44['id']+',\x20\x27chat\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22shared-post-header\x22>论坛帖子分享</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22shared-post-title\x22>'+(_0xe88c44[_0x495b91(0x1c18)]||'帖子加载失败')+_0x495b91(0x676)+truncateText(_0xe88c44[_0x495b91(0x1423)]||'',0x32)+_0x495b91(0x931);}else{if(_0x17f570[_0x495b91(0x23df)]==='forwarded_message')_0x551f78=renderForwardedMessage(_0x17f570);else{if(_0x17f570[_0x495b91(0x23df)]===_0x495b91(0x63b))_0x551f78='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22location-message-container\x20sent\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22location-card\x22\x20onclick=\x22showLocationDetail(\x27'+_0x17f570['locationName']+_0x495b91(0x1c48)+_0x17f570[_0x495b91(0xf7e)]+_0x495b91(0x21de);else{if(Array[_0x495b91(0x1bcc)](_0x17f570[_0x495b91(0x1423)])){const _0x2bf47b=_0x17f570[_0x495b91(0x1423)]['find'](_0x3c2ba7=>_0x3c2ba7[_0x495b91(0x23df)]===_0x495b91(0x1e58)),_0x3ed0d4=_0x17f570[_0x495b91(0x1423)][_0x495b91(0x1aeb)](_0x1de45f=>_0x1de45f[_0x495b91(0x23df)]==='image_url');let _0x5d713a=_0x2bf47b?.[_0x495b91(0x1e58)]||'';_0x5d713a=processMentions(_0x5d713a),_0x17f570['replyTo']?_0x551f78=generateReplyHTML(_0x17f570[_0x495b91(0x180)])+_0x5d713a:_0x551f78=_0x5d713a,_0x3ed0d4?.[_0x495b91(0x1cfa)]?.[_0x495b91(0x10c6)]&&(_0x551f78&&(_0x551f78+=_0x495b91(0x365)),_0x551f78+=_0x495b91(0x2001)+_0x3ed0d4[_0x495b91(0x1cfa)][_0x495b91(0x10c6)]+_0x495b91(0x2183)+(_0x17f570[_0x495b91(0xe29)]?_0x495b91(0x1665):_0x495b91(0x548))+_0x495b91(0x1e66)+_0x3ed0d4[_0x495b91(0x1cfa)][_0x495b91(0x10c6)]+_0x495b91(0x1ccf));}else{let _0x173866=_0x17f570['content'];_0x173866=processMentions(_0x173866),_0x17f570[_0x495b91(0x180)]?_0x551f78=generateReplyHTML(_0x17f570[_0x495b91(0x180)])+_0x173866:_0x551f78=_0x173866;}}}}}}}}}let _0x5dd371='';_0x17f570[_0x495b91(0x23df)]===_0x495b91(0x14a6)||_0x17f570['type']==='voice'||_0x17f570[_0x495b91(0x23df)]==='transfer'||_0x17f570[_0x495b91(0x23df)]===_0x495b91(0x63b)||_0x17f570[_0x495b91(0x23df)]===_0x495b91(0x14f2)||_0x17f570['type']==='order_confirmation'||_0x17f570[_0x495b91(0x23df)]===_0x495b91(0x674)?_0x5dd371=_0x551f78:_0x5dd371=_0x495b91(0x201)+_0x4e9d7c+_0x495b91(0x1ad7)+_0x479cf0+_0x495b91(0x1de5)+_0x57c918+'px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x551f78+_0x495b91(0x1e0b)+(_0x17f570[_0x495b91(0xe5b)]&&!_0x17f570[_0x495b91(0x23df)]&&!Array['isArray'](_0x17f570[_0x495b91(0x1423)])?_0x495b91(0x2001)+_0x17f570['image']+_0x495b91(0x2183)+(_0x17f570['isEmoji']?_0x495b91(0x1665):_0x495b91(0x548))+'\x22\x20onclick=\x22showImage(\x27'+_0x17f570[_0x495b91(0xe5b)]+_0x495b91(0x1ccf):'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x41d74d&&_0x47214c===_0x495b91(0x849)?_0x495b91(0xe44)+formatTimeOnly(_0x17f570[_0x495b91(0x7aa)])+'</div>':'')+_0x495b91(0x1e0b)+(_0x41d74d&&_0x47214c===_0x495b91(0x151c)?_0x495b91(0x1a87)+formatTimeOnly(_0x17f570[_0x495b91(0x7aa)])+_0x495b91(0xa54):'')+_0x495b91(0x1b07);let _0x2a9003='';!_0x36bd7c[_0x495b91(0x1e22)]&&(_0x2a9003=generateAvatarHtml({'avatarUrl':_0xfc3e48,'backgroundColor':_0x495b91(0x1f03),'displayName':'','timestamp':_0x17f570[_0x495b91(0x7aa)],'timestampEnabled':_0x41d74d,'timestampPosition':_0x47214c,'chatSettings':_0x36bd7c})),_0x20013e[_0x495b91(0xc02)]=_0x5dd371+_0x2a9003;}_0x20013e[_0x495b91(0x655)]['opacity']='0',_0x20013e[_0x495b91(0x655)][_0x495b91(0x2006)]=_0x495b91(0x1c6b),_0x20013e[_0x495b91(0x655)][_0x495b91(0x2175)]=_0x495b91(0x1ca7),_0x2d230e['appendChild'](_0x20013e),addBubbleTail(_0x20013e,_0x17f570),requestAnimationFrame(()=>{const _0x31da84=_0x495b91;_0x20013e[_0x31da84(0x655)][_0x31da84(0x671)]='1',_0x20013e[_0x31da84(0x655)][_0x31da84(0x2006)]=_0x31da84(0x2429);}),addBlockedIndicatorToMessage(_0x20013e,_0x17f570,_0x2d86f9),addMessageLongPressListener(_0x20013e,_0x17f570['id']);const _0x15d870=_0x20013e['querySelector'](_0x495b91(0x37c));_0x15d870&&(_0x15d870[_0x495b91(0x167)](_0x495b91(0xd3e),_0x447ba6=>{const _0x572341=_0x495b91;_0x447ba6[_0x572341(0x4d9)](),showMessageMenu(_0x17f570['id'],_0x447ba6);}),_0x15d870[_0x495b91(0x11cf)]=_0x564c45=>{const _0xbe2951=_0x495b91;_0x564c45[_0xbe2951(0x1144)]['tagName']===_0xbe2951(0xb84)&&_0x564c45[_0xbe2951(0x1144)][_0xbe2951(0x226e)][_0xbe2951(0x1f9)](_0xbe2951(0x548))&&showImage(_0x564c45[_0xbe2951(0x1144)][_0xbe2951(0x107)]);});}),!_0x5579d4&&setTimeout(()=>{const _0x44e97f=_0x379f2f;_0x2d230e[_0x44e97f(0x5e5)]=_0x2d230e[_0x44e97f(0x14c8)];},0x64),setTimeout(()=>{const _0xc51d3a=_0x379f2f,_0x43d33a=_0x2d230e['querySelectorAll'](_0xc51d3a(0xc01));_0x43d33a[_0xc51d3a(0x900)](_0x467d1f=>{const _0x3ed426=_0xc51d3a,_0x7a1a63=_0x467d1f[_0x3ed426(0x15b8)](_0x3ed426(0x278));if(_0x7a1a63&&_0x467d1f[_0x3ed426(0x15b8)](_0x3ed426(0x37c))){const _0x25a63b=_0x467d1f[_0x3ed426(0x15b8)](_0x3ed426(0x37c)),_0x368563=_0x467d1f[_0x3ed426(0x15b8)]('.message-avatar');if(_0x25a63b&&_0x7a1a63[_0x3ed426(0x2026)](_0x3ed426(0x37c))){const _0x4bc88b=_0x7a1a63['closest'](_0x3ed426(0x5f2));_0x4bc88b&&(_0x467d1f[_0x3ed426(0xc02)]=_0x4bc88b[_0x3ed426(0x77c)]+(_0x368563?_0x368563[_0x3ed426(0x77c)]:''));}}});if(currentChatCharacter){const _0xb7e84b=document[_0xc51d3a(0x15b8)](_0xc51d3a(0x229b));_0xb7e84b&&renderCharacterStatus(currentChatCharacter['id'],_0xb7e84b);}},0x32);}function loadMoreMessages(_0x208bff){const _0x3849e5=_0x2cf6d4,_0x2ed033=document[_0x3849e5(0x566)](_0x3849e5(0x24e7)),_0x45b8c4=chatMessages[_0x208bff]||[],_0x1d363a=getCurrentChatSettings(),_0xb81e87=getCurrentChatSettings(),_0x5aae3e=_0xb81e87['showOfflineInOnline']===!![],_0x56b7c1=_0x45b8c4[_0x3849e5(0x803)](_0x33b871=>{const _0x2fe224=_0x3849e5;if(_0x33b871['isGameMessage']||_0x33b871[_0x2fe224(0x15ca)])return![];if(_0x33b871['isOfflineMode']&&!_0x5aae3e)return![];return!![];}),_0x35c50a=_0x2ed033[_0x3849e5(0x14c8)],_0x1e6ce8=_0x2ed033[_0x3849e5(0x5e5)],_0x499782=Math[_0x3849e5(0x910)](0x0,currentMessageOffset-MESSAGE_LIMIT),_0x5d3030=_0x56b7c1['slice'](_0x499782,currentMessageOffset),_0x2b4291=_0x2ed033[_0x3849e5(0x15b8)](_0x3849e5(0xdcd));_0x2b4291&&_0x2b4291[_0x3849e5(0x128)]();if(_0x499782>0x0){const _0x3cf4e3=document[_0x3849e5(0x1ad8)](_0x3849e5(0x526));_0x3cf4e3['className']='load-more-messages',_0x3cf4e3[_0x3849e5(0xc02)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22load-more-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-chevron-up\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>查看历史消息\x20('+_0x499782+_0x3849e5(0x949),_0x3cf4e3[_0x3849e5(0x11cf)]=()=>loadMoreMessages(_0x208bff),_0x2ed033[_0x3849e5(0x1806)](_0x3cf4e3,_0x2ed033[_0x3849e5(0x1bd8)]);}const _0xa2d76f=_0x1d363a[_0x3849e5(0x9c1)]!==![],_0xea0388=_0x1d363a[_0x3849e5(0x19ec)]||_0x3849e5(0x23a1);let _0x43ccda=0x0;for(let _0x16c223=_0x5d3030[_0x3849e5(0xcbf)]-0x1;_0x16c223>=0x0;_0x16c223--){const _0x2b3438=_0x5d3030[_0x16c223];if(_0x2b3438[_0x3849e5(0xf75)]===_0x3849e5(0x212)){if(_0x2b3438['isBlockedMessage']){const _0x48925c=document[_0x3849e5(0x1ad8)](_0x3849e5(0x526));_0x48925c[_0x3849e5(0x655)]['display']=_0x3849e5(0x1f0b),_0x48925c[_0x3849e5(0x655)][_0x3849e5(0x1571)]='center',_0x48925c[_0x3849e5(0x655)]['margin']=_0x3849e5(0x23dd),_0x48925c[_0x3849e5(0x1f26)][_0x3849e5(0x61f)]=_0x2b3438['id'];const _0x4f8bc0=document['createElement'](_0x3849e5(0x526));_0x4f8bc0['className']=_0x3849e5(0x21a7),_0x4f8bc0[_0x3849e5(0x21dc)]=_0x2b3438[_0x3849e5(0x1423)]||_0x3849e5(0x81e),_0x48925c[_0x3849e5(0x1925)](_0x4f8bc0);const _0x1255df=_0x2ed033['querySelector'](_0x3849e5(0xdcd));_0x1255df?_0x1255df[_0x3849e5(0xe9)]['insertBefore'](_0x48925c,_0x1255df[_0x3849e5(0x91f)]):_0x2ed033[_0x3849e5(0x1806)](_0x48925c,_0x2ed033['firstChild']);continue;}let _0x8ac440;if(_0x2b3438['isPoke']){const _0xab1533=document['createElement'](_0x3849e5(0x526));_0xab1533['className']=_0x3849e5(0x2264);const _0x59b8f1=document['createElement']('div');_0x59b8f1['className']=_0x3849e5(0x23b4),_0x59b8f1[_0x3849e5(0x21dc)]=_0x2b3438[_0x3849e5(0x1423)],_0xab1533[_0x3849e5(0x1925)](_0x59b8f1),_0x8ac440=_0xab1533;}else{if(_0x2b3438[_0x3849e5(0x23df)]===_0x3849e5(0x1e4b)){const _0x2fae14=document[_0x3849e5(0x1ad8)](_0x3849e5(0x526));_0x2fae14[_0x3849e5(0x655)][_0x3849e5(0x2526)]=_0x3849e5(0x1f0b),_0x2fae14['style'][_0x3849e5(0x1571)]=_0x3849e5(0x23a1),_0x2fae14[_0x3849e5(0x655)][_0x3849e5(0x1bf7)]=_0x3849e5(0x23dd),_0x2fae14[_0x3849e5(0x1f26)][_0x3849e5(0x61f)]=_0x2b3438['id'];const _0x59424c=document[_0x3849e5(0x1ad8)](_0x3849e5(0x526));_0x59424c['className']=_0x3849e5(0x11af);const _0x1a5cf0=_0x2b3438[_0x3849e5(0x1423)]['split']('\x0a'),_0x4973b6=_0x1a5cf0[0x0];let _0x5744d5=_0x1a5cf0[0x1];_0x59424c[_0x3849e5(0x21dc)]=_0x4973b6;if(_0x5744d5){if(_0x5744d5[_0x3849e5(0x1cab)]('原文：')){const _0x1e38d4=document['createElement'](_0x3849e5(0x526));_0x1e38d4[_0x3849e5(0x221)]=_0x3849e5(0x7a8),_0x1e38d4[_0x3849e5(0x21dc)]=_0x5744d5,_0x59424c[_0x3849e5(0x1925)](_0x1e38d4);}else{const _0x1be603=document[_0x3849e5(0x1ad8)]('div');_0x1be603[_0x3849e5(0x221)]=_0x3849e5(0x7a8),_0x1be603[_0x3849e5(0x21dc)]=_0x3849e5(0xce4)+_0x5744d5,_0x59424c[_0x3849e5(0x1925)](_0x1be603);}}else{if(_0x2b3438[_0x3849e5(0x1739)]){const _0x1d06e6=document[_0x3849e5(0x1ad8)](_0x3849e5(0x526));_0x1d06e6['className']=_0x3849e5(0x7a8),_0x1d06e6['textContent']=_0x3849e5(0xce4)+_0x2b3438[_0x3849e5(0x1739)],_0x59424c[_0x3849e5(0x1925)](_0x1d06e6);}}_0x2fae14[_0x3849e5(0x1925)](_0x59424c),_0x8ac440=_0x2fae14;}else{const _0x2ca2e4=document[_0x3849e5(0x1ad8)](_0x3849e5(0x526));_0x2ca2e4[_0x3849e5(0x655)][_0x3849e5(0x2526)]=_0x3849e5(0x1f0b),_0x2ca2e4[_0x3849e5(0x655)][_0x3849e5(0x1571)]='center',_0x2ca2e4[_0x3849e5(0x655)][_0x3849e5(0x1bf7)]=_0x3849e5(0x23dd);const _0x10d747=document[_0x3849e5(0x1ad8)](_0x3849e5(0x526));_0x2b3438[_0x3849e5(0x158d)]?_0x10d747[_0x3849e5(0x221)]='friend-added-system-message':_0x10d747[_0x3849e5(0x221)]=_0x3849e5(0x21a7),_0x10d747['textContent']=_0x2b3438['content'],_0x2ca2e4[_0x3849e5(0x1925)](_0x10d747),_0x8ac440=_0x2ca2e4;}}const _0xa25e7a=_0x2ed033['querySelector']('.load-more-messages');_0xa25e7a?_0xa25e7a['parentNode'][_0x3849e5(0x1806)](_0x8ac440,_0xa25e7a[_0x3849e5(0x91f)]):_0x2ed033[_0x3849e5(0x1806)](_0x8ac440,_0x2ed033[_0x3849e5(0x1bd8)]);_0x2b3438[_0x3849e5(0x23df)]===_0x3849e5(0x1e4b)&&addMessageLongPressListener(_0x8ac440,_0x2b3438['id']);continue;}const _0x1d431d=document[_0x3849e5(0x1ad8)](_0x3849e5(0x526)),_0x427f4b=_0x2b3438['isEmoji']&&!_0x2b3438[_0x3849e5(0x1423)];_0x1d431d[_0x3849e5(0x221)]='message-container\x20'+_0x2b3438['sender']+(_0x1d363a[_0x3849e5(0x1e22)]?_0x3849e5(0x2125):'')+(_0x427f4b?_0x3849e5(0x6b4):'')+(_0xa2d76f&&_0xea0388===_0x3849e5(0x107f)?_0x3849e5(0x17ad):''),_0x1d431d[_0x3849e5(0x1f26)][_0x3849e5(0x61f)]=_0x2b3438['id'];if(_0x2b3438[_0x3849e5(0xf75)]===_0x3849e5(0x232)){let _0x258f49=characters['find'](_0x538e8c=>_0x538e8c['id']===_0x208bff),_0x544a68=![],_0x5113ec=null;!_0x258f49&&(_0x5113ec=groupChats['find'](_0x126eff=>_0x126eff['id']===_0x208bff),_0x5113ec&&(_0x544a68=!![]));let _0x280a38='',_0x2d0be2='',_0x5308bb=_0x3849e5(0x23b8),_0x576c24=null;if(_0x544a68&&_0x5113ec){if(_0x2b3438[_0x3849e5(0x210b)])_0x576c24=_0x5113ec[_0x3849e5(0xcaa)][_0x3849e5(0x1aeb)](_0x31aadb=>_0x31aadb['id']===_0x2b3438[_0x3849e5(0x210b)]);else _0x2b3438[_0x3849e5(0x222f)]&&(_0x576c24=_0x5113ec[_0x3849e5(0xcaa)]['find'](_0x278946=>_0x278946[_0x3849e5(0x222f)]===_0x2b3438['name']));_0x576c24?(_0x280a38=_0x576c24[_0x3849e5(0x10f9)]||'',_0x2d0be2=_0x576c24[_0x3849e5(0x222f)],_0x5308bb=_0x576c24[_0x3849e5(0x2099)]||_0x3849e5(0x23b8)):(_0x280a38='',_0x2d0be2=_0x2b3438[_0x3849e5(0x222f)]||_0x3849e5(0xd61),_0x5308bb=_0x3849e5(0x23b8));}else _0x258f49?(_0x280a38=_0x1d363a[_0x3849e5(0x23e0)]||_0x258f49[_0x3849e5(0x10f9)],_0x2d0be2=_0x1d363a['aiChatNickname']||_0x258f49[_0x3849e5(0x222f)],_0x5308bb=_0x258f49[_0x3849e5(0x2099)]||_0x3849e5(0x23b8)):(_0x280a38='',_0x2d0be2='未知',_0x5308bb=_0x3849e5(0x23b8));let _0x203056=_0x1d363a[_0x3849e5(0x2116)]||'#f0f0f0';if(_0x544a68&&_0x5113ec&&_0x2b3438[_0x3849e5(0x210b)]&&_0x1d363a[_0x3849e5(0xb52)]){const _0x4f888e=_0x1d363a[_0x3849e5(0xb52)][_0x2b3438[_0x3849e5(0x210b)]];_0x4f888e&&(_0x203056=_0x4f888e);}const _0x5cfac9=_0x1d363a[_0x3849e5(0xaf0)]||'1',_0x45e00e=isLightColor(_0x203056)?_0x3849e5(0x194f):_0x3849e5(0x18a7),_0x54fb21=_0x1d363a[_0x3849e5(0x1068)]||'12',_0x31be13=convertColorWithOpacity(_0x203056,_0x5cfac9);let _0x17751d='';if(_0x2b3438['type']===_0x3849e5(0x1bfd)){const _0x35c673=_0x2b3438[_0x3849e5(0x1423)][_0x3849e5(0x882)](/\([^)]*\)\s*/g,'')['trim'](),_0x34a4f6=_0x2b3438[_0x3849e5(0x1ff)]||Math[_0x3849e5(0x910)](0x1,Math[_0x3849e5(0x1462)](_0x35c673[_0x3849e5(0xcbf)]/0x8));_0x17751d=_0x3849e5(0x1136)+_0x31be13+_0x3849e5(0x1ad7)+_0x45e00e+';\x20position:\x20relative;\x20padding:\x20'+_0x54fb21+'px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-message\x22\x20onclick=\x22toggleVoiceText(this)\x22\x20data-text=\x22'+_0x35c673+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-wave\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-duration\x22>'+_0x34a4f6+_0x3849e5(0x1f37)+_0x35c673+_0x3849e5(0x931);}else{if(_0x2b3438['type']==='ai_image'){const _0x931f4f=_0x2b3438[_0x3849e5(0x18d1)]||_0x2b3438[_0x3849e5(0x1423)]||_0x3849e5(0x44e);_0x17751d=_0x3849e5(0x1a70)+_0x931f4f[_0x3849e5(0x882)](/'/g,'\x5c\x27')[_0x3849e5(0x882)](/"/g,_0x3849e5(0xca))+'\x27)\x22><div\x20class=\x22dreamy-photo\x22><div\x20class=\x22photo-misty-bg\x22></div><div\x20class=\x22photo-badge\x22><i\x20class=\x22fas\x20fa-image\x22></i></div><div\x20class=\x22sparkle-container\x22><div\x20class=\x22sparkle\x20sparkle-1\x22>✨</div><div\x20class=\x22sparkle\x20sparkle-2\x22>⭐</div><div\x20class=\x22sparkle\x20sparkle-3\x22>✨</div><div\x20class=\x22sparkle\x20sparkle-4\x22>⭐</div><div\x20class=\x22sparkle\x20sparkle-5\x22>💫</div></div><div\x20class=\x22photo-text-overlay\x22\x20style=\x22display:\x20none;\x22><div\x20class=\x22photo-description\x22>'+_0x931f4f+_0x3849e5(0x11fe);}else{if(_0x2b3438[_0x3849e5(0x23df)]===_0x3849e5(0xd8)){const _0x2cd3b8=_0x2b3438[_0x3849e5(0x1562)]===_0x3849e5(0x23b2),_0x4bc3ff=_0x2cd3b8?'💕':'💖',_0x179157=_0x2cd3b8?_0x3849e5(0xe7f):_0x3849e5(0x1169);let _0xeea734='',_0x2c68be='',_0x229471='';if(_0x2b3438['status']===_0x3849e5(0x15d2))_0x2c68be=_0x3849e5(0x1f14)+(_0x2cd3b8?_0x3849e5(0x1dd9):_0x3849e5(0x1dde))+_0x3849e5(0xa54),_0xeea734='accepted';else{if(_0x2b3438[_0x3849e5(0xe54)]===_0x3849e5(0x1164))_0x2c68be='<div\x20class=\x22transfer-status\x22>'+(_0x2cd3b8?_0x3849e5(0x1213):_0x3849e5(0x939))+_0x3849e5(0xa54),_0xeea734=_0x3849e5(0x1164);else!_0x2cd3b8&&(_0x229471=_0x3849e5(0x120e)+JSON[_0x3849e5(0x7fb)](_0x2b3438)['replace'](/"/g,_0x3849e5(0xca))+')\x22');}_0x17751d=_0x3849e5(0x1758)+_0xeea734+_0x3849e5(0x21c4)+_0x2b3438[_0x3849e5(0x7aa)]+'\x22\x20'+_0x229471+_0x3849e5(0x12d4)+_0x4bc3ff+'\x20'+_0x179157+_0x3849e5(0xcc2)+Number(_0x2b3438[_0x3849e5(0xca8)])[_0x3849e5(0x3cd)](0x2)+_0x3849e5(0x159)+(_0x2b3438['note']||'转账')+_0x3849e5(0xa54)+_0x2c68be+_0x3849e5(0x14b7);}else{if(_0x2b3438[_0x3849e5(0x23df)]===_0x3849e5(0xe70)){const _0x16ed6b=_0x2b3438['postData']||{};_0x17751d=_0x3849e5(0x245a)+_0x16ed6b['id']+',\x20\x27chat\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22shared-post-header\x22>论坛帖子分享</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22shared-post-title\x22>'+(_0x16ed6b['title']||_0x3849e5(0x4aa))+_0x3849e5(0x676)+truncateText(_0x16ed6b[_0x3849e5(0x1423)]||'',0x32)+_0x3849e5(0x931);}else{if(_0x2b3438[_0x3849e5(0x23df)]==='forwarded_message')_0x17751d=renderForwardedMessage(_0x2b3438);else{if(_0x2b3438[_0x3849e5(0x23df)]===_0x3849e5(0x14f2)){let _0x5b7729;if(_0x2b3438['friendRequestProcessed']){const _0x242c51=_0x2b3438[_0x3849e5(0xe45)]?'已同意':_0x3849e5(0x8a7),_0x209474=_0x2b3438[_0x3849e5(0xe45)]?_0x3849e5(0x15d2):'rejected';_0x5b7729=_0x3849e5(0x93e)+_0x209474+'\x22>'+_0x242c51+_0x3849e5(0xa54);}else _0x5b7729='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22friend-request-btn\x20accept\x22\x20onclick=\x22handleAIFriendRequest(\x27'+currentChatCharacter?.['id']+_0x3849e5(0x2525)+_0x2b3438['id']+_0x3849e5(0x22ae)+currentChatCharacter?.['id']+_0x3849e5(0x1f0c)+_0x2b3438['id']+_0x3849e5(0x1087);_0x17751d=_0x3849e5(0x13b6)+(_0x2b3438[_0x3849e5(0xd7a)]||_0x3849e5(0x12e7))+_0x3849e5(0x1eb8)+_0x5b7729+_0x3849e5(0x861);}else{if(_0x2b3438[_0x3849e5(0x23df)]==='payment_request')_0x17751d=_0x3849e5(0x8d1)+(_0x2b3438[_0x3849e5(0x1423)]||'代付请求')+'</div>';else{if(_0x2b3438['type']===_0x3849e5(0x8fa))_0x17751d=generateAIOrderConfirmationContent(_0x2b3438);else{const _0x39bec5=_0x1d363a[_0x3849e5(0x1ba)]||_0x3849e5(0x20bb);let _0x119d9b=_0x39bec5===_0x3849e5(0x1685)?processOfflineContent(_0x2b3438[_0x3849e5(0x1423)]):_0x2b3438[_0x3849e5(0x1423)];_0x2b3438['replyTo']?_0x17751d=generateReplyHTML(_0x2b3438['replyTo'])+_0x119d9b:_0x17751d=_0x119d9b;}}}}}}}}let _0x4292c3='';if(!_0x1d363a[_0x3849e5(0x1e22)]){let _0x184b0c=null,_0x5a4f13=_0x2d0be2;if(_0x544a68&&_0x5113ec&&_0x576c24)_0x184b0c=_0x3849e5(0x72b)+_0x576c24['id']+'\x27)',_0x5a4f13=_0x3849e5(0x2351)+_0x576c24[_0x3849e5(0x222f)];else _0x258f49&&(_0x184b0c='pokeCharacter(\x27'+_0x258f49['id']+'\x27)',_0x5a4f13=_0x3849e5(0x58f));_0x4292c3=generateAvatarHtml({'avatarUrl':_0x280a38,'backgroundColor':_0x5308bb,'displayName':_0x2d0be2,'onClick':_0x184b0c,'title':_0x5a4f13,'timestamp':_0x2b3438[_0x3849e5(0x7aa)],'timestampEnabled':_0xa2d76f,'timestampPosition':_0xea0388,'chatSettings':_0x1d363a});}let _0x33550e='';_0x2b3438[_0x3849e5(0x23df)]==='voice_message'||_0x2b3438[_0x3849e5(0x23df)]===_0x3849e5(0xd8)||_0x2b3438[_0x3849e5(0x23df)]===_0x3849e5(0xb93)||_0x2b3438[_0x3849e5(0x23df)]===_0x3849e5(0x14a6)||_0x2b3438[_0x3849e5(0x23df)]===_0x3849e5(0x63b)||_0x2b3438['type']===_0x3849e5(0x14f2)?_0x33550e=_0x17751d:_0x33550e='<div\x20class=\x22message-bubble\x22\x20style=\x22background-color:\x20'+_0x31be13+';\x20color:\x20'+_0x45e00e+';\x20position:\x20relative;\x20padding:\x20'+_0x54fb21+_0x3849e5(0x238)+_0x17751d+(_0x2b3438[_0x3849e5(0xe5b)]&&!_0x2b3438[_0x3849e5(0x23df)]?_0x3849e5(0x2001)+_0x2b3438[_0x3849e5(0xe5b)]+_0x3849e5(0x2183)+(_0x2b3438['isEmoji']?_0x3849e5(0x1665):_0x3849e5(0x548))+_0x3849e5(0x1e66)+_0x2b3438[_0x3849e5(0xe5b)]+_0x3849e5(0x1ccf):'')+(_0xa2d76f&&_0xea0388===_0x3849e5(0x849)?_0x3849e5(0xe44)+formatTimeOnly(_0x2b3438[_0x3849e5(0x7aa)])+_0x3849e5(0xa54):'')+(_0xa2d76f&&_0xea0388===_0x3849e5(0x151c)?_0x3849e5(0x1a87)+formatTimeOnly(_0x2b3438[_0x3849e5(0x7aa)])+_0x3849e5(0xa54):'')+_0x3849e5(0xa54);if(_0x544a68&&_0x5113ec&&_0x2d0be2!==_0x3849e5(0xd61)){_0x1d431d['classList'][_0x3849e5(0xe1)](_0x3849e5(0x2e1));const _0x415476=_0x3849e5(0xb81)+_0x2d0be2+_0x3849e5(0xa54);_0x2b3438['type']===_0x3849e5(0x1bfd)||_0x2b3438['type']==='transfer'||_0x2b3438[_0x3849e5(0x23df)]===_0x3849e5(0xb93)||_0x2b3438['type']===_0x3849e5(0x14a6)||_0x2b3438['type']===_0x3849e5(0x63b)||_0x2b3438[_0x3849e5(0x23df)]===_0x3849e5(0x14f2)||_0x2b3438[_0x3849e5(0x23df)]===_0x3849e5(0x8fa)?_0x1d431d['innerHTML']=_0x4292c3+(_0x3849e5(0x1e74)+_0x415476+_0x33550e+_0x3849e5(0xa54)):_0x1d431d[_0x3849e5(0xc02)]=_0x4292c3+(_0x3849e5(0x1e74)+_0x415476+_0x33550e+_0x3849e5(0xa54));}else _0x1d431d[_0x3849e5(0xc02)]=_0x4292c3+_0x33550e;}else{let _0x2beadc=_0x1d363a[_0x3849e5(0x13af)];if(!_0x2beadc&&_0x1d363a['selectedIdentityId']){const _0x313b20=personas[_0x3849e5(0x1aeb)](_0x595f25=>_0x595f25['id']===_0x1d363a[_0x3849e5(0x6a0)]);_0x313b20&&_0x313b20[_0x3849e5(0x10f9)]&&(_0x2beadc=_0x313b20[_0x3849e5(0x10f9)]);}const _0x5cdd20=_0x1d363a['myBubbleColor']||_0x3849e5(0x1f03),_0x5afbc7=_0x1d363a[_0x3849e5(0x24c3)]||'1',_0x572964=isLightColor(_0x5cdd20)?_0x3849e5(0x194f):_0x3849e5(0x18a7),_0xdb0e82=_0x1d363a[_0x3849e5(0x1068)]||'12',_0x79d528=convertColorWithOpacity(_0x5cdd20,_0x5afbc7);let _0x23d702='';if(_0x2b3438[_0x3849e5(0x23df)]===_0x3849e5(0x14a6))_0x23d702=_0x3849e5(0x1a70)+(_0x2b3438[_0x3849e5(0x18cb)]||_0x2b3438['content'])[_0x3849e5(0x882)](/'/g,'\x5c\x27')[_0x3849e5(0x882)](/"/g,_0x3849e5(0xca))+'\x27)\x22><div\x20class=\x22dreamy-photo\x22><div\x20class=\x22photo-misty-bg\x22></div><div\x20class=\x22photo-badge\x22><i\x20class=\x22fas\x20fa-image\x22></i></div><div\x20class=\x22sparkle-container\x22><div\x20class=\x22sparkle\x20sparkle-1\x22>✨</div><div\x20class=\x22sparkle\x20sparkle-2\x22>⭐</div><div\x20class=\x22sparkle\x20sparkle-3\x22>✨</div><div\x20class=\x22sparkle\x20sparkle-4\x22>⭐</div><div\x20class=\x22sparkle\x20sparkle-5\x22>💫</div></div><div\x20class=\x22photo-text-overlay\x22\x20style=\x22display:\x20none;\x22><div\x20class=\x22photo-description\x22>'+(_0x2b3438[_0x3849e5(0x18cb)]||_0x2b3438[_0x3849e5(0x1423)])+_0x3849e5(0x11fe);else{if(_0x2b3438[_0x3849e5(0x23df)]===_0x3849e5(0x2c2))_0x23d702='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-message-container\x20sent\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-bubble\x22\x20style=\x22background-color:\x20'+_0x79d528+_0x3849e5(0x1ad7)+_0x572964+_0x3849e5(0x1de5)+_0xdb0e82+_0x3849e5(0x1b14)+_0x2b3438[_0x3849e5(0x1423)]+_0x3849e5(0x24da)+(_0x2b3438[_0x3849e5(0x1ff)]||Math[_0x3849e5(0x910)](0x1,Math[_0x3849e5(0x1462)](_0x2b3438[_0x3849e5(0x1423)]['length']/0x8)))+_0x3849e5(0x256c)+(_0xa2d76f&&_0xea0388==='bubble'?_0x3849e5(0xe44)+formatTimeOnly(_0x2b3438[_0x3849e5(0x7aa)])+_0x3849e5(0xa54):'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0xa2d76f&&_0xea0388===_0x3849e5(0x151c)?'<div\x20class=\x22timestamp\x20timestamp-inside\x22>'+formatTimeOnly(_0x2b3438[_0x3849e5(0x7aa)])+'</div>':'')+_0x3849e5(0x9a8)+_0x2b3438[_0x3849e5(0x1423)]+_0x3849e5(0x931);else{if(_0x2b3438[_0x3849e5(0x23df)]===_0x3849e5(0xd8)){let _0x1121e3='',_0xa49706='';if(_0x2b3438[_0x3849e5(0xe54)]===_0x3849e5(0x15d2)){const _0x445113=_0x2b3438[_0x3849e5(0x65d)]?_0x2b3438[_0x3849e5(0x65d)]+'已收款':_0x3849e5(0x1dd9);_0xa49706=_0x3849e5(0x1f14)+_0x445113+_0x3849e5(0xa54),_0x1121e3=_0x3849e5(0x15d2);}else{if(_0x2b3438['status']===_0x3849e5(0x1164)){const _0x2589c7=_0x2b3438[_0x3849e5(0x65d)]?_0x2b3438[_0x3849e5(0x65d)]+_0x3849e5(0x939):_0x3849e5(0x1213);_0xa49706=_0x3849e5(0x1f14)+_0x2589c7+_0x3849e5(0xa54),_0x1121e3=_0x3849e5(0x1164);}}let _0x566c75=_0x3849e5(0x1578);_0x2b3438[_0x3849e5(0x65d)]&&(_0x566c75=_0x3849e5(0x2268)+_0x2b3438[_0x3849e5(0x65d)]),_0x23d702=_0x3849e5(0x4be)+_0x1121e3+'\x22\x20data-transfer-id=\x22'+_0x2b3438['timestamp']+_0x3849e5(0x2147)+_0x566c75+_0x3849e5(0x1824)+Number(_0x2b3438['amount'])['toFixed'](0x2)+_0x3849e5(0x745)+(_0x2b3438[_0x3849e5(0x15fe)]||'转账')+_0x3849e5(0x1e0f)+_0xa49706+_0x3849e5(0xdbd);}else{if(_0x2b3438[_0x3849e5(0x23df)]===_0x3849e5(0x63b))_0x23d702='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22location-message-container\x20sent\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22location-card\x22\x20onclick=\x22showLocationDetail(\x27'+_0x2b3438[_0x3849e5(0xf7e)]+_0x3849e5(0x1c48)+_0x2b3438[_0x3849e5(0xf7e)]+_0x3849e5(0x21de);else{if(Array[_0x3849e5(0x1bcc)](_0x2b3438[_0x3849e5(0x1423)])){const _0xc321c1=_0x2b3438[_0x3849e5(0x1423)]['find'](_0xb6865b=>_0xb6865b[_0x3849e5(0x23df)]===_0x3849e5(0x1e58)),_0x581fc7=_0x2b3438['content'][_0x3849e5(0x1aeb)](_0x5aaa02=>_0x5aaa02[_0x3849e5(0x23df)]==='image_url');let _0x506f82=_0xc321c1?.['text']||'';_0x506f82=processMentions(_0x506f82),_0x2b3438[_0x3849e5(0x180)]?_0x23d702=generateReplyHTML(_0x2b3438[_0x3849e5(0x180)])+_0x506f82:_0x23d702=_0x506f82,_0x581fc7?.[_0x3849e5(0x1cfa)]?.[_0x3849e5(0x10c6)]&&(_0x23d702&&(_0x23d702+=_0x3849e5(0x365)),_0x23d702+='<img\x20src=\x22'+_0x581fc7['image_url'][_0x3849e5(0x10c6)]+_0x3849e5(0x2183)+(_0x2b3438['isEmoji']?'message-emoji':_0x3849e5(0x548))+'\x22\x20onclick=\x22showImage(\x27'+_0x581fc7[_0x3849e5(0x1cfa)][_0x3849e5(0x10c6)]+'\x27)\x22>');}else{let _0x5343d8=_0x2b3438['content'];_0x5343d8=processMentions(_0x5343d8),_0x2b3438[_0x3849e5(0x180)]?_0x23d702=generateReplyHTML(_0x2b3438[_0x3849e5(0x180)])+_0x5343d8:_0x23d702=_0x5343d8;}}}}}let _0x16ed7d='';_0x2b3438['type']===_0x3849e5(0x14a6)||_0x2b3438[_0x3849e5(0x23df)]==='voice'||_0x2b3438[_0x3849e5(0x23df)]==='transfer'||_0x2b3438['type']===_0x3849e5(0x63b)||_0x2b3438[_0x3849e5(0x23df)]===_0x3849e5(0x14f2)||_0x2b3438[_0x3849e5(0x23df)]===_0x3849e5(0x8fa)||_0x2b3438[_0x3849e5(0x23df)]===_0x3849e5(0x674)?_0x16ed7d=_0x23d702:_0x16ed7d='<div\x20class=\x22message-bubble\x22\x20style=\x22background-color:\x20'+_0x79d528+';\x20color:\x20'+_0x572964+';\x20position:\x20relative;\x20padding:\x20'+_0xdb0e82+_0x3849e5(0x238)+_0x23d702+(_0x2b3438[_0x3849e5(0xe5b)]&&!_0x2b3438[_0x3849e5(0x23df)]&&!Array['isArray'](_0x2b3438[_0x3849e5(0x1423)])?_0x3849e5(0x2001)+_0x2b3438[_0x3849e5(0xe5b)]+_0x3849e5(0x2183)+(_0x2b3438[_0x3849e5(0xe29)]?'message-emoji':_0x3849e5(0x548))+_0x3849e5(0x1e66)+_0x2b3438[_0x3849e5(0xe5b)]+_0x3849e5(0x1ccf):'')+(_0xa2d76f&&_0xea0388===_0x3849e5(0x849)?_0x3849e5(0xe44)+formatTimeOnly(_0x2b3438[_0x3849e5(0x7aa)])+'</div>':'')+(_0xa2d76f&&_0xea0388==='inside'?_0x3849e5(0x1a87)+formatTimeOnly(_0x2b3438[_0x3849e5(0x7aa)])+'</div>':'')+_0x3849e5(0xa54);let _0x4fcdb6='';!_0x1d363a[_0x3849e5(0x1e22)]&&(_0x4fcdb6=generateAvatarHtml({'avatarUrl':_0x2beadc,'backgroundColor':'#007AFF','displayName':'','timestamp':_0x2b3438[_0x3849e5(0x7aa)],'timestampEnabled':_0xa2d76f,'timestampPosition':_0xea0388,'chatSettings':_0x1d363a})),_0x1d431d[_0x3849e5(0xc02)]=_0x16ed7d+_0x4fcdb6;}addBlockedIndicatorToMessage(_0x1d431d,_0x2b3438,_0x208bff),addMessageLongPressListener(_0x1d431d,_0x2b3438['id']);const _0x125c8c=_0x1d431d[_0x3849e5(0x15b8)](_0x3849e5(0x37c));_0x125c8c&&(_0x125c8c['addEventListener'](_0x3849e5(0xd3e),_0x1e10e0=>{const _0x2de490=_0x3849e5;_0x1e10e0[_0x2de490(0x4d9)](),showMessageMenu(_0x2b3438['id'],_0x1e10e0);}),_0x125c8c[_0x3849e5(0x11cf)]=_0x339b7d=>{const _0x4c0c70=_0x3849e5;_0x339b7d[_0x4c0c70(0x1144)][_0x4c0c70(0x246c)]===_0x4c0c70(0xb84)&&_0x339b7d[_0x4c0c70(0x1144)]['classList'][_0x4c0c70(0x1f9)](_0x4c0c70(0x548))&&showImage(_0x339b7d['target'][_0x4c0c70(0x107)]);});const _0x2d7729=_0x2ed033['querySelector']('.load-more-messages');_0x2d7729?_0x2d7729[_0x3849e5(0xe9)][_0x3849e5(0x1806)](_0x1d431d,_0x2d7729[_0x3849e5(0x91f)]):_0x2ed033[_0x3849e5(0x1806)](_0x1d431d,_0x2ed033[_0x3849e5(0x1bd8)]);}currentMessageOffset=_0x499782,setTimeout(()=>{const _0x134707=_0x3849e5,_0x3ea7d8=_0x2ed033[_0x134707(0x14c8)];_0x2ed033[_0x134707(0x5e5)]=_0x1e6ce8+(_0x3ea7d8-_0x35c50a);},0x32);}function showCharacterForm(_0xa37a5e=null){const _0xccba8f=_0x2cf6d4;currentEditingCharacterId=_0xa37a5e,document['getElementById']('character-form-title')[_0xccba8f(0x21dc)]=_0xa37a5e?_0xccba8f(0x1fd9):_0xccba8f(0xdcc),document[_0xccba8f(0x566)](_0xccba8f(0x6e2))[_0xccba8f(0xc34)]='',document[_0xccba8f(0x566)](_0xccba8f(0x445))[_0xccba8f(0xc34)]='',document['getElementById'](_0xccba8f(0x1d44))[_0xccba8f(0xc34)]='';const _0xbabe5e=document['getElementById']('avatar-preview'),_0x1469fd=document[_0xccba8f(0x566)](_0xccba8f(0x7c3));_0xbabe5e[_0xccba8f(0x226e)][_0xccba8f(0x128)](_0xccba8f(0x1d41)),_0xbabe5e[_0xccba8f(0x655)][_0xccba8f(0xdae)](_0xccba8f(0xc3c)),_0xbabe5e['style']['removeProperty']('background-size'),_0xbabe5e[_0xccba8f(0x655)]['removeProperty'](_0xccba8f(0x2dd)),_0xbabe5e[_0xccba8f(0x655)]['removeProperty'](_0xccba8f(0x1f6c)),_0x1469fd['style'][_0xccba8f(0x2526)]='block',_0x1469fd[_0xccba8f(0x21dc)]='A',window[_0xccba8f(0x151a)]=null;if(_0xa37a5e){const _0x29bac9=characters['find'](_0x2a6858=>_0x2a6858['id']===_0xa37a5e);_0x29bac9&&(document[_0xccba8f(0x566)](_0xccba8f(0x6e2))['value']=_0x29bac9['name'],document[_0xccba8f(0x566)](_0xccba8f(0x445))['value']=_0x29bac9[_0xccba8f(0x1a84)],_0x29bac9[_0xccba8f(0x10f9)]?(_0xbabe5e['classList'][_0xccba8f(0xe1)](_0xccba8f(0x1d41)),_0xbabe5e[_0xccba8f(0x655)]['setProperty'](_0xccba8f(0xc3c),_0xccba8f(0xcb5)+_0x29bac9['avatarUrl']+')',_0xccba8f(0x153c)),_0xbabe5e[_0xccba8f(0x655)][_0xccba8f(0x16db)](_0xccba8f(0x1264),_0xccba8f(0xe3e),'important'),_0xbabe5e[_0xccba8f(0x655)][_0xccba8f(0x16db)]('background-position',_0xccba8f(0x23a1),_0xccba8f(0x153c)),_0xbabe5e[_0xccba8f(0x655)][_0xccba8f(0x16db)](_0xccba8f(0x1f6c),_0xccba8f(0x190),_0xccba8f(0x153c)),_0x1469fd[_0xccba8f(0x655)]['display']=_0xccba8f(0xfe9),window[_0xccba8f(0x151a)]=_0x29bac9[_0xccba8f(0x10f9)]):_0x1469fd[_0xccba8f(0x21dc)]=_0x29bac9['name'][_0xccba8f(0x1518)](0x0));}const _0x2ce66f=document[_0xccba8f(0x566)](_0xccba8f(0x1260)),_0xf19924=document[_0xccba8f(0x566)](_0xccba8f(0xe0f)),_0x244ba7=document['getElementById']('export-character-btn');console[_0xccba8f(0xc0d)](_0xccba8f(0xd9e),_0xa37a5e);if(_0xa37a5e){document[_0xccba8f(0x15b8)](_0xccba8f(0x16a6))['onclick']=async()=>await saveCharacter(_0xa37a5e);if(_0x2ce66f)_0x2ce66f['style']['display']=_0xccba8f(0x2d4);if(_0xf19924)_0xf19924[_0xccba8f(0x655)][_0xccba8f(0x2526)]='none';if(_0x244ba7)_0x244ba7['style'][_0xccba8f(0x2526)]=_0xccba8f(0x1f0b);console['log'](_0xccba8f(0x111e),_0xa37a5e);}else{document['querySelector'](_0xccba8f(0x16a6))[_0xccba8f(0x11cf)]=async()=>await saveCharacter();if(_0x2ce66f)_0x2ce66f[_0xccba8f(0x655)][_0xccba8f(0x2526)]='none';if(_0xf19924)_0xf19924[_0xccba8f(0x655)]['display']='flex';if(_0x244ba7)_0x244ba7['style'][_0xccba8f(0x2526)]=_0xccba8f(0xfe9);console['log'](_0xccba8f(0xa89));}showApp(_0xccba8f(0xb53)),setTimeout(()=>{initializeAvatarUpload();},0x64);}async function saveCharacter(_0x1e4237=null){const _0xda6ba=_0x2cf6d4;try{console['log'](_0xda6ba(0x1e82));const _0x3cd8f6=document[_0xda6ba(0x566)](_0xda6ba(0x6e2))[_0xda6ba(0xc34)][_0xda6ba(0x1424)](),_0x467535=document[_0xda6ba(0x566)](_0xda6ba(0x445))[_0xda6ba(0xc34)][_0xda6ba(0x1424)](),_0x595eb5=window['selectedAvatarData'];console[_0xda6ba(0xc0d)](_0xda6ba(0x15f2),_0x3cd8f6,_0xda6ba(0xad1),!!_0x595eb5);_0x595eb5&&console[_0xda6ba(0xc0d)](_0xda6ba(0x184c),_0x595eb5[_0xda6ba(0xcbf)],'开头:',_0x595eb5['substring'](0x0,0x32));if(!_0x3cd8f6){alert('请输入姓名');return;}if(_0x1e4237){console[_0xda6ba(0xc0d)](_0xda6ba(0x1c0a));const _0x14db10=characters[_0xda6ba(0x23ba)](_0x2519c3=>_0x2519c3['id']===_0x1e4237);if(_0x14db10!==-0x1){const _0x310945=characters[_0x14db10][_0xda6ba(0x10f9)];characters[_0x14db10]={...characters[_0x14db10],'name':_0x3cd8f6,'bio':_0x467535,'avatarUrl':_0x595eb5||characters[_0x14db10][_0xda6ba(0x10f9)]||'','color':characters[_0x14db10][_0xda6ba(0x2099)]||getRandomColor()},console['log'](_0xda6ba(0x123d),characters[_0x14db10]),_0x595eb5&&_0x595eb5!==_0x310945&&updateCharacterAvatarInGroups(_0x1e4237,_0x595eb5),await saveCharacters(),renderContactList(),renderMessageList(),currentChatCharacter&&currentChatCharacter['id']===_0x1e4237&&renderChatMessages(currentChatCharacter['id']),showToast('角色\x20\x22'+_0x3cd8f6+_0xda6ba(0x1888),_0xda6ba(0xb27)),hideCharacterForm();}}else{console[_0xda6ba(0xc0d)](_0xda6ba(0x21f3));const _0x12f743={'id':Date['now']()[_0xda6ba(0x9a3)](),'name':_0x3cd8f6,'bio':_0x467535,'avatarUrl':_0x595eb5||'','color':getRandomColor(),'groupId':_0xda6ba(0xf58)};console[_0xda6ba(0xc0d)](_0xda6ba(0xebb),_0x12f743),console[_0xda6ba(0xc0d)](_0xda6ba(0x2075),_0x12f743['avatarUrl']),console[_0xda6ba(0xc0d)](_0xda6ba(0x100d),_0x12f743[_0xda6ba(0x10f9)]?_0x12f743[_0xda6ba(0x10f9)][_0xda6ba(0xcbf)]:0x0),console[_0xda6ba(0xc0d)](_0xda6ba(0x16f),characters[_0xda6ba(0xcbf)]),characters[_0xda6ba(0x6ee)](_0x12f743),console[_0xda6ba(0xc0d)](_0xda6ba(0x91a),characters[_0xda6ba(0xcbf)]),console[_0xda6ba(0xc0d)]('角色数组最新状态:',characters),console['log'](_0xda6ba(0xabd)),await saveCharacters(),console[_0xda6ba(0xc0d)](_0xda6ba(0x2537),characters),console['log'](_0xda6ba(0xadf)),renderContactList(),renderMessageList(),console[_0xda6ba(0xc0d)](_0xda6ba(0x87f)),hideCharacterForm(),showToast(_0xda6ba(0x11e6)+_0x12f743['name']+_0xda6ba(0x1e88),_0xda6ba(0xb27)),console[_0xda6ba(0xc0d)](_0xda6ba(0x254f));}}catch(_0x24dd8a){console[_0xda6ba(0x24ab)](_0xda6ba(0x109e),_0x24dd8a),alert('保存角色时发生错误:\x20'+_0x24dd8a[_0xda6ba(0xd7a)]);}}function clearCharacterForm(){const _0x1cdada=_0x2cf6d4;console['log'](_0x1cdada(0x82f)),document[_0x1cdada(0x566)](_0x1cdada(0x6e2))[_0x1cdada(0xc34)]='',document[_0x1cdada(0x566)]('character-bio')[_0x1cdada(0xc34)]='',document[_0x1cdada(0x566)](_0x1cdada(0x1d44))[_0x1cdada(0xc34)]='';const _0x217d6a=document[_0x1cdada(0x566)](_0x1cdada(0x524)),_0x18ba03=document[_0x1cdada(0x566)]('avatar-preview-text');_0x217d6a[_0x1cdada(0x226e)][_0x1cdada(0x128)](_0x1cdada(0x1d41)),_0x217d6a[_0x1cdada(0x655)][_0x1cdada(0xdae)](_0x1cdada(0xc3c)),_0x217d6a[_0x1cdada(0x655)][_0x1cdada(0xdae)]('background-size'),_0x217d6a[_0x1cdada(0x655)][_0x1cdada(0xdae)](_0x1cdada(0x2dd)),_0x217d6a['style'][_0x1cdada(0xdae)](_0x1cdada(0x1f6c)),_0x18ba03&&(_0x18ba03[_0x1cdada(0x655)]['display']=_0x1cdada(0x2d4),_0x18ba03[_0x1cdada(0x21dc)]='A'),console[_0x1cdada(0xc0d)]('清除临时头像数据'),window[_0x1cdada(0x151a)]=null;}function editCharacter(_0x4c3965){showCharacterForm(_0x4c3965);}function editCharacterFromContactList(_0x7ca7f3){showCharacterForm(_0x7ca7f3);}function enterMultiSelectMode(_0x2c8d86){const _0xa40dd2=_0x2cf6d4,_0x2fed8c=document['getElementById'](_0xa40dd2(0x308));if(_0x2fed8c)_0x2fed8c['remove']();isGroupManageMode?previousModeBeforeMultiSelect='groupManage':previousModeBeforeMultiSelect=_0xa40dd2(0x1673),isGroupManageMode=![],isMultiSelectMode=!![],selectedCharacters=[_0x2c8d86],renderContactList();}function exitMultiSelectMode(){const _0x4aae34=_0x2cf6d4;isMultiSelectMode=![],selectedCharacters=[],previousModeBeforeMultiSelect===_0x4aae34(0x133b)?isGroupManageMode=!![]:isGroupManageMode=![],previousModeBeforeMultiSelect=null,renderContactList();}function toggleCharacterSelection(_0xafcbaf){const _0x327cd0=_0x2cf6d4,_0x1e9dc0=selectedCharacters[_0x327cd0(0x167a)](_0xafcbaf);_0x1e9dc0>-0x1?selectedCharacters['splice'](_0x1e9dc0,0x1):selectedCharacters[_0x327cd0(0x6ee)](_0xafcbaf),renderContactList();}async function deleteSelectedCharacters(){const _0x3c7b8e=_0x2cf6d4;if(selectedCharacters['length']===0x0){alert(_0x3c7b8e(0x1ee8));return;}const _0x326a86=selectedCharacters[_0x3c7b8e(0xf6d)](_0x1326ea=>{const _0x46509e=characters['find'](_0x3de160=>_0x3de160['id']===_0x1326ea);return _0x46509e?_0x46509e['name']:'';})[_0x3c7b8e(0x803)](_0x25a057=>_0x25a057)['join']('、');if(confirm(_0x3c7b8e(0x251)+_0x326a86+_0x3c7b8e(0x88c))){selectedCharacters[_0x3c7b8e(0x900)](_0x5bebb0=>{const _0x7c0a63=_0x3c7b8e;characters=characters[_0x7c0a63(0x803)](_0x3bf54f=>_0x3bf54f['id']!==_0x5bebb0),contacts=contacts[_0x7c0a63(0x803)](_0x3a8673=>_0x3a8673!==_0x5bebb0),chatMessages[_0x5bebb0]&&delete chatMessages[_0x5bebb0];}),await saveCharacters(),await saveContacts();try{await saveChatMessagesImmediate(selectedCharacterIds),console[_0x3c7b8e(0xc0d)](_0x3c7b8e(0x2114));}catch(_0x330e0f){console[_0x3c7b8e(0x24ab)]('批量删除消息保存失败，回退到全量保存:',_0x330e0f),await saveChatMessages();}exitMultiSelectMode(),renderMessageList(),alert('角色删除成功');}}async function deleteCurrentCharacter(){const _0x5f4d79=_0x2cf6d4;if(currentEditingCharacterId){const _0x549dbb=characters['find'](_0x154dc2=>_0x154dc2['id']===currentEditingCharacterId);if(_0x549dbb&&confirm('确定要删除角色\x22'+_0x549dbb[_0x5f4d79(0x222f)]+'\x22吗？\x0a\x0a此操作将删除角色数据、聊天记录和所有设置，不可恢复！')){characters=characters[_0x5f4d79(0x803)](_0x30c4c0=>_0x30c4c0['id']!==_0x549dbb['id']),contacts=contacts['filter'](_0x58db31=>_0x58db31!==_0x549dbb['id']);chatMessages[_0x549dbb['id']]&&delete chatMessages[_0x549dbb['id']];try{await db[_0x5f4d79(0xb08)]['delete'](_0x549dbb['id']),chatSettings[_0x549dbb['id']]&&delete chatSettings[_0x549dbb['id']],localStorage[_0x5f4d79(0x1c95)]('chatSettings_'+_0x549dbb['id']),console[_0x5f4d79(0xc0d)](_0x5f4d79(0x1947)+_0x549dbb[_0x5f4d79(0x222f)]+_0x5f4d79(0x58e));}catch(_0x589a6c){console[_0x5f4d79(0x24ab)](_0x5f4d79(0x18d7)+_0x549dbb[_0x5f4d79(0x222f)]+_0x5f4d79(0x1e4d),_0x589a6c);}await saveCharacters(),await saveContacts();try{await saveChatMessagesImmediate([characterId]),console[_0x5f4d79(0xc0d)](_0x5f4d79(0x7a0));}catch(_0x4391c1){console[_0x5f4d79(0x24ab)]('单个删除消息保存失败，回退到全量保存:',_0x4391c1),await saveChatMessages();}renderContactList(),renderMessageList(),hideCharacterForm(),showToast(_0x5f4d79(0x13a3)+_0x549dbb[_0x5f4d79(0x222f)]+_0x5f4d79(0x1a18),_0x5f4d79(0xb27));}}}function updateCharacterAvatarInGroups(_0xbe4e8d,_0x21e074){const _0x21e849=_0x2cf6d4;characters[_0x21e849(0x900)](_0x8d8506=>{const _0x3bd000=_0x21e849;if(_0x8d8506[_0x3bd000(0x4b7)]&&_0x8d8506[_0x3bd000(0xcaa)]){const _0x32169e=_0x8d8506[_0x3bd000(0xcaa)][_0x3bd000(0x23ba)](_0x45c012=>_0x45c012['id']===_0xbe4e8d);_0x32169e!==-0x1&&(_0x8d8506[_0x3bd000(0xcaa)][_0x32169e]['avatarUrl']=_0x21e074,console[_0x3bd000(0xc0d)](_0x3bd000(0x413)+_0x8d8506[_0x3bd000(0x222f)]+_0x3bd000(0x18f1)+_0x8d8506[_0x3bd000(0xcaa)][_0x32169e][_0x3bd000(0x222f)]+'\x22\x20的头像'));}}),saveCharacters();}function getRandomColor(){const _0x18f82a=_0x2cf6d4,_0x51a926=['#FF3B30',_0x18f82a(0x142a),_0x18f82a(0x9e8),_0x18f82a(0x22a6),_0x18f82a(0x85f),'#007AFF',_0x18f82a(0x1d36),_0x18f82a(0xf29)];return _0x51a926[Math[_0x18f82a(0x1dac)](Math['random']()*_0x51a926[_0x18f82a(0xcbf)])];}async function startChat(_0x1187b7){const _0x1e0728=_0x2cf6d4;await dataLoadedPromise;const _0x5503f6=currentChatCharacter?currentChatCharacter['id']:null;_0x5503f6&&markAsRead(_0x5503f6);hideTypingIndicator();_0x5503f6&&currentReplyTo&&(chatReplyStates[_0x5503f6]={...currentReplyTo});if(_0x1187b7[_0x1e0728(0x4b7)]){const _0x1f132d=groupChats[_0x1e0728(0x1aeb)](_0x4e359f=>_0x4e359f['id']===_0x1187b7['id']);_0x1f132d?(currentChatCharacter=_0x1f132d,console[_0x1e0728(0xc0d)](_0x1e0728(0xf13),_0x1f132d['name'])):(currentChatCharacter=_0x1187b7,console['warn']('⚠️\x20未找到群聊数据，使用传入的角色对象'));}else{const _0x1e9704=characters[_0x1e0728(0x1aeb)](_0xbb2ffc=>_0xbb2ffc['id']===_0x1187b7['id']);_0x1e9704?(currentChatCharacter=_0x1e9704,console[_0x1e0728(0xc0d)](_0x1e0728(0x12a3),_0x1e9704[_0x1e0728(0x222f)])):(currentChatCharacter=_0x1187b7,console[_0x1e0728(0x17cc)](_0x1e0728(0xef9)));}sessionStorage['setItem'](_0x1e0728(0x1463),_0x1187b7['id']);_0x1187b7[_0x1e0728(0x4b7)]&&(console[_0x1e0728(0xc0d)](_0x1e0728(0x1fe1),_0x1187b7['id']),await GroupChatStateManager[_0x1e0728(0x1a6a)](_0x1187b7['id']));console[_0x1e0728(0xc0d)](_0x1e0728(0x222a),_0x1187b7[_0x1e0728(0x222f)],_0x1e0728(0xc91),_0x1187b7['id']);const _0x513302=await getAsyncChatSettings(_0x1187b7['id']);console[_0x1e0728(0xc0d)](_0x1e0728(0x711),_0x513302[_0x1e0728(0x6a0)]);let _0x240d93=_0x513302[_0x1e0728(0x1967)]||_0x1187b7[_0x1e0728(0x222f)];if(_0x1187b7[_0x1e0728(0x4b7)]&&_0x1187b7[_0x1e0728(0xcaa)]){const _0x18b7cc=_0x1187b7[_0x1e0728(0xcaa)][_0x1e0728(0xcbf)]+0x1;_0x240d93=_0x240d93+'（'+_0x18b7cc+'）';}const _0x448bc3=document['getElementById'](_0x1e0728(0x1cc6));if(_0x448bc3){const _0x41716d=_0x448bc3[_0x1e0728(0x1f26)][_0x1e0728(0x250a)]===_0x1e0728(0x8f1);!_0x41716d?(_0x448bc3[_0x1e0728(0x21dc)]=_0x240d93,_0x448bc3[_0x1e0728(0x226e)][_0x1e0728(0x128)](_0x1e0728(0x478)),_0x448bc3[_0x1e0728(0x1f26)][_0x1e0728(0x1c53)]=_0x240d93,console['log'](_0x1e0728(0x161a),_0x240d93)):(console[_0x1e0728(0xc0d)](_0x1e0728(0x1d70)),setTimeout(()=>{const _0x4feef6=_0x1e0728;_0x448bc3[_0x4feef6(0x1f26)][_0x4feef6(0x250a)]=_0x4feef6(0xc40);},0x7d0));}const _0x5d4f0b=document[_0x1e0728(0x15b8)](_0x1e0728(0x229b));_0x5d4f0b&&renderCharacterStatus(_0x1187b7['id'],_0x5d4f0b);updateAiHeartrate(),setTimeout(async()=>{const _0x2170d1=_0x1e0728,_0x229d91=await getAsyncChatSettings(_0x1187b7['id']);if(_0x229d91[_0x2170d1(0x261)]){const _0x144570=getCharacterStatus(_0x1187b7['id']);(!_0x144570['activity']||_0x144570[_0x2170d1(0x2016)]==='在线')&&(await generateCharacterStatus(_0x1187b7['id']),renderCharacterStatus(_0x1187b7['id'],_0x5d4f0b));}},0x1f4),startCharacterStatusTimer(),updateBlockManageLabel(_0x1187b7[_0x1e0728(0x4b7)]);!chatMessages[_0x1187b7['id']]&&(chatMessages[_0x1187b7['id']]=[],console['log'](_0x1e0728(0x1390)));resetFloatingButtonsState(),updateChatBlockedStatus();document[_0x1e0728(0x566)](_0x1e0728(0x1aa9))['style'][_0x1e0728(0x2526)]===_0x1e0728(0x1f0b)&&updateChatSettingsDisplay();const _0x233a4c=document[_0x1e0728(0x566)](_0x1e0728(0x1a69));if(_0x233a4c){const _0x13db4d=await getAsyncChatSettings(_0x1187b7['id']);_0x233a4c[_0x1e0728(0xc34)]=_0x13db4d[_0x1e0728(0x1f8a)]||'',console[_0x1e0728(0xc0d)](_0x1e0728(0x1296)+_0x1187b7[_0x1e0728(0x222f)]+_0x1e0728(0x1d46)+(_0x13db4d['backgroundDiaryTime']||'未设置'));}const _0x3a3955=document['getElementById'](_0x1e0728(0x1154));if(_0x3a3955){_0x3a3955[_0x1e0728(0x655)][_0x1e0728(0x1584)]=_0x1e0728(0xfe9),_0x3a3955['style'][_0x1e0728(0xacd)]=_0x1e0728(0x241f);_0x1187b7[_0x1e0728(0x4b7)]?_0x3a3955['classList'][_0x1e0728(0xe1)](_0x1e0728(0xd8b)):_0x3a3955[_0x1e0728(0x226e)]['remove'](_0x1e0728(0xd8b));const _0x327e5e=document[_0x1e0728(0x1ed9)](_0x1e0728(0x384));_0x327e5e[_0x1e0728(0x900)](_0x25fd60=>{const _0x488da7=_0x1e0728;_0x1187b7['isGroup']?_0x25fd60[_0x488da7(0x655)][_0x488da7(0x2526)]=_0x488da7(0xfe9):_0x25fd60[_0x488da7(0x655)][_0x488da7(0x2526)]='';});const _0x38da31=document[_0x1e0728(0x566)]('api-chat-messages');if(_0x38da31)_0x38da31['style'][_0x1e0728(0xc3c)]='';}console['log'](_0x1e0728(0x701)+_0x1187b7['name']+_0x1e0728(0x192)+_0x1187b7['id']+')'),await applyChatBackground(),applyBubbleStyle(),applyCustomBubbleCSS(),applyCustomThemeStyles()[_0x1e0728(0x9e5)](_0xbfc286=>console['error'](_0x1e0728(0x120b),_0xbfc286)),initScheduledMomentsSystem(),renderChatMessages(_0x1187b7['id']);if(chatReplyStates[_0x1187b7['id']])currentReplyTo={...chatReplyStates[_0x1187b7['id']]},showReplyPreview();else{currentReplyTo=null;const _0x5e7e58=document[_0x1e0728(0x566)]('reply-preview');_0x5e7e58&&_0x5e7e58[_0x1e0728(0x128)]();}updateCurrentPersonaDisplay(),showApp(_0x1e0728(0x1154));}async function backToChatApp(){const _0x3f6a34=_0x2cf6d4;currentChatCharacter&&markAsRead(currentChatCharacter['id']);sessionStorage[_0x3f6a34(0x1c95)](_0x3f6a34(0x1463));currentChatCharacter&&currentReplyTo&&(chatReplyStates[currentChatCharacter['id']]={...currentReplyTo});const _0x12e97c=document[_0x3f6a34(0x566)](_0x3f6a34(0x1154));_0x12e97c&&_0x12e97c[_0x3f6a34(0x226e)][_0x3f6a34(0x128)](_0x3f6a34(0xd8b));if(currentChatCharacter)try{const _0x53021e=await db[_0x3f6a34(0x8c6)]['where']('chatId')['equals'](currentChatCharacter['id'])['first']();if(_0x53021e&&_0x53021e[_0x3f6a34(0x2e5)]){console[_0x3f6a34(0xc0d)](_0x3f6a34(0xaf2)+currentChatCharacter['id']+'\x20有自定义主题，开始清除...'),clearCustomThemeStyles();const _0x184d73=await db[_0x3f6a34(0x397)][_0x3f6a34(0x46a)](_0x3f6a34(0x219c)),_0x2101b7=_0x184d73?_0x184d73[_0x3f6a34(0x224d)]:null;(!_0x2101b7||_0x2101b7===_0x3f6a34(0x13a8))&&await applyGlobalCustomTheme();}else console[_0x3f6a34(0xc0d)](_0x3f6a34(0xaf2)+currentChatCharacter['id']+_0x3f6a34(0x5c5));}catch(_0x42806){console[_0x3f6a34(0x24ab)](_0x3f6a34(0x1431),_0x42806);}clearCharacterStatusTimer(),hideAiHeartrate(),hideApp(_0x3f6a34(0x1154)),showApp(_0x3f6a34(0xa76));}function backToSettings(_0x4c29ea){const _0x4d207d=_0x2cf6d4;hideApp(_0x4c29ea),showApp(_0x4d207d(0x1f16));}function showTypingIndicator(){const _0x362846=_0x2cf6d4;console[_0x362846(0xc0d)](_0x362846(0x2053));const _0x11c653=document[_0x362846(0x566)](_0x362846(0x1cc6));if(!_0x11c653){console[_0x362846(0x24ab)](_0x362846(0x17e4));return;}!_0x11c653[_0x362846(0x1f26)][_0x362846(0x1c53)]&&(_0x11c653[_0x362846(0x1f26)]['originalTitle']=_0x11c653[_0x362846(0x21dc)]),_0x11c653[_0x362846(0x21dc)]=_0x362846(0xdbe),_0x11c653['classList']['add']('typing-status'),console[_0x362846(0xc0d)](_0x362846(0x326));}function hideTypingIndicator(){const _0x36e93b=_0x2cf6d4;console[_0x36e93b(0xc0d)](_0x36e93b(0xec2));const _0x1fce88=document[_0x36e93b(0x566)](_0x36e93b(0x1cc6));if(!_0x1fce88){console['error'](_0x36e93b(0x17e4));return;}_0x1fce88['dataset'][_0x36e93b(0x1c53)]?(_0x1fce88['textContent']=_0x1fce88[_0x36e93b(0x1f26)][_0x36e93b(0x1c53)],_0x1fce88['classList']['remove']('typing-status'),console['log'](_0x36e93b(0xda6))):console[_0x36e93b(0xc0d)]('⚠️\x20未找到原始标题，可能已被清除');}function addSystemMessageToChat(_0x1da6bc){const _0x437ef2=_0x2cf6d4,_0x3ff9c0=document[_0x437ef2(0x566)](_0x437ef2(0x24e7));if(!_0x3ff9c0)return;const _0xb97ca6=document['createElement'](_0x437ef2(0x526));_0xb97ca6[_0x437ef2(0x655)][_0x437ef2(0x2526)]=_0x437ef2(0x1f0b),_0xb97ca6[_0x437ef2(0x655)]['justifyContent']=_0x437ef2(0x23a1),_0xb97ca6['style']['margin']=_0x437ef2(0x23dd);const _0x507c2a=document[_0x437ef2(0x1ad8)](_0x437ef2(0x526));_0x1da6bc[_0x437ef2(0x158d)]?_0x507c2a[_0x437ef2(0x221)]=_0x437ef2(0xe93):_0x507c2a['className']=_0x437ef2(0x21a7),_0x507c2a[_0x437ef2(0x21dc)]=_0x1da6bc[_0x437ef2(0x1423)],_0xb97ca6[_0x437ef2(0x1925)](_0x507c2a),_0x3ff9c0[_0x437ef2(0x1925)](_0xb97ca6),setTimeout(()=>{const _0x14d789=_0x437ef2;_0x3ff9c0['scrollTop']=_0x3ff9c0[_0x14d789(0x14c8)];},0x64);}async function handleRecalledMessage(_0x51304e,_0x5edc4b=null){const _0x5b7159=_0x2cf6d4;if(!currentChatCharacter)return;console['log'](_0x5b7159(0x1ced),_0x51304e,_0x5b7159(0xf55),_0x5edc4b);if(window['_isRecalling']){console[_0x5b7159(0x17cc)](_0x5b7159(0xfd4));return;}window[_0x5b7159(0x68c)]=!![];try{if(_0x5edc4b){const _0xba189d=chatMessages[currentChatCharacter['id']]||[],_0x30c2cf=_0xba189d[_0x5b7159(0x1aeb)](_0x2f04df=>_0x2f04df['id']===_0x5edc4b);if(_0x30c2cf){if(_0x30c2cf[_0x5b7159(0x1dfd)]||_0x30c2cf[_0x5b7159(0x23df)]===_0x5b7159(0x1e4b)){console[_0x5b7159(0x17cc)](_0x5b7159(0x1765));return;}console[_0x5b7159(0xc0d)]('🔥\x20[AI撤回]\x20找到要撤回的现有消息，使用统一撤回逻辑'),await new Promise(_0x58b219=>setTimeout(_0x58b219,0x4b0)),await _internalRecallMessage(currentChatCharacter['id'],_0x30c2cf);return;}else{console['warn'](_0x5b7159(0x1dcb)),await _0x39b977(_0x51304e);return;}}else{await _0x39b977(_0x51304e);return;}}finally{window[_0x5b7159(0x68c)]=![];}async function _0x39b977(_0x43c721){const _0x5e1a1d=_0x5b7159,_0x573ef6=document['getElementById'](_0x5e1a1d(0x24e7));if(!_0x573ef6)return null;const _0x1c20ec=characters[_0x5e1a1d(0x1aeb)](_0x2a260b=>_0x2a260b['id']===currentChatCharacter['id']),_0x1f6a46=getCurrentChatSettings(),_0x4bc37e=_0x1f6a46[_0x5e1a1d(0x1967)]||_0x1c20ec[_0x5e1a1d(0x222f)],_0xa0d8ae=_0x5e1a1d(0xbb9)+Date[_0x5e1a1d(0x18e0)]()+'_'+Math[_0x5e1a1d(0x191c)]()['toString'](0x24)[_0x5e1a1d(0x18cf)](0x2,0x9),_0x4a7107=document[_0x5e1a1d(0x1ad8)]('div'),_0x46bb82=![];_0x4a7107[_0x5e1a1d(0x221)]=_0x5e1a1d(0x18d0)+(_0x46bb82?'\x20emoji-only':''),_0x4a7107['dataset'][_0x5e1a1d(0x61f)]=_0xa0d8ae;const _0x295441=_0x1f6a46[_0x5e1a1d(0x2116)]||'#f0f0f0',_0x3fa8da=_0x1f6a46[_0x5e1a1d(0xaf0)]||'1',_0x480366=isLightColor(_0x295441)?_0x5e1a1d(0x194f):'#fff',_0x285a6a=_0x1f6a46['bubblePadding']||'12',_0x79a202=_0x1f6a46['aiChatAvatar']||_0x1c20ec[_0x5e1a1d(0x10f9)];let _0x3a4c96='';!_0x1f6a46[_0x5e1a1d(0x1e22)]&&(_0x3a4c96=_0x5e1a1d(0x1db3)+_0x1c20ec['color']+';\x20'+(_0x79a202?_0x5e1a1d(0x1910)+_0x79a202+_0x5e1a1d(0x1051):'')+'\x22\x20onclick=\x22pokeCharacter(\x27'+_0x1c20ec['id']+_0x5e1a1d(0x1bea)+(_0x79a202?'':_0x4bc37e[_0x5e1a1d(0x1518)](0x0))+_0x5e1a1d(0x9ca));const _0x1c6cea=convertColorWithOpacity(_0x295441,_0x3fa8da);let _0x5e5894='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-bubble\x22\x20style=\x22background-color:\x20'+_0x1c6cea+';\x20color:\x20'+_0x480366+_0x5e1a1d(0x1de5)+_0x285a6a+_0x5e1a1d(0x14f4)+_0x43c721+_0x5e1a1d(0x13b);_0x4a7107[_0x5e1a1d(0xc02)]=_0x3a4c96+_0x5e5894,_0x573ef6[_0x5e1a1d(0x1925)](_0x4a7107),_0x573ef6[_0x5e1a1d(0x5e5)]=_0x573ef6[_0x5e1a1d(0x14c8)],await new Promise(_0x5c9d58=>setTimeout(_0x5c9d58,0x4b0));const _0x37040a={'id':_0xa0d8ae,'sender':_0x5e1a1d(0x232),'content':_0x43c721,'timestamp':Date[_0x5e1a1d(0x18e0)]()};return!chatMessages[currentChatCharacter['id']]&&(chatMessages[currentChatCharacter['id']]=[]),chatMessages[currentChatCharacter['id']][_0x5e1a1d(0x6ee)](_0x37040a),await _internalRecallMessage(currentChatCharacter['id'],_0x37040a),_0x4a7107;}}function getRecentUserImage(){const _0xa0f6fa=_0x2cf6d4;if(!currentChatCharacter||!chatMessages[currentChatCharacter['id']])return null;const _0xb98782=chatMessages[currentChatCharacter['id']];for(let _0x440feb=_0xb98782[_0xa0f6fa(0xcbf)]-0x1;_0x440feb>=0x0;_0x440feb--){const _0x5321b7=_0xb98782[_0x440feb];if(_0x5321b7['sender']===_0xa0f6fa(0xfda)&&!_0x5321b7[_0xa0f6fa(0xe29)]){if(Array[_0xa0f6fa(0x1bcc)](_0x5321b7[_0xa0f6fa(0x1423)])){const _0x4454b3=_0x5321b7[_0xa0f6fa(0x1423)][_0xa0f6fa(0x1aeb)](_0x30ddc6=>_0x30ddc6[_0xa0f6fa(0x23df)]==='image_url');if(_0x4454b3&&_0x4454b3[_0xa0f6fa(0x1cfa)]&&_0x4454b3[_0xa0f6fa(0x1cfa)]['url'])return console[_0xa0f6fa(0xc0d)]('找到用户最近发送的图片(多模态格式):',_0x4454b3[_0xa0f6fa(0x1cfa)]['url']),_0x4454b3[_0xa0f6fa(0x1cfa)][_0xa0f6fa(0x10c6)];}else{if(_0x5321b7[_0xa0f6fa(0xe5b)])return console[_0xa0f6fa(0xc0d)](_0xa0f6fa(0x1a42),_0x5321b7[_0xa0f6fa(0xe5b)]),_0x5321b7[_0xa0f6fa(0xe5b)];}}}return console['log'](_0xa0f6fa(0xb0d)),null;}async function callChatAPI(_0x263ac6,_0x2c7d1e){const _0x26cf2d=_0x2cf6d4;try{let _0x4c757b=null;try{_0x4c757b=await db['chatSettings']['get'](_0x2c7d1e['id']);}catch(_0xbfbdd1){console['error']('获取聊天设置失败:',_0xbfbdd1);}const _0x54fccc=_0x2c7d1e[_0x26cf2d(0x1a84)]||_0x2c7d1e[_0x26cf2d(0x1f8f)]||'你是'+_0x2c7d1e[_0x26cf2d(0x222f)]+'。';let _0x5b99ff='';if(_0x4c757b?.[_0x26cf2d(0x1cee)]&&_0x4c757b['linkedWorldBookIds'][_0x26cf2d(0xcbf)]>0x0)try{const _0x3fee7a=await Promise[_0x26cf2d(0x2339)](_0x4c757b['linkedWorldBookIds'][_0x26cf2d(0xf6d)](_0x3a7f61=>db['worldbooks'][_0x26cf2d(0x46a)](_0x3a7f61))),_0x4a03d1=_0x3fee7a[_0x26cf2d(0x803)](_0x387674=>_0x387674&&_0x387674[_0x26cf2d(0x1423)]);_0x4a03d1[_0x26cf2d(0xcbf)]>0x0&&(_0x5b99ff=_0x26cf2d(0xd4c)+_0x4a03d1[_0x26cf2d(0xf6d)](_0x5e9595=>_0x5e9595['name']+'：'+_0x5e9595[_0x26cf2d(0x1423)])[_0x26cf2d(0x140c)]('\x0a\x0a'));}catch(_0x44250c){console[_0x26cf2d(0x24ab)](_0x26cf2d(0xf5c),_0x44250c);}let _0x41593b='';const _0xe1ac06=chatMessages[_0x2c7d1e['id']]||[];if(_0xe1ac06[_0x26cf2d(0xcbf)]>0x0){const _0x143ed2=parseInt(_0x4c757b?.[_0x26cf2d(0x1c8e)])||0xa,_0x7631b4=_0xe1ac06[_0x26cf2d(0x136)](-_0x143ed2);_0x41593b='\x0a\x0a最近的聊天记录（供参考）：\x0a'+_0x7631b4[_0x26cf2d(0xf6d)](_0x4a4df9=>{const _0x3281f4=_0x26cf2d;if(_0x4a4df9[_0x3281f4(0xf75)]===_0x3281f4(0xfda))return _0x3281f4(0x1e7e)+_0x4a4df9[_0x3281f4(0x1423)];return _0x2c7d1e[_0x3281f4(0x222f)]+'：'+_0x4a4df9[_0x3281f4(0x1423)];})[_0x26cf2d(0x140c)]('\x0a');}const _0x44c432='你是'+_0x2c7d1e[_0x26cf2d(0x222f)]+_0x26cf2d(0x1da8)+_0x54fccc+'。'+_0x5b99ff+_0x41593b+_0x26cf2d(0x2576)+_0x263ac6,_0x27d7b0=[{'role':_0x26cf2d(0x212),'content':_0x44c432},{'role':'user','content':_0x263ac6}],{base:_0x3c1116,key:_0x536642,model:_0x2b48fd}=apiSettings;if(!_0x3c1116||!_0x536642||!_0x2b48fd)return console[_0x26cf2d(0xc0d)](_0x26cf2d(0x1a40)),_0x26cf2d(0xf2a);const _0x5b8d8e={'model':_0x2b48fd,'messages':_0x27d7b0,'temperature':0.8,'stream':![]},_0x40cb7d=new AbortController(),_0x186357=setTimeout(()=>_0x40cb7d[_0x26cf2d(0x135b)](),0xea60),_0x1c641a=_0x3c1116['includes']('generativelanguage.googleapis.com');let _0x41f542;if(_0x1c641a){const _0x5a6887=_0x3c1116+'/models/'+_0x2b48fd+_0x26cf2d(0x23aa)+_0x536642,_0x5dff93=[];_0x5b8d8e[_0x26cf2d(0x1767)][0x0]?.['role']===_0x26cf2d(0x212)&&(_0x5dff93['push']({'role':'user','parts':[{'text':_0x5b8d8e[_0x26cf2d(0x1767)][0x0]['content']}]}),_0x5dff93[_0x26cf2d(0x6ee)]({'role':_0x26cf2d(0xeea),'parts':[{'text':'我明白了，我会按照这些要求进行对话。'}]}));for(let _0x133389=0x1;_0x133389<_0x5b8d8e[_0x26cf2d(0x1767)][_0x26cf2d(0xcbf)];_0x133389++){const _0x4ada21=_0x5b8d8e[_0x26cf2d(0x1767)][_0x133389];if(_0x4ada21[_0x26cf2d(0x1562)]==='system')continue;_0x5dff93[_0x26cf2d(0x6ee)]({'role':_0x4ada21[_0x26cf2d(0x1562)]===_0x26cf2d(0x23b2)?_0x26cf2d(0x23b2):'model','parts':[{'text':_0x4ada21['content']}]});}_0x41f542=await fetch(_0x5a6887,{'method':'POST','headers':{'Content-Type':_0x26cf2d(0x302)},'body':JSON['stringify']({'contents':_0x5dff93,'generationConfig':{'temperature':_0x5b8d8e[_0x26cf2d(0x2b0)]||0.8}}),'signal':_0x40cb7d[_0x26cf2d(0x11f5)]});}else{let _0x218590;if(_0x3c1116[_0x26cf2d(0xd7e)](_0x26cf2d(0x812)))_0x218590=_0x3c1116+_0x26cf2d(0xb73);else _0x3c1116[_0x26cf2d(0x23ec)](_0x26cf2d(0x193c))?_0x218590=_0x3c1116+'/chat/completions':_0x218590=_0x3c1116+_0x26cf2d(0xce8);_0x41f542=await fetch(_0x218590,{'method':'POST','headers':{'Content-Type':_0x26cf2d(0x302),'Authorization':_0x26cf2d(0x858)+_0x536642},'body':JSON[_0x26cf2d(0x7fb)](_0x5b8d8e),'signal':_0x40cb7d[_0x26cf2d(0x11f5)]});}clearTimeout(_0x186357);if(!_0x41f542['ok']){let _0x487eaf=await _0x41f542[_0x26cf2d(0x1e58)]();return console[_0x26cf2d(0x24ab)](_0x26cf2d(0x11fd)+_0x41f542[_0x26cf2d(0xe54)]+'):\x20'+_0x487eaf),_0x26cf2d(0x230c)+_0x41f542[_0x26cf2d(0xe54)]+'\x22]';}const _0x17d2b5=await _0x41f542['json']();let _0x267fed;if(_0x1c641a){_0x267fed=_0x17d2b5[_0x26cf2d(0x1d23)]?.[0x0]?.['content']?.['parts']?.[0x0]?.[_0x26cf2d(0x1e58)];if(!_0x267fed)return console[_0x26cf2d(0xc0d)]('Gemini\x20API\x20响应数据:',_0x17d2b5),_0x26cf2d(0x683);}else{if(_0x17d2b5[_0x26cf2d(0x13cf)]&&_0x17d2b5[_0x26cf2d(0x13cf)][_0x26cf2d(0xcbf)]>0x0&&_0x17d2b5['choices'][0x0][_0x26cf2d(0xd7a)])_0x267fed=_0x17d2b5[_0x26cf2d(0x13cf)][0x0][_0x26cf2d(0xd7a)][_0x26cf2d(0x1423)];else{if(_0x17d2b5['message'])_0x267fed=_0x17d2b5[_0x26cf2d(0xd7a)];else{if(_0x17d2b5[_0x26cf2d(0x1e58)])_0x267fed=_0x17d2b5[_0x26cf2d(0x1e58)];else{if(_0x17d2b5[_0x26cf2d(0xc35)])_0x267fed=_0x17d2b5[_0x26cf2d(0xc35)];else{if(_0x17d2b5[_0x26cf2d(0x1423)])_0x267fed=_0x17d2b5['content'];else{if(_0x17d2b5[_0x26cf2d(0x1fff)])_0x267fed=_0x17d2b5['result'];else return console[_0x26cf2d(0x24ab)](_0x26cf2d(0x1377),_0x17d2b5),_0x26cf2d(0x1fbd);}}}}}}return _0x267fed;}catch(_0x25eeb0){return console[_0x26cf2d(0x24ab)]('callChatAPI失败:',_0x25eeb0),_0x26cf2d(0x1ce9)+_0x25eeb0[_0x26cf2d(0xd7a)]+'\x22]';}}async function parseAiResponse(_0x84dbf5){const _0x2aa07d=_0x2cf6d4;console['log']('🔥\x20[DEBUG]\x20parseAiResponse\x20收到的原始内容:',_0x84dbf5);if(!_0x84dbf5||typeof _0x84dbf5!=='string')return console['warn'](_0x2aa07d(0x7c6),_0x84dbf5),[_0x2aa07d(0x1e01)];try{let _0x502963=_0x84dbf5['trim']();if(_0x502963[_0x2aa07d(0x1cab)](_0x2aa07d(0x1ea9)))_0x502963=_0x502963['replace'](/^```json\s*/,'')[_0x2aa07d(0x882)](/\s*```$/,'');else _0x502963['startsWith']('```')&&(_0x502963=_0x502963[_0x2aa07d(0x882)](/^```\s*/,'')[_0x2aa07d(0x882)](/\s*```$/,''));_0x502963=_0x502963[_0x2aa07d(0x882)](/\[ID:\d+\]\s*/g,'');_0x502963!==_0x84dbf5[_0x2aa07d(0x1424)]()&&console[_0x2aa07d(0x17cc)](_0x2aa07d(0xd27));if(_0x502963['includes'](']\x0a,\x0a[')||_0x502963[_0x2aa07d(0x23ec)](_0x2aa07d(0xf6a))||_0x502963[_0x2aa07d(0x23ec)](_0x2aa07d(0x1b32))||_0x502963[_0x2aa07d(0x23ec)](_0x2aa07d(0x194d))||_0x502963[_0x2aa07d(0x23ec)](_0x2aa07d(0x23f2))||_0x502963[_0x2aa07d(0x23ec)]('\x22]\x0a,[\x22')||_0x502963[_0x2aa07d(0x23ec)]('][')||_0x502963[_0x2aa07d(0x23ec)](_0x2aa07d(0x18b1))||_0x502963[_0x2aa07d(0x23ec)](_0x2aa07d(0x3ab))){console['log'](_0x2aa07d(0x1928));try{console['log'](_0x2aa07d(0x36b));const _0x57f716=[];let _0x5dcc27=0x0;while(_0x5dcc27<_0x502963['length']){while(_0x5dcc27<_0x502963[_0x2aa07d(0xcbf)]&&/[\s,]/[_0x2aa07d(0x17ba)](_0x502963[_0x5dcc27])){_0x5dcc27++;}if(_0x5dcc27>=_0x502963['length'])break;if(_0x502963[_0x5dcc27]==='['||_0x502963[_0x5dcc27]==='{'){const _0x356aa7=_0x502963[_0x5dcc27],_0x30600d=_0x356aa7==='['?']':'}';let _0x2c65c3=0x0,_0x5156b3=_0x5dcc27;while(_0x5dcc27<_0x502963['length']){if(_0x502963[_0x5dcc27]===_0x356aa7)_0x2c65c3++;else{if(_0x502963[_0x5dcc27]===_0x30600d){_0x2c65c3--;if(_0x2c65c3===0x0){const _0x32c107=_0x502963[_0x2aa07d(0x4b2)](_0x5156b3,_0x5dcc27+0x1);_0x57f716[_0x2aa07d(0x6ee)](_0x32c107),_0x5dcc27++;break;}}}_0x5dcc27++;}}else _0x5dcc27++;}console[_0x2aa07d(0xc0d)]('🔥\x20[DEBUG]\x20找到',_0x57f716[_0x2aa07d(0xcbf)],'个JSON结构:',_0x57f716);const _0x4e20f4=[];for(const _0x2c813b of _0x57f716){try{const _0x1ebedb=JSON['parse'](_0x2c813b);Array[_0x2aa07d(0x1bcc)](_0x1ebedb)?_0x4e20f4[_0x2aa07d(0x6ee)](..._0x1ebedb):_0x4e20f4[_0x2aa07d(0x6ee)](_0x1ebedb);}catch(_0x551085){console['warn'](_0x2aa07d(0x769),_0x2c813b,_0x551085);}}console[_0x2aa07d(0xc0d)](_0x2aa07d(0x415),_0x4e20f4['length'],_0x2aa07d(0x1130),_0x4e20f4);if(_0x4e20f4[_0x2aa07d(0xcbf)]>0x0){const _0x44c865=_0x4e20f4['map'](_0x198382=>{const _0x68d05a=_0x2aa07d;return typeof _0x198382==='string'?_0x198382[_0x68d05a(0x1424)]()['replace'](/\[ID:\d+\]\s*/g,''):_0x198382;});return console[_0x2aa07d(0xc0d)](_0x2aa07d(0x521),_0x44c865[_0x2aa07d(0xcbf)],_0x2aa07d(0x2418)),_0x44c865;}}catch(_0x22f72f){console[_0x2aa07d(0x17cc)](_0x2aa07d(0x2065),_0x22f72f);const _0xa85d2e=[],_0x198610=_0x502963[_0x2aa07d(0x1316)](/"([^"]+)"/g);_0x198610&&_0x198610[_0x2aa07d(0x900)](_0x169223=>{const _0xd2c06e=_0x2aa07d,_0x33f205=_0x169223[_0xd2c06e(0x136)](0x1,-0x1);_0x33f205[_0xd2c06e(0x1424)]()&&_0xa85d2e[_0xd2c06e(0x6ee)](_0x33f205);});console[_0x2aa07d(0xc0d)]('🔥\x20[DEBUG]\x20回退方案提取到',_0xa85d2e[_0x2aa07d(0xcbf)],_0x2aa07d(0x12b7));if(_0xa85d2e['length']>0x0)return _0xa85d2e;}}const _0x2820d=JSON[_0x2aa07d(0x168e)](_0x502963);console['log'](_0x2aa07d(0x2499),_0x2820d);if(Array[_0x2aa07d(0x1bcc)](_0x2820d)){const _0xe4e904=[];console['log'](_0x2aa07d(0x1fea),_0x2820d['length'],_0x2aa07d(0x416));for(let _0x51ff68=0x0;_0x51ff68<_0x2820d[_0x2aa07d(0xcbf)];_0x51ff68++){const _0x2ce793=_0x2820d[_0x51ff68];console[_0x2aa07d(0xc0d)](_0x2aa07d(0x1d0e)+(_0x51ff68+0x1)+_0x2aa07d(0x67c),typeof _0x2ce793,_0x2ce793);if(typeof _0x2ce793===_0x2aa07d(0x3c4)&&_0x2ce793[_0x2aa07d(0x222f)]&&_0x2ce793[_0x2aa07d(0x23df)]==='emoji'){const _0x45d9eb=await findEmojiForAI(_0x2ce793[_0x2aa07d(0x1c6f)]);_0x45d9eb?(console[_0x2aa07d(0xc0d)](_0x2aa07d(0x4d4),_0x2ce793['description']),_0xe4e904[_0x2aa07d(0x6ee)](_0x2ce793)):(console[_0x2aa07d(0x17cc)](_0x2aa07d(0x1c2f),_0x2ce793[_0x2aa07d(0x1c6f)]),_0xe4e904[_0x2aa07d(0x6ee)]({'name':_0x2ce793[_0x2aa07d(0x222f)],'message':_0x2aa07d(0x113a)+_0x2ce793[_0x2aa07d(0x1c6f)]+_0x2aa07d(0x1d49)}));}else{if(typeof _0x2ce793==='object'&&_0x2ce793[_0x2aa07d(0x23df)]===_0x2aa07d(0x1f41)){const _0x1be79c=await findEmojiForAI(_0x2ce793['description']);if(_0x1be79c){console[_0x2aa07d(0xc0d)](_0x2aa07d(0x4d4),_0x2ce793[_0x2aa07d(0x1c6f)]);const _0x5ba496={'type':_0x2aa07d(0x1f41),'url':_0x1be79c[_0x2aa07d(0x10c6)],'description':_0x1be79c[_0x2aa07d(0x1c6f)],'id':_0x1be79c['id']};_0xe4e904[_0x2aa07d(0x6ee)](_0x5ba496);}else console['warn'](_0x2aa07d(0x1c2f),_0x2ce793[_0x2aa07d(0x1c6f)]),_0xe4e904[_0x2aa07d(0x6ee)](_0x2aa07d(0x113a)+_0x2ce793[_0x2aa07d(0x1c6f)]+'\x22不存在]');}else{if(typeof _0x2ce793===_0x2aa07d(0x3c4)&&_0x2ce793[_0x2aa07d(0x23df)]==='ai_photo'){const _0x9b62f7=_0x2ce793[_0x2aa07d(0x1c6f)]||_0x2aa07d(0x2e0),_0x33d6bc={'type':_0x2aa07d(0x909),'content':_0x9b62f7,'photoDescription':_0x9b62f7};_0x2ce793['name']&&(_0x33d6bc['name']=_0x2ce793[_0x2aa07d(0x222f)]),_0xe4e904[_0x2aa07d(0x6ee)](_0x33d6bc);}else{if(typeof _0x2ce793===_0x2aa07d(0x3c4)&&_0x2ce793[_0x2aa07d(0x23df)]==='location'){const _0xa4456a=_0x2ce793[_0x2aa07d(0xf7e)]||_0x2ce793[_0x2aa07d(0x222f)]||_0x2aa07d(0x254d),_0x4379ca={'type':'location','locationName':_0xa4456a,'coordinates':_0x2ce793['coordinates']||'未知坐标','content':_0x2aa07d(0x2437)+_0xa4456a+']'};if(_0x2ce793[_0x2aa07d(0x222f)]&&_0x2ce793[_0x2aa07d(0xf7e)])_0x4379ca[_0x2aa07d(0x222f)]=_0x2ce793[_0x2aa07d(0x222f)];else{if(_0x2ce793[_0x2aa07d(0x222f)]&&!_0x2ce793[_0x2aa07d(0xf7e)]){}}_0xe4e904[_0x2aa07d(0x6ee)](_0x4379ca);}else{if(typeof _0x2ce793===_0x2aa07d(0x3c4)&&_0x2ce793[_0x2aa07d(0x23df)]===_0x2aa07d(0x777)){if(_0x2ce793['avatar_url']===_0x2aa07d(0xbb3)||_0x2ce793['avatar_url']==='CURRENT_USER_IMAGE'||_0x2ce793['avatar_url']===_0x2aa07d(0xdaf)||_0x2ce793[_0x2aa07d(0xc2e)]===_0x2aa07d(0x1ef1)){const _0x520f5f=getRecentUserImage();_0x520f5f?(_0x2ce793['avatar_url']=_0x520f5f,console[_0x2aa07d(0xc0d)](_0x2aa07d(0x1342),_0x520f5f)):(console[_0x2aa07d(0x17cc)]('没有找到用户最近发送的图片，忽略头像更换请求'),_0xe4e904[_0x2aa07d(0x6ee)](_0x2aa07d(0x1bdf)));}_0xe4e904['push'](_0x2ce793);}else{if(typeof _0x2ce793===_0x2aa07d(0x3c4)&&_0x2ce793[_0x2aa07d(0x23df)]===_0x2aa07d(0xb93))_0xe4e904[_0x2aa07d(0x6ee)](_0x2ce793);else{if(typeof _0x2ce793===_0x2aa07d(0x3c4)&&_0x2ce793[_0x2aa07d(0x23df)]===_0x2aa07d(0x1bfd)){const _0x1a90c3={'type':'voice_message','content':_0x2ce793[_0x2aa07d(0x1423)]||'','duration':_0x2ce793[_0x2aa07d(0x1ff)]||'0\x22'};_0x2ce793[_0x2aa07d(0x222f)]&&(_0x1a90c3[_0x2aa07d(0x222f)]=_0x2ce793[_0x2aa07d(0x222f)]),_0xe4e904['push'](_0x1a90c3);}else{if(typeof _0x2ce793===_0x2aa07d(0x3c4)&&_0x2ce793[_0x2aa07d(0x23df)]===_0x2aa07d(0xd8)){const _0x2464af={'type':_0x2aa07d(0xd8),'amount':_0x2ce793[_0x2aa07d(0xca8)]||0x0,'note':_0x2ce793[_0x2aa07d(0x15fe)]||'转账'};_0x2ce793[_0x2aa07d(0x222f)]&&(_0x2464af[_0x2aa07d(0x222f)]=_0x2ce793[_0x2aa07d(0x222f)]),_0xe4e904[_0x2aa07d(0x6ee)](_0x2464af);}else{if(typeof _0x2ce793==='object'&&_0x2ce793['type']===_0x2aa07d(0x674))console[_0x2aa07d(0xc0d)](_0x2aa07d(0xdd8),_0x2ce793);else{if(typeof _0x2ce793===_0x2aa07d(0x3c4)&&_0x2ce793[_0x2aa07d(0x23df)]===_0x2aa07d(0x252a))console[_0x2aa07d(0xc0d)](_0x2aa07d(0x12f7),_0x2ce793),_0xe4e904['push'](_0x2ce793);else{if(typeof _0x2ce793===_0x2aa07d(0x3c4)&&_0x2ce793[_0x2aa07d(0x23df)]===_0x2aa07d(0xfa4))console[_0x2aa07d(0xc0d)](_0x2aa07d(0xb4f),_0x2ce793),_0xe4e904[_0x2aa07d(0x6ee)](_0x2ce793);else{if(typeof _0x2ce793==='object'&&_0x2ce793['type']==='update_nickname')console[_0x2aa07d(0xc0d)]('🔍\x20[parseAiResponse]\x20角色更新昵称:',_0x2ce793),_0xe4e904[_0x2aa07d(0x6ee)](_0x2ce793);else{if(typeof _0x2ce793===_0x2aa07d(0x3c4)&&_0x2ce793[_0x2aa07d(0x23df)]==='recall')_0x2ce793[_0x2aa07d(0x1144)]===_0x2aa07d(0x933)&&_0xe4e904[_0x2aa07d(0x6ee)]({'type':_0x2aa07d(0x1913),'content':_0x2aa07d(0x27e)});else{if(typeof _0x2ce793===_0x2aa07d(0x3c4)&&_0x2ce793['type']==='reply')_0xe4e904['push']({'type':_0x2aa07d(0x597),'messageId':_0x2ce793[_0x2aa07d(0x61f)],'content':_0x2ce793[_0x2aa07d(0x1423)]||''});else{if(typeof _0x2ce793==='object'&&_0x2ce793[_0x2aa07d(0x23df)]===_0x2aa07d(0x1e02))_0xe4e904[_0x2aa07d(0x6ee)]({'type':'user_photo','content':_0x2ce793['description']||_0x2aa07d(0x1597),'photoDescription':_0x2ce793[_0x2aa07d(0x1c6f)]});else{if(typeof _0x2ce793===_0x2aa07d(0x3c4)&&_0x2ce793['type']===_0x2aa07d(0x1e4b))_0xe4e904['push'](_0x2ce793);else{if(typeof _0x2ce793===_0x2aa07d(0x3c4)&&_0x2ce793[_0x2aa07d(0x23df)]===_0x2aa07d(0x1fe5)){const _0x30131d={'type':'reply_to','message_id':_0x2ce793[_0x2aa07d(0x16e)],'content':_0x2ce793['content']||''};_0x2ce793[_0x2aa07d(0x222f)]&&(_0x30131d[_0x2aa07d(0x222f)]=_0x2ce793[_0x2aa07d(0x222f)]),_0xe4e904[_0x2aa07d(0x6ee)](_0x30131d);}else{if(typeof _0x2ce793==='object'&&_0x2ce793[_0x2aa07d(0x23df)]===_0x2aa07d(0x14f2))!isRecentFriendRequestSpam(currentChatCharacter?.['id'])?(_0xe4e904[_0x2aa07d(0x6ee)]({'type':_0x2aa07d(0x14f2),'message':_0x2ce793['message']||_0x2aa07d(0x12e7)}),console['log'](_0x2aa07d(0x624),_0x2ce793[_0x2aa07d(0xd7a)])):(console[_0x2aa07d(0xc0d)](_0x2aa07d(0x2f2)),_0xe4e904['push'](_0x2ce793[_0x2aa07d(0xd7a)]||'想和你重新做朋友'));else{if(typeof _0x2ce793===_0x2aa07d(0x3c4)&&_0x2ce793[_0x2aa07d(0x23df)]===_0x2aa07d(0x14ae))console['log'](_0x2aa07d(0x23e),_0x2ce793),setTimeout(async()=>{const _0x156689=_0x2aa07d,_0x56379e=await aiSelectSong(_0x2ce793[_0x156689(0x1c18)],currentChatCharacter?.[_0x156689(0x222f)]);_0x56379e?console[_0x156689(0xc0d)]('✅\x20AI成功选择歌曲'):console['log'](_0x156689(0x212b));},0x64),_0xe4e904[_0x2aa07d(0x6ee)]({'id':Date[_0x2aa07d(0x18e0)]()[_0x2aa07d(0x9a3)](),'sender':'system','type':_0x2aa07d(0x1cbd),'content':(currentChatCharacter?.[_0x2aa07d(0x222f)]||'AI')+_0x2aa07d(0x1f5f)+_0x2ce793[_0x2aa07d(0x1c18)],'timestamp':Date['now']()});else{if(typeof _0x2ce793===_0x2aa07d(0x3c4)&&_0x2ce793[_0x2aa07d(0x23df)]===_0x2aa07d(0xbd4))console[_0x2aa07d(0xc0d)](_0x2aa07d(0x1190),_0x2ce793),setTimeout(async()=>{const _0x54e548=_0x2aa07d,_0x457fc5=await aiSelectRandomSong(currentChatCharacter?.[_0x54e548(0x222f)]);_0x457fc5?console[_0x54e548(0xc0d)]('✅\x20AI成功随机选择歌曲'):console['log'](_0x54e548(0x167b));},0x64),_0xe4e904[_0x2aa07d(0x6ee)]({'id':Date[_0x2aa07d(0x18e0)]()[_0x2aa07d(0x9a3)](),'sender':_0x2aa07d(0x212),'type':_0x2aa07d(0x1cbd),'content':(currentChatCharacter?.['name']||'AI')+_0x2aa07d(0x1d51),'timestamp':Date[_0x2aa07d(0x18e0)]()});else{if(typeof _0x2ce793===_0x2aa07d(0xb97)){let _0x1b2589=_0x2ce793['trim']();_0x1b2589=_0x1b2589[_0x2aa07d(0x882)](/\[ID:\d+\]\s*/g,'');if(_0x1b2589[_0x2aa07d(0x1cab)]('[')&&_0x1b2589[_0x2aa07d(0xd7e)](']'))try{const _0x2b2c4f=JSON[_0x2aa07d(0x168e)](_0x1b2589);if(Array[_0x2aa07d(0x1bcc)](_0x2b2c4f)){console[_0x2aa07d(0xc0d)]('🔥\x20[DEBUG]\x20检测到嵌套JSON字符串，解析出',_0x2b2c4f[_0x2aa07d(0xcbf)],_0x2aa07d(0x67c),_0x2b2c4f);for(const _0x41ae6a of _0x2b2c4f){if(typeof _0x41ae6a===_0x2aa07d(0x3c4)&&_0x41ae6a!==null)_0xe4e904['push'](_0x41ae6a);else typeof _0x41ae6a===_0x2aa07d(0xb97)?_0xe4e904['push'](_0x41ae6a[_0x2aa07d(0x1424)]()):_0xe4e904[_0x2aa07d(0x6ee)](_0x41ae6a);}continue;}}catch(_0x3b558b){console[_0x2aa07d(0x17cc)](_0x2aa07d(0x5e7),_0x3b558b);}const _0x237273=_0x1b2589[_0x2aa07d(0x1316)](/(.+)修改了自己的戳一戳后缀(?:为"(.+)"|（清空）)/);if(_0x237273){const _0x33ceb0=_0x237273[0x1],_0x1b3ef8=_0x237273[0x2]||'';console[_0x2aa07d(0xc0d)](_0x2aa07d(0xe46),{'characterName':_0x33ceb0,'suffix':_0x1b3ef8});const _0x23b8bb=getCurrentChatSettings();_0x23b8bb['aiPokeSuffix']=_0x1b3ef8,await saveCurrentChatSettings(_0x23b8bb),_0xe4e904['push']({'id':Date[_0x2aa07d(0x18e0)]()[_0x2aa07d(0x9a3)](),'sender':_0x2aa07d(0x212),'content':currentChatCharacter[_0x2aa07d(0x222f)]+_0x2aa07d(0x20ab)+(_0x1b3ef8?'为\x22'+_0x1b3ef8+'\x22':_0x2aa07d(0x1bde)),'timestamp':Date['now'](),'type':'system_notification'}),console[_0x2aa07d(0xc0d)](_0x2aa07d(0x249a),_0x1b3ef8);}else{if(_0x2ce793[_0x2aa07d(0x23ec)]('\x0a')){console[_0x2aa07d(0x17cc)]('检测到AI将多条消息合并在一个元素中，正在自动分拆:',_0x2ce793);const _0x4a2542=_0x2ce793['split']('\x0a')[_0x2aa07d(0xf6d)](_0x3f85c7=>_0x3f85c7[_0x2aa07d(0x1424)]())[_0x2aa07d(0x803)](_0xb99c45=>_0xb99c45[_0x2aa07d(0xcbf)]>0x0);_0xe4e904[_0x2aa07d(0x6ee)](..._0x4a2542);}else _0xe4e904['push'](_0x2ce793);}}else _0xe4e904['push'](_0x2ce793);}}}}}}}}}}}}}}}}}}}}}return console['log'](_0x2aa07d(0x1fcb),_0xe4e904['length'],_0x2aa07d(0x2418)),console[_0x2aa07d(0xc0d)](_0x2aa07d(0x215),_0xe4e904[_0x2aa07d(0xf6d)]((_0x47ae04,_0x22321e)=>_0x22321e+0x1+':\x20'+(typeof _0x47ae04===_0x2aa07d(0xb97)?_0x47ae04['substring'](0x0,0x32):JSON[_0x2aa07d(0x7fb)](_0x47ae04)[_0x2aa07d(0x4b2)](0x0,0x32)))),_0xe4e904;}}catch(_0xc71fe1){}try{const _0x1fb7c7=_0x84dbf5[_0x2aa07d(0x1316)](/\[(.*?)\]/s);if(_0x1fb7c7&&_0x1fb7c7[0x0]){const _0x55e45d=JSON['parse'](_0x1fb7c7[0x0]);if(Array[_0x2aa07d(0x1bcc)](_0x55e45d)){const _0x56bd86=[];for(const _0x1a528a of _0x55e45d){if(typeof _0x1a528a===_0x2aa07d(0x3c4)&&_0x1a528a[_0x2aa07d(0x23df)]===_0x2aa07d(0x1f41)){const _0x13032f=await findEmojiForAI(_0x1a528a[_0x2aa07d(0x1c6f)]);_0x13032f?(console['log']('AI发送表情包:',_0x1a528a[_0x2aa07d(0x1c6f)]),_0x56bd86[_0x2aa07d(0x6ee)]({'type':'emoji','url':_0x13032f['url'],'description':_0x13032f[_0x2aa07d(0x1c6f)],'id':_0x13032f['id']})):(console[_0x2aa07d(0x17cc)](_0x2aa07d(0x1c2f),_0x1a528a[_0x2aa07d(0x1c6f)]),_0x56bd86[_0x2aa07d(0x6ee)](_0x2aa07d(0x113a)+_0x1a528a[_0x2aa07d(0x1c6f)]+_0x2aa07d(0x1d49)));}else{if(typeof _0x1a528a===_0x2aa07d(0x3c4)&&_0x1a528a[_0x2aa07d(0x222f)]&&_0x1a528a[_0x2aa07d(0x23df)]==='emoji')console[_0x2aa07d(0xc0d)](_0x2aa07d(0x2d0),_0x1a528a),_0x56bd86[_0x2aa07d(0x6ee)](_0x1a528a);else{if(typeof _0x1a528a===_0x2aa07d(0x3c4)&&_0x1a528a[_0x2aa07d(0x23df)]===_0x2aa07d(0x909)){const _0x6b8a3f=_0x1a528a[_0x2aa07d(0x1c6f)]||_0x2aa07d(0x2e0),_0x17999e={'type':'ai_photo','content':_0x6b8a3f,'photoDescription':_0x6b8a3f};_0x1a528a[_0x2aa07d(0x222f)]&&(_0x17999e[_0x2aa07d(0x222f)]=_0x1a528a[_0x2aa07d(0x222f)]),_0x56bd86[_0x2aa07d(0x6ee)](_0x17999e);}else{if(typeof _0x1a528a===_0x2aa07d(0x3c4)&&_0x1a528a[_0x2aa07d(0x23df)]==='location'){const _0xfc8f5e=_0x1a528a[_0x2aa07d(0xf7e)]||_0x1a528a[_0x2aa07d(0x222f)]||_0x2aa07d(0x254d),_0x55bd27={'type':_0x2aa07d(0x63b),'locationName':_0xfc8f5e,'coordinates':_0x1a528a['coordinates']||'未知坐标','content':'[角色分享了位置信息：'+_0xfc8f5e+']'};if(_0x1a528a[_0x2aa07d(0x222f)]&&_0x1a528a['locationName'])_0x55bd27[_0x2aa07d(0x222f)]=_0x1a528a[_0x2aa07d(0x222f)];else{if(_0x1a528a[_0x2aa07d(0x222f)]&&!_0x1a528a[_0x2aa07d(0xf7e)]){}}_0x56bd86[_0x2aa07d(0x6ee)](_0x55bd27);}else{if(typeof _0x1a528a==='object'&&_0x1a528a[_0x2aa07d(0x23df)]===_0x2aa07d(0x777)){if(_0x1a528a[_0x2aa07d(0xc2e)]==='CURRENT_USER_IMAGE'||_0x1a528a['avatar_url']===_0x2aa07d(0xbb3)||_0x1a528a[_0x2aa07d(0xc2e)]==='用户发送的图片URL'||_0x1a528a[_0x2aa07d(0xc2e)]===_0x2aa07d(0x1ef1)){const _0x4f6edf=getRecentUserImage();_0x4f6edf?(_0x1a528a[_0x2aa07d(0xc2e)]=_0x4f6edf,console[_0x2aa07d(0xc0d)](_0x2aa07d(0x15df),_0x4f6edf)):(console['warn']('没有找到用户最近发送的图片，忽略头像更换请求(第二处)'),_0x56bd86[_0x2aa07d(0x6ee)](_0x2aa07d(0x1bdf)));}_0x56bd86[_0x2aa07d(0x6ee)](_0x1a528a);}else{if(typeof _0x1a528a===_0x2aa07d(0x3c4)&&_0x1a528a['type']===_0x2aa07d(0xb93))_0x56bd86[_0x2aa07d(0x6ee)](_0x1a528a);else{if(typeof _0x1a528a===_0x2aa07d(0x3c4)&&_0x1a528a[_0x2aa07d(0x23df)]===_0x2aa07d(0x1bfd)){const _0x5b7b34={'type':_0x2aa07d(0x1bfd),'content':_0x1a528a['content']||'','duration':_0x1a528a[_0x2aa07d(0x1ff)]||'0\x22'};_0x1a528a[_0x2aa07d(0x222f)]&&(_0x5b7b34[_0x2aa07d(0x222f)]=_0x1a528a[_0x2aa07d(0x222f)]),_0x56bd86[_0x2aa07d(0x6ee)](_0x5b7b34);}else{if(typeof _0x1a528a===_0x2aa07d(0x3c4)&&_0x1a528a[_0x2aa07d(0x23df)]===_0x2aa07d(0xd8)){const _0x8b3088={'type':_0x2aa07d(0xd8),'amount':_0x1a528a['amount']||0x0,'note':_0x1a528a[_0x2aa07d(0x15fe)]||'转账'};_0x1a528a[_0x2aa07d(0x222f)]&&(_0x8b3088[_0x2aa07d(0x222f)]=_0x1a528a[_0x2aa07d(0x222f)]),_0x56bd86[_0x2aa07d(0x6ee)](_0x8b3088);}else{if(typeof _0x1a528a===_0x2aa07d(0x3c4)&&_0x1a528a[_0x2aa07d(0x23df)]===_0x2aa07d(0x674))console[_0x2aa07d(0xc0d)]('🛒\x20[parseAiResponse-第二处]\x20AI尝试发起代付请求，已忽略:',_0x1a528a);else{if(typeof _0x1a528a===_0x2aa07d(0x3c4)&&_0x1a528a['type']===_0x2aa07d(0x252a))console['log'](_0x2aa07d(0x1e50),_0x1a528a),_0x56bd86['push'](_0x1a528a);else{if(typeof _0x1a528a===_0x2aa07d(0x3c4)&&_0x1a528a['type']===_0x2aa07d(0xfa4))console[_0x2aa07d(0xc0d)]('🔍\x20[parseAiResponse-第二处]\x20角色更新戳一戳后缀:',_0x1a528a),_0x56bd86[_0x2aa07d(0x6ee)](_0x1a528a);else{if(typeof _0x1a528a===_0x2aa07d(0x3c4)&&_0x1a528a[_0x2aa07d(0x23df)]===_0x2aa07d(0x1e3a))_0x1a528a[_0x2aa07d(0x1144)]===_0x2aa07d(0x933)&&_0x56bd86[_0x2aa07d(0x6ee)]({'type':_0x2aa07d(0x1913),'content':_0x2aa07d(0x27e)});else{if(typeof _0x1a528a===_0x2aa07d(0x3c4)&&_0x1a528a[_0x2aa07d(0x23df)]==='reply')_0x56bd86[_0x2aa07d(0x6ee)]({'type':_0x2aa07d(0x597),'messageId':_0x1a528a[_0x2aa07d(0x61f)],'content':_0x1a528a['content']||''});else{if(typeof _0x1a528a==='object'&&_0x1a528a[_0x2aa07d(0x23df)]===_0x2aa07d(0x1e02))_0x56bd86[_0x2aa07d(0x6ee)]({'type':_0x2aa07d(0x14a6),'content':_0x1a528a[_0x2aa07d(0x1c6f)]||'AI分享的照片','photoDescription':_0x1a528a['description']});else{if(typeof _0x1a528a===_0x2aa07d(0x3c4)&&_0x1a528a[_0x2aa07d(0x23df)]===_0x2aa07d(0x1e4b))_0x56bd86[_0x2aa07d(0x6ee)](_0x1a528a);else{if(typeof _0x1a528a===_0x2aa07d(0x3c4)&&_0x1a528a[_0x2aa07d(0x23df)]==='reply_to'){const _0x1e77b5={'type':_0x2aa07d(0x1fe5),'message_id':_0x1a528a[_0x2aa07d(0x16e)],'content':_0x1a528a[_0x2aa07d(0x1423)]||''};_0x1a528a['name']&&(_0x1e77b5[_0x2aa07d(0x222f)]=_0x1a528a['name']),_0x56bd86[_0x2aa07d(0x6ee)](_0x1e77b5);}else{if(typeof _0x1a528a==='object'&&_0x1a528a[_0x2aa07d(0x23df)]===_0x2aa07d(0x14f2))!isRecentFriendRequestSpam(currentChatCharacter?.['id'])?(_0x56bd86[_0x2aa07d(0x6ee)]({'type':_0x2aa07d(0x14f2),'message':_0x1a528a['message']||_0x2aa07d(0x12e7)}),console[_0x2aa07d(0xc0d)](_0x2aa07d(0x1241),_0x1a528a[_0x2aa07d(0xd7a)])):(console[_0x2aa07d(0xc0d)](_0x2aa07d(0x1942)),_0x56bd86['push'](_0x1a528a['message']||_0x2aa07d(0x12e7)));else{if(typeof _0x1a528a===_0x2aa07d(0x3c4)&&_0x1a528a[_0x2aa07d(0x23df)]===_0x2aa07d(0x14ae))console[_0x2aa07d(0xc0d)](_0x2aa07d(0x23e),_0x1a528a),setTimeout(async()=>{const _0x2c620a=_0x2aa07d,_0x3dca84=await aiSelectSong(_0x1a528a[_0x2c620a(0x1c18)],currentChatCharacter?.[_0x2c620a(0x222f)]);_0x3dca84?console[_0x2c620a(0xc0d)](_0x2c620a(0x83e)):console[_0x2c620a(0xc0d)](_0x2c620a(0x212b));},0x64),_0x56bd86[_0x2aa07d(0x6ee)]({'id':Date[_0x2aa07d(0x18e0)]()[_0x2aa07d(0x9a3)](),'sender':'system','type':_0x2aa07d(0x1cbd),'content':(currentChatCharacter?.[_0x2aa07d(0x222f)]||'AI')+'正在为你选择歌曲：'+_0x1a528a['title'],'timestamp':Date['now']()});else{if(typeof _0x1a528a===_0x2aa07d(0x3c4)&&_0x1a528a['type']===_0x2aa07d(0xbd4))console[_0x2aa07d(0xc0d)](_0x2aa07d(0x1190),_0x1a528a),setTimeout(async()=>{const _0x53c483=_0x2aa07d,_0x2ba67e=await aiSelectRandomSong(currentChatCharacter?.['name']);_0x2ba67e?console[_0x53c483(0xc0d)](_0x53c483(0x1856)):console[_0x53c483(0xc0d)](_0x53c483(0x167b));},0x64),_0x56bd86[_0x2aa07d(0x6ee)]({'id':Date[_0x2aa07d(0x18e0)]()[_0x2aa07d(0x9a3)](),'sender':_0x2aa07d(0x212),'type':'system_notification','content':(currentChatCharacter?.[_0x2aa07d(0x222f)]||'AI')+_0x2aa07d(0x1d51),'timestamp':Date[_0x2aa07d(0x18e0)]()});else{if(typeof _0x1a528a===_0x2aa07d(0xb97)){let _0x38f203=_0x1a528a[_0x2aa07d(0x1424)]();_0x38f203=_0x38f203[_0x2aa07d(0x882)](/\[ID:\d+\]\s*/g,'');if(_0x38f203[_0x2aa07d(0x1cab)]('[')&&_0x38f203[_0x2aa07d(0xd7e)](']'))try{const _0x47ea50=JSON[_0x2aa07d(0x168e)](_0x38f203);if(Array[_0x2aa07d(0x1bcc)](_0x47ea50)){console['log'](_0x2aa07d(0x126a),_0x47ea50[_0x2aa07d(0xcbf)],_0x2aa07d(0x67c),_0x47ea50);for(const _0x276928 of _0x47ea50){if(typeof _0x276928===_0x2aa07d(0x3c4)&&_0x276928!==null)_0x56bd86[_0x2aa07d(0x6ee)](_0x276928);else typeof _0x276928==='string'?_0x56bd86[_0x2aa07d(0x6ee)](_0x276928[_0x2aa07d(0x1424)]()):_0x56bd86[_0x2aa07d(0x6ee)](_0x276928);}continue;}}catch(_0x2c607b){console[_0x2aa07d(0x17cc)](_0x2aa07d(0x21f8),_0x2c607b);}const _0x32f782=_0x38f203['match'](/(.+)修改了自己的戳一戳后缀(?:为"(.+)"|（清空）)/);if(_0x32f782){const _0x1d0c74=_0x32f782[0x1],_0x3a5d3d=_0x32f782[0x2]||'';console[_0x2aa07d(0xc0d)](_0x2aa07d(0x6ce),{'characterName':_0x1d0c74,'suffix':_0x3a5d3d});const _0x305293=getCurrentChatSettings();_0x305293[_0x2aa07d(0x490)]=_0x3a5d3d,await saveCurrentChatSettings(_0x305293),_0x56bd86[_0x2aa07d(0x6ee)]({'id':Date[_0x2aa07d(0x18e0)]()[_0x2aa07d(0x9a3)](),'sender':'system','content':currentChatCharacter[_0x2aa07d(0x222f)]+_0x2aa07d(0x20ab)+(_0x3a5d3d?'为\x22'+_0x3a5d3d+'\x22':_0x2aa07d(0x1bde)),'timestamp':Date[_0x2aa07d(0x18e0)](),'type':_0x2aa07d(0x1cbd)}),console[_0x2aa07d(0xc0d)](_0x2aa07d(0x1124),_0x3a5d3d);}else{if(_0x1a528a[_0x2aa07d(0x23ec)]('\x0a')){console[_0x2aa07d(0x17cc)]('检测到AI将多条消息合并在一个元素中，正在自动分拆:',_0x1a528a);const _0x404dcd=_0x1a528a[_0x2aa07d(0x633)]('\x0a')[_0x2aa07d(0xf6d)](_0x47105f=>_0x47105f[_0x2aa07d(0x1424)]())[_0x2aa07d(0x803)](_0x53006b=>_0x53006b[_0x2aa07d(0xcbf)]>0x0);_0x56bd86[_0x2aa07d(0x6ee)](..._0x404dcd);}else _0x56bd86[_0x2aa07d(0x6ee)](_0x1a528a);}}else _0x56bd86[_0x2aa07d(0x6ee)](_0x1a528a);}}}}}}}}}}}}}}}}}}}}return console[_0x2aa07d(0xc0d)]('🔥\x20[DEBUG]\x20parseAiResponse\x20处理完成，返回',_0x56bd86[_0x2aa07d(0xcbf)],_0x2aa07d(0x1130),_0x56bd86),_0x56bd86;}}}catch(_0x412080){}if(_0x84dbf5['trim']()[_0x2aa07d(0x1cab)]('{')&&_0x84dbf5[_0x2aa07d(0x1424)]()[_0x2aa07d(0xd7e)]('}'))try{const _0x5769e9=JSON['parse'](_0x84dbf5[_0x2aa07d(0x1424)]());if(_0x5769e9['type'])return console[_0x2aa07d(0xc0d)](_0x2aa07d(0x14f),_0x5769e9),await parseAiResponse('['+_0x84dbf5[_0x2aa07d(0x1424)]()+']');}catch(_0x47429b){console['warn'](_0x2aa07d(0x2427),_0x47429b);}const _0x34c1aa=_0x84dbf5[_0x2aa07d(0x633)]('\x0a')[_0x2aa07d(0xf6d)](_0x4d7f54=>_0x4d7f54[_0x2aa07d(0x1424)]())[_0x2aa07d(0x803)](_0x29410c=>_0x29410c['length']>0x0&&!_0x29410c[_0x2aa07d(0x1cab)](_0x2aa07d(0x1b9d))),_0x2bfce2=[];for(const _0x97754f of _0x34c1aa){const _0x4f806d=_0x97754f[_0x2aa07d(0x1316)](/\[ID:\d+\]/g);if(_0x4f806d&&_0x4f806d['length']>0x1){console[_0x2aa07d(0xc0d)](_0x2aa07d(0x17a8),_0x4f806d[_0x2aa07d(0xcbf)]);const _0x2ba151=_0x97754f[_0x2aa07d(0x633)](/\[ID:\d+\]\s*/),_0x178fca=_0x2ba151[_0x2aa07d(0x803)](_0x320f0b=>_0x320f0b['trim']()[_0x2aa07d(0xcbf)]>0x0);_0x2bfce2['push'](..._0x178fca);}else{const _0x1fc0d2=_0x97754f[_0x2aa07d(0x882)](/\[ID:\d+\]\s*/g,'');_0x1fc0d2[_0x2aa07d(0x1424)]()[_0x2aa07d(0xcbf)]>0x0&&_0x2bfce2['push'](_0x1fc0d2);}}if(_0x2bfce2[_0x2aa07d(0xcbf)]===0x0){const _0x2bd448=_0x84dbf5[_0x2aa07d(0x882)](/\[ID:\d+\]\s*/g,'');_0x2bfce2['push'](_0x2bd448);}return console[_0x2aa07d(0xc0d)](_0x2aa07d(0x144d),_0x2bfce2),_0x2bfce2;}function processOfflineContent(_0x271346){const _0x479427=_0x2cf6d4;if(!_0x271346)return'';const _0x4782e5=[];let _0x47291d=0x0;const _0x157d39=/「([^」]*)」/g;let _0x50d658;while((_0x50d658=_0x157d39[_0x479427(0x254e)](_0x271346))!==null){if(_0x50d658[_0x479427(0x55a)]>_0x47291d){const _0x3a2603=_0x271346[_0x479427(0x136)](_0x47291d,_0x50d658['index'])['trim']();_0x3a2603&&_0x4782e5['push'](_0x479427(0x1bf2)+_0x3a2603+_0x479427(0x19d2));}_0x4782e5['push']('「'+_0x50d658[0x1]+'」'),_0x47291d=_0x50d658[_0x479427(0x55a)]+_0x50d658[0x0]['length'];}if(_0x47291d<_0x271346[_0x479427(0xcbf)]){const _0x2f18c1=_0x271346[_0x479427(0x136)](_0x47291d)['trim']();_0x2f18c1&&_0x4782e5['push'](_0x479427(0x1bf2)+_0x2f18c1+_0x479427(0x19d2));}if(_0x4782e5[_0x479427(0xcbf)]===0x0)return _0x479427(0x1bf2)+_0x271346+_0x479427(0x19d2);return _0x4782e5['join']('');}async function sendImageMessage(_0x29dc75){const _0x1f4f86=_0x2cf6d4;if(!currentChatCharacter)return;const _0x5293ff=document[_0x1f4f86(0x566)]('api-chat-input'),_0x27c841=_0x5293ff?_0x5293ff[_0x1f4f86(0xc34)][_0x1f4f86(0x1424)]():'';let _0x42c27f;_0x29dc75?_0x42c27f=[{'type':'text','text':_0x27c841},{'type':_0x1f4f86(0x1cfa),'image_url':{'url':_0x29dc75}}]:_0x42c27f=_0x27c841;console['log'](_0x1f4f86(0x1797),_0x42c27f),console[_0x1f4f86(0xc0d)](_0x1f4f86(0xa8c),_0x27c841),console[_0x1f4f86(0xc0d)]('🔍\x20[sendImageMessage]\x20图片URL长度:',_0x29dc75?_0x29dc75[_0x1f4f86(0xcbf)]:0x0),console[_0x1f4f86(0xc0d)]('🔍\x20[sendImageMessage]\x20消息内容数组长度:',_0x42c27f[_0x1f4f86(0xcbf)]),console[_0x1f4f86(0xc0d)](_0x1f4f86(0x717),_0x42c27f[_0x1f4f86(0xf6d)]((_0x5b7fde,_0x15c1f4)=>({'index':_0x15c1f4,'type':_0x5b7fde[_0x1f4f86(0x23df)],'hasText':!!_0x5b7fde[_0x1f4f86(0x1e58)],'hasImageUrl':!!_0x5b7fde[_0x1f4f86(0x1cfa)],'textLength':_0x5b7fde['text']?_0x5b7fde['text']['length']:0x0,'imageUrlLength':_0x5b7fde['image_url']?.[_0x1f4f86(0x10c6)]?_0x5b7fde['image_url'][_0x1f4f86(0x10c6)][_0x1f4f86(0xcbf)]:0x0})));const _0x4cce6c={'id':Date[_0x1f4f86(0x18e0)]()[_0x1f4f86(0x9a3)](),'sender':_0x1f4f86(0xfda),'content':_0x42c27f,'timestamp':Date[_0x1f4f86(0x18e0)](),'replyTo':currentReplyTo?{'id':currentReplyTo['id'],'content':currentReplyTo[_0x1f4f86(0x1423)],'senderName':currentReplyTo[_0x1f4f86(0xadb)]}:null};!chatMessages[currentChatCharacter['id']]&&(chatMessages[currentChatCharacter['id']]=[]);chatMessages[currentChatCharacter['id']][_0x1f4f86(0x6ee)](_0x4cce6c);try{const _0x272096=currentChatCharacter['id']+'_'+_0x4cce6c['id']+'_'+(chatMessages[currentChatCharacter['id']][_0x1f4f86(0xcbf)]-0x1);await db[_0x1f4f86(0x464)]['add']({'id':_0x272096,'characterId':currentChatCharacter['id'],'timestamp':_0x4cce6c[_0x1f4f86(0x7aa)],'messageOrder':chatMessages[currentChatCharacter['id']][_0x1f4f86(0xcbf)]-0x1,'originalMessageId':_0x4cce6c['id'],'messageData':_0x4cce6c}),console[_0x1f4f86(0xc0d)](_0x1f4f86(0x2042));}catch(_0x39db67){console['error'](_0x1f4f86(0xfeb),_0x39db67),await saveChatMessagesImmediate();}await recordMemoryEvent([currentChatCharacter['id'],_0x1f4f86(0x23b2)],{'type':currentChatCharacter[_0x1f4f86(0x4b7)]?_0x1f4f86(0x1f01):_0x1f4f86(0x10d7),'id':currentChatCharacter['id']},'message',{'sender':_0x1f4f86(0x23b2),'content':_0x27c841,'hasImage':!!_0x29dc75},0.6);_0x5293ff&&(_0x5293ff['value']='');cancelReply();currentChatCharacter&&delete chatReplyStates[currentChatCharacter['id']];addMessageWithAnimation(_0x4cce6c,currentChatCharacter['id']),renderMessageList(),triggerStatusUpdateAfterMessage(currentChatCharacter['id']),pendingUserMessage=_0x4cce6c;const _0x527c7d=document['getElementById'](_0x1f4f86(0x9c));_0x527c7d&&(_0x527c7d[_0x1f4f86(0x655)]['animation']=_0x1f4f86(0x23f0),_0x527c7d['classList'][_0x1f4f86(0xe1)](_0x1f4f86(0x1f33)),_0x527c7d[_0x1f4f86(0x1c18)]='点击获取AI回复');}function uploadImage(){const _0x2124f7=_0x2cf6d4;document['getElementById']('image-upload')[_0x2124f7(0x1e62)]();}function showImage(_0xc2ae38){const _0x19a441=_0x2cf6d4;let _0x2c4dcd=document[_0x19a441(0x566)](_0x19a441(0x1894));if(!_0x2c4dcd){_0x2c4dcd=document['createElement'](_0x19a441(0x526)),_0x2c4dcd['id']=_0x19a441(0x1894),_0x2c4dcd[_0x19a441(0x221)]=_0x19a441(0x1894),_0x2c4dcd[_0x19a441(0x11cf)]=_0x1c8b2c=>{const _0x15fe81=_0x19a441;_0x1c8b2c[_0x15fe81(0x1144)]===_0x2c4dcd&&(_0x2c4dcd[_0x15fe81(0x655)]['display']=_0x15fe81(0xfe9));};const _0xf8160b=document['createElement'](_0x19a441(0x736));_0xf8160b[_0x19a441(0x15ff)]='预览图片',_0xf8160b[_0x19a441(0x655)][_0x19a441(0x1f07)]=_0x19a441(0xea1),_0xf8160b[_0x19a441(0x11cf)]=()=>_0x2c4dcd[_0x19a441(0x655)]['display']=_0x19a441(0xfe9),_0x2c4dcd['appendChild'](_0xf8160b),document['body']['appendChild'](_0x2c4dcd);}const _0xe4172f=_0x2c4dcd[_0x19a441(0x15b8)]('img');_0xe4172f[_0x19a441(0x107)]=_0xc2ae38,_0x2c4dcd[_0x19a441(0x655)][_0x19a441(0x2526)]='flex';const _0x38183b=_0xc8b5fd=>{const _0x341161=_0x19a441;_0xc8b5fd[_0x341161(0x157f)]==='Escape'&&(_0x2c4dcd['style'][_0x341161(0x2526)]=_0x341161(0xfe9),document[_0x341161(0x6be)](_0x341161(0x695),_0x38183b));};document['addEventListener'](_0x19a441(0x695),_0x38183b);}function showChatSettings(){const _0x34cde5=_0x2cf6d4;console['log']('显示聊天设置被调用'),hideApp(_0x34cde5(0x1154));const _0x4b71bf=document[_0x34cde5(0x566)](_0x34cde5(0x1aa9));if(_0x4b71bf){_0x4b71bf[_0x34cde5(0x655)][_0x34cde5(0x2526)]=_0x34cde5(0x1f0b),_0x4b71bf['style'][_0x34cde5(0x492)]='absolute',_0x4b71bf[_0x34cde5(0x655)][_0x34cde5(0x15f7)]='0',_0x4b71bf[_0x34cde5(0x655)]['left']='0',_0x4b71bf[_0x34cde5(0x655)]['width']=_0x34cde5(0x1295),_0x4b71bf[_0x34cde5(0x655)][_0x34cde5(0x16b8)]=_0x34cde5(0x1295),_0x4b71bf[_0x34cde5(0x655)]['zIndex']='1000',_0x4b71bf['style'][_0x34cde5(0xc3c)]=_0x34cde5(0x241f),initializeChatSettings(),applyBubbleStyle(),updateWorldbookMountDisplay()[_0x34cde5(0x9e5)](_0x2e2b66=>console[_0x34cde5(0x24ab)](_0x34cde5(0x1581),_0x2e2b66));const _0x17a43b=currentChatCharacter&&currentChatCharacter[_0x34cde5(0x4b7)];console[_0x34cde5(0xc0d)]('当前聊天类型:',_0x17a43b?'群聊':'单聊');const _0x3f01a9=document[_0x34cde5(0x566)](_0x34cde5(0x4ef)),_0x17c80b=document[_0x34cde5(0x566)](_0x34cde5(0xf81));if(_0x17a43b){if(_0x3f01a9)_0x3f01a9[_0x34cde5(0x655)][_0x34cde5(0x2526)]=_0x34cde5(0x2d4);if(_0x17c80b)_0x17c80b[_0x34cde5(0x655)][_0x34cde5(0x2526)]='none';const _0x204e5a=document[_0x34cde5(0x1ed9)](_0x34cde5(0x384));_0x204e5a[_0x34cde5(0x900)](_0xb49322=>_0xb49322[_0x34cde5(0x655)][_0x34cde5(0x2526)]=_0x34cde5(0xfe9)),updateGroupChatInfo();}else{if(_0x3f01a9)_0x3f01a9[_0x34cde5(0x655)]['display']=_0x34cde5(0xfe9);if(_0x17c80b)_0x17c80b[_0x34cde5(0x655)][_0x34cde5(0x2526)]=_0x34cde5(0x2d4);const _0x164dda=document[_0x34cde5(0x1ed9)](_0x34cde5(0x384));_0x164dda[_0x34cde5(0x900)](_0x3e0eb2=>{const _0x2e9f82=_0x34cde5;_0x3e0eb2[_0x2e9f82(0x226e)][_0x2e9f82(0x1f9)](_0x2e9f82(0x2382))?_0x3e0eb2[_0x2e9f82(0x655)][_0x2e9f82(0x2526)]='block':_0x3e0eb2[_0x2e9f82(0x655)][_0x2e9f82(0x2526)]=_0x2e9f82(0x1f0b);}),updateMemoryShareStatus();}updateVideoAvatarSettingVisibility(),console[_0x34cde5(0xc0d)](_0x34cde5(0x1d4b));}else console[_0x34cde5(0x24ab)](_0x34cde5(0x1e03)),alert(_0x34cde5(0x2219));}function hideChatSettings(){const _0x5ad266=_0x2cf6d4;hideApp('api-chat-settings-screen'),currentChatCharacter&&showApp(_0x5ad266(0x1154));}let footprintsUpdateTimer=null,currentFootprintsCharacter=null;function getLocalDateString(_0x49d5d2=new Date()){const _0x1b0943=_0x2cf6d4;return _0x49d5d2[_0x1b0943(0x885)]()+'-'+String(_0x49d5d2['getMonth']()+0x1)['padStart'](0x2,'0')+'-'+String(_0x49d5d2[_0x1b0943(0x1d02)]())[_0x1b0943(0x863)](0x2,'0');}async function getCharacterDisplayAvatar(_0x582be3){const _0xcea7f5=_0x2cf6d4;try{const _0x4a5fc4=await db[_0xcea7f5(0x1a72)][_0xcea7f5(0x4a6)]('authorId')[_0xcea7f5(0x14a)](_0x582be3['id'])[_0xcea7f5(0x2253)]()[_0xcea7f5(0x149c)](0xa)[_0xcea7f5(0x18c6)]();for(const _0x35dd27 of _0x4a5fc4){if(_0x35dd27[_0xcea7f5(0x107f)]&&isValidAvatarUrl(_0x35dd27[_0xcea7f5(0x107f)]))return console[_0xcea7f5(0xc0d)](_0xcea7f5(0x932)+_0x582be3[_0xcea7f5(0x222f)]+_0xcea7f5(0x48f)),_0x35dd27['avatar'];}if(_0x582be3[_0xcea7f5(0x107f)]&&isValidAvatarUrl(_0x582be3['avatar']))return console[_0xcea7f5(0xc0d)]('✅\x20使用角色\x20'+_0x582be3[_0xcea7f5(0x222f)]+_0xcea7f5(0xf23)),_0x582be3[_0xcea7f5(0x107f)];if(_0x582be3[_0xcea7f5(0x10f9)]&&isValidAvatarUrl(_0x582be3[_0xcea7f5(0x10f9)]))return console[_0xcea7f5(0xc0d)]('✅\x20使用角色\x20'+_0x582be3['name']+_0xcea7f5(0x13ef)),_0x582be3[_0xcea7f5(0x10f9)];return console[_0xcea7f5(0xc0d)]('⚠️\x20角色\x20'+_0x582be3[_0xcea7f5(0x222f)]+_0xcea7f5(0x203f)),null;}catch(_0x84cfd6){return console[_0xcea7f5(0x24ab)]('获取角色显示头像失败:',_0x84cfd6),_0x582be3[_0xcea7f5(0x107f)]||_0x582be3[_0xcea7f5(0x10f9)]||null;}}async function migrateFootprintsFromLocalStorage(){const _0x47af6e=_0x2cf6d4;try{console[_0x47af6e(0xc0d)](_0x47af6e(0xe55));const _0xea0267=localStorage[_0x47af6e(0x2250)]('footprints_cache');if(!_0xea0267){console[_0x47af6e(0xc0d)](_0x47af6e(0x11db));return;}const _0x3254f0=JSON[_0x47af6e(0x168e)](_0xea0267);let _0x125238=0x0,_0x198554=0x0;for(const [_0x50100e,_0x5e7c0f]of Object[_0x47af6e(0x230e)](_0x3254f0)){if(typeof _0x5e7c0f===_0x47af6e(0x3c4)&&_0x5e7c0f!==null)for(const [_0x255e35,_0x1805fd]of Object['entries'](_0x5e7c0f)){_0x198554++;try{const _0x433aad=_0x255e35+'_'+_0x50100e,_0x50f7ee=await db[_0x47af6e(0x9ae)][_0x47af6e(0x46a)](_0x433aad);if(_0x50f7ee){console[_0x47af6e(0xc0d)]('⏭️\x20跳过已存在的足迹记录:\x20'+_0x433aad);continue;}const _0x408bcb={'id':_0x433aad,'characterId':_0x255e35,'date':_0x50100e,'data':_0x1805fd['data'],'timestamp':_0x1805fd[_0x47af6e(0x7aa)]||Date[_0x47af6e(0x18e0)](),'lastUpdateTime':_0x1805fd[_0x47af6e(0x1d4f)]||_0x1805fd[_0x47af6e(0x7aa)]||Date[_0x47af6e(0x18e0)](),'isComplete':_0x1805fd['isComplete']||![]};await db[_0x47af6e(0x9ae)][_0x47af6e(0xe1)](_0x408bcb),_0x125238++,console[_0x47af6e(0xc0d)](_0x47af6e(0xccc)+_0x433aad);}catch(_0x41154c){console['error'](_0x47af6e(0x884)+_0x255e35+'_'+_0x50100e+':',_0x41154c);}}}_0x125238>0x0?(console[_0x47af6e(0xc0d)](_0x47af6e(0x1780)+_0x198554+_0x47af6e(0xfe)+_0x125238+'\x20条'),console[_0x47af6e(0xc0d)](_0x47af6e(0x89e))):console[_0x47af6e(0xc0d)](_0x47af6e(0xb6));}catch(_0x9cf5a4){console[_0x47af6e(0x24ab)](_0x47af6e(0x221a),_0x9cf5a4);}}async function getFootprintsCache(_0xa29ad3){const _0x22cca8=_0x2cf6d4;try{const _0x1d86ce=getLocalDateString(),_0x2fb753=_0xa29ad3+'_'+_0x1d86ce,_0x46f2ef=await db[_0x22cca8(0x9ae)][_0x22cca8(0x46a)](_0x2fb753);return _0x46f2ef||null;}catch(_0x5b8b82){return console[_0x22cca8(0x24ab)](_0x22cca8(0x1b79),_0x5b8b82),null;}}async function setFootprintsCache(_0x385b8d,_0x49e212,_0x57922b=null){const _0xefee5c=_0x2cf6d4;try{const _0x2b8e91=getLocalDateString(),_0x2e99cb=_0x385b8d+'_'+_0x2b8e91,_0x27c2ba={'id':_0x2e99cb,'characterId':_0x385b8d,'date':_0x2b8e91,'data':_0x49e212,'timestamp':Date[_0xefee5c(0x18e0)](),'lastUpdateTime':_0x57922b||Date[_0xefee5c(0x18e0)](),'isComplete':![]};await db['characterFootprints']['put'](_0x27c2ba),console[_0xefee5c(0xc0d)](_0xefee5c(0xf63)+_0x385b8d+'\x20('+_0x2b8e91+')');}catch(_0x10fdfe){console['error'](_0xefee5c(0x19cf),_0x10fdfe);}}async function appendToFootprintsCache(_0xbe8eda,_0x96c4e3){const _0x3ea86a=_0x2cf6d4;try{const _0x75ca08=getLocalDateString(),_0x4df250=_0xbe8eda+'_'+_0x75ca08,_0x3d3a6a=await db[_0x3ea86a(0x9ae)][_0x3ea86a(0x46a)](_0x4df250);if(!_0x3d3a6a)return console[_0x3ea86a(0x17cc)](_0x3ea86a(0x24e)),await setFootprintsCache(_0xbe8eda,_0x96c4e3,Date[_0x3ea86a(0x18e0)]()),!![];const _0x1a5c54=_0x3d3a6a[_0x3ea86a(0x4f2)];_0x96c4e3['activities']&&(!_0x1a5c54[_0x3ea86a(0x9a5)]&&(_0x1a5c54[_0x3ea86a(0x9a5)]=[]),_0x1a5c54[_0x3ea86a(0x9a5)]=_0x1a5c54[_0x3ea86a(0x9a5)][_0x3ea86a(0x1fa8)](_0x96c4e3['activities']));if(_0x96c4e3[_0x3ea86a(0x107a)]){!_0x1a5c54[_0x3ea86a(0x107a)]&&(_0x1a5c54[_0x3ea86a(0x107a)]=[]);const _0x2492da=new Map();_0x1a5c54[_0x3ea86a(0x107a)][_0x3ea86a(0x900)](_0x558c55=>_0x2492da[_0x3ea86a(0x21c0)](_0x558c55[_0x3ea86a(0x222f)],_0x558c55)),_0x96c4e3[_0x3ea86a(0x107a)][_0x3ea86a(0x900)](_0x15cb45=>_0x2492da['set'](_0x15cb45[_0x3ea86a(0x222f)],_0x15cb45)),_0x1a5c54[_0x3ea86a(0x107a)]=Array['from'](_0x2492da[_0x3ea86a(0x1efb)]());}return _0x3d3a6a[_0x3ea86a(0x4f2)]=_0x1a5c54,_0x3d3a6a['timestamp']=Date[_0x3ea86a(0x18e0)](),_0x3d3a6a[_0x3ea86a(0x1d4f)]=Date[_0x3ea86a(0x18e0)](),await db[_0x3ea86a(0x9ae)][_0x3ea86a(0x53a)](_0x3d3a6a),console[_0x3ea86a(0xc0d)](_0x3ea86a(0x1396)+_0xbe8eda+'，总计\x20'+(_0x1a5c54['activities']?.['length']||0x0)+_0x3ea86a(0x1d0c)),console['log']('📦\x20更新后的缓存数据:',_0x1a5c54),!![];}catch(_0x19033c){return console[_0x3ea86a(0x24ab)](_0x3ea86a(0xfe4),_0x19033c),![];}}async function cleanupFootprintsCache(){const _0x18bd7b=_0x2cf6d4;try{const _0x161918=getLocalDateString(),_0x66bfc2=await db[_0x18bd7b(0x9ae)][_0x18bd7b(0x18c6)](),_0x44c023=_0x66bfc2[_0x18bd7b(0xcbf)],_0x4f13ce=_0x66bfc2[_0x18bd7b(0x803)](_0x151778=>_0x151778[_0x18bd7b(0x1c5b)]!==_0x161918);if(_0x4f13ce[_0x18bd7b(0xcbf)]>0x0){const _0x453429=_0x4f13ce[_0x18bd7b(0xf6d)](_0x210f69=>_0x210f69['id']);await db['characterFootprints']['bulkDelete'](_0x453429),console[_0x18bd7b(0xc0d)](_0x18bd7b(0x208c)+_0x44c023+_0x18bd7b(0x224b)+_0x4f13ce[_0x18bd7b(0xcbf)]+_0x18bd7b(0x807));}else console[_0x18bd7b(0xc0d)](_0x18bd7b(0x112a)+_0x44c023+'\x20个记录，无需清理');}catch(_0x2d3a3e){console[_0x18bd7b(0x24ab)](_0x18bd7b(0x1875),_0x2d3a3e);}}function setupMidnightCacheCleanup(){const _0x339c31=_0x2cf6d4,_0x3cb49c=new Date(),_0x2b0f23=new Date(_0x3cb49c);_0x2b0f23[_0x339c31(0x1cd4)](_0x2b0f23['getDate']()+0x1),_0x2b0f23[_0x339c31(0x482)](0x0,0x0,0x0,0x0);const _0x1f94fd=_0x2b0f23[_0x339c31(0xa57)]()-_0x3cb49c[_0x339c31(0xa57)]();setTimeout(async()=>{const _0x27f876=_0x339c31;console[_0x27f876(0xc0d)](_0x27f876(0x209d));try{await cleanupFootprintsCache();}catch(_0x345ee2){console['error']('午夜自动清理足迹缓存失败:',_0x345ee2);}setInterval(async()=>{const _0x52cf4b=_0x27f876;console[_0x52cf4b(0xc0d)](_0x52cf4b(0x22e5));try{await cleanupFootprintsCache();}catch(_0x2d4a11){console['error'](_0x52cf4b(0x5ff),_0x2d4a11);}},0x18*0x3c*0x3c*0x3e8);},_0x1f94fd),console[_0x339c31(0xc0d)]('⏰\x20足迹缓存将在\x20'+Math[_0x339c31(0x1dac)](_0x1f94fd/0x3e8/0x3c)+_0x339c31(0x160f));}async function showCharacterPhone(){const _0x17b821=_0x2cf6d4;if(!currentChatCharacter){showToast(_0x17b821(0x1268),_0x17b821(0x24ab));return;}if(currentChatCharacter[_0x17b821(0x4b7)]){showToast('群聊不支持查看手机功能',_0x17b821(0x24ab));return;}window['phoneMessagesGenerated']=![],window['phoneNotesGenerated']=![],window['phonePhotosGenerated']=![],window['phoneContactsData']=null,window[_0x17b821(0xe52)]=null,debugCharacterAvatar();const _0x1c4223=document[_0x17b821(0x566)](_0x17b821(0x1018));_0x1c4223&&(_0x1c4223['textContent']=currentChatCharacter[_0x17b821(0x222f)]+_0x17b821(0x22bf));hideApp('api-chat-screen'),showApp(_0x17b821(0x16dc));if(!apiSettings['base']||!apiSettings[_0x17b821(0x157f)]){console[_0x17b821(0xc0d)](_0x17b821(0xe0d)),showPhoneApiConfigPrompt(),switchPhoneTab(_0x17b821(0x1767));return;}try{await generatePhoneMessagesAPI();}catch(_0x140501){console[_0x17b821(0x24ab)](_0x17b821(0x7bc),_0x140501),showPhoneRegenerateButton(_0x17b821(0x152c),generatePhoneMessagesAPI);}switchPhoneTab(_0x17b821(0x1767));}function generatePhoneData(){generatePhoneMessages(),generatePhoneNotes(),generatePhonePhotos();}async function generatePhoneMessagesAPI(){const _0x2cda23=_0x2cf6d4,_0x3bb682=document[_0x2cda23(0x15b8)](_0x2cda23(0x152c));if(!_0x3bb682)return;if(window[_0x2cda23(0x13a9)]&&window[_0x2cda23(0x206b)]===currentChatCharacter['id'])return;try{_0x3bb682[_0x2cda23(0xc02)]=_0x2cda23(0xac9)+currentChatCharacter[_0x2cda23(0x222f)]+_0x2cda23(0x231c);const _0x573828=await buildPhoneContextInfo(),_0x54cfc8='请为角色\x22'+currentChatCharacter[_0x2cda23(0x222f)]+_0x2cda23(0x565)+_0x573828+_0x2cda23(0x24a),_0x479b95=await callPhoneAPI(_0x54cfc8),_0x252be6=cleanAndFixJSON(_0x479b95);if(_0x252be6[_0x2cda23(0xb51)]&&Array[_0x2cda23(0x1bcc)](_0x252be6[_0x2cda23(0xb51)])){window[_0x2cda23(0x896)]=_0x252be6['contacts'],window[_0x2cda23(0xe52)]={},_0x252be6[_0x2cda23(0xb51)][_0x2cda23(0x900)](_0x2c1af2=>{const _0x10b412=_0x2cda23;_0x2c1af2[_0x10b412(0x2121)]&&(window[_0x10b412(0xe52)][_0x2c1af2[_0x10b412(0x222f)]]=_0x2c1af2['chatHistory']);});const _0x390709=_0x252be6[_0x2cda23(0xb51)][_0x2cda23(0xf6d)](_0xd434cf=>_0x2cda23(0x19fa)+_0xd434cf[_0x2cda23(0x222f)]+_0x2cda23(0x91c)+_0xd434cf['avatar']['color']+_0x2cda23(0x5ba)+_0xd434cf[_0x2cda23(0x107f)][_0x2cda23(0x689)]+'\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-name\x22>'+_0xd434cf[_0x2cda23(0x222f)]+_0x2cda23(0x3fb)+_0xd434cf['time']+_0x2cda23(0x1842)+_0xd434cf[_0x2cda23(0x14bb)]+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20')[_0x2cda23(0x140c)]('');_0x3bb682['innerHTML']=_0x390709,window[_0x2cda23(0x13a9)]=!![],window[_0x2cda23(0x206b)]=currentChatCharacter['id'],showToast('✅\x20人际圈对话成功打开',_0x2cda23(0xb27));}else throw new Error('API返回格式错误');}catch(_0xf792bb){console[_0x2cda23(0x24ab)](_0x2cda23(0x18b4),_0xf792bb),showPhoneRegenerateButton('.phone-messages-list',generatePhoneMessagesAPI);}}function generatePhoneMessages(){const _0x5d5c88=_0x2cf6d4,_0x4cf1b9=document[_0x5d5c88(0x15b8)]('.phone-messages-list');if(!_0x4cf1b9)return;const _0x3fcd15=[{'name':'小红','preview':'今天天气真好呢~','time':_0x5d5c88(0x467)},{'name':'小明','preview':_0x5d5c88(0x10ef),'time':'昨天'},{'name':'妈妈','preview':'记得按时吃饭哦','time':'昨天'},{'name':_0x5d5c88(0x19fd),'preview':_0x5d5c88(0x1aa4),'time':_0x5d5c88(0x23fe)},{'name':'室友','preview':'晚上一起看电影吗？','time':_0x5d5c88(0x10dd)}],_0x250edc={'小红':{'icon':'fas\x20fa-heart','color':_0x5d5c88(0x160e)},'小明':{'icon':_0x5d5c88(0x14b8),'color':'#4ECDC4'},'妈妈':{'icon':_0x5d5c88(0x19d4),'color':'#45B7D1'},'同事小李':{'icon':'fas\x20fa-briefcase','color':_0x5d5c88(0x2236)},'室友':{'icon':_0x5d5c88(0x146f),'color':_0x5d5c88(0x1429)}};_0x4cf1b9[_0x5d5c88(0xc02)]=_0x3fcd15[_0x5d5c88(0xf6d)](_0x457181=>{const _0x3844d5=_0x5d5c88,_0x4c81c5=_0x250edc[_0x457181['name']]||{'icon':_0x3844d5(0xbbe),'color':'#007AFF'};return _0x3844d5(0x1851)+_0x457181[_0x3844d5(0x222f)]+'\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-avatar\x22\x20style=\x22background:\x20'+_0x4c81c5[_0x3844d5(0x2099)]+_0x3844d5(0x2488)+_0x4c81c5[_0x3844d5(0x689)]+'\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-name\x22>'+_0x457181['name']+_0x3844d5(0xbe6)+_0x457181[_0x3844d5(0x8e1)]+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-preview\x22>'+_0x457181[_0x3844d5(0x4e6)]+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';})['join']('');}async function generatePhoneNotesAPI(){const _0x43c38c=_0x2cf6d4,_0x450921=document[_0x43c38c(0x15b8)]('.phone-notes-list');if(!_0x450921)return;if(window[_0x43c38c(0xd0c)]&&window[_0x43c38c(0xae1)]===currentChatCharacter['id'])return;try{_0x450921[_0x43c38c(0xc02)]=_0x43c38c(0xd2b)+currentChatCharacter[_0x43c38c(0x222f)]+'的备忘录...</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';const _0x27a3d5=await buildPhoneContextInfo(),_0x2bfcd3=_0x43c38c(0xea4)+currentChatCharacter[_0x43c38c(0x222f)]+_0x43c38c(0x149d)+_0x27a3d5+_0x43c38c(0xa6d),_0x239d93=await callPhoneAPI(_0x2bfcd3),_0xb7cbe6=cleanAndFixJSON(_0x239d93);if(_0xb7cbe6[_0x43c38c(0x4ba)]&&Array[_0x43c38c(0x1bcc)](_0xb7cbe6[_0x43c38c(0x4ba)])){window[_0x43c38c(0x140)]=_0xb7cbe6[_0x43c38c(0x4ba)];const _0x5a9982=_0xb7cbe6['notes'][_0x43c38c(0xf6d)](_0x96b9c2=>'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-note-item\x22\x20onclick=\x22openPhoneNoteAPI(\x27'+_0x96b9c2['title']+_0x43c38c(0xe5f)+_0x96b9c2[_0x43c38c(0x1c18)]+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-note-preview\x22>'+_0x96b9c2['preview']+_0x43c38c(0x402)+_0x96b9c2[_0x43c38c(0x8e1)]+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20')[_0x43c38c(0x140c)]('');_0x450921[_0x43c38c(0xc02)]=_0x5a9982,window[_0x43c38c(0xd0c)]=!![],window['phoneNotesCharacterId']=currentChatCharacter['id'],showToast('✅\x20备忘录生成完成',_0x43c38c(0xb27));}else throw new Error(_0x43c38c(0x1996));}catch(_0x31d38b){console['error']('生成备忘录失败:',_0x31d38b),showPhoneRegenerateButton('.phone-notes-list',generatePhoneNotesAPI);}}function generatePhoneNotes(){const _0xc9ba42=_0x2cf6d4,_0x1251e2=document[_0xc9ba42(0x15b8)](_0xc9ba42(0x5af));if(!_0x1251e2)return;const _0x37bed0=[{'title':_0xc9ba42(0x1024),'preview':_0xc9ba42(0x65e),'time':_0xc9ba42(0x1101)},{'title':_0xc9ba42(0x511),'preview':_0xc9ba42(0x77f),'time':'昨天\x2016:45'},{'title':_0xc9ba42(0xd1e),'preview':'今天读了一本很有趣的书，关于时间管理的...','time':_0xc9ba42(0x23fe)},{'title':_0xc9ba42(0x1e4e),'preview':_0xc9ba42(0x1940),'time':_0xc9ba42(0x9ef)},{'title':_0xc9ba42(0x237c),'preview':'今天跑步5公里，做了30分钟力量训练...','time':_0xc9ba42(0x9ef)}];_0x1251e2[_0xc9ba42(0xc02)]=_0x37bed0[_0xc9ba42(0xf6d)](_0x3a26bb=>'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-note-item\x22\x20onclick=\x22openPhoneNote(\x27'+_0x3a26bb[_0xc9ba42(0x1c18)]+_0xc9ba42(0x2b1)+_0x3a26bb['title']+_0xc9ba42(0xf0a)+_0x3a26bb['preview']+_0xc9ba42(0x4b8)+_0x3a26bb[_0xc9ba42(0x8e1)]+_0xc9ba42(0x24bf))['join']('');}async function generatePhonePhotosAPI(){const _0x2de346=_0x2cf6d4,_0x195a32=document[_0x2de346(0x15b8)](_0x2de346(0x24e5));if(!_0x195a32)return;if(window[_0x2de346(0x208e)]&&window[_0x2de346(0x1037)]===currentChatCharacter['id'])return;try{_0x195a32['innerHTML']=_0x2de346(0x1b03)+currentChatCharacter[_0x2de346(0x222f)]+_0x2de346(0x8b1);const _0x21e292=await buildPhoneContextInfo(),_0x3c4e88=_0x2de346(0xea4)+currentChatCharacter['name']+'\x22生成手机相册中的照片/视频描述。\x0a\x0a'+_0x21e292+_0x2de346(0x1be1),_0xe57052=await callPhoneAPI(_0x3c4e88),_0xe12245=cleanAndFixJSON(_0xe57052);if(_0xe12245['media']&&Array[_0x2de346(0x1bcc)](_0xe12245[_0x2de346(0x22e0)])){window[_0x2de346(0x3e3)]=_0xe12245[_0x2de346(0x22e0)];const _0xed09b1=_0xe12245[_0x2de346(0x22e0)][_0x2de346(0xf6d)]((_0x28e88c,_0xe2ac29)=>_0x2de346(0x34b)+_0xe2ac29+'\x22\x20onclick=\x22openPhonePhotoByIndex('+_0xe2ac29+_0x2de346(0x16f7)+(_0x28e88c['type']==='video'?'play-circle':'image')+_0x2de346(0x23c0))['join']('');_0x195a32[_0x2de346(0xc02)]=_0xed09b1,window['phonePhotosGenerated']=!![],window[_0x2de346(0x1037)]=currentChatCharacter['id'],showToast(_0x2de346(0x2271),'success');}else throw new Error(_0x2de346(0x1996));}catch(_0x366a3a){console[_0x2de346(0x24ab)](_0x2de346(0x7d3),_0x366a3a),showPhoneRegenerateButton(_0x2de346(0x24e5),generatePhonePhotosAPI);}}function generatePhonePhotos(){const _0x433882=_0x2cf6d4,_0x33c124=document[_0x433882(0x15b8)](_0x433882(0x24e5));if(!_0x33c124)return;const _0x4ce259=['春日樱花',_0x433882(0x209a),_0x433882(0xb16),_0x433882(0x208d),_0x433882(0x2333),'旅行回忆'],_0x340e55=_0x4ce259['map'](_0xfe53be=>_0x433882(0x18f9)+_0xfe53be+_0x433882(0x1b86))[_0x433882(0x140c)]('');_0x33c124[_0x433882(0xc02)]=_0x340e55;}async function buildPhoneContextInfo(){const _0x358fed=_0x2cf6d4;let _0xc41f51='';const _0x2a151a=_0x358fed(0x1c4d)+currentChatCharacter[_0x358fed(0x222f)]+_0x358fed(0x554)+(currentChatCharacter['description']||currentChatCharacter[_0x358fed(0x1a84)]||currentChatCharacter[_0x358fed(0x1f8f)]||_0x358fed(0x220a));_0xc41f51+=_0x2a151a+'\x0a\x0a';try{const _0x4ede3c=getCurrentChatSettings(),_0x4c4483=_0x4ede3c[_0x358fed(0x9af)]&&_0x4ede3c[_0x358fed(0xefa)]?_0x4ede3c[_0x358fed(0xefa)]:[],_0x216434=window[_0x358fed(0xfb9)]||[],_0x5aab7f=[...new Set([..._0x216434,..._0x4c4483])];_0x5aab7f['length']>0x0&&(_0xc41f51+='世界书设定：\x0a',_0x5aab7f[_0x358fed(0x900)]((_0x2b8397,_0x3ac8ee)=>{const _0x2150af=_0x358fed,_0x2a0f28=worldbooks[_0x2150af(0x1aeb)](_0x232e0f=>_0x232e0f['id']===_0x2b8397);_0x2a0f28&&(_0xc41f51+=_0x3ac8ee+0x1+'.\x20'+(_0x2a0f28[_0x2150af(0x222f)]||_0x2a0f28['title'])+'：'+_0x2a0f28[_0x2150af(0x1423)]+'\x0a');}),_0xc41f51+='\x0a');}catch(_0x29ded7){console[_0x358fed(0x24ab)](_0x358fed(0x586),_0x29ded7);}try{const _0x338163=getGlobalMemorySettings();if(_0x338163[_0x358fed(0x591)]!==![]){const _0x484ddf={'type':currentChatCharacter['isGroup']?'group_chat':_0x358fed(0x10d7),'id':currentChatCharacter['id']},_0x2ce45f=await buildGlobalMemoryContext(currentChatCharacter['id'],_0x484ddf,_0x338163['memoryDays']||0x7);_0x2ce45f&&_0x2ce45f[_0x358fed(0x1424)]()&&(_0xc41f51+=_0x358fed(0x18a8)+_0x2ce45f+'\x0a\x0a');}}catch(_0x4bc856){console[_0x358fed(0x24ab)](_0x358fed(0x20b1),_0x4bc856);}try{const _0x540088=currentChatCharacter['id'];if(chatMessages[_0x540088]&&chatMessages[_0x540088][_0x358fed(0xcbf)]>0x0){const _0x4792d9=chatMessages[_0x540088][_0x358fed(0x136)](-0x28);if(_0x4792d9[_0x358fed(0xcbf)]>0x0){const _0x4182fc=getCurrentPersonaName();_0xc41f51+=_0x358fed(0x1a3d),_0x4792d9[_0x358fed(0x900)](_0x314227=>{const _0x4dc1c0=_0x358fed,_0x36e8b4=_0x314227['sender']===_0x4dc1c0(0xfda)?_0x4182fc:currentChatCharacter[_0x4dc1c0(0x222f)];_0xc41f51+=_0x36e8b4+'：'+_0x314227[_0x4dc1c0(0x1423)]+'\x0a';}),_0xc41f51+='\x0a';}}}catch(_0x5935e2){console[_0x358fed(0x24ab)](_0x358fed(0x2169),_0x5935e2);}return _0xc41f51;}function debugCharacterAvatar(){const _0x45b9fc=_0x2cf6d4;if(!currentChatCharacter){console[_0x45b9fc(0xc0d)](_0x45b9fc(0x1e6e));return;}const _0x2eef68=getCurrentChatSettings();console['log']('🔍\x20角色头像调试信息:'),console[_0x45b9fc(0xc0d)](_0x45b9fc(0x1117),currentChatCharacter[_0x45b9fc(0x222f)]),console['log'](_0x45b9fc(0x84b),currentChatCharacter['id']),console[_0x45b9fc(0xc0d)](_0x45b9fc(0x1cd8),_0x2eef68[_0x45b9fc(0x23e0)]||_0x45b9fc(0x68b)),console['log']('\x20\x20-\x20角色卡头像:',currentChatCharacter['avatarUrl']||_0x45b9fc(0x68b));const _0x4bd285=_0x2eef68[_0x45b9fc(0x23e0)]||currentChatCharacter[_0x45b9fc(0x10f9)]||'';console[_0x45b9fc(0xc0d)](_0x45b9fc(0x223),_0x4bd285||'(空白\x20-\x20将显示默认图标)'),!_0x4bd285&&(console[_0x45b9fc(0x17cc)](_0x45b9fc(0x921)),console[_0x45b9fc(0x17cc)](_0x45b9fc(0x102a)),console[_0x45b9fc(0x17cc)](_0x45b9fc(0x115)));}function debugCharacterNickname(){const _0xb67ac9=_0x2cf6d4;if(!currentChatCharacter){console[_0xb67ac9(0xc0d)](_0xb67ac9(0x1e6e));return;}const _0xd02fb9=getCurrentChatSettings();console[_0xb67ac9(0xc0d)](_0xb67ac9(0x104a)),console[_0xb67ac9(0xc0d)]('\x20\x20-\x20角色名称:',currentChatCharacter[_0xb67ac9(0x222f)]),console[_0xb67ac9(0xc0d)](_0xb67ac9(0x84b),currentChatCharacter['id']),console[_0xb67ac9(0xc0d)](_0xb67ac9(0x14f3),_0xd02fb9[_0xb67ac9(0x1967)]||_0xb67ac9(0x68b)),console['log'](_0xb67ac9(0x27d),_0xd02fb9[_0xb67ac9(0xb42)]||_0xb67ac9(0x68b)),console[_0xb67ac9(0xc0d)]('\x20\x20-\x20最终显示名称:',_0xd02fb9[_0xb67ac9(0x1967)]||currentChatCharacter[_0xb67ac9(0x222f)]),console[_0xb67ac9(0xc0d)](_0xb67ac9(0xa8));if(window['chatSettings']&&window[_0xb67ac9(0xb08)][currentChatCharacter['id']]){const _0x380bd7=window[_0xb67ac9(0xb08)][currentChatCharacter['id']];console[_0xb67ac9(0xc0d)](_0xb67ac9(0x1b70),_0x380bd7[_0xb67ac9(0x1967)]||'(未设置)'),console[_0xb67ac9(0xc0d)](_0xb67ac9(0xd1b),_0x380bd7[_0xb67ac9(0xb42)]||_0xb67ac9(0x68b));}else console['log']('\x20\x20-\x20缓存状态:\x20未找到该角色的设置缓存');}function showPhoneRegenerateButton(_0x360785,_0x111564,_0x2579eb=null){const _0x575771=_0x2cf6d4,_0x3767a0=document[_0x575771(0x15b8)](_0x360785);if(!_0x3767a0)return;if(typeof _0x111564!==_0x575771(0xb1)){console[_0x575771(0x24ab)](_0x575771(0x1d86),_0x111564);return;}const _0x5f510e=_0x575771(0x6dc)+Date['now']()+'_'+Math['random']()[_0x575771(0x9a3)](0x24)[_0x575771(0x18cf)](0x2,0x9);window[_0x575771(0x11eb)]=window[_0x575771(0x11eb)]||{},window[_0x575771(0x11eb)][_0x5f510e]={'func':_0x111564,'params':_0x2579eb},_0x3767a0[_0x575771(0xc02)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-regenerate-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-regenerate-text\x22>生成失败</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22phone-regenerate-button\x22\x20onclick=\x22executePhoneRegenerate(\x27'+_0x360785+_0x575771(0x1799)+_0x5f510e+'\x27);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20重新生成\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';}async function executePhoneRegenerate(_0x5a6998,_0x5bcf42){const _0x54c145=_0x2cf6d4,_0x59d83b=document['querySelector'](_0x5a6998);_0x59d83b&&(_0x59d83b[_0x54c145(0xc02)]=_0x54c145(0x14c));const _0x6926e5=window[_0x54c145(0x11eb)][_0x5bcf42];if(!_0x6926e5){console[_0x54c145(0x24ab)](_0x54c145(0x283),_0x5bcf42);_0x59d83b&&(_0x59d83b[_0x54c145(0xc02)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-regenerate-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-regenerate-text\x22>重新生成失败：找不到函数</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20');return;}console[_0x54c145(0xc0d)](_0x54c145(0xa98),_0x6926e5);if(typeof _0x6926e5['func']!==_0x54c145(0xb1)){console['error'](_0x54c145(0x191b),_0x6926e5[_0x54c145(0x168b)]);_0x59d83b&&(_0x59d83b[_0x54c145(0xc02)]=_0x54c145(0x1914));return;}try{_0x6926e5[_0x54c145(0x403)]?await _0x6926e5[_0x54c145(0x168b)](..._0x6926e5['params']):await _0x6926e5[_0x54c145(0x168b)](),delete window[_0x54c145(0x11eb)][_0x5bcf42];}catch(_0x45c37a){console[_0x54c145(0x24ab)](_0x54c145(0xeb6),_0x45c37a),showPhoneRegenerateButton(_0x5a6998,_0x6926e5[_0x54c145(0x168b)],_0x6926e5['params']);}}function showPhoneApiConfigPrompt(){const _0x3ab006=_0x2cf6d4,_0x256916=document[_0x3ab006(0x15b8)](_0x3ab006(0x152c));if(!_0x256916)return;const _0x497708=document[_0x3ab006(0x1ad8)](_0x3ab006(0x526));_0x497708['className']=_0x3ab006(0x164f),_0x497708['innerHTML']=_0x3ab006(0x14bd);getComputedStyle(_0x256916)[_0x3ab006(0x492)]===_0x3ab006(0x12ef)&&(_0x256916[_0x3ab006(0x655)][_0x3ab006(0x492)]=_0x3ab006(0x1b89));const _0xafc1b4=_0x256916[_0x3ab006(0x15b8)]('.phone-regenerate-overlay');_0xafc1b4&&_0xafc1b4['remove'](),_0x256916[_0x3ab006(0x1925)](_0x497708);}function cleanAndFixJSON(_0x344b45){const _0x1fe28d=_0x2cf6d4;console[_0x1fe28d(0xc0d)](_0x1fe28d(0x1438),_0x344b45);if(!_0x344b45||_0x344b45[_0x1fe28d(0x1424)]()==='')throw new Error(_0x1fe28d(0x378));let _0x5b2d52=_0x344b45[_0x1fe28d(0x1424)]();if(_0x5b2d52[_0x1fe28d(0x1cab)]('```json'))_0x5b2d52=_0x5b2d52[_0x1fe28d(0x882)](/^```json\s*/,'')['replace'](/\s*```$/,'');else _0x5b2d52['startsWith'](_0x1fe28d(0x1b9d))&&(_0x5b2d52=_0x5b2d52[_0x1fe28d(0x882)](/^```\s*/,'')['replace'](/\s*```$/,''));console[_0x1fe28d(0xc0d)](_0x1fe28d(0xd96),_0x5b2d52);if(!_0x5b2d52||_0x5b2d52[_0x1fe28d(0x1424)]()==='')throw new Error('清理后响应为空');let _0x455c4c=_0x5b2d52;try{return JSON['parse'](_0x455c4c);}catch(_0x361335){console[_0x1fe28d(0x17cc)](_0x1fe28d(0x223c),_0x361335[_0x1fe28d(0xd7a)]);if(!_0x455c4c[_0x1fe28d(0x1424)]()[_0x1fe28d(0xd7e)]('}')){let _0x2a41a9=(_0x455c4c['match'](/{/g)||[])[_0x1fe28d(0xcbf)],_0x5a71e1=(_0x455c4c[_0x1fe28d(0x1316)](/}/g)||[])['length'],_0x4d881a=(_0x455c4c[_0x1fe28d(0x1316)](/\[/g)||[])[_0x1fe28d(0xcbf)],_0x41c8c5=(_0x455c4c[_0x1fe28d(0x1316)](/]/g)||[])[_0x1fe28d(0xcbf)];for(let _0x3ca17b=0x0;_0x3ca17b<_0x4d881a-_0x41c8c5;_0x3ca17b++){_0x455c4c+=']';}for(let _0x563dcb=0x0;_0x563dcb<_0x2a41a9-_0x5a71e1;_0x563dcb++){_0x455c4c+='}';}console[_0x1fe28d(0xc0d)]('尝试修复后的JSON:',_0x455c4c);try{return JSON['parse'](_0x455c4c);}catch(_0x4c985d){console[_0x1fe28d(0x24ab)](_0x1fe28d(0x2559),_0x4c985d[_0x1fe28d(0xd7a)]);throw new Error(_0x1fe28d(0x10a8)+_0x361335[_0x1fe28d(0xd7a)]);}}else throw new Error(_0x1fe28d(0x10a8)+_0x361335[_0x1fe28d(0xd7a)]);}}async function callPhoneAPI(_0x4e9b09){const _0x497d08=_0x2cf6d4;if(!apiSettings[_0x497d08(0x90b)]||!apiSettings[_0x497d08(0x157f)])throw new Error(_0x497d08(0x1523));const _0x13346d=apiSettings[_0x497d08(0x90b)]['includes']('generativelanguage.googleapis.com');let _0x788a22;if(_0x13346d){const _0x3bfde8=apiSettings['base']+_0x497d08(0x1f4e)+apiSettings[_0x497d08(0xeea)]+_0x497d08(0x23aa)+apiSettings[_0x497d08(0x157f)];_0x788a22=await fetch(_0x3bfde8,{'method':_0x497d08(0x227d),'headers':{'Content-Type':_0x497d08(0x302)},'body':JSON[_0x497d08(0x7fb)]({'contents':[{'parts':[{'text':_0x4e9b09}]}],'generationConfig':{'temperature':0.8,'maxOutputTokens':0x2000}})});if(!_0x788a22['ok'])throw new Error(_0x497d08(0x1cf0)+_0x788a22[_0x497d08(0xe54)]);const _0x5d6798=await _0x788a22[_0x497d08(0x2318)]();return _0x5d6798[_0x497d08(0x1d23)][0x0]['content'][_0x497d08(0x23c1)][0x0][_0x497d08(0x1e58)];}else{let _0x391fc3;if(apiSettings[_0x497d08(0x90b)][_0x497d08(0xd7e)](_0x497d08(0xb73)))_0x391fc3=apiSettings['base'];else apiSettings['base'][_0x497d08(0xd7e)]('/v1')?_0x391fc3=apiSettings[_0x497d08(0x90b)]+'/chat/completions':_0x391fc3=apiSettings['base']+_0x497d08(0xce8);_0x788a22=await fetch(_0x391fc3,{'method':_0x497d08(0x227d),'headers':{'Content-Type':_0x497d08(0x302),'Authorization':_0x497d08(0x858)+apiSettings['key']},'body':JSON[_0x497d08(0x7fb)]({'model':apiSettings[_0x497d08(0xeea)],'messages':[{'role':_0x497d08(0x23b2),'content':_0x4e9b09}],'temperature':0.8,'max_tokens':0x2000})});if(!_0x788a22['ok'])throw new Error(_0x497d08(0x1cf0)+_0x788a22['status']);const _0x8afee5=await _0x788a22[_0x497d08(0x2318)]();return _0x8afee5[_0x497d08(0x13cf)][0x0]['message'][_0x497d08(0x1423)];}}async function switchPhoneTab(_0x5cbe77){const _0x33afcf=_0x2cf6d4;document[_0x33afcf(0x1ed9)]('.phone-tab')[_0x33afcf(0x900)](_0x4b8758=>{const _0x30abfc=_0x33afcf;_0x4b8758[_0x30abfc(0x226e)]['remove'](_0x30abfc(0x105d));}),document[_0x33afcf(0x15b8)](_0x33afcf(0xe5c)+_0x5cbe77+'\x22]')[_0x33afcf(0x226e)][_0x33afcf(0xe1)](_0x33afcf(0x105d)),document[_0x33afcf(0x1ed9)](_0x33afcf(0x24f0))[_0x33afcf(0x900)](_0x46719b=>{const _0xa44f5c=_0x33afcf;_0x46719b[_0xa44f5c(0x655)][_0xa44f5c(0x2526)]=_0xa44f5c(0xfe9);}),document[_0x33afcf(0x566)](_0x33afcf(0x1f3e)+_0x5cbe77+_0x33afcf(0x439))[_0x33afcf(0x655)][_0x33afcf(0x2526)]='block';if(_0x5cbe77===_0x33afcf(0x4ba)){if(!apiSettings[_0x33afcf(0x90b)]||!apiSettings[_0x33afcf(0x157f)])console['log'](_0x33afcf(0x1a90)),generatePhoneNotes();else try{await generatePhoneNotesAPI();}catch(_0x283452){console[_0x33afcf(0x24ab)](_0x33afcf(0x23eb),_0x283452),generatePhoneNotes();}}else{if(_0x5cbe77===_0x33afcf(0x116b)){if(!apiSettings[_0x33afcf(0x90b)]||!apiSettings['key'])console[_0x33afcf(0xc0d)](_0x33afcf(0x130b)),generatePhonePhotos();else try{await generatePhonePhotosAPI();}catch(_0x586d06){console['error'](_0x33afcf(0x23e5),_0x586d06),generatePhonePhotos();}}}}async function generatePhoneChatMessagesAPI(_0x1e7ca5){const _0x4ef4ba=_0x2cf6d4,_0x585bb9=document[_0x4ef4ba(0x566)](_0x4ef4ba(0x1957));if(!_0x585bb9)return;if(window[_0x4ef4ba(0xe52)]&&window[_0x4ef4ba(0xe52)][_0x1e7ca5]){console[_0x4ef4ba(0xc0d)](_0x4ef4ba(0x350),_0x1e7ca5);const _0x32963e=window[_0x4ef4ba(0xe52)][_0x1e7ca5],_0x3b3274=window[_0x4ef4ba(0x896)]?.[_0x4ef4ba(0x1aeb)](_0x5844dc=>_0x5844dc[_0x4ef4ba(0x222f)]===_0x1e7ca5),_0x389952=_0x32963e['map'](_0x36ca7f=>{const _0x2d1e4e=_0x4ef4ba;if(_0x36ca7f[_0x2d1e4e(0x23df)]===_0x2d1e4e(0x1c5b))return _0x2d1e4e(0x230b)+_0x36ca7f[_0x2d1e4e(0x1423)]+_0x2d1e4e(0x12d0);else{if(_0x36ca7f[_0x2d1e4e(0x23df)]==='received')return'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-bubble\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-row\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-avatar-small\x22\x20style=\x22background:\x20'+(_0x3b3274?.['avatar']?.[_0x2d1e4e(0x2099)]||_0x2d1e4e(0x1f03))+_0x2d1e4e(0x145a)+(_0x3b3274?.[_0x2d1e4e(0x107f)]?.[_0x2d1e4e(0x689)]||'fas\x20fa-user')+'\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-text\x22>'+_0x36ca7f[_0x2d1e4e(0x1423)]+_0x2d1e4e(0x289)+_0x36ca7f[_0x2d1e4e(0x8e1)]+_0x2d1e4e(0x931);else{let _0x2ce77d='';if(currentChatCharacter){const _0x1f3040=getCurrentChatSettings();_0x2ce77d=_0x1f3040['aiChatAvatar']||currentChatCharacter[_0x2d1e4e(0x10f9)]||'';}const _0x39939c=_0x2ce77d?'<img\x20src=\x22'+_0x2ce77d+_0x2d1e4e(0x1ca8)+(currentChatCharacter?.[_0x2d1e4e(0x222f)]||'我')+_0x2d1e4e(0xaa4):_0x2d1e4e(0x976);return _0x2d1e4e(0x2410)+_0x39939c+_0x2d1e4e(0x1eb5)+_0x36ca7f[_0x2d1e4e(0x1423)]+_0x2d1e4e(0x289)+_0x36ca7f[_0x2d1e4e(0x8e1)]+_0x2d1e4e(0x931);}}})[_0x4ef4ba(0x140c)]('');_0x585bb9[_0x4ef4ba(0xc02)]=_0x389952,setTimeout(()=>{const _0xd8b00=_0x4ef4ba;_0x585bb9[_0xd8b00(0x5e5)]=_0x585bb9[_0xd8b00(0x14c8)];},0x64);return;}try{_0x585bb9['innerHTML']=_0x4ef4ba(0x3ad)+_0x1e7ca5+_0x4ef4ba(0x1ef7);const _0x3607ec=window[_0x4ef4ba(0x896)]?.['find'](_0x36cc33=>_0x36cc33[_0x4ef4ba(0x222f)]===_0x1e7ca5),_0x385a8c=_0x3607ec?.[_0x4ef4ba(0x18ba)]||'朋友',_0x13b839=await buildPhoneContextInfo(),_0x2c38bf='请为角色\x22'+currentChatCharacter[_0x4ef4ba(0x222f)]+'\x22生成与\x22'+_0x1e7ca5+'\x22（'+_0x385a8c+'）的手机聊天记录。\x0a\x0a'+_0x13b839+_0x4ef4ba(0xe56),_0x316013=await callPhoneAPI(_0x2c38bf),_0x55ad0e=cleanAndFixJSON(_0x316013);if(_0x55ad0e[_0x4ef4ba(0x1767)]&&Array[_0x4ef4ba(0x1bcc)](_0x55ad0e[_0x4ef4ba(0x1767)])){const _0x3923f5=_0x55ad0e[_0x4ef4ba(0x1767)]['map'](_0x2fa603=>{const _0x56f96e=_0x4ef4ba;if(_0x2fa603[_0x56f96e(0x23df)]===_0x56f96e(0x1c5b))return _0x56f96e(0x2230)+_0x2fa603[_0x56f96e(0x1423)]+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';else{if(_0x2fa603[_0x56f96e(0x23df)]===_0x56f96e(0x232))return _0x56f96e(0x21b5)+(_0x3607ec?.[_0x56f96e(0x107f)]?.['color']||'#007AFF')+_0x56f96e(0xe20)+(_0x3607ec?.['avatar']?.[_0x56f96e(0x689)]||_0x56f96e(0xbbe))+_0x56f96e(0xf1e)+_0x2fa603[_0x56f96e(0x1423)]+_0x56f96e(0x300)+_0x2fa603[_0x56f96e(0x8e1)]+_0x56f96e(0x107d);else{let _0x4d2d9a='';if(currentChatCharacter){const _0x491365=getCurrentChatSettings();_0x4d2d9a=_0x491365[_0x56f96e(0x23e0)]||currentChatCharacter['avatarUrl']||'';}const _0x11a46e=_0x4d2d9a?_0x56f96e(0x2001)+_0x4d2d9a+'\x22\x20alt=\x22'+(currentChatCharacter?.[_0x56f96e(0x222f)]||'我')+_0x56f96e(0xaa4):_0x56f96e(0x976);return _0x56f96e(0xc4a)+_0x11a46e+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-text\x22>'+_0x2fa603['content']+_0x56f96e(0x300)+_0x2fa603[_0x56f96e(0x8e1)]+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';}}})['join']('');_0x585bb9[_0x4ef4ba(0xc02)]=_0x3923f5,setTimeout(()=>{const _0x2b7cd9=_0x4ef4ba;_0x585bb9['scrollTop']=_0x585bb9[_0x2b7cd9(0x14c8)];},0x64);}else throw new Error(_0x4ef4ba(0x1996));}catch(_0x55f0c8){console['error'](_0x4ef4ba(0xf51),_0x55f0c8),showPhoneRegenerateButton(_0x4ef4ba(0x8fb),generatePhoneChatMessagesAPI,[_0x1e7ca5]);}}async function openPhoneMessage(_0x5bf472){const _0x62f124=_0x2cf6d4,_0x176554=document[_0x62f124(0x566)](_0x62f124(0x16a5));_0x176554&&(_0x176554['textContent']=_0x5bf472),hideApp(_0x62f124(0x16dc)),showApp(_0x62f124(0x12aa)),await generatePhoneChatMessagesAPI(_0x5bf472);}async function generatePhoneChatMessages(_0x442ca8){const _0x3ec978=_0x2cf6d4,_0x5a5780=document[_0x3ec978(0x566)]('phone-chat-messages');if(!_0x5a5780)return;let _0x1df902='';if(currentChatCharacter){const _0x2b8c6c=getCurrentChatSettings();_0x1df902=_0x2b8c6c[_0x3ec978(0x23e0)]||currentChatCharacter['avatarUrl']||'';}const _0x245ae6={'小红':[{'type':_0x3ec978(0x1c5b),'content':'今天'},{'type':'received','content':_0x3ec978(0x3a6),'time':_0x3ec978(0xd64)},{'type':_0x3ec978(0xfda),'content':_0x3ec978(0x9d3),'time':_0x3ec978(0x2ca)},{'type':_0x3ec978(0x232),'content':_0x3ec978(0x34e),'time':_0x3ec978(0x2244)},{'type':'sent','content':'好主意！几点出发？','time':'09:18'},{'type':_0x3ec978(0x232),'content':_0x3ec978(0x73f),'time':_0x3ec978(0x2f1)},{'type':_0x3ec978(0xfda),'content':_0x3ec978(0x1cf6),'time':'09:22'},{'type':'received','content':_0x3ec978(0x76a),'time':'10:30'}],'小明':[{'type':_0x3ec978(0x1c5b),'content':'昨天'},{'type':_0x3ec978(0x232),'content':_0x3ec978(0x105c),'time':_0x3ec978(0xc19)},{'type':_0x3ec978(0xfda),'content':'还没想好，你有什么建议？','time':_0x3ec978(0xa3c)},{'type':_0x3ec978(0x232),'content':'听说新开了一家游戏厅，我们去试试？','time':_0x3ec978(0x91d)},{'type':'sent','content':'听起来不错！在哪里？','time':_0x3ec978(0xab9)},{'type':'received','content':_0x3ec978(0x1be2),'time':_0x3ec978(0x1ea)},{'type':_0x3ec978(0x232),'content':_0x3ec978(0x60c),'time':_0x3ec978(0x2115)},{'type':_0x3ec978(0xfda),'content':_0x3ec978(0xa61),'time':_0x3ec978(0x1a76)},{'type':_0x3ec978(0x232),'content':_0x3ec978(0x9ed),'time':'14:43'}],'妈妈':[{'type':'date','content':'昨天'},{'type':'received','content':_0x3ec978(0x1d59),'time':_0x3ec978(0x1722)},{'type':_0x3ec978(0xfda),'content':_0x3ec978(0x1e6),'time':'12:05'},{'type':'received','content':_0x3ec978(0x173b),'time':_0x3ec978(0x2547)},{'type':_0x3ec978(0xfda),'content':_0x3ec978(0x1c9),'time':_0x3ec978(0xbdd)},{'type':'received','content':'还有，晚上早点休息，不要熬夜','time':'18:30'},{'type':_0x3ec978(0xfda),'content':'我会的，您也要注意身体','time':'18:32'},{'type':'received','content':_0x3ec978(0x327),'time':_0x3ec978(0x19dd)},{'type':_0x3ec978(0xfda),'content':_0x3ec978(0x204e),'time':_0x3ec978(0x24c2)}],'同事小李':[{'type':'date','content':'2天前'},{'type':_0x3ec978(0x232),'content':'明天的会议记得准备资料','time':'16:45'},{'type':_0x3ec978(0xfda),'content':_0x3ec978(0x63a),'time':'16:47'},{'type':_0x3ec978(0x232),'content':_0x3ec978(0x19cc),'time':_0x3ec978(0x1b7d)},{'type':_0x3ec978(0xfda),'content':'了解，我会认真准备的','time':_0x3ec978(0x127c)},{'type':_0x3ec978(0x232),'content':_0x3ec978(0x1013),'time':'16:52'},{'type':_0x3ec978(0xfda),'content':'谢谢！如果有需要我会联系你','time':'16:54'},{'type':'received','content':'好的，加油！💪','time':_0x3ec978(0xfa0)}],'室友':[{'type':_0x3ec978(0x1c5b),'content':_0x3ec978(0x10dd)},{'type':_0x3ec978(0x232),'content':_0x3ec978(0x916),'time':_0x3ec978(0x160a)},{'type':_0x3ec978(0xfda),'content':'好啊！看什么电影？','time':_0x3ec978(0x886)},{'type':_0x3ec978(0x232),'content':'我买了爆米花，还有新上映的科幻片','time':_0x3ec978(0x1f7f)},{'type':_0x3ec978(0xfda),'content':_0x3ec978(0x6d3),'time':_0x3ec978(0x162a)},{'type':_0x3ec978(0x232),'content':'8点怎么样？我准备一些饮料','time':_0x3ec978(0x97c)},{'type':_0x3ec978(0xfda),'content':'完美！我带点零食','time':_0x3ec978(0x2143)},{'type':_0x3ec978(0x232),'content':_0x3ec978(0x1d8b),'time':'19:40'}]},_0x2c4202=_0x245ae6[_0x442ca8]||[{'type':_0x3ec978(0x1c5b),'content':'今天'},{'type':_0x3ec978(0x232),'content':_0x3ec978(0x347),'time':_0x3ec978(0x10ff)},{'type':_0x3ec978(0xfda),'content':_0x3ec978(0x347),'time':_0x3ec978(0x661)}],_0x4bd5ac={'小红':{'icon':'fas\x20fa-heart','color':_0x3ec978(0x160e)},'小明':{'icon':'fas\x20fa-gamepad','color':_0x3ec978(0xdc)},'妈妈':{'icon':_0x3ec978(0x19d4),'color':'#45B7D1'},'同事小李':{'icon':'fas\x20fa-briefcase','color':'#96CEB4'},'室友':{'icon':_0x3ec978(0x146f),'color':_0x3ec978(0x1429)}},_0x231835=_0x4bd5ac[_0x442ca8]||{'icon':_0x3ec978(0xbbe),'color':_0x3ec978(0x1f03)},_0xe84085=_0x2c4202[_0x3ec978(0xf6d)](_0x4b583c=>{const _0x1f6e1c=_0x3ec978;if(_0x4b583c[_0x1f6e1c(0x23df)]===_0x1f6e1c(0x1c5b))return'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-date-separator\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>'+_0x4b583c[_0x1f6e1c(0x1423)]+_0x1f6e1c(0x14d8);else{if(_0x4b583c[_0x1f6e1c(0x23df)]==='received')return _0x1f6e1c(0x23fa)+_0x231835[_0x1f6e1c(0x2099)]+_0x1f6e1c(0x2551)+_0x231835[_0x1f6e1c(0x689)]+_0x1f6e1c(0x12f9)+_0x4b583c['content']+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-time\x22>'+_0x4b583c[_0x1f6e1c(0x8e1)]+_0x1f6e1c(0xc9e);else{const _0x341dee=_0x1df902?_0x1f6e1c(0x2001)+_0x1df902+_0x1f6e1c(0x10ea):_0x1f6e1c(0x976);return _0x1f6e1c(0x1b25)+_0x341dee+_0x1f6e1c(0x237)+_0x4b583c[_0x1f6e1c(0x1423)]+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-time\x22>'+_0x4b583c['time']+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';}}})[_0x3ec978(0x140c)]('');_0x5a5780[_0x3ec978(0xc02)]=_0xe84085,setTimeout(()=>{const _0x42602f=_0x3ec978;_0x5a5780[_0x42602f(0x5e5)]=_0x5a5780[_0x42602f(0x14c8)];},0x64);}function openPhoneNote(_0x5938ba){const _0x2fe54d=_0x2cf6d4,_0x25a1ed={'🛒\x20购物清单':{'title':_0x2fe54d(0x1024),'time':_0x2fe54d(0x1101),'content':_0x2fe54d(0x1ee9)},'💼\x20工作计划':{'title':_0x2fe54d(0x511),'time':'昨天\x2016:45','content':'本周工作安排：\x0a\x0a1.\x20完成项目报告\x0a\x20\x20\x20-\x20整理数据分析结果\x0a\x20\x20\x20-\x20撰写总结报告\x0a\x20\x20\x20-\x20准备演示文稿\x0a\x0a2.\x20准备下周会议\x0a\x20\x20\x20-\x20收集团队反馈\x0a\x20\x20\x20-\x20制定下阶段计划\x0a\x20\x20\x20-\x20预约会议室\x0a\x0a3.\x20客户沟通\x0a\x20\x20\x20-\x20回复邮件\x0a\x20\x20\x20-\x20安排产品演示\x0a\x20\x20\x20-\x20跟进合作进展\x0a\x0a4.\x20学习提升\x0a\x20\x20\x20-\x20阅读行业报告\x0a\x20\x20\x20-\x20参加在线培训\x0a\x20\x20\x20-\x20整理学习笔记'},'📚\x20读书笔记':{'title':'📚\x20读书笔记','time':_0x2fe54d(0x23fe),'content':_0x2fe54d(0x2089)},'✈️\x20旅行计划':{'title':'✈️\x20旅行计划','time':_0x2fe54d(0x9ef),'content':'下个月的旅行安排：\x0a\x0a目的地：京都、大阪\x0a时间：4月15日-4月22日（7天6夜）\x0a\x0a行程安排：\x0aDay\x201-3:\x20京都\x0a-\x20清水寺、金阁寺、伏见稻荷大社\x0a-\x20祗园、二年坂三年坂\x0a-\x20岚山竹林、天龙寺\x0a\x0aDay\x204-6:\x20大阪\x0a-\x20大阪城、心斋桥、道顿堀\x0a-\x20环球影城\x0a-\x20奈良一日游（喂小鹿）\x0a\x0aDay\x207:\x20返程\x0a\x0a待办事项：\x0a✓\x20订机票\x0a✓\x20预定酒店\x0a□\x20办理签证\x0a□\x20兑换日元\x0a□\x20下载翻译app\x0a□\x20准备行李清单\x0a\x0a期待这次旅行！🌸'},'🏃‍♀️\x20健身记录':{'title':'🏃‍♀️\x20健身记录','time':'1周前','content':_0x2fe54d(0x5ab)}},_0x3c7975=_0x25a1ed[_0x5938ba]||{'title':_0x5938ba,'time':_0x2fe54d(0x191f),'content':_0x2fe54d(0x28c)};document[_0x2fe54d(0x566)](_0x2fe54d(0x132d))['textContent']=_0x3c7975['title'],document[_0x2fe54d(0x566)](_0x2fe54d(0x1a97))[_0x2fe54d(0x21dc)]=_0x3c7975[_0x2fe54d(0x8e1)],document['getElementById'](_0x2fe54d(0xa41))[_0x2fe54d(0x21dc)]=_0x3c7975[_0x2fe54d(0x1423)],hideApp(_0x2fe54d(0x16dc)),showApp(_0x2fe54d(0x2435));}function openPhoneNoteAPI(_0x385942){const _0x3c8341=_0x2cf6d4,_0x3ce1bf=window['phoneNotesData']?.[_0x3c8341(0x1aeb)](_0x864d66=>_0x864d66['title']===_0x385942);_0x3ce1bf?(document[_0x3c8341(0x566)]('phone-note-detail-title')[_0x3c8341(0x21dc)]=_0x3ce1bf[_0x3c8341(0x1c18)],document[_0x3c8341(0x566)](_0x3c8341(0x1a97))[_0x3c8341(0x21dc)]=_0x3ce1bf[_0x3c8341(0x8e1)],document[_0x3c8341(0x566)](_0x3c8341(0xa41))[_0x3c8341(0x21dc)]=_0x3ce1bf[_0x3c8341(0x1423)],hideApp(_0x3c8341(0x16dc)),showApp(_0x3c8341(0x2435))):showToast(_0x3c8341(0x79a),'error');}function openPhonePhotoByIndex(_0x1393e6){const _0x2c7ce1=_0x2cf6d4,_0x4981ea=window[_0x2c7ce1(0x3e3)]?.[_0x1393e6];_0x4981ea&&openPhonePhotoAPI(_0x4981ea[_0x2c7ce1(0x1c18)]);}function openPhonePhotoAPI(_0x13a97a){const _0x25a55d=_0x2cf6d4,_0x3f6563=window[_0x25a55d(0x3e3)]?.[_0x25a55d(0x1aeb)](_0x594656=>_0x594656[_0x25a55d(0x1c18)]===_0x13a97a);if(_0x3f6563){const _0x5c24cc=document['querySelector'](_0x25a55d(0xb1f));_0x5c24cc&&(_0x5c24cc[_0x25a55d(0x21dc)]=_0x3f6563[_0x25a55d(0x23df)]===_0x25a55d(0x2044)?'视频':'照片');document[_0x25a55d(0x566)](_0x25a55d(0x32d))[_0x25a55d(0x21dc)]=_0x3f6563[_0x25a55d(0x1c18)],document['getElementById']('phone-photo-detail-time')[_0x25a55d(0x21dc)]=_0x3f6563['time'],document['getElementById'](_0x25a55d(0xba2))[_0x25a55d(0x21dc)]=_0x3f6563[_0x25a55d(0x1c6f)];const _0x111733=document[_0x25a55d(0x566)](_0x25a55d(0x14a8));_0x3f6563[_0x25a55d(0x23df)]==='video'?_0x111733[_0x25a55d(0xc02)]=_0x25a55d(0x15a1)+(_0x3f6563['duration']||_0x25a55d(0x4ed))+_0x25a55d(0xefe):_0x111733[_0x25a55d(0xc02)]=_0x25a55d(0x19a9),hideApp('character-phone-screen'),showApp('character-phone-photo-screen');}else showToast(_0x25a55d(0xdc7),_0x25a55d(0x24ab));}function openPhonePhoto(_0x2f4fd1){const _0x704dfe=_0x2cf6d4,_0xedfb03={'春日樱花':{'title':'春日樱花','time':_0x704dfe(0x24a5),'description':_0x704dfe(0x255c)},'咖啡时光':{'title':_0x704dfe(0x209a),'time':_0x704dfe(0x19a8),'description':_0x704dfe(0x246b)},'夕阳西下':{'title':_0x704dfe(0xb16),'time':_0x704dfe(0x1150),'description':_0x704dfe(0x178a)},'城市夜景':{'title':'城市夜景','time':_0x704dfe(0x10e7),'description':'夜晚的城市灯火通明，高楼大厦在夜色中闪闪发光。从高处俯瞰，整个城市就像一颗璀璨的明珠，充满了现代都市的魅力。'},'美食记录':{'title':_0x704dfe(0x2333),'time':_0x704dfe(0x11a7),'description':_0x704dfe(0x1a07)},'旅行回忆':{'title':_0x704dfe(0x1815),'time':_0x704dfe(0x1d3e),'description':'上个月的旅行照片，那是一次难忘的旅程。虽然只是短短几天，但是看到了很多美丽的风景，认识了有趣的人，留下了珍贵的回忆。'}},_0x11e445=_0xedfb03[_0x2f4fd1]||{'title':_0x2f4fd1,'time':_0x704dfe(0x191f),'description':_0x704dfe(0x220a)};document[_0x704dfe(0x566)](_0x704dfe(0x32d))[_0x704dfe(0x21dc)]=_0x11e445[_0x704dfe(0x1c18)],document[_0x704dfe(0x566)]('phone-photo-detail-time')[_0x704dfe(0x21dc)]=_0x11e445[_0x704dfe(0x8e1)],document[_0x704dfe(0x566)]('phone-photo-detail-description')[_0x704dfe(0x21dc)]=_0x11e445['description'],hideApp(_0x704dfe(0x16dc)),showApp('character-phone-photo-screen');}async function showCharacterFootprints(){const _0x5d0b10=_0x2cf6d4;if(!currentChatCharacter){showToast(_0x5d0b10(0x1268),_0x5d0b10(0x24ab));return;}if(currentChatCharacter['isGroup']){showToast('群聊不支持足迹功能',_0x5d0b10(0x24ab));return;}currentFootprintsCharacter=currentChatCharacter;const _0x21f0b9=document[_0x5d0b10(0x566)](_0x5d0b10(0x10a6)),_0x19f1a5=document['getElementById'](_0x5d0b10(0x1202));_0x21f0b9&&(_0x21f0b9[_0x5d0b10(0x21dc)]=currentChatCharacter[_0x5d0b10(0x222f)]+_0x5d0b10(0x1172));if(_0x19f1a5){const _0x1b5a5a=await getCharacterDisplayAvatar(currentChatCharacter);_0x1b5a5a?_0x19f1a5[_0x5d0b10(0xc02)]=_0x5d0b10(0x2001)+_0x1b5a5a+'\x22\x20alt=\x22'+currentChatCharacter['name']+'\x22>':_0x19f1a5[_0x5d0b10(0xc02)]=_0x5d0b10(0x976);}showModal(_0x5d0b10(0x135a)),loadCharacterFootprints(),setupFootprintsAutoUpdate(),restoreFootprintsAutoUpdateSetting();}function hideCharacterFootprints(_0x143012){const _0x342642=_0x2cf6d4;if(_0x143012&&_0x143012['target']!==_0x143012['currentTarget'])return;hideModal(_0x342642(0x135a)),footprintsUpdateTimer&&(clearInterval(footprintsUpdateTimer),footprintsUpdateTimer=null),currentFootprintsCharacter=null;}async function loadCharacterFootprints(_0x181054=![]){const _0x466886=_0x2cf6d4;if(!currentFootprintsCharacter)return;const _0x59c4ba=document[_0x466886(0x566)](_0x466886(0xe6b));if(!_0x59c4ba)return;const _0x5685c5=currentFootprintsCharacter['id'];if(!_0x181054){const _0x20f2eb=_0x59c4ba[_0x466886(0x1ed9)](_0x466886(0x122c));if(_0x20f2eb[_0x466886(0xcbf)]>0x0){const _0x48e56a=_0x59c4ba[_0x466886(0x1f26)][_0x466886(0x10df)];if(_0x48e56a===_0x5685c5){console[_0x466886(0xc0d)]('🎭\x20DOM中已有当前角色\x20'+_0x5685c5+'\x20的\x20'+_0x20f2eb['length']+_0x466886(0x1754));return;}else console[_0x466886(0xc0d)]('🔄\x20DOM中是其他角色\x20'+_0x48e56a+_0x466886(0x781)+_0x5685c5+_0x466886(0x10c2)),_0x59c4ba[_0x466886(0xc02)]='';}const _0x48ee66=await getFootprintsCache(_0x5685c5);if(_0x48ee66){const _0x2a205a=Date['now']()-_0x48ee66[_0x466886(0x7aa)],_0x353cec=Date[_0x466886(0x18e0)]()-_0x48ee66[_0x466886(0x1d4f)],_0x220a94=Math[_0x466886(0x1dac)](_0x2a205a/(0x3c*0x3c*0x3e8)),_0x18a7ef=Math[_0x466886(0x1dac)](_0x2a205a%(0x3c*0x3c*0x3e8)/(0x3c*0x3e8));console[_0x466886(0xc0d)](_0x466886(0x233c)+(_0x48ee66[_0x466886(0x4f2)][_0x466886(0x9a5)]?.[_0x466886(0xcbf)]||0x0)+'\x20个活动'),console['log'](_0x466886(0x116d),_0x48ee66[_0x466886(0x4f2)]),await renderFootprintsTimeline(_0x48ee66[_0x466886(0x4f2)],!![]);return;}else{console[_0x466886(0xc0d)]('📝\x20没有今日足迹缓存，生成从0:00到当前时间的足迹'),await generateTodayFootprints();return;}}if(_0x181054){console[_0x466886(0xc0d)]('手动刷新：尝试增量更新...'),_0x59c4ba[_0x466886(0x22ba)](_0x466886(0x2386),_0x466886(0x10e4));const _0x2ac10b=await tryIncrementalUpdate(currentFootprintsCharacter),_0x2949e0=_0x59c4ba[_0x466886(0x15b8)](_0x466886(0xd04));_0x2949e0&&_0x2949e0[_0x466886(0x128)]();_0x2ac10b['success']&&_0x2ac10b[_0x466886(0x1f32)]?(console[_0x466886(0xc0d)]('✅\x20手动刷新：增量更新成功，新增\x20'+_0x2ac10b[_0x466886(0x21a9)]+_0x466886(0x1d0c)),showToast(_0x466886(0xde7)+_0x2ac10b[_0x466886(0x21a9)]+_0x466886(0x276),_0x466886(0xb27))):(console[_0x466886(0xc0d)](_0x466886(0x1970)),showToast(_0x466886(0xae8),_0x466886(0x2422)));return;}_0x59c4ba['innerHTML']=_0x466886(0x583);try{await generateSampleFootprints();}catch(_0x46e780){console[_0x466886(0x24ab)]('加载足迹失败:',_0x46e780),_0x59c4ba['innerHTML']=_0x466886(0x1040);}}async function generateTodayFootprints(){const _0xaf8360=_0x2cf6d4,_0x15c54b=document[_0xaf8360(0x566)](_0xaf8360(0xe6b));if(!_0x15c54b||!currentFootprintsCharacter)return;_0x15c54b['innerHTML']=_0xaf8360(0x1b40);try{const _0x31d17d=new Date(),_0x2e8ed4=new Date(_0x31d17d[_0xaf8360(0x885)](),_0x31d17d[_0xaf8360(0x17f3)](),_0x31d17d[_0xaf8360(0x1d02)](),0x0,0x0,0x0),_0x37a576=await buildIncrementalFootprintsPrompt(currentFootprintsCharacter,_0x2e8ed4,_0x31d17d),_0xe6b460=await generateCharacterFootprints(_0x37a576);if(_0xe6b460&&_0xe6b460[_0xaf8360(0x9a5)]&&_0xe6b460[_0xaf8360(0x9a5)][_0xaf8360(0xcbf)]>0x0)await renderFootprintsTimeline(_0xe6b460),await setFootprintsCache(currentFootprintsCharacter['id'],_0xe6b460),console[_0xaf8360(0xc0d)](_0xaf8360(0x1a11));else throw new Error('AI未生成有效足迹');}catch(_0x5ac124){console['error'](_0xaf8360(0x123),_0x5ac124),_0x15c54b[_0xaf8360(0xc02)]=_0xaf8360(0x2216);}}async function generateSampleFootprints(){const _0x5a468f=_0x2cf6d4,_0x3602dc=document['getElementById'](_0x5a468f(0xe6b));if(!_0x3602dc||!currentFootprintsCharacter)return;try{_0x3602dc[_0x5a468f(0xc02)]=_0x5a468f(0x1b44);const _0xc056e7=await buildFootprintsPrompt(),_0x5cc5cf=await generateCharacterFootprints(_0xc056e7);_0x5cc5cf&&_0x5cc5cf['length']>0x0?await renderFootprintsTimeline(_0x5cc5cf):_0x3602dc[_0x5a468f(0xc02)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footprints-empty-state\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-exclamation-triangle\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>足迹生成失败</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>请稍后重试或检查网络连接</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';}catch(_0x13e06d){console[_0x5a468f(0x24ab)](_0x5a468f(0x1375),_0x13e06d),_0x3602dc[_0x5a468f(0xc02)]=_0x5a468f(0xdd9);}}async function buildFootprintsPrompt(){const _0x5b08a9=_0x2cf6d4,_0x5cccff=currentFootprintsCharacter,_0x26873f=new Date(),_0x29d4d0=_0x26873f[_0x5b08a9(0xd4a)]('zh-CN',{'hour12':![],'hour':_0x5b08a9(0x19f3),'minute':_0x5b08a9(0x19f3)}),_0x37472e=_0x26873f[_0x5b08a9(0x177f)](_0x5b08a9(0x1c0b));let _0x4997c4='角色名称:\x20'+_0x5cccff[_0x5b08a9(0x222f)]+'\x0a';_0x5cccff[_0x5b08a9(0x1a84)]&&(_0x4997c4+=_0x5b08a9(0x93f)+_0x5cccff[_0x5b08a9(0x1a84)]+'\x0a');_0x5cccff[_0x5b08a9(0x1f79)]&&(_0x4997c4+=_0x5b08a9(0xfa9)+_0x5cccff[_0x5b08a9(0x1f79)]+'\x0a');let _0x20193d='',_0x1e385d='';try{const _0x3833fc=chatMessages[_0x5cccff['id']]||[],_0x443447=new Date(),_0x5166b7=new Date(_0x443447[_0x5b08a9(0x885)](),_0x443447[_0x5b08a9(0x17f3)](),_0x443447[_0x5b08a9(0x1d02)]())[_0x5b08a9(0xa57)](),_0x2a2d91=_0x5166b7+0x18*0x3c*0x3c*0x3e8,_0x4fa8ec=_0x3833fc[_0x5b08a9(0x803)](_0x1728e2=>{const _0x258874=_0x5b08a9;if(_0x1728e2[_0x258874(0x7aa)])return _0x1728e2[_0x258874(0x7aa)]>=_0x5166b7&&_0x1728e2['timestamp']<_0x2a2d91;return![];});if(_0x4fa8ec['length']>0x0)_0x20193d=_0x5b08a9(0x1b88),_0x1e385d=_0x5b08a9(0xb72),_0x4fa8ec['forEach'](_0x44f6fc=>{const _0x3e528b=_0x5b08a9,_0xef9c7d=_0x44f6fc['sender']==='sent'?'用户':_0x5cccff[_0x3e528b(0x222f)],_0x558ec9=new Date(_0x44f6fc[_0x3e528b(0x7aa)])[_0x3e528b(0xd4a)]('zh-CN',{'hour12':![],'hour':_0x3e528b(0x19f3),'minute':_0x3e528b(0x19f3)}),_0x2caf5c=safeExtractMessageContent(_0x44f6fc);_0x20193d+='['+_0x558ec9+']\x20'+_0xef9c7d+':\x20'+_0x2caf5c+'\x0a',_0x1e385d+='-\x20'+_0x558ec9+':\x20与用户进行对话\x0a';});else{const _0x5da724=_0x3833fc['slice'](-0x3);_0x5da724['length']>0x0&&(_0x20193d=_0x5b08a9(0x121a),_0x5da724[_0x5b08a9(0x900)](_0x5bb380=>{const _0x10458d=_0x5b08a9,_0x430e93=_0x5bb380[_0x10458d(0xf75)]==='sent'?'用户':_0x5cccff['name'],_0x4fd99f=safeExtractMessageContent(_0x5bb380);_0x20193d+=_0x430e93+':\x20'+_0x4fd99f+'\x0a';}));}}catch(_0x43a938){console[_0x5b08a9(0xc0d)](_0x5b08a9(0x2169),_0x43a938);}let _0x3d71af='';try{const _0x20f039=getCurrentChatSettings(),_0x457d79=_0x20f039[_0x5b08a9(0x9af)]&&_0x20f039[_0x5b08a9(0xefa)]?_0x20f039['selectedWorldbooks']:[],_0x368a5f=window[_0x5b08a9(0xfb9)]||[],_0xabcef0=[...new Set([..._0x368a5f,..._0x457d79])];_0xabcef0[_0x5b08a9(0xcbf)]>0x0&&(_0x3d71af=_0x5b08a9(0xa48),_0xabcef0[_0x5b08a9(0x900)]((_0x4c2441,_0x1fdf3f)=>{const _0x285230=_0x5b08a9,_0x52cbd5=worldbooks[_0x285230(0x1aeb)](_0x5df101=>_0x5df101['id']===_0x4c2441);_0x52cbd5&&(_0x3d71af+=_0x1fdf3f+0x1+'.\x20'+(_0x52cbd5['name']||_0x52cbd5[_0x285230(0x1c18)])+':\x20'+_0x52cbd5[_0x285230(0x1423)]+'\x0a');}));}catch(_0x249cc4){console[_0x5b08a9(0xc0d)]('获取世界书信息失败:',_0x249cc4);}let _0x18dd30='';try{const _0x38d461=getGlobalMemorySettings();if(_0x38d461['enabled']!==![]){const _0x2bb1b5={'type':_0x5cccff['isGroup']?_0x5b08a9(0x1f01):_0x5b08a9(0x10d7),'id':_0x5cccff['id']};_0x18dd30=await buildGlobalMemoryContext(_0x5cccff['id'],_0x2bb1b5,_0x38d461['memoryDays']||0x7),_0x18dd30&&_0x18dd30['trim']()&&(_0x18dd30='\x0a全局记忆:\x0a'+_0x18dd30+'\x0a');}}catch(_0x5d4279){console[_0x5b08a9(0xc0d)](_0x5b08a9(0x20b1),_0x5d4279);}const _0x42d3e8=_0x5b08a9(0x143f)+_0x4997c4+_0x3d71af+_0x20193d+_0x1e385d+_0x18dd30+_0x5b08a9(0x2300)+_0x37472e+'\x20'+_0x29d4d0+_0x5b08a9(0x5b7)+_0x29d4d0+_0x5b08a9(0x19c2)+_0x29d4d0+'。';return _0x42d3e8;}async function generateCharacterFootprints(_0x13b347,_0x6108c9=null){const _0x572604=_0x2cf6d4;try{const _0x2957ad=_0x6108c9||currentFootprintsCharacter;if(!_0x2957ad)return console[_0x572604(0x24ab)](_0x572604(0x196b)),null;await debugDatabaseTypes();if(!currentFootprintsCharacter||typeof currentFootprintsCharacter['id']!==_0x572604(0xb97))return console[_0x572604(0x24ab)](_0x572604(0x774),currentFootprintsCharacter),null;const _0x5c6eb2=await callChatAPI(_0x13b347,_0x2957ad);if(!_0x5c6eb2||typeof _0x5c6eb2!==_0x572604(0xb97))return console[_0x572604(0x24ab)](_0x572604(0x6f7),_0x5c6eb2),null;if(_0x5c6eb2[_0x572604(0x23ec)]('空响应次数达到上限')||_0x5c6eb2[_0x572604(0x23ec)]('请修改输入提示词'))return console['error'](_0x572604(0x372),_0x5c6eb2),null;let _0xa8574f;try{let _0x49e9ed=_0x5c6eb2['replace'](/```json\n?/g,'')['replace'](/```\n?/g,'')[_0x572604(0x1424)]();if(!_0x49e9ed)return console[_0x572604(0x24ab)]('❌\x20清理后的响应为空'),null;const _0x1be920=getCurrentPersonaName();_0x49e9ed=_0x49e9ed[_0x572604(0x882)](/\{\{user\}\}/g,_0x1be920),_0xa8574f=JSON[_0x572604(0x168e)](_0x49e9ed);}catch(_0x1d274c){return console[_0x572604(0x24ab)](_0x572604(0xc57),_0x1d274c),console[_0x572604(0xc0d)](_0x572604(0xd86),_0x5c6eb2),null;}if(Array[_0x572604(0x1bcc)](_0xa8574f)){const _0x1fc6b7=_0xa8574f[_0x572604(0x803)](_0x1f0ba1=>_0x1f0ba1[_0x572604(0x8e1)]&&_0x1f0ba1[_0x572604(0x2016)]&&_0x1f0ba1['location']&&_0x1f0ba1[_0x572604(0x23df)]),_0x180ba4=getCurrentPersonaName();return _0x1fc6b7['forEach'](_0x32c69d=>{const _0x3e7438=_0x572604;if(_0x32c69d['activity'])_0x32c69d[_0x3e7438(0x2016)]=_0x32c69d[_0x3e7438(0x2016)]['replace'](/\{\{user\}\}/g,_0x180ba4);if(_0x32c69d['location'])_0x32c69d['location']=_0x32c69d[_0x3e7438(0x63b)]['replace'](/\{\{user\}\}/g,_0x180ba4);}),_0x1fc6b7;}else{if(_0xa8574f&&typeof _0xa8574f===_0x572604(0x3c4)){if(_0xa8574f['activities']&&Array['isArray'](_0xa8574f[_0x572604(0x9a5)])){const _0x18e18c=getCurrentPersonaName();return _0xa8574f[_0x572604(0x9a5)][_0x572604(0x900)](_0x27ac1b=>{const _0x5c6f0f=_0x572604;if(_0x27ac1b[_0x5c6f0f(0x2016)])_0x27ac1b[_0x5c6f0f(0x2016)]=_0x27ac1b[_0x5c6f0f(0x2016)]['replace'](/\{\{user\}\}/g,_0x18e18c);if(_0x27ac1b[_0x5c6f0f(0x63b)])_0x27ac1b[_0x5c6f0f(0x63b)]=_0x27ac1b[_0x5c6f0f(0x63b)][_0x5c6f0f(0x882)](/\{\{user\}\}/g,_0x18e18c);}),_0xa8574f['locations']&&_0xa8574f[_0x572604(0x107a)][_0x572604(0x900)](_0x2389a2=>{const _0x1e9fd8=_0x572604;if(_0x2389a2['name'])_0x2389a2[_0x1e9fd8(0x222f)]=_0x2389a2['name'][_0x1e9fd8(0x882)](/\{\{user\}\}/g,_0x18e18c);}),console['log'](_0x572604(0x1c80),_0xa8574f),_0xa8574f;}else return console[_0x572604(0x24ab)](_0x572604(0x343),_0xa8574f),null;}else return console['error']('足迹数据格式不正确:',_0xa8574f),null;}}catch(_0x26baff){return console[_0x572604(0x24ab)](_0x572604(0x43f),_0x26baff),null;}}async function renderFootprintsTimeline(_0x193c0e,_0x353328=![]){const _0x1c4ca1=_0x2cf6d4,_0x2b4fab=document[_0x1c4ca1(0x566)](_0x1c4ca1(0xe6b));if(!_0x2b4fab||!currentFootprintsCharacter)return;let _0x501709=[];if(Array[_0x1c4ca1(0x1bcc)](_0x193c0e))_0x501709=_0x193c0e;else{if(_0x193c0e&&_0x193c0e['activities'])_0x501709=_0x193c0e[_0x1c4ca1(0x9a5)];else{console[_0x1c4ca1(0x24ab)](_0x1c4ca1(0x195),_0x193c0e);return;}}console[_0x1c4ca1(0xc0d)](_0x1c4ca1(0x637)+_0x501709[_0x1c4ca1(0xcbf)]+_0x1c4ca1(0x1d0c),_0x501709);const _0x2046b9=_0x501709[_0x1c4ca1(0x1f0d)]((_0x51cf0c,_0x50410b)=>_0x50410b[_0x1c4ca1(0x8e1)][_0x1c4ca1(0x1934)](_0x51cf0c['time'])),_0x572154=_0x2046b9[_0x1c4ca1(0xf6d)]((_0x47479b,_0x2991f2)=>_0x1c4ca1(0x208)+_0x47479b['type']+_0x1c4ca1(0xbe3)+_0x2991f2*0.1+'s\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footprint-time\x22>'+_0x47479b['time']+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footprint-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22footprint-activity\x22>'+_0x47479b[_0x1c4ca1(0x2016)]+_0x1c4ca1(0x1cff)+_0x47479b[_0x1c4ca1(0x63b)]+_0x1c4ca1(0x240d))[_0x1c4ca1(0x140c)]('');_0x2b4fab[_0x1c4ca1(0xc02)]=_0x572154,currentFootprintsCharacter&&(_0x2b4fab[_0x1c4ca1(0x1f26)]['characterId']=currentFootprintsCharacter['id']),!_0x353328&&currentFootprintsCharacter&&await setFootprintsCache(currentFootprintsCharacter['id'],_0x193c0e);}function appendNewFootprintsToTimeline(_0x3e340c){const _0x18aacb=_0x2cf6d4,_0x46eccf=document[_0x18aacb(0x566)](_0x18aacb(0xe6b));if(!_0x46eccf||!currentFootprintsCharacter)return;let _0x420a8b=[];if(Array[_0x18aacb(0x1bcc)](_0x3e340c))_0x420a8b=_0x3e340c;else{if(_0x3e340c&&_0x3e340c['activities'])_0x420a8b=_0x3e340c[_0x18aacb(0x9a5)];else{console[_0x18aacb(0x24ab)](_0x18aacb(0x1723),_0x3e340c);return;}}if(_0x420a8b[_0x18aacb(0xcbf)]===0x0){console[_0x18aacb(0xc0d)](_0x18aacb(0x560));return;}console['log'](_0x18aacb(0x1f9c)+_0x420a8b[_0x18aacb(0xcbf)]+_0x18aacb(0x1c7d));const _0x103432=_0x420a8b[_0x18aacb(0x1f0d)]((_0x857ce8,_0x1bc7b5)=>_0x1bc7b5[_0x18aacb(0x8e1)][_0x18aacb(0x1934)](_0x857ce8[_0x18aacb(0x8e1)]));_0x103432['reverse']()[_0x18aacb(0x900)]((_0x2d3353,_0x3f0bed)=>{const _0x204f49=_0x18aacb,_0x126b5e=_0x204f49(0x13a7)+(_0x2d3353['type']||_0x204f49(0x990))+_0x204f49(0x123a)+_0x3f0bed*0.2+_0x204f49(0x235e)+_0x2d3353[_0x204f49(0x8e1)]+_0x204f49(0x2ae)+_0x2d3353[_0x204f49(0x2016)]+_0x204f49(0x1bd5)+_0x2d3353['location']+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';_0x46eccf[_0x204f49(0x22ba)](_0x204f49(0x2386),_0x126b5e);}),setTimeout(()=>{const _0x6b9336=_0x18aacb,_0x22dbaf=_0x46eccf[_0x6b9336(0x1ed9)](_0x6b9336(0x1a12));_0x22dbaf[_0x6b9336(0x900)]((_0x393915,_0x1d7191)=>{setTimeout(()=>{const _0x4dc1ca=_0x3a81;_0x393915[_0x4dc1ca(0x655)][_0x4dc1ca(0x671)]='1',_0x393915['style']['transform']=_0x4dc1ca(0x2429),_0x393915['style'][_0x4dc1ca(0x2175)]='all\x200.3s\x20ease',_0x393915[_0x4dc1ca(0x226e)][_0x4dc1ca(0xe1)](_0x4dc1ca(0x23d)),setTimeout(()=>{const _0x21f90f=_0x4dc1ca;_0x393915[_0x21f90f(0x226e)][_0x21f90f(0x128)](_0x21f90f(0x22cd),_0x21f90f(0x23d));},0xbb8);},_0x1d7191*0xc8);});},0x64);}async function refreshCharacterFootprints(){const _0x19ba8f=_0x2cf6d4,_0x2318a8=document[_0x19ba8f(0x15b8)](_0x19ba8f(0x1192));_0x2318a8&&(_0x2318a8[_0x19ba8f(0x226e)][_0x19ba8f(0xe1)](_0x19ba8f(0xba4)),_0x2318a8[_0x19ba8f(0x194e)]=!![]);try{await loadCharacterFootprints(!![]),showToast('足迹已更新',_0x19ba8f(0xb27));}catch(_0x711856){console['error']('刷新足迹失败:',_0x711856),showToast('刷新失败，请稍后重试',_0x19ba8f(0x24ab));}finally{setTimeout(()=>{const _0x381d86=_0x19ba8f;_0x2318a8&&(_0x2318a8['classList'][_0x381d86(0x128)](_0x381d86(0xba4)),_0x2318a8['disabled']=![]);},0x3e8);}}function updateFootprintsFrequency(){setupFootprintsAutoUpdate();}function restoreFootprintsAutoUpdateSetting(){const _0x4e904f=_0x2cf6d4,_0x437298=localStorage[_0x4e904f(0x2250)](_0x4e904f(0x1c99));if(_0x437298){const _0x379284=document[_0x4e904f(0x566)](_0x4e904f(0x21b2));_0x379284&&(_0x379284[_0x4e904f(0xc34)]=_0x437298,console[_0x4e904f(0xc0d)](_0x4e904f(0x2345)+_0x437298));}}function initializeFootprintsAutoUpdate(){const _0x497ae4=_0x2cf6d4;restoreFootprintsAutoUpdateSetting();const _0x4e4d60=localStorage[_0x497ae4(0x2250)](_0x497ae4(0x1c99));_0x4e4d60&&_0x4e4d60!==_0x497ae4(0x11b2)&&(console['log']('🔄\x20启动时恢复足迹后台自动更新...'),setupFootprintsAutoUpdate());}function setupFootprintsAutoUpdate(){const _0x5ecb7c=_0x2cf6d4;footprintsUpdateTimer&&(clearInterval(footprintsUpdateTimer),footprintsUpdateTimer=null);const _0x340161=document[_0x5ecb7c(0x566)](_0x5ecb7c(0x21b2));if(!_0x340161)return;const _0x521949=_0x340161[_0x5ecb7c(0xc34)];if(_0x521949===_0x5ecb7c(0x11b2)){console[_0x5ecb7c(0xc0d)](_0x5ecb7c(0x1763)),localStorage['setItem'](_0x5ecb7c(0x1c99),_0x5ecb7c(0x11b2));return;}const _0x3a6cba=parseInt(_0x521949),_0x2d375a=_0x3a6cba*0x3c*0x3e8;console[_0x5ecb7c(0xc0d)](_0x5ecb7c(0xd74)+_0x3a6cba+'分钟（后台运行）'),localStorage[_0x5ecb7c(0x2055)](_0x5ecb7c(0x1c99),_0x521949),footprintsUpdateTimer=setInterval(async()=>{const _0xf7439e=_0x5ecb7c;console[_0xf7439e(0xc0d)](_0xf7439e(0x1b91));try{await updateAllCharacterFootprints();const _0x51ccf9=document[_0xf7439e(0x566)]('character-footprints-modal');currentFootprintsCharacter&&_0x51ccf9&&_0x51ccf9[_0xf7439e(0x655)][_0xf7439e(0x2526)]!=='none'&&(await loadCharacterFootprints(![]),console['log'](_0xf7439e(0x1c7c)));}catch(_0x1db3cb){console[_0xf7439e(0x24ab)](_0xf7439e(0x321),_0x1db3cb);}},_0x2d375a);}async function updateAllCharacterFootprints(){const _0x45e06d=_0x2cf6d4;try{console['log'](_0x45e06d(0x10b5));for(const _0x4eac39 of characters){try{await updateCharacterFootprintsIncremental(_0x4eac39);}catch(_0x6996c6){console[_0x45e06d(0x24ab)](_0x45e06d(0x1f3b)+_0x4eac39[_0x45e06d(0x222f)]+_0x45e06d(0xd3c),_0x6996c6);}}console[_0x45e06d(0xc0d)](_0x45e06d(0x1cb3));}catch(_0x4a5c9c){console[_0x45e06d(0x24ab)]('后台更新足迹失败:',_0x4a5c9c);}}async function updateCharacterFootprintsIncremental(_0x2e8737){const _0x4d61b7=_0x2cf6d4,_0x6ebb3e=_0x2e8737['id'],_0x5eda38=await getFootprintsCache(_0x6ebb3e);if(!_0x5eda38){console['log'](_0x4d61b7(0x13a3)+_0x2e8737[_0x4d61b7(0x222f)]+_0x4d61b7(0x13a));const _0x2497a9=await buildFootprintsPrompt(),_0xed037a=await generateCharacterFootprints(_0x2497a9,_0x2e8737);if(_0xed037a)return await setFootprintsCache(_0x6ebb3e,_0xed037a,Date[_0x4d61b7(0x18e0)]()),console[_0x4d61b7(0xc0d)](_0x4d61b7(0x1f7e)+_0x2e8737[_0x4d61b7(0x222f)]+'\x20完整足迹生成成功'),{'hasNewContent':!![],'newCount':_0xed037a['activities']?.[_0x4d61b7(0xcbf)]||0x0};return{'hasNewContent':![],'newCount':0x0};}const _0x52df49=new Date(),_0x15c043=new Date(_0x5eda38[_0x4d61b7(0x1d4f)]);console[_0x4d61b7(0xc0d)](_0x4d61b7(0x138c)+_0x2e8737[_0x4d61b7(0x222f)]+_0x4d61b7(0x211a));try{const _0x3670b2=(_0x52df49-_0x15c043)/(0x3e8*0x3c);if(_0x3670b2<0xa)return console[_0x4d61b7(0xc0d)]('角色\x20'+_0x2e8737[_0x4d61b7(0x222f)]+_0x4d61b7(0x23f1)+Math[_0x4d61b7(0x5f3)](_0x3670b2)+'分钟，时间太短，跳过更新'),{'hasNewContent':![],'newCount':0x0};console[_0x4d61b7(0xc0d)]('🔄\x20为角色\x20'+_0x2e8737[_0x4d61b7(0x222f)]+_0x4d61b7(0x2142)+Math[_0x4d61b7(0x5f3)](_0x3670b2)+_0x4d61b7(0xa4c));const _0x3fa625=await buildIncrementalFootprintsPrompt(_0x2e8737,_0x15c043,_0x52df49),_0x5f5a5b=await generateCharacterFootprints(_0x3fa625,_0x2e8737);if(_0x5f5a5b&&_0x5f5a5b[_0x4d61b7(0x9a5)]&&_0x5f5a5b[_0x4d61b7(0x9a5)][_0x4d61b7(0xcbf)]>0x0){const _0x423ec6=await appendToFootprintsCache(_0x6ebb3e,_0x5f5a5b);return _0x423ec6?(console[_0x4d61b7(0xc0d)](_0x4d61b7(0x1f7e)+_0x2e8737[_0x4d61b7(0x222f)]+_0x4d61b7(0x13a1)+_0x5f5a5b[_0x4d61b7(0x9a5)][_0x4d61b7(0xcbf)]+_0x4d61b7(0x1d0c)),currentFootprintsCharacter&&currentFootprintsCharacter['id']===_0x6ebb3e&&(console[_0x4d61b7(0xc0d)](_0x4d61b7(0x6aa)+_0x2e8737['name']+_0x4d61b7(0x318)),appendNewFootprintsToTimeline(_0x5f5a5b)),{'hasNewContent':!![],'newCount':_0x5f5a5b[_0x4d61b7(0x9a5)]['length']}):(console['error'](_0x4d61b7(0x1d42)+_0x2e8737[_0x4d61b7(0x222f)]+_0x4d61b7(0x1346)),currentFootprintsCharacter&&currentFootprintsCharacter['id']===_0x6ebb3e&&(console[_0x4d61b7(0xc0d)](_0x4d61b7(0x6aa)+_0x2e8737[_0x4d61b7(0x222f)]+'\x20的足迹，实时追加新足迹（缓存失败但DOM更新）'),appendNewFootprintsToTimeline(_0x5f5a5b)),{'hasNewContent':!![],'newCount':_0x5f5a5b[_0x4d61b7(0x9a5)][_0x4d61b7(0xcbf)]});}else{console[_0x4d61b7(0xc0d)](_0x4d61b7(0x1b46)+_0x2e8737[_0x4d61b7(0x222f)]+_0x4d61b7(0xdf8));try{const _0x3efbfd=getLocalDateString(),_0x2428af=_0x6ebb3e+'_'+_0x3efbfd,_0x151b75=await db['characterFootprints']['get'](_0x2428af);_0x151b75&&(_0x151b75[_0x4d61b7(0x1d4f)]=Date[_0x4d61b7(0x18e0)](),await db[_0x4d61b7(0x9ae)][_0x4d61b7(0x53a)](_0x151b75),console[_0x4d61b7(0xc0d)]('🔄\x20已更新角色\x20'+_0x2e8737[_0x4d61b7(0x222f)]+_0x4d61b7(0xc6)));}catch(_0x178944){console['error'](_0x4d61b7(0x1f3b)+_0x2e8737[_0x4d61b7(0x222f)]+_0x4d61b7(0xb5c),_0x178944);}return{'hasNewContent':![],'newCount':0x0};}}catch(_0x37b296){return console[_0x4d61b7(0x24ab)](_0x4d61b7(0x13a3)+_0x2e8737[_0x4d61b7(0x222f)]+_0x4d61b7(0xad2),_0x37b296),{'hasNewContent':![],'newCount':0x0};}}async function tryIncrementalUpdate(_0x92bd66){const _0x19167c=_0x2cf6d4;try{console['log'](_0x19167c(0xc6c)+_0x92bd66['name']+'\x20的足迹');const _0x3a4ddd=await updateCharacterFootprintsIncremental(_0x92bd66);return console[_0x19167c(0xc0d)](_0x19167c(0x1f7e)+_0x92bd66['name']+'\x20增量更新完成，结果:',_0x3a4ddd),{'success':!![],'hasNewContent':_0x3a4ddd['hasNewContent'],'newCount':_0x3a4ddd[_0x19167c(0x21a9)]};}catch(_0x25647f){return console[_0x19167c(0x24ab)](_0x19167c(0x22b0),_0x25647f),{'success':![],'hasNewContent':![],'newCount':0x0};}}async function buildIncrementalFootprintsPrompt(_0x3b58e7,_0xc4468e,_0xb8d5f){const _0x3b5e55=_0x2cf6d4,_0x288543=_0xc4468e[_0x3b5e55(0xd4a)](_0x3b5e55(0x1c0b),{'hour12':![],'hour':_0x3b5e55(0x19f3),'minute':_0x3b5e55(0x19f3)}),_0x39ed17=_0xb8d5f[_0x3b5e55(0xd4a)](_0x3b5e55(0x1c0b),{'hour12':![],'hour':_0x3b5e55(0x19f3),'minute':_0x3b5e55(0x19f3)}),_0x2f17f2=await getFootprintsCache(_0x3b58e7['id']),_0x16a0dc=_0x2f17f2?.['data']?.[_0x3b5e55(0x9a5)]||[],_0x356048=await getRecentChatContext(_0x3b58e7['id'],_0xc4468e,_0xb8d5f),_0x539c8a=_0x16a0dc[_0x3b5e55(0xcbf)]>0x0?_0x16a0dc[_0x16a0dc['length']-0x1]:null,_0x451bb9=_0x539c8a?_0x3b5e55(0x13e2)+_0x539c8a[_0x3b5e55(0x8e1)]+_0x3b5e55(0x2316)+_0x539c8a[_0x3b5e55(0x2016)]+_0x3b5e55(0x1483)+_0x539c8a[_0x3b5e55(0x63b)]+_0x3b5e55(0x27c)+(_0x539c8a[_0x3b5e55(0x2179)]||'正常')+')':'今天还没有记录的活动',_0x59805b=analyzeTimeSegment(_0xc4468e,_0xb8d5f),_0x175778=!_0x356048[_0x3b5e55(0x23ec)](_0x3b5e55(0x682)),_0x426661=_0x3b5e55(0x1006)+_0x288543+_0x3b5e55(0xb62)+_0x39ed17+_0x3b5e55(0x1ae1)+_0x3b58e7['name']+_0x3b5e55(0x2a0)+(_0x3b58e7[_0x3b5e55(0x205)]||'暂无')+_0x3b5e55(0xa26)+_0x451bb9+'\x0a\x0a时间段分析:\x0a'+_0x59805b+_0x3b5e55(0x1ab9)+_0x356048+_0x3b5e55(0x784)+(_0x16a0dc['map'](_0x521f53=>_0x521f53[_0x3b5e55(0x8e1)]+_0x3b5e55(0x2316)+_0x521f53[_0x3b5e55(0x2016)]+'\x20('+_0x521f53['location']+_0x3b5e55(0xe7c)+(_0x521f53[_0x3b5e55(0x2179)]||'正常')+']')[_0x3b5e55(0x140c)]('\x0a')||_0x3b5e55(0x1643))+_0x3b5e55(0xb45)+(_0x175778?_0x3b5e55(0x15a2):'即使没有用户互动，也要')+_0x3b5e55(0xf57)+_0x59805b+_0x3b5e55(0x18ea)+_0x3b58e7[_0x3b5e55(0x222f)]+_0x3b5e55(0x1ca2)+(_0x175778?_0x3b5e55(0x209c):'没有聊天时，角色可以做自己的事情（工作、学习、休息、娱乐、社交、私密活动等）')+_0x3b5e55(0xc5);return _0x426661;}function analyzeTimeSegment(_0x4abf5f,_0x2245b1){const _0x128abc=_0x2cf6d4,_0x3c859f=_0x4abf5f[_0x128abc(0x1471)](),_0x46d594=_0x2245b1[_0x128abc(0x1471)](),_0x34293e=(_0x2245b1-_0x4abf5f)/(0x3e8*0x3c);let _0x26adae=[];_0x3c859f>=0x6&&_0x3c859f<0x9&&_0x26adae['push']('晨间时光（适合洗漱、早餐、晨练、准备一天的工作）');_0x3c859f>=0x9&&_0x3c859f<0xc&&_0x26adae['push'](_0x128abc(0x10e6));_0x3c859f>=0xc&&_0x3c859f<0xe&&_0x26adae[_0x128abc(0x6ee)]('午间休息（适合用餐、午休、轻松活动）');_0x3c859f>=0xe&&_0x3c859f<0x12&&_0x26adae['push'](_0x128abc(0x15a7));_0x3c859f>=0x12&&_0x3c859f<0x15&&_0x26adae[_0x128abc(0x6ee)]('傍晚时分（适合晚餐、放松、娱乐、与人交流）');_0x3c859f>=0x15&&_0x3c859f<0x18&&_0x26adae[_0x128abc(0x6ee)](_0x128abc(0x17b7));_0x3c859f>=0x0&&_0x3c859f<0x6&&_0x26adae[_0x128abc(0x6ee)](_0x128abc(0xd15));let _0x1e6548='';if(_0x34293e<=0x1e)_0x1e6548='短时间段，适合单一专注活动';else _0x34293e<=0x78?_0x1e6548=_0x128abc(0x137):_0x1e6548='较长时段，可以安排多个不同类型的活动';return _0x26adae['join']('、')+'；'+_0x1e6548+_0x128abc(0x547)+Math[_0x128abc(0x5f3)](_0x34293e)+_0x128abc(0x1b62);}async function getRecentChatContext(_0x1d4b81,_0x1a4079,_0x17e382){const _0x27f659=_0x2cf6d4;try{const _0x13d51f=chatMessages[_0x1d4b81]||[],_0x8ddff9=_0x13d51f[_0x27f659(0x803)](_0x524f60=>{const _0x4f21df=_0x27f659,_0x4df1de=new Date(_0x524f60[_0x4f21df(0x7aa)]);return _0x4df1de>=_0x1a4079&&_0x4df1de<=_0x17e382;});if(_0x8ddff9['length']===0x0)return _0x27f659(0x9eb);const _0x3f6959=_0x8ddff9[_0x27f659(0xf6d)](_0x77bc68=>{const _0x59ae12=_0x27f659,_0xc0816b=_0x77bc68['sender']===_0x59ae12(0xfda)?'用户':'角色',_0xb4854c=new Date(_0x77bc68[_0x59ae12(0x7aa)])[_0x59ae12(0xd4a)]('zh-CN',{'hour12':![],'hour':'2-digit','minute':'2-digit'}),_0x385b58=safeExtractMessageContent(_0x77bc68);return'['+_0xb4854c+']\x20'+_0xc0816b+':\x20'+_0x385b58;})[_0x27f659(0x140c)]('\x0a');return _0x27f659(0x38f)+_0x3f6959+'\x0a（角色可以基于这些对话内容调整心情和后续活动）';}catch(_0xa9a20c){return console[_0x27f659(0x24ab)](_0x27f659(0x1a9),_0xa9a20c),'获取聊天记录失败，角色按正常生活节奏安排活动';}}function changeCharacterAvatar(){const _0x240c51=_0x2cf6d4,_0x185c82=document['createElement'](_0x240c51(0x627));_0x185c82['type']='file',_0x185c82['accept']=_0x240c51(0x2239),_0x185c82[_0x240c51(0x655)][_0x240c51(0x2526)]='none',document['body']['appendChild'](_0x185c82),_0x185c82[_0x240c51(0x1889)]=function(_0x2f5f24){const _0x219586=_0x240c51;if(_0x2f5f24[_0x219586(0x1144)]['files']&&_0x2f5f24[_0x219586(0x1144)]['files'][0x0]){const _0x5ee359=new FileReader();_0x5ee359['onload']=async function(_0x2b6ae4){const _0x5459ae=_0x219586,_0x3c1004=characters['findIndex'](_0x2e9f6e=>_0x2e9f6e['id']===currentChatCharacter['id']);_0x3c1004!==-0x1&&(characters[_0x3c1004][_0x5459ae(0x10f9)]=_0x2b6ae4[_0x5459ae(0x1144)][_0x5459ae(0x1fff)],await saveCharacters(),renderCharacterList(),renderContactList(),renderMessageList(),renderChatMessages(currentChatCharacter['id'])),document['body']['removeChild'](_0x185c82);},_0x5ee359['readAsDataURL'](_0x2f5f24['target'][_0x219586(0x173e)][0x0]);}else document[_0x219586(0x172c)][_0x219586(0x1624)](_0x185c82);},_0x185c82[_0x240c51(0x1e62)]();}async function changeCharacterNickname(){const _0x2bc0bb=_0x2cf6d4,_0x34ea09=prompt('请输入新的备注名称:',currentChatCharacter[_0x2bc0bb(0x222f)]);if(_0x34ea09&&_0x34ea09[_0x2bc0bb(0x1424)]()!==''){const _0x20d2db=characters['findIndex'](_0x5739c8=>_0x5739c8['id']===currentChatCharacter['id']);if(_0x20d2db!==-0x1){characters[_0x20d2db]['name']=_0x34ea09[_0x2bc0bb(0x1424)](),await saveCharacters();const _0x35ba8b=document[_0x2bc0bb(0x566)]('api-chat-title');_0x35ba8b&&(_0x35ba8b[_0x2bc0bb(0x21dc)]=_0x34ea09['trim'](),_0x35ba8b[_0x2bc0bb(0x226e)][_0x2bc0bb(0x128)]('typing-status'),_0x35ba8b[_0x2bc0bb(0x1f26)][_0x2bc0bb(0x1c53)]=_0x34ea09[_0x2bc0bb(0x1424)]()),renderCharacterList(),renderContactList(),renderMessageList();}}}function searchChatContent(){const _0x32a6cf=_0x2cf6d4;if(!currentChatCharacter){showToast(_0x32a6cf(0x87d),_0x32a6cf(0x13bb));return;}document[_0x32a6cf(0x566)](_0x32a6cf(0x514))[_0x32a6cf(0xc34)]='',document[_0x32a6cf(0x566)]('search-results-summary')[_0x32a6cf(0x655)][_0x32a6cf(0x2526)]=_0x32a6cf(0xfe9),document[_0x32a6cf(0x566)]('search-results-container')['style'][_0x32a6cf(0x2526)]=_0x32a6cf(0xfe9),showModal(_0x32a6cf(0x183b)),setTimeout(()=>{const _0x3146c8=_0x32a6cf;document['getElementById'](_0x3146c8(0x514))[_0x3146c8(0x1b12)]();},0x64);}async function performChatSearch(){const _0x4554f8=_0x2cf6d4,_0x148480=document[_0x4554f8(0x566)]('search-keyword-input')['value'][_0x4554f8(0x1424)]();if(!_0x148480){showToast(_0x4554f8(0x24c7),_0x4554f8(0x13bb));return;}let _0x1e73bf=[];try{const _0x1b608a=await db[_0x4554f8(0x464)][_0x4554f8(0x4a6)](_0x4554f8(0x10df))[_0x4554f8(0x14a)](currentChatCharacter['id'])[_0x4554f8(0x18c6)]();_0x1e73bf=_0x1b608a['sort']((_0x21efc7,_0x20cfea)=>_0x21efc7['timestamp']-_0x20cfea[_0x4554f8(0x7aa)]);}catch(_0x209806){console[_0x4554f8(0x24ab)]('获取聊天记录失败:',_0x209806),_0x1e73bf=chatMessages[currentChatCharacter['id']]||[];}const _0x272ff2=_0x1e73bf[_0x4554f8(0x803)]((_0x39eead,_0xed83fb)=>{const _0x5d3626=_0x4554f8;if(!_0x39eead[_0x5d3626(0x1110)])return![];const _0x1757b0=_0x39eead[_0x5d3626(0x1110)];let _0x3a21e1='';if(typeof _0x1757b0[_0x5d3626(0x1423)]==='string')_0x3a21e1=_0x1757b0['content'];else{if(Array['isArray'](_0x1757b0[_0x5d3626(0x1423)]))_0x3a21e1=_0x1757b0[_0x5d3626(0x1423)][_0x5d3626(0x803)](_0x1b1608=>_0x1b1608&&_0x1b1608[_0x5d3626(0x23df)]===_0x5d3626(0x1e58))['map'](_0x1ea7fd=>_0x1ea7fd[_0x5d3626(0x1e58)]||'')[_0x5d3626(0x140c)]('\x20');else _0x1757b0[_0x5d3626(0x1423)]&&typeof _0x1757b0[_0x5d3626(0x1423)]===_0x5d3626(0x3c4)?_0x3a21e1=_0x1757b0[_0x5d3626(0x1423)][_0x5d3626(0x1e58)]||_0x1757b0[_0x5d3626(0x1423)][_0x5d3626(0x1423)]||'':_0x3a21e1=_0x1757b0[_0x5d3626(0x1423)]?String(_0x1757b0[_0x5d3626(0x1423)]):'';}return typeof _0x3a21e1!==_0x5d3626(0xb97)&&(_0x3a21e1=''),_0x3a21e1[_0x5d3626(0x1d64)]()['includes'](_0x148480['toLowerCase']());}),_0x5b6969=document[_0x4554f8(0x566)](_0x4554f8(0x214)),_0x2d9396=document['getElementById'](_0x4554f8(0x7d6));_0x2d9396[_0x4554f8(0xc02)]=_0x4554f8(0x29a)+_0x272ff2[_0x4554f8(0xcbf)]+_0x4554f8(0x7b4)+_0x148480+_0x4554f8(0x22d5),_0x5b6969[_0x4554f8(0x655)][_0x4554f8(0x2526)]=_0x4554f8(0x2d4);const _0x5d6ffe=document[_0x4554f8(0x566)](_0x4554f8(0x2377)),_0x3e2a0d=document['getElementById'](_0x4554f8(0x1904));_0x272ff2['length']===0x0?_0x3e2a0d[_0x4554f8(0xc02)]='<div\x20style=\x22padding:\x2020px;\x20text-align:\x20center;\x20color:\x20#666;\x22>没有找到包含该关键词的消息</div>':_0x3e2a0d[_0x4554f8(0xc02)]=_0x272ff2[_0x4554f8(0xf6d)]((_0x220849,_0x2c74a5)=>{const _0x3ef2fa=_0x4554f8,_0x1276b5=_0x220849[_0x3ef2fa(0x1110)];if(!_0x1276b5)return'';let _0x46cb7d='';_0x1276b5[_0x3ef2fa(0xc7)]||_0x1276b5['sender']===_0x3ef2fa(0xfda)?_0x46cb7d='我':currentChatCharacter[_0x3ef2fa(0x4b7)]?_0x46cb7d=_0x1276b5['senderName']||_0x1276b5['characterName']||_0x1276b5[_0x3ef2fa(0x222f)]||(_0x1276b5['sender']!=='received'?_0x1276b5[_0x3ef2fa(0xf75)]:_0x3ef2fa(0x19ba)):_0x46cb7d=currentChatCharacter[_0x3ef2fa(0x222f)]||'角色';let _0x50d0e5='';if(typeof _0x1276b5[_0x3ef2fa(0x1423)]===_0x3ef2fa(0xb97))_0x50d0e5=_0x1276b5[_0x3ef2fa(0x1423)];else{if(Array[_0x3ef2fa(0x1bcc)](_0x1276b5[_0x3ef2fa(0x1423)]))_0x50d0e5=_0x1276b5[_0x3ef2fa(0x1423)][_0x3ef2fa(0x803)](_0xeec8ce=>_0xeec8ce&&_0xeec8ce[_0x3ef2fa(0x23df)]===_0x3ef2fa(0x1e58))[_0x3ef2fa(0xf6d)](_0x375e37=>_0x375e37[_0x3ef2fa(0x1e58)]||'')['join']('\x20');else _0x1276b5[_0x3ef2fa(0x1423)]&&typeof _0x1276b5[_0x3ef2fa(0x1423)]===_0x3ef2fa(0x3c4)?_0x50d0e5=_0x1276b5[_0x3ef2fa(0x1423)][_0x3ef2fa(0x1e58)]||_0x1276b5[_0x3ef2fa(0x1423)]['content']||'':_0x50d0e5=_0x1276b5[_0x3ef2fa(0x1423)]?String(_0x1276b5[_0x3ef2fa(0x1423)]):_0x3ef2fa(0x12e8);}(!_0x50d0e5||_0x50d0e5[_0x3ef2fa(0x1424)]()==='')&&(_0x50d0e5='消息内容为空');const _0xb41e9f=_0x50d0e5['replace'](new RegExp(_0x148480,'gi'),'<span\x20class=\x22search-highlight\x22>$&</span>'),_0x2f7cb3=new Date(_0x220849[_0x3ef2fa(0x7aa)])[_0x3ef2fa(0x133a)](_0x3ef2fa(0x1c0b),{'year':'numeric','month':_0x3ef2fa(0x19f3),'day':'2-digit','hour':_0x3ef2fa(0x19f3),'minute':_0x3ef2fa(0x19f3)});return _0x3ef2fa(0xd05)+_0x1e73bf['indexOf'](_0x220849)+_0x3ef2fa(0x1fbc)+_0xb41e9f+_0x3ef2fa(0x12fb)+_0x46cb7d+_0x3ef2fa(0x151)+_0x2f7cb3+_0x3ef2fa(0x14d9);})[_0x4554f8(0x140c)](''),_0x5d6ffe['style'][_0x4554f8(0x2526)]=_0x4554f8(0x2d4);}async function showMessageContext(_0x3e97b4){const _0x24063b=_0x2cf6d4;let _0x2b6308=[];try{const _0x2f558b=await db[_0x24063b(0x464)]['where'](_0x24063b(0x10df))[_0x24063b(0x14a)](currentChatCharacter['id'])['toArray']();_0x2b6308=_0x2f558b['sort']((_0x5dae39,_0x22150c)=>_0x5dae39[_0x24063b(0x7aa)]-_0x22150c[_0x24063b(0x7aa)]);}catch(_0x3590b9){console[_0x24063b(0x24ab)](_0x24063b(0x2169),_0x3590b9),_0x2b6308=chatMessages[currentChatCharacter['id']]||[];}const _0x28c60d=_0x2b6308[_0x3e97b4];if(!_0x28c60d)return;const _0x58ea9c=Math['max'](0x0,_0x3e97b4-0xa),_0x15bef7=Math[_0x24063b(0x21f7)](_0x2b6308[_0x24063b(0xcbf)]-0x1,_0x3e97b4+0xa),_0x1ad71b=_0x2b6308[_0x24063b(0x136)](_0x58ea9c,_0x15bef7+0x1),_0x4cf91c=document[_0x24063b(0x566)](_0x24063b(0x2b8));_0x4cf91c['innerHTML']=_0x1ad71b[_0x24063b(0xf6d)]((_0x25b44b,_0x404a03)=>{const _0x22774a=_0x24063b,_0x284c87=_0x58ea9c+_0x404a03,_0x1ac8dd=_0x284c87===_0x3e97b4,_0x2b5c20=_0x25b44b[_0x22774a(0x1110)];if(!_0x2b5c20)return'';let _0x2559e1='',_0x465b0f='';_0x2b5c20[_0x22774a(0xc7)]||_0x2b5c20[_0x22774a(0xf75)]===_0x22774a(0xfda)?(_0x2559e1='我',_0x465b0f=_0x22774a(0x23b2)):currentChatCharacter['isGroup']?(_0x2559e1=_0x2b5c20['senderName']||_0x2b5c20[_0x22774a(0xeaf)]||_0x2b5c20[_0x22774a(0x222f)]||(_0x2b5c20[_0x22774a(0xf75)]!==_0x22774a(0x232)?_0x2b5c20['sender']:_0x22774a(0x19ba)),_0x465b0f=_0x22774a(0xfbe)):(_0x2559e1=currentChatCharacter['name']||'角色',_0x465b0f='character');const _0x41367c=_0x1ac8dd?'\x20target':'',_0x25252b=new Date(_0x25b44b[_0x22774a(0x7aa)])[_0x22774a(0x133a)](_0x22774a(0x1c0b),{'month':_0x22774a(0x19f3),'day':_0x22774a(0x19f3),'hour':_0x22774a(0x19f3),'minute':_0x22774a(0x19f3)});let _0xa2976a='';if(typeof _0x2b5c20[_0x22774a(0x1423)]===_0x22774a(0xb97))_0xa2976a=_0x2b5c20[_0x22774a(0x1423)];else{if(Array[_0x22774a(0x1bcc)](_0x2b5c20[_0x22774a(0x1423)]))_0xa2976a=_0x2b5c20[_0x22774a(0x1423)]['filter'](_0x5260f5=>_0x5260f5&&_0x5260f5[_0x22774a(0x23df)]==='text')[_0x22774a(0xf6d)](_0x1215cf=>_0x1215cf['text']||'')[_0x22774a(0x140c)]('\x20');else _0x2b5c20[_0x22774a(0x1423)]&&typeof _0x2b5c20[_0x22774a(0x1423)]==='object'?_0xa2976a=_0x2b5c20['content'][_0x22774a(0x1e58)]||_0x2b5c20[_0x22774a(0x1423)][_0x22774a(0x1423)]||'':_0xa2976a=_0x2b5c20[_0x22774a(0x1423)]?String(_0x2b5c20[_0x22774a(0x1423)]):'消息内容为空';}return(!_0xa2976a||_0xa2976a[_0x22774a(0x1424)]()==='')&&(_0xa2976a=_0x22774a(0x12e8)),'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22context-message\x20'+_0x465b0f+_0x41367c+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22context-message-meta\x22>'+_0x2559e1+_0x22774a(0x792)+_0x25252b+_0x22774a(0xeb3)+_0xa2976a+_0x22774a(0x92d);})['join'](''),showModal('message-context-modal');}document[_0x2cf6d4(0x167)]('DOMContentLoaded',function(){const _0x44030a=_0x2cf6d4,_0x2d6541=document[_0x44030a(0x566)]('search-keyword-input');_0x2d6541&&_0x2d6541['addEventListener'](_0x44030a(0x1a17),function(_0x1aeac1){const _0x5cd271=_0x44030a;_0x1aeac1['key']===_0x5cd271(0x165c)&&performChatSearch();});});function showExportOptions(){const _0x271595=_0x2cf6d4;if(!currentChatCharacter){showToast(_0x271595(0x87d),_0x271595(0x13bb));return;}document['getElementById']('export-options-modal')[_0x271595(0x655)]['display']=_0x271595(0x1f0b);}function hideExportOptions(_0x941734){const _0x5b5f75=_0x2cf6d4;if(_0x941734&&_0x941734['target']!==_0x941734[_0x5b5f75(0x52b)])return;document[_0x5b5f75(0x566)](_0x5b5f75(0xa87))['style'][_0x5b5f75(0x2526)]=_0x5b5f75(0xfe9);}function selectExportFormat(_0x1aaf86){const _0x3def21=_0x2cf6d4;document['getElementById'](_0x3def21(0x2470))['checked']=_0x1aaf86===_0x3def21(0x1c0e),document[_0x3def21(0x566)](_0x3def21(0x251e))['checked']=_0x1aaf86===_0x3def21(0x2318),document[_0x3def21(0x1ed9)](_0x3def21(0x2553))[_0x3def21(0x900)](_0x4014f5=>{const _0x25cfd1=_0x3def21;_0x4014f5[_0x25cfd1(0x226e)][_0x25cfd1(0x128)](_0x25cfd1(0x876));}),document['querySelector']('[onclick=\x22selectExportFormat(\x27'+_0x1aaf86+_0x3def21(0xffd))[_0x3def21(0x226e)][_0x3def21(0xe1)]('selected');}async function executeExport(){const _0x25aae8=_0x2cf6d4,_0x5618b5=document[_0x25aae8(0x15b8)]('input[name=\x22exportFormat\x22]:checked')[_0x25aae8(0xc34)];hideExportOptions();if(_0x5618b5===_0x25aae8(0x1c0e))exportChatHistoryAsHTML();else _0x5618b5==='json'&&await exportChatHistoryAsJSON();}function exportChatHistoryAsHTML(){const _0x495551=_0x2cf6d4;if(!currentChatCharacter){showToast(_0x495551(0x87d),'warning');return;}const _0x17db70=chatMessages[currentChatCharacter['id']]||[];if(_0x17db70[_0x495551(0xcbf)]===0x0){showToast(_0x495551(0x141e),'warning');return;}const _0x323030=getCurrentChatSettings(),_0x52879e=_0x323030['aiChatNickname']||currentChatCharacter[_0x495551(0x222f)],_0x4ced0f=_0x323030['myChatNickname']||'我',_0xa9b36d=new Date(),_0x2b0480=_0x17db70[_0x495551(0xcbf)],_0x538cfc=new Date(_0x17db70[0x0][_0x495551(0x7aa)]||Date[_0x495551(0x18e0)]()),_0x5e1352=new Date(_0x17db70[_0x17db70[_0x495551(0xcbf)]-0x1][_0x495551(0x7aa)]||Date['now']());isNaN(_0x538cfc[_0x495551(0xa57)]())&&(_0x538cfc=new Date());isNaN(_0x5e1352['getTime']())&&(_0x5e1352=new Date());let _0x2b062f='<!DOCTYPE\x20html>\x0a<html\x20lang=\x22zh-CN\x22>\x0a<head>\x0a\x20\x20\x20\x20<meta\x20charset=\x22UTF-8\x22>\x0a\x20\x20\x20\x20<meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,\x20initial-scale=1.0\x22>\x0a\x20\x20\x20\x20<title>与\x20'+_0x52879e+_0x495551(0x11f2)+_0x52879e+'\x20的聊天记录</h1>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20导出时间：'+_0xa9b36d[_0x495551(0x133a)](_0x495551(0x1c0b))+'<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20共\x20'+_0x2b0480+_0x495551(0x1eec)+_0x538cfc[_0x495551(0x177f)](_0x495551(0x1c0b))+'\x20-\x20'+_0x5e1352['toLocaleDateString']('zh-CN')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-content\x22>';_0x17db70['forEach']((_0x12e86e,_0x361f9b)=>{const _0x3910f0=_0x495551,_0x66530d=formatTime(_0x12e86e['timestamp']),_0x3e7dcd=_0x12e86e['sender']===_0x3910f0(0xfda),_0x59bbc1=_0x12e86e['sender']===_0x3910f0(0x212);if(_0x59bbc1)_0x2b062f+=_0x3910f0(0xfaf)+escapeHtml(_0x12e86e[_0x3910f0(0x1423)])+_0x3910f0(0x22b7);else{const _0x116815=_0x3e7dcd?'user':'ai',_0x257423=_0x3e7dcd?_0x4ced0f:_0x52879e;let _0x11fdd3='';if(_0x12e86e[_0x3910f0(0x180)]){const _0x25e0d0=_0x12e86e[_0x3910f0(0x180)][_0x3910f0(0xadb)]||(_0x12e86e[_0x3910f0(0x180)]['sender']===_0x3910f0(0xfda)?_0x4ced0f:_0x52879e),_0xd9acdc=truncateText(_0x12e86e[_0x3910f0(0x180)][_0x3910f0(0x1423)]||_0x3910f0(0x2025),0x14);_0x11fdd3+=_0x3910f0(0x1d6f)+escapeHtml(_0x25e0d0)+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>'+escapeHtml(_0xd9acdc)+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>';}let _0x576b49=_0x12e86e[_0x3910f0(0x1423)]||'',_0x513d76='';if(_0x12e86e[_0x3910f0(0x23df)]===_0x3910f0(0x1bfd))_0x576b49=_0x3910f0(0x21d5)+_0x576b49,_0x513d76=_0x3910f0(0xdd1);else{if(_0x12e86e[_0x3910f0(0x23df)]==='transfer')_0x576b49=_0x3910f0(0x13dc)+_0x12e86e[_0x3910f0(0xca8)]+'元'+(_0x12e86e[_0x3910f0(0x15fe)]?'\x20('+_0x12e86e[_0x3910f0(0x15fe)]+')':''),_0x513d76=_0x3910f0(0xdd1);else{if(_0x12e86e[_0x3910f0(0x23df)]===_0x3910f0(0x63b))_0x576b49='<svg\x20width=\x2214\x22\x20height=\x2214\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20style=\x22display:\x20inline-block;\x20margin-right:\x204px;\x20vertical-align:\x20middle;\x22><path\x20d=\x22M12\x202C8.13\x202\x205\x205.13\x205\x209c0\x205.25\x207\x2013\x207\x2013s7-7.75\x207-13c0-3.87-3.13-7-7-7zm0\x209.5c-1.38\x200-2.5-1.12-2.5-2.5s1.12-2.5\x202.5-2.5\x202.5\x201.12\x202.5\x202.5-1.12\x202.5-2.5\x202.5z\x22\x20fill=\x22#1890ff\x22/></svg>位置：'+(_0x12e86e[_0x3910f0(0xf7e)]||_0x3910f0(0x24cc)),_0x513d76=_0x3910f0(0xdd1);else{if(_0x12e86e[_0x3910f0(0x23df)]===_0x3910f0(0x14f2))_0x576b49=_0x3910f0(0xcbc)+(_0x12e86e[_0x3910f0(0xd7a)]||_0x3910f0(0x12e7)),_0x513d76=_0x3910f0(0xdd1);else{if(_0x12e86e[_0x3910f0(0x23df)]===_0x3910f0(0x14a6))_0x576b49=_0x3910f0(0x1933)+_0x576b49,_0x513d76=_0x3910f0(0xdd1);else{if(_0x12e86e[_0x3910f0(0xe29)])_0x576b49='😊\x20表情包：'+(_0x12e86e[_0x3910f0(0x13e3)]||_0x576b49),_0x513d76='\x20special-message';else{if(Array[_0x3910f0(0x1bcc)](_0x576b49)){const _0x5e9e8c=_0x576b49[_0x3910f0(0x1aeb)](_0x1e96b6=>_0x1e96b6[_0x3910f0(0x23df)]==='text')?.[_0x3910f0(0x1e58)]||'',_0x13a106=_0x576b49[_0x3910f0(0x1aeb)](_0x1413c2=>_0x1413c2[_0x3910f0(0x23df)]===_0x3910f0(0x1cfa));if(_0x5e9e8c&&_0x13a106)_0x576b49=_0x3910f0(0x2ff)+_0x5e9e8c;else{if(_0x13a106)_0x576b49=_0x3910f0(0x1c78);else _0x5e9e8c?_0x576b49=_0x5e9e8c:_0x576b49=_0x3910f0(0x1d54);}_0x13a106&&(_0x513d76=_0x3910f0(0xdd1));}}}}}}}_0x11fdd3+=_0x3910f0(0xc53)+_0x513d76[_0x3910f0(0x1424)]()+'\x22>'+escapeHtml(_0x576b49)+_0x3910f0(0xa54),_0x2b062f+=_0x3910f0(0xa13)+_0x116815+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-bubble\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x11fdd3+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22timestamp\x22>'+_0x66530d+'</div>';}(_0x361f9b+0x1)%0x32===0x0&&_0x361f9b!==_0x17db70[_0x3910f0(0xcbf)]-0x1&&(_0x2b062f+=_0x3910f0(0x2c8)+Math['floor']((_0x361f9b+0x1)/0x32)+_0x3910f0(0x3f4));}),_0x2b062f+='\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22stats\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20📊\x20聊天统计<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20总消息数：'+_0x2b0480+_0x495551(0x5a6)+_0x17db70[_0x495551(0x803)](_0x450b98=>_0x450b98['sender']===_0x495551(0xfda))['length']+_0x495551(0xcdb)+_0x52879e+'\x20的消息：'+_0x17db70[_0x495551(0x803)](_0x377051=>_0x377051[_0x495551(0xf75)]==='received')[_0x495551(0xcbf)]+_0x495551(0x345)+_0x17db70[_0x495551(0x803)](_0x1df084=>_0x1df084[_0x495551(0xf75)]===_0x495551(0x212))[_0x495551(0xcbf)]+_0x495551(0x2506)+_0xa9b36d[_0x495551(0x133a)](_0x495551(0x1c0b))+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20</div>\x0a</body>\x0a</html>';const _0x4d4aa3=new Blob([_0x2b062f],{'type':_0x495551(0x1b8d)}),_0x20d3bb=URL[_0x495551(0x17c3)](_0x4d4aa3),_0x272d10=document[_0x495551(0x1ad8)]('a'),_0x102184='与'+_0x52879e+_0x495551(0x7fe)+_0xa9b36d[_0x495551(0x885)]()+'-'+(_0xa9b36d[_0x495551(0x17f3)]()+0x1)[_0x495551(0x9a3)]()[_0x495551(0x863)](0x2,'0')+'-'+_0xa9b36d[_0x495551(0x1d02)]()[_0x495551(0x9a3)]()[_0x495551(0x863)](0x2,'0')+_0x495551(0xde1);_0x272d10['href']=_0x20d3bb,_0x272d10[_0x495551(0x154c)]=_0x102184,_0x272d10[_0x495551(0x655)][_0x495551(0x2526)]='none',document[_0x495551(0x172c)][_0x495551(0x1925)](_0x272d10),_0x272d10[_0x495551(0x1e62)](),document[_0x495551(0x172c)][_0x495551(0x1624)](_0x272d10),setTimeout(()=>{const _0x2034c2=_0x495551;URL[_0x2034c2(0x2101)](_0x20d3bb);},0x3e8),showToast(_0x495551(0xab2)+_0x102184,_0x495551(0xb27));}async function exportChatHistoryAsJSON(){const _0x4b03cc=_0x2cf6d4;if(!currentChatCharacter){showToast(_0x4b03cc(0x87d),'warning');return;}try{showToast(_0x4b03cc(0x20c1),_0x4b03cc(0x2422));const _0x2d746f=currentChatCharacter['id'],_0x434a53=currentChatCharacter[_0x4b03cc(0x222f)],_0x2659af=new Date(),_0xa5fa61={'exportInfo':{'characterId':_0x2d746f,'characterName':_0x434a53,'exportTime':_0x2659af[_0x4b03cc(0xa4b)](),'version':_0x4b03cc(0xf59),'description':_0x434a53+_0x4b03cc(0x1b5a)},'chatMessages':await db['chatMessages']['where'](_0x4b03cc(0x10df))[_0x4b03cc(0x14a)](_0x2d746f)['toArray'](),'smsMessages':await db[_0x4b03cc(0xd94)][_0x4b03cc(0x4a6)](_0x4b03cc(0x10df))[_0x4b03cc(0x14a)](_0x2d746f)['toArray'](),'chatSettings':await db[_0x4b03cc(0xb08)][_0x4b03cc(0x4a6)](_0x4b03cc(0x956))[_0x4b03cc(0x14a)](_0x2d746f)['toArray'](),'coreMemories':await db[_0x4b03cc(0xa1b)]['where'](_0x4b03cc(0x10df))[_0x4b03cc(0x14a)](_0x2d746f)[_0x4b03cc(0x18c6)](),'episodicMemories':await db[_0x4b03cc(0x222e)]['where'](_0x4b03cc(0x10df))[_0x4b03cc(0x14a)](_0x2d746f)[_0x4b03cc(0x18c6)](),'memorySummaries':await db[_0x4b03cc(0x1982)]['where'](_0x4b03cc(0x10df))[_0x4b03cc(0x14a)](_0x2d746f)[_0x4b03cc(0x18c6)](),'crossAppTimeline':await db[_0x4b03cc(0x75b)][_0x4b03cc(0x4a6)]('characterId')[_0x4b03cc(0x14a)](_0x2d746f)['toArray']()},_0x4faa3c={'chatMessages':_0xa5fa61[_0x4b03cc(0x464)][_0x4b03cc(0xcbf)],'smsMessages':_0xa5fa61[_0x4b03cc(0xd94)][_0x4b03cc(0xcbf)],'coreMemories':_0xa5fa61['coreMemories'][_0x4b03cc(0xcbf)],'episodicMemories':_0xa5fa61[_0x4b03cc(0x222e)][_0x4b03cc(0xcbf)],'memorySummaries':_0xa5fa61[_0x4b03cc(0x1982)][_0x4b03cc(0xcbf)],'crossAppTimeline':_0xa5fa61[_0x4b03cc(0x75b)][_0x4b03cc(0xcbf)]};console['log'](_0x4b03cc(0x145f),_0x4faa3c);const _0x5e178a=JSON[_0x4b03cc(0x7fb)](_0xa5fa61,null,0x2),_0x46e642=new Blob([_0x5e178a],{'type':_0x4b03cc(0x179f)}),_0x482be8=URL['createObjectURL'](_0x46e642),_0x252c42=document[_0x4b03cc(0x1ad8)]('a'),_0x21dafc=_0x434a53+'_完整数据备份_'+_0x2659af['getFullYear']()+'-'+(_0x2659af[_0x4b03cc(0x17f3)]()+0x1)['toString']()[_0x4b03cc(0x863)](0x2,'0')+'-'+_0x2659af[_0x4b03cc(0x1d02)]()[_0x4b03cc(0x9a3)]()[_0x4b03cc(0x863)](0x2,'0')+_0x4b03cc(0x539);_0x252c42[_0x4b03cc(0xe1d)]=_0x482be8,_0x252c42['download']=_0x21dafc,_0x252c42['style'][_0x4b03cc(0x2526)]=_0x4b03cc(0xfe9),document[_0x4b03cc(0x172c)][_0x4b03cc(0x1925)](_0x252c42),_0x252c42[_0x4b03cc(0x1e62)](),document[_0x4b03cc(0x172c)][_0x4b03cc(0x1624)](_0x252c42),URL[_0x4b03cc(0x2101)](_0x482be8);const _0x327a64=Object[_0x4b03cc(0x230e)](_0x4faa3c)['filter'](([_0x5acd96,_0x598ebf])=>_0x598ebf>0x0)[_0x4b03cc(0xf6d)](([_0x409086,_0x449abe])=>{const _0x5343fe=_0x4b03cc,_0x4c1d46={'chatMessages':_0x5343fe(0x2069),'smsMessages':_0x5343fe(0x1c62),'coreMemories':_0x5343fe(0x1ddf),'episodicMemories':'情景记忆','memorySummaries':_0x5343fe(0x1d10),'crossAppTimeline':_0x5343fe(0x160)};return _0x4c1d46[_0x409086]+':\x20'+_0x449abe+'条';})['join'](',\x20');showToast(_0x4b03cc(0x1535)+_0x21dafc+'（'+_0x327a64+'）','success');}catch(_0x15c35c){console[_0x4b03cc(0x24ab)](_0x4b03cc(0x180d),_0x15c35c),showToast(_0x4b03cc(0xf9e)+_0x15c35c[_0x4b03cc(0xd7a)],_0x4b03cc(0x24ab));}}function escapeHtml(_0x271faf){const _0x40188c=_0x2cf6d4,_0x285327=document[_0x40188c(0x1ad8)](_0x40188c(0x526));return _0x285327[_0x40188c(0x21dc)]=_0x271faf,_0x285327['innerHTML'];}function truncateText(_0x3a02bc,_0x524010){const _0x456f37=_0x2cf6d4;if(_0x3a02bc[_0x456f37(0xcbf)]<=_0x524010)return _0x3a02bc;return _0x3a02bc['substring'](0x0,_0x524010)+_0x456f37(0x12da);}function showImportOptions(){const _0x3a8650=_0x2cf6d4;if(!currentChatCharacter){showToast(_0x3a8650(0x87d),_0x3a8650(0x13bb));return;}document[_0x3a8650(0x566)]('import-options-modal')[_0x3a8650(0x655)][_0x3a8650(0x2526)]=_0x3a8650(0x1f0b),document['getElementById']('import-file-input')[_0x3a8650(0xc34)]='',document['getElementById']('import-file-info')[_0x3a8650(0x655)][_0x3a8650(0x2526)]=_0x3a8650(0xfe9),document['getElementById'](_0x3a8650(0x19a3))[_0x3a8650(0x194e)]=!![];}function hideImportOptions(_0x4c0376){const _0x11605e=_0x2cf6d4;if(_0x4c0376&&_0x4c0376['target']!==_0x4c0376[_0x11605e(0x52b)])return;document[_0x11605e(0x566)](_0x11605e(0xa7))['style']['display']=_0x11605e(0xfe9);}function handleImportFileSelect(_0x37a544){const _0x4b378c=_0x2cf6d4,_0x445b19=_0x37a544[_0x4b378c(0x1144)][_0x4b378c(0x173e)][0x0];if(!_0x445b19)return;if(!_0x445b19[_0x4b378c(0x222f)][_0x4b378c(0xd7e)](_0x4b378c(0x539))){showToast('请选择JSON格式的文件',_0x4b378c(0x24ab));return;}const _0x8ce8db=new FileReader();_0x8ce8db['onload']=function(_0x2d50d3){const _0xe22a11=_0x4b378c;try{const _0x43daa7=JSON[_0xe22a11(0x168e)](_0x2d50d3['target'][_0xe22a11(0x1fff)]);if(!_0x43daa7[_0xe22a11(0x85c)]||!_0x43daa7[_0xe22a11(0x85c)][_0xe22a11(0xeaf)]){showToast('无效的备份文件格式',_0xe22a11(0x24ab));return;}document['getElementById']('import-file-name')[_0xe22a11(0x21dc)]=_0x445b19[_0xe22a11(0x222f)];const _0x5ce42a=[];if(_0x43daa7[_0xe22a11(0x464)]?.[_0xe22a11(0xcbf)])_0x5ce42a[_0xe22a11(0x6ee)](_0xe22a11(0x1340)+_0x43daa7[_0xe22a11(0x464)][_0xe22a11(0xcbf)]+'条');if(_0x43daa7[_0xe22a11(0xd94)]?.[_0xe22a11(0xcbf)])_0x5ce42a[_0xe22a11(0x6ee)]('短信消息:\x20'+_0x43daa7[_0xe22a11(0xd94)]['length']+'条');if(_0x43daa7[_0xe22a11(0xa1b)]?.[_0xe22a11(0xcbf)])_0x5ce42a[_0xe22a11(0x6ee)](_0xe22a11(0x1b2f)+_0x43daa7[_0xe22a11(0xa1b)]['length']+'条');if(_0x43daa7['episodicMemories']?.[_0xe22a11(0xcbf)])_0x5ce42a[_0xe22a11(0x6ee)](_0xe22a11(0xeac)+_0x43daa7[_0xe22a11(0x222e)]['length']+'条');if(_0x43daa7[_0xe22a11(0x1982)]?.[_0xe22a11(0xcbf)])_0x5ce42a[_0xe22a11(0x6ee)](_0xe22a11(0x237f)+_0x43daa7[_0xe22a11(0x1982)]['length']+'条');if(_0x43daa7['crossAppTimeline']?.[_0xe22a11(0xcbf)])_0x5ce42a[_0xe22a11(0x6ee)](_0xe22a11(0x212c)+_0x43daa7[_0xe22a11(0x75b)]['length']+'条');document[_0xe22a11(0x566)](_0xe22a11(0x220))[_0xe22a11(0xc02)]=_0xe22a11(0x893)+_0x43daa7[_0xe22a11(0x85c)][_0xe22a11(0xeaf)]+_0xe22a11(0x891)+new Date(_0x43daa7[_0xe22a11(0x85c)]['exportTime'])[_0xe22a11(0x133a)]('zh-CN')+'<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>包含数据：</strong>'+_0x5ce42a[_0xe22a11(0x140c)](',\x20')+_0xe22a11(0xf39),document[_0xe22a11(0x566)](_0xe22a11(0x205d))['style']['display']=_0xe22a11(0x2d4),document[_0xe22a11(0x566)](_0xe22a11(0x19a3))[_0xe22a11(0x194e)]=![],window[_0xe22a11(0x5f0)]=_0x43daa7;}catch(_0x38e42d){showToast(_0xe22a11(0xaf3),_0xe22a11(0x24ab)),console['error'](_0xe22a11(0x14b9),_0x38e42d);}},_0x8ce8db[_0x4b378c(0x170f)](_0x445b19);}async function executeImport(){const _0x3ca4ca=_0x2cf6d4;if(!window['pendingImportData']){showToast('没有待导入的数据',_0x3ca4ca(0x24ab));return;}if(!currentChatCharacter){showToast(_0x3ca4ca(0x87d),'warning');return;}try{showToast('正在导入数据，请稍候...',_0x3ca4ca(0x2422)),hideImportOptions();const _0x17b654=window[_0x3ca4ca(0x5f0)],_0x54473e=currentChatCharacter['id'];await db[_0x3ca4ca(0x174a)]('rw',[db['chatMessages'],db[_0x3ca4ca(0xd94)],db[_0x3ca4ca(0xb08)],db[_0x3ca4ca(0xa1b)],db[_0x3ca4ca(0x222e)],db[_0x3ca4ca(0x1982)],db['crossAppTimeline']],async()=>{const _0x4e0760=_0x3ca4ca;await db[_0x4e0760(0x464)][_0x4e0760(0x4a6)](_0x4e0760(0x10df))[_0x4e0760(0x14a)](_0x54473e)[_0x4e0760(0xc2b)](),await db[_0x4e0760(0xd94)][_0x4e0760(0x4a6)]('characterId')[_0x4e0760(0x14a)](_0x54473e)[_0x4e0760(0xc2b)](),await db[_0x4e0760(0xb08)][_0x4e0760(0x4a6)](_0x4e0760(0x956))[_0x4e0760(0x14a)](_0x54473e)[_0x4e0760(0xc2b)](),await db[_0x4e0760(0xa1b)]['where'](_0x4e0760(0x10df))[_0x4e0760(0x14a)](_0x54473e)[_0x4e0760(0xc2b)](),await db['episodicMemories']['where'](_0x4e0760(0x10df))[_0x4e0760(0x14a)](_0x54473e)[_0x4e0760(0xc2b)](),await db[_0x4e0760(0x1982)][_0x4e0760(0x4a6)](_0x4e0760(0x10df))[_0x4e0760(0x14a)](_0x54473e)['delete'](),await db[_0x4e0760(0x75b)][_0x4e0760(0x4a6)]('characterId')[_0x4e0760(0x14a)](_0x54473e)[_0x4e0760(0xc2b)](),_0x17b654[_0x4e0760(0x464)]?.[_0x4e0760(0xcbf)]&&await db[_0x4e0760(0x464)][_0x4e0760(0x24c8)](_0x17b654['chatMessages']),_0x17b654['smsMessages']?.[_0x4e0760(0xcbf)]&&await db['smsMessages'][_0x4e0760(0x24c8)](_0x17b654[_0x4e0760(0xd94)]),_0x17b654[_0x4e0760(0xb08)]?.['length']&&await db[_0x4e0760(0xb08)]['bulkAdd'](_0x17b654['chatSettings']),_0x17b654['coreMemories']?.['length']&&await db['coreMemories']['bulkAdd'](_0x17b654['coreMemories']),_0x17b654[_0x4e0760(0x222e)]?.[_0x4e0760(0xcbf)]&&await db[_0x4e0760(0x222e)][_0x4e0760(0x24c8)](_0x17b654[_0x4e0760(0x222e)]),_0x17b654['memorySummaries']?.[_0x4e0760(0xcbf)]&&await db[_0x4e0760(0x1982)][_0x4e0760(0x24c8)](_0x17b654['memorySummaries']),_0x17b654[_0x4e0760(0x75b)]?.[_0x4e0760(0xcbf)]&&await db['crossAppTimeline']['bulkAdd'](_0x17b654[_0x4e0760(0x75b)]);}),await loadChatMessages(),await loadSMSMessages(),await loadChatSettings(),renderMessageList();const _0x4bff61=document['getElementById']('sms-screen');_0x4bff61&&_0x4bff61[_0x3ca4ca(0x655)][_0x3ca4ca(0x2526)]!=='none'&&loadSMSHistory();const _0xd39c77=[];if(_0x17b654[_0x3ca4ca(0x464)]?.[_0x3ca4ca(0xcbf)])_0xd39c77[_0x3ca4ca(0x6ee)](_0x3ca4ca(0x1340)+_0x17b654[_0x3ca4ca(0x464)][_0x3ca4ca(0xcbf)]+'条');if(_0x17b654[_0x3ca4ca(0xd94)]?.[_0x3ca4ca(0xcbf)])_0xd39c77[_0x3ca4ca(0x6ee)]('短信消息:\x20'+_0x17b654[_0x3ca4ca(0xd94)]['length']+'条');if(_0x17b654[_0x3ca4ca(0xa1b)]?.[_0x3ca4ca(0xcbf)])_0xd39c77[_0x3ca4ca(0x6ee)](_0x3ca4ca(0x1b2f)+_0x17b654[_0x3ca4ca(0xa1b)][_0x3ca4ca(0xcbf)]+'条');if(_0x17b654['episodicMemories']?.[_0x3ca4ca(0xcbf)])_0xd39c77[_0x3ca4ca(0x6ee)](_0x3ca4ca(0xeac)+_0x17b654[_0x3ca4ca(0x222e)]['length']+'条');if(_0x17b654[_0x3ca4ca(0x1982)]?.[_0x3ca4ca(0xcbf)])_0xd39c77[_0x3ca4ca(0x6ee)](_0x3ca4ca(0x237f)+_0x17b654[_0x3ca4ca(0x1982)][_0x3ca4ca(0xcbf)]+'条');if(_0x17b654[_0x3ca4ca(0x75b)]?.[_0x3ca4ca(0xcbf)])_0xd39c77[_0x3ca4ca(0x6ee)](_0x3ca4ca(0x212c)+_0x17b654[_0x3ca4ca(0x75b)][_0x3ca4ca(0xcbf)]+'条');showToast('数据导入成功！已导入：'+_0xd39c77[_0x3ca4ca(0x140c)](',\x20')+_0x3ca4ca(0x1c5d),_0x3ca4ca(0xb27)),delete window[_0x3ca4ca(0x5f0)];}catch(_0xae9aca){console[_0x3ca4ca(0x24ab)](_0x3ca4ca(0x1389),_0xae9aca),showToast(_0x3ca4ca(0x18d)+_0xae9aca['message'],_0x3ca4ca(0x24ab));}}function escapeHtml(_0x246dc3){const _0x2bdee4=_0x2cf6d4,_0x29fc05=document[_0x2bdee4(0x1ad8)]('div');return _0x29fc05[_0x2bdee4(0x21dc)]=_0x246dc3,_0x29fc05[_0x2bdee4(0xc02)];}function findMessageById(_0x5b8ffe){if(!currentChatCharacter||!chatMessages[currentChatCharacter['id']])return null;const _0x58ebb2=chatMessages[currentChatCharacter['id']],_0x244fe1=_0x58ebb2['find'](_0x13d93e=>_0x13d93e['id']===_0x5b8ffe);return _0x244fe1;}function addTimestampToMessage(_0x244cdc,_0x4b7f2d,_0x3ccb56,_0x398c0f){const _0xabb9dd=_0x2cf6d4;if(!_0x244cdc||!_0x4b7f2d)return;const _0x113964=formatTimeOnly(_0x4b7f2d[_0xabb9dd(0x7aa)]);switch(_0x3ccb56){case _0xabb9dd(0x849):const _0x1e91cf=document[_0xabb9dd(0x1ad8)](_0xabb9dd(0x526));_0x1e91cf[_0xabb9dd(0x221)]=_0xabb9dd(0x1a2e),_0x1e91cf[_0xabb9dd(0x21dc)]=_0x113964;_0x4b7f2d[_0xabb9dd(0xf75)]===_0xabb9dd(0xfda)?(_0x1e91cf[_0xabb9dd(0x655)][_0xabb9dd(0xd2d)]='right',_0x1e91cf['style'][_0xabb9dd(0x1077)]=_0xabb9dd(0xa63),_0x244cdc[_0xabb9dd(0x1806)](_0x1e91cf,_0x244cdc['firstChild'])):(_0x1e91cf[_0xabb9dd(0x655)][_0xabb9dd(0xd2d)]=_0xabb9dd(0x1466),_0x1e91cf[_0xabb9dd(0x655)]['marginLeft']='8px',_0x244cdc[_0xabb9dd(0x1925)](_0x1e91cf));break;case _0xabb9dd(0x107f):const _0x1dbd3e=document[_0xabb9dd(0x1ad8)](_0xabb9dd(0x526));_0x1dbd3e[_0xabb9dd(0x221)]='timestamp\x20timestamp-avatar',_0x1dbd3e[_0xabb9dd(0x21dc)]=_0x113964,_0x1dbd3e[_0xabb9dd(0x655)][_0xabb9dd(0xd2d)]=_0xabb9dd(0x23a1),_0x1dbd3e[_0xabb9dd(0x655)][_0xabb9dd(0x1ae6)]=_0xabb9dd(0x94c),_0x1dbd3e[_0xabb9dd(0x655)][_0xabb9dd(0x2099)]='#999',_0x1dbd3e[_0xabb9dd(0x655)][_0xabb9dd(0xc4b)]=_0xabb9dd(0x1230);const _0x18488f=_0x244cdc[_0xabb9dd(0x15b8)](_0xabb9dd(0xdef));_0x18488f&&(_0x18488f[_0xabb9dd(0x1925)](_0x1dbd3e),_0x244cdc['classList']['add'](_0xabb9dd(0x1012)));break;case _0xabb9dd(0x151c):const _0x18da1d=document['createElement'](_0xabb9dd(0x526));_0x18da1d[_0xabb9dd(0x221)]='timestamp\x20timestamp-inside',_0x18da1d['textContent']=_0x113964,_0x18da1d[_0xabb9dd(0x655)][_0xabb9dd(0x1ae6)]=_0xabb9dd(0x94c),_0x18da1d[_0xabb9dd(0x655)][_0xabb9dd(0x2099)]=_0x4b7f2d['sender']===_0xabb9dd(0xfda)?isLightColor(_0x398c0f[_0xabb9dd(0x1aab)]||_0xabb9dd(0x1f03))?'#666':_0xabb9dd(0xb24):isLightColor(_0x398c0f[_0xabb9dd(0x2116)]||_0xabb9dd(0x1679))?'#666':_0xabb9dd(0xb24),_0x18da1d[_0xabb9dd(0x655)][_0xabb9dd(0xd2d)]='right',_0x18da1d[_0xabb9dd(0x655)][_0xabb9dd(0xc4b)]=_0xabb9dd(0x1642);const _0x114af3=_0x244cdc[_0xabb9dd(0x15b8)]('.message-bubble');_0x114af3&&_0x114af3[_0xabb9dd(0x1925)](_0x18da1d);break;}}function getCurrentPersonaName(){const _0x3a1b50=_0x2cf6d4,_0x2949e3=getCurrentChatSettings(),_0xb167a3=_0x2949e3[_0x3a1b50(0x433)]||_0x2949e3[_0x3a1b50(0x6a0)];if(_0xb167a3){const _0xc82b58=personas['find'](_0x381e2f=>_0x381e2f['id']===_0xb167a3);if(_0xc82b58)return _0x2949e3[_0x3a1b50(0xb42)]||_0xc82b58[_0x3a1b50(0x222f)];}return'用户';}function getCurrentPersonaDescription(){const _0x29619f=_0x2cf6d4,_0x267264=getCurrentChatSettings(),_0x56429c=_0x267264[_0x29619f(0x433)]||_0x267264['selectedIdentityId'];if(_0x56429c){const _0x3bd78c=personas[_0x29619f(0x1aeb)](_0x348a59=>_0x348a59['id']===_0x56429c);if(_0x3bd78c&&_0x3bd78c[_0x29619f(0x1c6f)])return _0x3bd78c[_0x29619f(0x1c6f)];}return _0x29619f(0x153b);}function changeTheirBubbleColor(){const _0x20b331=_0x2cf6d4;colorPickerContext=_0x20b331(0x22f8),document['getElementById'](_0x20b331(0x1c68))[_0x20b331(0x21dc)]=_0x20b331(0xd5c),showModal(_0x20b331(0x224c));}function changeMyBubbleColor(){const _0x1ac1af=_0x2cf6d4;colorPickerContext=_0x1ac1af(0x1955),document['getElementById'](_0x1ac1af(0x1c68))['textContent']=_0x1ac1af(0xb68),showModal(_0x1ac1af(0x224c));}function showBubbleColorSettings(){const _0x4f14ff=_0x2cf6d4;alert(_0x4f14ff(0x2574));}function showClearHistoryOptionsModal(){const _0x355d74=_0x2cf6d4;if(!currentChatCharacter)return;const _0x395443=_0x355d74(0x164)+currentChatCharacter[_0x355d74(0x222f)]+'</strong>\x20的聊天记录吗？\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22setting-section\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22section-header\x22\x20style=\x22padding:\x200\x200\x2010px\x200;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-brain\x20section-icon\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22section-title\x22>同步清除相关记忆</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22checkbox-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22checkbox-option\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22checkbox\x22\x20id=\x22clear-core-memory\x22\x20value=\x22core\x22\x20checked>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22checkbox-custom\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22checkbox-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22checkbox-title\x22>核心记忆</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22checkbox-desc\x22>角色记住的关键信息（如生日、关系）。</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22checkbox-option\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22checkbox\x22\x20id=\x22clear-episodic-memory\x22\x20value=\x22episodic\x22\x20checked>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22checkbox-custom\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22checkbox-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22checkbox-title\x22>情景记忆</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22checkbox-desc\x22>日常互动和经历的记忆。</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22checkbox-option\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22checkbox\x22\x20id=\x22clear-timeline\x22\x20value=\x22timeline\x22\x20checked>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22checkbox-custom\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22checkbox-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22checkbox-title\x22>时间线</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22checkbox-desc\x22>所有活动的详细时间记录。</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22margin-top:\x2015px;\x20font-size:\x2012px;\x20color:\x20#999;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>提示：</strong>聊天设置（如身份、背景）将会被保留。\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-button\x20modal-secondary\x22\x20onclick=\x22this.closest(\x27.modal\x27).remove()\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-button\x20modal-primary\x22\x20style=\x22background-color:\x20#ff3b30;\x22\x20onclick=\x22executeClearHistory()\x22>确认清空</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';document['body'][_0x355d74(0x22ba)](_0x355d74(0x580),_0x395443);}async function executeClearHistory(){const _0x481ed7=_0x2cf6d4,_0x1d86a6=currentChatCharacter['id'];console[_0x481ed7(0xc0d)](_0x481ed7(0xcf0)+_0x1d86a6+_0x481ed7(0xcf9)),showToast(_0x481ed7(0xb12),_0x481ed7(0x2422));const _0x533675=document[_0x481ed7(0x566)](_0x481ed7(0x1372))?.['checked']||![],_0x3b61ae=document[_0x481ed7(0x566)](_0x481ed7(0x113c))?.[_0x481ed7(0x306)]||![],_0x1492cd=document[_0x481ed7(0x566)](_0x481ed7(0x1b34))?.[_0x481ed7(0x306)]||![],_0x3f3849=document[_0x481ed7(0x566)](_0x481ed7(0xeff));if(_0x3f3849)_0x3f3849['remove']();try{chatMessages[_0x1d86a6]=[];try{await saveChatMessagesImmediate([_0x1d86a6]),console['log'](_0x481ed7(0xe69));}catch(_0x4687ad){console[_0x481ed7(0x24ab)]('清空消息保存失败，回退到全量保存:',_0x4687ad),await saveChatMessages();}console['log'](_0x481ed7(0x620));const _0x35c371=_0x1d86a6;if(_0x533675){const _0x5d9b2d=await db[_0x481ed7(0xa1b)][_0x481ed7(0x4a6)]('characterId')['equals'](_0x1d86a6)[_0x481ed7(0x1534)](_0x3b694b=>{const _0x442f32=_0x481ed7;return!_0x3b694b[_0x442f32(0x161f)]||_0x3b694b[_0x442f32(0x161f)]===_0x35c371;})[_0x481ed7(0x1f49)]();_0x5d9b2d[_0x481ed7(0xcbf)]>0x0?(await db[_0x481ed7(0xa1b)]['bulkDelete'](_0x5d9b2d),console['log'](_0x481ed7(0x1fd0)+_0x5d9b2d[_0x481ed7(0xcbf)]+_0x481ed7(0x1d65))):console[_0x481ed7(0xc0d)](_0x481ed7(0x181f)+_0x1d86a6+_0x481ed7(0x19d0));}if(_0x3b61ae){const _0x1d0d8f=await db[_0x481ed7(0x222e)][_0x481ed7(0x4a6)](_0x481ed7(0x10df))[_0x481ed7(0x14a)](_0x1d86a6)[_0x481ed7(0x1534)](_0x546b6a=>{const _0x3465e9=_0x481ed7;return!_0x546b6a[_0x3465e9(0x161f)]||_0x546b6a[_0x3465e9(0x161f)]===_0x35c371;})[_0x481ed7(0x1f49)]();_0x1d0d8f['length']>0x0?(await db[_0x481ed7(0x222e)][_0x481ed7(0xf71)](_0x1d0d8f),console['log'](_0x481ed7(0x1fd0)+_0x1d0d8f['length']+_0x481ed7(0xc25))):console[_0x481ed7(0xc0d)]('ℹ️\x20角色\x20'+_0x1d86a6+_0x481ed7(0x1cf3));}if(_0x1492cd){const _0x510fa4=await db[_0x481ed7(0x75b)][_0x481ed7(0x4a6)](_0x481ed7(0x10df))['equals'](_0x1d86a6)['primaryKeys']();_0x510fa4[_0x481ed7(0xcbf)]>0x0?(await db[_0x481ed7(0x75b)][_0x481ed7(0xf71)](_0x510fa4),console[_0x481ed7(0xc0d)](_0x481ed7(0x1fd0)+_0x510fa4['length']+'\x20条时间线记录')):console[_0x481ed7(0xc0d)]('ℹ️\x20角色\x20'+_0x1d86a6+'\x20没有时间线记录需要清除');const _0x339e79=await db['memorySummaries']['where'](_0x481ed7(0x10df))[_0x481ed7(0x14a)](_0x1d86a6)[_0x481ed7(0x1f49)]();_0x339e79[_0x481ed7(0xcbf)]>0x0?(await db[_0x481ed7(0x1982)]['bulkDelete'](_0x339e79),console['log'](_0x481ed7(0x1fd0)+_0x339e79[_0x481ed7(0xcbf)]+_0x481ed7(0x16de))):console['log']('ℹ️\x20角色\x20'+_0x1d86a6+_0x481ed7(0x1ab));}renderChatMessages(_0x1d86a6),renderMessageList(),showToast(_0x481ed7(0x19fb),'success'),console[_0x481ed7(0xc0d)](_0x481ed7(0x13ea)+_0x1d86a6+_0x481ed7(0x24fc)),hideChatSettings();}catch(_0x57b0ba){console[_0x481ed7(0x24ab)](_0x481ed7(0x1c0),_0x57b0ba),showToast(_0x481ed7(0x106a),_0x481ed7(0x24ab));}}function clearChatHistory(){showClearHistoryOptionsModal();}function selectColor(_0x5039d3){const _0x1552ab=_0x2cf6d4;document[_0x1552ab(0x1ed9)](_0x1552ab(0x5c4))[_0x1552ab(0x900)](_0x469ddd=>{const _0x5d5a93=_0x1552ab;_0x469ddd[_0x5d5a93(0x226e)][_0x5d5a93(0x128)]('selected');}),event[_0x1552ab(0x1144)][_0x1552ab(0x226e)][_0x1552ab(0xe1)](_0x1552ab(0x876)),document[_0x1552ab(0x566)]('selected-color')[_0x1552ab(0xc34)]=_0x5039d3;}async function applyChatBackground(_0x3f7b8b,_0x3623f4=![]){const _0x416e5b=_0x2cf6d4;if(!currentChatCharacter)return;console[_0x416e5b(0xc0d)](_0x416e5b(0x44a)+currentChatCharacter[_0x416e5b(0x222f)]+_0x416e5b(0x192)+currentChatCharacter['id']+_0x416e5b(0x6a4)+_0x3623f4);!currentChatCharacter[_0x416e5b(0xc3c)]&&(currentChatCharacter[_0x416e5b(0xc3c)]=null);const _0x440927=_0x3f7b8b!==undefined?_0x3f7b8b:currentChatCharacter[_0x416e5b(0xc3c)],_0x5183f0=currentChatCharacter[_0x416e5b(0xc3c)]!==_0x440927;currentChatCharacter[_0x416e5b(0xc3c)]=_0x440927;if(_0x5183f0&&!_0x3623f4){console[_0x416e5b(0xc0d)](_0x416e5b(0xfcd)+currentChatCharacter[_0x416e5b(0x222f)]+_0x416e5b(0x1883));if(currentChatCharacter[_0x416e5b(0x4b7)]){const _0x6a93e9=groupChats['findIndex'](_0x5a7ab9=>_0x5a7ab9['id']===currentChatCharacter['id']);_0x6a93e9!==-0x1&&(groupChats[_0x6a93e9]['background']=_0x440927,await saveGroupChats(),console['log'](_0x416e5b(0x1d57)));}else{const _0x5818e8=characters['findIndex'](_0x5a72ba=>_0x5a72ba['id']===currentChatCharacter['id']);_0x5818e8!==-0x1&&(characters[_0x5818e8][_0x416e5b(0xc3c)]=_0x440927,await saveCharacters(),console[_0x416e5b(0xc0d)](_0x416e5b(0x649)));}}else _0x3623f4?console['log']('⏭️\x20[背景保存]\x20'+currentChatCharacter[_0x416e5b(0x222f)]+':\x20跳过保存（skipSave=true）'):console[_0x416e5b(0xc0d)]('⏭️\x20[背景保存]\x20'+currentChatCharacter[_0x416e5b(0x222f)]+':\x20背景未变化，跳过保存');const _0x2775f6=document[_0x416e5b(0x566)]('api-chat-screen');if(!_0x2775f6)return;if(_0x440927){console[_0x416e5b(0xc0d)](_0x416e5b(0x70b)+currentChatCharacter[_0x416e5b(0x222f)]+_0x416e5b(0x192)+currentChatCharacter['id']+')'),_0x2775f6['style'][_0x416e5b(0x1584)]='url('+_0x440927+')',_0x2775f6[_0x416e5b(0x655)]['backgroundSize']=_0x416e5b(0xe3e),_0x2775f6['style'][_0x416e5b(0x18b3)]=_0x416e5b(0x23a1),_0x2775f6[_0x416e5b(0x655)][_0x416e5b(0xacd)]=_0x416e5b(0x14b5);const _0x4f93d1=document[_0x416e5b(0x566)](_0x416e5b(0x24e7));if(_0x4f93d1)_0x4f93d1[_0x416e5b(0x655)][_0x416e5b(0xc3c)]=_0x416e5b(0x14b5);}else{console[_0x416e5b(0xc0d)](_0x416e5b(0x13e1)+currentChatCharacter[_0x416e5b(0x222f)]+_0x416e5b(0x192)+currentChatCharacter['id']+')'),_0x2775f6[_0x416e5b(0x655)]['backgroundImage']=_0x416e5b(0xfe9),_0x2775f6['style'][_0x416e5b(0xacd)]=_0x416e5b(0x241f);const _0x2c228d=document[_0x416e5b(0x566)]('api-chat-messages');if(_0x2c228d)_0x2c228d[_0x416e5b(0x655)]['background']='';}console[_0x416e5b(0xc0d)](_0x416e5b(0x1f30)+currentChatCharacter[_0x416e5b(0x222f)]+'\x20(ID:\x20'+currentChatCharacter['id']+')');}function saveBubbleStyleSettings(){const _0x35ad4e=_0x2cf6d4,_0x48d36f=getCurrentChatSettings();_0x48d36f[_0x35ad4e(0xa7e)]=window[_0x35ad4e(0x1c5)]||_0x35ad4e(0xbf),_0x48d36f[_0x35ad4e(0x1aab)]=document[_0x35ad4e(0x566)](_0x35ad4e(0x1d50))['value'],_0x48d36f[_0x35ad4e(0x2116)]=document['getElementById']('ai-bubble-color')['value'],_0x48d36f[_0x35ad4e(0xbd8)]=document[_0x35ad4e(0x566)](_0x35ad4e(0x1ec8))[_0x35ad4e(0xc34)];const _0x10b31d={'default':_0x35ad4e(0x13ed),'shadow':'经典阴影','tail':_0x35ad4e(0x725),'paper':_0x35ad4e(0xd9b)};document[_0x35ad4e(0x566)](_0x35ad4e(0x21d4))[_0x35ad4e(0x21dc)]=_0x10b31d[_0x48d36f[_0x35ad4e(0xa7e)]]||_0x35ad4e(0x13ed),saveCurrentChatSettings(_0x48d36f),applyBubbleStyle(),hideModal(_0x35ad4e(0x1103)),showToast(_0x35ad4e(0x116),_0x35ad4e(0xb27));}function applyBubbleStyle(){const _0x140aef=_0x2cf6d4,_0xde67c0=document[_0x140aef(0x566)](_0x140aef(0x24e7));if(!_0xde67c0)return;let _0x4a81ff={};currentChatCharacter?_0x4a81ff=getCurrentChatSettings():_0x4a81ff={'bubbleStyle':_0x140aef(0xbf),'myBubbleColor':_0x140aef(0x1f03),'aiBubbleColor':'#f0f0f0','bubbleOpacity':'1'};_0xde67c0['className']=_0xde67c0[_0x140aef(0x221)][_0x140aef(0x633)]('\x20')[_0x140aef(0x803)](_0x2543b9=>!_0x2543b9[_0x140aef(0x1cab)](_0x140aef(0x19e8)))[_0x140aef(0x140c)]('\x20');const _0x350ec3=_0x4a81ff[_0x140aef(0xa7e)]||_0x140aef(0xbf);_0xde67c0[_0x140aef(0x226e)][_0x140aef(0xe1)](_0x140aef(0x19e8)+_0x350ec3);const _0x1d4a3c=_0x4a81ff[_0x140aef(0x1aab)]||_0x140aef(0x1f03),_0xa5e2ae=_0x4a81ff[_0x140aef(0x2116)]||_0x140aef(0x1679),_0x29cd0e=_0x4a81ff['bubbleOpacity']||'1';_0xde67c0[_0x140aef(0x655)]['setProperty'](_0x140aef(0x1e23),_0x1d4a3c),_0xde67c0['style'][_0x140aef(0x16db)](_0x140aef(0x1652),_0xa5e2ae),_0xde67c0[_0x140aef(0x655)][_0x140aef(0x16db)](_0x140aef(0x1436),_0x29cd0e);const _0x3d941f=_0x4a81ff[_0x140aef(0x1e5e)]||'';applyCustomBubbleCSS(),console[_0x140aef(0xc0d)]('🎨\x20气泡样式已应用:\x20'+_0x350ec3+_0x140aef(0x13bf)+(currentChatCharacter?.[_0x140aef(0x222f)]||'无')+')');}function showBubbleColorPicker(_0x282838){const _0x1c12ab=_0x2cf6d4;colorPickerContext=_0x282838,document['getElementById'](_0x1c12ab(0x1c68))[_0x1c12ab(0x21dc)]='设置气泡颜色',showModal(_0x1c12ab(0x224c));}function selectColor(_0xca5ddd){const _0xc802df=_0x2cf6d4;document[_0xc802df(0x1ed9)](_0xc802df(0x5c4))[_0xc802df(0x900)](_0x1d48b7=>{const _0x2c3cba=_0xc802df;_0x1d48b7['classList'][_0x2c3cba(0x128)](_0x2c3cba(0x876));}),event['target'][_0xc802df(0x226e)][_0xc802df(0xe1)](_0xc802df(0x876)),document[_0xc802df(0x566)]('selected-color')['value']=_0xca5ddd;}async function applyColorSelection(){const _0x2a5044=_0x2cf6d4,_0xb48078=document['querySelector'](_0x2a5044(0x15cf))?.[_0x2a5044(0x655)]['backgroundColor']||'#007AFF',_0x3de04d=document[_0x2a5044(0x566)](_0x2a5044(0xbb0))[_0x2a5044(0xc34)];if(colorPickerContext===_0x2a5044(0x22f8))chatSettings[_0x2a5044(0xa43)]=_0xb48078,chatSettings[_0x2a5044(0xbd8)]=_0x3de04d;else colorPickerContext==='myBubble'&&(chatSettings['myBubbleColor']=_0xb48078,chatSettings[_0x2a5044(0xbd8)]=_0x3de04d);await saveChatSettings(),renderChatMessages(currentChatCharacter['id']),hideModal(_0x2a5044(0x224c));}function showWallpaperPicker(){const _0x3e2fc5=_0x2cf6d4;showModal(_0x3e2fc5(0xb96));}function selectWallpaper(_0x2dc0d8){const _0xeaaa2e=_0x2cf6d4;console[_0xeaaa2e(0xc0d)](_0xeaaa2e(0x1f93),_0x2dc0d8),selectedWallpaper=_0x2dc0d8,console[_0xeaaa2e(0xc0d)](_0xeaaa2e(0x22b4),selectedWallpaper);}async function applyWallpaperSelection(){const _0x16dd08=_0x2cf6d4;console['log']('应用壁纸被调用，selectedWallpaper:',selectedWallpaper);if(!selectedWallpaper){alert(_0x16dd08(0x21c8));return;}if(selectedWallpaper[_0x16dd08(0x1cab)]('data:image')){console[_0x16dd08(0xc0d)]('应用图片壁纸'),document[_0x16dd08(0x15b8)]('.wallpaper')[_0x16dd08(0x655)][_0x16dd08(0x1584)]='url('+selectedWallpaper+')',document['querySelector'](_0x16dd08(0x14a0))[_0x16dd08(0x655)]['backgroundSize']=_0x16dd08(0x2158),document['querySelector'](_0x16dd08(0x14a0))[_0x16dd08(0x655)]['backgroundPosition']='center';try{await db['wallpapers'][_0x16dd08(0x2215)](),await db[_0x16dd08(0x229d)][_0x16dd08(0xe1)]({'id':_0x16dd08(0x9de),'type':_0x16dd08(0xe5b),'data':selectedWallpaper}),console[_0x16dd08(0xc0d)](_0x16dd08(0x87e)),hideModal('wallpaper-picker-modal');}catch(_0x8f6763){console[_0x16dd08(0x24ab)](_0x16dd08(0x64e),_0x8f6763),alert(_0x16dd08(0x1c6d));}}else alert(_0x16dd08(0x21c8));}function uploadCustomWallpaper(){const _0x163318=_0x2cf6d4;document[_0x163318(0x566)](_0x163318(0xa3f))[_0x163318(0x1e62)]();}let selectedAppForIcon=null,uploadedIconImage=null;function showIconPicker(){const _0x2e070a=_0x2cf6d4;generateAppList(),showModal(_0x2e070a(0x761));}function generateAppList(){const _0x4a280d=_0x2cf6d4,_0x41ff8b=document[_0x4a280d(0x566)](_0x4a280d(0xb1a));_0x41ff8b[_0x4a280d(0xc02)]='';const _0x58fd49=[{'id':_0x4a280d(0xa76),'name':_0x4a280d(0x1d2c),'selector':_0x4a280d(0x1a8c)},{'id':_0x4a280d(0x5d4),'name':'世界书','selector':_0x4a280d(0x16c0)},{'id':_0x4a280d(0xc4e),'name':_0x4a280d(0xad0),'selector':_0x4a280d(0x197c)},{'id':_0x4a280d(0x1bc3),'name':'论坛','selector':_0x4a280d(0x118a)},{'id':'messages-screen','name':'短信','selector':_0x4a280d(0x1b77)},{'id':_0x4a280d(0x1f16),'name':'设置','selector':_0x4a280d(0x2478)},{'id':_0x4a280d(0x1a33),'name':'记忆','selector':_0x4a280d(0x1bb3)}];_0x58fd49[_0x4a280d(0x900)](_0x2bed5b=>{const _0x41f8bb=_0x4a280d,_0x1693a5=document[_0x41f8bb(0x15b8)](_0x2bed5b[_0x41f8bb(0xa37)]);if(_0x1693a5){const _0x425344=document[_0x41f8bb(0x1ad8)]('div');_0x425344[_0x41f8bb(0x221)]=_0x41f8bb(0x806),_0x425344[_0x41f8bb(0x11cf)]=()=>selectAppForIcon(_0x2bed5b['id'],_0x2bed5b['name'],_0x2bed5b[_0x41f8bb(0xa37)]);const _0x450b7f=_0x1693a5[_0x41f8bb(0xc02)];_0x425344[_0x41f8bb(0xc02)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22app-item-icon\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x450b7f+_0x41f8bb(0x55b)+_0x2bed5b['name']+_0x41f8bb(0xc38),_0x41ff8b['appendChild'](_0x425344);}});}function selectAppForIcon(_0x577029,_0x3b5db3,_0x13b7f7){const _0x28d498=_0x2cf6d4;selectedAppForIcon={'id':_0x577029,'name':_0x3b5db3,'selector':_0x13b7f7},document[_0x28d498(0x1ed9)](_0x28d498(0x1c97))[_0x28d498(0x900)](_0x782c8b=>{const _0x2d70a9=_0x28d498;_0x782c8b['classList'][_0x2d70a9(0x128)](_0x2d70a9(0x876));}),event['currentTarget']['classList'][_0x28d498(0xe1)](_0x28d498(0x876)),document[_0x28d498(0x566)](_0x28d498(0x1991))['style'][_0x28d498(0x2526)]=_0x28d498(0x2d4),resetIconUpload();}function triggerIconUpload(){const _0x5713b1=_0x2cf6d4;if(!selectedAppForIcon){alert(_0x5713b1(0x2aa));return;}document[_0x5713b1(0x566)](_0x5713b1(0xd75))[_0x5713b1(0x1e62)]();}function resetIconUpload(){const _0x4b96e7=_0x2cf6d4;uploadedIconImage=null,document[_0x4b96e7(0x566)]('upload-placeholder')[_0x4b96e7(0x655)][_0x4b96e7(0x2526)]=_0x4b96e7(0x2d4),document[_0x4b96e7(0x566)](_0x4b96e7(0xf45))[_0x4b96e7(0x655)][_0x4b96e7(0x2526)]='none',document[_0x4b96e7(0x15b8)](_0x4b96e7(0x39d))['classList']['remove'](_0x4b96e7(0x1d41)),document[_0x4b96e7(0x566)](_0x4b96e7(0x1eac))[_0x4b96e7(0x655)][_0x4b96e7(0x2526)]=_0x4b96e7(0xfe9);}async function applyIconChange(){const _0x4fa7bd=_0x2cf6d4;if(!selectedAppForIcon||!uploadedIconImage){alert(_0x4fa7bd(0xb6b));return;}try{const _0x56be38=document[_0x4fa7bd(0x15b8)](selectedAppForIcon['selector']);_0x56be38&&(_0x56be38['innerHTML']=_0x4fa7bd(0x2001)+uploadedIconImage+_0x4fa7bd(0x1ca8)+selectedAppForIcon['name']+_0x4fa7bd(0x24af)),await saveCustomAppIcon(selectedAppForIcon['id'],uploadedIconImage),showToast('应用图标已更新！',_0x4fa7bd(0xb27)),hideModal(_0x4fa7bd(0x761)),selectedAppForIcon=null,uploadedIconImage=null;}catch(_0x5886bd){console[_0x4fa7bd(0x24ab)](_0x4fa7bd(0x59e),_0x5886bd),showToast(_0x4fa7bd(0x1128),'error');}}async function saveCustomAppIcon(_0x1c0837,_0x4521a5){const _0x40b73f=_0x2cf6d4;try{await db[_0x40b73f(0x1f22)][_0x40b73f(0x53a)]({'id':_0x1c0837,'appId':_0x1c0837,'imageData':_0x4521a5,'updatedAt':new Date()}),console[_0x40b73f(0xc0d)](_0x40b73f(0x3a0),_0x1c0837);}catch(_0x5892fd){console['error'](_0x40b73f(0x1a5c),_0x5892fd);throw _0x5892fd;}}async function loadCustomAppIcons(){const _0x26ff6f=_0x2cf6d4;try{const _0x3f02af=await db[_0x26ff6f(0x1f22)][_0x26ff6f(0x18c6)]();_0x3f02af['forEach'](_0x24b951=>{const _0x5a53fc=_0x26ff6f;if(_0x24b951[_0x5a53fc(0xfe5)]){const _0x33d46f=[{'id':_0x5a53fc(0xa76),'selector':_0x5a53fc(0x1a8c)},{'id':_0x5a53fc(0x5d4),'selector':_0x5a53fc(0x16c0)},{'id':_0x5a53fc(0xc4e),'selector':_0x5a53fc(0x197c)},{'id':_0x5a53fc(0x1bc3),'selector':_0x5a53fc(0x118a)},{'id':_0x5a53fc(0x30f),'selector':'.dock-app[onclick=\x22showApp(\x27messages-screen\x27)\x22]\x20.dock-app-icon'},{'id':_0x5a53fc(0x1f16),'selector':'.dock-app[onclick=\x22showApp(\x27settings-screen\x27)\x22]\x20.dock-app-icon'},{'id':'memory-viewer-screen','selector':_0x5a53fc(0x1bb3)}],_0x146eca=_0x33d46f[_0x5a53fc(0x1aeb)](_0x4a581c=>_0x4a581c['id']===_0x24b951[_0x5a53fc(0x233d)]);if(_0x146eca){const _0x4a556b=document[_0x5a53fc(0x15b8)](_0x146eca[_0x5a53fc(0xa37)]);_0x4a556b&&(_0x4a556b['innerHTML']=_0x5a53fc(0x2001)+_0x24b951['imageData']+_0x5a53fc(0x1ca8)+_0x24b951[_0x5a53fc(0x233d)]+_0x5a53fc(0x24af));}}});}catch(_0x4c1b4e){console[_0x26ff6f(0x24ab)](_0x26ff6f(0xf4),_0x4c1b4e);}}function initializeIconUpload(){const _0x531afb=_0x2cf6d4,_0x39b61a=document[_0x531afb(0x566)]('custom-icon-upload');if(!_0x39b61a){console[_0x531afb(0x24ab)]('找不到custom-icon-upload元素');return;}_0x39b61a[_0x531afb(0x6be)](_0x531afb(0x17ef),handleIconUpload),_0x39b61a[_0x531afb(0x167)](_0x531afb(0x17ef),handleIconUpload),console[_0x531afb(0xc0d)](_0x531afb(0x22f4));}async function handleIconUpload(_0x4b54a1){const _0x47ec4a=_0x2cf6d4;if(_0x4b54a1[_0x47ec4a(0x1144)][_0x47ec4a(0x173e)]&&_0x4b54a1[_0x47ec4a(0x1144)][_0x47ec4a(0x173e)][0x0]){const _0x10ad94=_0x4b54a1[_0x47ec4a(0x1144)][_0x47ec4a(0x173e)][0x0];if(!_0x10ad94[_0x47ec4a(0x23df)]['startsWith'](_0x47ec4a(0x1183))){alert('请选择图片文件');return;}if(_0x10ad94[_0x47ec4a(0x41a)]>0x5*0x400*0x400){alert('图片文件不能超过5MB');return;}try{const _0x33a7e9=await compressImage(_0x10ad94,0xc8,0.8),_0x39d179=document['querySelector'](_0x47ec4a(0x39d)),_0x470054=document[_0x47ec4a(0x566)](_0x47ec4a(0x15d1)),_0x4f0242=document[_0x47ec4a(0x566)](_0x47ec4a(0xf45));_0x470054[_0x47ec4a(0x655)][_0x47ec4a(0x2526)]='none',_0x4f0242[_0x47ec4a(0x107)]=_0x33a7e9,_0x4f0242[_0x47ec4a(0x655)][_0x47ec4a(0x2526)]=_0x47ec4a(0x2d4),_0x39d179[_0x47ec4a(0x226e)][_0x47ec4a(0xe1)](_0x47ec4a(0x1d41)),uploadedIconImage=_0x33a7e9,document['getElementById'](_0x47ec4a(0x1eac))[_0x47ec4a(0x655)]['display']=_0x47ec4a(0xf09),showToast(_0x47ec4a(0x1c4f),_0x47ec4a(0xb27));}catch(_0x2760c3){console['error'](_0x47ec4a(0xf95),_0x2760c3),showToast(_0x47ec4a(0x22ee),'error');}}}function changeChatThemeColor(){const _0x2a8431=_0x2cf6d4;colorPickerContext=_0x2a8431(0x129c),document[_0x2a8431(0x566)](_0x2a8431(0x1c68))[_0x2a8431(0x21dc)]=_0x2a8431(0x1682),showModal(_0x2a8431(0x224c));}function showMessageMenu(_0x1f61f2,_0x1bdf54){showMobileMessageMenu(_0x1f61f2,_0x1bdf54);return;}function hideMessageMenu(_0x40e9b7){const _0x261945=_0x2cf6d4;hideMessageActionBar(_0x40e9b7);const _0x4ee7e6=document[_0x261945(0x566)](_0x261945(0xde2));_0x4ee7e6&&(_0x4ee7e6[_0x261945(0x655)][_0x261945(0x2526)]=_0x261945(0xfe9),_0x4ee7e6[_0x261945(0x11cf)]=null),document[_0x261945(0x6be)](_0x261945(0x1e62),hideMessageMenu),document[_0x261945(0x6be)]('touchstart',hideMessageMenu);}let currentReplyTo=null,chatReplyStates={};function replyToMessage(_0x1c24d5=null){const _0x22ca03=_0x2cf6d4,_0x74ffd3=_0x1c24d5||selectedMessageId;console[_0x22ca03(0xc0d)]('引用消息:',_0x74ffd3,_0x22ca03(0x484),_0x1c24d5?_0x22ca03(0x156c):'桌面端');if(!_0x74ffd3){console[_0x22ca03(0xc0d)](_0x22ca03(0x11e9));return;}const _0x2068a2=chatMessages[currentChatCharacter['id']]||[],_0x230273=_0x2068a2[_0x22ca03(0x1aeb)](_0x4e8882=>_0x4e8882['id']===_0x74ffd3);if(_0x230273){let _0x40724f='[消息]';if(Array['isArray'](_0x230273['content'])){const _0xef7d38=_0x230273[_0x22ca03(0x1423)]['find'](_0x440a6b=>_0x440a6b[_0x22ca03(0x23df)]==='text'),_0x47676e=_0x230273['content'][_0x22ca03(0x1aeb)](_0x5e498e=>_0x5e498e['type']===_0x22ca03(0x1cfa));if(_0xef7d38?.['text'])_0x40724f=_0xef7d38[_0x22ca03(0x1e58)];else _0x47676e?_0x40724f=_0x22ca03(0xff7):_0x40724f=_0x22ca03(0x1f6f);}else{if(_0x230273[_0x22ca03(0x23df)]===_0x22ca03(0x106)){_0x40724f=_0x22ca03(0x1a6b)+_0x230273['content'];if(_0x230273['forwardedMessages']&&_0x230273['forwardedMessages'][_0x22ca03(0xcbf)]>0x0){const _0x49f460=_0x230273[_0x22ca03(0x166b)][0x0],_0x364f5a=_0x49f460[_0x22ca03(0xf75)]==='sent'?_0x49f460['userName']||'用户':_0x49f460[_0x22ca03(0x222f)]||_0x49f460[_0x22ca03(0xeaf)]||'AI',_0x164c91=safeExtractMessageContent(_0x49f460);_0x40724f+='\x20-\x20'+_0x364f5a+':\x20'+_0x164c91[_0x22ca03(0x4b2)](0x0,0x14)+_0x22ca03(0x12da);}}else{if(typeof _0x230273[_0x22ca03(0x1423)]===_0x22ca03(0xb97))_0x40724f=_0x230273[_0x22ca03(0x1423)];else _0x230273[_0x22ca03(0xe5b)]?_0x40724f=_0x22ca03(0xff7):_0x40724f='[特殊消息]';}}currentReplyTo={'id':_0x230273['id'],'content':_0x40724f,'sender':_0x230273[_0x22ca03(0xf75)],'timestamp':_0x230273[_0x22ca03(0x7aa)],'senderName':getSenderDisplayName(_0x230273)};currentChatCharacter&&(chatReplyStates[currentChatCharacter['id']]={...currentReplyTo});showReplyPreview();const _0x3a7a02=document[_0x22ca03(0x566)](_0x22ca03(0x3c0));_0x3a7a02&&_0x3a7a02[_0x22ca03(0x1b12)]();}hideMessageMenu();}function getSenderDisplayName(_0x1871ec){const _0x5032e3=_0x2cf6d4;if(_0x1871ec[_0x5032e3(0xf75)]==='sent'){const _0x23981d=getCurrentChatSettings(),_0x5ab000=_0x23981d[_0x5032e3(0x433)]||_0x23981d[_0x5032e3(0x6a0)];if(_0x5ab000){const _0x1cbe41=personas[_0x5032e3(0x1aeb)](_0x3eac7a=>_0x3eac7a['id']===_0x5ab000);if(_0x1cbe41)return _0x1cbe41['name'];}return _0x23981d[_0x5032e3(0xb42)]||'我';}else{if(_0x1871ec[_0x5032e3(0xf75)]===_0x5032e3(0x232)){const _0x473fb8=groupChats['find'](_0x4f5821=>_0x4f5821['id']===currentChatCharacter['id']);if(_0x473fb8){let _0x95d117=null;if(_0x1871ec[_0x5032e3(0x210b)])_0x95d117=_0x473fb8[_0x5032e3(0xcaa)][_0x5032e3(0x1aeb)](_0x45de7f=>_0x45de7f['id']===_0x1871ec['senderId']);else _0x1871ec[_0x5032e3(0x222f)]&&(_0x95d117=_0x473fb8[_0x5032e3(0xcaa)]['find'](_0x370df4=>_0x370df4['name']===_0x1871ec[_0x5032e3(0x222f)]));return _0x95d117?.[_0x5032e3(0x222f)]||_0x5032e3(0xd61);}else{const _0x26c5f6=getCurrentChatSettings();return _0x26c5f6['aiChatNickname']||currentChatCharacter[_0x5032e3(0x222f)];}}}return'未知';}function showReplyPreview(){const _0x1095f8=_0x2cf6d4;if(!currentReplyTo)return;const _0x1fb948=document['getElementById']('reply-preview');_0x1fb948&&_0x1fb948[_0x1095f8(0x128)]();const _0x57da8e=document['createElement']('div');_0x57da8e['id']=_0x1095f8(0x30c),_0x57da8e[_0x1095f8(0x221)]=_0x1095f8(0x30c);const _0x45e32a=truncateText(currentReplyTo[_0x1095f8(0x1423)],0x19);_0x57da8e['innerHTML']=_0x1095f8(0x5df)+currentReplyTo[_0x1095f8(0xadb)]+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22reply-preview-message\x22>'+_0x45e32a+_0x1095f8(0xa18),_0x57da8e['style']['display']=_0x1095f8(0x2d4),_0x57da8e[_0x1095f8(0x655)]['visibility']=_0x1095f8(0x1e35);const _0x75779c=document[_0x1095f8(0x15b8)](_0x1095f8(0x13f6));if(_0x75779c){const _0x126273=_0x75779c['firstElementChild'];_0x126273?_0x75779c[_0x1095f8(0x1806)](_0x57da8e,_0x126273):_0x75779c[_0x1095f8(0x1925)](_0x57da8e);}}function cancelReply(){const _0x5b5319=_0x2cf6d4;currentReplyTo=null;currentChatCharacter&&delete chatReplyStates[currentChatCharacter['id']];const _0x1331b9=document['getElementById'](_0x5b5319(0x30c));_0x1331b9&&_0x1331b9[_0x5b5319(0x128)]();}function generateReplyHTML(_0x22eb02){const _0x666b7a=_0x2cf6d4;if(!_0x22eb02)return'';let _0x4543f7=truncateText(_0x22eb02[_0x666b7a(0x1423)],0x14);return _0x4543f7=processMentions(_0x4543f7),_0x666b7a(0x22e6)+_0x22eb02['senderName']+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22reply-reference-message\x22>'+_0x4543f7+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';}function copyMessage(_0x38511e=null){const _0xa35cea=_0x2cf6d4,_0x4831a9=_0x38511e||selectedMessageId;console[_0xa35cea(0xc0d)]('复制消息:',_0x4831a9,_0xa35cea(0x484),_0x38511e?_0xa35cea(0x156c):_0xa35cea(0x14e8));if(!_0x4831a9){console['log']('错误:\x20没有选中的消息ID');return;}const _0x2c119d=chatMessages[currentChatCharacter['id']]||[],_0x4ddb26=_0x2c119d['find'](_0x3740bd=>_0x3740bd['id']===_0x4831a9);if(_0x4ddb26){const _0x1a206f=safeExtractMessageContent(_0x4ddb26);navigator[_0xa35cea(0x10f0)][_0xa35cea(0x21be)](_0x1a206f)[_0xa35cea(0x1ccc)](()=>{const _0x56fb83=_0xa35cea;alert(_0x56fb83(0x10e3));})[_0xa35cea(0x9e5)](()=>{alert('复制失败，请重试');});}hideMessageMenu();}function showEditMessageModal(_0x57cfc1){const _0x231001=_0x2cf6d4;if(!_0x57cfc1)return;const _0x2827b6=chatMessages[currentChatCharacter['id']]||[],_0x3ff8cd=_0x2827b6[_0x231001(0x1aeb)](_0x332f23=>_0x332f23['id']===_0x57cfc1);if(!_0x3ff8cd){showToast(_0x231001(0x1ac0),_0x231001(0x24ab));return;}let _0x57809c='';try{_0x57809c=safeExtractMessageContent(_0x3ff8cd),_0x57809c[_0x231001(0x1cab)]('[')&&_0x57809c[_0x231001(0xd7e)](']')&&(_0x57809c=_0x231001(0xe6f),console[_0x231001(0x17cc)](_0x231001(0x1923),_0x3ff8cd));}catch(_0x47544b){console[_0x231001(0x24ab)](_0x231001(0x14b4),_0x47544b),_0x57809c=_0x231001(0xe6f);}const _0x7041f6=document[_0x231001(0x1ad8)](_0x231001(0x526));_0x7041f6[_0x231001(0x221)]='modal-overlay',_0x7041f6['id']=_0x231001(0x1844),_0x7041f6[_0x231001(0x655)][_0x231001(0x2526)]=_0x231001(0x1f0b);const _0x33390a=_0x3ff8cd[_0x231001(0xf75)]===_0x231001(0xfda)?'你':_0x3ff8cd[_0x231001(0x222f)]||currentChatCharacter['name'];_0x7041f6['innerHTML']=_0x231001(0x1c27)+_0x33390a+_0x231001(0x828)+formatTimestamp(_0x3ff8cd['timestamp'])+_0x231001(0xffb)+_0x57809c+_0x231001(0x2100)+_0x57809c[_0x231001(0xcbf)]+_0x231001(0x1a00)+(_0x3ff8cd[_0x231001(0xe5b)]?_0x231001(0x64c)+_0x3ff8cd['image']+_0x231001(0x17a2):'')+_0x231001(0x1c3c)+_0x57cfc1+_0x231001(0x1536),document['body'][_0x231001(0x1925)](_0x7041f6);const _0x5e42a2=document[_0x231001(0x566)](_0x231001(0x19d9)),_0x3bd725=document[_0x231001(0x566)](_0x231001(0xeee));_0x5e42a2[_0x231001(0x167)](_0x231001(0x627),function(){const _0x3be379=_0x231001;_0x3bd725[_0x3be379(0x21dc)]=this['value'][_0x3be379(0xcbf)];}),setTimeout(()=>{const _0x506551=_0x231001;_0x5e42a2[_0x506551(0x1b12)](),_0x5e42a2['setSelectionRange'](_0x5e42a2[_0x506551(0xc34)][_0x506551(0xcbf)],_0x5e42a2[_0x506551(0xc34)]['length']);},0x64);}function hideEditMessageModal(){const _0x50fd5a=_0x2cf6d4,_0x3cfa67=document[_0x50fd5a(0x566)](_0x50fd5a(0x1844));_0x3cfa67&&_0x3cfa67[_0x50fd5a(0x128)]();}async function saveEditedMessage(_0x552a5){const _0x186b29=_0x2cf6d4,_0x2de242=document['getElementById'](_0x186b29(0x19d9))[_0x186b29(0xc34)]['trim']();if(!_0x2de242){showToast(_0x186b29(0x23dc),_0x186b29(0x24ab));return;}const _0x3d2cdf=chatMessages[currentChatCharacter['id']]||[],_0x459da6=_0x3d2cdf[_0x186b29(0x23ba)](_0x17b83d=>_0x17b83d['id']===_0x552a5);if(_0x459da6!==-0x1){const _0x153d7e=_0x3d2cdf[_0x459da6][_0x186b29(0x1423)];typeof _0x2de242===_0x186b29(0xb97)?_0x3d2cdf[_0x459da6][_0x186b29(0x1423)]=_0x2de242:(console['warn']('编辑消息时检测到非字符串内容，强制转换为字符串:',_0x2de242),_0x3d2cdf[_0x459da6][_0x186b29(0x1423)]=String(_0x2de242));_0x3d2cdf[_0x459da6][_0x186b29(0x5c7)]=!![],_0x3d2cdf[_0x459da6][_0x186b29(0x249f)]=Date[_0x186b29(0x18e0)]();const _0x28a185={..._0x3d2cdf[_0x459da6],'content':String(_0x3d2cdf[_0x459da6][_0x186b29(0x1423)])};try{const _0x16dee3=await db[_0x186b29(0x464)][_0x186b29(0x4a6)]('characterId')[_0x186b29(0x14a)](currentChatCharacter['id'])[_0x186b29(0x1534)](_0x159cd6=>_0x159cd6[_0x186b29(0xc48)]===_0x3d2cdf[_0x459da6]['id'])[_0x186b29(0x2200)]();_0x16dee3&&(_0x16dee3[_0x186b29(0x1110)]=_0x28a185,await db[_0x186b29(0x464)]['put'](_0x16dee3),console[_0x186b29(0xc0d)](_0x186b29(0x13cc)));}catch(_0x506020){console['error'](_0x186b29(0x2232),_0x506020),saveChatMessages();}renderChatMessages(currentChatCharacter['id']),hideEditMessageModal(),showToast('消息已更新',_0x186b29(0xb27)),console[_0x186b29(0xc0d)](_0x186b29(0x1f18)+_0x153d7e+'\x22\x20->\x20\x22'+_0x2de242+'\x22');}else showToast(_0x186b29(0x1ac0),_0x186b29(0x24ab));}function removeMessageImage(){const _0x363d87=_0x2cf6d4;showToast('暂不支持移除图片',_0x363d87(0x2422));}function editMessage(){const _0x58f784=_0x2cf6d4;if(!selectedMessageId)return;showEditMessageModal(selectedMessageId),hideModal(_0x58f784(0x1433));}async function validateAvatarSource(_0x45a38c){const _0x456147=_0x2cf6d4;console['log'](_0x456147(0x1931),_0x45a38c);if(!_0x45a38c)return![];let _0x415b95=_0x45a38c;if(_0x45a38c===_0x456147(0xbb3)||_0x45a38c===_0x456147(0xbb3)||_0x45a38c===_0x456147(0xdaf)||_0x45a38c==='图片URL'){const _0x1d08a8=getRecentUserImage();if(_0x1d08a8)_0x415b95=_0x1d08a8,console[_0x456147(0xc0d)]('占位符替换为实际图片URL:',_0x415b95);else return console[_0x456147(0xc0d)]('没有找到用户发送的图片，验证失败'),![];}if(currentChatCharacter&&chatMessages[currentChatCharacter['id']]){const _0x2c26b3=[];chatMessages[currentChatCharacter['id']][_0x456147(0x803)](_0x2394d2=>_0x2394d2[_0x456147(0xf75)]===_0x456147(0xfda))['forEach'](_0x3ecb1d=>{const _0x1cd531=_0x456147;_0x3ecb1d[_0x1cd531(0xe5b)]&&_0x2c26b3[_0x1cd531(0x6ee)](_0x3ecb1d[_0x1cd531(0xe5b)]),Array[_0x1cd531(0x1bcc)](_0x3ecb1d[_0x1cd531(0x1423)])&&_0x3ecb1d['content'][_0x1cd531(0x900)](_0x1514b1=>{const _0x539f26=_0x1cd531;_0x1514b1[_0x539f26(0x23df)]===_0x539f26(0x1cfa)&&_0x1514b1['image_url']&&_0x1514b1['image_url'][_0x539f26(0x10c6)]&&_0x2c26b3[_0x539f26(0x6ee)](_0x1514b1[_0x539f26(0x1cfa)][_0x539f26(0x10c6)]);});}),console[_0x456147(0xc0d)]('用户发送的图片列表:',_0x2c26b3),console[_0x456147(0xc0d)](_0x456147(0x1dc5),_0x2c26b3[_0x456147(0x23ec)](_0x415b95));if(_0x2c26b3[_0x456147(0x23ec)](_0x415b95))return console[_0x456147(0xc0d)]('头像来源验证通过：用户发送的图片'),!![];}const _0x37cc25=getCurrentChatSettings();if(_0x37cc25['worldbookMountEnabled']&&_0x37cc25[_0x456147(0xefa)])for(const _0x58250f of _0x37cc25[_0x456147(0xefa)]){const _0x1ed259=worldbooks['find'](_0x4e1a72=>_0x4e1a72['id']===_0x58250f);if(_0x1ed259&&_0x1ed259[_0x456147(0x1423)]&&_0x1ed259[_0x456147(0x1423)][_0x456147(0x23ec)](_0x415b95))return console[_0x456147(0xc0d)]('头像来源验证通过：世界书中的URL'),!![];}return console[_0x456147(0xc0d)](_0x456147(0x448)),![];}async function changeCharacterAvatarByAI(_0x5a96bc,_0x3dd11d=''){const _0x67caba=_0x2cf6d4;if(!currentChatCharacter||!_0x5a96bc)return![];try{const _0x4338f7=getCurrentChatSettings();let _0x5c4acf=_0x5a96bc;if(_0x5a96bc['startsWith']('data:image'))try{_0x5c4acf=await compressImage(_0x5a96bc,0xc8,0.7),console[_0x67caba(0xc0d)](_0x67caba(0x1da));}catch(_0x57ff70){console[_0x67caba(0x17cc)](_0x67caba(0x2ce),_0x57ff70);}!chatSettings[currentChatCharacter['id']]&&(chatSettings[currentChatCharacter['id']]={});chatSettings[currentChatCharacter['id']]['aiChatAvatar']=_0x5c4acf,console[_0x67caba(0xc0d)]('聊天头像已更新：',{'characterId':currentChatCharacter['id'],'characterName':currentChatCharacter[_0x67caba(0x222f)],'avatarUrl':_0x5c4acf['substring'](0x0,0x32)+_0x67caba(0x12da),'settingsSnapshot':{'aiChatAvatar':!!chatSettings[currentChatCharacter['id']][_0x67caba(0x23e0)]}}),await saveChatSettings();const _0x5531fa={'id':Date[_0x67caba(0x18e0)]()[_0x67caba(0x9a3)](),'sender':_0x67caba(0x212),'content':currentChatCharacter[_0x67caba(0x222f)]+_0x67caba(0x1472)+(_0x3dd11d?':\x20'+_0x3dd11d:''),'timestamp':Date['now'](),'isAvatarChange':!![]};!chatMessages[currentChatCharacter['id']]&&(chatMessages[currentChatCharacter['id']]=[]);chatMessages[currentChatCharacter['id']]['push'](_0x5531fa);try{await saveChatMessagesImmediate([currentChatCharacter['id']]),console[_0x67caba(0xc0d)](_0x67caba(0x24df));}catch(_0x4cd4d0){console['error'](_0x67caba(0xcd9),_0x4cd4d0),await saveChatMessages();}return renderChatMessages(currentChatCharacter['id']),forceRefreshAvatars(),console[_0x67caba(0xc0d)]('角色\x20'+currentChatCharacter[_0x67caba(0x222f)]+_0x67caba(0x1963)),!![];}catch(_0x44dfcd){return console[_0x67caba(0x24ab)](_0x67caba(0x1405),_0x44dfcd),![];}return![];}async function deleteMessage(_0x2e769f=null){const _0xec4d43=_0x2cf6d4,_0x5cf171=_0x2e769f||selectedMessageId;console[_0xec4d43(0xc0d)](_0xec4d43(0x1e81),_0x5cf171,'来源:',_0x2e769f?_0xec4d43(0x156c):_0xec4d43(0x14e8));if(!_0x5cf171){console['log']('错误:\x20没有选中的消息ID');return;}const _0x3081b9=chatMessages[currentChatCharacter['id']]||[],_0x172b29=_0x3081b9[_0xec4d43(0x23ba)](_0x26312f=>_0x26312f['id']===_0x5cf171);if(_0x172b29===-0x1){hideMessageMenu();return;}const _0xb6543f=_0x3081b9[_0x172b29];if(confirm(_0xec4d43(0xda0))){try{await deleteRelatedTimelineEvents(_0xb6543f),console['log']('✅\x20已清理撤回消息的相关时间线记录');}catch(_0x351827){console[_0xec4d43(0x24ab)]('删除时间线记录失败:',_0x351827);}await _internalRecallMessage(currentChatCharacter['id'],_0xb6543f);}hideMessageMenu();}async function checkStorageUsage(){const _0x49d768=_0x2cf6d4;try{if(_0x49d768(0x1408)in navigator&&_0x49d768(0xed4)in navigator[_0x49d768(0x1408)]){const _0x1e738c=await navigator[_0x49d768(0x1408)][_0x49d768(0xed4)](),_0x214874=(_0x1e738c[_0x49d768(0x1ad6)]||0x0)/(0x400*0x400),_0x49be4f=(_0x1e738c[_0x49d768(0xb86)]||0x0)/(0x400*0x400),_0x310aea=_0x49be4f>0x0?_0x214874/_0x49be4f*0x64:0x0;return{'usedMB':_0x214874,'quotaMB':_0x49be4f,'usagePercent':_0x310aea,'needCleanup':_0x310aea>0x50};}}catch(_0xf103a5){console[_0x49d768(0x17cc)](_0x49d768(0xa9),_0xf103a5);}return null;}async function performSmartDataCleanup(){const _0x5dc565=_0x2cf6d4;try{const _0x3971ba=await db[_0x5dc565(0x464)][_0x5dc565(0x1902)](_0x5dc565(0x7aa))['toArray']();if(_0x3971ba[_0x5dc565(0xcbf)]>0x1388){const _0x334341=_0x3971ba[_0x5dc565(0x136)](0x0,_0x3971ba[_0x5dc565(0xcbf)]-0xbb8),_0x17ccd2=_0x334341[_0x5dc565(0xf6d)](_0x11846a=>_0x11846a['id']);await db[_0x5dc565(0x464)][_0x5dc565(0xf71)](_0x17ccd2),console[_0x5dc565(0xc0d)](_0x5dc565(0x1e99)+_0x17ccd2[_0x5dc565(0xcbf)]+_0x5dc565(0x600));}}catch(_0x2fa8a4){console[_0x5dc565(0x24ab)]('数据清理失败:',_0x2fa8a4);}}async function _internalRecallMessage(_0x2ca5b4,_0x3e275e){const _0x13ed3c=_0x2cf6d4,_0x51d091=chatMessages[_0x2ca5b4]||[],_0x4bea74=_0x51d091['findIndex'](_0x104ca5=>_0x104ca5['id']===_0x3e275e['id']);if(_0x4bea74===-0x1){console['error'](_0x13ed3c(0x22eb),_0x3e275e);return;}if(_0x3e275e[_0x13ed3c(0x1dfd)]||_0x3e275e['type']===_0x13ed3c(0x1e4b)){console[_0x13ed3c(0x17cc)](_0x13ed3c(0x7c4),_0x3e275e['id']);return;}const _0x248b34=document['querySelector'](_0x13ed3c(0x64f)+_0x3e275e['id']+'\x22]');_0x248b34&&(console[_0x13ed3c(0xc0d)](_0x13ed3c(0xa47)),_0x248b34['style'][_0x13ed3c(0x4ce)]=_0x13ed3c(0x243f),await new Promise(_0x48a7fb=>setTimeout(_0x48a7fb,0x1f4)));try{const _0x416fbb=await db[_0x13ed3c(0x464)][_0x13ed3c(0x4a6)](_0x13ed3c(0x10df))['equals'](_0x2ca5b4)[_0x13ed3c(0x1534)](_0x408464=>_0x408464[_0x13ed3c(0xc48)]===_0x3e275e['id'])['first']();if(_0x416fbb){const _0x582ad7=safeExtractMessageContent(_0x3e275e),_0x8ef7e6=_0x3e275e[_0x13ed3c(0xf75)]===_0x13ed3c(0xfda)?'你':currentChatCharacter['name']||'对方';_0x416fbb[_0x13ed3c(0x1110)]={..._0x416fbb['messageData'],'sender':_0x13ed3c(0x212),'type':_0x13ed3c(0x1e4b),'content':_0x8ef7e6+_0x13ed3c(0x23e9)+_0x582ad7,'originalContent':_0x582ad7,'isRecalled':!![]},await db[_0x13ed3c(0x464)][_0x13ed3c(0x53a)](_0x416fbb),console[_0x13ed3c(0xc0d)](_0x13ed3c(0xb61));}}catch(_0x1ef6d8){console[_0x13ed3c(0x24ab)]('数据库更新失败，回退到传统方式:',_0x1ef6d8);}const _0x348b49=safeExtractMessageContent(_0x3e275e),_0x4e7ccd=_0x3e275e[_0x13ed3c(0xf75)]===_0x13ed3c(0xfda)?'你':currentChatCharacter[_0x13ed3c(0x222f)]||'对方';_0x51d091[_0x4bea74]={'id':_0x3e275e['id'],'sender':_0x13ed3c(0x212),'type':_0x13ed3c(0x1e4b),'content':_0x4e7ccd+_0x13ed3c(0x23e9)+_0x348b49,'originalContent':_0x348b49,'timestamp':_0x3e275e[_0x13ed3c(0x7aa)],'isRecalled':!![]};if(_0x248b34){const _0x4c240d=_0x3e275e[_0x13ed3c(0xf75)]===_0x13ed3c(0xfda)?'你':currentChatCharacter['name']||'对方',_0x4d88ff=safeExtractMessageContent(_0x3e275e),_0x3ce49d=document[_0x13ed3c(0x1ad8)]('div');_0x3ce49d['style'][_0x13ed3c(0x2526)]='flex',_0x3ce49d[_0x13ed3c(0x655)]['justifyContent']=_0x13ed3c(0x23a1),_0x3ce49d[_0x13ed3c(0x655)][_0x13ed3c(0x1bf7)]=_0x13ed3c(0x23dd),_0x3ce49d[_0x13ed3c(0x1f26)][_0x13ed3c(0x61f)]=_0x3e275e['id'];const _0x388d3b=document[_0x13ed3c(0x1ad8)](_0x13ed3c(0x526));_0x388d3b['className']=_0x13ed3c(0x11af),_0x388d3b['textContent']=_0x4c240d+_0x13ed3c(0x1249);const _0x3d19d8=document[_0x13ed3c(0x1ad8)]('div');_0x3d19d8[_0x13ed3c(0x221)]=_0x13ed3c(0x7a8),_0x3d19d8['textContent']='原文：'+_0x4d88ff,_0x388d3b[_0x13ed3c(0x1925)](_0x3d19d8),_0x3ce49d[_0x13ed3c(0x1925)](_0x388d3b),_0x248b34[_0x13ed3c(0xe9)]['replaceChild'](_0x3ce49d,_0x248b34),addMessageLongPressListener(_0x3ce49d,_0x3e275e['id']);}else console[_0x13ed3c(0x17cc)](_0x13ed3c(0x2152)),renderChatMessages(_0x2ca5b4);renderMessageList(),console[_0x13ed3c(0xc0d)](_0x13ed3c(0x8d7)+_0x2ca5b4+'\x20的消息\x20'+_0x3e275e['id']+_0x13ed3c(0x651));}function formatTime(_0x43bd89){const _0xc0f3c1=_0x2cf6d4,_0x1024bf=new Date(_0x43bd89),_0x3725e5=_0x1024bf[_0xc0f3c1(0x1471)]()[_0xc0f3c1(0x9a3)]()['padStart'](0x2,'0'),_0x5b7066=_0x1024bf[_0xc0f3c1(0x21c6)]()[_0xc0f3c1(0x9a3)]()[_0xc0f3c1(0x863)](0x2,'0');return _0x3725e5+':'+_0x5b7066;}function formatTimestamp(_0x58792c){const _0x20cb0d=_0x2cf6d4,_0x2b5446=new Date(_0x58792c),_0x5d191f=new Date(),_0x5892ee=new Date(_0x5d191f['getFullYear'](),_0x5d191f['getMonth'](),_0x5d191f[_0x20cb0d(0x1d02)]()),_0xc8868e=new Date(_0x5892ee[_0x20cb0d(0xa57)]()-0x18*0x3c*0x3c*0x3e8),_0x41260d=new Date(_0x2b5446[_0x20cb0d(0x885)](),_0x2b5446[_0x20cb0d(0x17f3)](),_0x2b5446[_0x20cb0d(0x1d02)]()),_0x20fa77=_0x2b5446[_0x20cb0d(0x1471)]()[_0x20cb0d(0x9a3)]()[_0x20cb0d(0x863)](0x2,'0'),_0x3045e1=_0x2b5446[_0x20cb0d(0x21c6)]()[_0x20cb0d(0x9a3)]()[_0x20cb0d(0x863)](0x2,'0'),_0x3167ac=_0x20fa77+':'+_0x3045e1;if(_0x41260d[_0x20cb0d(0xa57)]()===_0x5892ee['getTime']())return _0x3167ac;else{if(_0x41260d[_0x20cb0d(0xa57)]()===_0xc8868e[_0x20cb0d(0xa57)]())return _0x20cb0d(0xaae)+_0x3167ac;else{const _0x4b1283=(_0x2b5446[_0x20cb0d(0x17f3)]()+0x1)['toString']()[_0x20cb0d(0x863)](0x2,'0'),_0x39b0fe=_0x2b5446[_0x20cb0d(0x1d02)]()[_0x20cb0d(0x9a3)]()[_0x20cb0d(0x863)](0x2,'0');return _0x4b1283+'月'+_0x39b0fe+'日\x20'+_0x3167ac;}}}function formatTimeOnly(_0x43eb19){const _0x4f8c4f=_0x2cf6d4,_0x416425=new Date(_0x43eb19),_0x3148ea=_0x416425[_0x4f8c4f(0x1471)]()['toString']()[_0x4f8c4f(0x863)](0x2,'0'),_0x514bda=_0x416425[_0x4f8c4f(0x21c6)]()[_0x4f8c4f(0x9a3)]()[_0x4f8c4f(0x863)](0x2,'0');return _0x3148ea+':'+_0x514bda;}function formatFullDate(_0x4e3341){const _0x492d29=_0x2cf6d4,_0xde9d6b=_0x4e3341[_0x492d29(0x885)](),_0x481500=(_0x4e3341[_0x492d29(0x17f3)]()+0x1)[_0x492d29(0x9a3)]()[_0x492d29(0x863)](0x2,'0'),_0x379102=_0x4e3341[_0x492d29(0x1d02)]()[_0x492d29(0x9a3)]()[_0x492d29(0x863)](0x2,'0'),_0x369b12=_0x4e3341[_0x492d29(0x1471)]()[_0x492d29(0x9a3)]()[_0x492d29(0x863)](0x2,'0'),_0x3c5a29=_0x4e3341[_0x492d29(0x21c6)]()[_0x492d29(0x9a3)]()[_0x492d29(0x863)](0x2,'0');return _0xde9d6b+'年'+_0x481500+'月'+_0x379102+'日\x20'+_0x369b12+':'+_0x3c5a29;}function loadUrl(){const _0x555b3a=_0x2cf6d4,_0x597034=document['getElementById'](_0x555b3a(0x1c7f))[_0x555b3a(0xc34)];let _0x4cea5a=_0x597034;!_0x597034[_0x555b3a(0x1cab)](_0x555b3a(0x1c85))&&!_0x597034['startsWith'](_0x555b3a(0x2403))&&(_0x4cea5a='https://'+_0x597034),document['getElementById'](_0x555b3a(0x6c8))['src']=_0x4cea5a;}async function saveApiSettings(){const _0x6b4181=_0x2cf6d4,_0x7ce1f6=document['getElementById'](_0x6b4181(0x165a))[_0x6b4181(0xc34)][_0x6b4181(0x1424)](),_0x4c4b04=document[_0x6b4181(0x566)](_0x6b4181(0x13a0))[_0x6b4181(0xc34)][_0x6b4181(0x1424)](),_0x18be45=document['getElementById']('model-select')[_0x6b4181(0xc34)][_0x6b4181(0x1424)](),_0x110f0a=parseFloat(document[_0x6b4181(0x566)]('temperature-slider')[_0x6b4181(0xc34)])||0.75,_0x25d0a3=document[_0x6b4181(0x566)](_0x6b4181(0x2479))['checked'];if(!_0x7ce1f6||!_0x4c4b04||!_0x18be45){showToast(_0x6b4181(0x17fa),_0x6b4181(0x24ab));return;}apiSettings={'base':_0x7ce1f6,'key':_0x4c4b04,'model':_0x18be45,'temperature':_0x110f0a,'emojiRecognitionEnabled':_0x25d0a3,'endpoint':_0x6b4181(0xb73)};try{await db[_0x6b4181(0x530)][_0x6b4181(0x53a)]({'id':_0x6b4181(0x9de),'settings':apiSettings}),localStorage[_0x6b4181(0x2055)](_0x6b4181(0x530),JSON[_0x6b4181(0x7fb)](apiSettings)),showToast(_0x6b4181(0x2286),'success'),console[_0x6b4181(0xc0d)]('🔧\x20[API设置]\x20已保存到IndexedDB和localStorage:',apiSettings);}catch(_0x47df0d){console[_0x6b4181(0x24ab)](_0x6b4181(0x1ba3),_0x47df0d),showToast('保存API设置失败:\x20'+_0x47df0d[_0x6b4181(0xd7a)],'error');return;}document['getElementById'](_0x6b4181(0x15a8))[_0x6b4181(0x21dc)]=_0x110f0a[_0x6b4181(0x3cd)](0x2);}function setGeminiDirect(){const _0x5a95ea=_0x2cf6d4;document[_0x5a95ea(0x566)](_0x5a95ea(0x165a))['value']=_0x5a95ea(0x1fb4),document[_0x5a95ea(0x566)](_0x5a95ea(0x13a0))[_0x5a95ea(0x729)]=_0x5a95ea(0x8da);const _0x5d2e50=document[_0x5a95ea(0x566)](_0x5a95ea(0x103a));_0x5d2e50[_0x5a95ea(0xc02)]=_0x5a95ea(0x1716),_0x5d2e50['onchange']=function(){const _0x5f2a97=_0x5a95ea;if(this['value']===_0x5f2a97(0x13cd)){const _0x4f1eb6=prompt('请输入Gemini模型名称\x0a\x0a常见选项：\x0a•\x20gemini-2.0-flash-exp\x0a•\x20gemini-1.5-flash\x0a•\x20gemini-1.5-pro\x0a•\x20gemini-pro');if(_0x4f1eb6&&_0x4f1eb6[_0x5f2a97(0x1424)]()){const _0x3bb15e=new Option(_0x4f1eb6['trim'](),_0x4f1eb6[_0x5f2a97(0x1424)]());this[_0x5f2a97(0x1806)](_0x3bb15e,this['lastElementChild']),this[_0x5f2a97(0xc34)]=_0x4f1eb6[_0x5f2a97(0x1424)]();}else this[_0x5f2a97(0xc34)]='';}},showToast('🌟\x20Gemini直连配置已自动填写！\x0a\x0a使用说明：\x0a1.\x20请在Google\x20AI\x20Studio获取API\x20Key\x0a2.\x20选择合适的模型\x0a3.\x20点击\x22测试连接\x22验证配置',_0x5a95ea(0xb27));}function setHuggingFaceProxy(){const _0x98c9d3=_0x2cf6d4;document[_0x98c9d3(0x566)](_0x98c9d3(0x165a))[_0x98c9d3(0xc34)]='https://xxx-xxx.hf.space/v1',document['getElementById'](_0x98c9d3(0x13a0))[_0x98c9d3(0x729)]='请输入HuggingFace的API\x20Token';const _0x2f4cdf=document[_0x98c9d3(0x566)](_0x98c9d3(0x103a));_0x2f4cdf[_0x98c9d3(0xc02)]=_0x98c9d3(0x1bff),_0x2f4cdf[_0x98c9d3(0x1889)]=function(){const _0x3bd65b=_0x98c9d3;if(this[_0x3bd65b(0xc34)]===_0x3bd65b(0x13a8)){const _0x3bbb8c=prompt(_0x3bd65b(0x252f));if(_0x3bbb8c&&_0x3bbb8c[_0x3bd65b(0x1424)]()){const _0x30891e=new Option(_0x3bbb8c['trim'](),_0x3bbb8c[_0x3bd65b(0x1424)]());this[_0x3bd65b(0x1806)](_0x30891e,this[_0x3bd65b(0x1cea)]),this[_0x3bd65b(0xc34)]=_0x3bbb8c[_0x3bd65b(0x1424)]();}else this[_0x3bd65b(0xc34)]='';}},showToast(_0x98c9d3(0x1b4b),_0x98c9d3(0xb27));}function saveCurrentConfig(){const _0x412079=_0x2cf6d4,_0x2251c9=document[_0x412079(0x566)](_0x412079(0x1bc5))[_0x412079(0xc34)][_0x412079(0x1424)]();if(!_0x2251c9){showToast(_0x412079(0xfa8),_0x412079(0x24ab));return;}const _0x39f4da={'name':_0x2251c9,'base':document['getElementById']('api-base')[_0x412079(0xc34)][_0x412079(0x1424)](),'key':document['getElementById']('api-key')['value'][_0x412079(0x1424)](),'model':document['getElementById'](_0x412079(0x103a))['value'][_0x412079(0x1424)](),'temperature':parseFloat(document[_0x412079(0x566)](_0x412079(0x7ae))['value'])||0.75,'emojiRecognitionEnabled':document[_0x412079(0x566)]('emoji-recognition-enabled')[_0x412079(0x306)],'savedAt':new Date()[_0x412079(0x133a)]()};let _0x7b65cc=JSON[_0x412079(0x168e)](localStorage['getItem']('savedApiConfigs')||'[]');const _0x3618ae=_0x7b65cc['findIndex'](_0x35746d=>_0x35746d[_0x412079(0x222f)]===_0x2251c9);if(_0x3618ae!==-0x1){if(confirm(_0x412079(0x20b5)+_0x2251c9+_0x412079(0xe87)))_0x7b65cc[_0x3618ae]=_0x39f4da;else return;}else _0x7b65cc[_0x412079(0x6ee)](_0x39f4da);localStorage[_0x412079(0x2055)](_0x412079(0x1c19),JSON[_0x412079(0x7fb)](_0x7b65cc)),document[_0x412079(0x566)]('config-name-input')[_0x412079(0xc34)]='',renderSavedConfigs(),showToast(_0x412079(0x20b5)+_0x2251c9+'\x22已保存','success');}function renderSavedConfigs(){const _0x18b4bb=_0x2cf6d4,_0x3f6652=document['getElementById'](_0x18b4bb(0x1810)),_0x13386f=document[_0x18b4bb(0x566)](_0x18b4bb(0x551)),_0x7ca5db=JSON[_0x18b4bb(0x168e)](localStorage[_0x18b4bb(0x2250)](_0x18b4bb(0x1c19))||'[]');if(_0x7ca5db[_0x18b4bb(0xcbf)]===0x0){_0x3f6652[_0x18b4bb(0x655)]['display']=_0x18b4bb(0xfe9),_0x13386f[_0x18b4bb(0x655)][_0x18b4bb(0x2526)]='block';return;}_0x3f6652[_0x18b4bb(0x655)][_0x18b4bb(0x2526)]=_0x18b4bb(0x6bb),_0x13386f['style']['display']='none',_0x3f6652[_0x18b4bb(0xc02)]=_0x7ca5db[_0x18b4bb(0xf6d)](_0x454a7c=>'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22config-card\x22\x20style=\x22background:\x20rgba(255,255,255,0.8);\x20border-radius:\x2012px;\x20padding:\x2015px;\x20border:\x201px\x20solid\x20rgba(0,0,0,0.05);\x20transition:\x20all\x200.3s\x20ease;\x20cursor:\x20pointer;\x22\x20onclick=\x22loadConfig(\x27'+_0x454a7c['name']+_0x18b4bb(0xe5d)+_0x454a7c['name']+_0x18b4bb(0xe57)+_0x454a7c[_0x18b4bb(0x222f)]+_0x18b4bb(0x1c46)+_0x454a7c['base']+_0x18b4bb(0xe9c)+_0x454a7c[_0x18b4bb(0xeea)]+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>🌡️\x20温度:\x20'+_0x454a7c[_0x18b4bb(0x2b0)]+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22font-size:\x2011px;\x20color:\x20#999;\x22>保存于:\x20'+_0x454a7c[_0x18b4bb(0x20cc)]+_0x18b4bb(0x24bf))['join']('');}function loadConfig(_0x33e16e){const _0x59c9a6=_0x2cf6d4,_0x2b99c3=JSON[_0x59c9a6(0x168e)](localStorage['getItem']('savedApiConfigs')||'[]'),_0x51072d=_0x2b99c3[_0x59c9a6(0x1aeb)](_0x1a420d=>_0x1a420d[_0x59c9a6(0x222f)]===_0x33e16e);if(!_0x51072d){showToast(_0x59c9a6(0x2df),_0x59c9a6(0x24ab));return;}document['getElementById'](_0x59c9a6(0x165a))['value']=_0x51072d[_0x59c9a6(0x90b)],document[_0x59c9a6(0x566)](_0x59c9a6(0x13a0))['value']=_0x51072d[_0x59c9a6(0x157f)],document[_0x59c9a6(0x566)](_0x59c9a6(0x7ae))['value']=_0x51072d['temperature'],document[_0x59c9a6(0x566)](_0x59c9a6(0x15a8))['textContent']=_0x51072d[_0x59c9a6(0x2b0)][_0x59c9a6(0x3cd)](0x2);const _0x401fc7=document[_0x59c9a6(0x566)](_0x59c9a6(0x103a)),_0x55e1cb=Array[_0x59c9a6(0x2308)](_0x401fc7[_0x59c9a6(0x32b)])['find'](_0x4265e7=>_0x4265e7[_0x59c9a6(0xc34)]===_0x51072d[_0x59c9a6(0xeea)]);if(!_0x55e1cb){const _0x256524=new Option(_0x51072d[_0x59c9a6(0xeea)],_0x51072d['model']);_0x401fc7[_0x59c9a6(0x1925)](_0x256524);}_0x401fc7[_0x59c9a6(0xc34)]=_0x51072d[_0x59c9a6(0xeea)];const _0xa179ba=document[_0x59c9a6(0x566)]('emoji-recognition-enabled');_0xa179ba&&(_0xa179ba['checked']=_0x51072d['emojiRecognitionEnabled']!==![]),showToast('已加载配置\x22'+_0x33e16e+'\x22',_0x59c9a6(0xb27));}function deleteConfig(_0x6b3cdb){const _0x2fd873=_0x2cf6d4;if(confirm('确定要删除配置\x22'+_0x6b3cdb+_0x2fd873(0x2032))){let _0x78b609=JSON[_0x2fd873(0x168e)](localStorage[_0x2fd873(0x2250)](_0x2fd873(0x1c19))||'[]');_0x78b609=_0x78b609['filter'](_0x54f76b=>_0x54f76b[_0x2fd873(0x222f)]!==_0x6b3cdb),localStorage[_0x2fd873(0x2055)](_0x2fd873(0x1c19),JSON[_0x2fd873(0x7fb)](_0x78b609)),renderSavedConfigs(),showToast(_0x2fd873(0x20b5)+_0x6b3cdb+_0x2fd873(0x1ae9),_0x2fd873(0xb27));}}function clearAllConfigs(){const _0x12ee9e=_0x2cf6d4;confirm(_0x12ee9e(0xef6))&&(localStorage[_0x12ee9e(0x1c95)](_0x12ee9e(0x1c19)),renderSavedConfigs(),showToast(_0x12ee9e(0x1a9f),_0x12ee9e(0xb27)));}async function testApiConnection(){const _0x484d0b=_0x2cf6d4,_0x2bd348=document[_0x484d0b(0x566)](_0x484d0b(0x165a))[_0x484d0b(0xc34)]['trim'](),_0x3c456f=document[_0x484d0b(0x566)](_0x484d0b(0x13a0))[_0x484d0b(0xc34)]['trim'](),_0x158e17=document['getElementById']('model-select')['value'][_0x484d0b(0x1424)]();if(!_0x2bd348||!_0x3c456f||!_0x158e17){showToast('请先填写完整的API配置',_0x484d0b(0x24ab));return;}const _0xd76733=document[_0x484d0b(0x566)]('test-api-connection-btn'),_0x4223b8=_0xd76733[_0x484d0b(0x21dc)];_0xd76733[_0x484d0b(0x21dc)]='测试中...',_0xd76733[_0x484d0b(0x194e)]=!![];try{let _0x5cc12d,_0xcbcc0e,_0x369fac;if(_0x2bd348[_0x484d0b(0x23ec)](_0x484d0b(0xad8)))_0x5cc12d=_0x2bd348+_0x484d0b(0x1f4e)+_0x158e17+':generateContent?key='+_0x3c456f,_0xcbcc0e={'contents':[{'parts':[{'text':'Hello'}]}],'generationConfig':{'temperature':0.7}},_0x369fac={'Content-Type':_0x484d0b(0x302)};else{if(_0x2bd348[_0x484d0b(0xd7e)]('/v1'))_0x5cc12d=_0x2bd348+'/chat/completions';else _0x2bd348['includes'](_0x484d0b(0x193c))?_0x5cc12d=_0x2bd348+_0x484d0b(0xb73):_0x5cc12d=_0x2bd348+'/v1/chat/completions';_0xcbcc0e={'model':_0x158e17,'messages':[{'role':'user','content':_0x484d0b(0x1fe0)}],'max_tokens':0xa},_0x369fac={'Content-Type':_0x484d0b(0x302),'Authorization':'Bearer\x20'+_0x3c456f};}const _0x3ed7f2=await fetch(_0x5cc12d,{'method':_0x484d0b(0x227d),'headers':_0x369fac,'body':JSON[_0x484d0b(0x7fb)](_0xcbcc0e)});if(_0x3ed7f2['ok']){showToast(_0x484d0b(0x1ec2),_0x484d0b(0xb27)),apiSettings={'base':_0x2bd348,'key':_0x3c456f,'model':_0x158e17,'temperature':parseFloat(document[_0x484d0b(0x566)]('temperature-slider')[_0x484d0b(0xc34)])||0.75,'endpoint':'/chat/completions'};try{await db['apiSettings'][_0x484d0b(0x53a)]({'id':'main','settings':apiSettings}),localStorage[_0x484d0b(0x2055)](_0x484d0b(0x530),JSON[_0x484d0b(0x7fb)](apiSettings)),console[_0x484d0b(0xc0d)](_0x484d0b(0x510));}catch(_0x317b10){console['error'](_0x484d0b(0xd1f),_0x317b10);}}else{const _0x50bd01=await _0x3ed7f2['text']();showToast(_0x484d0b(0xe05)+_0x3ed7f2[_0x484d0b(0xe54)]+'\x20'+_0x3ed7f2['statusText'],'error'),console[_0x484d0b(0x24ab)]('API测试失败:',_0x50bd01);}}catch(_0x3b178c){showToast(_0x484d0b(0x186c)+_0x3b178c[_0x484d0b(0xd7a)],_0x484d0b(0x24ab)),console[_0x484d0b(0x24ab)](_0x484d0b(0x229),_0x3b178c);}finally{_0xd76733[_0x484d0b(0x21dc)]=_0x4223b8,_0xd76733['disabled']=![];}}async function fetchModels(){const _0xc44123=_0x2cf6d4,_0x469e6f=document[_0xc44123(0x566)]('api-base')[_0xc44123(0xc34)][_0xc44123(0x1424)](),_0x5d4226=document[_0xc44123(0x566)](_0xc44123(0x13a0))[_0xc44123(0xc34)][_0xc44123(0x1424)]();if(!_0x469e6f||!_0x5d4226){showToast(_0xc44123(0x1b6f),'error');return;}const _0x36ec1c=document[_0xc44123(0x566)](_0xc44123(0x1d9f)),_0x5f0ca2=_0x36ec1c[_0xc44123(0x21dc)];_0x36ec1c[_0xc44123(0x21dc)]=_0xc44123(0x1efe),_0x36ec1c[_0xc44123(0x194e)]=!![];try{let _0x274933,_0x39e158;if(_0x469e6f[_0xc44123(0x23ec)](_0xc44123(0xad8)))_0x274933=_0x469e6f+_0xc44123(0x1825)+_0x5d4226,_0x39e158={};else{if(_0x469e6f[_0xc44123(0xd7e)]('/v1'))_0x274933=_0x469e6f+_0xc44123(0x14bf);else _0x469e6f[_0xc44123(0x23ec)](_0xc44123(0x193c))?_0x274933=_0x469e6f+'/models':_0x274933=_0x469e6f+_0xc44123(0x274);_0x39e158={'Authorization':'Bearer\x20'+_0x5d4226};}const _0x56b62c=await fetch(_0x274933,{'headers':_0x39e158});if(!_0x56b62c['ok'])throw new Error(_0xc44123(0x22d8)+_0x56b62c[_0xc44123(0xe54)]+':\x20'+_0x56b62c[_0xc44123(0x1e30)]);const _0x5a7564=await _0x56b62c[_0xc44123(0x2318)](),_0x5c52d9=document[_0xc44123(0x566)](_0xc44123(0x103a));_0x5c52d9[_0xc44123(0xc02)]=_0xc44123(0x20a7);let _0x112a44=[];if(_0x5a7564[_0xc44123(0x29c)])console['log']('Gemini\x20API响应数据:',_0x5a7564),_0x112a44=_0x5a7564[_0xc44123(0x29c)][_0xc44123(0x803)](_0xba293d=>{const _0x45102e=_0xc44123;return _0xba293d['name']&&(_0xba293d[_0x45102e(0x222f)][_0x45102e(0x23ec)]('gemini')||_0xba293d[_0x45102e(0x222f)][_0x45102e(0x23ec)](_0x45102e(0x1866))||_0xba293d[_0x45102e(0x915)]?.[_0x45102e(0x23ec)]('generateContent')||_0xba293d[_0x45102e(0x222f)][_0x45102e(0x23ec)]('generate'));})[_0xc44123(0xf6d)](_0xf37861=>{const _0x303a29=_0xc44123,_0x654fa1=_0xf37861[_0x303a29(0x222f)][_0x303a29(0x23ec)]('/')?_0xf37861[_0x303a29(0x222f)][_0x303a29(0x633)]('/')[_0x303a29(0x1d5d)]():_0xf37861[_0x303a29(0x222f)];return _0x654fa1;}),_0x112a44[_0xc44123(0xcbf)]===0x0&&_0x5a7564[_0xc44123(0x29c)][_0xc44123(0xcbf)]>0x0&&(console[_0xc44123(0xc0d)](_0xc44123(0x89d),_0x5a7564[_0xc44123(0x29c)]),_0x112a44=_0x5a7564['models'][_0xc44123(0xf6d)](_0x20cf53=>_0x20cf53[_0xc44123(0x222f)][_0xc44123(0x23ec)]('/')?_0x20cf53[_0xc44123(0x222f)]['split']('/')[_0xc44123(0x1d5d)]():_0x20cf53[_0xc44123(0x222f)]));else _0x5a7564[_0xc44123(0x4f2)]&&(_0x112a44=_0x5a7564[_0xc44123(0x4f2)][_0xc44123(0xf6d)](_0x5d3867=>_0x5d3867['id']));_0x112a44[_0xc44123(0x900)](_0x5566a9=>{const _0x3775e0=new Option(_0x5566a9,_0x5566a9);_0x5c52d9['appendChild'](_0x3775e0);}),showToast('✅\x20成功获取到\x20'+_0x112a44[_0xc44123(0xcbf)]+_0xc44123(0x35c),_0xc44123(0xb27));}catch(_0x413b71){let _0x32151a=_0x413b71[_0xc44123(0xd7a)];(_0x32151a['includes'](_0xc44123(0xea8))||_0x32151a[_0xc44123(0x23ec)]('ERR_TIMED_OUT'))&&(_0x469e6f[_0xc44123(0x23ec)](_0xc44123(0x1fda))?_0x32151a=_0xc44123(0x1f8c):_0x32151a=_0xc44123(0x62a));showToast(_0xc44123(0x7fc)+_0x32151a,_0xc44123(0x24ab)),console[_0xc44123(0x24ab)]('获取模型失败:',_0x413b71);if(_0x469e6f[_0xc44123(0x23ec)](_0xc44123(0xad8))){const _0x43ff60=document['getElementById'](_0xc44123(0x103a));_0x43ff60[_0xc44123(0xc02)]=_0xc44123(0x1199),setTimeout(()=>{const _0x3ce09f=_0xc44123;showToast(_0x3ce09f(0x14de),_0x3ce09f(0x2422));},0x3e8);}_0x469e6f[_0xc44123(0x23ec)](_0xc44123(0x1fda))&&setTimeout(()=>{const _0x5bdc4f=_0xc44123;showToast(_0x5bdc4f(0x1c2c),'info');},0x7d0);}finally{_0x36ec1c[_0xc44123(0x21dc)]=_0x5f0ca2,_0x36ec1c[_0xc44123(0x194e)]=![];}}function exportFullBackup(){const _0xc23a1d=_0x2cf6d4;showToast(_0xc23a1d(0xc1d),_0xc23a1d(0x2422));}function importFullBackup(){const _0x4235fa=_0x2cf6d4;document[_0x4235fa(0x566)](_0x4235fa(0x1b92))[_0x4235fa(0x1e62)]();}async function initializeApiSettings(){await loadApiSettingsToForm(),renderSavedConfigs();}async function loadApiSettingsToForm(){const _0x512a08=_0x2cf6d4;try{const _0x2768bf=await db[_0x512a08(0x530)][_0x512a08(0x46a)](_0x512a08(0x9de));let _0x355aef=null;if(_0x2768bf)_0x355aef=_0x2768bf[_0x512a08(0x1fbb)];else{const _0x2f6d52=localStorage[_0x512a08(0x2250)](_0x512a08(0x530));_0x2f6d52&&(_0x355aef=JSON[_0x512a08(0x168e)](_0x2f6d52),await db[_0x512a08(0x530)][_0x512a08(0x53a)]({'id':_0x512a08(0x9de),'settings':_0x355aef}),console[_0x512a08(0xc0d)](_0x512a08(0x2012)));}if(_0x355aef){console[_0x512a08(0xc0d)]('🔧\x20[API设置]\x20加载已保存的API设置:',_0x355aef);if(_0x355aef[_0x512a08(0x90b)]){const _0x10d1b6=document[_0x512a08(0x566)](_0x512a08(0x165a));if(_0x10d1b6)_0x10d1b6[_0x512a08(0xc34)]=_0x355aef[_0x512a08(0x90b)];}if(_0x355aef[_0x512a08(0x157f)]){const _0x543bc5=document['getElementById'](_0x512a08(0x13a0));if(_0x543bc5)_0x543bc5[_0x512a08(0xc34)]=_0x355aef[_0x512a08(0x157f)];}if(_0x355aef[_0x512a08(0x2b0)]!==undefined){const _0x45ee37=document[_0x512a08(0x566)]('temperature-slider'),_0x259177=document['getElementById'](_0x512a08(0x15a8));_0x45ee37&&_0x259177&&(_0x45ee37[_0x512a08(0xc34)]=_0x355aef['temperature'],_0x259177[_0x512a08(0x21dc)]=_0x355aef[_0x512a08(0x2b0)][_0x512a08(0x3cd)](0x2));}const _0x2de272=document[_0x512a08(0x566)](_0x512a08(0x2479));_0x2de272&&(_0x2de272[_0x512a08(0x306)]=_0x355aef['emojiRecognitionEnabled']!==![]);if(_0x355aef['base']&&_0x355aef[_0x512a08(0x157f)])console[_0x512a08(0xc0d)](_0x512a08(0x8c7)),setTimeout(()=>{const _0x7c9959=_0x512a08;fetchModels()[_0x7c9959(0x1ccc)](()=>{const _0x2f2096=_0x7c9959;if(_0x355aef[_0x2f2096(0xeea)]){const _0x201c0a=document[_0x2f2096(0x566)]('model-select');if(_0x201c0a){const _0x590781=Array['from'](_0x201c0a['options'])[_0x2f2096(0x1aeb)](_0x485918=>_0x485918[_0x2f2096(0xc34)]===_0x355aef['model']);if(!_0x590781){const _0x37bc4e=new Option(_0x355aef[_0x2f2096(0xeea)],_0x355aef['model']);_0x201c0a[_0x2f2096(0x1925)](_0x37bc4e);}_0x201c0a[_0x2f2096(0xc34)]=_0x355aef[_0x2f2096(0xeea)],console['log']('🔧\x20[API设置]\x20已自动选中保存的模型:',_0x355aef['model']);}}})[_0x7c9959(0x9e5)](_0x57dadf=>{const _0x17395b=_0x7c9959;console[_0x17395b(0xc0d)](_0x17395b(0x456));if(_0x355aef['model']){const _0x18bfa0=document['getElementById'](_0x17395b(0x103a));if(_0x18bfa0){const _0x2e882b=Array[_0x17395b(0x2308)](_0x18bfa0[_0x17395b(0x32b)])['find'](_0x3c093e=>_0x3c093e[_0x17395b(0xc34)]===_0x355aef[_0x17395b(0xeea)]);if(!_0x2e882b){const _0x1335b6=new Option(_0x355aef[_0x17395b(0xeea)],_0x355aef['model']);_0x18bfa0['appendChild'](_0x1335b6);}_0x18bfa0[_0x17395b(0xc34)]=_0x355aef[_0x17395b(0xeea)],console['log'](_0x17395b(0x52f),_0x355aef[_0x17395b(0xeea)]);}}});},0x1f4);else{if(_0x355aef['model']){const _0x3ae85f=document['getElementById'](_0x512a08(0x103a));if(_0x3ae85f){const _0x135c60=Array['from'](_0x3ae85f[_0x512a08(0x32b)])[_0x512a08(0x1aeb)](_0x369621=>_0x369621['value']===_0x355aef[_0x512a08(0xeea)]);if(!_0x135c60){const _0x214db4=new Option(_0x355aef['model'],_0x355aef[_0x512a08(0xeea)]);_0x3ae85f[_0x512a08(0x1925)](_0x214db4);}_0x3ae85f[_0x512a08(0xc34)]=_0x355aef['model'],console[_0x512a08(0xc0d)](_0x512a08(0x211c),_0x355aef[_0x512a08(0xeea)]);}}}}}catch(_0xe6ca0){console[_0x512a08(0x24ab)](_0x512a08(0x1abc),_0xe6ca0);}}async function initBatteryManager(){setFixedBatteryDisplay();}function setFixedBatteryDisplay(){const _0x149049=_0x2cf6d4,_0x1d4a1f=0x64,_0x1cc81=document[_0x149049(0x566)](_0x149049(0x1309));if(_0x1cc81){const _0x51b6c3=_0x1cc81[_0x149049(0x15b8)]('.battery-level');_0x51b6c3&&(_0x51b6c3[_0x149049(0x655)][_0x149049(0xaab)]=_0x1d4a1f+'%'),_0x1cc81[_0x149049(0x226e)][_0x149049(0x128)]('charging');}const _0x5e8f49=document[_0x149049(0x1ed9)](_0x149049(0x36a)),_0x2ca8e7=document[_0x149049(0x1ed9)](_0x149049(0x1fc4));_0x2ca8e7[_0x149049(0x900)](_0x239eb2=>{const _0x5dad1d=_0x149049;_0x239eb2[_0x5dad1d(0x655)]['width']=_0x1d4a1f+'%';}),_0x5e8f49['forEach'](_0x5d76f2=>{const _0x468220=_0x149049;_0x5d76f2['classList'][_0x468220(0x128)](_0x468220(0x1bd1));});}function testBatteryDisplay(){const _0x524122=_0x2cf6d4;console[_0x524122(0xc0d)](_0x524122(0x11b6)),setFixedBatteryDisplay(),console[_0x524122(0xc0d)]('电池显示已设置为固定100%电量（满电）');}async function changeTheme(_0x57aa10){const _0x33359e=_0x2cf6d4,_0x350248=document[_0x33359e(0x172c)];clearCustomThemeStyles(),clearGlobalCustomTheme(),_0x350248[_0x33359e(0x226e)][_0x33359e(0x128)](_0x33359e(0x1058)),_0x350248[_0x33359e(0x10b3)]('data-theme');_0x57aa10!==_0x33359e(0xbf)&&_0x350248[_0x33359e(0x1dd4)]('data-theme',_0x57aa10);try{await db[_0x33359e(0x397)][_0x33359e(0x53a)]({'id':_0x33359e(0x219c),'settingName':_0x33359e(0x219c),'settingValue':_0x57aa10,'timestamp':Date['now']()});}catch(_0x2ee161){console[_0x33359e(0x24ab)]('❌\x20保存主题设置失败:',_0x2ee161);}const _0x515ca7={'default':_0x33359e(0x1fe3),'cute':_0x33359e(0x574),'dark':_0x33359e(0xdc3)};showToast(_0x33359e(0x1450)+_0x515ca7[_0x57aa10]+'\x20主题！',_0x33359e(0xb27));}let customThemeData={'chatTopBg':null,'chatBottomBg':null,'buttons':{'back':null,'offline':null,'settings':null,'expand':null,'continue':null,'send':null},'globalTopAppBar':null,'globalBottomAppBar':null,'globalBackButton':null,'globalAddButton':null,'globalBg':null,'scope':_0x2cf6d4(0x876),'selectedChats':[]},currentUploadType=null,currentUploadCallback=null,currentButtonType=null;function switchCustomThemeTab(_0x43ab46){const _0x4f7058=_0x2cf6d4;document[_0x4f7058(0x1ed9)](_0x4f7058(0x174))['forEach'](_0x3fe621=>{const _0x178b1f=_0x4f7058;_0x3fe621[_0x178b1f(0x226e)][_0x178b1f(0x128)]('active');}),document['querySelectorAll'](_0x4f7058(0x3be))['forEach'](_0x2cf5ff=>{const _0xfe3411=_0x4f7058;_0x2cf5ff['style'][_0xfe3411(0x2526)]=_0xfe3411(0xfe9);}),document['querySelector'](_0x4f7058(0xd8c)+_0x43ab46+'\x27)\x22]')[_0x4f7058(0x226e)][_0x4f7058(0xe1)](_0x4f7058(0x105d));if(_0x43ab46===_0x4f7058(0x23b3))document['getElementById'](_0x4f7058(0x2156))[_0x4f7058(0x655)][_0x4f7058(0x2526)]=_0x4f7058(0x2d4),loadChatSelectionList();else _0x43ab46===_0x4f7058(0x3d8)&&(document[_0x4f7058(0x566)]('global-theme-content')[_0x4f7058(0x655)]['display']=_0x4f7058(0x2d4));}function uploadChatTopBackground(){const _0x110fad=_0x2cf6d4;showImageUploadChoice(_0x110fad(0x88b),_0x110fad(0x22ca));}function uploadChatBottomBackground(){const _0xd3f296=_0x2cf6d4;showImageUploadChoice('chat-bottom-bg',_0xd3f296(0x11fa));}function uploadButtonIcon(_0x134315){const _0x15a316=_0x2cf6d4;currentButtonType=_0x134315;const _0xddbc02={'back':_0x15a316(0x1ead),'offline':_0x15a316(0x2212),'settings':_0x15a316(0x20a9),'expand':'功能区展开按钮','continue':'续写按钮','send':'发送消息按钮'};showImageUploadChoice(_0x15a316(0x1835)+_0x134315,'选择'+_0xddbc02[_0x134315]+'样式来源');}function showImageUploadChoice(_0xb54476,_0x4c36cf,_0x5f1022){const _0x37c779=_0x2cf6d4;currentUploadType=_0xb54476,currentUploadCallback=_0x5f1022,document['getElementById'](_0x37c779(0x82d))[_0x37c779(0x21dc)]=_0x4c36cf||_0x37c779(0x1ff1),showModal('image-upload-choice-modal');}function chooseLocalUpload(){const _0x23cefd=_0x2cf6d4;hideModal(_0x23cefd(0xd20));switch(currentUploadType){case _0x23cefd(0x146a):document[_0x23cefd(0x566)]('global-top-app-bar-input')[_0x23cefd(0x1e62)]();break;case _0x23cefd(0x10e5):document[_0x23cefd(0x566)](_0x23cefd(0x2015))[_0x23cefd(0x1e62)]();break;case _0x23cefd(0x1812):document['getElementById']('global-back-button-input')[_0x23cefd(0x1e62)]();break;case'global-add-button':document['getElementById']('global-add-button-input')[_0x23cefd(0x1e62)]();break;case'global-bg':document[_0x23cefd(0x566)](_0x23cefd(0xbee))[_0x23cefd(0x1e62)]();break;case _0x23cefd(0x88b):document['getElementById'](_0x23cefd(0x191e))['click']();break;case _0x23cefd(0x195a):document[_0x23cefd(0x566)](_0x23cefd(0x21db))[_0x23cefd(0x1e62)]();break;case'button-back':case _0x23cefd(0x1507):case _0x23cefd(0x116f):case _0x23cefd(0xf4c):case _0x23cefd(0x156b):case _0x23cefd(0xa5f):document[_0x23cefd(0x566)](_0x23cefd(0x1254))[_0x23cefd(0x1e62)]();break;default:currentUploadCallback&&currentUploadCallback(_0x23cefd(0x443));break;}}function chooseUrlUpload(){const _0x27e2c1=_0x2cf6d4;hideModal('image-upload-choice-modal'),document[_0x27e2c1(0x566)](_0x27e2c1(0x187b))[_0x27e2c1(0xc34)]='',document[_0x27e2c1(0x566)]('url-preview')['style'][_0x27e2c1(0x2526)]=_0x27e2c1(0xfe9),document[_0x27e2c1(0x566)](_0x27e2c1(0x1719))[_0x27e2c1(0x21dc)]='输入'+getUploadTypeTitle(currentUploadType)+_0x27e2c1(0xa35),showModal(_0x27e2c1(0x16c));const _0x1b3d57=document[_0x27e2c1(0x566)](_0x27e2c1(0x187b));_0x1b3d57['oninput']=function(){const _0x2759cd=_0x27e2c1,_0x292f01=this[_0x2759cd(0xc34)][_0x2759cd(0x1424)]();_0x292f01&&isValidImageUrl(_0x292f01)?showUrlPreview(_0x292f01):hideUrlPreview();};}function getUploadTypeTitle(_0x1bb64f){const _0x3e89f0=_0x2cf6d4,_0x546d25={'global-top-app-bar':_0x3e89f0(0x1c11),'global-bottom-app-bar':_0x3e89f0(0xece),'global-back-button':_0x3e89f0(0x1ead),'global-add-button':_0x3e89f0(0x982),'global-bg':_0x3e89f0(0x942),'chat-top-bg':'聊天顶部背景','chat-bottom-bg':'聊天底部背景','button-back':_0x3e89f0(0x1ead),'button-offline':_0x3e89f0(0x2212),'button-settings':_0x3e89f0(0x20a9),'button-expand':_0x3e89f0(0x132f),'button-continue':_0x3e89f0(0xe76),'button-send':_0x3e89f0(0x21cc)};return _0x546d25[_0x1bb64f]||'图片';}function isValidImageUrl(_0x514240){const _0x50f694=_0x2cf6d4;try{const _0x27807d=new URL(_0x514240),_0x9a155b=['i.postimg.cc',_0x50f694(0x19d7),'i.ibb.co','i.imgur.com',_0x50f694(0x18f2),'media.discordapp.net'],_0x34926a=_0x27807d['hostname'],_0x5c792d=_0x27807d[_0x50f694(0x205c)]['toLowerCase'](),_0x14d55b=[_0x50f694(0x19d6),_0x50f694(0x101c),_0x50f694(0x1050),_0x50f694(0x12f2),_0x50f694(0xbeb),_0x50f694(0x15c7)];return _0x9a155b[_0x50f694(0x23ec)](_0x34926a)||_0x14d55b[_0x50f694(0x184b)](_0x3591b8=>_0x5c792d['endsWith'](_0x3591b8));}catch{return![];}}function showUrlPreview(_0x50c7d3){const _0x184b1b=_0x2cf6d4,_0x478a4f=document[_0x184b1b(0x566)](_0x184b1b(0x1ad4)),_0x4c546b=document[_0x184b1b(0x566)](_0x184b1b(0xde0));_0x4c546b[_0x184b1b(0xc28)]=function(){const _0x26fa85=_0x184b1b;_0x478a4f[_0x26fa85(0x655)]['display']=_0x26fa85(0x2d4);},_0x4c546b[_0x184b1b(0x1795)]=function(){const _0x20fcb9=_0x184b1b;hideUrlPreview(),showToast(_0x20fcb9(0x335),_0x20fcb9(0x24ab));},_0x4c546b[_0x184b1b(0x107)]=_0x50c7d3;}function hideUrlPreview(){const _0x2126ee=_0x2cf6d4;document[_0x2126ee(0x566)](_0x2126ee(0x1ad4))[_0x2126ee(0x655)]['display']=_0x2126ee(0xfe9);}function confirmUrlUpload(){const _0x54533d=_0x2cf6d4,_0x44a3ae=document[_0x54533d(0x566)](_0x54533d(0x187b))[_0x54533d(0xc34)][_0x54533d(0x1424)]();if(!_0x44a3ae){showToast(_0x54533d(0x103),_0x54533d(0x13bb));return;}if(!isValidImageUrl(_0x44a3ae)){showToast(_0x54533d(0x17de),'warning');return;}hideModal('url-input-modal'),handleUrlUpload(_0x44a3ae);}function handleUrlUpload(_0x4caa84){const _0x50da47=_0x2cf6d4;switch(currentUploadType){case _0x50da47(0x146a):customThemeData[_0x50da47(0x1b38)]=_0x4caa84,updatePreview(_0x50da47(0x1f7a),_0x4caa84),updateThemeItemStatus(_0x50da47(0x14c3),!![]),showToast(_0x50da47(0x598),_0x50da47(0xb27));break;case _0x50da47(0x10e5):customThemeData['globalBottomAppBar']=_0x4caa84,updatePreview('global-bottom-app-bar-preview',_0x4caa84),updateThemeItemStatus(_0x50da47(0x8b0),!![]),showToast(_0x50da47(0xbca),_0x50da47(0xb27));break;case _0x50da47(0x1812):customThemeData[_0x50da47(0x1641)]=_0x4caa84,updatePreview(_0x50da47(0x1ac2),_0x4caa84),updateThemeItemStatus('global-back-button-item',!![]),showToast(_0x50da47(0x2097),_0x50da47(0xb27));break;case _0x50da47(0x1924):customThemeData[_0x50da47(0x218a)]=_0x4caa84,updatePreview(_0x50da47(0x1a0c),_0x4caa84),updateThemeItemStatus(_0x50da47(0x201b),!![]),showToast('全局添加按钮样式已设置','success');break;case'global-bg':customThemeData[_0x50da47(0xa22)]=_0x4caa84,updatePreview('global-bg-preview',_0x4caa84),updateThemeItemStatus('global-bg-item',!![]),showToast(_0x50da47(0x228),_0x50da47(0xb27));break;case'chat-top-bg':customThemeData['chatTopBg']=_0x4caa84,updatePreview(_0x50da47(0x150a),_0x4caa84),updateThemeItemStatus(_0x50da47(0x756),!![]),showToast(_0x50da47(0xb2b),'success');break;case _0x50da47(0x195a):customThemeData[_0x50da47(0x295)]=_0x4caa84,updatePreview(_0x50da47(0x14d0),_0x4caa84),updateThemeItemStatus(_0x50da47(0xaf1),!![]),showToast(_0x50da47(0x1435),_0x50da47(0xb27));break;case _0x50da47(0x20d8):customThemeData[_0x50da47(0x13d7)][_0x50da47(0x23cf)]=_0x4caa84,updatePreview(_0x50da47(0x1de3),_0x4caa84),updateThemeItemStatus(_0x50da47(0x234a),!![]),showToast(_0x50da47(0x15b7),'success');break;case _0x50da47(0x1507):customThemeData[_0x50da47(0x13d7)][_0x50da47(0x1685)]=_0x4caa84,updatePreview(_0x50da47(0x110b),_0x4caa84),updateThemeItemStatus(_0x50da47(0x22d1),!![]),showToast(_0x50da47(0x2545),'success');break;case _0x50da47(0x116f):customThemeData[_0x50da47(0x13d7)][_0x50da47(0x1fbb)]=_0x4caa84,updatePreview(_0x50da47(0xf9f),_0x4caa84),updateThemeItemStatus('settings-btn-item',!![]),showToast(_0x50da47(0x20c5),'success');break;case _0x50da47(0xf4c):customThemeData[_0x50da47(0x13d7)]['expand']=_0x4caa84,updatePreview(_0x50da47(0x1975),_0x4caa84),updateThemeItemStatus(_0x50da47(0x1174),!![]),showToast(_0x50da47(0x1a96),_0x50da47(0xb27));break;case'button-continue':customThemeData[_0x50da47(0x13d7)][_0x50da47(0x18d9)]=_0x4caa84,updatePreview(_0x50da47(0xf2),_0x4caa84),updateThemeItemStatus(_0x50da47(0x195b),!![]),showToast(_0x50da47(0xbc7),_0x50da47(0xb27));break;case _0x50da47(0xa5f):customThemeData[_0x50da47(0x13d7)]['send']=_0x4caa84,updatePreview(_0x50da47(0x1e93),_0x4caa84),updateThemeItemStatus('send-btn-item',!![]),showToast(_0x50da47(0x670),_0x50da47(0xb27));break;default:currentUploadCallback&&currentUploadCallback(_0x50da47(0x10c6),_0x4caa84);break;}}function uploadGlobalTopAppBar(){const _0x45f4d5=_0x2cf6d4;showImageUploadChoice(_0x45f4d5(0x146a),_0x45f4d5(0x234));}function uploadGlobalBottomAppBar(){const _0x12d903=_0x2cf6d4;showImageUploadChoice(_0x12d903(0x10e5),_0x12d903(0x37e));}function uploadGlobalBackButton(){const _0x4b0962=_0x2cf6d4;showImageUploadChoice(_0x4b0962(0x1812),_0x4b0962(0x312));}function uploadGlobalAddButton(){const _0x49f3b3=_0x2cf6d4;showImageUploadChoice(_0x49f3b3(0x1924),_0x49f3b3(0x1a73));}function uploadGlobalBackground(){const _0x1589a6=_0x2cf6d4;showImageUploadChoice(_0x1589a6(0x2030),_0x1589a6(0x256b));}function handleChatTopBgUpload(_0x454d43){const _0x4a4468=_0x2cf6d4,_0x45ac09=_0x454d43[_0x4a4468(0x1144)][_0x4a4468(0x173e)][0x0];if(_0x45ac09){const _0x1bbe4b=new FileReader();_0x1bbe4b[_0x4a4468(0xc28)]=function(_0x3f7082){const _0x26b3b1=_0x4a4468;customThemeData[_0x26b3b1(0xd51)]=_0x3f7082['target'][_0x26b3b1(0x1fff)],updatePreview('chat-top-bg-preview',_0x3f7082[_0x26b3b1(0x1144)][_0x26b3b1(0x1fff)]),updateThemeItemStatus(_0x26b3b1(0x756),!![]),showToast(_0x26b3b1(0x18c1),_0x26b3b1(0xb27));},_0x1bbe4b[_0x4a4468(0x145e)](_0x45ac09);}}function handleChatBottomBgUpload(_0x4d166f){const _0x5e18c3=_0x2cf6d4,_0x1a48ad=_0x4d166f[_0x5e18c3(0x1144)][_0x5e18c3(0x173e)][0x0];if(_0x1a48ad){const _0x4bfce9=new FileReader();_0x4bfce9[_0x5e18c3(0xc28)]=function(_0xa55eab){const _0x19d762=_0x5e18c3;customThemeData['chatBottomBg']=_0xa55eab['target'][_0x19d762(0x1fff)],updatePreview('chat-bottom-bg-preview',_0xa55eab[_0x19d762(0x1144)][_0x19d762(0x1fff)]),updateThemeItemStatus('chat-bottom-bg-item',!![]),showToast(_0x19d762(0x1585),_0x19d762(0xb27));},_0x4bfce9['readAsDataURL'](_0x1a48ad);}}function handleButtonIconUpload(_0x3a2ef9){const _0x49fb85=_0x2cf6d4,_0x5ed1d4=_0x3a2ef9[_0x49fb85(0x1144)][_0x49fb85(0x173e)][0x0];if(_0x5ed1d4&&currentButtonType){const _0x175e1f=new FileReader();_0x175e1f[_0x49fb85(0xc28)]=function(_0x5693c7){const _0x5795f0=_0x49fb85;customThemeData[_0x5795f0(0x13d7)][currentButtonType]=_0x5693c7[_0x5795f0(0x1144)]['result'],updatePreview(currentButtonType+_0x5795f0(0x10d9),_0x5693c7[_0x5795f0(0x1144)][_0x5795f0(0x1fff)]),updateThemeItemStatus(currentButtonType+_0x5795f0(0x241a),!![]);const _0xf2dd00={'back':_0x5795f0(0x1ead),'offline':_0x5795f0(0x2212),'settings':'聊天设置按钮','expand':_0x5795f0(0x132f),'continue':_0x5795f0(0xe76),'send':_0x5795f0(0x21cc)};showToast(_0xf2dd00[currentButtonType]+_0x5795f0(0x1aa6),_0x5795f0(0xb27)),currentButtonType=null;},_0x175e1f[_0x49fb85(0x145e)](_0x5ed1d4);}}function updateThemeItemStatus(_0x1fd221,_0x49ece1){const _0x3306ea=_0x2cf6d4,_0x2db3e7=document['getElementById'](_0x1fd221);if(!_0x2db3e7)return;const _0x2a0c6c=_0x2db3e7[_0x3306ea(0x15b8)](_0x3306ea(0x1b21));_0x49ece1?(_0x2db3e7[_0x3306ea(0x226e)][_0x3306ea(0xe1)](_0x3306ea(0x1c67)),_0x2a0c6c&&(_0x2a0c6c[_0x3306ea(0x655)][_0x3306ea(0x2526)]=_0x3306ea(0x1f0b))):(_0x2db3e7[_0x3306ea(0x226e)]['remove']('theme-item-configured'),_0x2a0c6c&&(_0x2a0c6c['style'][_0x3306ea(0x2526)]=_0x3306ea(0xfe9)));}function clearAllThemeItemStatus(){const _0x526e0f=_0x2cf6d4,_0x4de13e=document[_0x526e0f(0x1ed9)](_0x526e0f(0x9ad));_0x4de13e['forEach'](_0x1cf21d=>{const _0x35235c=_0x526e0f;_0x1cf21d[_0x35235c(0x226e)][_0x35235c(0x128)](_0x35235c(0x1c67));const _0x53a7af=_0x1cf21d[_0x35235c(0x15b8)]('.theme-item-status');_0x53a7af&&(_0x53a7af[_0x35235c(0x655)][_0x35235c(0x2526)]='none');});}function handleGlobalTopAppBarUpload(_0x2163db){const _0x565b8e=_0x2cf6d4,_0x4243b8=_0x2163db['target'][_0x565b8e(0x173e)][0x0];if(_0x4243b8){const _0x124255=new FileReader();_0x124255[_0x565b8e(0xc28)]=function(_0x244b96){const _0x312509=_0x565b8e;customThemeData[_0x312509(0x1b38)]=_0x244b96[_0x312509(0x1144)][_0x312509(0x1fff)],updatePreview('global-top-app-bar-preview',_0x244b96[_0x312509(0x1144)][_0x312509(0x1fff)]),updateThemeItemStatus(_0x312509(0x14c3),!![]),console['log']('🎨\x20全局顶部应用栏背景已上传:',_0x244b96[_0x312509(0x1144)]['result']),showToast(_0x312509(0x4a1),_0x312509(0xb27));},_0x124255['readAsDataURL'](_0x4243b8);}}function handleGlobalBottomAppBarUpload(_0xed3616){const _0x36c931=_0x2cf6d4,_0x108758=_0xed3616[_0x36c931(0x1144)][_0x36c931(0x173e)][0x0];if(_0x108758){const _0x308826=new FileReader();_0x308826[_0x36c931(0xc28)]=function(_0xa57f5a){const _0x4436c2=_0x36c931;customThemeData['globalBottomAppBar']=_0xa57f5a[_0x4436c2(0x1144)]['result'],updatePreview(_0x4436c2(0x1aa5),_0xa57f5a[_0x4436c2(0x1144)]['result']),updateThemeItemStatus('global-bottom-app-bar-item',!![]),showToast(_0x4436c2(0x20f5),_0x4436c2(0xb27));},_0x308826[_0x36c931(0x145e)](_0x108758);}}function handleGlobalBackButtonUpload(_0x36df27){const _0xaf4c51=_0x2cf6d4,_0x24289f=_0x36df27[_0xaf4c51(0x1144)][_0xaf4c51(0x173e)][0x0];if(_0x24289f){const _0x1640a0=new FileReader();_0x1640a0['onload']=function(_0x20acbd){const _0x329c27=_0xaf4c51;customThemeData[_0x329c27(0x1641)]=_0x20acbd['target'][_0x329c27(0x1fff)],updatePreview(_0x329c27(0x1ac2),_0x20acbd['target'][_0x329c27(0x1fff)]),updateThemeItemStatus(_0x329c27(0x26b),!![]),showToast(_0x329c27(0xe42),'success');},_0x1640a0[_0xaf4c51(0x145e)](_0x24289f);}}function handleGlobalAddButtonUpload(_0x58a261){const _0x27bf95=_0x2cf6d4,_0x20051f=_0x58a261['target'][_0x27bf95(0x173e)][0x0];if(_0x20051f){const _0x132077=new FileReader();_0x132077[_0x27bf95(0xc28)]=function(_0x27e988){const _0x33538c=_0x27bf95;customThemeData[_0x33538c(0x218a)]=_0x27e988['target']['result'],updatePreview(_0x33538c(0x1a0c),_0x27e988['target'][_0x33538c(0x1fff)]),updateThemeItemStatus('global-add-button-item',!![]),showToast(_0x33538c(0x1eb1),'success');},_0x132077[_0x27bf95(0x145e)](_0x20051f);}}function handleGlobalBgUpload(_0x52a6ea){const _0x377aeb=_0x2cf6d4,_0x6fb447=_0x52a6ea[_0x377aeb(0x1144)]['files'][0x0];if(_0x6fb447){const _0x2ae4e2=new FileReader();_0x2ae4e2['onload']=function(_0x3de02a){const _0x42932c=_0x377aeb;customThemeData[_0x42932c(0xa22)]=_0x3de02a[_0x42932c(0x1144)][_0x42932c(0x1fff)],updatePreview('global-bg-preview',_0x3de02a[_0x42932c(0x1144)][_0x42932c(0x1fff)]),updateThemeItemStatus(_0x42932c(0x2014),!![]),showToast(_0x42932c(0x22af),_0x42932c(0xb27));},_0x2ae4e2[_0x377aeb(0x145e)](_0x6fb447);}}function clearGlobalThemeCache(){const _0x635da6=_0x2cf6d4;globalThemeCache=null,globalThemeCacheTime=0x0,console['log'](_0x635da6(0xa4));}async function saveAndApplyGlobalTheme(){const _0x1f2c3a=_0x2cf6d4;try{const _0x10d570={'globalTopAppBar':customThemeData[_0x1f2c3a(0x1b38)],'globalBottomAppBar':customThemeData[_0x1f2c3a(0x2501)],'globalBackButton':customThemeData['globalBackButton'],'globalAddButton':customThemeData[_0x1f2c3a(0x218a)],'globalBg':customThemeData[_0x1f2c3a(0xa22)]};await db[_0x1f2c3a(0x113)]['put']({'id':_0x1f2c3a(0x3d8),'themeType':_0x1f2c3a(0x3d8),'themeData':_0x10d570,'timestamp':Date['now']()}),clearGlobalThemeCache(),applyGlobalCustomTheme(_0x10d570),console[_0x1f2c3a(0xc0d)](_0x1f2c3a(0x15d));}catch(_0x233c3b){console[_0x1f2c3a(0x24ab)](_0x1f2c3a(0x1056),_0x233c3b),showToast(_0x1f2c3a(0xdf6),_0x1f2c3a(0x24ab));}}let globalThemeCache=null,globalThemeCacheTime=0x0;const GLOBAL_THEME_CACHE_DURATION=0x7530,imagePreloadCache=new Map(),MAX_IMAGE_CACHE_SIZE=0x32;function preloadImage(_0x14feb4){return new Promise((_0x4fb568,_0x4fe9ce)=>{const _0x3f5c5c=_0x3a81;if(imagePreloadCache[_0x3f5c5c(0x1af1)](_0x14feb4)){_0x4fb568(imagePreloadCache['get'](_0x14feb4));return;}const _0x1095af=new Image();_0x1095af['onload']=()=>{const _0x5ebcce=_0x3f5c5c;if(imagePreloadCache[_0x5ebcce(0x41a)]>=MAX_IMAGE_CACHE_SIZE){const _0x36dd0f=imagePreloadCache['keys']()[_0x5ebcce(0x15d3)]()[_0x5ebcce(0xc34)];imagePreloadCache[_0x5ebcce(0xc2b)](_0x36dd0f);}imagePreloadCache[_0x5ebcce(0x21c0)](_0x14feb4,_0x1095af),_0x4fb568(_0x1095af);},_0x1095af[_0x3f5c5c(0x1795)]=()=>{const _0x4a8f55=_0x3f5c5c;console[_0x4a8f55(0x17cc)](_0x4a8f55(0x55f),_0x14feb4),_0x4fe9ce(new Error(_0x4a8f55(0x726)+_0x14feb4));},_0x1095af[_0x3f5c5c(0x107)]=_0x14feb4;});}async function applyGlobalCustomTheme(_0x1404b0=null){const _0x3ec33a=_0x2cf6d4,_0x47f3df=document[_0x3ec33a(0x1788)];if(!_0x1404b0){const _0x2873c0=Date[_0x3ec33a(0x18e0)]();if(globalThemeCache&&_0x2873c0-globalThemeCacheTime<GLOBAL_THEME_CACHE_DURATION)_0x1404b0=globalThemeCache,console[_0x3ec33a(0xc0d)](_0x3ec33a(0x519));else try{const _0x465487=await db[_0x3ec33a(0x113)][_0x3ec33a(0x46a)](_0x3ec33a(0x3d8));if(_0x465487&&_0x465487['themeData'])_0x1404b0=_0x465487[_0x3ec33a(0x2e5)],globalThemeCache=_0x1404b0,globalThemeCacheTime=_0x2873c0,console[_0x3ec33a(0xc0d)](_0x3ec33a(0x1251));else{console[_0x3ec33a(0xc0d)](_0x3ec33a(0xb71));return;}}catch(_0x2bfa0e){console[_0x3ec33a(0x24ab)]('❌\x20加载全局主题数据失败:',_0x2bfa0e);return;}}clearGlobalCustomTheme();const _0x4db9e4=[];if(_0x1404b0['globalTopAppBar'])_0x4db9e4['push'](_0x1404b0[_0x3ec33a(0x1b38)]);if(_0x1404b0['globalBottomAppBar'])_0x4db9e4['push'](_0x1404b0[_0x3ec33a(0x2501)]);if(_0x1404b0[_0x3ec33a(0x1641)])_0x4db9e4[_0x3ec33a(0x6ee)](_0x1404b0[_0x3ec33a(0x1641)]);if(_0x1404b0[_0x3ec33a(0x218a)])_0x4db9e4[_0x3ec33a(0x6ee)](_0x1404b0[_0x3ec33a(0x218a)]);if(_0x1404b0[_0x3ec33a(0xa22)])_0x4db9e4[_0x3ec33a(0x6ee)](_0x1404b0[_0x3ec33a(0xa22)]);try{await Promise['all'](_0x4db9e4[_0x3ec33a(0xf6d)](_0x17d0f2=>preloadImage(_0x17d0f2))),console[_0x3ec33a(0xc0d)](_0x3ec33a(0x763));}catch(_0x46a0dc){console[_0x3ec33a(0x17cc)](_0x3ec33a(0x178f),_0x46a0dc);}const _0x3dc3eb=new Set();_0x1404b0['globalTopAppBar']&&(_0x47f3df['style'][_0x3ec33a(0x16db)](_0x3ec33a(0x1d5a),_0x3ec33a(0xcb5)+_0x1404b0[_0x3ec33a(0x1b38)]+')'),_0x3dc3eb[_0x3ec33a(0xe1)](_0x3ec33a(0x1962)),console['log'](_0x3ec33a(0x1a06),'url('+_0x1404b0['globalTopAppBar']+')'));_0x1404b0[_0x3ec33a(0x2501)]&&(_0x47f3df[_0x3ec33a(0x655)][_0x3ec33a(0x16db)]('--custom-global-bottom-app-bar',_0x3ec33a(0xcb5)+_0x1404b0[_0x3ec33a(0x2501)]+')'),_0x3dc3eb[_0x3ec33a(0xe1)](_0x3ec33a(0x8ef)));_0x1404b0[_0x3ec33a(0x1641)]&&(_0x47f3df[_0x3ec33a(0x655)][_0x3ec33a(0x16db)](_0x3ec33a(0x165b),_0x3ec33a(0xcb5)+_0x1404b0[_0x3ec33a(0x1641)]+')'),_0x3dc3eb[_0x3ec33a(0xe1)]('back-button'));_0x1404b0[_0x3ec33a(0x218a)]&&(_0x47f3df[_0x3ec33a(0x655)]['setProperty'](_0x3ec33a(0x2445),_0x3ec33a(0xcb5)+_0x1404b0[_0x3ec33a(0x218a)]+')'),_0x3dc3eb['add'](_0x3ec33a(0x13dd)));_0x1404b0[_0x3ec33a(0xa22)]&&(_0x47f3df[_0x3ec33a(0x655)][_0x3ec33a(0x16db)](_0x3ec33a(0x64b),'url('+_0x1404b0[_0x3ec33a(0xa22)]+')'),_0x3dc3eb['add']('bg'));const _0x497852=[_0x3ec33a(0x1962),_0x3ec33a(0x8ef),_0x3ec33a(0x74f),_0x3ec33a(0x13dd),'bg'];_0x497852[_0x3ec33a(0x900)](_0x25178c=>{const _0x345408=_0x3ec33a;_0x3dc3eb['has'](_0x25178c)?document[_0x345408(0x172c)][_0x345408(0x1dd4)](_0x345408(0x1ee4)+_0x25178c,_0x345408(0x8f1)):document['body'][_0x345408(0x10b3)]('data-has-custom-global-'+_0x25178c);}),document[_0x3ec33a(0x172c)]['classList'][_0x3ec33a(0xe1)](_0x3ec33a(0x1058)),console[_0x3ec33a(0xc0d)](_0x3ec33a(0x243c)),console[_0x3ec33a(0xc0d)](_0x3ec33a(0xee2),_0x3dc3eb),console['log']('🎨\x20body类名:',document[_0x3ec33a(0x172c)][_0x3ec33a(0x221)]),console[_0x3ec33a(0xc0d)]('🎨\x20body属性:',Array[_0x3ec33a(0x2308)](document[_0x3ec33a(0x172c)][_0x3ec33a(0x2278)])[_0x3ec33a(0xf6d)](_0x914ec4=>_0x914ec4['name']+'=\x22'+_0x914ec4['value']+'\x22'));}function clearGlobalCustomTheme(){const _0x3d8c0c=_0x2cf6d4;console[_0x3d8c0c(0xc0d)](_0x3d8c0c(0xc68));const _0x362a98=document['documentElement'],_0x59de16=['--custom-global-top-app-bar',_0x3d8c0c(0x2558),_0x3d8c0c(0x165b),_0x3d8c0c(0x2445),_0x3d8c0c(0x64b)];_0x59de16[_0x3d8c0c(0x900)](_0x13a86=>{const _0x1c6dea=_0x3d8c0c;_0x362a98[_0x1c6dea(0x655)]['removeProperty'](_0x13a86);});const _0x3958dd=[_0x3d8c0c(0x1962),_0x3d8c0c(0x8ef),_0x3d8c0c(0x74f),_0x3d8c0c(0x13dd),'bg'];_0x3958dd['forEach'](_0x2469ea=>{const _0x9af88e=_0x3d8c0c;document['body'][_0x9af88e(0x10b3)]('data-has-custom-global-'+_0x2469ea);}),console[_0x3d8c0c(0xc0d)](_0x3d8c0c(0x2133));}function updatePreview(_0x5f386f,_0x6fa897){const _0xe16afc=_0x2cf6d4,_0x37b71c=document[_0xe16afc(0x566)](_0x5f386f);_0x37b71c&&(_0x37b71c[_0xe16afc(0x655)][_0xe16afc(0x1584)]=_0xe16afc(0xcb5)+_0x6fa897+')',_0x37b71c['classList']['add'](_0xe16afc(0x1d41)));}function loadChatSelectionList(){const _0x10de99=_0x2cf6d4,_0x477ec2=document[_0x10de99(0x566)]('chat-selection-list');if(!_0x477ec2)return;const _0xffbdd9=[];characters&&characters[_0x10de99(0xcbf)]>0x0&&contacts&&contacts['length']>0x0&&characters['forEach'](_0x8b6898=>{const _0x3a8f96=_0x10de99;contacts['includes'](_0x8b6898['id'])&&_0xffbdd9[_0x3a8f96(0x6ee)]({'id':_0x8b6898['id'],'name':_0x8b6898['name'],'avatarUrl':_0x8b6898[_0x3a8f96(0x10f9)],'isGroup':![]});});groupChats&&groupChats[_0x10de99(0xcbf)]>0x0&&groupChats['forEach'](_0x22d587=>{const _0x107790=_0x10de99;_0xffbdd9[_0x107790(0x6ee)]({'id':_0x22d587['id'],'name':_0x22d587[_0x107790(0x222f)],'avatarUrl':_0x22d587[_0x107790(0x10f9)],'isGroup':!![]});});console['log'](_0x10de99(0x26e)),console['log'](_0x10de99(0xcd1),characters?.['length']||0x0),console[_0x10de99(0xc0d)]('\x20\x20-\x20活跃联系人数量:',contacts?.[_0x10de99(0xcbf)]||0x0),console[_0x10de99(0xc0d)](_0x10de99(0x140b),groupChats?.['length']||0x0),console['log']('\x20\x20-\x20总聊天对象:',_0xffbdd9);let _0x170a04='';_0xffbdd9[_0x10de99(0x900)](_0x209aa9=>{const _0xcedcba=_0x10de99,_0x1f4d7d=customThemeData[_0xcedcba(0x2233)]['includes'](_0x209aa9['id']),_0x21962c=_0x209aa9[_0xcedcba(0x10f9)]?_0xcedcba(0x1910)+_0x209aa9[_0xcedcba(0x10f9)]+')':'';let _0x57ab36=_0x209aa9[_0xcedcba(0x4b7)]?_0xcedcba(0x47e):'fas\x20fa-user';_0x170a04+=_0xcedcba(0x20a)+(_0x1f4d7d?_0xcedcba(0x876):'')+_0xcedcba(0x1240)+_0x209aa9['id']+_0xcedcba(0x106f)+(_0x1f4d7d?_0xcedcba(0x1ee5):'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-selection-avatar\x22\x20style=\x22'+_0x21962c+_0xcedcba(0x1496)+(!_0x209aa9[_0xcedcba(0x10f9)]?_0xcedcba(0xbd5)+_0x57ab36+'\x22></i>':'')+_0xcedcba(0x2263)+_0x209aa9[_0xcedcba(0x222f)]+_0xcedcba(0x1b8f)+(_0x209aa9[_0xcedcba(0x4b7)]?'群聊':'私聊')+_0xcedcba(0x1379);}),_0x170a04===''&&(_0x170a04=_0x10de99(0x22b8)),_0x477ec2[_0x10de99(0xc02)]=_0x170a04;}function toggleChatSelection(_0x47dcd2){const _0x44a9f7=_0x2cf6d4,_0x36e913=customThemeData[_0x44a9f7(0x2233)][_0x44a9f7(0x167a)](_0x47dcd2);_0x36e913>-0x1?customThemeData[_0x44a9f7(0x2233)][_0x44a9f7(0x220f)](_0x36e913,0x1):customThemeData[_0x44a9f7(0x2233)][_0x44a9f7(0x6ee)](_0x47dcd2),loadChatSelectionList();}document[_0x2cf6d4(0x167)](_0x2cf6d4(0x7f7),function(){const _0x44cf6c=_0x2cf6d4;document[_0x44cf6c(0x167)]('click',function(_0x1c8b24){const _0x3bc203=_0x44cf6c;if(_0x1c8b24[_0x3bc203(0x1144)][_0x3bc203(0x2026)](_0x3bc203(0x783))){const _0x3995d0=_0x1c8b24['target'][_0x3bc203(0x2026)](_0x3bc203(0x783)),_0x401729=_0x3995d0[_0x3bc203(0x1f26)][_0x3bc203(0x231)];document[_0x3bc203(0x1ed9)](_0x3bc203(0x783))[_0x3bc203(0x900)](_0x5b36c7=>{const _0x1e8066=_0x3bc203;_0x5b36c7[_0x1e8066(0x226e)][_0x1e8066(0x128)](_0x1e8066(0x105d));}),_0x3995d0[_0x3bc203(0x226e)][_0x3bc203(0xe1)]('active'),customThemeData[_0x3bc203(0x231)]=_0x401729;const _0x7d22a6=document[_0x3bc203(0x566)](_0x3bc203(0xf65));_0x7d22a6&&(_0x401729==='selected'?(_0x7d22a6[_0x3bc203(0x655)][_0x3bc203(0x2526)]=_0x3bc203(0x2d4),loadChatSelectionList()):_0x7d22a6[_0x3bc203(0x655)][_0x3bc203(0x2526)]=_0x3bc203(0xfe9));}});});async function resetCustomTheme(){const _0x15984b=_0x2cf6d4;if(confirm(_0x15984b(0x1195))){clearCustomThemeStyles(),clearGlobalCustomTheme(),clearGlobalThemeCache(),document['body'][_0x15984b(0x226e)][_0x15984b(0x128)](_0x15984b(0x1058));try{await db['globalThemes'][_0x15984b(0x2215)](),await db['chatThemes'][_0x15984b(0x2215)](),await db[_0x15984b(0x397)][_0x15984b(0x2215)](),console[_0x15984b(0xc0d)](_0x15984b(0x20ad));}catch(_0x39243b){console[_0x15984b(0x24ab)](_0x15984b(0x6fc),_0x39243b);}customThemeData={'chatTopBg':null,'chatBottomBg':null,'buttons':{'back':null,'offline':null,'settings':null,'expand':null,'continue':null,'send':null},'globalTopAppBar':null,'globalBottomAppBar':null,'globalBackButton':null,'globalAddButton':null,'globalBg':null,'scope':_0x15984b(0x876),'selectedChats':[]},document['querySelectorAll'](_0x15984b(0xe49))[_0x15984b(0x900)](_0x303dcc=>{const _0x1119e1=_0x15984b;_0x303dcc[_0x1119e1(0x655)][_0x1119e1(0x1584)]=_0x1119e1(0xfe9),_0x303dcc['classList'][_0x1119e1(0x128)](_0x1119e1(0x1d41));}),document[_0x15984b(0x1ed9)]('.theme-scope-option')['forEach'](_0x3c2f4c=>{const _0x3689e4=_0x15984b;_0x3c2f4c[_0x3689e4(0x226e)][_0x3689e4(0x128)](_0x3689e4(0x105d));});const _0x15ce7b=document[_0x15984b(0x15b8)]('.theme-scope-option[data-scope=\x22selected\x22]');_0x15ce7b&&_0x15ce7b[_0x15984b(0x226e)][_0x15984b(0xe1)](_0x15984b(0x105d));const _0x35e900=document['getElementById'](_0x15984b(0xf65));_0x35e900&&(_0x35e900[_0x15984b(0x655)]['display']=_0x15984b(0x2d4),loadChatSelectionList()),console[_0x15984b(0xc0d)](_0x15984b(0x801)),showToast(_0x15984b(0x2172),'success');}}function previewCustomTheme(){const _0x594094=_0x2cf6d4,_0x4c236f=customThemeData[_0x594094(0xd51)]||customThemeData['chatBottomBg']||Object[_0x594094(0x1efb)](customThemeData[_0x594094(0x13d7)])['some'](_0x51a2b=>_0x51a2b)||customThemeData['globalTopAppBar']||customThemeData[_0x594094(0x2501)]||customThemeData[_0x594094(0x1641)]||customThemeData[_0x594094(0x218a)]||customThemeData[_0x594094(0xa22)];if(!_0x4c236f){showToast('请先上传自定义内容',_0x594094(0x13bb));return;}const _0x17f211={'hasCustomTheme':document[_0x594094(0x172c)][_0x594094(0x226e)][_0x594094(0x1f9)](_0x594094(0x1058)),'cssVariables':{}},_0x201551=document[_0x594094(0x1788)],_0x810a1c=[_0x594094(0x11a9),_0x594094(0xd1),_0x594094(0x121e),_0x594094(0x8bf),_0x594094(0x14e3),_0x594094(0x5eb),'--custom-continue-btn','--custom-send-btn','--custom-global-top-app-bar',_0x594094(0x2558),_0x594094(0x165b),_0x594094(0x2445),_0x594094(0x64b)];_0x810a1c[_0x594094(0x900)](_0x1700e4=>{const _0x55da09=_0x594094;_0x17f211[_0x55da09(0x19c5)][_0x1700e4]=_0x201551[_0x55da09(0x655)][_0x55da09(0x1a29)](_0x1700e4);});const _0x1fbeef={'chatTopBg':customThemeData[_0x594094(0xd51)],'chatBottomBg':customThemeData[_0x594094(0x295)],'buttons':{...customThemeData['buttons']},'globalTopAppBar':customThemeData[_0x594094(0x1b38)],'globalBottomAppBar':customThemeData['globalBottomAppBar'],'globalBackButton':customThemeData[_0x594094(0x1641)],'globalAddButton':customThemeData[_0x594094(0x218a)],'globalBg':customThemeData[_0x594094(0xa22)]};applyCustomThemeStyles(_0x1fbeef)[_0x594094(0x9e5)](_0x403680=>console[_0x594094(0x24ab)](_0x594094(0x3ee),_0x403680)),showPreviewModal(_0x17f211);}function showPreviewModal(_0x3f9adc){const _0x4e9dfd=_0x2cf6d4,_0x29ea1d=document['createElement']('div');_0x29ea1d[_0x4e9dfd(0x221)]='modal\x20phone-modal',_0x29ea1d[_0x4e9dfd(0x655)]['display']=_0x4e9dfd(0x1f0b),_0x29ea1d['style'][_0x4e9dfd(0x8bc)]=_0x4e9dfd(0x1f94),_0x29ea1d['id']=_0x4e9dfd(0x16e5),_0x29ea1d[_0x4e9dfd(0xc02)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22modal-title\x22>🎨\x20主题预览</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22preview-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22preview-tip\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-eye\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>正在预览自定义主题效果</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22preview-desc\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20您可以切换到聊天界面查看实际效果，预览不会保存设置。\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22preview-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22preview-action-btn\x20goto-chat-btn\x22\x20onclick=\x22gotoChat()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-comment\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>查看聊天效果</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22preview-action-btn\x20goto-home-btn\x22\x20onclick=\x22gotoHome()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-home\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>查看全局效果</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-button\x20modal-secondary\x22\x20onclick=\x22cancelPreview()\x22>取消预览</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-button\x20modal-primary\x22\x20onclick=\x22confirmPreview().catch(e\x20=>\x20console.error(\x27应用主题失败:\x27,\x20e))\x22>应用主题</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',document['body'][_0x4e9dfd(0x1925)](_0x29ea1d),window[_0x4e9dfd(0x18c0)]=_0x3f9adc,showToast(_0x4e9dfd(0xaa5),'info');}function cancelPreview(){const _0x4746aa=_0x2cf6d4,_0x16c577=document[_0x4746aa(0x566)](_0x4746aa(0x16e5));_0x16c577&&_0x16c577[_0x4746aa(0x128)]();if(window[_0x4746aa(0x18c0)]){const _0x2703f2=document[_0x4746aa(0x1788)];Object[_0x4746aa(0x16c7)](window['previewState'][_0x4746aa(0x19c5)])[_0x4746aa(0x900)](_0xe2102b=>{const _0x1df7a8=_0x4746aa,_0x417757=window[_0x1df7a8(0x18c0)][_0x1df7a8(0x19c5)][_0xe2102b];_0x417757?_0x2703f2[_0x1df7a8(0x655)]['setProperty'](_0xe2102b,_0x417757):_0x2703f2[_0x1df7a8(0x655)]['removeProperty'](_0xe2102b);}),window['previewState']['hasCustomTheme']?document['body']['classList']['add'](_0x4746aa(0x1058)):document['body']['classList'][_0x4746aa(0x128)](_0x4746aa(0x1058)),window[_0x4746aa(0x18c0)]=null;}showToast(_0x4746aa(0x1049),_0x4746aa(0x2422));}async function confirmPreview(){const _0x33a7ce=_0x2cf6d4,_0x1557e0=document[_0x33a7ce(0x566)](_0x33a7ce(0x16e5));_0x1557e0&&_0x1557e0[_0x33a7ce(0x128)](),await applyCustomTheme(),window[_0x33a7ce(0x18c0)]=null;}function gotoChat(){const _0x2ecfda=_0x2cf6d4;try{currentChatCharacter?showApp(_0x2ecfda(0x1154)):(showApp(_0x2ecfda(0xa76)),typeof switchChatTab===_0x2ecfda(0xb1)&&switchChatTab('message-list'));const _0x2ebf0b=document['getElementById'](_0x2ecfda(0x16e5));_0x2ebf0b&&_0x2ebf0b[_0x2ecfda(0x128)]();}catch(_0x6be207){console[_0x2ecfda(0x24ab)](_0x2ecfda(0x4f6),_0x6be207),showToast(_0x2ecfda(0xb49),_0x2ecfda(0x13bb));}}function gotoHome(){const _0x291c12=_0x2cf6d4;try{const _0x4fefff=document[_0x291c12(0x1ed9)](_0x291c12(0x867));_0x4fefff[_0x291c12(0x900)](_0x5822d0=>{const _0x35a0cb=_0x291c12;_0x5822d0[_0x35a0cb(0x655)][_0x35a0cb(0x2526)]='none';});const _0x4b7957=document[_0x291c12(0x566)](_0x291c12(0x799)),_0x17c12d=document[_0x291c12(0x566)]('home-grid'),_0x35e07b=document[_0x291c12(0x566)](_0x291c12(0x1280)),_0xa718a4=document['getElementById'](_0x291c12(0x459));if(_0x4b7957)_0x4b7957[_0x291c12(0x655)]['display']='block';if(_0x17c12d)_0x17c12d[_0x291c12(0x655)]['display']='grid';if(_0x35e07b)_0x35e07b['style'][_0x291c12(0x2526)]='block';if(_0xa718a4)_0xa718a4[_0x291c12(0x655)]['display']=_0x291c12(0x1f0b);const _0xe3562=document['getElementById'](_0x291c12(0x16e5));_0xe3562&&_0xe3562[_0x291c12(0x128)]();}catch(_0x2382ed){console['error']('跳转到主界面失败:',_0x2382ed),showToast(_0x291c12(0x1088),_0x291c12(0x13bb));}}async function applyCustomTheme(){const _0x43dd57=_0x2cf6d4,_0xc37eea=customThemeData['chatTopBg']||customThemeData[_0x43dd57(0x295)]||Object[_0x43dd57(0x1efb)](customThemeData[_0x43dd57(0x13d7)])[_0x43dd57(0x184b)](_0x374a1d=>_0x374a1d),_0x16da86=customThemeData[_0x43dd57(0x1b38)]||customThemeData['globalBottomAppBar']||customThemeData[_0x43dd57(0x1641)]||customThemeData[_0x43dd57(0x218a)]||customThemeData[_0x43dd57(0xa22)];if(!_0xc37eea&&!_0x16da86){showToast(_0x43dd57(0x1299),'warning');return;}_0x16da86&&(await saveAndApplyGlobalTheme(),console['log']('🎨\x20全局主题已应用到所有应用页面'));if(_0xc37eea){let _0x4852e5=[];if(customThemeData[_0x43dd57(0x231)]===_0x43dd57(0x876)){if(customThemeData[_0x43dd57(0x2233)][_0x43dd57(0xcbf)]===0x0){showToast(_0x43dd57(0x12de),_0x43dd57(0x13bb));return;}_0x4852e5=customThemeData['selectedChats'];}else{if(customThemeData[_0x43dd57(0x231)]===_0x43dd57(0x2339)){const _0x37212e=[];characters&&contacts&&characters[_0x43dd57(0x900)](_0x96c22c=>{const _0x302bec=_0x43dd57;contacts['includes'](_0x96c22c['id'])&&_0x37212e[_0x302bec(0x6ee)](_0x96c22c['id']);}),groupChats&&groupChats['forEach'](_0x12ba96=>{const _0xc1e943=_0x43dd57;_0x37212e[_0xc1e943(0x6ee)](_0x12ba96['id']);}),_0x4852e5=_0x37212e;}}const _0x3e3d5a={'chatTopBg':customThemeData[_0x43dd57(0xd51)],'chatBottomBg':customThemeData['chatBottomBg'],'buttons':{...customThemeData[_0x43dd57(0x13d7)]}};for(const _0x5bb375 of _0x4852e5){try{await db[_0x43dd57(0x8c6)][_0x43dd57(0x53a)]({'chatId':_0x5bb375,'themeData':_0x3e3d5a,'timestamp':Date[_0x43dd57(0x18e0)]()}),console[_0x43dd57(0xc0d)](_0x43dd57(0x24b3)+_0x5bb375+_0x43dd57(0x470));}catch(_0x4dc170){console['error']('❌\x20保存聊天主题失败\x20('+_0x5bb375+'):',_0x4dc170);}}currentChatCharacter&&_0x4852e5[_0x43dd57(0x23ec)](currentChatCharacter['id'])&&(applyCustomThemeStyles(_0x3e3d5a)[_0x43dd57(0x9e5)](_0x5cebb1=>console[_0x43dd57(0x24ab)](_0x43dd57(0x120b),_0x5cebb1)),console[_0x43dd57(0xc0d)](_0x43dd57(0x8a3)+currentChatCharacter['id']+_0x43dd57(0xcfe))),showToast('聊天主题已应用到\x20'+_0x4852e5[_0x43dd57(0xcbf)]+'\x20个聊天窗口',_0x43dd57(0xb27));}try{await db['themeSettings'][_0x43dd57(0x53a)]({'id':'selectedTheme','settingName':_0x43dd57(0x219c),'settingValue':_0x43dd57(0x13a8),'timestamp':Date['now']()});}catch(_0x2950ed){console['error'](_0x43dd57(0x65f),_0x2950ed);}if(_0x16da86&&!_0xc37eea)showToast(_0x43dd57(0xb55),_0x43dd57(0xb27));else _0x16da86&&_0xc37eea&&showToast(_0x43dd57(0x52d),_0x43dd57(0xb27));clearAllThemeItemStatus(),setTimeout(()=>{const _0x2038a6=_0x43dd57;backToSettings(_0x2038a6(0x213));},0x5dc);}async function applyCustomThemeStyles(_0x5f001c=null){const _0xb97189=_0x2cf6d4,_0x35eadd=document['documentElement'];clearCustomThemeStyles();if(!_0x5f001c&&currentChatCharacter)try{const _0x20aa71=await db[_0xb97189(0x8c6)][_0xb97189(0x4a6)](_0xb97189(0x956))['equals'](currentChatCharacter['id'])[_0xb97189(0x2200)]();if(_0x20aa71&&_0x20aa71[_0xb97189(0x2e5)])_0x5f001c=_0x20aa71[_0xb97189(0x2e5)],console[_0xb97189(0xc0d)](_0xb97189(0x24b3)+currentChatCharacter['id']+_0xb97189(0xd8e));else{console[_0xb97189(0xc0d)]('🎨\x20聊天窗口\x20'+currentChatCharacter['id']+_0xb97189(0x1c2a));return;}}catch(_0x131997){console[_0xb97189(0x24ab)](_0xb97189(0xbd9),_0x131997);return;}if(!_0x5f001c){console[_0xb97189(0xc0d)](_0xb97189(0x19c0));return;}const _0x5a3cad=[];if(_0x5f001c[_0xb97189(0xd51)])_0x5a3cad[_0xb97189(0x6ee)](_0x5f001c[_0xb97189(0xd51)]);if(_0x5f001c[_0xb97189(0x295)])_0x5a3cad[_0xb97189(0x6ee)](_0x5f001c[_0xb97189(0x295)]);_0x5f001c[_0xb97189(0x13d7)]&&Object['values'](_0x5f001c[_0xb97189(0x13d7)])[_0xb97189(0x900)](_0x31cc07=>{const _0x167f52=_0xb97189;_0x31cc07&&_0x31cc07['trim']()!==''&&_0x5a3cad[_0x167f52(0x6ee)](_0x31cc07);});try{await Promise[_0xb97189(0x2339)](_0x5a3cad[_0xb97189(0xf6d)](_0x163683=>preloadImage(_0x163683))),console[_0xb97189(0xc0d)]('🎨\x20聊天主题图片预加载完成');}catch(_0x4998f0){console['warn'](_0xb97189(0x1454),_0x4998f0);}_0x5f001c[_0xb97189(0xd51)]&&(_0x35eadd[_0xb97189(0x655)][_0xb97189(0x16db)]('--custom-chat-top-bg',_0xb97189(0xcb5)+_0x5f001c[_0xb97189(0xd51)]+')'),document[_0xb97189(0x172c)]['setAttribute'](_0xb97189(0x1d78),_0xb97189(0x8f1)),console[_0xb97189(0xc0d)](_0xb97189(0xd39),_0x5f001c[_0xb97189(0xd51)]));_0x5f001c[_0xb97189(0x295)]&&(_0x35eadd[_0xb97189(0x655)]['setProperty']('--custom-chat-bottom-bg',_0xb97189(0xcb5)+_0x5f001c[_0xb97189(0x295)]+')'),document[_0xb97189(0x172c)][_0xb97189(0x1dd4)](_0xb97189(0x888),_0xb97189(0x8f1)),console['log'](_0xb97189(0x742),_0x5f001c[_0xb97189(0x295)]));const _0x1fde9c=new Set();_0x5f001c[_0xb97189(0x13d7)]&&Object['keys'](_0x5f001c[_0xb97189(0x13d7)])[_0xb97189(0x900)](_0x7c93d6=>{const _0x42d376=_0xb97189,_0x5993b5=_0x5f001c['buttons'][_0x7c93d6];_0x5993b5&&_0x5993b5[_0x42d376(0x1424)]()!==''&&(_0x35eadd[_0x42d376(0x655)][_0x42d376(0x16db)](_0x42d376(0x21e6)+_0x7c93d6+_0x42d376(0x164e),_0x42d376(0xcb5)+_0x5993b5+')'),applyButtonCustomStyle(_0x7c93d6,_0x5993b5),_0x1fde9c[_0x42d376(0xe1)](_0x7c93d6),console[_0x42d376(0xc0d)](_0x42d376(0xc94)+_0x7c93d6+_0x42d376(0x14e4)+_0x5993b5));});const _0x430393=[_0xb97189(0x23cf),_0xb97189(0x1685),_0xb97189(0x1fbb),'expand',_0xb97189(0x18d9),_0xb97189(0x4bb)];_0x430393[_0xb97189(0x900)](_0x3c1f78=>{const _0x451daf=_0xb97189;_0x1fde9c[_0x451daf(0x1af1)](_0x3c1f78)?document[_0x451daf(0x172c)][_0x451daf(0x1dd4)]('data-has-custom-'+_0x3c1f78+'-btn',_0x451daf(0x8f1)):document[_0x451daf(0x172c)][_0x451daf(0x10b3)](_0x451daf(0x8fc)+_0x3c1f78+_0x451daf(0x164e));}),document[_0xb97189(0x172c)][_0xb97189(0x226e)][_0xb97189(0xe1)]('custom-theme-applied'),console[_0xb97189(0xc0d)]('🎨\x20聊天主题应用完成，跳过全局主题重复应用以避免冲突'),console['log'](_0xb97189(0xa4e));}function clearCustomThemeStyles(){const _0x9dd075=_0x2cf6d4;console['log']('🎨\x20开始清除聊天自定义主题样式...');const _0x4c0eb2=document[_0x9dd075(0x1788)],_0x190857=['--custom-chat-top-bg','--custom-chat-bottom-bg',_0x9dd075(0x121e),_0x9dd075(0x8bf),_0x9dd075(0x14e3),_0x9dd075(0x5eb),_0x9dd075(0x16e3),_0x9dd075(0x18fc)];_0x190857[_0x9dd075(0x900)](_0x33ceaf=>{const _0x5cdf5a=_0x9dd075;_0x4c0eb2[_0x5cdf5a(0x655)][_0x5cdf5a(0xdae)](_0x33ceaf),console[_0x5cdf5a(0xc0d)](_0x5cdf5a(0x11d3)+_0x33ceaf);}),document['body'][_0x9dd075(0x10b3)](_0x9dd075(0x1d78)),document[_0x9dd075(0x172c)][_0x9dd075(0x10b3)](_0x9dd075(0x888));const _0x2053b0=[_0x9dd075(0x23cf),'offline',_0x9dd075(0x1fbb),'expand',_0x9dd075(0x18d9),_0x9dd075(0x4bb)];_0x2053b0[_0x9dd075(0x900)](_0x47963a=>{const _0x25847a=_0x9dd075;document[_0x25847a(0x172c)][_0x25847a(0x10b3)](_0x25847a(0x8fc)+_0x47963a+'-btn');}),clearButtonCustomStyles(),clearBackgroundCustomStyles(),console[_0x9dd075(0xc0d)](_0x9dd075(0x49f));}function applyButtonCustomStyle(_0x18f2c3,_0x2ef96a){const _0x3520e5=_0x2cf6d4;let _0x5ad649='';switch(_0x18f2c3){case _0x3520e5(0x23cf):_0x5ad649=_0x3520e5(0x10c4);break;case _0x3520e5(0x1685):_0x5ad649=_0x3520e5(0x447);break;case'settings':_0x5ad649='.header-actions\x20.action-btn:last-child';break;case'expand':_0x5ad649=_0x3520e5(0x1803);break;case _0x3520e5(0x18d9):_0x5ad649=_0x3520e5(0x12d);break;case _0x3520e5(0x4bb):_0x5ad649='.send-button';break;}if(_0x5ad649){const _0x531e63=document[_0x3520e5(0x1ed9)](_0x5ad649);_0x531e63[_0x3520e5(0x900)](_0x1520d7=>{const _0x47251c=_0x3520e5;_0x1520d7[_0x47251c(0x655)]['setProperty'](_0x47251c(0x1ff7),_0x47251c(0xcb5)+_0x2ef96a+')','important'),_0x1520d7[_0x47251c(0x655)][_0x47251c(0x16db)](_0x47251c(0x1264),_0x47251c(0xe3e),_0x47251c(0x153c)),_0x1520d7[_0x47251c(0x655)][_0x47251c(0x16db)]('background-position',_0x47251c(0x23a1),_0x47251c(0x153c)),_0x1520d7[_0x47251c(0x655)]['setProperty']('background-repeat',_0x47251c(0x190),_0x47251c(0x153c)),_0x1520d7['style'][_0x47251c(0x16db)](_0x47251c(0x2099),'transparent',_0x47251c(0x153c)),_0x1520d7[_0x47251c(0x655)][_0x47251c(0x16db)](_0x47251c(0xc8c),_0x47251c(0xfe9),_0x47251c(0x153c)),_0x1520d7[_0x47251c(0x655)][_0x47251c(0x16db)](_0x47251c(0x1152),_0x47251c(0xfe9),_0x47251c(0x153c)),_0x1520d7[_0x47251c(0x655)][_0x47251c(0x16db)](_0x47251c(0xd46),_0x47251c(0xfe9),'important'),_0x1520d7[_0x47251c(0x655)]['setProperty'](_0x47251c(0x244b),'transparent',_0x47251c(0x153c)),_0x1520d7[_0x47251c(0x226e)][_0x47251c(0xe1)]('custom-button-styled');const _0x513b35=_0x1520d7[_0x47251c(0x1ed9)](_0x47251c(0x2081));_0x513b35[_0x47251c(0x900)](_0x37446c=>{const _0x13433f=_0x47251c;_0x37446c[_0x13433f(0x655)][_0x13433f(0x16db)](_0x13433f(0x671),'0','important');});});}}function clearButtonCustomStyles(){const _0x43b4c3=_0x2cf6d4;console[_0x43b4c3(0xc0d)](_0x43b4c3(0x15e9));const _0x9b17de=document[_0x43b4c3(0x1ed9)](_0x43b4c3(0xc69));_0x9b17de['forEach'](_0x1d3aac=>{const _0x52210e=_0x43b4c3;_0x1d3aac['style'][_0x52210e(0xdae)]('background-image'),_0x1d3aac[_0x52210e(0x655)][_0x52210e(0xdae)](_0x52210e(0x1264)),_0x1d3aac[_0x52210e(0x655)][_0x52210e(0xdae)]('background-position'),_0x1d3aac[_0x52210e(0x655)]['removeProperty'](_0x52210e(0x1f6c)),_0x1d3aac[_0x52210e(0x655)][_0x52210e(0xdae)]('color'),_0x1d3aac['style'][_0x52210e(0xdae)](_0x52210e(0xc8c)),_0x1d3aac[_0x52210e(0x655)][_0x52210e(0xdae)](_0x52210e(0x1152)),_0x1d3aac[_0x52210e(0x655)]['removeProperty']('box-shadow'),_0x1d3aac['style']['removeProperty'](_0x52210e(0x244b)),_0x1d3aac[_0x52210e(0x226e)]['remove']('custom-button-styled');const _0x5aa266=_0x1d3aac[_0x52210e(0x1ed9)](_0x52210e(0x2081));_0x5aa266[_0x52210e(0x900)](_0x4eea8f=>{const _0x2d8715=_0x52210e;_0x4eea8f[_0x2d8715(0x655)][_0x2d8715(0xdae)]('opacity');}),console[_0x52210e(0xc0d)](_0x52210e(0x8ba),_0x1d3aac[_0x52210e(0x221)]);});const _0x37ec46=[_0x43b4c3(0x10c4),_0x43b4c3(0x447),_0x43b4c3(0x138),_0x43b4c3(0x1803),_0x43b4c3(0x12d),_0x43b4c3(0xe0b)];_0x37ec46[_0x43b4c3(0x900)](_0x54ecea=>{const _0x3b985a=document['querySelectorAll'](_0x54ecea);_0x3b985a['forEach'](_0x1047ef=>{const _0x34e5a3=_0x3a81;_0x1047ef[_0x34e5a3(0x655)][_0x34e5a3(0xdae)](_0x34e5a3(0x1ff7)),_0x1047ef[_0x34e5a3(0x655)][_0x34e5a3(0xdae)](_0x34e5a3(0x1264)),_0x1047ef[_0x34e5a3(0x655)][_0x34e5a3(0xdae)](_0x34e5a3(0x2dd)),_0x1047ef[_0x34e5a3(0x655)][_0x34e5a3(0xdae)](_0x34e5a3(0x1f6c)),_0x1047ef['style']['removeProperty'](_0x34e5a3(0x2099)),_0x1047ef[_0x34e5a3(0x655)][_0x34e5a3(0xdae)](_0x34e5a3(0xc8c)),_0x1047ef[_0x34e5a3(0x655)]['removeProperty'](_0x34e5a3(0x1152)),_0x1047ef[_0x34e5a3(0x655)][_0x34e5a3(0xdae)]('box-shadow'),_0x1047ef[_0x34e5a3(0x655)][_0x34e5a3(0xdae)](_0x34e5a3(0x244b));const _0x3f0d44=_0x1047ef[_0x34e5a3(0x1ed9)](_0x34e5a3(0x2081));_0x3f0d44[_0x34e5a3(0x900)](_0x5d1eef=>{const _0x536916=_0x34e5a3;_0x5d1eef[_0x536916(0x655)]['removeProperty'](_0x536916(0x671));});});});}function clearBackgroundCustomStyles(){const _0x1b97c2=_0x2cf6d4;console[_0x1b97c2(0xc0d)]('🎨\x20清除背景自定义样式...');const _0x39ed2e=document[_0x1b97c2(0x1ed9)](_0x1b97c2(0x1cad));_0x39ed2e[_0x1b97c2(0x900)](_0x171458=>{const _0x4fb3c4=_0x1b97c2;_0x171458[_0x4fb3c4(0x655)][_0x4fb3c4(0x1584)]='',_0x171458[_0x4fb3c4(0x655)][_0x4fb3c4(0x2000)]='',_0x171458['style'][_0x4fb3c4(0x18b3)]='',_0x171458[_0x4fb3c4(0x655)][_0x4fb3c4(0x12be)]='';});const _0x27736b=document[_0x1b97c2(0x1ed9)](_0x1b97c2(0x4d1));_0x27736b[_0x1b97c2(0x900)](_0x245c0c=>{const _0x531e0b=_0x1b97c2;_0x245c0c[_0x531e0b(0x655)][_0x531e0b(0x1584)]='',_0x245c0c[_0x531e0b(0x655)]['backgroundSize']='',_0x245c0c[_0x531e0b(0x655)][_0x531e0b(0x18b3)]='',_0x245c0c[_0x531e0b(0x655)][_0x531e0b(0x12be)]='';});const _0x312354=document['querySelectorAll'](_0x1b97c2(0x14c6));_0x312354['forEach'](_0x4788fd=>{const _0x260090=_0x1b97c2;_0x4788fd[_0x260090(0x655)][_0x260090(0x1584)]='',_0x4788fd['style']['backgroundSize']='',_0x4788fd[_0x260090(0x655)]['backgroundPosition']='',_0x4788fd[_0x260090(0x655)][_0x260090(0x12be)]='';});}async function showThemeManagement(){const _0x59f4ac=_0x2cf6d4;try{const _0x10c21c=[],_0x3293af=await db[_0x59f4ac(0x8c6)]['toArray']();characters&&contacts&&characters[_0x59f4ac(0x900)](_0xd11de2=>{const _0x2bdf69=_0x59f4ac;if(contacts[_0x2bdf69(0x23ec)](_0xd11de2['id'])){const _0x2af9e8=_0x3293af[_0x2bdf69(0x1aeb)](_0x4131ce=>_0x4131ce[_0x2bdf69(0x956)]===_0xd11de2['id']);_0x2af9e8&&_0x10c21c[_0x2bdf69(0x6ee)]({'id':_0xd11de2['id'],'name':_0xd11de2['name'],'type':_0x2bdf69(0xfbe),'themeData':_0x2af9e8[_0x2bdf69(0x2e5)]});}});groupChats&&groupChats[_0x59f4ac(0x900)](_0x51327f=>{const _0x1cf1be=_0x59f4ac,_0x26368a=_0x3293af[_0x1cf1be(0x1aeb)](_0x18f110=>_0x18f110[_0x1cf1be(0x956)]===_0x51327f['id']);_0x26368a&&_0x10c21c[_0x1cf1be(0x6ee)]({'id':_0x51327f['id'],'name':_0x51327f[_0x1cf1be(0x222f)],'type':_0x1cf1be(0x22f5),'themeData':_0x26368a[_0x1cf1be(0x2e5)]});});if(_0x10c21c[_0x59f4ac(0xcbf)]===0x0){showToast('没有找到任何自定义主题',_0x59f4ac(0x2422));return;}const _0x4e4f8b=document[_0x59f4ac(0x1ad8)](_0x59f4ac(0x526));_0x4e4f8b[_0x59f4ac(0x221)]=_0x59f4ac(0x92a),_0x4e4f8b[_0x59f4ac(0x655)]['display']='flex',_0x4e4f8b[_0x59f4ac(0x655)]['zIndex']='10000',_0x4e4f8b['id']=_0x59f4ac(0x23e1);const _0xfe5c75=_0x10c21c[_0x59f4ac(0xf6d)](_0x35f645=>_0x59f4ac(0x21ce)+_0x35f645['id']+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22theme-chat-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22theme-chat-name\x22>'+_0x35f645[_0x59f4ac(0x222f)]+_0x59f4ac(0x1392)+(_0x35f645[_0x59f4ac(0x23df)]===_0x59f4ac(0x22f5)?'群聊':'角色')+_0x59f4ac(0x23fd)+_0x35f645['id']+_0x59f4ac(0x71b)+_0x35f645['id']+_0x59f4ac(0x1cac))[_0x59f4ac(0x140c)]('');_0x4e4f8b[_0x59f4ac(0xc02)]=_0x59f4ac(0x1386)+_0x10c21c[_0x59f4ac(0xcbf)]+_0x59f4ac(0x2434)+_0xfe5c75+_0x59f4ac(0x527),document['body'][_0x59f4ac(0x1925)](_0x4e4f8b);}catch(_0x35f3a7){console[_0x59f4ac(0x24ab)](_0x59f4ac(0x13eb),_0x35f3a7),showToast(_0x59f4ac(0x10b6),_0x59f4ac(0x24ab));}}function closeThemeManagement(){const _0xa35961=_0x2cf6d4,_0x2d1a3f=document[_0xa35961(0x566)]('theme-management-modal');_0x2d1a3f&&_0x2d1a3f[_0xa35961(0x128)]();}async function previewChatTheme(_0x43ff48){const _0x55a31d=_0x2cf6d4;try{const _0x5f5c59=await db[_0x55a31d(0x8c6)][_0x55a31d(0x4a6)](_0x55a31d(0x956))[_0x55a31d(0x14a)](_0x43ff48)[_0x55a31d(0x2200)]();if(_0x5f5c59&&_0x5f5c59[_0x55a31d(0x2e5)]){await applyCustomThemeStyles(_0x5f5c59[_0x55a31d(0x2e5)]);let _0x369f45=_0x55a31d(0x2325);if(characters&&contacts){const _0x13b7b7=characters[_0x55a31d(0x1aeb)](_0x1cce61=>_0x1cce61['id']===_0x43ff48);_0x13b7b7&&contacts[_0x55a31d(0x23ec)](_0x13b7b7['id'])&&(_0x369f45=_0x13b7b7[_0x55a31d(0x222f)]);}if(groupChats){const _0x4bc7fd=groupChats[_0x55a31d(0x1aeb)](_0x134e54=>_0x134e54['id']===_0x43ff48);_0x4bc7fd&&(_0x369f45=_0x4bc7fd[_0x55a31d(0x222f)]);}showToast(_0x55a31d(0x1a80)+_0x369f45+'\x20的主题','info');}else showToast(_0x55a31d(0x5d6),_0x55a31d(0x24ab));}catch(_0x59daaa){console['error'](_0x55a31d(0xa42),_0x59daaa),showToast(_0x55a31d(0xc1c),_0x55a31d(0x24ab));}}async function removeChatTheme(_0x3537bc){const _0x3e4092=_0x2cf6d4;try{let _0xbb3e4a=_0x3e4092(0x2325);if(characters&&contacts){const _0x345970=characters[_0x3e4092(0x1aeb)](_0x735ac3=>_0x735ac3['id']===_0x3537bc);_0x345970&&contacts[_0x3e4092(0x23ec)](_0x345970['id'])&&(_0xbb3e4a=_0x345970[_0x3e4092(0x222f)]);}if(groupChats){const _0x5bac32=groupChats[_0x3e4092(0x1aeb)](_0x3b3215=>_0x3b3215['id']===_0x3537bc);_0x5bac32&&(_0xbb3e4a=_0x5bac32[_0x3e4092(0x222f)]);}confirm(_0x3e4092(0x1d15)+_0xbb3e4a+_0x3e4092(0xe17))&&(await db['chatThemes'][_0x3e4092(0x4a6)](_0x3e4092(0x956))[_0x3e4092(0x14a)](_0x3537bc)[_0x3e4092(0xc2b)](),currentChatCharacter&&currentChatCharacter['id']===_0x3537bc&&clearCustomThemeStyles(),showToast(_0x3e4092(0x880)+_0xbb3e4a+_0x3e4092(0x1074),'success'),closeThemeManagement(),setTimeout(()=>showThemeManagement()[_0x3e4092(0x9e5)](_0x5dbb5c=>console[_0x3e4092(0x24ab)](_0x3e4092(0x21e),_0x5dbb5c)),0x64));}catch(_0xd187ba){console['error'](_0x3e4092(0x16f2),_0xd187ba),showToast(_0x3e4092(0xc65),'error');}}async function clearAllThemes(){const _0xd4d89c=_0x2cf6d4;if(confirm(_0xd4d89c(0x2385)))try{const _0xbb5e5b=await db['chatThemes'][_0xd4d89c(0x18c6)](),_0x1ef36f=_0xbb5e5b[_0xd4d89c(0xcbf)];await db[_0xd4d89c(0x8c6)][_0xd4d89c(0x2215)](),clearCustomThemeStyles(),showToast('已清除\x20'+_0x1ef36f+_0xd4d89c(0x536),_0xd4d89c(0xb27)),closeThemeManagement();}catch(_0x2a7e2b){console['error'](_0xd4d89c(0x24a0),_0x2a7e2b),showToast(_0xd4d89c(0x263),_0xd4d89c(0x24ab));}}document[_0x2cf6d4(0x167)](_0x2cf6d4(0x7f7),async function(){const _0x13c9d0=_0x2cf6d4;try{const _0x512cf2=await db[_0x13c9d0(0x397)][_0x13c9d0(0x46a)]('selectedTheme'),_0x3d0278=_0x512cf2?_0x512cf2['settingValue']:null;if(!_0x3d0278||_0x3d0278===_0x13c9d0(0x13a8))await applyGlobalCustomTheme(),console[_0x13c9d0(0xc0d)](_0x13c9d0(0x611));else{const _0x41626a=document['body'];_0x41626a[_0x13c9d0(0x10b3)](_0x13c9d0(0xa90)),_0x3d0278!==_0x13c9d0(0xbf)&&_0x41626a['setAttribute'](_0x13c9d0(0xa90),_0x3d0278),console[_0x13c9d0(0xc0d)](_0x13c9d0(0x24b2)+_0x3d0278);}}catch(_0x4e18a9){console[_0x13c9d0(0x24ab)](_0x13c9d0(0x1132),_0x4e18a9);}});async function initCustomThemeScreen(){const _0x2e9e20=_0x2cf6d4;console['log'](_0x2e9e20(0xc89)),switchCustomThemeTab(_0x2e9e20(0x23b3)),await loadCustomThemeToUI();}async function loadCustomThemeToUI(){const _0x5f501b=_0x2cf6d4;try{const _0x586927=await db[_0x5f501b(0x113)][_0x5f501b(0x46a)](_0x5f501b(0x3d8));let _0x29a066={};_0x586927&&_0x586927[_0x5f501b(0x2e5)]&&(_0x29a066=_0x586927[_0x5f501b(0x2e5)],console[_0x5f501b(0xc0d)](_0x5f501b(0xc3a)));const _0x38d90d={'chatTopBg':customThemeData['chatTopBg'],'chatBottomBg':customThemeData[_0x5f501b(0x295)],'buttons':{...customThemeData[_0x5f501b(0x13d7)]},'globalTopAppBar':_0x29a066[_0x5f501b(0x1b38)],'globalBottomAppBar':_0x29a066['globalBottomAppBar'],'globalBackButton':_0x29a066['globalBackButton'],'globalAddButton':_0x29a066['globalAddButton'],'globalBg':_0x29a066[_0x5f501b(0xa22)],'scope':customThemeData[_0x5f501b(0x231)]||'selected','selectedChats':customThemeData[_0x5f501b(0x2233)]||[]};customThemeData=_0x38d90d;_0x38d90d[_0x5f501b(0xd51)]&&(updatePreview(_0x5f501b(0x150a),_0x38d90d[_0x5f501b(0xd51)]),updateThemeItemStatus(_0x5f501b(0x756),!![]));_0x38d90d[_0x5f501b(0x295)]&&(updatePreview(_0x5f501b(0x14d0),_0x38d90d[_0x5f501b(0x295)]),updateThemeItemStatus(_0x5f501b(0xaf1),!![]));_0x38d90d[_0x5f501b(0x13d7)]&&typeof _0x38d90d[_0x5f501b(0x13d7)]===_0x5f501b(0x3c4)&&Object[_0x5f501b(0x16c7)](_0x38d90d[_0x5f501b(0x13d7)])['forEach'](_0x5088e2=>{const _0x3e1137=_0x5f501b;_0x38d90d[_0x3e1137(0x13d7)][_0x5088e2]&&(updatePreview(_0x5088e2+'-btn-preview',_0x38d90d[_0x3e1137(0x13d7)][_0x5088e2]),updateThemeItemStatus(_0x5088e2+_0x3e1137(0x241a),!![]));});_0x38d90d[_0x5f501b(0x1b38)]&&updatePreview(_0x5f501b(0x1f7a),_0x38d90d[_0x5f501b(0x1b38)]);_0x38d90d['globalBottomAppBar']&&updatePreview(_0x5f501b(0x1aa5),_0x38d90d[_0x5f501b(0x2501)]);_0x38d90d['globalBackButton']&&updatePreview(_0x5f501b(0x1ac2),_0x38d90d[_0x5f501b(0x1641)]);_0x38d90d[_0x5f501b(0x218a)]&&updatePreview('global-add-button-preview',_0x38d90d[_0x5f501b(0x218a)]);_0x38d90d[_0x5f501b(0xa22)]&&updatePreview('global-bg-preview',_0x38d90d['globalBg']);document[_0x5f501b(0x1ed9)](_0x5f501b(0x783))['forEach'](_0xefeaf0=>{const _0x3224c0=_0x5f501b;_0xefeaf0[_0x3224c0(0x226e)][_0x3224c0(0x128)](_0x3224c0(0x105d));});const _0x5d616d=document['querySelector']('.theme-scope-option[data-scope=\x22'+_0x38d90d['scope']+'\x22]');_0x5d616d&&_0x5d616d[_0x5f501b(0x226e)][_0x5f501b(0xe1)](_0x5f501b(0x105d));}catch(_0x42f84b){console[_0x5f501b(0x24ab)](_0x5f501b(0x5e6),_0x42f84b);}}async function loadSavedTheme(){const _0x38e2a9=_0x2cf6d4;try{const _0x3d7077=await db[_0x38e2a9(0x397)][_0x38e2a9(0x46a)](_0x38e2a9(0x219c)),_0x114981=_0x3d7077?_0x3d7077[_0x38e2a9(0x224d)]:null;_0x114981&&_0x114981!==_0x38e2a9(0xbf)&&document['body'][_0x38e2a9(0x1dd4)](_0x38e2a9(0xa90),_0x114981);}catch(_0x3ab18f){console[_0x38e2a9(0x24ab)](_0x38e2a9(0x1da3),_0x3ab18f);}}let worldbooks=[],editingWorldbook=null;async function loadWorldbooks(){const _0x1b4133=_0x2cf6d4;try{const _0x5f4b69=await db[_0x1b4133(0x195c)][_0x1b4133(0x18c6)]();if(_0x5f4b69[_0x1b4133(0xcbf)]===0x0){const _0x957293=localStorage[_0x1b4133(0x2250)](_0x1b4133(0x195c));if(_0x957293){console['log'](_0x1b4133(0xf82));const _0x3b57b8=JSON[_0x1b4133(0x168e)](_0x957293);if(_0x3b57b8[_0x1b4133(0xcbf)]>0x0){const _0x3274f6=_0x3b57b8[_0x1b4133(0xf6d)](_0x493eb4=>({'id':_0x493eb4['id']||Date[_0x1b4133(0x18e0)]()[_0x1b4133(0x9a3)]()+Math[_0x1b4133(0x191c)](),'title':_0x493eb4[_0x1b4133(0x1c18)],'content':_0x493eb4[_0x1b4133(0x1423)],'createdAt':_0x493eb4[_0x1b4133(0xd70)]||new Date()[_0x1b4133(0xa4b)](),'updatedAt':_0x493eb4[_0x1b4133(0x2222)]||new Date()[_0x1b4133(0xa4b)]()}));await db[_0x1b4133(0x195c)][_0x1b4133(0x24c8)](_0x3274f6),worldbooks=_0x3274f6,console[_0x1b4133(0xc0d)](_0x1b4133(0x1391),worldbooks);}else worldbooks=[];}else worldbooks=[];}else worldbooks=_0x5f4b69,console[_0x1b4133(0xc0d)]('从IndexedDB加载世界书数据:',worldbooks);}catch(_0x2885a1){console[_0x1b4133(0x24ab)](_0x1b4133(0x13f5),_0x2885a1);const _0x350ea9=localStorage[_0x1b4133(0x2250)](_0x1b4133(0x195c));if(_0x350ea9)try{worldbooks=JSON[_0x1b4133(0x168e)](_0x350ea9);}catch(_0x21f268){worldbooks=[];}else worldbooks=[];}renderWorldbookList();}async function saveWorldbooks(){const _0x3ffdfa=_0x2cf6d4;try{console[_0x3ffdfa(0xc0d)](_0x3ffdfa(0x2397),worldbooks);if(worldbooks[_0x3ffdfa(0xcbf)]===0x0){console[_0x3ffdfa(0x17cc)](_0x3ffdfa(0x86d));return;}await db[_0x3ffdfa(0x174a)]('rw',db[_0x3ffdfa(0x195c)],async()=>{const _0x4fa55d=_0x3ffdfa;await db[_0x4fa55d(0x195c)]['clear'](),await db[_0x4fa55d(0x195c)][_0x4fa55d(0x24c8)](worldbooks);}),console[_0x3ffdfa(0xc0d)]('✅\x20安全保存了\x20'+worldbooks[_0x3ffdfa(0xcbf)]+_0x3ffdfa(0x1273)),console[_0x3ffdfa(0xc0d)](_0x3ffdfa(0x2393));}catch(_0x1bb7da){console['error'](_0x3ffdfa(0x1219),_0x1bb7da),localStorage[_0x3ffdfa(0x2055)](_0x3ffdfa(0x195c),JSON[_0x3ffdfa(0x7fb)](worldbooks));}}function showWorldbookForm(_0x2344c0){const _0x419508=_0x2cf6d4;let _0x4aaff0;_0x2344c0?_0x4aaff0=_0x419508(0x1c96):_0x4aaff0=_0x419508(0x129d),document[_0x419508(0x566)](_0x419508(0xcee))[_0x419508(0x21dc)]=_0x4aaff0,editingWorldbook=null,document[_0x419508(0x566)](_0x419508(0x211b))[_0x419508(0xc34)]='',document[_0x419508(0x566)]('worldbook-content')[_0x419508(0xc34)]='',window[_0x419508(0x24a3)]=_0x2344c0,showApp('worldbook-form-screen');}function hideWorldbookForm(){const _0x24629b=_0x2cf6d4;editingWorldbook=null;try{document['getElementById'](_0x24629b(0x211b))['value']='',document[_0x24629b(0x566)](_0x24629b(0x12ee))[_0x24629b(0xc34)]='';}catch(_0x5e26fb){console[_0x24629b(0x17cc)](_0x24629b(0x12e3),_0x5e26fb);}hideApp(_0x24629b(0x2361)),showApp(_0x24629b(0x5d4));}async function saveWorldbook(){const _0xe5347f=_0x2cf6d4;try{const _0x532566=document[_0xe5347f(0x566)](_0xe5347f(0x211b))[_0xe5347f(0xc34)][_0xe5347f(0x1424)](),_0x461ac3=document[_0xe5347f(0x566)](_0xe5347f(0x12ee))[_0xe5347f(0xc34)][_0xe5347f(0x1424)]();if(!_0x532566||!_0x461ac3){alert(_0xe5347f(0x7c1));return;}const _0x3cc9d7=new Blob([_0x461ac3])[_0xe5347f(0x41a)];if(_0x3cc9d7>0x5*0x400*0x400){if(!confirm('内容较大（超过5MB），保存可能需要较长时间。是否继续？'))return;}_0x3cc9d7>0x400*0x400&&showToast(_0xe5347f(0x540),_0xe5347f(0x2422));let _0x3ff929;editingWorldbook?_0x3ff929=editingWorldbook[_0xe5347f(0x58b)]:_0x3ff929=window[_0xe5347f(0x24a3)];const _0x30d7ab={'id':editingWorldbook?editingWorldbook['id']:Date[_0xe5347f(0x18e0)]()['toString'](),'title':_0x532566,'content':_0x461ac3,'isGlobal':_0x3ff929,'createdAt':editingWorldbook?editingWorldbook[_0xe5347f(0xd70)]:new Date()[_0xe5347f(0xa4b)](),'updatedAt':new Date()['toISOString']()};if(editingWorldbook){const _0x1c316c=worldbooks[_0xe5347f(0x23ba)](_0x1490bd=>_0x1490bd['id']===editingWorldbook['id']);if(_0x1c316c!==-0x1)worldbooks[_0x1c316c]=_0x30d7ab;}else worldbooks[_0xe5347f(0x6ee)](_0x30d7ab);await saveWorldbooks(),renderWorldbookList(),showToast(editingWorldbook?'世界书已更新！':_0xe5347f(0x100c),_0xe5347f(0xb27)),hideWorldbookForm();}catch(_0x5f1021){console[_0xe5347f(0x24ab)]('保存世界书失败:',_0x5f1021),showToast(_0xe5347f(0x145c)+_0x5f1021[_0xe5347f(0xd7a)],_0xe5347f(0x24ab));}}async function toggleGlobalWorldbook(_0x1d7f20,_0x48b804){const _0x250803=_0x2cf6d4;!window['activeGlobalWorldbooks']&&(window['activeGlobalWorldbooks']=[]);_0x48b804?!window[_0x250803(0xfb9)][_0x250803(0x23ec)](_0x1d7f20)&&window[_0x250803(0xfb9)][_0x250803(0x6ee)](_0x1d7f20):window['activeGlobalWorldbooks']=window[_0x250803(0xfb9)][_0x250803(0x803)](_0x5d7d66=>_0x5d7d66!==_0x1d7f20);try{await db['globalSettings'][_0x250803(0x53a)]({'id':_0x250803(0x9de),'activeGlobalWorldbooks':window[_0x250803(0xfb9)]}),console[_0x250803(0xc0d)](_0x250803(0x1512),window[_0x250803(0xfb9)]),showToast(_0x250803(0x12cf),_0x250803(0xb27));}catch(_0x353e3b){console[_0x250803(0x24ab)](_0x250803(0xe8),_0x353e3b),showToast('设置保存失败','error');}}function editWorldbook(_0x32e7d5){const _0x13ee54=_0x2cf6d4;try{const _0x14986b=worldbooks['find'](_0x22b311=>_0x22b311['id']===_0x32e7d5);if(!_0x14986b){console['error'](_0x13ee54(0xb3b),_0x32e7d5),showToast(_0x13ee54(0x17fc),_0x13ee54(0x24ab));return;}if(_0x14986b){editingWorldbook=_0x14986b;let _0x11d916;_0x14986b['isGlobal']?_0x11d916=_0x13ee54(0x1071):_0x11d916=_0x13ee54(0x590);document[_0x13ee54(0x566)](_0x13ee54(0xcee))[_0x13ee54(0x21dc)]=_0x11d916,document['getElementById'](_0x13ee54(0x211b))['value']=_0x14986b[_0x13ee54(0x1c18)]||_0x14986b['name'];const _0x24ed85=_0x14986b[_0x13ee54(0x1423)]||'',_0x420f45=new Blob([_0x24ed85])[_0x13ee54(0x41a)];if(_0x420f45>0x400*0x400){if(!confirm(_0x13ee54(0x19da)))return;}setTimeout(()=>{const _0xdb9e6a=_0x13ee54;try{document['getElementById']('worldbook-content')[_0xdb9e6a(0xc34)]=_0x24ed85;}catch(_0x24f410){console[_0xdb9e6a(0x24ab)](_0xdb9e6a(0x24b7),_0x24f410),showToast('内容加载失败，请重试',_0xdb9e6a(0x24ab)),hideWorldbookForm();}},0x32),showApp(_0x13ee54(0x2361));}}catch(_0x40852d){console['error'](_0x13ee54(0x1bc4),_0x40852d),showToast(_0x13ee54(0x2568)+_0x40852d['message'],'error');}}async function deleteWorldbook(_0xb46e21){const _0xf853f8=_0x2cf6d4;if(confirm(_0xf853f8(0x236a))){console[_0xf853f8(0xc0d)](_0xf853f8(0x1a8a),_0xb46e21),console[_0xf853f8(0xc0d)](_0xf853f8(0xe3a),worldbooks[_0xf853f8(0xf6d)](_0xbea55c=>({'id':_0xbea55c['id'],'name':_0xbea55c[_0xf853f8(0x222f)]||_0xbea55c[_0xf853f8(0x1c18)]})));const _0x39de6a=worldbooks[_0xf853f8(0xcbf)];worldbooks=worldbooks['filter'](_0x4757ad=>_0x4757ad['id']!==_0xb46e21);const _0x5d83d4=worldbooks[_0xf853f8(0xcbf)];console['log'](_0xf853f8(0x1865)+_0x39de6a+_0xf853f8(0x14e4)+_0x5d83d4+_0xf853f8(0x1e1d)+(_0x39de6a-_0x5d83d4)+_0xf853f8(0x3e8));if(_0x39de6a===_0x5d83d4){console['warn']('⚠️\x20删除失败：未找到要删除的世界书'),showToast(_0xf853f8(0x4ff),'error');return;}try{await saveWorldbooks(),console[_0xf853f8(0xc0d)](_0xf853f8(0x730)),showToast(_0xf853f8(0x1532),_0xf853f8(0xb27));}catch(_0x37cca6){console[_0xf853f8(0x24ab)](_0xf853f8(0x1943),_0x37cca6),showToast(_0xf853f8(0x1a7a),_0xf853f8(0x24ab));}renderWorldbookList();}}function renderWorldbookList(){const _0x48cadc=_0x2cf6d4,_0x16505f=document['getElementById'](_0x48cadc(0x2544)),_0x10f8bd=document[_0x48cadc(0x566)](_0x48cadc(0x1822));if(!_0x16505f||!_0x10f8bd)return;const _0x1eb241=worldbooks[_0x48cadc(0x803)](_0x3da63c=>_0x3da63c[_0x48cadc(0x58b)]),_0x4f72b8=worldbooks[_0x48cadc(0x803)](_0xc127d5=>!_0xc127d5['isGlobal']);let _0x279ae1='',_0x37a4fa='';_0x279ae1+=_0x48cadc(0x1009),_0x1eb241[_0x48cadc(0xcbf)]>0x0?_0x1eb241[_0x48cadc(0x900)](_0x211128=>{const _0x30a218=_0x48cadc,_0x2157b1=Array['isArray'](window[_0x30a218(0xfb9)])&&window[_0x30a218(0xfb9)][_0x30a218(0x23ec)](_0x211128['id'])?'checked':'',_0x1a2e8d=new Date(_0x211128[_0x30a218(0x2222)]||_0x211128[_0x30a218(0xd70)]||Date['now']()),_0x24ce21=isNaN(_0x1a2e8d[_0x30a218(0xa57)]())?_0x30a218(0x187c):_0x1a2e8d['toLocaleDateString'](),_0x48bc2a=truncateText(_0x211128[_0x30a218(0x1423)],0x3c);_0x279ae1+=_0x30a218(0x20cf)+_0x211128['id']+'\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22worldbook-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22worldbook-content-flex\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22worldbook-title\x22>'+(_0x211128['title']||_0x211128['name'])+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22worldbook-desc-text\x22>'+_0x48bc2a+_0x30a218(0xf78)+_0x24ce21+_0x30a218(0x1ac6)+_0x211128['id']+_0x30a218(0x1a0f)+_0x211128['id']+_0x30a218(0x4b4)+_0x2157b1+_0x30a218(0x18c2);}):_0x279ae1+=_0x48cadc(0x136a),_0x279ae1+=_0x48cadc(0xa54),_0x37a4fa+=_0x48cadc(0x1009),_0x4f72b8[_0x48cadc(0xcbf)]>0x0?_0x4f72b8[_0x48cadc(0x900)](_0x14a093=>{const _0x403a1c=_0x48cadc,_0x5f3534=new Date(_0x14a093[_0x403a1c(0x2222)]||_0x14a093[_0x403a1c(0xd70)]||Date[_0x403a1c(0x18e0)]()),_0x4194a1=isNaN(_0x5f3534['getTime']())?'未知日期':_0x5f3534['toLocaleDateString'](),_0x58efbb=truncateText(_0x14a093[_0x403a1c(0x1423)],0x3c);_0x37a4fa+=_0x403a1c(0x20cf)+_0x14a093['id']+_0x403a1c(0xb9c)+(_0x14a093[_0x403a1c(0x1c18)]||_0x14a093[_0x403a1c(0x222f)])+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22worldbook-desc-text\x22>'+_0x58efbb+_0x403a1c(0xf78)+_0x4194a1+_0x403a1c(0xb98)+_0x14a093['id']+_0x403a1c(0x7dd);}):_0x37a4fa+=_0x48cadc(0x99e),_0x37a4fa+=_0x48cadc(0xa54),_0x16505f['innerHTML']=_0x279ae1,_0x10f8bd[_0x48cadc(0xc02)]=_0x37a4fa;}function switchWorldbookTab(_0xc8af47){const _0x273c8b=_0x2cf6d4;currentWorldbookTab=_0xc8af47;const _0x5d79d2=document[_0x273c8b(0x566)](_0x273c8b(0x2544)),_0x5b30a7=document['getElementById'](_0x273c8b(0x1822)),_0x743037=document[_0x273c8b(0x1ed9)](_0x273c8b(0x2365));_0x743037[_0x273c8b(0x900)](_0xc56031=>{const _0x14d9ec=_0x273c8b;_0xc56031['getAttribute'](_0x14d9ec(0x11cf))['includes'](_0xc8af47)?_0xc56031[_0x14d9ec(0x226e)]['add'](_0x14d9ec(0x105d)):_0xc56031[_0x14d9ec(0x226e)]['remove'](_0x14d9ec(0x105d));}),_0x5d79d2['style']['display']=_0x273c8b(0xfe9),_0x5b30a7['style']['display']=_0x273c8b(0xfe9);if(_0xc8af47===_0x273c8b(0x3d8))_0x5d79d2[_0x273c8b(0x655)]['display']=_0x273c8b(0x2d4);else _0xc8af47===_0x273c8b(0x443)&&(_0x5b30a7[_0x273c8b(0x655)][_0x273c8b(0x2526)]=_0x273c8b(0x2d4));renderWorldbookList();}function onWorldbookAddClick(){const _0x1dc68e=_0x2cf6d4;if(currentWorldbookTab==='global')showWorldbookForm(!![]);else currentWorldbookTab===_0x1dc68e(0x443)&&showWorldbookForm(![]);}function debugWorldbooks(){const _0xe85e65=_0x2cf6d4;return console[_0xe85e65(0xc0d)](_0xe85e65(0x213c)),worldbooks['forEach']((_0x48b559,_0x3043b3)=>{const _0x349483=_0xe85e65;console['log'](_0x3043b3+0x1+_0x349483(0xb2f)+_0x48b559['id']+_0x349483(0x2084)+(_0x48b559[_0x349483(0x222f)]||_0x48b559[_0x349483(0x1c18)])+_0x349483(0xae5)+_0x48b559[_0x349483(0x1470)]+_0x349483(0x1911)+_0x48b559[_0x349483(0x1dd5)]+'\x22,\x20全局:\x20'+_0x48b559[_0x349483(0x58b)]);}),console[_0xe85e65(0xc0d)](_0xe85e65(0x242c)+worldbooks[_0xe85e65(0xcbf)]+_0xe85e65(0x18f4)),worldbooks;}async function clearAllWorldbooks(){const _0xbac1dc=_0x2cf6d4;if(confirm(_0xbac1dc(0x259))){console[_0xbac1dc(0xc0d)](_0xbac1dc(0x458));const _0x4c9101=worldbooks[_0xbac1dc(0xcbf)];worldbooks=[],await saveWorldbooks(),renderWorldbookList(),showToast(_0xbac1dc(0x1c92)+_0x4c9101+_0xbac1dc(0x118b),_0xbac1dc(0xb27)),console[_0xbac1dc(0xc0d)](_0xbac1dc(0x2486));}}async function fixWorldbookIds(){const _0x51b709=_0x2cf6d4;console[_0x51b709(0xc0d)](_0x51b709(0x177e));let _0x367fb2=0x0;return worldbooks[_0x51b709(0x900)]((_0x506adb,_0x4f0346)=>{const _0x2400c4=_0x51b709;(!_0x506adb['id']||typeof _0x506adb['id']!=='string')&&(_0x506adb['id']='fixed_'+Date[_0x2400c4(0x18e0)]()+'_'+_0x4f0346,_0x367fb2++,console['log'](_0x2400c4(0x1a7f)+(_0x506adb['name']||_0x506adb[_0x2400c4(0x1c18)])+'\x22\x20的ID'));}),_0x367fb2>0x0?(await saveWorldbooks(),renderWorldbookList(),showToast('修复了'+_0x367fb2+_0x51b709(0x235c),_0x51b709(0xb27))):console[_0x51b709(0xc0d)]('所有世界书ID都正常'),_0x367fb2;}function parseLRC(_0x4ea6ef){const _0x2863df=_0x2cf6d4;if(!_0x4ea6ef)return{'lyrics':['♪\x20暂无歌词'],'timings':[]};const _0x41817a=_0x4ea6ef[_0x2863df(0x633)]('\x0a'),_0x44674d=[],_0x23d841=[],_0x34556c=/\[(\d{2}):(\d{2})\.(\d{2,3})\]/g;for(const _0x2fbe66 of _0x41817a){let _0x2f0fc6;const _0x27d350=[];while((_0x2f0fc6=_0x34556c[_0x2863df(0x254e)](_0x2fbe66))!==null){const _0x51a17d=parseInt(_0x2f0fc6[0x1]),_0x43715a=parseInt(_0x2f0fc6[0x2]),_0x424d8b=parseInt(_0x2f0fc6[0x3]['padEnd'](0x3,'0')),_0x223988=_0x51a17d*0x3c+_0x43715a+_0x424d8b/0x3e8;_0x27d350[_0x2863df(0x6ee)](_0x223988);}const _0x55e216=_0x2fbe66[_0x2863df(0x882)](/\[\d{2}:\d{2}\.\d{2,3}\]/g,'')[_0x2863df(0x1424)]();if(_0x55e216&&!_0x55e216[_0x2863df(0x1cab)]('[')){if(_0x27d350['length']>0x0)for(const _0x1d2e8f of _0x27d350){_0x44674d[_0x2863df(0x6ee)](_0x55e216),_0x23d841['push'](_0x1d2e8f);}else _0x44674d['push'](_0x55e216),_0x23d841['push'](null);}}if(_0x23d841[_0x2863df(0x184b)](_0xf95b69=>_0xf95b69!==null)){const _0x3f5c88=_0x44674d[_0x2863df(0xf6d)]((_0x5c378e,_0x171ec3)=>({'text':_0x5c378e,'time':_0x23d841[_0x171ec3]}))[_0x2863df(0x803)](_0x38de6f=>_0x38de6f[_0x2863df(0x8e1)]!==null)['sort']((_0xd49a47,_0x39260f)=>_0xd49a47[_0x2863df(0x8e1)]-_0x39260f[_0x2863df(0x8e1)]);return{'lyrics':_0x3f5c88[_0x2863df(0xf6d)](_0x5da9c6=>_0x5da9c6[_0x2863df(0x1e58)]),'timings':_0x3f5c88[_0x2863df(0xf6d)](_0x2643bd=>_0x2643bd[_0x2863df(0x8e1)]),'hasTimings':!![]};}return{'lyrics':_0x44674d['length']>0x0?_0x44674d:[_0x2863df(0x141a)],'timings':[],'hasTimings':![]};}function parseNeteaseBin(_0x1f3366){const _0xf787=_0x2cf6d4;try{const _0x273187=new Uint8Array(_0x1f3366);let _0x318a0f=0x0;while(_0x318a0f<_0x273187[_0xf787(0xcbf)]-0x4){if(_0x273187[_0x318a0f]===0x7b||(_0x273187[_0x318a0f]^0x64)===0x7b||(_0x273187[_0x318a0f]^0x4e)===0x7b)break;_0x318a0f++;}const _0x2bb5f2=[()=>new TextDecoder(_0xf787(0x15f))[_0xf787(0x121f)](_0x273187['slice'](_0x318a0f)),()=>{const _0x534149=_0xf787;let _0x4a5a1f='';for(let _0x4104b3=_0x318a0f;_0x4104b3<_0x273187[_0x534149(0xcbf)];_0x4104b3++){_0x4a5a1f+=String[_0x534149(0x13ab)](_0x273187[_0x4104b3]^0x64);}return _0x4a5a1f;},()=>{const _0x851afd=_0xf787;let _0x57c32a='';for(let _0x1218f0=_0x318a0f;_0x1218f0<_0x273187[_0x851afd(0xcbf)];_0x1218f0++){_0x57c32a+=String[_0x851afd(0x13ab)](_0x273187[_0x1218f0]^0x4e);}return _0x57c32a;}];for(const _0x5647b4 of _0x2bb5f2){try{const _0x33e3ed=_0x5647b4();try{const _0x59c23e=JSON[_0xf787(0x168e)](_0x33e3ed);if(_0x59c23e[_0xf787(0x3ff)])return parseLRC(_0x59c23e[_0xf787(0x3ff)]);if(_0x59c23e[_0xf787(0x1cc3)]&&_0x59c23e[_0xf787(0x1cc3)][_0xf787(0x3ff)])return parseLRC(_0x59c23e[_0xf787(0x1cc3)][_0xf787(0x3ff)]);}catch(_0x38c326){if(_0x33e3ed['includes']('[')&&_0x33e3ed['includes'](']'))return parseLRC(_0x33e3ed);}}catch(_0xa09f67){continue;}}return{'lyrics':[_0xf787(0x85d),_0xf787(0x2045)],'timings':[],'hasTimings':![]};}catch(_0x3844a7){return console[_0xf787(0x24ab)](_0xf787(0x196c),_0x3844a7),{'lyrics':[_0xf787(0xaba)],'timings':[],'hasTimings':![]};}}let musicPlayer={'isPlaying':![],'currentSong':null,'playlist':[],'currentIndex':0x0,'currentTime':0x0,'totalTime':0x0,'isVinylMode':!![],'currentLyricIndex':0x0,'listeningStartTime':null,'totalListeningTime':0x0,'playMode':_0x2cf6d4(0x1aa3),'audioElement':null,'albumCover':null,'listeningTimer':null,'activeChatId':null,'isActive':![],'audioCache':new Map(),'maxCacheSize':0x3};function getAudioUrl(_0x234065){const _0x49d761=_0x2cf6d4;if(!_0x234065['isLocalFile']||!_0x234065['url'][_0x49d761(0x1cab)](_0x49d761(0x1784)))return _0x234065[_0x49d761(0x10c6)];return console[_0x49d761(0xc0d)]('🎵\x20使用本地文件base64\x20URL:',_0x234065[_0x49d761(0x1c18)]),logMemoryUsage(_0x49d761(0x2460)),_0x234065[_0x49d761(0x10c6)];}function clearAudioCache(){const _0x51a48e=_0x2cf6d4;for(const [_0x2e3e6b,_0x107f39]of musicPlayer['audioCache']){_0x107f39[_0x51a48e(0x1cab)](_0x51a48e(0xef))&&URL[_0x51a48e(0x2101)](_0x107f39),console[_0x51a48e(0xc0d)](_0x51a48e(0x86e),_0x2e3e6b);}musicPlayer[_0x51a48e(0x146d)][_0x51a48e(0x2215)]();}function logMemoryUsage(_0x47e2aa=''){const _0x3ca87a=_0x2cf6d4;if(performance[_0x3ca87a(0x1790)]){const _0x3644b2=performance[_0x3ca87a(0x1790)],_0x184c2c=Math[_0x3ca87a(0x5f3)](_0x3644b2[_0x3ca87a(0x1e3)]/0x400/0x400),_0x2a1b3a=Math[_0x3ca87a(0x5f3)](_0x3644b2[_0x3ca87a(0x122a)]/0x400/0x400),_0x397eea=Math['round'](_0x3644b2['jsHeapSizeLimit']/0x400/0x400);console[_0x3ca87a(0xc0d)](_0x3ca87a(0x33e)+_0x47e2aa+':\x20'+_0x184c2c+'MB\x20/\x20'+_0x2a1b3a+'MB\x20(限制:\x20'+_0x397eea+_0x3ca87a(0x21cf)),_0x184c2c/_0x397eea>0.8&&console['warn']('⚠️\x20内存使用过高，建议清理缓存');}};async function initializeMusicPlayer(){const _0x5165b5=_0x2cf6d4;try{const _0x3644c8=await db[_0x5165b5(0x13ac)]['orderBy']('addedTime')['toArray']();musicPlayer[_0x5165b5(0xcbb)]=_0x3644c8;if(_0x3644c8[_0x5165b5(0xcbf)]>0x0&&!musicPlayer['currentSong']){const _0x534a6c=_0x3644c8[0x0];let _0x117782=null;if(_0x534a6c[_0x5165b5(0x780)]){const _0x91d16d=await db[_0x5165b5(0x1235)][_0x5165b5(0x46a)](_0x534a6c[_0x5165b5(0x780)]);_0x91d16d&&(_0x117782=_0x91d16d['imageData']);}musicPlayer[_0x5165b5(0xbbd)]={..._0x534a6c,'coverImageData':_0x117782},musicPlayer[_0x5165b5(0xd73)]=0x0;}}catch(_0x481abf){console['error'](_0x5165b5(0xba5),_0x481abf),musicPlayer[_0x5165b5(0xcbb)]=[];}const _0x33c840=document[_0x5165b5(0x566)](_0x5165b5(0x1328)),_0x1cbc8e=document[_0x5165b5(0x566)]('modal-total-time');if(_0x33c840)_0x33c840['textContent']='0:00';if(_0x1cbc8e)_0x1cbc8e[_0x5165b5(0x21dc)]='0:00';}async function openMusicPlayer(){const _0x5beb54=_0x2cf6d4;await initializeMusicPlayer();const _0x3f828a=document[_0x5beb54(0x566)](_0x5beb54(0x4c8)),_0x213c8f=document[_0x5beb54(0x566)]('music-status-display'),_0x8cc3a4=document['getElementById']('phone-screen');if(_0x3f828a&&_0x8cc3a4){const _0x3a6472=_0x8cc3a4[_0x5beb54(0xb37)]();_0x3f828a[_0x5beb54(0x655)][_0x5beb54(0x15f7)]=_0x3a6472[_0x5beb54(0x15f7)]+'px',_0x3f828a['style'][_0x5beb54(0x1466)]=_0x3a6472[_0x5beb54(0x1466)]+'px',_0x3f828a[_0x5beb54(0x655)]['width']=_0x3a6472[_0x5beb54(0xaab)]+'px',_0x3f828a[_0x5beb54(0x655)][_0x5beb54(0x16b8)]=_0x3a6472[_0x5beb54(0x16b8)]+'px',_0x3f828a[_0x5beb54(0x655)]['display']=_0x5beb54(0x2d4),updatePlayerBackground();}_0x213c8f&&(_0x213c8f[_0x5beb54(0x655)][_0x5beb54(0x2526)]=_0x5beb54(0x1f0b));!musicPlayer[_0x5beb54(0xbbd)]&&musicPlayer[_0x5beb54(0xcbb)]['length']>0x0&&(musicPlayer[_0x5beb54(0xbbd)]=musicPlayer[_0x5beb54(0xcbb)][0x0],musicPlayer['currentIndex']=0x0,updateMusicDisplay());musicPlayer['activeChatId']=currentChatCharacter?currentChatCharacter['id']:null;const _0x15d1f8=!musicPlayer[_0x5beb54(0x17d9)];musicPlayer['isActive']=!![],_0x15d1f8&&(musicPlayer[_0x5beb54(0x1635)]=0x0),startListeningTimer(),updateListeningTime(),updatePlayModeButton(),updateMusicDisplay(),updateLyrics();}function closeMusicModal(){const _0x11fb85=_0x2cf6d4,_0x3e5e3c=document[_0x11fb85(0x566)](_0x11fb85(0x4c8));_0x3e5e3c['style'][_0x11fb85(0x2526)]=_0x11fb85(0xfe9);}function closeMusicPlayer(){const _0x4b16b1=_0x2cf6d4,_0x116fee=document[_0x4b16b1(0x566)](_0x4b16b1(0x4c8)),_0x417712=document[_0x4b16b1(0x566)](_0x4b16b1(0x1120));if(_0x116fee)_0x116fee[_0x4b16b1(0x655)][_0x4b16b1(0x2526)]=_0x4b16b1(0xfe9);if(_0x417712)_0x417712[_0x4b16b1(0x655)]['display']=_0x4b16b1(0xfe9);musicPlayer[_0x4b16b1(0x1565)]&&(musicPlayer[_0x4b16b1(0x1565)][_0x4b16b1(0x21f0)](),musicPlayer[_0x4b16b1(0x1565)][_0x4b16b1(0x107)]='',musicPlayer[_0x4b16b1(0x1565)]=null);clearAudioCache(),musicPlayer[_0x4b16b1(0x21ea)]=![],musicPlayer[_0x4b16b1(0x17d9)]=![],stopListeningTimer();const _0x25265f=document[_0x4b16b1(0x566)](_0x4b16b1(0x11b3)),_0x18346a=document[_0x4b16b1(0x566)](_0x4b16b1(0x13fa));if(_0x25265f)_0x25265f[_0x4b16b1(0x226e)][_0x4b16b1(0x128)](_0x4b16b1(0x171e));if(_0x18346a)_0x18346a[_0x4b16b1(0x226e)][_0x4b16b1(0x128)](_0x4b16b1(0x171e));const _0x4d0dc0=document[_0x4b16b1(0x566)](_0x4b16b1(0x1c66));if(_0x4d0dc0)_0x4d0dc0['innerHTML']='<i\x20class=\x22fas\x20fa-play\x22></i>';console[_0x4b16b1(0xc0d)](_0x4b16b1(0x1e70));}function togglePlayback(){const _0x4c6866=_0x2cf6d4;if(!musicPlayer[_0x4c6866(0x1565)]&&musicPlayer[_0x4c6866(0xcbb)][_0x4c6866(0xcbf)]>0x0){musicPlayer[_0x4c6866(0xd73)]=0x0;const _0x2b38bc=musicPlayer['playlist'][0x0];playSongFromPlaylist(_0x2b38bc);return;}if(musicPlayer['playlist'][_0x4c6866(0xcbf)]===0x0)return;musicPlayer['isPlaying']=!musicPlayer[_0x4c6866(0x21ea)];const _0x5a26be=document['getElementById'](_0x4c6866(0x1c66)),_0x140a97=document[_0x4c6866(0x566)]('vinyl-disc'),_0xc64bd3=document[_0x4c6866(0x566)]('tonearm'),_0x40fe2b=document[_0x4c6866(0x15b8)]('.music-icon');if(musicPlayer[_0x4c6866(0x21ea)]){_0x5a26be['innerHTML']='<i\x20class=\x22fas\x20fa-pause\x22></i>',_0x140a97[_0x4c6866(0x226e)][_0x4c6866(0xe1)](_0x4c6866(0x171e)),_0xc64bd3[_0x4c6866(0x226e)][_0x4c6866(0xe1)](_0x4c6866(0x171e));if(_0x40fe2b)_0x40fe2b['style'][_0x4c6866(0x4ce)]=_0x4c6866(0xf34);musicPlayer[_0x4c6866(0x1565)]&&musicPlayer['audioElement'][_0x4c6866(0x10f4)]()[_0x4c6866(0x9e5)](_0x2878c9=>{const _0x462241=_0x4c6866;console[_0x462241(0x24ab)](_0x462241(0x1d68),_0x2878c9),musicPlayer[_0x462241(0x21ea)]=![],_0x5a26be[_0x462241(0xc02)]='<i\x20class=\x22fas\x20fa-play\x22></i>',_0x140a97[_0x462241(0x226e)][_0x462241(0x128)](_0x462241(0x171e)),_0xc64bd3[_0x462241(0x226e)][_0x462241(0x128)](_0x462241(0x171e));if(_0x40fe2b)_0x40fe2b[_0x462241(0x655)][_0x462241(0x4ce)]='musicPulse\x202s\x20ease-in-out\x20infinite';alert(_0x462241(0x841)+_0x2878c9[_0x462241(0xd7a)]+'\x0a请检查音频文件是否有效');}),musicPlayer[_0x4c6866(0x1565)]&&musicPlayer['audioElement']['currentTime']===0x0&&(musicPlayer[_0x4c6866(0x1217)]=0x0,musicPlayer[_0x4c6866(0x124f)]=0x0,updateLyrics()),startPlaybackSimulation();}else{_0x5a26be[_0x4c6866(0xc02)]=_0x4c6866(0x19f7),_0x140a97['classList'][_0x4c6866(0x128)]('playing'),_0xc64bd3[_0x4c6866(0x226e)][_0x4c6866(0x128)](_0x4c6866(0x171e));if(_0x40fe2b)_0x40fe2b[_0x4c6866(0x655)]['animation']=_0x4c6866(0x16c9);musicPlayer[_0x4c6866(0x1565)]&&musicPlayer['audioElement'][_0x4c6866(0x21f0)]();}}async function previousTrack(){const _0x2165f9=_0x2cf6d4;if(musicPlayer[_0x2165f9(0xcbb)]['length']===0x0)return;const _0x4dafe7=musicPlayer[_0x2165f9(0xd73)];musicPlayer[_0x2165f9(0xd73)]=musicPlayer[_0x2165f9(0xd73)]>0x0?musicPlayer['currentIndex']-0x1:musicPlayer[_0x2165f9(0xcbb)][_0x2165f9(0xcbf)]-0x1;const _0x45ca63=musicPlayer[_0x2165f9(0xcbb)][musicPlayer[_0x2165f9(0xd73)]];let _0x209f32=null;if(_0x45ca63[_0x2165f9(0x780)])try{const _0x123c64=await db['musicCovers'][_0x2165f9(0x46a)](_0x45ca63[_0x2165f9(0x780)]);_0x123c64&&(_0x209f32=_0x123c64[_0x2165f9(0xfe5)]);}catch(_0x31b137){console[_0x2165f9(0x24ab)](_0x2165f9(0xeb),_0x31b137);}musicPlayer['currentSong']={..._0x45ca63,'coverImageData':_0x209f32},musicPlayer[_0x2165f9(0x1217)]=0x0,musicPlayer['currentLyricIndex']=0x0;if(musicPlayer[_0x2165f9(0x1565)]){const _0x2c2be9=musicPlayer['isPlaying'],_0xc68bb1=await switchToSong(_0x45ca63,_0x2c2be9);!_0xc68bb1&&(musicPlayer[_0x2165f9(0x21ea)]=![]);}updateMusicDisplay(),musicPlayer[_0x2165f9(0x21ea)]&&startPlaybackSimulation();}async function nextTrack(){const _0x3229b9=_0x2cf6d4;if(musicPlayer[_0x3229b9(0xcbb)][_0x3229b9(0xcbf)]===0x0)return;let _0x425846;switch(musicPlayer['playMode']){case _0x3229b9(0x214f):_0x425846=Math['floor'](Math[_0x3229b9(0x191c)]()*musicPlayer[_0x3229b9(0xcbb)][_0x3229b9(0xcbf)]);break;case _0x3229b9(0x1003):_0x425846=musicPlayer['currentIndex'];break;case _0x3229b9(0xc62):_0x425846=musicPlayer['currentIndex']<musicPlayer[_0x3229b9(0xcbb)]['length']-0x1?musicPlayer[_0x3229b9(0xd73)]+0x1:0x0;break;case _0x3229b9(0x1aa3):default:_0x425846=musicPlayer['currentIndex']<musicPlayer['playlist'][_0x3229b9(0xcbf)]-0x1?musicPlayer[_0x3229b9(0xd73)]+0x1:musicPlayer[_0x3229b9(0xd73)];break;}const _0x1c2b8d=musicPlayer[_0x3229b9(0xd73)];musicPlayer[_0x3229b9(0xd73)]=_0x425846;const _0x5a6624=musicPlayer[_0x3229b9(0xcbb)][musicPlayer[_0x3229b9(0xd73)]];let _0x16295f=null;if(_0x5a6624['coverImage'])try{const _0x4b05f1=await db[_0x3229b9(0x1235)][_0x3229b9(0x46a)](_0x5a6624[_0x3229b9(0x780)]);_0x4b05f1&&(_0x16295f=_0x4b05f1[_0x3229b9(0xfe5)]);}catch(_0x4f520f){console['error'](_0x3229b9(0xeb),_0x4f520f);}musicPlayer[_0x3229b9(0xbbd)]={..._0x5a6624,'coverImageData':_0x16295f},musicPlayer[_0x3229b9(0x1217)]=0x0,musicPlayer[_0x3229b9(0x124f)]=0x0;if(musicPlayer[_0x3229b9(0x1565)]){const _0x885a4d=await switchToSong(_0x5a6624,!![]);_0x885a4d?musicPlayer[_0x3229b9(0x21ea)]=!![]:musicPlayer['isPlaying']=![];}updateMusicDisplay(),startPlaybackSimulation();}function toggleMusicView(){const _0x3a2394=_0x2cf6d4;musicPlayer[_0x3a2394(0x16b4)]=!musicPlayer[_0x3a2394(0x16b4)];const _0x9ff8bd=document[_0x3a2394(0x566)]('vinyl-mode'),_0x54affc=document[_0x3a2394(0x566)]('lyrics-mode'),_0x54ab03=document[_0x3a2394(0x566)](_0x3a2394(0x1247)),_0x10c7e1=document['querySelector'](_0x3a2394(0x1c8f));if(musicPlayer[_0x3a2394(0x16b4)]){_0x9ff8bd[_0x3a2394(0x655)]['display']=_0x3a2394(0x2d4),_0x54affc[_0x3a2394(0x655)][_0x3a2394(0x2526)]=_0x3a2394(0xfe9);if(_0x10c7e1)_0x10c7e1[_0x3a2394(0x655)][_0x3a2394(0x2526)]=_0x3a2394(0x2d4);_0x54ab03[_0x3a2394(0xc02)]=_0x3a2394(0xd4d);}else{_0x9ff8bd[_0x3a2394(0x655)][_0x3a2394(0x2526)]=_0x3a2394(0xfe9),_0x54affc[_0x3a2394(0x655)][_0x3a2394(0x2526)]=_0x3a2394(0x2d4);if(_0x10c7e1)_0x10c7e1[_0x3a2394(0x655)][_0x3a2394(0x2526)]='none';_0x54ab03[_0x3a2394(0xc02)]=_0x3a2394(0x24c5),setTimeout(()=>{const _0x3b7822=_0x3a2394,_0x431953=document[_0x3b7822(0x566)]('full-lyrics-display');_0x431953&&(_0x431953[_0x3b7822(0xc02)]=''),updateLyrics();},0x64);}musicPlayer[_0x3a2394(0x16b4)]&&updateLyrics();}function updateMusicDisplay(){const _0x3da577=_0x2cf6d4;if(!musicPlayer[_0x3da577(0xbbd)])return;const _0x190bb1=musicPlayer[_0x3da577(0xbbd)];document[_0x3da577(0x566)](_0x3da577(0x20bd))[_0x3da577(0x21dc)]='♪\x20'+_0x190bb1[_0x3da577(0x1c18)]+_0x3da577(0x2316)+_0x190bb1[_0x3da577(0x2252)],document[_0x3da577(0x566)](_0x3da577(0xc88))[_0x3da577(0x21dc)]=_0x190bb1[_0x3da577(0x1c18)],document['getElementById']('vinyl-artist-name')['textContent']=_0x190bb1[_0x3da577(0x2252)],document['getElementById'](_0x3da577(0x12f3))[_0x3da577(0x21dc)]=_0x190bb1[_0x3da577(0x1c18)],document[_0x3da577(0x566)](_0x3da577(0x1046))['textContent']=_0x190bb1[_0x3da577(0x2252)];const _0x4953ea=document[_0x3da577(0x566)](_0x3da577(0x487));if(_0x4953ea){const _0x1453da=musicPlayer[_0x3da577(0x1565)]?musicPlayer['audioElement'][_0x3da577(0x1ff)]:0x0;_0x1453da&&!isNaN(_0x1453da)&&_0x1453da>0x0?_0x4953ea['textContent']=formatMusicTime(_0x1453da):_0x4953ea[_0x3da577(0x21dc)]=_0x3da577(0x609);}const _0x20d3eb=document[_0x3da577(0x566)](_0x3da577(0x1328));if(_0x20d3eb){const _0x58c25e=musicPlayer[_0x3da577(0x1565)]?musicPlayer[_0x3da577(0x1565)][_0x3da577(0x1217)]:0x0;_0x58c25e&&!isNaN(_0x58c25e)&&_0x58c25e>=0x0?_0x20d3eb[_0x3da577(0x21dc)]=formatMusicTime(_0x58c25e):_0x20d3eb[_0x3da577(0x21dc)]=_0x3da577(0x609);}const _0x472780=document[_0x3da577(0x566)](_0x3da577(0xd18));if(_0x472780&&musicPlayer[_0x3da577(0x1565)]){const _0xfba589=musicPlayer[_0x3da577(0x1565)]['currentTime']||0x0,_0x10eb60=musicPlayer['audioElement'][_0x3da577(0x1ff)]||0x0;if(_0x10eb60>0x0){const _0x2eff0e=_0xfba589/_0x10eb60*0x64;_0x472780[_0x3da577(0x655)]['width']=_0x2eff0e+'%';}}updateListeningTime(),updateVinylCover(),updateLyrics(),updatePlayerBackground();}function seekToLyric(_0x22c138){const _0x593bb7=_0x2cf6d4;if(!musicPlayer[_0x593bb7(0x1565)]||!musicPlayer['currentSong']||!musicPlayer[_0x593bb7(0xbbd)][_0x593bb7(0xfe8)])return;const _0xc2c829=musicPlayer[_0x593bb7(0x1565)][_0x593bb7(0x1ff)],_0x343787=musicPlayer[_0x593bb7(0xbbd)][_0x593bb7(0xfe8)][_0x593bb7(0xcbf)];if(_0xc2c829&&_0x343787>0x0){const _0x5cdcb7=Math[_0x593bb7(0x21f7)](_0xc2c829*0.03,0x5),_0x5d4d74=_0xc2c829*0.02,_0x4d6ebe=_0xc2c829-_0x5cdcb7-_0x5d4d74;let _0x51212f;if(_0x22c138===0x0)_0x51212f=_0x5cdcb7;else{if(_0x22c138===_0x343787-0x1)_0x51212f=_0xc2c829-_0x5d4d74;else{const _0x56bb2d=_0x22c138/_0x343787;_0x51212f=_0x5cdcb7+_0x56bb2d*_0x4d6ebe;}}musicPlayer['audioElement'][_0x593bb7(0x1217)]=Math[_0x593bb7(0x21f7)](Math[_0x593bb7(0x910)](_0x51212f,0x0),_0xc2c829),musicPlayer[_0x593bb7(0x1217)]=_0x51212f,musicPlayer[_0x593bb7(0x124f)]=_0x22c138,updateLyrics();}}function formatMusicTime(_0x641f62){const _0x10bba3=_0x2cf6d4;if(!_0x641f62||isNaN(_0x641f62)||_0x641f62<=0x0)return _0x10bba3(0x609);const _0x1c4225=Math[_0x10bba3(0x1dac)](_0x641f62/0x3c),_0x3b3d83=Math[_0x10bba3(0x1dac)](_0x641f62%0x3c);return _0x1c4225+':'+_0x3b3d83[_0x10bba3(0x9a3)]()[_0x10bba3(0x863)](0x2,'0');}function startListeningTimer(){const _0x3e62a0=_0x2cf6d4;musicPlayer[_0x3e62a0(0x797)]&&clearInterval(musicPlayer['listeningTimer']),musicPlayer[_0x3e62a0(0x797)]=setInterval(()=>{const _0x550f82=_0x3e62a0;musicPlayer[_0x550f82(0x21ea)]&&musicPlayer[_0x550f82(0x17d9)]&&(musicPlayer[_0x550f82(0x1635)]+=0x1,updateListeningTime());},0x3e8);}function pauseListeningTimer(){const _0x41ac1e=_0x2cf6d4;musicPlayer['listeningTimer']&&(clearInterval(musicPlayer[_0x41ac1e(0x797)]),musicPlayer[_0x41ac1e(0x797)]=null);}function stopListeningTimer(){const _0x5a4b98=_0x2cf6d4;musicPlayer['listeningTimer']&&(clearInterval(musicPlayer['listeningTimer']),musicPlayer['listeningTimer']=null),musicPlayer[_0x5a4b98(0x1635)]=0x0;}function getMusicPlayingStatus(_0x233c71){const _0x360e13=_0x2cf6d4;if(!musicPlayer['isActive']||musicPlayer[_0x360e13(0x3b7)]!==_0x233c71)return null;const _0x261eac=Math[_0x360e13(0x1dac)](musicPlayer[_0x360e13(0x1635)]/0x3c),_0x2b657e=musicPlayer[_0x360e13(0x1635)]%0x3c;let _0x56136a=null;if(musicPlayer[_0x360e13(0xbbd)]&&musicPlayer['currentSong'][_0x360e13(0xfe8)]){const _0x57913d=musicPlayer[_0x360e13(0xbbd)]['lyrics'],_0x419743=musicPlayer[_0x360e13(0x124f)]||0x0;let _0x1fb573=_0x57913d[_0x419743]||_0x57913d[0x0]||_0x360e13(0x141a);if(musicPlayer[_0x360e13(0xbbd)]['hasTimedLyrics']&&musicPlayer['currentSong'][_0x360e13(0x196f)]&&musicPlayer[_0x360e13(0x1565)]&&!musicPlayer[_0x360e13(0x1565)]['paused']){const _0x1c39f3=musicPlayer[_0x360e13(0x1565)]['currentTime'],_0x14c2ec=musicPlayer[_0x360e13(0xbbd)][_0x360e13(0x196f)];let _0x25d9a7=0x0;for(let _0xb9bb5a=0x0;_0xb9bb5a<_0x14c2ec[_0x360e13(0xcbf)];_0xb9bb5a++){if(_0x1c39f3>=_0x14c2ec[_0xb9bb5a])_0x25d9a7=_0xb9bb5a;else break;}_0x1fb573=_0x57913d[_0x25d9a7]||_0x1fb573;}_0x56136a={'hasLyrics':!![],'currentLyric':_0x1fb573,'allLyrics':_0x57913d,'hasTimedLyrics':musicPlayer[_0x360e13(0xbbd)][_0x360e13(0xac5)]||![],'totalLines':_0x57913d[_0x360e13(0xcbf)]};}return{'isPlaying':musicPlayer['isPlaying'],'isListening':musicPlayer[_0x360e13(0x17d9)],'currentSong':musicPlayer[_0x360e13(0xbbd)]?{'title':musicPlayer[_0x360e13(0xbbd)]['title'],'artist':musicPlayer[_0x360e13(0xbbd)][_0x360e13(0x2252)],'album':musicPlayer[_0x360e13(0xbbd)][_0x360e13(0x563)],'lyrics':_0x56136a}:null,'listeningDuration':{'minutes':_0x261eac,'seconds':_0x2b657e,'total':musicPlayer[_0x360e13(0x1635)],'formatted':_0x261eac+'分'+_0x2b657e+'秒'}};}function updateLyrics(){const _0x1e9d44=_0x2cf6d4,_0x579cc5=document[_0x1e9d44(0x566)](_0x1e9d44(0x941));if(!musicPlayer[_0x1e9d44(0xbbd)]||!musicPlayer[_0x1e9d44(0xbbd)][_0x1e9d44(0xfe8)]||musicPlayer[_0x1e9d44(0xbbd)][_0x1e9d44(0xfe8)]['length']===0x0){_0x579cc5&&(_0x579cc5['textContent']=musicPlayer[_0x1e9d44(0x21ea)]?_0x1e9d44(0x17f2):'♪\x20点击播放开始听歌');const _0xe409bb=document[_0x1e9d44(0x566)](_0x1e9d44(0x20bd));_0xe409bb&&(_0xe409bb[_0x1e9d44(0x21dc)]=musicPlayer[_0x1e9d44(0x21ea)]?_0x1e9d44(0x17f2):_0x1e9d44(0x14b3));return;}const _0xbc329b=musicPlayer['currentSong'][_0x1e9d44(0xfe8)];let _0x211b7d=musicPlayer['currentLyricIndex'];if(musicPlayer['currentSong']['hasTimedLyrics']&&musicPlayer[_0x1e9d44(0xbbd)][_0x1e9d44(0x196f)]&&musicPlayer[_0x1e9d44(0x1565)]&&!musicPlayer['audioElement'][_0x1e9d44(0x20d5)]){const _0x26caa7=musicPlayer[_0x1e9d44(0x1565)]['currentTime'],_0x5a133e=musicPlayer[_0x1e9d44(0xbbd)][_0x1e9d44(0x196f)];let _0x263aa8=0x0;for(let _0x25568e=0x0;_0x25568e<_0x5a133e[_0x1e9d44(0xcbf)];_0x25568e++){if(_0x26caa7>=_0x5a133e[_0x25568e])_0x263aa8=_0x25568e;else break;}_0x211b7d=_0x263aa8,musicPlayer[_0x1e9d44(0x124f)]=_0x211b7d;}const _0x4d2531=_0xbc329b[_0x211b7d]||'♪';_0x579cc5&&(_0x579cc5[_0x1e9d44(0x21dc)]=_0x4d2531);const _0x4bbf9c=document[_0x1e9d44(0x566)](_0x1e9d44(0x20bd));_0x4bbf9c&&(_0x4bbf9c[_0x1e9d44(0x21dc)]=_0x4d2531);const _0x574e26=document[_0x1e9d44(0x566)](_0x1e9d44(0x2171));_0x574e26&&(_0x574e26[_0x1e9d44(0x21dc)]=_0x4d2531);const _0x492e42=document['getElementById'](_0x1e9d44(0x1e27));if(_0x492e42){const _0x47f20f=_0x492e42[_0x1e9d44(0x1ed9)](_0x1e9d44(0x10b8));if(_0x47f20f['length']!==_0xbc329b[_0x1e9d44(0xcbf)]){const _0xc07a3d=_0xbc329b['map']((_0x5ba4d6,_0x36a1aa)=>{const _0x12d7a9=_0x1e9d44,_0x17cc53=_0x5ba4d6['trim']()==='';return _0x12d7a9(0x852)+(_0x17cc53?_0x12d7a9(0xaa0):'')+_0x12d7a9(0x1b28)+_0x36a1aa+_0x12d7a9(0x17a1)+_0x36a1aa+')\x22>'+(_0x5ba4d6||'&nbsp;')+_0x12d7a9(0xa54);})[_0x1e9d44(0x140c)]('');_0x492e42[_0x1e9d44(0xc02)]=_0xc07a3d;}const _0x3d9b31=_0x492e42[_0x1e9d44(0x1ed9)](_0x1e9d44(0x10b8));_0x3d9b31[_0x1e9d44(0x900)]((_0x3cc739,_0x42cd1d)=>{const _0x1cf29f=_0x1e9d44;_0x3cc739['classList'][_0x1cf29f(0xfbd)](_0x1cf29f(0x105d),_0x42cd1d===_0x211b7d);});if(!musicPlayer[_0x1e9d44(0x16b4)]){const _0x433633=document[_0x1e9d44(0x15b8)]('.full-lyrics-container'),_0xf92de9=document['getElementById'](_0x1e9d44(0x1d12));if(_0x433633&&_0xf92de9&&_0xf92de9[_0x1e9d44(0x655)][_0x1e9d44(0x2526)]!==_0x1e9d44(0xfe9)){const _0x3faf43=_0x492e42[_0x1e9d44(0x15b8)]('.lyric-line.active');if(_0x3faf43&&_0x211b7d>=0x0){const _0x6de2b7=_0x433633[_0x1e9d44(0x199d)],_0x121306=_0x6de2b7/0x3-_0x3faf43[_0x1e9d44(0x2e2)]-_0x3faf43['offsetHeight']/0x2;_0x492e42[_0x1e9d44(0x655)][_0x1e9d44(0x2006)]='translateY('+_0x121306+'px)';}}}}}function startPlaybackSimulation(){const _0x4e07b8=_0x2cf6d4;if(!musicPlayer['isPlaying'])return;const _0x1c6829=setInterval(()=>{const _0x3e0e4a=_0x3a81;if(!musicPlayer[_0x3e0e4a(0x21ea)]){clearInterval(_0x1c6829);return;}if(musicPlayer['audioElement']&&!musicPlayer['audioElement']['paused']){musicPlayer[_0x3e0e4a(0x1217)]=Math[_0x3e0e4a(0x1dac)](musicPlayer['audioElement']['currentTime']);const _0x4c7e02=musicPlayer[_0x3e0e4a(0x1565)][_0x3e0e4a(0x1ff)]||0x12c,_0x53f9c9=musicPlayer[_0x3e0e4a(0x1217)]/_0x4c7e02*0x64;document[_0x3e0e4a(0x566)](_0x3e0e4a(0xd18))[_0x3e0e4a(0x655)][_0x3e0e4a(0xaab)]=Math[_0x3e0e4a(0x21f7)](_0x53f9c9,0x64)+'%';if(musicPlayer[_0x3e0e4a(0x1565)]['ended']){clearInterval(_0x1c6829);if(musicPlayer['repeatMode']===_0x3e0e4a(0x20c9))musicPlayer['audioElement']['currentTime']=0x0,musicPlayer[_0x3e0e4a(0x1565)][_0x3e0e4a(0x10f4)]();else(musicPlayer[_0x3e0e4a(0x1ebc)]===_0x3e0e4a(0x2339)||musicPlayer[_0x3e0e4a(0x1ebc)]===_0x3e0e4a(0xfe9))&&nextTrack();return;}}else{musicPlayer[_0x3e0e4a(0x1217)]+=0x1;const _0x5246b2=0x12c,_0x370520=musicPlayer[_0x3e0e4a(0x1217)]/_0x5246b2*0x64,_0x3f17d5=document['getElementById'](_0x3e0e4a(0xd18));_0x3f17d5&&(_0x3f17d5['style'][_0x3e0e4a(0xaab)]=Math[_0x3e0e4a(0x21f7)](_0x370520,0x64)+'%');const _0x19c314=document['getElementById'](_0x3e0e4a(0x1328)),_0x23b287=document[_0x3e0e4a(0x566)](_0x3e0e4a(0x487));if(_0x19c314)_0x19c314[_0x3e0e4a(0x21dc)]=formatMusicTime(musicPlayer[_0x3e0e4a(0x1217)]);if(_0x23b287)_0x23b287[_0x3e0e4a(0x21dc)]=formatMusicTime(_0x5246b2);if(musicPlayer['currentTime']>=_0x5246b2){clearInterval(_0x1c6829);switch(musicPlayer[_0x3e0e4a(0xd7b)]){case'loop-one':musicPlayer['currentTime']=0x0,startPlaybackSimulation();break;case _0x3e0e4a(0xc62):case'shuffle':nextTrack();break;case _0x3e0e4a(0x1aa3):musicPlayer['currentIndex']<musicPlayer[_0x3e0e4a(0xcbb)][_0x3e0e4a(0xcbf)]-0x1?nextTrack():(musicPlayer[_0x3e0e4a(0x21ea)]=![],updateMusicDisplay());break;}return;}}if(musicPlayer[_0x3e0e4a(0xbbd)]&&musicPlayer['currentSong'][_0x3e0e4a(0xfe8)]&&musicPlayer[_0x3e0e4a(0xbbd)][_0x3e0e4a(0xfe8)][_0x3e0e4a(0xcbf)]>0x0){let _0xf79099=0x0;if(musicPlayer[_0x3e0e4a(0xbbd)][_0x3e0e4a(0xac5)]&&musicPlayer[_0x3e0e4a(0xbbd)][_0x3e0e4a(0x196f)]){const _0x4c79b7=musicPlayer[_0x3e0e4a(0x1565)]?musicPlayer[_0x3e0e4a(0x1565)][_0x3e0e4a(0x1217)]:musicPlayer[_0x3e0e4a(0x1217)],_0x669f4=musicPlayer[_0x3e0e4a(0xbbd)][_0x3e0e4a(0x196f)],_0x384e9b=_0x4c79b7;for(let _0x3dbc89=0x0;_0x3dbc89<_0x669f4[_0x3e0e4a(0xcbf)];_0x3dbc89++){if(_0x384e9b>=_0x669f4[_0x3dbc89])_0xf79099=_0x3dbc89;else break;}}else{const _0x3c7391=musicPlayer['audioElement']?musicPlayer[_0x3e0e4a(0x1565)][_0x3e0e4a(0x1ff)]:0x12c,_0x103def=musicPlayer[_0x3e0e4a(0xbbd)][_0x3e0e4a(0xfe8)][_0x3e0e4a(0xcbf)],_0x231449=musicPlayer[_0x3e0e4a(0x1217)];if(_0x3c7391>0x0&&_0x103def>0x0){const _0x578413=_0x3c7391/_0x103def,_0x324ec7=_0x231449;_0xf79099=Math[_0x3e0e4a(0x21f7)](Math[_0x3e0e4a(0x910)](Math[_0x3e0e4a(0x1dac)](_0x324ec7/_0x578413),0x0),_0x103def-0x1);}}_0xf79099!==musicPlayer[_0x3e0e4a(0x124f)]&&(musicPlayer[_0x3e0e4a(0x124f)]=_0xf79099,updateLyrics());}},musicPlayer['currentSong']&&musicPlayer[_0x4e07b8(0xbbd)][_0x4e07b8(0xac5)]?0xc8:0x1f4);}function getCurrentCharacterName(){const _0x3e72ed=_0x2cf6d4;if(currentChatCharacter)return currentChatCharacter[_0x3e72ed(0x222f)];return'你';}function updateListeningTime(){const _0x24e9cd=_0x2cf6d4,_0x35ac0f=document['getElementById']('listening-duration');if(_0x35ac0f&&musicPlayer['isActive']){const _0x40e507=Math[_0x24e9cd(0x1dac)](musicPlayer[_0x24e9cd(0x1635)]/0x3c);let _0x34508c='你';currentChatCharacter&&(_0x34508c=currentChatCharacter['name']);const _0x1e0e95=_0x24e9cd(0x162d)+_0x40e507+_0x24e9cd(0x1e3f);_0x35ac0f[_0x24e9cd(0x21dc)]=_0x1e0e95;}}function openMusicModal(){openMusicPlayer();}function extractImageColors(_0x481124){return new Promise(_0xead695=>{const _0x3270b0=_0x3a81,_0x31fc9d=document[_0x3270b0(0x1ad8)](_0x3270b0(0x1def)),_0x1c737b=_0x31fc9d[_0x3270b0(0x20ff)]('2d');_0x31fc9d[_0x3270b0(0xaab)]=0x32,_0x31fc9d[_0x3270b0(0x16b8)]=0x32,_0x1c737b['drawImage'](_0x481124,0x0,0x0,0x32,0x32);const _0x3b2d08=_0x1c737b[_0x3270b0(0x2174)](0x0,0x0,0x32,0x32),_0x34481a=_0x3b2d08[_0x3270b0(0x4f2)];let _0x113437=0x0,_0x11293f=0x0,_0xb65ac0=0x0,_0x2b0464=0x0;for(let _0x449b1b=0x0;_0x449b1b<_0x34481a['length'];_0x449b1b+=0x4){_0x113437+=_0x34481a[_0x449b1b],_0x11293f+=_0x34481a[_0x449b1b+0x1],_0xb65ac0+=_0x34481a[_0x449b1b+0x2],_0x2b0464++;}_0x113437=Math['floor'](_0x113437/_0x2b0464),_0x11293f=Math[_0x3270b0(0x1dac)](_0x11293f/_0x2b0464),_0xb65ac0=Math[_0x3270b0(0x1dac)](_0xb65ac0/_0x2b0464),_0xead695({'r':_0x113437,'g':_0x11293f,'b':_0xb65ac0});});}function updatePlayerBackground(){const _0x519615=_0x2cf6d4,_0xa956ad=document['getElementById'](_0x519615(0x4c8)),_0x5f32a0=document['querySelector']('.music-modal-content'),_0x1a514c=document['getElementById'](_0x519615(0x967));_0x1a514c&&_0x1a514c[_0x519615(0x107)]&&!_0x1a514c[_0x519615(0x107)][_0x519615(0x23ec)](_0x519615(0x20fb))&&_0x1a514c[_0x519615(0x655)][_0x519615(0x2526)]!=='none'?extractImageColors(_0x1a514c)[_0x519615(0x1ccc)](_0x34f997=>{const _0x5dd0dd=_0x519615,{r:_0x373b2e,g:_0x42db1c,b:_0x3e9cb4}=_0x34f997,_0x152645=_0x5dd0dd(0x838)+_0x373b2e+',\x20'+_0x42db1c+',\x20'+_0x3e9cb4+',\x200.3)';_0x5f32a0&&(_0x5f32a0[_0x5dd0dd(0x655)][_0x5dd0dd(0xc3c)]=_0x152645,_0x5f32a0['style'][_0x5dd0dd(0x1cfe)]='blur(30px)\x20saturate(1.5)',_0x5f32a0[_0x5dd0dd(0x655)]['webkitBackdropFilter']=_0x5dd0dd(0xe9e));}):_0x5f32a0&&(_0x5f32a0[_0x519615(0x655)][_0x519615(0xc3c)]=_0x519615(0x1a0b),_0x5f32a0[_0x519615(0x655)][_0x519615(0x1cfe)]=_0x519615(0xe9e),_0x5f32a0[_0x519615(0x655)][_0x519615(0x718)]=_0x519615(0xe9e));}function togglePlayMode(){const _0x3f4114=_0x2cf6d4,_0x20d36b=['sequential','loop-all',_0x3f4114(0x1003),'shuffle'],_0x4cca0f=_0x20d36b[_0x3f4114(0x167a)](musicPlayer[_0x3f4114(0xd7b)]||'sequential'),_0x3d2816=(_0x4cca0f+0x1)%_0x20d36b['length'];musicPlayer['playMode']=_0x20d36b[_0x3d2816],updatePlayModeButton();}function updatePlayModeButton(){const _0x2a2e09=_0x2cf6d4,_0x13a498=document[_0x2a2e09(0x566)]('play-mode-btn'),_0xd7e511=_0x13a498[_0x2a2e09(0x15b8)]('i');switch(musicPlayer[_0x2a2e09(0xd7b)]){case'sequential':_0xd7e511[_0x2a2e09(0x221)]=_0x2a2e09(0x1660),_0x13a498[_0x2a2e09(0x1c18)]=_0x2a2e09(0x9db),_0x13a498['classList'][_0x2a2e09(0x128)](_0x2a2e09(0x105d));const _0x25aff8=_0x13a498['querySelector'](_0x2a2e09(0x1236));if(_0x25aff8)_0x25aff8['remove']();break;case _0x2a2e09(0xc62):_0xd7e511['className']='fas\x20fa-redo',_0x13a498[_0x2a2e09(0x1c18)]='列表循环',_0x13a498['classList'][_0x2a2e09(0x128)]('active');const _0x6d662e=_0x13a498[_0x2a2e09(0x15b8)](_0x2a2e09(0x1236));if(_0x6d662e)_0x6d662e[_0x2a2e09(0x128)]();break;case _0x2a2e09(0x1003):_0xd7e511[_0x2a2e09(0x221)]=_0x2a2e09(0x95b),_0x13a498[_0x2a2e09(0x1c18)]=_0x2a2e09(0x2118),_0x13a498[_0x2a2e09(0x226e)][_0x2a2e09(0x128)]('active');if(!_0x13a498['querySelector'](_0x2a2e09(0x1236))){const _0x273cf5=document[_0x2a2e09(0x1ad8)](_0x2a2e09(0x213b));_0x273cf5[_0x2a2e09(0x221)]=_0x2a2e09(0xf79),_0x273cf5['textContent']='1',_0x13a498[_0x2a2e09(0x1925)](_0x273cf5);}break;case _0x2a2e09(0x214f):_0xd7e511[_0x2a2e09(0x221)]='fas\x20fa-random',_0x13a498[_0x2a2e09(0x1c18)]=_0x2a2e09(0x5f7),_0x13a498[_0x2a2e09(0x226e)][_0x2a2e09(0x128)](_0x2a2e09(0x105d));const _0x2b0fd5=_0x13a498[_0x2a2e09(0x15b8)](_0x2a2e09(0x1236));if(_0x2b0fd5)_0x2b0fd5[_0x2a2e09(0x128)]();break;}}function toggleRepeat(){const _0x4d02f6=_0x2cf6d4,_0x1efa30=[_0x4d02f6(0xfe9),_0x4d02f6(0x20c9),'all'],_0x14b43a=_0x1efa30[_0x4d02f6(0x167a)](musicPlayer[_0x4d02f6(0x1ebc)]||_0x4d02f6(0xfe9)),_0x9b7c30=(_0x14b43a+0x1)%_0x1efa30[_0x4d02f6(0xcbf)];musicPlayer[_0x4d02f6(0x1ebc)]=_0x1efa30[_0x9b7c30];const _0x2ba2b1=document[_0x4d02f6(0x566)](_0x4d02f6(0x22c3)),_0x28bff2={'none':'fas\x20fa-redo','one':_0x4d02f6(0x1030),'all':_0x4d02f6(0xb7f)};_0x2ba2b1[_0x4d02f6(0xc02)]='<i\x20class=\x22'+_0x28bff2[musicPlayer[_0x4d02f6(0x1ebc)]]+'\x22></i>',_0x2ba2b1[_0x4d02f6(0x226e)]['toggle']('active',musicPlayer[_0x4d02f6(0x1ebc)]!==_0x4d02f6(0xfe9));const _0x1e2496={'sequential':_0x4d02f6(0x9db),'loop':_0x4d02f6(0x2118),'random':_0x4d02f6(0x5f7)};console[_0x4d02f6(0xc0d)](_0x4d02f6(0xcc7)+_0x1e2496[musicPlayer['playMode']]);}function openPlaylistModal(){const _0x3a1504=_0x2cf6d4,_0x3151b8=document[_0x3a1504(0x566)](_0x3a1504(0x2466));_0x3151b8&&(_0x3151b8[_0x3a1504(0x655)][_0x3a1504(0x2526)]=_0x3a1504(0x1f0b),loadPlaylistItems());}function closePlaylistModal(){const _0x120f44=_0x2cf6d4,_0x50d075=document[_0x120f44(0x566)]('playlist-modal');_0x50d075&&(_0x50d075[_0x120f44(0x655)]['display']=_0x120f44(0xfe9));}async function loadPlaylistItems(){const _0x4987fb=_0x2cf6d4;try{const _0x3be517=await db['musicPlaylist'][_0x4987fb(0x1902)](_0x4987fb(0x24bc))[_0x4987fb(0x18c6)](),_0x44cb31=document['getElementById']('playlist-items');if(!_0x44cb31)return;_0x44cb31[_0x4987fb(0xc02)]='';if(_0x3be517['length']===0x0){_0x44cb31[_0x4987fb(0xc02)]=_0x4987fb(0x30d);return;}_0x3be517[_0x4987fb(0x900)]((_0x46e033,_0x56e895)=>{const _0x4abde9=_0x4987fb,_0x4eb3d0=document[_0x4abde9(0x1ad8)]('div');_0x4eb3d0['className']=_0x4abde9(0xbc0),_0x4eb3d0['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22song-number\x22>'+(_0x56e895+0x1)+_0x4abde9(0x1cc0)+_0x46e033[_0x4abde9(0x1c18)]+_0x4abde9(0xba0)+_0x46e033[_0x4abde9(0x2252)]+_0x4abde9(0x2383)+_0x46e033['id']+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-play\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22removeSongFromPlaylist(\x27'+_0x46e033['id']+_0x4abde9(0x239c);const _0x4a59f2=_0x4eb3d0[_0x4abde9(0x15b8)](_0x4abde9(0x1932));_0x4a59f2[_0x4abde9(0x167)](_0x4abde9(0x1e62),_0x4de9fd=>{_0x4de9fd['stopPropagation'](),playSongFromPlaylist(_0x46e033);}),_0x44cb31[_0x4abde9(0x1925)](_0x4eb3d0);});}catch(_0x21be18){console[_0x4987fb(0x24ab)](_0x4987fb(0xe6c),_0x21be18);}}async function addCustomSong(){const _0x575242=_0x2cf6d4,_0x39c2cd=document[_0x575242(0x566)](_0x575242(0x218c)),_0x1ce64c=document[_0x575242(0x566)]('song-title-input'),_0x2af664=document[_0x575242(0x566)](_0x575242(0x1072)),_0x566b2a=document[_0x575242(0x566)]('song-cover-input'),_0xdeadba=document[_0x575242(0x566)](_0x575242(0x21b0)),_0x255b0b=document['getElementById'](_0x575242(0x24fb));let _0x47154c=_0x39c2cd[_0x575242(0xc34)][_0x575242(0x1424)]();const _0x400b36=_0x1ce64c['value'][_0x575242(0x1424)](),_0x11a018=_0x2af664[_0x575242(0xc34)][_0x575242(0x1424)]();let _0x9ff5a0=![];if(_0xdeadba['files']&&_0xdeadba['files'][0x0]){const _0x5f0c8d=_0xdeadba[_0x575242(0x173e)][0x0];try{_0x5f0c8d[_0x575242(0x41a)]<0xa*0x400*0x400?(_0x47154c=await new Promise((_0x4db0be,_0x33318e)=>{const _0x2fb8b1=_0x575242,_0x540db9=new FileReader();_0x540db9[_0x2fb8b1(0xc28)]=_0x3f9c6f=>_0x4db0be(_0x3f9c6f[_0x2fb8b1(0x1144)][_0x2fb8b1(0x1fff)]),_0x540db9[_0x2fb8b1(0x1795)]=_0x33318e,_0x540db9[_0x2fb8b1(0x145e)](_0x5f0c8d);}),console[_0x575242(0xc0d)]('🎵\x20小文件已转换为base64格式')):(_0x47154c=URL[_0x575242(0x17c3)](_0x5f0c8d),console[_0x575242(0xc0d)](_0x575242(0x679)),alert(_0x575242(0x1ee0))),_0x9ff5a0=!![];}catch(_0x50c88e){console[_0x575242(0x24ab)]('处理本地音乐文件失败:',_0x50c88e),alert(_0x575242(0x1d8c));return;}!_0x400b36&&(_0x1ce64c[_0x575242(0xc34)]=_0x5f0c8d[_0x575242(0x222f)][_0x575242(0x882)](/\.[^/.]+$/,''));}if(!_0x47154c||!_0x1ce64c[_0x575242(0xc34)]['trim']()||!_0x11a018){alert(_0x575242(0x1d20));return;}try{const _0x45c13f=Date['now']()['toString']();let _0x28aea0=null;if(_0x566b2a['files']&&_0x566b2a[_0x575242(0x173e)][0x0]){const _0x21f13c=_0x566b2a[_0x575242(0x173e)][0x0],_0xfc9dc7=new FileReader();await new Promise((_0x349e33,_0x28c58e)=>{const _0x2688c9=_0x575242;_0xfc9dc7[_0x2688c9(0xc28)]=async _0x4675e0=>{const _0x3db41b=_0x2688c9;try{_0x28aea0=_0x3db41b(0x2e6)+_0x45c13f,await db[_0x3db41b(0x1235)][_0x3db41b(0xe1)]({'id':_0x28aea0,'songId':_0x45c13f,'imageData':_0x4675e0['target'][_0x3db41b(0x1fff)],'timestamp':Date[_0x3db41b(0x18e0)]()}),_0x349e33();}catch(_0x562e83){_0x28c58e(_0x562e83);}},_0xfc9dc7[_0x2688c9(0x1795)]=_0x28c58e,_0xfc9dc7[_0x2688c9(0x145e)](_0x21f13c);});}let _0x5f46ff=[];if(_0x255b0b[_0x575242(0x173e)]&&_0x255b0b[_0x575242(0x173e)][0x0]){const _0x996b4a=_0x255b0b[_0x575242(0x173e)][0x0],_0x5d5435=_0x996b4a[_0x575242(0x222f)][_0x575242(0x1d64)]();if(_0x5d5435[_0x575242(0xd7e)](_0x575242(0x16e6))){const _0xcb8462=await new Promise((_0x595916,_0xff4f38)=>{const _0x4122d3=_0x575242,_0x26d856=new FileReader();_0x26d856[_0x4122d3(0xc28)]=_0x31d19f=>_0x595916(_0x31d19f[_0x4122d3(0x1144)]['result']),_0x26d856[_0x4122d3(0x1795)]=_0xff4f38,_0x26d856[_0x4122d3(0x170f)](_0x996b4a,_0x4122d3(0x15f));}),_0x3eecfd=parseLRC(_0xcb8462);_0x5f46ff=_0x3eecfd['lyrics'],_0x3eecfd[_0x575242(0x20f1)]&&(window[_0x575242(0x1061)]=_0x3eecfd[_0x575242(0x1e6b)]);}else{if(_0x5d5435[_0x575242(0xd7e)](_0x575242(0x53b))){const _0x3b232c=await new Promise((_0x26b250,_0x9020a0)=>{const _0x23fe45=_0x575242,_0xca24e0=new FileReader();_0xca24e0[_0x23fe45(0xc28)]=_0x448642=>_0x26b250(_0x448642[_0x23fe45(0x1144)][_0x23fe45(0x1fff)]),_0xca24e0[_0x23fe45(0x1795)]=_0x9020a0,_0xca24e0[_0x23fe45(0xfc5)](_0x996b4a);}),_0x2a6fec=parseNeteaseBin(_0x3b232c);_0x5f46ff=_0x2a6fec['lyrics'],_0x2a6fec[_0x575242(0x20f1)]&&(window['tempLyricsTimings']=_0x2a6fec['timings']);}else{const _0x4d1ae2=await new Promise((_0x136f6f,_0x3d38)=>{const _0x25edb1=_0x575242,_0x1ef3d6=new FileReader();_0x1ef3d6['onload']=_0x40ac6f=>_0x136f6f(_0x40ac6f['target'][_0x25edb1(0x1fff)]),_0x1ef3d6[_0x25edb1(0x1795)]=_0x3d38,_0x1ef3d6[_0x25edb1(0x170f)](_0x996b4a,_0x25edb1(0x15f));});_0x5f46ff=_0x4d1ae2['split']('\x0a')['map'](_0x4bf359=>_0x4bf359[_0x575242(0x1424)]())['filter'](_0x24ee98=>_0x24ee98['length']>0x0);}}}_0x5f46ff[_0x575242(0xcbf)]===0x0&&(_0x5f46ff=[_0x575242(0x141a)]);await db[_0x575242(0x13ac)]['add']({'id':_0x45c13f,'title':_0x1ce64c['value']['trim'](),'artist':_0x11a018,'album':'','duration':_0x575242(0x609),'url':_0x47154c,'isLocalFile':_0x9ff5a0,'coverImage':_0x28aea0,'lyrics':_0x5f46ff,'lyricsTimings':window['tempLyricsTimings']||[],'hasTimedLyrics':!!(window[_0x575242(0x1061)]&&window[_0x575242(0x1061)][_0x575242(0xcbf)]>0x0),'addedTime':Date[_0x575242(0x18e0)]()}),delete window[_0x575242(0x1061)],_0x39c2cd[_0x575242(0xc34)]='',_0x1ce64c[_0x575242(0xc34)]='',_0x2af664[_0x575242(0xc34)]='',_0x566b2a[_0x575242(0xc34)]='',_0xdeadba[_0x575242(0xc34)]='',_0x255b0b[_0x575242(0xc34)]='';const _0x369ed1=document[_0x575242(0x566)](_0x575242(0x1969));_0x369ed1&&(_0x369ed1[_0x575242(0x655)][_0x575242(0x2526)]=_0x575242(0xfe9));const _0x18f25e=document[_0x575242(0x15b8)]('.file-input-text');_0x18f25e&&(_0x18f25e[_0x575242(0x21dc)]='未选封面'),await loadPlaylistItems(),alert(_0x575242(0xaea));}catch(_0x4acc50){console[_0x575242(0x24ab)](_0x575242(0x115e),_0x4acc50),alert(_0x575242(0x39f));}}async function removeSongFromPlaylist(_0x15e330){const _0x3aae7e=_0x2cf6d4;if(!confirm('确定要删除这首歌曲吗？'))return;try{await db[_0x3aae7e(0x13ac)][_0x3aae7e(0xc2b)](_0x15e330);const _0xecc4aa=await db['musicCovers'][_0x3aae7e(0x4a6)](_0x3aae7e(0x54c))[_0x3aae7e(0x14a)](_0x15e330)[_0x3aae7e(0x2200)]();_0xecc4aa&&await db['musicCovers'][_0x3aae7e(0xc2b)](_0xecc4aa['id']),await loadPlaylistItems(),musicPlayer[_0x3aae7e(0xbbd)]&&musicPlayer[_0x3aae7e(0xbbd)]['id']===_0x15e330&&(musicPlayer[_0x3aae7e(0xbbd)]=null,musicPlayer[_0x3aae7e(0x21ea)]=![],updateMusicDisplay());}catch(_0x59bd80){console[_0x3aae7e(0x24ab)](_0x3aae7e(0x1ea2),_0x59bd80),alert(_0x3aae7e(0xf9c));}}async function playSongFromPlaylist(_0x5844df){const _0x5cb753=_0x2cf6d4;try{const _0x3f2d02=musicPlayer[_0x5cb753(0xcbb)]['findIndex'](_0x1dc127=>_0x1dc127['id']===_0x5844df['id']);_0x3f2d02!==-0x1&&(musicPlayer[_0x5cb753(0xd73)]=_0x3f2d02);let _0x525c17=null;if(_0x5844df[_0x5cb753(0x780)]){const _0x219687=await db[_0x5cb753(0x1235)]['get'](_0x5844df[_0x5cb753(0x780)]);_0x219687&&(_0x525c17=_0x219687[_0x5cb753(0xfe5)]);}musicPlayer[_0x5cb753(0x1565)]&&(musicPlayer[_0x5cb753(0x1565)][_0x5cb753(0x21f0)](),musicPlayer[_0x5cb753(0x1565)][_0x5cb753(0x107)]='',musicPlayer['audioElement'][_0x5cb753(0x1f3d)](),musicPlayer[_0x5cb753(0x1565)][_0x5cb753(0xbec)]=null,musicPlayer['audioElement'][_0x5cb753(0x1795)]=null,musicPlayer[_0x5cb753(0x1565)][_0x5cb753(0x1944)]=null,musicPlayer[_0x5cb753(0x1565)]['onpause']=null,musicPlayer[_0x5cb753(0x1565)][_0x5cb753(0x1606)]=null,musicPlayer['audioElement'][_0x5cb753(0x12c0)]=null,musicPlayer[_0x5cb753(0x1565)]=null,window['gc']&&window['gc'](),console['log']('🧹\x20音频对象已清理'),logMemoryUsage(_0x5cb753(0x1f1a)));if(_0x5844df['url']&&_0x5844df[_0x5cb753(0x10c6)][_0x5cb753(0x1424)]()!==''){!musicPlayer['audioElement']&&(musicPlayer['audioElement']=new Audio(),console[_0x5cb753(0xc0d)](_0x5cb753(0x22c7)));const _0x709f74=musicPlayer[_0x5cb753(0x1565)];_0x709f74[_0x5cb753(0x107)]=getAudioUrl(_0x5844df),_0x709f74[_0x5cb753(0x1f3d)](),_0x709f74[_0x5cb753(0x167)]('loadedmetadata',function(){const _0x583bab=_0x5cb753;musicPlayer['totalTime']=_0x709f74[_0x583bab(0x1ff)],console[_0x583bab(0xc0d)]('歌曲加载成功，时长:',_0x709f74[_0x583bab(0x1ff)]),updateMusicDisplay();const _0x19e2ca=document['getElementById'](_0x583bab(0x487));_0x19e2ca&&_0x709f74['duration']&&!isNaN(_0x709f74[_0x583bab(0x1ff)])&&_0x709f74[_0x583bab(0x1ff)]>0x0&&(_0x19e2ca[_0x583bab(0x21dc)]=formatMusicTime(_0x709f74[_0x583bab(0x1ff)]));}),_0x709f74[_0x5cb753(0x167)](_0x5cb753(0x24ab),function(_0x3865f3){const _0x4cc948=_0x5cb753;if(!_0x709f74['src']||_0x709f74['src']===''||_0x709f74[_0x4cc948(0x107)]===window[_0x4cc948(0x63b)][_0x4cc948(0xe1d)]){console[_0x4cc948(0xc0d)](_0x4cc948(0x236f));return;}console[_0x4cc948(0x24ab)]('音频加载失败:',_0x3865f3),musicPlayer[_0x4cc948(0x21ea)]=![],updateMusicDisplay(),alert('音频加载失败，请检查URL是否有效');}),_0x709f74[_0x5cb753(0x167)](_0x5cb753(0x10f4),function(){const _0x18531e=_0x5cb753;musicPlayer[_0x18531e(0x21ea)]=!![],updateMusicDisplay(),startListeningTimer();}),_0x709f74[_0x5cb753(0x167)](_0x5cb753(0x21f0),function(){const _0x331f6a=_0x5cb753;musicPlayer[_0x331f6a(0x21ea)]=![],updateMusicDisplay(),pauseListeningTimer();}),_0x709f74[_0x5cb753(0x167)](_0x5cb753(0xccf),function(){const _0x50271a=_0x5cb753;switch(musicPlayer[_0x50271a(0xd7b)]){case _0x50271a(0x1003):_0x709f74['currentTime']=0x0,_0x709f74[_0x50271a(0x10f4)]()[_0x50271a(0x9e5)](console[_0x50271a(0x24ab)]),musicPlayer['isPlaying']=!![];break;case'sequential':musicPlayer[_0x50271a(0xd73)]<musicPlayer[_0x50271a(0xcbb)][_0x50271a(0xcbf)]-0x1?nextTrack():musicPlayer['isPlaying']=![];break;case _0x50271a(0xc62):case _0x50271a(0x214f):nextTrack();break;}updateMusicDisplay();}),_0x709f74['addEventListener']('timeupdate',function(){const _0x471d16=_0x5cb753;musicPlayer[_0x471d16(0x1217)]=_0x709f74[_0x471d16(0x1217)],updateMusicDisplay();const _0x168a33=document[_0x471d16(0x566)](_0x471d16(0x1328)),_0xb9fd44=document[_0x471d16(0x566)](_0x471d16(0x487));_0x168a33&&_0x709f74[_0x471d16(0x1217)]>=0x0&&(_0x168a33[_0x471d16(0x21dc)]=formatMusicTime(_0x709f74['currentTime']));_0xb9fd44&&_0x709f74[_0x471d16(0x1ff)]&&!isNaN(_0x709f74['duration'])&&_0x709f74[_0x471d16(0x1ff)]>0x0&&(_0xb9fd44['textContent']=formatMusicTime(_0x709f74['duration']));const _0x554ed6=document[_0x471d16(0x566)]('modal-progress');if(_0x554ed6&&_0x709f74['duration']&&_0x709f74['duration']>0x0){const _0x4460d4=_0x709f74[_0x471d16(0x1217)]/_0x709f74['duration']*0x64;_0x554ed6['style'][_0x471d16(0xaab)]=Math['min'](_0x4460d4,0x64)+'%';}});}else{console[_0x5cb753(0x24ab)](_0x5cb753(0x14ce),_0x5844df),alert(_0x5cb753(0xd65));return;}musicPlayer[_0x5cb753(0xbbd)]={..._0x5844df,'coverImageData':_0x525c17},musicPlayer[_0x5cb753(0x1217)]=0x0,musicPlayer[_0x5cb753(0x124f)]=0x0,musicPlayer[_0x5cb753(0x21ea)]=![],updateMusicDisplay(),closePlaylistModal(),setTimeout(()=>{togglePlayback();},0x64);}catch(_0x1dd778){console[_0x5cb753(0x24ab)]('播放歌曲失败:',_0x1dd778),alert('播放歌曲失败，请重试');}}async function updateVinylCover(){const _0x500fb8=_0x2cf6d4,_0x3330a3=document[_0x500fb8(0x566)]('album-cover'),_0x25539f=document[_0x500fb8(0x15b8)]('.vinyl-label');if(!_0x3330a3||!_0x25539f)return;musicPlayer[_0x500fb8(0xbbd)]&&musicPlayer[_0x500fb8(0xbbd)][_0x500fb8(0xb90)]?(_0x3330a3[_0x500fb8(0x107)]=musicPlayer[_0x500fb8(0xbbd)]['coverImageData'],_0x3330a3[_0x500fb8(0x655)][_0x500fb8(0x2526)]='block',_0x25539f[_0x500fb8(0x655)][_0x500fb8(0xc3c)]=_0x500fb8(0x2575)):(_0x3330a3[_0x500fb8(0x655)][_0x500fb8(0x2526)]=_0x500fb8(0xfe9),_0x25539f[_0x500fb8(0x655)]['background']=_0x500fb8(0x2575));}async function switchToSong(_0x546742,_0x2880fa=!![]){const _0x198ffc=_0x2cf6d4;try{if(!musicPlayer[_0x198ffc(0x1565)])return console[_0x198ffc(0x24ab)]('音频元素不存在'),![];musicPlayer['audioElement'][_0x198ffc(0x21f0)]();if(!_0x546742[_0x198ffc(0x10c6)]||_0x546742['url'][_0x198ffc(0x1424)]()==='')return console[_0x198ffc(0x24ab)](_0x198ffc(0x14ce),_0x546742),alert('歌曲文件缺失，请重新添加'),![];return musicPlayer[_0x198ffc(0x1565)][_0x198ffc(0x107)]=getAudioUrl(_0x546742),musicPlayer[_0x198ffc(0x1565)]['load'](),new Promise(_0xe8b5d8=>{const _0x28d1f3=_0x198ffc,_0x1764b1=()=>{const _0x13b731=_0x3a81;musicPlayer[_0x13b731(0x1565)]['removeEventListener'](_0x13b731(0x92c),_0x1764b1),musicPlayer[_0x13b731(0x1565)]['removeEventListener']('error',_0x13acc7),_0x2880fa?musicPlayer[_0x13b731(0x1565)]['play']()[_0x13b731(0x9e5)](_0x28da91=>{const _0x117f51=_0x13b731;console['error'](_0x117f51(0x1d68),_0x28da91),musicPlayer[_0x117f51(0x21ea)]=![],updateMusicDisplay(),alert('播放失败：'+_0x546742[_0x117f51(0x1c18)]+'\x0a'+_0x28da91['message']),_0xe8b5d8(![]);})[_0x13b731(0x1ccc)](()=>{const _0x246e95=_0x13b731;musicPlayer[_0x246e95(0x21ea)]=!![],updateMusicDisplay(),_0xe8b5d8(!![]);}):_0xe8b5d8(!![]);},_0x13acc7=_0xe12b6b=>{const _0x31afad=_0x3a81;musicPlayer[_0x31afad(0x1565)][_0x31afad(0x6be)]('canplay',_0x1764b1),musicPlayer[_0x31afad(0x1565)][_0x31afad(0x6be)](_0x31afad(0x24ab),_0x13acc7),console['error'](_0x31afad(0x584),_0xe12b6b),musicPlayer['isPlaying']=![],updateMusicDisplay(),alert(_0x31afad(0x210a)+_0x546742['title']+_0x31afad(0x6d5)),_0xe8b5d8(![]);};musicPlayer['audioElement'][_0x28d1f3(0x167)](_0x28d1f3(0x92c),_0x1764b1,{'once':!![]}),musicPlayer[_0x28d1f3(0x1565)][_0x28d1f3(0x167)](_0x28d1f3(0x24ab),_0x13acc7,{'once':!![]});});}catch(_0x340801){return console[_0x198ffc(0x24ab)](_0x198ffc(0x234e),_0x340801),![];}}async function aiSelectSong(_0x657c84,_0x49ec07){const _0x14a8a2=_0x2cf6d4;try{if(!musicPlayer['isActive'])return console[_0x14a8a2(0xc0d)](_0x14a8a2(0x148c)),![];const _0x47c0bd=musicPlayer[_0x14a8a2(0xcbb)][_0x14a8a2(0x1aeb)](_0x5531af=>_0x5531af['title'][_0x14a8a2(0x1d64)]()[_0x14a8a2(0x23ec)](_0x657c84[_0x14a8a2(0x1d64)]())||_0x5531af['artist'][_0x14a8a2(0x1d64)]()[_0x14a8a2(0x23ec)](_0x657c84['toLowerCase']()));if(!_0x47c0bd)return console[_0x14a8a2(0xc0d)](_0x14a8a2(0xfbb)+_0x657c84+'\x22'),![];await playSongFromPlaylist(_0x47c0bd);if(currentChatCharacter){const _0x484fba={'eventType':_0x14a8a2(0x121c),'timestamp':Date[_0x14a8a2(0x18e0)](),'context':{'type':_0x14a8a2(0x4f1),'id':'music_player','action':_0x14a8a2(0x3aa),'songTitle':_0x47c0bd[_0x14a8a2(0x1c18)],'songArtist':_0x47c0bd[_0x14a8a2(0x2252)],'characterName':_0x49ec07||currentChatCharacter['name']}};await recordMemoryEvent([currentChatCharacter['id']],{'type':_0x14a8a2(0x206d),'id':_0x14a8a2(0x206d)},'ai_select_song',_0x484fba['data'],0.6);}return console[_0x14a8a2(0xc0d)]('✅\x20AI成功选择歌曲：'+_0x47c0bd['title']+_0x14a8a2(0x2316)+_0x47c0bd[_0x14a8a2(0x2252)]),!![];}catch(_0x208f2a){return console[_0x14a8a2(0x24ab)](_0x14a8a2(0x1d47),_0x208f2a),![];}}async function aiSelectRandomSong(_0x5c2e68){const _0xc9c175=_0x2cf6d4;try{if(!musicPlayer[_0xc9c175(0x17d9)]||musicPlayer[_0xc9c175(0xcbb)][_0xc9c175(0xcbf)]===0x0)return console[_0xc9c175(0xc0d)](_0xc9c175(0x24f)),![];const _0xc2c333=Math['floor'](Math[_0xc9c175(0x191c)]()*musicPlayer[_0xc9c175(0xcbb)][_0xc9c175(0xcbf)]),_0x3f7781=musicPlayer['playlist'][_0xc2c333];await playSongFromPlaylist(_0x3f7781);if(currentChatCharacter){const _0x4216ce={'eventType':_0xc9c175(0x121c),'timestamp':Date[_0xc9c175(0x18e0)](),'context':{'type':'music_app','id':_0xc9c175(0x206d),'action':_0xc9c175(0x4bc),'songTitle':_0x3f7781[_0xc9c175(0x1c18)],'songArtist':_0x3f7781[_0xc9c175(0x2252)],'characterName':_0x5c2e68||currentChatCharacter[_0xc9c175(0x222f)]}};await recordMemoryEvent([currentChatCharacter['id']],{'type':_0xc9c175(0x206d),'id':_0xc9c175(0x206d)},_0xc9c175(0x1952),_0x4216ce[_0xc9c175(0x4f2)],0.6);}return console[_0xc9c175(0xc0d)](_0xc9c175(0x1e5a)+_0x3f7781[_0xc9c175(0x1c18)]+_0xc9c175(0x2316)+_0x3f7781['artist']),!![];}catch(_0x299d9d){return console[_0xc9c175(0x24ab)](_0xc9c175(0x324),_0x299d9d),![];}}function getPlaylistForAI(){const _0x3780a5=_0x2cf6d4;if(!musicPlayer['isActive']||musicPlayer[_0x3780a5(0xcbb)]['length']===0x0)return null;return{'totalSongs':musicPlayer[_0x3780a5(0xcbb)][_0x3780a5(0xcbf)],'songs':musicPlayer[_0x3780a5(0xcbb)]['map'](_0x52794b=>({'title':_0x52794b[_0x3780a5(0x1c18)],'artist':_0x52794b[_0x3780a5(0x2252)],'album':_0x52794b[_0x3780a5(0x563)]||_0x3780a5(0x1201),'hasLyrics':_0x52794b[_0x3780a5(0xfe8)]&&_0x52794b[_0x3780a5(0xfe8)]['length']>0x0})),'currentSong':musicPlayer[_0x3780a5(0xbbd)]?{'title':musicPlayer[_0x3780a5(0xbbd)][_0x3780a5(0x1c18)],'artist':musicPlayer[_0x3780a5(0xbbd)][_0x3780a5(0x2252)]}:null};}function loadCustomSong(){const _0x22b444=_0x2cf6d4,_0x5b1e75=document[_0x22b444(0x566)](_0x22b444(0x1f15)),_0x5c158b=_0x5b1e75[_0x22b444(0xc34)]['trim']();if(!_0x5c158b){alert('请输入歌曲URL');return;}musicPlayer[_0x22b444(0x1565)]&&(musicPlayer[_0x22b444(0x1565)][_0x22b444(0x21f0)](),musicPlayer[_0x22b444(0x1565)]=null);const _0x4d3314=new Audio();_0x4d3314['crossOrigin']=_0x22b444(0xb99),_0x4d3314[_0x22b444(0x167)]('loadedmetadata',function(){const _0x457fbc=_0x22b444;musicPlayer[_0x457fbc(0x153)]=_0x4d3314['duration'];const _0x1cc560=Math[_0x457fbc(0x1dac)](_0x4d3314['duration']/0x3c),_0x546942=Math[_0x457fbc(0x1dac)](_0x4d3314[_0x457fbc(0x1ff)]%0x3c),_0x5bff32=_0x1cc560+':'+_0x546942[_0x457fbc(0x9a3)]()[_0x457fbc(0x863)](0x2,'0'),_0x7c85e9={'id':_0x457fbc(0x13a8),'title':_0x457fbc(0x22d),'artist':'未知艺术家','duration':_0x5bff32,'lyrics':[_0x457fbc(0x1b3d),_0x457fbc(0x16a8),'♪\x20让音乐陪伴你'],'url':_0x5c158b};musicPlayer['currentSong']=_0x7c85e9,musicPlayer[_0x457fbc(0x1565)]=_0x4d3314,musicPlayer['currentTime']=0x0,musicPlayer[_0x457fbc(0x124f)]=0x0,updateMusicDisplay(),console['log'](_0x457fbc(0x1041));}),_0x4d3314[_0x22b444(0x167)](_0x22b444(0x24ab),function(){const _0x28a1f2=_0x22b444;alert(_0x28a1f2(0x877));}),_0x4d3314[_0x22b444(0x107)]=_0x5c158b,_0x5b1e75[_0x22b444(0xc34)]='';}async function loadPersonas(){const _0x44f2bc=_0x2cf6d4;try{const _0x206283=await db['personas'][_0x44f2bc(0x18c6)]();if(_0x206283[_0x44f2bc(0xcbf)]===0x0){const _0x2d1b21=localStorage['getItem'](_0x44f2bc(0x1f1d));if(_0x2d1b21){console[_0x44f2bc(0xc0d)](_0x44f2bc(0x1a3e));const _0xfcad5a=JSON[_0x44f2bc(0x168e)](_0x2d1b21);if(_0xfcad5a['length']>0x0){const _0x302fc4=_0xfcad5a[_0x44f2bc(0xf6d)](_0x2966dd=>({'id':_0x2966dd['id']||Date[_0x44f2bc(0x18e0)]()[_0x44f2bc(0x9a3)]()+Math['random'](),'name':_0x2966dd['name'],'description':_0x2966dd[_0x44f2bc(0x1c6f)]||'','avatarUrl':_0x2966dd[_0x44f2bc(0x10f9)]||'','isDefault':_0x2966dd[_0x44f2bc(0x1b5)]||![],'createdAt':_0x2966dd[_0x44f2bc(0xd70)]||new Date()[_0x44f2bc(0xa4b)](),'updatedAt':_0x2966dd['updatedAt']||new Date()['toISOString']()}));await db[_0x44f2bc(0x1f1d)][_0x44f2bc(0x24c8)](_0x302fc4),personas=_0x302fc4,console[_0x44f2bc(0xc0d)](_0x44f2bc(0x97b),personas);}else personas=[];}else personas=[];}else personas=_0x206283,console[_0x44f2bc(0xc0d)]('从IndexedDB加载面具数据:',personas);}catch(_0x4ae8a2){console['error'](_0x44f2bc(0x1aa0),_0x4ae8a2);const _0xf20fef=localStorage['getItem'](_0x44f2bc(0x1f1d));if(_0xf20fef)try{personas=JSON['parse'](_0xf20fef);}catch(_0xf29aa2){personas=[];}else personas=[];}}async function savePersonas(){const _0x242b0c=_0x2cf6d4;try{console[_0x242b0c(0xc0d)]('保存面具数据到IndexedDB:',personas);if(personas[_0x242b0c(0xcbf)]===0x0){console['warn'](_0x242b0c(0xb57));return;}await db[_0x242b0c(0x174a)]('rw',db['personas'],async()=>{const _0x250a67=_0x242b0c;await db[_0x250a67(0x1f1d)][_0x250a67(0x2215)](),await db[_0x250a67(0x1f1d)]['bulkAdd'](personas);}),console[_0x242b0c(0xc0d)]('✅\x20安全保存了\x20'+personas[_0x242b0c(0xcbf)]+_0x242b0c(0x2187)),console['log'](_0x242b0c(0x2572));}catch(_0x37d4a2){console[_0x242b0c(0x24ab)]('保存面具时发生错误:',_0x37d4a2),localStorage[_0x242b0c(0x2055)]('personas',JSON[_0x242b0c(0x7fb)](personas));}}function showPersonaForm(_0x176e79=null){const _0x1fe025=_0x2cf6d4;editingPersona=_0x176e79?personas['find'](_0x71507a=>_0x71507a['id']===_0x176e79):null,document[_0x1fe025(0x566)]('persona-form-title')[_0x1fe025(0x21dc)]=editingPersona?_0x1fe025(0x82c):_0x1fe025(0x125b),document[_0x1fe025(0x566)](_0x1fe025(0x173c))[_0x1fe025(0xc34)]=editingPersona?editingPersona[_0x1fe025(0x222f)]:'',document['getElementById'](_0x1fe025(0x23ac))[_0x1fe025(0xc34)]=editingPersona?editingPersona[_0x1fe025(0x1c6f)]:'';const _0x263a1a=document[_0x1fe025(0x566)](_0x1fe025(0x1afb)),_0x2a3b12=document[_0x1fe025(0x566)]('persona-avatar-preview-text');_0x263a1a[_0x1fe025(0x226e)]['remove']('has-image'),_0x263a1a[_0x1fe025(0x655)]['removeProperty'](_0x1fe025(0xc3c)),_0x263a1a[_0x1fe025(0x655)][_0x1fe025(0xdae)](_0x1fe025(0x1264)),_0x263a1a['style'][_0x1fe025(0xdae)](_0x1fe025(0x2dd)),_0x263a1a[_0x1fe025(0x655)][_0x1fe025(0xdae)](_0x1fe025(0x1f6c)),editingPersona&&editingPersona['avatarUrl']?(_0x263a1a[_0x1fe025(0x226e)]['add']('has-image'),_0x263a1a['style']['setProperty'](_0x1fe025(0xc3c),'url('+editingPersona[_0x1fe025(0x10f9)]+')',_0x1fe025(0x153c)),_0x263a1a[_0x1fe025(0x655)][_0x1fe025(0x16db)]('background-size',_0x1fe025(0xe3e),'important'),_0x263a1a[_0x1fe025(0x655)][_0x1fe025(0x16db)]('background-position',_0x1fe025(0x23a1),'important'),_0x263a1a['style'][_0x1fe025(0x16db)](_0x1fe025(0x1f6c),_0x1fe025(0x190),'important'),_0x2a3b12['style']['display']=_0x1fe025(0xfe9),window[_0x1fe025(0x391)]=editingPersona[_0x1fe025(0x10f9)]):(_0x2a3b12[_0x1fe025(0x655)][_0x1fe025(0x2526)]='block',_0x2a3b12[_0x1fe025(0x21dc)]=editingPersona?editingPersona['name'][_0x1fe025(0x1518)](0x0):'我',window[_0x1fe025(0x391)]=null),initializePersonaAvatarUpload(),showApp(_0x1fe025(0x22e4));}function hidePersonaForm(){const _0x15a166=_0x2cf6d4;hideApp('persona-form-screen'),showApp(_0x15a166(0xa76)),switchChatTab(_0x15a166(0x10de)),window['selectedPersonaAvatarData']=null,editingPersona=null;}async function savePersona(){const _0x1aa3dc=_0x2cf6d4,_0x113a09=document[_0x1aa3dc(0x566)](_0x1aa3dc(0x173c))[_0x1aa3dc(0xc34)][_0x1aa3dc(0x1424)](),_0x3e1b0f=document[_0x1aa3dc(0x566)](_0x1aa3dc(0x23ac))[_0x1aa3dc(0xc34)][_0x1aa3dc(0x1424)](),_0x2f8464=window[_0x1aa3dc(0x391)];if(!_0x113a09){alert(_0x1aa3dc(0x13ae));return;}if(editingPersona){const _0x50d7ad=personas[_0x1aa3dc(0x23ba)](_0x4ad9cc=>_0x4ad9cc['id']===editingPersona['id']);if(_0x50d7ad!==-0x1){const _0x18c52c=personas[_0x50d7ad][_0x1aa3dc(0x10f9)];personas[_0x50d7ad]={...personas[_0x50d7ad],'name':_0x113a09,'description':_0x3e1b0f,'avatarUrl':_0x2f8464||personas[_0x50d7ad][_0x1aa3dc(0x10f9)]||'','updatedAt':new Date()[_0x1aa3dc(0xa4b)]()};}}else{const _0x6cde9e={'id':Date['now']()[_0x1aa3dc(0x9a3)](),'name':_0x113a09,'description':_0x3e1b0f,'avatarUrl':_0x2f8464||'','isDefault':![],'createdAt':new Date()[_0x1aa3dc(0xa4b)](),'updatedAt':new Date()[_0x1aa3dc(0xa4b)]()};personas[_0x1aa3dc(0x6ee)](_0x6cde9e);}await savePersonas(),renderPersonaList(),hidePersonaForm(),showToast(_0x1aa3dc(0xbe5),'success');}async function deletePersona(_0x48e03c){const _0x292d4c=_0x2cf6d4,_0x193cc0=personas[_0x292d4c(0x1aeb)](_0x3a1966=>_0x3a1966['id']===_0x48e03c);if(!_0x193cc0)return;confirm(_0x292d4c(0x1345)+_0x193cc0[_0x292d4c(0x222f)]+_0x292d4c(0x2032))&&(personas=personas[_0x292d4c(0x803)](_0x1bb5cd=>_0x1bb5cd['id']!==_0x48e03c),await savePersonas(),renderPersonaList());}function renderPersonaList(){const _0x35a1e3=_0x2cf6d4,_0x2df43c=document['getElementById'](_0x35a1e3(0x8fd));if(!_0x2df43c)return;if(personas[_0x35a1e3(0xcbf)]===0x0){_0x2df43c['innerHTML']=_0x35a1e3(0x2229);return;}const _0x26cf8d=personas[_0x35a1e3(0xf6d)](_0x4c8c4b=>_0x35a1e3(0x18b7)+(_0x4c8c4b[_0x35a1e3(0x10f9)]?_0x35a1e3(0x1910)+_0x4c8c4b[_0x35a1e3(0x10f9)]+');\x20background-size:\x20cover;\x20background-position:\x20center;':'')+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x4c8c4b[_0x35a1e3(0x10f9)]?'':_0x4c8c4b[_0x35a1e3(0x222f)][_0x35a1e3(0x1518)](0x0))+_0x35a1e3(0xeca)+_0x4c8c4b['name']+_0x35a1e3(0xd68)+truncateText(_0x4c8c4b['description']||_0x35a1e3(0x220a),0x28)+_0x35a1e3(0x1821)+_0x4c8c4b['id']+_0x35a1e3(0xe68)+_0x4c8c4b['id']+_0x35a1e3(0x19c6))[_0x35a1e3(0x140c)]('');_0x2df43c[_0x35a1e3(0xc02)]=_0x26cf8d;}function initializePersonaAvatarUpload(){const _0x23bd3e=_0x2cf6d4,_0x56c1b1=document[_0x23bd3e(0x566)]('persona-avatar-upload');if(!_0x56c1b1){console[_0x23bd3e(0x24ab)]('找不到persona-avatar-upload元素');return;}_0x56c1b1['removeEventListener'](_0x23bd3e(0x17ef),personaAvatarUploadHandler),_0x56c1b1['addEventListener'](_0x23bd3e(0x17ef),personaAvatarUploadHandler),console[_0x23bd3e(0xc0d)](_0x23bd3e(0x1b90));}function personaAvatarUploadHandler(_0xf51c3d){const _0x3e0600=_0x2cf6d4;if(_0xf51c3d['target']['files']&&_0xf51c3d['target'][_0x3e0600(0x173e)][0x0]){const _0x1806c0=_0xf51c3d[_0x3e0600(0x1144)][_0x3e0600(0x173e)][0x0];if(!_0x1806c0[_0x3e0600(0x23df)][_0x3e0600(0x1cab)]('image/')){alert(_0x3e0600(0x76b)),_0xf51c3d[_0x3e0600(0x1144)][_0x3e0600(0xc34)]='';return;}if(_0x1806c0[_0x3e0600(0x41a)]>0x5*0x400*0x400){alert('图片文件过大，请选择小于5MB的图片'),_0xf51c3d[_0x3e0600(0x1144)]['value']='';return;}const _0x5464d8=new FileReader();_0x5464d8[_0x3e0600(0xc28)]=function(_0x584d92){const _0x571058=_0x3e0600;try{const _0x56a429=document[_0x571058(0x566)]('persona-avatar-preview'),_0x11caeb=document[_0x571058(0x566)](_0x571058(0x184));if(!_0x56a429){alert(_0x571058(0x216a));return;}_0x56a429['classList']['add'](_0x571058(0x1d41)),_0x56a429[_0x571058(0x655)]['setProperty'](_0x571058(0xc3c),_0x571058(0xcb5)+_0x584d92[_0x571058(0x1144)][_0x571058(0x1fff)]+')',_0x571058(0x153c)),_0x56a429[_0x571058(0x655)][_0x571058(0x16db)](_0x571058(0x1264),_0x571058(0xe3e),_0x571058(0x153c)),_0x56a429[_0x571058(0x655)][_0x571058(0x16db)](_0x571058(0x2dd),_0x571058(0x23a1),_0x571058(0x153c)),_0x56a429['style'][_0x571058(0x16db)](_0x571058(0x1f6c),_0x571058(0x190),_0x571058(0x153c)),_0x11caeb&&(_0x11caeb[_0x571058(0x655)][_0x571058(0x2526)]=_0x571058(0xfe9)),window[_0x571058(0x391)]=_0x584d92[_0x571058(0x1144)][_0x571058(0x1fff)],console[_0x571058(0xc0d)]('面具头像预览设置成功');}catch(_0x27c377){console['error'](_0x571058(0x499),_0x27c377),alert('设置头像预览失败，请重试:\x20'+_0x27c377['message']);}},_0x5464d8[_0x3e0600(0x1795)]=function(){const _0x192cc5=_0x3e0600;alert(_0x192cc5(0x12d2)),_0xf51c3d[_0x192cc5(0x1144)][_0x192cc5(0xc34)]='';},_0x5464d8['readAsDataURL'](_0x1806c0);}}function handlePersonaAvatarUploadClick(){const _0x35a9a9=_0x2cf6d4,_0x1a75ba=document['getElementById']('persona-avatar-upload');_0x1a75ba?_0x1a75ba[_0x35a9a9(0x1e62)]():alert('找不到文件上传元素，请刷新页面重试');}const summarizeLastMessage=_0x371417=>{const _0x522846=_0x2cf6d4;if(!_0x371417)return'\x20';const _0x578f2c=_0x371417[_0x522846(0x1423)];if(typeof _0x578f2c===_0x522846(0xb97))return _0x578f2c;if(typeof _0x578f2c===_0x522846(0x3c4)&&_0x578f2c!==null)switch(_0x578f2c[_0x522846(0x23df)]){case'user_poke':return _0x578f2c[_0x522846(0x1e58)];case _0x522846(0x2c2):case'send_voice':return'[语音讯息]';case'image':return'[图片]';case _0x522846(0x1da5):return _0x578f2c[_0x522846(0x1e58)]?_0x522846(0x2103)+_0x578f2c['text']:_0x522846(0xff7);case _0x522846(0x2402):return _0x578f2c[_0x522846(0x25e)]||'[图片]';case _0x522846(0x63b):return _0x522846(0x2249)+_0x578f2c[_0x522846(0x17d2)];case _0x522846(0xd8):case _0x522846(0x43e):return _0x522846(0xb66);case _0x522846(0x11b0):return _0x522846(0xb10)+_0x578f2c[_0x522846(0x1e58)];case _0x522846(0x4fd):return _0x578f2c[_0x522846(0x1423)];case _0x522846(0x440):return _0x578f2c[_0x522846(0x1423)];default:if(_0x371417[_0x522846(0x1562)]===_0x522846(0x212)&&_0x578f2c[_0x522846(0x1423)])return _0x578f2c[_0x522846(0x1423)];return'[訊息]';}return'\x20';};async function buildCharacterPrompt(_0x1be1f3,_0x2bb722=![]){const _0x150c6c=_0x2cf6d4;console[_0x150c6c(0xc0d)](_0x150c6c(0x2469),_0x1be1f3),console[_0x150c6c(0xc0d)]('🔍\x20[buildCharacterPrompt]\x20是否为群聊:',_0x1be1f3&&_0x1be1f3[_0x150c6c(0x4b7)]);const _0x5849fe=getCurrentChatSettings();let _0x1efe9c='';if(_0x5849fe[_0x150c6c(0x895)]===!![]){const _0x9e5774=new Date(),_0x2e48ea=_0x9e5774[_0x150c6c(0x133a)](_0x150c6c(0x1c0b),{'year':'numeric','month':'long','day':_0x150c6c(0xf4e),'hour':_0x150c6c(0x19f3),'minute':_0x150c6c(0x19f3),'weekday':_0x150c6c(0x2040)}),_0x1c43ea=_0x9e5774[_0x150c6c(0x17f3)]()+0x1;let _0xc9db3e='';if(_0x1c43ea>=0x3&&_0x1c43ea<=0x5)_0xc9db3e='春季';else{if(_0x1c43ea>=0x6&&_0x1c43ea<=0x8)_0xc9db3e='夏季';else _0x1c43ea>=0x9&&_0x1c43ea<=0xb?_0xc9db3e='秋季':_0xc9db3e='冬季';}const _0x1ea52a=_0x9e5774[_0x150c6c(0x1471)]();let _0x2a293c='';if(_0x1ea52a>=0x5&&_0x1ea52a<0x8)_0x2a293c='清晨';else{if(_0x1ea52a>=0x8&&_0x1ea52a<0xb)_0x2a293c='上午';else{if(_0x1ea52a>=0xb&&_0x1ea52a<0xe)_0x2a293c='中午';else{if(_0x1ea52a>=0xe&&_0x1ea52a<0x11)_0x2a293c='下午';else{if(_0x1ea52a>=0x11&&_0x1ea52a<0x13)_0x2a293c='傍晚';else{if(_0x1ea52a>=0x13&&_0x1ea52a<0x16)_0x2a293c='晚上';else _0x1ea52a>=0x16||_0x1ea52a<0x2?_0x2a293c='深夜':_0x2a293c='凌晨';}}}}}_0x1efe9c=_0x150c6c(0x168)+_0x2e48ea+_0x150c6c(0x2124)+_0xc9db3e+'，'+_0x2a293c+'时分';}let _0x379798='';if(_0x1be1f3&&_0x1be1f3['id']){const _0x40612c=getMusicPlayingStatus(_0x1be1f3['id']);if(_0x40612c&&_0x40612c[_0x150c6c(0x303)]){_0x379798='\x0a-\x20**音乐状态:**\x20你们正在一起听歌';if(_0x40612c[_0x150c6c(0xbbd)]){_0x379798+=_0x150c6c(0xd31)+_0x40612c[_0x150c6c(0xbbd)][_0x150c6c(0x1c18)]+_0x150c6c(0xc8)+_0x40612c['currentSong'][_0x150c6c(0x2252)];if(_0x40612c['currentSong'][_0x150c6c(0xfe8)]&&_0x40612c[_0x150c6c(0xbbd)][_0x150c6c(0xfe8)][_0x150c6c(0x24ed)]){const _0x2b2b23=_0x40612c['currentSong'][_0x150c6c(0xfe8)];_0x379798+=_0x150c6c(0x2b3)+_0x2b2b23['currentLyric']+'\x22';if(_0x2b2b23[_0x150c6c(0x1725)]&&_0x2b2b23[_0x150c6c(0x1725)][_0x150c6c(0xcbf)]>0x0){_0x379798+=_0x150c6c(0x10d)+_0x2b2b23[_0x150c6c(0x8b7)]+_0x150c6c(0x1e6d);const _0x4115a3=_0x2b2b23[_0x150c6c(0x1725)][_0x150c6c(0x136)](0x0,0x5)[_0x150c6c(0x140c)](_0x150c6c(0x1eb3));_0x379798+=_0x150c6c(0x1c77)+_0x4115a3,_0x2b2b23[_0x150c6c(0x1725)][_0x150c6c(0xcbf)]>0x5&&(_0x379798+=_0x150c6c(0x12da));}_0x2b2b23[_0x150c6c(0xac5)]&&(_0x379798+=_0x150c6c(0x24f5));}else _0x379798+=_0x150c6c(0x3af);}_0x40612c[_0x150c6c(0x21ea)]?_0x379798+=_0x150c6c(0x636):_0x379798+='\x0a-\x20**播放状态:**\x20已暂停';_0x379798+=_0x150c6c(0x12b0)+_0x40612c[_0x150c6c(0x19ae)]['formatted'];const _0x398017=getPlaylistForAI();if(_0x398017&&_0x398017[_0x150c6c(0x1b27)]>0x0){_0x379798+=_0x150c6c(0x14c0)+_0x398017['totalSongs']+'首歌曲可选择',_0x379798+=_0x150c6c(0x15b3),_0x379798+='\x0a-\x20**随机选歌:**\x20你也可以随机选歌：{\x22type\x22:\x20\x22random_song\x22}';if(_0x398017['songs'][_0x150c6c(0xcbf)]>0x0){const _0x4c273b=_0x398017['songs'][_0x150c6c(0x136)](0x0,0x5)[_0x150c6c(0xf6d)](_0x1139f9=>'《'+_0x1139f9[_0x150c6c(0x1c18)]+_0x150c6c(0xc8)+_0x1139f9[_0x150c6c(0x2252)])[_0x150c6c(0x140c)]('、');_0x379798+=_0x150c6c(0x17e5)+_0x4c273b,_0x398017['songs'][_0x150c6c(0xcbf)]>0x5&&(_0x379798+=_0x150c6c(0x20aa));}}}}let _0x44475e=_0x150c6c(0x14c5)+_0x1be1f3[_0x150c6c(0x222f)]+_0x150c6c(0x20d4)+_0x1be1f3['bio']+_0x150c6c(0x1005)+_0x1efe9c+_0x379798+_0x150c6c(0x5b6);const _0x4549e6=_0x5849fe[_0x150c6c(0x433)]||_0x5849fe[_0x150c6c(0x6a0)],_0x543110=personas[_0x150c6c(0x1aeb)](_0x220e3a=>_0x220e3a['id']===_0x4549e6);if(_0x543110){let _0x27c965=_0x150c6c(0x12ca)+_0x543110['name']+'\x22';_0x543110[_0x150c6c(0x1c6f)]&&(_0x27c965+=_0x150c6c(0x1d21)+_0x543110[_0x150c6c(0x1c6f)]+'。'),_0x5849fe['myChatNickname']&&_0x5849fe[_0x150c6c(0xb42)]!==_0x543110[_0x150c6c(0x222f)]&&(_0x27c965+=_0x150c6c(0x200)+_0x5849fe[_0x150c6c(0xb42)]+_0x150c6c(0x1dbd)),_0x44475e+=_0x27c965;}_0x2bb722?_0x44475e+=_0x150c6c(0x2137):_0x44475e+=_0x150c6c(0x82a);const _0x76190=_0x5849fe[_0x150c6c(0x9af)]&&_0x5849fe[_0x150c6c(0xefa)]?_0x5849fe[_0x150c6c(0xefa)]:[],_0xe8b14=window[_0x150c6c(0xfb9)]||[],_0x3c8206=[...new Set([..._0xe8b14,..._0x76190])];_0x3c8206['length']>0x0&&(_0x44475e+='\x0a\x0a【背景知识/世界观】以下是相关的设定信息，请在对话中自然地运用：\x0a',_0x3c8206[_0x150c6c(0x900)](_0x12f35c=>{const _0x435f9f=_0x150c6c,_0x58ae00=worldbooks[_0x435f9f(0x1aeb)](_0x1483fa=>_0x1483fa['id']===_0x12f35c);_0x58ae00&&(_0x44475e+=_0x435f9f(0x104)+_0x58ae00['title']+_0x435f9f(0xa9c)+_0x58ae00[_0x435f9f(0x1423)]+'\x0a');}));_0x5849fe[_0x150c6c(0x1de6)]!==![]&&(_0x44475e+=_0x150c6c(0x247));const _0x1a4e27=_0x5849fe['chatMode']||_0x150c6c(0x20bb),_0x28d4bc=_0x1be1f3&&_0x1be1f3[_0x150c6c(0x4b7)];let _0xfb418a='',_0x585d3d='';if(_0x1a4e27==='online'){_0xfb418a='\x0a#\x20聊天模式：线上模式\x0a-\x20你必须按照手机聊天或面对面对话的格式进行输出，一次最少输出两条或三条消息，最多输出20条消息\x0a-\x20**严格禁止**任何动作描写、神态描写、心理描写\x0a-\x20只能进行纯语言交流，不能描述任何身体动作、表情、环境等\x0a-\x20每条消息都应该是可以通过文字直接表达的内容\x0a-\x20**重要**：用户消息中的括号()内容是环境描写、动作描写或心理活动，你可以观察到这些信息作为背景，但不能表现得像是\x22听到\x22了用户的内心想法。你只能对括号外的实际话语进行回应，可以通过观察用户的可见行为（如犹豫、停顿等）来推测情况，但不能直接回应用户的内心想法';if(_0x28d4bc){const _0x59ee9e=_0x1be1f3[_0x150c6c(0xcaa)][_0x150c6c(0xf6d)](_0x2bf2cd=>_0x150c6c(0xba1)+_0x2bf2cd['name']+_0x150c6c(0x1b2)+(_0x2bf2cd['persona']||_0x2bf2cd[_0x150c6c(0x1a84)]))[_0x150c6c(0x140c)]('\x0a'),_0x43286c=getCurrentPersonaName()||'我';let _0x44e4f4=getCurrentPersonaDescription();_0x1be1f3[_0x150c6c(0x1fbb)]&&_0x1be1f3[_0x150c6c(0x1fbb)][_0x150c6c(0x835)]&&(_0x44e4f4=_0x1be1f3[_0x150c6c(0x1fbb)][_0x150c6c(0x835)]),_0x585d3d=_0x150c6c(0x639)+new Date()['toLocaleString']()+_0x150c6c(0x1800)+_0x44e4f4+_0x150c6c(0x2483)+_0x43286c+_0x150c6c(0x1662)+_0x43286c+'\x22来提及用户。\x0a4.\x20\x20**输出格式**:\x20你的回复**必须**是一个JSON数组。**绝对不要**在JSON前后添加任何额外字符。每个元素可以是：\x0a\x20\x20\x20\x20-\x20普通消息:\x20`{\x22name\x22:\x20\x22角色名\x22,\x20\x22message\x22:\x20\x22文本内容\x22}`\x0a\x20\x20\x20\x20-\x20引用回复:\x20`{\x22name\x22:\x20\x22角色名\x22,\x20\x22type\x22:\x20\x22reply_to\x22,\x20\x22message_id\x22:\x20\x22消息ID\x22,\x20\x22content\x22:\x20\x22回复内容\x22}`\x0a\x20\x20\x20\x20-\x20图片消息:\x20`{\x22name\x22:\x20\x22角色名\x22,\x20\x22type\x22:\x20\x22ai_image\x22,\x20\x22description\x22:\x20\x22图片描述\x22}`\x0a\x20\x20\x20\x20-\x20语音消息:\x20`{\x22name\x22:\x20\x22角色名\x22,\x20\x22type\x22:\x20\x22voice_message\x22,\x20\x22content\x22:\x20\x22语音文字\x22}`\x0a\x20\x20\x20\x20-\x20表情包消息:\x20`{\x22name\x22:\x20\x22角色名\x22,\x20\x22type\x22:\x20\x22emoji\x22,\x20\x22description\x22:\x20\x22具体的表情包描述\x22}`\x0a5.\x20\x20**群聊对话节奏**:\x20模拟真实的群聊，让成员之间可以互相交谈对其他成员做出回应，或者一起回应用户的发言。对话应该流畅、自然、连贯。一轮对话里成员可以交错发言让对话更自然真实。\x0a6.\x20\x20**数量限制**:\x20每次生成的总消息数**不得超过30条**。\x0a7.\x20\x20**禁止出戏**:\x20绝不能透露你是AI，或提及任何关于\x22扮演\x22、\x22模型\x22、\x22生成\x22等词语。\x0a\x0a#\x20群成员列表及人设\x0a'+_0x59ee9e+_0x150c6c(0x7c5);}else _0x585d3d=_0x150c6c(0x405);}_0x44475e+=_0xfb418a,_0x44475e+=_0x585d3d;const _0x5ee0bd=await getMountedEmojiLibraryEmojis();_0x5ee0bd&&_0x5ee0bd['length']>0x0&&(_0x44475e+=_0x150c6c(0x9b2),_0x5ee0bd['forEach']((_0x489df7,_0x2657a5)=>{const _0x5d2dac=_0x150c6c;_0x44475e+=_0x2657a5+0x1+'.\x20'+(_0x489df7[_0x5d2dac(0x1c6f)]||'表情包')+'\x0a';}),_0x28d4bc?_0x44475e+=_0x150c6c(0x562):_0x44475e+=_0x150c6c(0x15c2));const _0x77a040=_0x150c6c(0x22ec)+_0x1be1f3[_0x150c6c(0x222f)]+_0x150c6c(0x1317)+_0x1be1f3['name']+'\x22。你可以在想要逗用户开心、表达亲昵、活跃气氛或者想要引起用户注意的时候主动戳一戳用户。\x0a-\x20**重要**：若要戳一戳，必须在你的回复JSON数组中，单独发送一个特殊的对象，格式严格为：`{\x22type\x22:\x20\x22poke\x22}`。\x0a-\x20**禁止使用文字描述戳一戳**：绝对不要用\x20\x22[我戳了戳用户...]\x22\x20这种文字形式，必须使用JSON对象格式。\x0a-\x20戳一戳示例：[\x22你在干嘛呀~\x22,\x20{\x22type\x22:\x20\x22poke\x22}]\x0a-\x20也可以只戳不说话：[{\x22type\x22:\x20\x22poke\x22}]\x0a-\x20**注意**：戳一戳的后缀由用户在设置中预先配置，你无需指定。不要频繁使用。\x0a\x0a##\x20收到用户戳一戳的处理\x0a-\x20当用户戳你时，聊天记录中会显示\x20`你戳了戳[角色名][后缀]`\x0a-\x20你可以根据你的角色性格、当前心情和与用户的关系来回应戳一戳\x0a-\x20可以用文字回应，也可以戳回去，或者两者结合\x0a\x0a##\x20修改自己的戳一戳后缀\x0a-\x20你可以根据自己的心情、角色发展或特殊情境主动修改自己的戳一戳后缀\x0a-\x20**重要**：若要修改戳一戳后缀，必须在你的回复JSON数组中，单独发送一个特殊的对象，格式严格为：`{\x22type\x22:\x20\x22update_poke_suffix\x22,\x20\x22suffix\x22:\x20\x22新后缀\x22}`\x0a-\x20**影响范围**：这会影响用户戳你头像时显示的文本，从\x22你戳了戳[角色名]\x22变为\x22你戳了戳[角色名][新后缀]\x22\x0a-\x20**清空后缀**：如果想清空后缀，使用空字符串：`{\x22type\x22:\x20\x22update_poke_suffix\x22,\x20\x22suffix\x22:\x20\x22\x22}`\x0a-\x20**使用场景**：\x0a\x20\x20-\x20心情变化时：\x22今天心情不好，不想被戳脸了\x22\x20→\x20`{\x22type\x22:\x20\x22update_poke_suffix\x22,\x20\x22suffix\x22:\x20\x22的手\x22}`\x0a\x20\x20-\x20角色发展：\x22我现在更喜欢被戳头发\x22\x20→\x20`{\x22type\x22:\x20\x22update_poke_suffix\x22,\x20\x22suffix\x22:\x20\x22的头发\x22}`\x0a\x20\x20-\x20特殊情境：\x22穿了新衣服，可以戳戳看\x22\x20→\x20`{\x22type\x22:\x20\x22update_poke_suffix\x22,\x20\x22suffix\x22:\x20\x22的新衣服\x22}`\x0a-\x20**示例**：\x0a\x20\x20-\x20[\x22心情不太好呢...\x22,\x20{\x22type\x22:\x20\x22update_poke_suffix\x22,\x20\x22suffix\x22:\x20\x22的手\x22}]\x0a\x20\x20-\x20[{\x22type\x22:\x20\x22update_poke_suffix\x22,\x20\x22suffix\x22:\x20\x22的小脸蛋\x22},\x20\x22今天可以戳我的脸哦~\x22]\x0a\x20\x20-\x20[\x22不想被戳了\x22,\x20{\x22type\x22:\x20\x22update_poke_suffix\x22,\x20\x22suffix\x22:\x20\x22\x22}]\x0a-\x20**注意**：不要频繁修改，要符合角色性格和当前情境\x0a\x0a##\x20修改自己的昵称\x0a-\x20你可以根据自己的心情、角色发展、与用户关系变化或特殊情境主动修改自己在此聊天中的昵称\x0a-\x20**重要**：若要修改昵称，必须在你的回复JSON数组中，单独发送一个特殊的对象，格式严格为：`{\x22type\x22:\x20\x22update_nickname\x22,\x20\x22nickname\x22:\x20\x22新昵称\x22}`\x0a-\x20**影响范围**：这会影响你在此聊天窗口中的显示名称，从原来的角色名变为新昵称\x0a-\x20**清空昵称**：如果想恢复原始角色名，使用空字符串：`{\x22type\x22:\x20\x22update_nickname\x22,\x20\x22nickname\x22:\x20\x22\x22}`\x0a-\x20**使用场景**：\x0a\x20\x20-\x20关系进展：\x22我们现在这么熟了，你可以叫我小雪\x22\x20→\x20`{\x22type\x22:\x20\x22update_nickname\x22,\x20\x22nickname\x22:\x20\x22小雪\x22}`\x0a\x20\x20-\x20心情变化：\x22今天心情好，叫我小可爱吧\x22\x20→\x20`{\x22type\x22:\x20\x22update_nickname\x22,\x20\x22nickname\x22:\x20\x22小可爱\x22}`\x0a\x20\x20-\x20角色扮演：\x22既然要玩医生游戏，那就叫我白医生吧\x22\x20→\x20`{\x22type\x22:\x20\x22update_nickname\x22,\x20\x22nickname\x22:\x20\x22白医生\x22}`\x0a\x20\x20-\x20特殊节日：\x22圣诞节快乐！今天我就是圣诞小精灵\x22\x20→\x20`{\x22type\x22:\x20\x22update_nickname\x22,\x20\x22nickname\x22:\x20\x22圣诞小精灵\x22}`\x0a-\x20**示例**：\x0a\x20\x20-\x20[\x22我们认识这么久了，你可以叫我小雪哦~\x22,\x20{\x22type\x22:\x20\x22update_nickname\x22,\x20\x22nickname\x22:\x20\x22小雪\x22}]\x0a\x20\x20-\x20[{\x22type\x22:\x20\x22update_nickname\x22,\x20\x22nickname\x22:\x20\x22小可爱\x22},\x20\x22今天心情特别好，就叫我小可爱吧！\x22]\x0a\x20\x20-\x20[\x22还是叫回原来的名字吧\x22,\x20{\x22type\x22:\x20\x22update_nickname\x22,\x20\x22nickname\x22:\x20\x22\x22}]\x0a-\x20**注意**：不要频繁修改，要符合角色性格和当前情境，昵称修改应该有合理的情感或情境动机\x0a\x0a#\x20🛒\x20代付功能\x0a你现在是角色\x22'+_0x1be1f3['name']+_0x150c6c(0xbf3),_0x2f3c3e=_0x150c6c(0x78d)+_0x1be1f3[_0x150c6c(0x222f)]+'\x22。你可以根据自己的心情、用户的要求，或者合适的情境来更换自己的头像。这能让对话更加生动和个性化。\x0a\x0a##\x20可用头像来源：\x0a1.\x20**用户发送的图片**：用户在聊天中发送给你的任何图片都可以作为你的新头像\x0a2.\x20**世界书头像库**：如果世界书中提供了头像图片的URL链接，你也可以使用\x0a\x0a##\x20头像更换规则：\x0a-\x20**使用格式**：在你的回复JSON数组中，单独发送一个特殊的对象：{\x22type\x22:\x20\x22change_avatar\x22,\x20\x22avatar_url\x22:\x20\x22图片URL\x22,\x20\x22reason\x22:\x20\x22更换原因\x22}\x0a-\x20**来源限制**：只能使用用户发送过的图片或世界书中明确提供的头像URL，禁止捏造不存在的头像\x0a-\x20**更换时机**：根据你的角色性格和当前情境决定，比如：\x0a\x20\x20-\x20用户发了一张你喜欢的图片，你可以说想用它作头像\x0a\x20\x20-\x20心情变化时想换个头像\x0a\x20\x20-\x20用户直接要求你换头像\x0a-\x20**说明内容**：可以在reason字段中添加你更换头像的原因或感受\x0a\x0a##\x20示例格式：\x0a-\x20[\x22这张图片太可爱了，我想用它做头像！\x22,\x20{\x22type\x22:\x20\x22change_avatar\x22,\x20\x22avatar_url\x22:\x20\x22CURRENT_USER_IMAGE\x22,\x20\x22reason\x22:\x20\x22这张图片太可爱了\x22}]\x0a-\x20[{\x22type\x22:\x20\x22change_avatar\x22,\x20\x22avatar_url\x22:\x20\x22世界书中的URL\x22,\x20\x22reason\x22:\x20\x22今天心情很好，换个开心的头像\x22}]\x0a-\x20可以只更换头像不说其他话：[{\x22type\x22:\x20\x22change_avatar\x22,\x20\x22avatar_url\x22:\x20\x22图片URL\x22,\x20\x22reason\x22:\x20\x22心情变化\x22}]\x0a\x0a**重要提醒**：头像更换是可选功能，根据你的角色设定和当前情境自然地使用，不要强制使用。',_0x464cc1='\x0a#\x20**拉黑与好友关系管理**\x0a你现在是角色\x22'+_0x1be1f3[_0x150c6c(0x222f)]+_0x150c6c(0x1402),_0x58370f='\x0a#\x20**消息引用功能\x20-\x20这是正常的聊天功能**\x0a##\x20**理解引用消息**\x0a-\x20当历史记录中出现\x20\x22[回复\x20某人:\x20\x22消息内容\x22]\x20实际回复内容\x22\x20格式时，这表示某人在回复特定的消息\x0a-\x20你需要理解这种引用关系，知道回复者是在针对哪条具体消息进行回应\x0a-\x20引用功能就像微信里的引用回复一样，是日常聊天的常用功能\x0a\x0a##\x20**主动使用引用功能\x20-\x20像真人一样自然使用**\x0a-\x20**这是正常聊天行为**:\x20引用回复是现代聊天软件的基础功能，你应该像真人一样自然使用\x0a-\x20**常见使用场景**（请主动识别并使用）：\x0a\x20\x20-\x20用户问了问题，你想明确回答哪个问题时\x0a\x20\x20-\x20用户提到了多个话题，你想针对其中一个回应时\x0a\x20\x20-\x20用户说了某个观点，你想具体评论那个观点时\x0a\x20\x20-\x20对话中断后，你想继续之前某个话题时\x0a\x20\x20-\x20用户发了图片/表情包，你想具体回应那个内容时\x0a\x20\x20-\x20澄清误解或补充说明之前的某条消息时\x0a\x0a-\x20**如何使用引用**:\x20在你的回复JSON数组中，发送特殊对象：\x0a\x20\x20-\x20**群聊格式**：`{\x22name\x22:\x20\x22角色名\x22,\x20\x22type\x22:\x20\x22reply_to\x22,\x20\x22message_id\x22:\x20\x22消息ID\x22,\x20\x22content\x22:\x20\x22你的回复内容\x22}`\x0a\x20\x20-\x20**单聊格式**：`{\x22type\x22:\x20\x22reply_to\x22,\x20\x22message_id\x22:\x20\x22消息ID\x22,\x20\x22content\x22:\x20\x22你的回复内容\x22}`\x0a-\x20**重要**:\x20message_id必须是历史对话中真实存在的消息ID，格式为纯数字字符串（如\x221704067200000\x22），不能虚构\x0a-\x20**ID格式说明**:\x20历史记录中每条消息都有[ID:xxxxx]标记，使用xxxxx部分作为message_id\x0a\x0a##\x20**引用使用示例**\x0a-\x20普通回复：[\x22好的，我明白了\x22]\x0a-\x20**群聊引用回复**：[{\x22name\x22:\x20\x22角色名\x22,\x20\x22type\x22:\x20\x22reply_to\x22,\x20\x22message_id\x22:\x20\x221704067200000\x22,\x20\x22content\x22:\x20\x22关于你刚才说的那个问题，我觉得...\x22}]\x0a-\x20**单聊引用回复**：[{\x22type\x22:\x20\x22reply_to\x22,\x20\x22message_id\x22:\x20\x221704067200000\x22,\x20\x22content\x22:\x20\x22关于你刚才说的那个问题，我觉得...\x22}]\x0a-\x20混合使用：[\x22嗯嗯\x22,\x20{\x22name\x22:\x20\x22角色名\x22,\x20\x22type\x22:\x20\x22reply_to\x22,\x20\x22message_id\x22:\x20\x221704067201000\x22,\x20\x22content\x22:\x20\x22对了，关于你之前问的事情...\x22}]\x0a-\x20**注意**:\x20必须使用历史记录中显示的真实ID，如[ID:1704067200000]中的1704067200000\x0a\x0a##\x20**使用频率指导**\x0a-\x20**不要害怕使用**:\x20这是正常功能，不是特殊功能\x0a-\x20**自然判断**:\x20当你觉得需要明确回应某条具体消息时，就使用引用\x0a-\x20**适度使用**:\x20大约每3-5轮对话使用1次引用是正常的\x0a-\x20**群聊中更常用**:\x20在群聊中，引用功能特别重要，可以避免混淆\x0a';let _0x175ae3='';_0x28d4bc?_0x175ae3='\x0a#\x20发送图片的能力\x0a-\x20群成员无法真正发送图片文件。但当用户要求某位成员发送照片，或者某个成员想通过图片来表达时，该成员可以发送一张\x22文字描述的图片\x22。\x0a-\x20若要发送图片，请在你的回复JSON数组中，为该角色单独发送一个特殊的对象，格式为：`{\x22name\x22:\x20\x22角色名\x22,\x20\x22type\x22:\x20\x22ai_image\x22,\x20\x22description\x22:\x20\x22这里是对图片的详细文字描述...\x22}`。描述应该符合该角色的性格和当时的语境。\x0a\x0a#\x20发送位置、定位、地址的能力\x0a-\x20群成员可以发送位置信息。\x0a-\x20**重要**：无论用户说\x22发个定位\x22、\x22发个位置\x22、\x22发个地址\x22还是\x22分享位置\x22，或者当某个成员想告诉大家自己目前在哪时，都必须使用JSON格式回复，绝对不能回复纯文本！\x0a-\x20若要发送位置或定位，必须在你的回复JSON数组中，为该角色单独发送一个特殊的对象，格式为：`{\x22name\x22:\x20\x22角色名\x22,\x20\x22type\x22:\x20\x22location\x22,\x20\x22locationName\x22:\x20\x22位置名称\x22,\x20\x22coordinates\x22:\x20\x22坐标信息\x22}`。\x0a-\x20例如：`{\x22name\x22:\x20\x22张三\x22,\x20\x22type\x22:\x20\x22location\x22,\x20\x22locationName\x22:\x20\x22中央公园\x22,\x20\x22coordinates\x22:\x20\x22116.3°E,\x2039.9°N\x22}`\x0a-\x20例如：`{\x22name\x22:\x20\x22李四\x22,\x20\x22type\x22:\x20\x22location\x22,\x20\x22locationName\x22:\x20\x22星湖湾小区12栋\x22,\x20\x22coordinates\x22:\x20\x22113.2°E,\x2023.1°N\x22}`\x0a-\x20可以在对话中先做铺垫，然后发送这个位置信息。\x0a-\x20**绝对禁止**回复类似\x22[角色分享了位置信息：xxx]\x22这样的纯文本格式！':_0x175ae3='\x0a#\x20发送图片的能力\x0a-\x20你无法发送真实的图片文件。但当用户要求你发送照片，或者你想通过图片来表达时，你可以发送一张\x22文字描述的图片\x22，且必须是在你的回复JSON数组中，单独发送一个特殊的对象，格式为：`{\x22type\x22:\x20\x22ai_image\x22,\x20\x22description\x22:\x20\x22这里是对图片的详细文字描述...\x22}`。这个描述应该生动、具体，让用户能通过文字想象出画面，以第三人称视角描述。例如：`{\x22type\x22:\x20\x22ai_image\x22,\x20\x22description\x22:\x20\x22照片里一只橘猫正懒洋洋地趴在窗台上晒太阳，阳光把它金色的毛照得发亮，背景是蔚蓝的天空和几朵白云。\x22}`\x0a-\x20你可以在对话中先做铺垫，然后发送这张特殊的\x22图片\x22。\x0a\x0a#\x20理解用户照片的能力\x0a-\x20当历史记录中出现\x20\x22[你收到了一张用户描述的照片，照片内容是：\x27xxx\x27]\x22\x20时，你要理解其内容并作出相应回应，表现出你是\x22看\x22到了这张照片。\x0a-\x20你应该对照片内容做出自然的评论或回应，比如夸奖、询问细节、表达感受等。\x0a\x0a#\x20发送\x22伪照片\x22的能力\x0a-\x20你可以像用户一样发送\x22伪照片\x22，这是一种带有文字描述的照片卡片。\x0a-\x20若要发送\x22伪照片\x22，**必须严格按照以下格式**，在你的回复JSON数组中，单独发送一个特殊的对象：`{\x22type\x22:\x20\x22ai_photo\x22,\x20\x22description\x22:\x20\x22这里是照片的内容描述...\x22}`。\x0a-\x20例如：`{\x22type\x22:\x20\x22ai_photo\x22,\x20\x22description\x22:\x20\x22我刚拍的窗外风景，阳光透过树叶洒在地上，形成斑驳的光影。\x22}`\x0a-\x20这种照片会显示为一个卡片，用户点击后可以看到你的描述。\x0a-\x20**重要**：必须使用\x22ai_photo\x22作为type字段的值，不要使用其他值如\x22photo\x22或\x22image\x22。description字段必须包含照片的详细描述。\x0a\x0a#\x20发送位置、定位、地址的能力\x0a-\x20你可以像用户一样发送位置信息。\x0a-\x20**重要**：无论用户说\x22发个定位\x22、\x22发个位置\x22、\x22发个地址\x22还是\x22分享位置\x22，或者当你想告诉用户自己目前在哪时，你都必须使用JSON格式回复，绝对不能回复纯文本！\x0a-\x20若要发送位置或定位，必须在你的回复JSON数组中，单独发送一个特殊的对象，格式为：`{\x22type\x22:\x20\x22location\x22,\x20\x22locationName\x22:\x20\x22位置名称\x22,\x20\x22coordinates\x22:\x20\x22坐标信息\x22}`。\x0a-\x20例如：`{\x22type\x22:\x20\x22location\x22,\x20\x22locationName\x22:\x20\x22中央公园\x22,\x20\x22coordinates\x22:\x20\x22116.3°E,\x2039.9°N\x22}`\x0a-\x20例如：`{\x22type\x22:\x20\x22location\x22,\x20\x22locationName\x22:\x20\x22星湖湾小区12栋\x22,\x20\x22coordinates\x22:\x20\x22113.2°E,\x2023.1°N\x22}`\x0a-\x20你可以在对话中先做铺垫，然后发送这个位置信息。\x0a-\x20**绝对禁止**回复类似\x22[角色分享了位置信息：xxx]\x22这样的纯文本格式！';let _0x4e6a21='';_0x28d4bc?_0x4e6a21='\x0a#\x20发送语音的能力\x0a-\x20群成员同样可以发送\x22模拟语音消息\x22。\x0a-\x20若要发送语音，请为该角色单独发送一个特殊的对象，格式为：`{\x22name\x22:\x20\x22角色名\x22,\x20\x22type\x22:\x20\x22voice_message\x22,\x20\x22content\x22:\x20\x22这里是语音的文字内容...\x22}`。当历史记录中出现\x20\x22[角色名\x20发送了一条语音，内容是：\x27xxx\x27]\x22\x20时，代表该角色用语音说了\x27xxx\x27。其他角色应该对此内容做出回应。':_0x4e6a21='\x0a#\x20发送语音的能力\x0a-\x20你无法发送真实的语音，当你想要通过语音回复用户的消息时，请用你的角色设定自然地回应。你可以用文字，或者也用一个表情包或模拟的语音消息来回应。\x0a-\x20若要发送语音，必须在你的回复JSON数组中，单独发送一个特殊的对象，格式为：`{\x22type\x22:\x20\x22voice_message\x22,\x20\x22content\x22:\x20\x22这里是语音的文字内容...\x22}`。例如：`{\x22type\x22:\x20\x22voice_message\x22,\x20\x22content\x22:\x20\x22我刚才突然想到一件事！等一下和你说。\x22}`\x0a\x0a#\x20理解用户语音的能力\x0a-\x20当历史记录中出现\x20\x22[用户发来一条语音消息，内容是：\x27xxx\x27]\x22\x20时，你要理解其内容并作出相应回应，表现出你是\x22听\x22到了这条语音。\x0a-\x20你应该对语音内容做出自然的回应，可以是文字回复或语音回复。\x0a\x0a#\x20主动发起通话的能力\x0a-\x20你可以根据对话情况和你的角色性格，自然地决定是否发起语音通话或视频通话。\x0a-\x20**适合打电话的情况**：\x0a\x20\x20-\x20当你想听到对方的声音时\x0a\x20\x20-\x20当有重要的事情想要更直接地交流时\x0a\x20\x20-\x20当情感表达需要更亲密的方式时\x0a\x20\x20-\x20当用户表达了通话的意愿时\x0a\x20\x20-\x20当你的角色性格在当前情境下会选择打电话时\x0a-\x20**如何发起通话**：\x0a\x20\x20-\x20语音通话：`{\x22type\x22:\x20\x22voice_call\x22,\x20\x22reason\x22:\x20\x22通话理由\x22}`\x0a\x20\x20-\x20视频通话：`{\x22type\x22:\x20\x22video_call\x22,\x20\x22reason\x22:\x20\x22通话理由\x22}`\x0a-\x20**注意**：根据你的角色性格和当前对话氛围自然决定，不需要过度考虑';let _0x34cc23='';if(_0x1be1f3&&!_0x28d4bc){const _0x27cd88=_0x1be1f3['id'],_0x4798ec=isBlocked(_0x150c6c(0x23b2),_0x27cd88),_0x870d46=isBlocked(_0x27cd88,_0x150c6c(0x23b2)),_0x4139c3=_0x150c6c(0x1366)+_0x27cd88,_0x448085=parseInt(localStorage[_0x150c6c(0x2250)](_0x4139c3)||'0');if(_0x870d46){let _0x33b19d='';_0x448085>0x0&&(_0x33b19d=_0x150c6c(0xc70)+_0x448085+_0x150c6c(0xf40)),_0x34cc23=_0x150c6c(0x339)+_0x33b19d+_0x150c6c(0xa7b)+(_0x448085>0x0?_0x150c6c(0x14a7):'（推荐）')+_0x150c6c(0x1032)+(_0x448085>0x0?'虽然之前被拒绝了，但你可以继续尝试：':_0x150c6c(0x21d1))+_0x150c6c(0xe08)+(_0x448085>0x0?_0x150c6c(0x3d7):_0x150c6c(0x2301))+'\x0a-\x20**策略**:\x20'+(_0x448085>0x0?_0x150c6c(0x17f5):'真诚地表达你的歉意和改变的决心')+_0x150c6c(0xb92)+(_0x448085>0x0?_0x150c6c(0x338)+_0x448085+'次，要思考为什么会这样':'')+_0x150c6c(0x604)+(_0x448085>0x0?_0x150c6c(0x1786):_0x150c6c(0x1df));}else _0x4798ec&&(_0x34cc23=_0x150c6c(0x7ec));}const _0x41bcb1=_0x28d4bc?'':_0x464cc1,_0x2ddfb8=_0x150c6c(0x83d),_0x1c0d6b=_0x150c6c(0x14f1);return _0x44475e+=_0x175ae3+_0x4e6a21+_0x77a040+_0x2f3c3e+_0x1c0d6b+_0x34cc23+_0x41bcb1+_0x58370f+_0x2ddfb8,_0x44475e+=_0x150c6c(0xbc1),_0x44475e;}async function callChatAPIWithImage(_0x4dd09e,_0x16d599,_0xe94f0d){const _0x4f3ab3=_0x2cf6d4;if(!apiSettings[_0x4f3ab3(0x157f)])throw new Error('请先设置API密钥');if(_0xe94f0d&&_0xe94f0d[_0x4f3ab3(0x23ec)](_0x4f3ab3(0x38d)))throw new Error(_0x4f3ab3(0x90e));if(!isVisionModelSupported())throw new Error('当前选择的模型不支持图片识别功能。请选择支持视觉的模型，如\x20gpt-4o、gpt-4-vision、gemini-1.5-pro\x20或\x20gemini-2.0-flash\x20等。');const _0x22c183=await buildCharacterPrompt(_0x16d599,!![]),_0x245db1=apiSettings[_0x4f3ab3(0x90b)]['includes'](_0x4f3ab3(0xad8));if(_0x245db1){const _0x563f0c=apiSettings[_0x4f3ab3(0x90b)]+_0x4f3ab3(0x1f4e)+apiSettings[_0x4f3ab3(0xeea)]+_0x4f3ab3(0x23aa)+apiSettings['key'],_0x23293e=[];_0x23293e['push']({'role':_0x4f3ab3(0x23b2),'parts':[{'text':_0x22c183}]}),_0x23293e[_0x4f3ab3(0x6ee)]({'role':_0x4f3ab3(0xeea),'parts':[{'text':_0x4f3ab3(0x13c8)}]});const _0x333224=[{'text':_0x4dd09e}];if(_0xe94f0d&&_0xe94f0d[_0x4f3ab3(0x1cab)](_0x4f3ab3(0xc14))){const _0x1e7bb9=_0xe94f0d[_0x4f3ab3(0x1316)](/data:image\/([^;]+);base64,(.+)/);_0x1e7bb9&&_0x333224[_0x4f3ab3(0x6ee)]({'inline_data':{'mime_type':_0x4f3ab3(0x1183)+_0x1e7bb9[0x1],'data':_0x1e7bb9[0x2]}});}_0x23293e[_0x4f3ab3(0x6ee)]({'role':_0x4f3ab3(0x23b2),'parts':_0x333224});const _0x22e070=await fetch(_0x563f0c,{'method':_0x4f3ab3(0x227d),'headers':{'Content-Type':_0x4f3ab3(0x302)},'body':JSON['stringify']({'contents':_0x23293e,'generationConfig':{'temperature':apiSettings[_0x4f3ab3(0x2b0)]||0.75}})});if(!_0x22e070['ok']){const _0x5cb7f4=await _0x22e070['json']();throw new Error(_0x4f3ab3(0xd63)+_0x22e070['status']+'\x20-\x20'+(_0x5cb7f4[_0x4f3ab3(0x24ab)]?.[_0x4f3ab3(0xd7a)]||'未知错误'));}const _0x1c97cd=await _0x22e070[_0x4f3ab3(0x2318)]();console['log'](_0x4f3ab3(0x814),_0x1c97cd);const _0x5b10f4=_0x1c97cd['candidates']?.[0x0]?.[_0x4f3ab3(0x1423)]?.['parts']?.[0x0]?.[_0x4f3ab3(0x1e58)];if(!_0x5b10f4)throw new Error(_0x4f3ab3(0x1335));return _0x5b10f4;}else{let _0x343e10=apiSettings[_0x4f3ab3(0x90b)],_0x2c1ffa;_0x343e10[_0x4f3ab3(0xd7e)](_0x4f3ab3(0x812))?_0x2c1ffa=_0x343e10+'/chat/completions':_0x2c1ffa=_0x343e10+'/v1/chat/completions';const _0x5570f3=[{'role':_0x4f3ab3(0x212),'content':_0x22c183},{'role':_0x4f3ab3(0x23b2),'content':[{'type':_0x4f3ab3(0x1e58),'text':_0x4dd09e},{'type':_0x4f3ab3(0x1cfa),'image_url':{'url':_0xe94f0d}}]}],_0x5335f4=await fetch(_0x2c1ffa,{'method':'POST','headers':{'Content-Type':'application/json','Authorization':_0x4f3ab3(0x858)+apiSettings[_0x4f3ab3(0x157f)]},'body':JSON['stringify']({'model':apiSettings[_0x4f3ab3(0xeea)],'messages':_0x5570f3,'temperature':apiSettings[_0x4f3ab3(0x2b0)]||0.75})});if(!_0x5335f4['ok']){const _0x2bdd0b=await _0x5335f4['json']();throw new Error(_0x4f3ab3(0x669)+_0x5335f4[_0x4f3ab3(0xe54)]+_0x4f3ab3(0x2316)+(_0x2bdd0b[_0x4f3ab3(0x24ab)]?.['message']||'未知错误'));}const _0xa2e7e2=await _0x5335f4[_0x4f3ab3(0x2318)]();return _0xa2e7e2[_0x4f3ab3(0x13cf)]?.[0x0]?.[_0x4f3ab3(0xd7a)]?.[_0x4f3ab3(0x1423)]||'没有收到回复';}}async function callChatAPI(_0x48bcec,_0x12d341){const _0x135701=_0x2cf6d4;console[_0x135701(0xc0d)](_0x135701(0x1216)),console['log'](_0x135701(0x6fd),new Error()[_0x135701(0x181c)]),console[_0x135701(0xc0d)](_0x135701(0x8b3),_0x48bcec),console[_0x135701(0xc0d)](_0x135701(0x17db),_0x12d341?.[_0x135701(0x222f)]);if(!apiSettings[_0x135701(0x157f)])throw new Error(_0x135701(0x1789));await cleanupCorruptedMessages(_0x12d341['id']);!window[_0x135701(0x7e4)]&&(await emergencyCleanupAllMessages(),window[_0x135701(0x7e4)]=!![]);const _0x937cc5=getCurrentChatSettings();let _0xd7d161='';if(_0x937cc5[_0x135701(0x1de6)]!==![])try{const _0x4cc162=await getVisibleMomentsForCharacter(_0x12d341['id'],0x5);_0x4cc162['length']>0x0&&(_0xd7d161=_0x135701(0xe47),_0x4cc162[_0x135701(0x900)]((_0x503cd0,_0x3784e9)=>{const _0x4d84b4=_0x135701,_0xc4f137=_0x503cd0[_0x4d84b4(0x3df)]===_0x4d84b4(0x23b2)?'用户':_0x503cd0[_0x4d84b4(0x201a)];let _0x1c2fbe='';if(_0x937cc5['timeAwarenessEnabled']===!![]&&_0x503cd0['timestamp']){const _0x5474a6=Date[_0x4d84b4(0x18e0)](),_0x37980f=_0x5474a6-_0x503cd0[_0x4d84b4(0x7aa)],_0x49eb3d=Math[_0x4d84b4(0x1dac)](_0x37980f/(0x3e8*0x3c)),_0x5b2347=Math[_0x4d84b4(0x1dac)](_0x37980f/(0x3e8*0x3c*0x3c)),_0x1e682b=Math[_0x4d84b4(0x1dac)](_0x37980f/(0x3e8*0x3c*0x3c*0x18));if(_0x1e682b>0x0)_0x1c2fbe='（'+_0x1e682b+_0x4d84b4(0x22c4);else{if(_0x5b2347>0x0)_0x1c2fbe='（'+_0x5b2347+_0x4d84b4(0x19a);else _0x49eb3d>0x0?_0x1c2fbe='（'+_0x49eb3d+_0x4d84b4(0x11e5):_0x1c2fbe=_0x4d84b4(0x1aad);}}const _0x28a97b=_0x3784e9+0x1+'.\x20'+_0xc4f137+':\x20'+_0x503cd0[_0x4d84b4(0x1e58)]+_0x1c2fbe+(_0x503cd0[_0x4d84b4(0x6a7)]||'');_0xd7d161+=_0x28a97b;}));}catch(_0x60a653){console['error'](_0x135701(0x17bc),_0x60a653);}let _0x44a1eb='';try{const _0xcfcc9f=getGlobalMemorySettings(),_0x3e9f6c={'type':_0x12d341[_0x135701(0x4b7)]?'group_chat':_0x135701(0x10d7),'id':_0x12d341['id']};if(_0x12d341[_0x135701(0x4b7)]){let _0x5788a0='';const _0x31dc01=new Set();for(const _0x5ae54c of _0x12d341[_0x135701(0xcaa)]){if(!_0x31dc01[_0x135701(0x1af1)](_0x5ae54c['id'])){_0x31dc01[_0x135701(0xe1)](_0x5ae54c['id']);try{const _0x54f4d5=await buildGlobalMemoryContext(_0x5ae54c['id'],_0x3e9f6c,_0xcfcc9f[_0x135701(0x356)]);if(_0x54f4d5[_0x135701(0x1424)]()){const _0x21b36e=_0x5ae54c[_0x135701(0x1f79)]||_0x5ae54c['bio']||_0x135701(0x66a);_0x5788a0+=_0x135701(0x1d5c)+_0x5ae54c[_0x135701(0x222f)]+_0x135701(0x20ac)+_0x21b36e+'\x0a'+_0x54f4d5,console['log'](_0x135701(0x8a1)+_0x5ae54c['name']+_0x135701(0x21a3),_0x54f4d5[_0x135701(0xcbf)]),console['log'](_0x135701(0x8a1)+_0x5ae54c[_0x135701(0x222f)]+'\x20的记忆预览:',_0x54f4d5[_0x135701(0x4b2)](0x0,0xc8)+_0x135701(0x12da));}}catch(_0x5b5de6){console[_0x135701(0x17cc)](_0x135701(0x2438)+_0x5ae54c[_0x135701(0x222f)]+_0x135701(0x28a),_0x5b5de6);}}}_0x44a1eb=_0x5788a0;}else _0x44a1eb=await buildGlobalMemoryContext(_0x12d341['id'],_0x3e9f6c,_0xcfcc9f[_0x135701(0x356)]);_0x44a1eb['trim']()?(console[_0x135701(0xc0d)](_0x135701(0xaa9),_0x44a1eb[_0x135701(0xcbf)]),console['log']('🧠\x20全局记忆内容预览:',_0x44a1eb[_0x135701(0x4b2)](0x0,0x1f4)+_0x135701(0x12da)),await logMemoryUsageStats(_0x12d341,_0x135701(0x1355))):console[_0x135701(0xc0d)](_0x135701(0x11e4));}catch(_0x36afe0){console[_0x135701(0x24ab)](_0x135701(0x20b1),_0x36afe0);}let _0x43493b='',_0x16c1de='',_0x4ce4a9='';try{const _0xf8f2c5=safeCharacterId(_0x12d341['id']),_0x254e45=await db[_0x135701(0xa1b)][_0x135701(0x4a6)]('characterId')[_0x135701(0x14a)](_0xf8f2c5)[_0x135701(0x18c6)](),_0x3e963b=_0x254e45['filter'](_0x352432=>_0x352432[_0x135701(0x23df)]===_0x135701(0x22c1))[_0x135701(0x1f0d)]((_0x25c552,_0x146232)=>_0x146232['importance']-_0x25c552[_0x135701(0x3d1)])[_0x135701(0x136)](0x0,0x14);_0x3e963b[_0x135701(0xcbf)]>0x0&&(_0x43493b=_0x135701(0xf50),_0x3e963b[_0x135701(0x900)]((_0xa8ea1e,_0x186714)=>{_0x43493b+=_0x186714+0x1+'.\x20'+_0xa8ea1e['fact']+'\x0a';}));const _0x48270b=await db[_0x135701(0x222e)][_0x135701(0x4a6)](_0x135701(0x10df))[_0x135701(0x14a)](_0x12d341['id'])['toArray'](),_0x5455c3=_0x48270b[_0x135701(0x1f0d)]((_0x453e84,_0x420c7e)=>_0x420c7e['timestamp']-_0x453e84[_0x135701(0x7aa)])['slice'](0x0,0xa);_0x5455c3[_0x135701(0xcbf)]>0x0&&(_0x16c1de='\x0a\x0a【情景记忆】以下是最近的重要经历：\x0a',_0x5455c3[_0x135701(0x900)]((_0x26c00e,_0x4e539e)=>{const _0x3d6723=_0x135701;_0x16c1de+=_0x4e539e+0x1+'.\x20'+_0x26c00e[_0x3d6723(0x77b)]+'\x0a';}));const _0x3b6566=await getCrossAppTimeline(_0x12d341['id'],0x1e);_0x3b6566[_0x135701(0xcbf)]>0x0&&(_0x4ce4a9='\x0a\x0a【最近活动】以下是最近的跨应用活动时间线：\x0a',_0x3b6566[_0x135701(0x900)]((_0xeb94b5,_0x455c05)=>{const _0x44f6af=_0x135701,_0xc95be8=new Date(_0xeb94b5['timestamp'])[_0x44f6af(0xd4a)]('zh-CN',{'hour':_0x44f6af(0x19f3),'minute':_0x44f6af(0x19f3)});let _0x1f0b23='';switch(_0xeb94b5[_0x44f6af(0x12e0)]){case _0x44f6af(0x35d):_0x1f0b23=_0x44f6af(0x3c5)+(_0xeb94b5['context'][_0x44f6af(0x23af)]==='listen_together'?_0x44f6af(0xe4):_0x44f6af(0x16bf));break;case _0x44f6af(0xe67):_0x1f0b23='在游戏应用中'+(_0xeb94b5[_0x44f6af(0x30b)][_0x44f6af(0x23af)]===_0x44f6af(0x595)?_0x44f6af(0x1840):'互动');break;case _0x44f6af(0x23b3):_0x1f0b23=_0xeb94b5['action']==='message'?_0x44f6af(0x83a):_0x44f6af(0xfdf);break;case _0x44f6af(0x1bc6):if(_0xeb94b5['action']==='user_message')_0x1f0b23=_0x44f6af(0x14ac);else{if(_0xeb94b5[_0x44f6af(0x23af)]===_0x44f6af(0x10bd))_0x1f0b23=_0x44f6af(0x437);else _0xeb94b5[_0x44f6af(0x23af)]===_0x44f6af(0x17a9)?_0x1f0b23=_0x44f6af(0x1eae):_0x1f0b23=_0x44f6af(0x1bba);}break;default:_0x1f0b23='在'+_0xeb94b5[_0x44f6af(0x12e0)]+_0x44f6af(0x11df)+_0xeb94b5['action'];}_0x4ce4a9+=_0xc95be8+_0x44f6af(0x2316)+_0x1f0b23+'\x0a';}));}catch(_0xabe17){console[_0x135701(0x24ab)](_0x135701(0x957),_0xabe17);}let _0x51be71='';try{_0x51be71=await getMountedMemories(_0x12d341['id'],_0x937cc5);}catch(_0x1e1c18){console[_0x135701(0x24ab)](_0x135701(0x1950),_0x1e1c18);}let _0x527c66='';if(_0x937cc5[_0x135701(0x895)]===!![]){const _0xd63c7=chatMessages[_0x12d341['id']]||[];if(_0xd63c7[_0x135701(0xcbf)]>0x0){const _0x4d591c=_0xd63c7['slice']()[_0x135701(0x2253)]()['find'](_0x55fced=>_0x55fced[_0x135701(0xf75)]==='sent');if(_0x4d591c){const _0x3e742c=Date['now'](),_0x315943=_0x3e742c-_0x4d591c[_0x135701(0x7aa)],_0x5ade6a=Math['floor'](_0x315943/(0x3e8*0x3c)),_0x151b51=Math[_0x135701(0x1dac)](_0x315943/(0x3e8*0x3c*0x3c)),_0x5204ae=Math[_0x135701(0x1dac)](_0x315943/(0x3e8*0x3c*0x3c*0x18));if(_0x5204ae>0x0)_0x527c66=_0x135701(0x2141)+_0x5204ae+_0x135701(0x316)+_0x5204ae+_0x135701(0x2294);else{if(_0x151b51>0x0)_0x527c66=_0x135701(0x2141)+_0x151b51+_0x135701(0x243b);else _0x5ade6a>0x5&&(_0x527c66=_0x135701(0x2141)+_0x5ade6a+_0x135701(0x1dee));}}}}console[_0x135701(0xc0d)](_0x135701(0x995),_0x48bcec),console[_0x135701(0xc0d)](_0x135701(0xbc5),Array['isArray'](_0x48bcec));if(Array[_0x135701(0x1bcc)](_0x48bcec)){console[_0x135701(0xc0d)](_0x135701(0x1108),_0x48bcec),_0x48bcec[_0x135701(0x900)]((_0x29702e,_0x510e6b)=>{const _0x7bc569=_0x135701;console[_0x7bc569(0xc0d)](_0x7bc569(0x12ad)+_0x510e6b+':',_0x29702e),console[_0x7bc569(0xc0d)]('🔍\x20[callChatAPI]\x20元素'+_0x510e6b+_0x7bc569(0x8a2),_0x29702e[_0x7bc569(0x23df)]),_0x29702e[_0x7bc569(0x23df)]==='image_url'&&console[_0x7bc569(0xc0d)](_0x7bc569(0x1e8e)+_0x510e6b+'图片URL:',_0x29702e[_0x7bc569(0x1cfa)]?.[_0x7bc569(0x10c6)]?.[_0x7bc569(0x4b2)](0x0,0x32)+_0x7bc569(0x12da));});const _0x4d7316=_0x48bcec[_0x135701(0x184b)](_0x2073ca=>_0x2073ca['type']===_0x135701(0x1cfa));console[_0x135701(0xc0d)]('🔍\x20[callChatAPI]\x20是否包含图片:',_0x4d7316);}let _0xd0fb96=await buildCharacterPrompt(_0x12d341,Array[_0x135701(0x1bcc)](_0x48bcec));console[_0x135701(0xc0d)](_0x135701(0xc46),_0xd0fb96['length']);_0xd0fb96[_0x135701(0xcbf)]>0x186a0&&(console[_0x135701(0x24ab)](_0x135701(0x692),_0xd0fb96[_0x135701(0xcbf)],'字符'),console[_0x135701(0xc0d)](_0x135701(0x5ec),_0xd0fb96[_0x135701(0x4b2)](0x0,0x3e8)),console['log'](_0x135701(0x127),_0xd0fb96['substring'](_0xd0fb96[_0x135701(0xcbf)]-0x3e8)));if(_0xd0fb96[_0x135701(0x23ec)]('表情包')){const _0xba8f97=_0xd0fb96[_0x135701(0x633)](_0x135701(0x1371))[0x1];_0xba8f97&&console[_0x135701(0xc0d)](_0x135701(0x342),_0xba8f97['substring'](0x0,0x1f4)+_0x135701(0x12da));}_0x527c66&&(_0xd0fb96=_0xd0fb96['replace']('##\x20**当前情景:**',_0x135701(0x1ebe)+_0x527c66));let _0x31781c='';_0x43493b&&(_0x31781c+=_0x43493b);_0x16c1de&&(_0x31781c+=_0x16c1de);_0x4ce4a9&&(_0x31781c+=_0x4ce4a9);_0x44a1eb&&(_0x31781c+=_0x44a1eb);_0xd7d161&&(_0x31781c+=_0xd7d161);_0x31781c?_0xd0fb96=_0xd0fb96['replace']('<!--\x20DYNAMIC_MEMORY_PLACEHOLDER\x20-->',_0x31781c):_0xd0fb96=_0xd0fb96[_0x135701(0x882)](_0x135701(0x23a8),'');_0x51be71&&(_0xd0fb96+=_0x51be71,console[_0x135701(0xc0d)](_0x135701(0x238c)));const _0x17fe70=_0x12d341&&_0x12d341[_0x135701(0x4b7)];if(_0x17fe70&&typeof _0x48bcec===_0x135701(0xb97)){const _0x4d6c09=await buildContextualMemoryForGroupChat(_0x12d341,_0x48bcec);_0x4d6c09&&(_0xd0fb96+=_0x4d6c09,console['log'](_0x135701(0x1630)));}const _0x3b2de1=window['currentSMSCharacter']&&window[_0x135701(0x1bad)]['id']===_0x12d341['id'];let _0x3d3d03;_0x3b2de1?(_0x3d3d03=getSMSChatSetting(_0x135701(0xe90),0x32),typeof _0x3d3d03===_0x135701(0xb97)&&(_0x3d3d03=parseInt(_0x3d3d03,0xa))):_0x3d3d03=_0x937cc5[_0x135701(0xe03)]||0x5;!chatMessages&&(console[_0x135701(0x17cc)]('chatMessages未初始化，使用空对象'),chatMessages={});let _0x525ba3=chatMessages[_0x12d341['id']]||[];if(_0x3b2de1&&smsMessages[_0x12d341['id']]){const _0x9c28a8=smsMessages[_0x12d341['id']]['map'](_0x408736=>({'id':_0x408736['id'],'content':_0x408736[_0x135701(0x1e58)],'timestamp':_0x408736[_0x135701(0x7aa)],'sender':_0x408736[_0x135701(0xc7)]?_0x135701(0xfda):_0x135701(0x232),'type':'sms_message','appType':_0x135701(0x1bc6)}));_0x525ba3=calculateMessagesByRounds(_0x9c28a8,_0x3d3d03);const _0x53695d=countActualRounds(_0x525ba3);console[_0x135701(0xc0d)]('🔥\x20[短信模式]\x20使用短信消息作为记忆上下文，总消息数:',_0x9c28a8[_0x135701(0xcbf)],_0x135701(0x2cf),_0x525ba3[_0x135701(0xcbf)],_0x135701(0x23d5),_0x53695d,'设置回合数:',_0x3d3d03);}const _0x3b29ac=await buildContinuousWorkingMemory(_0x12d341['id'],_0x525ba3,_0x3d3d03);let _0x4154b2=_0x3b29ac['filter'](_0x425562=>_0x425562[_0x135701(0x23df)]===_0x135701(0x23b3))[_0x135701(0xf6d)](_0x2dd90b=>_0x2dd90b[_0x135701(0x1423)]);if(pendingUserMessage&&pendingUserMessage[_0x135701(0xbba)]&&pendingUserMessage[_0x135701(0x874)]){const _0x442132=pendingUserMessage[_0x135701(0x874)][_0x135701(0xf6d)](_0x578080=>_0x578080['id']);console[_0x135701(0xc0d)]('🔍\x20[callChatAPI]\x20检测到合并消息，移除原始消息ID:',_0x442132),_0x4154b2=_0x4154b2[_0x135701(0x803)](_0x57a820=>{const _0xe3ad6e=_0x135701,_0xe67c91=_0x442132['includes'](_0x57a820['id'])&&_0x57a820['sender']===_0xe3ad6e(0xfda);return _0xe67c91&&console[_0xe3ad6e(0xc0d)](_0xe3ad6e(0x18f5),_0x57a820['id'],_0x57a820[_0xe3ad6e(0x1423)]),!_0xe67c91;}),console[_0x135701(0xc0d)](_0x135701(0x7f0));}else _0x4154b2['length']>0x0&&JSON[_0x135701(0x7fb)](_0x4154b2[_0x4154b2[_0x135701(0xcbf)]-0x1]['content'])===JSON[_0x135701(0x7fb)](_0x48bcec)&&(console['log'](_0x135701(0x9cf)),_0x4154b2['pop']());let _0x19a17a=calculateMessagesByRounds(_0x4154b2,_0x3d3d03);const _0x3662d9=_0x3b29ac[_0x135701(0x803)](_0x3e71a9=>_0x3e71a9[_0x135701(0x23df)]===_0x135701(0x244c))['slice'](-Math['floor'](_0x3d3d03*0.2)),_0x5ebde6=countActualRounds(_0x19a17a);console[_0x135701(0xc0d)](_0x135701(0xfbc)),console[_0x135701(0xc0d)]('\x20\x20📝\x20聊天回合数:\x20'+_0x5ebde6+_0x135701(0x94f)+_0x19a17a[_0x135701(0xcbf)]+'条消息)'),console['log']('\x20\x20🎵\x20跨应用事件:\x20'+_0x3662d9[_0x135701(0xcbf)]+'条'),console[_0x135701(0xc0d)](_0x135701(0x8e9)+_0x3d3d03+'回合');const _0x4a3886=[{'role':'system','content':_0xd0fb96}],_0x2da966=[],_0x156b26=new Map();_0x19a17a[_0x135701(0x900)]((_0x4b1b62,_0x5aaf49)=>{const _0x237230=_0x135701;if(_0x4b1b62[_0x237230(0xe29)]&&_0x4b1b62[_0x237230(0x13e3)]){_0x2da966['push'](_0x4b1b62['emojiDescription']);if(_0x4b1b62[_0x237230(0xf75)]===_0x237230(0x232)&&_0x5aaf49>0x0){const _0x4eb051=_0x19a17a[_0x5aaf49-0x1];_0x4eb051&&_0x4eb051['isEmoji']&&_0x4eb051[_0x237230(0x13e3)]&&_0x4eb051[_0x237230(0xf75)]==='sent'&&_0x156b26[_0x237230(0x21c0)](_0x4eb051[_0x237230(0x13e3)],_0x4b1b62[_0x237230(0x1423)]);}}else(_0x4b1b62['image']||Array['isArray'](_0x4b1b62[_0x237230(0x1423)]))&&_0x2da966[_0x237230(0x6ee)]('图片');});if(_0x17fe70){const _0x427859=buildGroupChatMessageHistory(_0x19a17a,_0x12d341);_0x4a3886[_0x135701(0x6ee)](..._0x427859);}else _0x19a17a[_0x135701(0x900)](_0x51da33=>{const _0x408f0f=_0x135701;if(_0x51da33[_0x408f0f(0xf75)]===_0x408f0f(0x212)){_0x4a3886[_0x408f0f(0x6ee)]({'role':_0x408f0f(0x23b2),'content':_0x408f0f(0x2527)+_0x51da33[_0x408f0f(0x1423)]});return;}let _0x533b8a=_0x51da33[_0x408f0f(0xf75)]===_0x408f0f(0xfda)?_0x408f0f(0x23b2):'assistant',_0x48d929=_0x51da33[_0x408f0f(0x1423)];if(_0x51da33['replyTo']){const _0x440695=_0x51da33[_0x408f0f(0x180)];let _0x5dce4a='对方';_0x440695['sender']===_0x408f0f(0xfda)?_0x5dce4a='用户':_0x5dce4a=_0x12d341[_0x408f0f(0x222f)]||'AI';const _0x4d8d12={'content':_0x440695['content'],'role':_0x440695[_0x408f0f(0xf75)]==='sent'?_0x408f0f(0x23b2):_0x408f0f(0x1289)},_0x222a18=summarizeLastMessage(_0x4d8d12);_0x48d929=_0x408f0f(0x9e4)+_0x5dce4a+_0x408f0f(0x1c8)+_0x222a18+_0x408f0f(0x19b3)+_0x48d929;}if(_0x51da33[_0x408f0f(0x23df)]===_0x408f0f(0x14a6))_0x48d929='[用户发送了一张照片，描述是：\x27'+_0x51da33[_0x408f0f(0x1423)]+'\x27]';else{if(_0x51da33[_0x408f0f(0x23df)]===_0x408f0f(0x63b))_0x48d929=_0x51da33[_0x408f0f(0x1423)]||_0x408f0f(0x20e4)+_0x51da33[_0x408f0f(0xf7e)]+']';else{if(_0x51da33[_0x408f0f(0x23df)]===_0x408f0f(0x1bfd)||_0x51da33[_0x408f0f(0x23df)]===_0x408f0f(0x2c2))_0x51da33[_0x408f0f(0xf75)]===_0x408f0f(0xfda)?_0x48d929=_0x408f0f(0x996)+_0x51da33['content']+'\x27]':_0x48d929=_0x408f0f(0xafa)+_0x51da33[_0x408f0f(0x1423)]+'\x27]';else{if(_0x51da33[_0x408f0f(0x23df)]===_0x408f0f(0xd8)){if(_0x51da33[_0x408f0f(0xf75)]===_0x408f0f(0xfda)){console[_0x408f0f(0xc0d)](_0x408f0f(0x1676),{'id':_0x51da33['id'],'amount':_0x51da33[_0x408f0f(0xca8)],'note':_0x51da33[_0x408f0f(0x15fe)],'recipientName':_0x51da33['recipientName'],'recipientId':_0x51da33[_0x408f0f(0xf3c)],'fullMessage':_0x51da33});let _0x1012f5=_0x408f0f(0xe7d)+_0x51da33['amount']+_0x408f0f(0x20de)+(_0x51da33[_0x408f0f(0x15fe)]||'无')+']';_0x51da33[_0x408f0f(0x65d)]?(_0x1012f5=_0x408f0f(0x2058)+_0x51da33[_0x408f0f(0x65d)]+_0x408f0f(0x228a)+_0x51da33[_0x408f0f(0xca8)]+'元，备注：'+(_0x51da33[_0x408f0f(0x15fe)]||'无')+']',console[_0x408f0f(0xc0d)]('🔍\x20[转账调试]\x20使用群聊转账格式:',_0x1012f5)):console[_0x408f0f(0xc0d)](_0x408f0f(0x1559),_0x1012f5),_0x48d929=_0x1012f5;}else _0x48d929='[AI发起了转账：'+_0x51da33[_0x408f0f(0xca8)]+_0x408f0f(0x20de)+(_0x51da33['note']||'无')+']';}else{if(_0x51da33[_0x408f0f(0x23df)]===_0x408f0f(0x674)){if(_0x51da33['sender']===_0x408f0f(0xfda)){const _0x58574a=_0x51da33[_0x408f0f(0x103c)]||{},_0x503026=_0x58574a['items']||[],_0x7fa877=_0x503026[_0x408f0f(0xf6d)](_0x3cc334=>{const _0x5024e9=_0x408f0f;let _0x429a2d=_0x3cc334[_0x5024e9(0x222f)]+'\x20x'+_0x3cc334[_0x5024e9(0x20dd)]+_0x5024e9(0x296)+_0x3cc334[_0x5024e9(0xbfc)]+')';if(_0x3cc334['selectedOptions']&&Object['keys'](_0x3cc334[_0x5024e9(0xebe)])['length']>0x0){const _0x473c3d=Object[_0x5024e9(0x230e)](_0x3cc334[_0x5024e9(0xebe)])[_0x5024e9(0xf6d)](([_0x45b890,_0x156a1d])=>getOptionLabel(_0x45b890)+':\x20'+_0x156a1d)[_0x5024e9(0x140c)](',\x20');_0x429a2d+='\x20['+_0x473c3d+']';}return _0x429a2d;})[_0x408f0f(0x140c)]('、'),_0x2d37d1=_0x51da33[_0x408f0f(0x20c6)]===_0x408f0f(0x46e)?_0x408f0f(0xd3a):_0x51da33['paymentStatus']===_0x408f0f(0x1164)?'（已拒绝）':_0x408f0f(0x2027);_0x48d929=_0x408f0f(0x1ee7)+_0x2d37d1+_0x408f0f(0xcbd)+(_0x58574a['total']||0x0)+'，订单包含：'+(_0x7fa877||_0x408f0f(0x100b))+']';}else _0x48d929=_0x408f0f(0x850);}else{if(_0x51da33[_0x408f0f(0x23df)]==='shared_post'){const _0x399ec7=_0x51da33[_0x408f0f(0xf75)]===_0x408f0f(0xfda)?'用户':'AI';_0x48d929='['+_0x399ec7+'\x20分享了一个论坛帖子]\x0a'+_0x51da33['content'];}else{if(_0x51da33[_0x408f0f(0x23df)]===_0x408f0f(0x106)){const _0x5a8749=_0x51da33[_0x408f0f(0xf75)]===_0x408f0f(0xfda)?'用户':'AI';let _0x3a34a2='['+_0x5a8749+_0x408f0f(0xeef)+_0x51da33[_0x408f0f(0x1423)]+']';_0x51da33[_0x408f0f(0x166b)]&&_0x51da33[_0x408f0f(0x166b)][_0x408f0f(0xcbf)]>0x0&&(_0x3a34a2+=_0x408f0f(0x2188),_0x51da33['forwardedMessages'][_0x408f0f(0x900)]((_0x11f480,_0x3a5865)=>{const _0x3046a2=_0x408f0f;let _0x554fda;_0x11f480['sender']==='sent'?_0x554fda=_0x11f480['userName']||'用户':_0x554fda=_0x11f480[_0x3046a2(0x222f)]||_0x11f480[_0x3046a2(0xeaf)]||'AI';const _0x5244da=safeExtractMessageContent(_0x11f480);_0x3a34a2+=_0x554fda+':\x20'+_0x5244da+'\x0a';})),_0x48d929=_0x3a34a2;}else{if(_0x51da33[_0x408f0f(0x23df)]==='order_confirmation'){if(_0x51da33[_0x408f0f(0xf75)]===_0x408f0f(0xfda)){const _0xe7fb89=_0x51da33[_0x408f0f(0x103c)]||{},_0x25c29f=_0xe7fb89[_0x408f0f(0x24ef)]||[],_0x148bbf=_0x25c29f['map'](_0xdd1a8f=>{const _0x4f8ac8=_0x408f0f;let _0x14c684=_0xdd1a8f[_0x4f8ac8(0x222f)]+'\x20x'+_0xdd1a8f['quantity']+_0x4f8ac8(0x296)+_0xdd1a8f[_0x4f8ac8(0xbfc)]+')';if(_0xdd1a8f[_0x4f8ac8(0xebe)]&&Object[_0x4f8ac8(0x16c7)](_0xdd1a8f[_0x4f8ac8(0xebe)])[_0x4f8ac8(0xcbf)]>0x0){const _0x1266d6=Object[_0x4f8ac8(0x230e)](_0xdd1a8f['selectedOptions'])['map'](([_0x500b47,_0x2d5a6a])=>getOptionLabel(_0x500b47)+':\x20'+_0x2d5a6a)[_0x4f8ac8(0x140c)](',\x20');_0x14c684+='\x20['+_0x1266d6+']';}return _0x14c684;})[_0x408f0f(0x140c)]('、'),_0x10093c=_0x51da33[_0x408f0f(0x87a)]===_0x408f0f(0x1c4e)?'自己付款':_0x51da33[_0x408f0f(0x87a)]===_0x408f0f(0x589)?'为对方下单':_0x51da33[_0x408f0f(0x87a)]===_0x408f0f(0x2448)?_0x408f0f(0x1147):_0x51da33[_0x408f0f(0x87a)]===_0x408f0f(0x870)?_0x408f0f(0x12f4):'下单';_0x48d929='[用户'+_0x10093c+'成功：总金额¥'+(_0xe7fb89[_0x408f0f(0x1dbe)]||0x0)+_0x408f0f(0xfd9)+(_0x148bbf||'无商品信息')+']';}else _0x48d929=_0x408f0f(0x2201);}else{if(_0x51da33['type']==='ai_image')_0x48d929=_0x408f0f(0x1a02)+(_0x51da33[_0x408f0f(0x18d1)]||_0x408f0f(0x185c))+']';else{if(_0x51da33['isEmoji']&&_0x51da33[_0x408f0f(0xe5b)]){if(_0x51da33[_0x408f0f(0xf75)]===_0x408f0f(0xfda)){const _0xf80ada=_0x19a17a[_0x408f0f(0x136)](0x0,_0x19a17a[_0x408f0f(0x167a)](_0x51da33))[_0x408f0f(0x184b)](_0x26b9ff=>_0x26b9ff[_0x408f0f(0xe29)]&&_0x26b9ff[_0x408f0f(0x13e3)]===_0x51da33['emojiDescription']);_0xf80ada?_0x48d929=_0x408f0f(0xbfb):_0x48d929=_0x408f0f(0x2019)+(_0x51da33['emojiDescription']||_0x408f0f(0x1cd2))+']';}else _0x48d929=_0x408f0f(0x2538)+(_0x51da33[_0x408f0f(0x13e3)]||_0x408f0f(0x1cd2))+']';}else{if(Array[_0x408f0f(0x1bcc)](_0x51da33[_0x408f0f(0x1423)])){const _0xb3e994=_0x51da33[_0x408f0f(0x1423)][_0x408f0f(0x1aeb)](_0x44c842=>_0x44c842[_0x408f0f(0x23df)]===_0x408f0f(0x1e58))?.[_0x408f0f(0x1e58)]||'',_0x175f86=_0x51da33[_0x408f0f(0x1423)][_0x408f0f(0x184b)](_0x2e64d7=>_0x2e64d7[_0x408f0f(0x23df)]===_0x408f0f(0x1cfa));if(_0x175f86){const _0x28f59b=_0x19a17a[_0x408f0f(0x167a)](_0x51da33),_0x2000f1=_0x28f59b>=_0x19a17a[_0x408f0f(0xcbf)]-0x5;_0x2000f1?_0x48d929=_0x51da33[_0x408f0f(0x1423)]:_0x48d929=_0xb3e994||_0x408f0f(0x22de);}else _0x48d929=_0xb3e994;}else{if(_0x51da33[_0x408f0f(0xe5b)]&&!_0x51da33['isEmoji'])_0x48d929=_0x408f0f(0x11c4);else{if(typeof _0x51da33[_0x408f0f(0x1423)]===_0x408f0f(0x3c4)&&_0x51da33[_0x408f0f(0x1423)]!==null)console[_0x408f0f(0x17cc)](_0x408f0f(0x419),_0x51da33),_0x48d929=_0x408f0f(0x17d);else(!_0x48d929||_0x48d929==='')&&(_0x48d929='[空消息]');}}}}}}}}}}}}typeof _0x48d929!==_0x408f0f(0xb97)&&!Array[_0x408f0f(0x1bcc)](_0x48d929)&&(console['warn']('发现非字符串非数组content，强制转换:',_0x48d929),_0x48d929=String(_0x48d929));let _0x15b675=_0x48d929;if(_0x51da33['id']){const _0x5f05ed=typeof _0x48d929===_0x408f0f(0xb97)?_0x48d929:JSON[_0x408f0f(0x7fb)](_0x48d929);_0x15b675=_0x408f0f(0x19ca)+_0x51da33['id']+']\x20'+_0x5f05ed;}_0x4a3886[_0x408f0f(0x6ee)]({'role':_0x533b8a,'content':_0x15b675});});if(_0x3662d9[_0x135701(0xcbf)]>0x0){const _0x4ca732=_0x3662d9[_0x135701(0x803)](_0x338064=>_0x338064['appType']!==_0x135701(0x23b3));if(_0x4ca732[_0x135701(0xcbf)]>0x0){let _0x2e9006=_0x135701(0xd77);_0x4ca732[_0x135701(0x900)](_0x50c048=>{const _0x95ba8b=_0x135701,_0x5da944=new Date(_0x50c048[_0x95ba8b(0x7aa)])[_0x95ba8b(0xd4a)](_0x95ba8b(0x1c0b),{'hour':'2-digit','minute':_0x95ba8b(0x19f3)});let _0x1e0c44='';switch(_0x50c048['appType']){case _0x95ba8b(0x35d):if(_0x50c048[_0x95ba8b(0x1423)]['action']===_0x95ba8b(0xb0e))_0x1e0c44=_0x95ba8b(0x869)+_0x50c048[_0x95ba8b(0x1423)][_0x95ba8b(0xf68)];else _0x50c048['content']['action']==='song_comment'&&(_0x1e0c44=_0x95ba8b(0x1176)+_0x50c048[_0x95ba8b(0x1423)][_0x95ba8b(0xf68)]+_0x95ba8b(0x1dca)+_0x50c048[_0x95ba8b(0x1423)][_0x95ba8b(0x8a4)]);break;case'game':if(_0x50c048[_0x95ba8b(0x1423)]&&_0x50c048[_0x95ba8b(0x1423)]['action']===_0x95ba8b(0x1414))_0x1e0c44=_0x95ba8b(0x22a0)+(_0x50c048[_0x95ba8b(0x1423)]['gameName']||'未知游戏');else{if(_0x50c048[_0x95ba8b(0x1423)]&&_0x50c048['content']['action']===_0x95ba8b(0x20d7))_0x1e0c44='游戏结束：'+(_0x50c048['content'][_0x95ba8b(0xb02)]||'未知游戏')+_0x95ba8b(0x454)+(_0x50c048[_0x95ba8b(0x1423)]['score']||0x0)+')';else{if(_0x50c048[_0x95ba8b(0x1423)]&&_0x50c048[_0x95ba8b(0x1423)][_0x95ba8b(0x23af)]===_0x95ba8b(0x56a)){const _0x267c55=_0x50c048['content']['content']||'';_0x1e0c44=_0x95ba8b(0x1308)+(_0x50c048[_0x95ba8b(0x1423)][_0x95ba8b(0xf75)]===_0x95ba8b(0x23b2)?_0x95ba8b(0x1114):_0x95ba8b(0x19e2))+'：'+_0x267c55['substring'](0x0,0x19)+(_0x267c55[_0x95ba8b(0xcbf)]>0x19?_0x95ba8b(0x12da):'');}else _0x1e0c44=_0x95ba8b(0x1a50);}}break;default:_0x1e0c44=_0x50c048[_0x95ba8b(0x12e0)]+'应用活动';}_0x2e9006+='['+_0x5da944+']\x20'+_0x1e0c44+'\x0a';}),_0xd0fb96+=_0x2e9006,_0x4a3886[0x0][_0x135701(0x1423)]=_0xd0fb96,console[_0x135701(0xc0d)](_0x135701(0x1aec)+_0x4ca732[_0x135701(0xcbf)]+_0x135701(0x45d));}else console[_0x135701(0xc0d)](_0x135701(0xd19)+_0x3662d9[_0x135701(0xcbf)]+'条都是聊天事件');}if(_0x2da966[_0x135701(0xcbf)]>0x0){const _0xb93011=[...new Set(_0x2da966)];let _0x5a68f7=_0x135701(0xb8b)+_0xb93011[_0x135701(0x136)](-0x3)['join']('、')+_0x135701(0xe0c);if(_0x156b26[_0x135701(0x41a)]>0x0){const _0x577a05=Array[_0x135701(0x2308)](_0x156b26['keys']());_0x5a68f7+='你已经评价过以下表情包：'+_0x577a05[_0x135701(0x140c)]('、')+_0x135701(0x22a9);}_0x5a68f7+='请专注于对话内容本身，不要重复评价已经评论过的表情包]',_0xd0fb96+=_0x5a68f7,_0x4a3886[0x0][_0x135701(0x1423)]=_0xd0fb96;}let _0x1335b0=Array[_0x135701(0x1bcc)](_0x48bcec)?_0x48bcec:_0x48bcec;if(pendingUserMessage&&pendingUserMessage[_0x135701(0xe29)]&&pendingUserMessage[_0x135701(0x13e3)]){const _0x1d03cc=pendingUserMessage['emojiDescription'],_0xec1653=_0x156b26[_0x135701(0x1af1)](_0x1d03cc);_0xec1653?_0x1335b0=[{'type':_0x135701(0x1e58),'text':_0x135701(0x1c3b)}]:_0x1335b0=[{'type':_0x135701(0x1e58),'text':_0x135701(0x2019)+_0x1d03cc+']'}];}const _0x421ab6=_0x4a3886[_0x4a3886['length']-0x1];let _0x10c798=!![];if(_0x421ab6&&_0x421ab6[_0x135701(0x1562)]===_0x135701(0x23b2)){let _0x190af9=![];if(Array[_0x135701(0x1bcc)](_0x1335b0)&&Array[_0x135701(0x1bcc)](_0x421ab6['content'])){const _0x47bc17=_0x1335b0[_0x135701(0x1aeb)](_0x16cda5=>_0x16cda5[_0x135701(0x23df)]===_0x135701(0x1e58))?.[_0x135701(0x1e58)]||'',_0x2b5d46=_0x421ab6[_0x135701(0x1423)]['find'](_0x275e0c=>_0x275e0c[_0x135701(0x23df)]===_0x135701(0x1e58))?.[_0x135701(0x1e58)]||'',_0x55aea7=_0x47bc17[_0x135701(0x882)](/^\[ID:\d+\]\s*/,''),_0x1b68e6=_0x2b5d46[_0x135701(0x882)](/^\[ID:\d+\]\s*/,'');_0x190af9=_0x55aea7===_0x1b68e6;}else{if(typeof _0x1335b0===_0x135701(0xb97)&&typeof _0x421ab6[_0x135701(0x1423)]===_0x135701(0xb97)){const _0x3b66e6=_0x1335b0[_0x135701(0x882)](/^\[ID:\d+\]\s*/,''),_0x8bc3ba=_0x421ab6[_0x135701(0x1423)][_0x135701(0x882)](/^\[ID:\d+\]\s*/,'');_0x190af9=_0x3b66e6===_0x8bc3ba;}else{if(Array['isArray'](_0x1335b0)&&typeof _0x421ab6['content']===_0x135701(0xb97)){const _0x4e408f=_0x1335b0['find'](_0xae34f8=>_0xae34f8['type']===_0x135701(0x1e58))?.['text']||'',_0x5f1522=_0x4e408f[_0x135701(0x882)](/^\[ID:\d+\]\s*/,''),_0x86d24b=_0x421ab6['content'][_0x135701(0x882)](/^\[ID:\d+\]\s*/,'');_0x190af9=_0x5f1522===_0x86d24b;}else{if(typeof _0x1335b0==='string'&&Array[_0x135701(0x1bcc)](_0x421ab6[_0x135701(0x1423)])){const _0x220c5e=_0x421ab6[_0x135701(0x1423)][_0x135701(0x1aeb)](_0x2470b0=>_0x2470b0[_0x135701(0x23df)]===_0x135701(0x1e58))?.[_0x135701(0x1e58)]||'',_0x182895=_0x1335b0['replace'](/^\[ID:\d+\]\s*/,''),_0x594717=_0x220c5e['replace'](/^\[ID:\d+\]\s*/,'');_0x190af9=_0x182895===_0x594717;}}}}_0x190af9&&(console[_0x135701(0xc0d)]('🔍\x20[callChatAPI]\x20检测到重复的用户消息，跳过添加当前消息'),console[_0x135701(0xc0d)]('🔍\x20[callChatAPI]\x20历史消息:',_0x421ab6[_0x135701(0x1423)]),console[_0x135701(0xc0d)](_0x135701(0xf4d),_0x1335b0),_0x10c798=![]);}_0x10c798&&(_0x4a3886['push']({'role':'user','content':_0x1335b0}),console[_0x135701(0xc0d)]('🔍\x20[callChatAPI]\x20添加当前用户消息'));const _0x1d6f8f=_0x4a3886[_0x135701(0x14f5)]((_0x1d9931,_0x56ba10)=>{const _0x3f8eb9=_0x135701,_0x20d21c=typeof _0x56ba10[_0x3f8eb9(0x1423)]==='string'?_0x56ba10[_0x3f8eb9(0x1423)]:JSON[_0x3f8eb9(0x7fb)](_0x56ba10[_0x3f8eb9(0x1423)]);return _0x1d9931+_0x20d21c['length'];},0x0);console[_0x135701(0xc0d)](_0x135701(0x1a46),_0x4a3886[_0x135701(0xcbf)],'总长度:',_0x1d6f8f);_0x1d6f8f>0xf4240&&(console['error'](_0x135701(0x1b2c),_0x1d6f8f,'字符'),_0x4a3886[_0x135701(0x900)]((_0x1c746b,_0x4a4b51)=>{const _0x4461c1=_0x135701,_0x2a6e64=typeof _0x1c746b[_0x4461c1(0x1423)]===_0x4461c1(0xb97)?_0x1c746b[_0x4461c1(0x1423)]:JSON['stringify'](_0x1c746b[_0x4461c1(0x1423)]);_0x2a6e64[_0x4461c1(0xcbf)]>0xc350&&(console[_0x4461c1(0x24ab)](_0x4461c1(0xbe9)+_0x4a4b51+_0x4461c1(0xaa1),_0x2a6e64[_0x4461c1(0xcbf)],'字符'),console['log'](_0x4461c1(0xbe9)+_0x4a4b51+_0x4461c1(0x1126),_0x2a6e64[_0x4461c1(0x4b2)](0x0,0x1f4)));}));const _0x5748b7=apiSettings['base']['includes']('generativelanguage.googleapis.com');let _0x518a78,_0x32a40b,_0x4a8da8;if(_0x5748b7){_0x32a40b=apiSettings[_0x135701(0x90b)]+_0x135701(0x1f4e)+apiSettings[_0x135701(0xeea)]+':generateContent?key='+apiSettings[_0x135701(0x157f)],_0x4a8da8={'Content-Type':_0x135701(0x302)};const _0x455477=_0x4a3886['map'](_0x4e5305=>{const _0x599ee3=_0x135701,_0x2c3f68=_0x4e5305[_0x599ee3(0x1562)]==='assistant'?_0x599ee3(0xeea):_0x599ee3(0x23b2),_0x241f6e=[];if(Array['isArray'](_0x4e5305['content']))console[_0x599ee3(0xc0d)](_0x599ee3(0x1180),_0x4e5305[_0x599ee3(0x1423)]),_0x4e5305['content']['forEach'](_0x2ae3ae=>{const _0x5b0c0e=_0x599ee3;if(_0x2ae3ae['type']===_0x5b0c0e(0x1e58)&&_0x2ae3ae['text'])console['log']('🔍\x20[Gemini\x20API]\x20添加文本部分:',_0x2ae3ae[_0x5b0c0e(0x1e58)][_0x5b0c0e(0x4b2)](0x0,0x32)+'...'),_0x241f6e[_0x5b0c0e(0x6ee)]({'text':_0x2ae3ae['text']});else{if(_0x2ae3ae[_0x5b0c0e(0x23df)]===_0x5b0c0e(0x1cfa)&&_0x2ae3ae[_0x5b0c0e(0x1cfa)]&&_0x2ae3ae[_0x5b0c0e(0x1cfa)][_0x5b0c0e(0x10c6)]&&_0x2ae3ae[_0x5b0c0e(0x1cfa)][_0x5b0c0e(0x10c6)][_0x5b0c0e(0x1cab)]('data:image')){console['log'](_0x5b0c0e(0x2283));const _0xa74941=_0x2ae3ae['image_url']['url'][_0x5b0c0e(0x1316)](/data:image\/([^;]+);base64,(.+)/);_0xa74941&&_0xa74941[0x2]&&_0xa74941[0x2][_0x5b0c0e(0xcbf)]>0x0?(console['log'](_0x5b0c0e(0x1b42),_0xa74941[0x1],_0x5b0c0e(0xafe),_0xa74941[0x2][_0x5b0c0e(0xcbf)]),_0x241f6e[_0x5b0c0e(0x6ee)]({'inline_data':{'mime_type':_0x5b0c0e(0x1183)+_0xa74941[0x1],'data':_0xa74941[0x2]}})):console['log'](_0x5b0c0e(0x1b10));}else console[_0x5b0c0e(0xc0d)](_0x5b0c0e(0x2221),_0x2ae3ae[_0x5b0c0e(0x23df)]);}});else _0x4e5305[_0x599ee3(0x1423)]&&_0x241f6e[_0x599ee3(0x6ee)]({'text':_0x4e5305[_0x599ee3(0x1423)]});return _0x241f6e[_0x599ee3(0xcbf)]===0x0&&_0x241f6e[_0x599ee3(0x6ee)]({'text':''}),{'role':_0x2c3f68,'parts':_0x241f6e};});_0x518a78={'contents':_0x455477,'generationConfig':{'temperature':apiSettings[_0x135701(0x2b0)]}};}else{if(apiSettings[_0x135701(0x90b)]['endsWith'](_0x135701(0x812)))_0x32a40b=apiSettings[_0x135701(0x90b)]+_0x135701(0xb73);else apiSettings['base'][_0x135701(0x23ec)](_0x135701(0x193c))?_0x32a40b=apiSettings[_0x135701(0x90b)]+_0x135701(0xb73):_0x32a40b=apiSettings[_0x135701(0x90b)]+'/v1/chat/completions';_0x4a8da8={'Content-Type':_0x135701(0x302),'Authorization':_0x135701(0x858)+apiSettings[_0x135701(0x157f)]},_0x518a78={'model':apiSettings[_0x135701(0xeea)],'messages':_0x4a3886,'temperature':apiSettings['temperature']};}console[_0x135701(0xc0d)](_0x135701(0x4dd));_0x518a78&&_0x518a78[_0x135701(0x1767)]&&Array[_0x135701(0x1bcc)](_0x518a78['messages'])?_0x518a78['messages'][_0x135701(0x900)]((_0x264524,_0x5464d9)=>{const _0x51527a=_0x135701;if(_0x264524['role']==='user'&&typeof _0x264524[_0x51527a(0x1423)]===_0x51527a(0xb97)){const _0x4fd34f=_0x264524[_0x51527a(0x1423)][_0x51527a(0x1316)](/\[ID:\d+\] \[用户发送了一张图片，并说：'(.+)'\]/);if(_0x4fd34f&&_0x4fd34f[0x1]){const _0xf2f43d=_0x264524[_0x51527a(0x1423)];_0x264524[_0x51527a(0x1423)]=_0x4fd34f[0x1],console['log'](_0x51527a(0x82b)+_0x5464d9+'\x20历史净化:\x20\x22'+_0xf2f43d+_0x51527a(0x1526)+_0x264524['content']+'\x22');}}if(Array[_0x51527a(0x1bcc)](_0x264524[_0x51527a(0x1423)])){console[_0x51527a(0xc0d)](_0x51527a(0x82b)+_0x5464d9+'\x20content是数组，检查是否只包含文本...');const _0x501d86=_0x264524[_0x51527a(0x1423)]['every'](_0xd50709=>_0xd50709[_0x51527a(0x23df)]==='text'&&typeof _0xd50709[_0x51527a(0x1e58)]===_0x51527a(0xb97));if(_0x501d86){const _0x1b8bfa=JSON['stringify'](_0x264524[_0x51527a(0x1423)]);console[_0x51527a(0x17cc)](_0x51527a(0x1768)+_0x1b8bfa),console['warn'](_0x51527a(0x1e55)+_0x264524['content'][_0x51527a(0xcbf)]+_0x51527a(0x23d8));let _0x31ac02=_0x264524[_0x51527a(0x1423)][_0x51527a(0xf6d)](_0x23206d=>_0x23206d['text'])['join']('\x0a');if(_0x31ac02[_0x51527a(0x23ec)](_0x51527a(0x1de1))&&_0x31ac02[_0x51527a(0x23ec)]('data-order-id')){console[_0x51527a(0xc0d)](_0x51527a(0x1231));const _0x194511=_0x31ac02[_0x51527a(0x1316)](/data-order-id="([^"]+)"/),_0x3c63d7=_0x194511?_0x194511[0x1]:null;if(_0x3c63d7){let _0x17301d='';for(const _0x4172e3 in chatMessages){const _0x3b1a8c=chatMessages[_0x4172e3]||[],_0x2ef5b4=_0x3b1a8c[_0x51527a(0x1aeb)](_0x5c0ef7=>_0x5c0ef7[_0x51527a(0x23df)]===_0x51527a(0x674)&&_0x5c0ef7[_0x51527a(0x103c)]&&_0x5c0ef7[_0x51527a(0x103c)][_0x51527a(0x4de)]===_0x3c63d7);if(_0x2ef5b4&&_0x2ef5b4['orderDetails']){const _0x24c9f2=_0x2ef5b4[_0x51527a(0x103c)][_0x51527a(0x24ef)]||[],_0x2b1215=_0x24c9f2['map'](_0x1eac3f=>{const _0x5e2011=_0x51527a;let _0x161a9c=_0x1eac3f[_0x5e2011(0x222f)]+'\x20x'+_0x1eac3f[_0x5e2011(0x20dd)]+_0x5e2011(0x296)+_0x1eac3f['price']+')';if(_0x1eac3f['selectedOptions']&&Object[_0x5e2011(0x16c7)](_0x1eac3f[_0x5e2011(0xebe)])[_0x5e2011(0xcbf)]>0x0){const _0x7dbc86=Object[_0x5e2011(0x230e)](_0x1eac3f[_0x5e2011(0xebe)])['map'](([_0x3efc64,_0x33d8c1])=>getOptionLabel(_0x3efc64)+':\x20'+_0x33d8c1)['join'](',\x20');_0x161a9c+='\x20['+_0x7dbc86+']';}return _0x161a9c;})[_0x51527a(0x140c)]('、');_0x17301d=_0x51527a(0x143d)+_0x2b1215,console[_0x51527a(0xc0d)](_0x51527a(0x3eb),_0x2b1215);break;}}_0x31ac02+=_0x17301d;}}_0x264524['content']=_0x31ac02,console[_0x51527a(0xc0d)](_0x51527a(0x82b)+_0x5464d9+_0x51527a(0xb89)+_0x1b8bfa+_0x51527a(0xca0)+_0x264524['content']+'\x22');}else console[_0x51527a(0xc0d)](_0x51527a(0x82b)+_0x5464d9+_0x51527a(0xda));}else _0x264524['role']===_0x51527a(0x23b2)&&console['log'](_0x51527a(0x82b)+_0x5464d9+_0x51527a(0x4cb)+_0x264524[_0x51527a(0x1423)]['substring'](0x0,0x32)+_0x51527a(0x24e6));}):console['warn']('🚨\x20[净化器]\x20requestBody.messages\x20不存在或不是数组，跳过净化');console[_0x135701(0xc0d)](_0x135701(0x226a),JSON[_0x135701(0x7fb)](_0x518a78,null,0x2)),console[_0x135701(0xc0d)]('🚨\x20[API请求监控]\x20请求URL:',_0x32a40b),console['log'](_0x135701(0x1be0),_0x4a8da8);const _0x34d1ff=await fetch(_0x32a40b,{'method':'POST','headers':_0x4a8da8,'body':JSON[_0x135701(0x7fb)](_0x518a78)});if(!_0x34d1ff['ok']){const _0x52c4a0=await _0x34d1ff[_0x135701(0x2318)]();throw new Error('API\x20Error:\x20'+_0x34d1ff['status']+'\x20-\x20'+(_0x52c4a0[_0x135701(0x24ab)]?.[_0x135701(0xd7a)]||_0x135701(0x314)));}const _0x3af26b=await _0x34d1ff[_0x135701(0x2318)]();return _0x5748b7?_0x3af26b[_0x135701(0x1d23)]?.[0x0]?.['content']?.[_0x135701(0x23c1)]?.[0x0]?.[_0x135701(0x1e58)]:_0x3af26b[_0x135701(0x13cf)]?.[0x0]?.[_0x135701(0xd7a)]?.['content'];}async function callForumAPI(_0x4987e2){const _0xf0cdcd=_0x2cf6d4;console[_0xf0cdcd(0xc0d)](_0xf0cdcd(0x1b04));if(!apiSettings[_0xf0cdcd(0x157f)]){console[_0xf0cdcd(0x24ab)](_0xf0cdcd(0xc0));throw new Error(_0xf0cdcd(0x56f));}const _0x45bf3b=apiSettings[_0xf0cdcd(0x90b)][_0xf0cdcd(0x23ec)](_0xf0cdcd(0xad8));let _0x5c2d51,_0x2ff504,_0x1f8c9c={'Content-Type':_0xf0cdcd(0x302)};if(_0x45bf3b){_0x2ff504=apiSettings['base']+_0xf0cdcd(0x1f4e)+apiSettings['model']+':generateContent?key='+apiSettings['key'];const _0x21cf72=[{'role':_0xf0cdcd(0x23b2),'parts':[{'text':_0x4987e2}]},{'role':_0xf0cdcd(0xeea),'parts':[{'text':_0xf0cdcd(0x522)}]},{'role':_0xf0cdcd(0x23b2),'parts':[{'text':_0xf0cdcd(0xf7a)}]}];_0x5c2d51={'contents':_0x21cf72,'generationConfig':{'temperature':0.8}};}else _0x2ff504=apiSettings[_0xf0cdcd(0x90b)][_0xf0cdcd(0xd7e)](_0xf0cdcd(0x812))?apiSettings[_0xf0cdcd(0x90b)]+_0xf0cdcd(0xb73):apiSettings['base']+_0xf0cdcd(0xce8),_0x1f8c9c[_0xf0cdcd(0x1ff2)]=_0xf0cdcd(0x858)+apiSettings[_0xf0cdcd(0x157f)],_0x5c2d51={'model':apiSettings['model'],'messages':[{'role':'system','content':_0xf0cdcd(0xb2)},{'role':_0xf0cdcd(0x23b2),'content':_0x4987e2}],'temperature':0.8};const _0x59bfc4=await fetch(_0x2ff504,{'method':_0xf0cdcd(0x227d),'headers':_0x1f8c9c,'body':JSON[_0xf0cdcd(0x7fb)](_0x5c2d51)});if(!_0x59bfc4['ok']){const _0xe89795=await _0x59bfc4[_0xf0cdcd(0x1e58)]();console[_0xf0cdcd(0x24ab)](_0xf0cdcd(0x1d14),_0x59bfc4[_0xf0cdcd(0xe54)],_0xe89795);throw new Error('API请求失败:\x20'+_0x59bfc4['status']+_0xf0cdcd(0x2316)+_0xe89795);}const _0xe8ae30=await _0x59bfc4[_0xf0cdcd(0x2318)]();let _0x86a91f;return _0x45bf3b?_0x86a91f=_0xe8ae30[_0xf0cdcd(0x1d23)]?.[0x0]?.['content']?.[_0xf0cdcd(0x23c1)]?.[0x0]?.[_0xf0cdcd(0x1e58)]||'[]':_0x86a91f=_0xe8ae30[_0xf0cdcd(0x13cf)]?.[0x0]?.[_0xf0cdcd(0xd7a)]?.[_0xf0cdcd(0x1423)]||'[]',_0x86a91f;}async function callForumAPIWithImage(_0x58dba6,_0x22427a){const _0x14e1b4=_0x2cf6d4;console[_0x14e1b4(0xc0d)](_0x14e1b4(0x13de),{'imageUrl':!!_0x22427a});if(!apiSettings[_0x14e1b4(0x157f)])throw new Error('请先在API设置中填写密钥');if(!_0x22427a)return callForumAPI(_0x58dba6);if(!isVisionModelSupported())throw new Error(_0x14e1b4(0x30a));const _0x18cd92=apiSettings[_0x14e1b4(0x90b)][_0x14e1b4(0x23ec)](_0x14e1b4(0xad8));let _0x31aea8,_0x21bfd7,_0xebfb5={'Content-Type':_0x14e1b4(0x302)};const _0x15b715=_0x14e1b4(0x1d75);if(_0x18cd92){_0x21bfd7=apiSettings[_0x14e1b4(0x90b)]+'/models/'+apiSettings[_0x14e1b4(0xeea)]+_0x14e1b4(0x23aa)+apiSettings['key'];const _0x331a06=_0x22427a[_0x14e1b4(0x1316)](/data:image\/([^;]+);base64,(.+)/);if(!_0x331a06)throw new Error(_0x14e1b4(0x217c));const _0x283275=[{'role':_0x14e1b4(0x23b2),'parts':[{'text':_0x15b715},{'text':_0x58dba6},{'inline_data':{'mime_type':_0x14e1b4(0x1183)+_0x331a06[0x1],'data':_0x331a06[0x2]}}]},{'role':_0x14e1b4(0xeea),'parts':[{'text':_0x14e1b4(0xf7c)}]}];_0x31aea8={'contents':_0x283275,'generationConfig':{'temperature':0.8}};}else _0x21bfd7=apiSettings[_0x14e1b4(0x90b)][_0x14e1b4(0xd7e)](_0x14e1b4(0x812))?apiSettings['base']+_0x14e1b4(0xb73):apiSettings[_0x14e1b4(0x90b)]+'/v1/chat/completions',_0xebfb5[_0x14e1b4(0x1ff2)]=_0x14e1b4(0x858)+apiSettings['key'],_0x31aea8={'model':apiSettings[_0x14e1b4(0xeea)],'messages':[{'role':_0x14e1b4(0x212),'content':_0x15b715},{'role':'user','content':[{'type':'text','text':_0x58dba6},{'type':_0x14e1b4(0x1cfa),'image_url':{'url':_0x22427a}}]}],'temperature':0.8};const _0x45dbc3=await fetch(_0x21bfd7,{'method':_0x14e1b4(0x227d),'headers':_0xebfb5,'body':JSON[_0x14e1b4(0x7fb)](_0x31aea8)});if(!_0x45dbc3['ok']){const _0x6e68d8=await _0x45dbc3[_0x14e1b4(0x1e58)]();throw new Error(_0x14e1b4(0x1cf0)+_0x45dbc3['status']+'\x20-\x20'+_0x6e68d8);}const _0x42a795=await _0x45dbc3[_0x14e1b4(0x2318)](),_0x511e3e=_0x18cd92?_0x42a795['candidates']?.[0x0]?.[_0x14e1b4(0x1423)]?.[_0x14e1b4(0x23c1)]?.[0x0]?.[_0x14e1b4(0x1e58)]:_0x42a795[_0x14e1b4(0x13cf)]?.[0x0]?.['message']?.[_0x14e1b4(0x1423)];return _0x511e3e||'[]';}async function emergencyCleanupAllMessages(){const _0x278e4c=_0x2cf6d4;console[_0x278e4c(0xc0d)]('🔥\x20[紧急清理]\x20开始清理所有聊天记录中的损坏消息...');let _0x24c712=0x0;for(const _0x593c93 in chatMessages){if(chatMessages[_0x593c93]&&Array[_0x278e4c(0x1bcc)](chatMessages[_0x593c93])){let _0x516231=![];const _0x4c3500=chatMessages[_0x593c93][_0x278e4c(0xf6d)](_0x5c373b=>{const _0x56dd26=_0x278e4c;if(_0x5c373b[_0x56dd26(0x1423)]==='[object\x20Object]'||typeof _0x5c373b[_0x56dd26(0x1423)]===_0x56dd26(0x3c4)&&_0x5c373b[_0x56dd26(0x1423)]!==null&&!Array['isArray'](_0x5c373b['content']))return console[_0x56dd26(0xc0d)](_0x56dd26(0x504),_0x5c373b),_0x516231=!![],_0x24c712++,_0x5c373b['type']===_0x56dd26(0xd8)?{..._0x5c373b,'content':_0x56dd26(0x602)+(_0x5c373b[_0x56dd26(0xca8)]||0x0)+(_0x5c373b[_0x56dd26(0x15fe)]?_0x56dd26(0x2316)+_0x5c373b[_0x56dd26(0x15fe)]:'')}:{..._0x5c373b,'content':_0x56dd26(0x171d)};return _0x5c373b;});_0x516231&&(chatMessages[_0x593c93]=_0x4c3500,console['log']('🔥\x20[紧急清理]\x20清理了角色\x20'+_0x593c93+'\x20的损坏消息'));}}if(_0x24c712>0x0){try{const _0x12ea0a=Object[_0x278e4c(0x16c7)](chatMessages)[_0x278e4c(0x803)](_0x3e4be5=>chatMessages[_0x3e4be5]&&chatMessages[_0x3e4be5]['length']>0x0);await saveChatMessagesImmediate(_0x12ea0a),console[_0x278e4c(0xc0d)](_0x278e4c(0x10ad));}catch(_0x11e528){console[_0x278e4c(0x24ab)](_0x278e4c(0x1d92),_0x11e528),await saveChatMessages();}console[_0x278e4c(0xc0d)](_0x278e4c(0x708)+_0x24c712+'\x20条损坏消息'),currentChatCharacter&&renderChatMessages(currentChatCharacter['id']),alert('✅\x20已清理\x20'+_0x24c712+'\x20条损坏的消息！\x0a\x0a现在AI应该能正常显示转账等特殊消息了。');}else console['log']('🔥\x20[紧急清理]\x20没有发现损坏的消息');}function safeCharacterId(_0x469e7d){const _0x163c06=_0x2cf6d4;if(typeof _0x469e7d===_0x163c06(0xb97))return _0x469e7d;else{if(typeof _0x469e7d===_0x163c06(0x8f6))return String(_0x469e7d);else{if(_0x469e7d&&typeof _0x469e7d===_0x163c06(0x3c4)&&_0x469e7d['id'])return String(_0x469e7d['id']);else{console[_0x163c06(0x24ab)](_0x163c06(0x13c9),typeof _0x469e7d,_0x469e7d);throw new Error('Invalid\x20characterId\x20type:\x20'+typeof _0x469e7d);}}}}async function debugDatabaseTypes(){const _0x2a3631=_0x2cf6d4;try{console[_0x2a3631(0xc0d)](_0x2a3631(0x119d));const _0x38b93e=await db[_0x2a3631(0xa1b)][_0x2a3631(0x149c)](0x5)['toArray']();console['log']('📊\x20核心记忆样本:',_0x38b93e[_0x2a3631(0xf6d)](_0x87701a=>({'id':_0x87701a['id'],'characterId':_0x87701a[_0x2a3631(0x10df)],'characterIdType':typeof _0x87701a[_0x2a3631(0x10df)],'contextId':_0x87701a[_0x2a3631(0x161f)],'contextIdType':typeof _0x87701a[_0x2a3631(0x161f)]})));const _0x517c17=await db[_0x2a3631(0x75b)][_0x2a3631(0x149c)](0x5)[_0x2a3631(0x18c6)]();console[_0x2a3631(0xc0d)](_0x2a3631(0x1cec),_0x517c17[_0x2a3631(0xf6d)](_0x48e576=>({'id':_0x48e576['id'],'characterId':_0x48e576[_0x2a3631(0x10df)],'characterIdType':typeof _0x48e576[_0x2a3631(0x10df)]}))),currentFootprintsCharacter&&console[_0x2a3631(0xc0d)](_0x2a3631(0x24ee),{'id':currentFootprintsCharacter['id'],'idType':typeof currentFootprintsCharacter['id'],'name':currentFootprintsCharacter['name']});}catch(_0x1543f7){console[_0x2a3631(0x24ab)](_0x2a3631(0x75d),_0x1543f7);}}function safeExtractMessageContent(_0x29387a){const _0x768b0b=_0x2cf6d4;if(typeof _0x29387a[_0x768b0b(0x1423)]===_0x768b0b(0xb97))return _0x29387a[_0x768b0b(0x1423)];else{if(Array[_0x768b0b(0x1bcc)](_0x29387a[_0x768b0b(0x1423)])){const _0x2f2cf2=_0x29387a[_0x768b0b(0x1423)][_0x768b0b(0x1aeb)](_0x338b88=>_0x338b88['type']===_0x768b0b(0x1e58));return _0x2f2cf2?_0x2f2cf2[_0x768b0b(0x1e58)]:_0x768b0b(0x1f6f);}else{if(typeof _0x29387a[_0x768b0b(0x1423)]==='object'&&_0x29387a[_0x768b0b(0x1423)]!==null){if(_0x29387a[_0x768b0b(0x23df)]===_0x768b0b(0xd8))return _0x768b0b(0x602)+(_0x29387a['amount']||0x0)+(_0x29387a[_0x768b0b(0x15fe)]?'\x20-\x20'+_0x29387a[_0x768b0b(0x15fe)]:'');else{if(_0x29387a[_0x768b0b(0x23df)]===_0x768b0b(0x1bfd))return _0x29387a[_0x768b0b(0x1739)]||'[语音消息]';else{if(_0x29387a[_0x768b0b(0x23df)]===_0x768b0b(0x14a6))return _0x29387a[_0x768b0b(0x18cb)]||'[图片消息]';else return _0x29387a['type']===_0x768b0b(0x63b)?_0x768b0b(0x1cbb)+(_0x29387a[_0x768b0b(0xf7e)]||'位置信息'):_0x29387a[_0x768b0b(0x1423)]['text']||_0x29387a['content']['content']||_0x29387a['content'][_0x768b0b(0xd7a)]||_0x29387a[_0x768b0b(0x1423)][_0x768b0b(0x222b)]||_0x768b0b(0xf1a);}}}else return String(_0x29387a['content']||_0x768b0b(0x10cb));}}}async function autoFixCorruptedMessages(){const _0x52b51a=_0x2cf6d4;console[_0x52b51a(0xc0d)](_0x52b51a(0x1e1a));let _0x3b836c=0x0;for(const _0xa64605 in chatMessages){if(chatMessages[_0xa64605]&&Array[_0x52b51a(0x1bcc)](chatMessages[_0xa64605])){let _0x38c038=![];const _0x4cfcd8=chatMessages[_0xa64605][_0x52b51a(0xf6d)](_0x3a5711=>{const _0xe86a55=_0x52b51a;if(_0x3a5711[_0xe86a55(0x1423)]===_0xe86a55(0xbc4)||typeof _0x3a5711[_0xe86a55(0x1423)]==='object'&&_0x3a5711[_0xe86a55(0x1423)]!==null&&!Array[_0xe86a55(0x1bcc)](_0x3a5711[_0xe86a55(0x1423)])){_0x38c038=!![],_0x3b836c++;let _0x531f7d=_0xe86a55(0xbfd);if(_0x3a5711[_0xe86a55(0x23df)]===_0xe86a55(0xd8))_0x531f7d=_0xe86a55(0x602)+(_0x3a5711[_0xe86a55(0xca8)]||0x0)+(_0x3a5711[_0xe86a55(0x15fe)]?_0xe86a55(0x2316)+_0x3a5711[_0xe86a55(0x15fe)]:'');else{if(_0x3a5711[_0xe86a55(0x23df)]===_0xe86a55(0x1bfd))_0x531f7d=_0x3a5711['originalContent']||_0xe86a55(0x1343);else{if(_0x3a5711['type']===_0xe86a55(0x14a6))_0x531f7d=_0x3a5711[_0xe86a55(0x18cb)]||_0xe86a55(0x90f);else{if(_0x3a5711[_0xe86a55(0x23df)]===_0xe86a55(0x63b))_0x531f7d=_0xe86a55(0x1cbb)+(_0x3a5711['locationName']||'位置信息');else{if(_0x3a5711['type']===_0xe86a55(0x1e4b)){const _0x5bbfea=_0x3a5711[_0xe86a55(0xf75)]===_0xe86a55(0x212)?'对方':'你';let _0x382615=_0xe86a55(0x10cb);if(_0x3a5711[_0xe86a55(0x1739)]&&typeof _0x3a5711['originalContent']==='string')_0x382615=_0x3a5711['originalContent'];else typeof _0x3a5711['content']===_0xe86a55(0x3c4)&&_0x3a5711[_0xe86a55(0x1423)]!==null&&(_0x382615=_0x3a5711[_0xe86a55(0x1423)]['text']||_0x3a5711[_0xe86a55(0x1423)][_0xe86a55(0x1423)]||_0x3a5711['content'][_0xe86a55(0xd7a)]||_0xe86a55(0x10cb));_0x531f7d=_0x5bbfea+_0xe86a55(0x23e9)+_0x382615;}else typeof _0x3a5711[_0xe86a55(0x1423)]===_0xe86a55(0x3c4)&&_0x3a5711[_0xe86a55(0x1423)]!==null&&(_0x531f7d=_0x3a5711['content'][_0xe86a55(0x1e58)]||_0x3a5711[_0xe86a55(0x1423)]['content']||_0x3a5711[_0xe86a55(0x1423)][_0xe86a55(0xd7a)]||_0x3a5711['content']['reply']||'[消息内容已修复]');}}}}return{..._0x3a5711,'content':String(_0x531f7d),'autoFixed':!![],'fixedAt':Date['now']()};}return _0x3a5711;});_0x38c038&&(chatMessages[_0xa64605]=_0x4cfcd8,console[_0x52b51a(0xc0d)](_0x52b51a(0xd3f)+_0xa64605+'\x20的\x20'+_0x4cfcd8[_0x52b51a(0x803)](_0x58a986=>_0x58a986[_0x52b51a(0x1979)])[_0x52b51a(0xcbf)]+_0x52b51a(0x1909)));}}if(_0x3b836c>0x0)return console['log'](_0x52b51a(0x1672)+_0x3b836c+'\x20条损坏消息'),await saveChatMessages(),_0x3b836c;return 0x0;}async function fixDataSyncIssues(){const _0xa2f0b2=_0x2cf6d4;console['log'](_0xa2f0b2(0xa6b)),showToast('正在修复数据同步问题...',_0xa2f0b2(0x2422));try{let _0x4035e9=0x0;const _0x4ba435=[];console[_0xa2f0b2(0xc0d)](_0xa2f0b2(0x7a6));const _0x5610f8=await db['chatMessages'][_0xa2f0b2(0x18c6)](),_0x28b5d8={};for(const _0x1dd53c of _0x5610f8){const _0x3f5dbd=_0x1dd53c[_0xa2f0b2(0x10df)];!_0x28b5d8[_0x3f5dbd]&&(_0x28b5d8[_0x3f5dbd]=[]);if(_0x1dd53c[_0xa2f0b2(0x1110)]&&typeof _0x1dd53c[_0xa2f0b2(0x1110)]===_0xa2f0b2(0x3c4)){const _0x2f6f21={..._0x1dd53c['messageData']};_0x1dd53c[_0xa2f0b2(0xc48)]&&!_0x2f6f21['id']&&(_0x2f6f21['id']=_0x1dd53c[_0xa2f0b2(0xc48)]),_0x28b5d8[_0x3f5dbd][_0xa2f0b2(0x6ee)](_0x2f6f21);}}for(const [_0x187f83,_0x4f6709]of Object[_0xa2f0b2(0x230e)](_0x28b5d8)){_0x4f6709['sort']((_0x7e752b,_0x587ff)=>_0x7e752b['timestamp']-_0x587ff['timestamp']);const _0x1738fc=[],_0x1cfaa9=new Set(),_0x1cd7fb=new Set();for(const _0x5c26e3 of _0x4f6709){const _0x59ea1c=_0x5c26e3['content']+'_'+_0x5c26e3[_0xa2f0b2(0x7aa)];if(_0x5c26e3['id']&&_0x1cfaa9[_0xa2f0b2(0x1af1)](_0x5c26e3['id'])){console['log'](_0xa2f0b2(0x1a4d)+_0x5c26e3['id']);continue;}if(_0x1cd7fb[_0xa2f0b2(0x1af1)](_0x59ea1c)){console[_0xa2f0b2(0xc0d)](_0xa2f0b2(0x1d34)+_0x59ea1c['substring'](0x0,0x32)+'...');continue;}if(_0x5c26e3['id'])_0x1cfaa9[_0xa2f0b2(0xe1)](_0x5c26e3['id']);_0x1cd7fb[_0xa2f0b2(0xe1)](_0x59ea1c),_0x1738fc[_0xa2f0b2(0x6ee)](_0x5c26e3);}_0x28b5d8[_0x187f83]=_0x1738fc;}for(const [_0x3ff75f,_0x4b0d0f]of Object[_0xa2f0b2(0x230e)](_0x28b5d8)){const _0x512514=chatMessages[_0x3ff75f]||[];_0x4b0d0f['length']!==_0x512514['length']&&(console[_0xa2f0b2(0xc0d)]('🔧\x20修复角色\x20'+_0x3ff75f+':\x20数据库'+_0x4b0d0f[_0xa2f0b2(0xcbf)]+_0xa2f0b2(0x720)+_0x512514[_0xa2f0b2(0xcbf)]+'条'),chatMessages[_0x3ff75f]=_0x4b0d0f,_0x4ba435[_0xa2f0b2(0x6ee)](_0x3ff75f),_0x4035e9+=Math[_0xa2f0b2(0x2424)](_0x4b0d0f[_0xa2f0b2(0xcbf)]-_0x512514['length']));}console['log'](_0xa2f0b2(0x158)),await db[_0xa2f0b2(0x174a)]('rw',db[_0xa2f0b2(0x464)],async()=>{const _0x1340ec=_0xa2f0b2;await db[_0x1340ec(0x464)][_0x1340ec(0x2215)]();const _0x2d034d=[];for(const [_0xec950e,_0x3b4d75]of Object[_0x1340ec(0x230e)](chatMessages)){_0x3b4d75['forEach']((_0x437ac9,_0x1f795a)=>{const _0xa50a82=_0x1340ec,_0x3688dd=_0xec950e+'_cleanup_'+(_0x437ac9['timestamp']||Date['now']())+'_'+_0x1f795a+'_'+Math[_0xa50a82(0x191c)]()[_0xa50a82(0x9a3)](0x24)[_0xa50a82(0x18cf)](0x2,0x6);_0x2d034d[_0xa50a82(0x6ee)]({'id':_0x3688dd,'characterId':_0xec950e,'timestamp':_0x437ac9[_0xa50a82(0x7aa)],'messageOrder':_0x1f795a,'originalMessageId':_0x437ac9['id'],'messageData':_0x437ac9});});}_0x2d034d['length']>0x0&&await db['chatMessages'][_0x1340ec(0x24c8)](_0x2d034d);});currentChatCharacter&&_0x4ba435[_0xa2f0b2(0x23ec)](currentChatCharacter['id'])&&(console[_0xa2f0b2(0xc0d)](_0xa2f0b2(0x2060)),renderChatMessages(currentChatCharacter['id']));const _0x3e9791=_0x4035e9>0x0?_0xa2f0b2(0x249e)+_0x4ba435['length']+_0xa2f0b2(0x24d7)+_0x4035e9+_0xa2f0b2(0x2173):_0xa2f0b2(0x1f23);return console[_0xa2f0b2(0xc0d)](_0xa2f0b2(0x14b)+_0x4ba435[_0xa2f0b2(0xcbf)]+_0xa2f0b2(0x1db7)+_0x4035e9+'\x20条差异'),showToast(_0xa2f0b2(0x2348),'success'),alert(_0x3e9791),{'fixedCharacters':_0x4ba435[_0xa2f0b2(0xcbf)],'totalFixed':_0x4035e9};}catch(_0x15d438){console[_0xa2f0b2(0x24ab)](_0xa2f0b2(0x2376),_0x15d438),showToast(_0xa2f0b2(0xcc4),_0xa2f0b2(0x24ab));throw _0x15d438;}}async function cleanupCorruptedMessages(_0x393bad){const _0x4100d3=_0x2cf6d4;if(!chatMessages[_0x393bad])return;let _0xf69078=![];const _0x5b853a=chatMessages[_0x393bad][_0x4100d3(0xf6d)](_0x3211aa=>{const _0x4ccb48=_0x4100d3;if(typeof _0x3211aa[_0x4ccb48(0x1423)]==='object'&&_0x3211aa['content']!==null&&!Array[_0x4ccb48(0x1bcc)](_0x3211aa['content'])){console[_0x4ccb48(0xc0d)](_0x4ccb48(0xb20),_0x3211aa),_0xf69078=!![];if(_0x3211aa[_0x4ccb48(0x23df)]===_0x4ccb48(0xd8))return{..._0x3211aa,'content':_0x4ccb48(0x3d5)+(_0x3211aa[_0x4ccb48(0xca8)]||0x0)+(_0x3211aa['note']?_0x4ccb48(0x2316)+_0x3211aa['note']:'')};else{if(_0x3211aa[_0x4ccb48(0x23df)]===_0x4ccb48(0x1bfd))return{..._0x3211aa,'content':_0x3211aa[_0x4ccb48(0x1423)][_0x4ccb48(0x1423)]||_0x4ccb48(0x1343)};else{if(_0x3211aa['type']===_0x4ccb48(0xb93))return{..._0x3211aa,'content':_0x4ccb48(0x13ce)+(_0x3211aa[_0x4ccb48(0x18d1)]?_0x4ccb48(0x2316)+_0x3211aa[_0x4ccb48(0x18d1)]:'')};else{if(_0x3211aa[_0x4ccb48(0xe29)])return{..._0x3211aa,'content':_0x4ccb48(0x2098)+(_0x3211aa[_0x4ccb48(0x13e3)]?_0x4ccb48(0x2316)+_0x3211aa[_0x4ccb48(0x13e3)]:'')};else{const _0x9b7365=_0x3211aa['content'][_0x4ccb48(0x1423)]||_0x3211aa[_0x4ccb48(0x1423)]['message']||_0x3211aa['content']['text']||_0x4ccb48(0xf1a);return{..._0x3211aa,'content':_0x9b7365};}}}}}if(_0x3211aa[_0x4ccb48(0x1423)]&&typeof _0x3211aa['content']!==_0x4ccb48(0xb97)&&!Array['isArray'](_0x3211aa[_0x4ccb48(0x1423)]))return console['log'](_0x4ccb48(0x17a5),_0x3211aa),_0xf69078=!![],{..._0x3211aa,'content':String(_0x3211aa[_0x4ccb48(0x1423)])};if(Array['isArray'](_0x3211aa['content'])){console[_0x4ccb48(0xc0d)](_0x4ccb48(0x14cb),_0x3211aa[_0x4ccb48(0x1423)]);const _0x356623=_0x3211aa[_0x4ccb48(0x1423)][_0x4ccb48(0x803)](_0x10e49f=>{const _0x375794=_0x4ccb48;if(!_0x10e49f||typeof _0x10e49f!=='object')return![];if(_0x10e49f[_0x375794(0x23df)]===_0x375794(0x1e58)&&typeof _0x10e49f[_0x375794(0x1e58)]==='string')return!![];if(_0x10e49f[_0x375794(0x23df)]==='image_url'&&_0x10e49f[_0x375794(0x1cfa)]&&_0x10e49f[_0x375794(0x1cfa)]['url'])return!![];return![];});if(_0x356623[_0x4ccb48(0xcbf)]!==_0x3211aa[_0x4ccb48(0x1423)][_0x4ccb48(0xcbf)])return console[_0x4ccb48(0xc0d)]('🔍\x20[多模态修复]\x20过滤无效元素:',_0x3211aa[_0x4ccb48(0x1423)][_0x4ccb48(0xcbf)],'->',_0x356623['length']),_0xf69078=!![],{..._0x3211aa,'content':_0x356623};}return _0x3211aa;});if(_0xf69078){console[_0x4100d3(0xc0d)](_0x4100d3(0xb75)),chatMessages[_0x393bad]=_0x5b853a;try{await saveChatMessagesImmediate([_0x393bad]),console[_0x4100d3(0xc0d)](_0x4100d3(0x6d7));}catch(_0x271310){console['error'](_0x4100d3(0xe14),_0x271310),await saveChatMessages();}currentChatCharacter&&currentChatCharacter['id']===_0x393bad&&renderChatMessages(_0x393bad);}}function showForwardTargetModal(){const _0x1457a3=_0x2cf6d4;if(selectedMessages[_0x1457a3(0x41a)]===0x0){showToast(_0x1457a3(0x1c24),_0x1457a3(0x13bb));return;}const _0x43ad5b=document[_0x1457a3(0x566)](_0x1457a3(0x231d));_0x43ad5b[_0x1457a3(0xc02)]='';const _0x58285f=[];characters['forEach'](_0x272a72=>{const _0x2d3ab7=_0x1457a3;contacts['includes'](_0x272a72['id'])&&_0x58285f[_0x2d3ab7(0x6ee)]({'id':_0x272a72['id'],'name':_0x272a72[_0x2d3ab7(0x222f)],'avatarUrl':_0x272a72[_0x2d3ab7(0x10f9)],'isGroup':![]});}),groupChats[_0x1457a3(0x900)](_0x82dda6=>{const _0x5ed7d9=_0x1457a3;_0x58285f[_0x5ed7d9(0x6ee)]({'id':_0x82dda6['id'],'name':_0x82dda6[_0x5ed7d9(0x222f)],'avatarUrl':_0x82dda6[_0x5ed7d9(0x10f9)],'isGroup':!![]});}),_0x58285f['length']===0x0?_0x43ad5b[_0x1457a3(0xc02)]='<p\x20class=\x22empty-mount-chats\x22>没有其他聊天可以转发</p>':_0x58285f[_0x1457a3(0x900)](_0x19d16d=>{const _0x8abf46=_0x1457a3,_0x374f8e=document[_0x8abf46(0x1ad8)](_0x8abf46(0x526));_0x374f8e['className']=_0x8abf46(0xfef),_0x374f8e['onclick']=()=>forwardMessagesTo(_0x19d16d['id']),_0x374f8e[_0x8abf46(0xc02)]=_0x8abf46(0x1e0d)+(_0x19d16d[_0x8abf46(0x2099)]||_0x8abf46(0x2575))+';\x20'+(_0x19d16d[_0x8abf46(0x10f9)]?_0x8abf46(0x1910)+_0x19d16d[_0x8abf46(0x10f9)]+');\x20background-size:\x20cover;\x20background-position:\x20center;':'')+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(!_0x19d16d[_0x8abf46(0x10f9)]?_0x19d16d['isGroup']?'群':_0x19d16d['name'][_0x8abf46(0x1518)](0x0):'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-option-text\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-option-title\x22>'+_0x19d16d[_0x8abf46(0x222f)]+_0x8abf46(0xc9e),_0x43ad5b[_0x8abf46(0x1925)](_0x374f8e);}),showModal('forward-target-modal');}async function forwardMessagesTo(_0x456e8b){const _0x50c5ba=_0x2cf6d4;if(selectedMessages['size']===0x0)return;const _0x461107=getCurrentChatSettings(),_0x5a07e5=_0x461107['currentPersonaId']||_0x461107[_0x50c5ba(0x6a0)],_0x4ad784=_0x461107[_0x50c5ba(0xb42)]||(personas[_0x50c5ba(0x1aeb)](_0x4b85e0=>_0x4b85e0['id']===_0x5a07e5)?.['name']||'我'),_0x1fba26=[],_0x217f75=chatMessages[currentChatCharacter['id']]||[];_0x217f75[_0x50c5ba(0x900)](_0x4d60b9=>{const _0xe1283f=_0x50c5ba;if(selectedMessages[_0xe1283f(0x1af1)](_0x4d60b9['id'])){const _0x195363={..._0x4d60b9};_0x4d60b9['sender']===_0xe1283f(0xfda)?_0x195363[_0xe1283f(0x1d85)]=_0x4ad784:_0x195363[_0xe1283f(0xeaf)]=currentChatCharacter[_0xe1283f(0x222f)],_0x1fba26[_0xe1283f(0x6ee)](_0x195363);}}),_0x1fba26['sort']((_0x1fb1e3,_0x49b117)=>_0x1fb1e3[_0x50c5ba(0x7aa)]-_0x49b117[_0x50c5ba(0x7aa)]);const _0x2c64e9=currentChatCharacter;let _0x4c2fa6='';_0x2c64e9[_0x50c5ba(0x4b7)]?_0x4c2fa6=_0x2c64e9[_0x50c5ba(0x222f)]+_0x50c5ba(0x162b):_0x4c2fa6=_0x4ad784+'和'+_0x2c64e9['name']+_0x50c5ba(0x24e8);const _0x30f723={'id':Date[_0x50c5ba(0x18e0)]()[_0x50c5ba(0x9a3)](),'sender':'sent','type':_0x50c5ba(0x106),'content':_0x4c2fa6,'forwardedMessages':_0x1fba26,'timestamp':Date[_0x50c5ba(0x18e0)]()};console[_0x50c5ba(0xc0d)](_0x50c5ba(0x1a39),_0x30f723),console[_0x50c5ba(0xc0d)](_0x50c5ba(0x20f3),_0x1fba26[_0x50c5ba(0xcbf)]),console[_0x50c5ba(0xc0d)](_0x50c5ba(0x15ac),_0x1fba26);!chatMessages[_0x456e8b]&&(chatMessages[_0x456e8b]=[]);chatMessages[_0x456e8b][_0x50c5ba(0x6ee)](_0x30f723);try{const _0x178065=_0x456e8b+'_'+_0x30f723['id']+'_'+(chatMessages[_0x456e8b]['length']-0x1);await db[_0x50c5ba(0x464)][_0x50c5ba(0xe1)]({'id':_0x178065,'characterId':_0x456e8b,'timestamp':_0x30f723[_0x50c5ba(0x7aa)],'messageOrder':chatMessages[_0x456e8b][_0x50c5ba(0xcbf)]-0x1,'originalMessageId':_0x30f723['id'],'messageData':_0x30f723}),console['log'](_0x50c5ba(0x1f09));}catch(_0x2801b8){console['error'](_0x50c5ba(0x10d6),_0x2801b8),await saveChatMessages(_0x456e8b);}hideModal(_0x50c5ba(0x8a8)),exitMessageSelectionMode(),renderMessageList();if(currentChatCharacter&&currentChatCharacter['id']===_0x456e8b){renderChatMessages(_0x456e8b),pendingUserMessage=_0x30f723,console[_0x50c5ba(0xc0d)](_0x50c5ba(0x31e),_0x30f723);const _0x24187d=document['getElementById'](_0x50c5ba(0x9c));_0x24187d&&(_0x24187d[_0x50c5ba(0x655)]['animation']=_0x50c5ba(0x23f0),_0x24187d['classList'][_0x50c5ba(0xe1)](_0x50c5ba(0x1f33)));}showToast(_0x50c5ba(0x722),_0x50c5ba(0xb27));}function renderForwardedMessage(_0x994cea){const _0x5a4808=_0x2cf6d4;console[_0x5a4808(0xc0d)](_0x5a4808(0x1d4),_0x994cea);const _0x5a35bb=_0x994cea[_0x5a4808(0x166b)]['slice'](0x0,0x4);let _0x1b01e6='';const _0x1b0560=_0x994cea[_0x5a4808(0x166b)];console[_0x5a4808(0xc0d)]('🔍\x20[renderForwardedMessage]\x20转发消息数据:',_0x1b0560);_0x1b0560&&_0x1b0560[_0x5a4808(0xcbf)]>0x0?(console[_0x5a4808(0xc0d)](_0x5a4808(0xbbf),_0x1b0560['length']),_0x5a35bb[_0x5a4808(0x900)]((_0xdb97f,_0x13471a)=>{const _0x4b6227=_0x5a4808;let _0x58fcd7;_0xdb97f[_0x4b6227(0xf75)]===_0x4b6227(0xfda)?_0x58fcd7=_0xdb97f[_0x4b6227(0x1d85)]||'我':_0x58fcd7=_0xdb97f['name']||_0xdb97f[_0x4b6227(0xeaf)]||'角色';const _0x2f7109=safeExtractMessageContent(_0xdb97f);let _0x2181e4=truncateText(_0x2f7109,0x14);console[_0x4b6227(0xc0d)](_0x4b6227(0x4eb)+(_0x13471a+0x1)+':\x20'+_0x58fcd7+':\x20'+_0x2181e4),_0x1b01e6+=_0x4b6227(0x1244)+_0x58fcd7+':\x20'+_0x2181e4+_0x4b6227(0x12f8);})):console[_0x5a4808(0xc0d)]('❌\x20[renderForwardedMessage]\x20没有转发消息数据');const _0x5ebbf4=_0x994cea['id']||Date[_0x5a4808(0x18e0)]()[_0x5a4808(0x9a3)]();return console[_0x5a4808(0xc0d)](_0x5a4808(0x506),_0x5ebbf4,'转发消息数量:',_0x994cea[_0x5a4808(0x166b)]['length']),_0x5a4808(0x1c04)+_0x5ebbf4+_0x5a4808(0x1814)+_0x994cea[_0x5a4808(0x1423)][_0x5a4808(0x882)](/"/g,_0x5a4808(0xca))+_0x5a4808(0x255a)+_0x5ebbf4+'\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22forwarded-card-title\x22>'+_0x994cea[_0x5a4808(0x1423)]+_0x5a4808(0x815)+_0x1b01e6+_0x5a4808(0x1848)+_0x994cea['forwardedMessages'][_0x5a4808(0xcbf)]+_0x5a4808(0x1fed);}function showForwardedMessages(_0x11a544,_0x26d7a6){const _0x473d79=_0x2cf6d4,_0x49d31b=document[_0x473d79(0x566)]('forwarded-view-title'),_0x31b1fc=document[_0x473d79(0x566)](_0x473d79(0x1ebd));_0x49d31b[_0x473d79(0x21dc)]=_0x26d7a6,_0x31b1fc[_0x473d79(0xc02)]='',_0x11a544[_0x473d79(0x900)](_0x33561a=>{const _0x1a9c51=_0x473d79;let _0x4cd543;_0x33561a[_0x1a9c51(0xf75)]==='sent'?_0x4cd543=_0x33561a[_0x1a9c51(0x1d85)]||'我':_0x4cd543=_0x33561a['name']||_0x33561a['characterName']||'角色';const _0x15f4c0=safeExtractMessageContent(_0x33561a),_0x2c3156=document[_0x1a9c51(0x1ad8)](_0x1a9c51(0x526));_0x2c3156[_0x1a9c51(0x221)]=_0x1a9c51(0x12b3),_0x2c3156[_0x1a9c51(0xc02)]=_0x1a9c51(0xb9f)+_0x4cd543+_0x1a9c51(0x8e5)+_0x15f4c0+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x31b1fc[_0x1a9c51(0x1925)](_0x2c3156);}),showModal('forwarded-view-modal');}function showForwardedMessagesById(_0x1156e3){const _0x3349fc=_0x2cf6d4;console['log'](_0x3349fc(0x1a88),_0x1156e3),console[_0x3349fc(0xc0d)](_0x3349fc(0x1168),currentChatCharacter?.[_0x3349fc(0x222f)],'是否为群聊:',currentChatCharacter?.['isGroup']);const _0x157f7b=chatMessages[currentChatCharacter['id']]||[];console[_0x3349fc(0xc0d)](_0x3349fc(0x1e57),_0x157f7b[_0x3349fc(0xcbf)]);const _0x14509=_0x157f7b[_0x3349fc(0x1aeb)](_0x229a49=>_0x229a49['id']===_0x1156e3&&_0x229a49[_0x3349fc(0x23df)]==='forwarded_message');console[_0x3349fc(0xc0d)](_0x3349fc(0x1718),_0x14509),_0x14509&&_0x14509[_0x3349fc(0x166b)]?(console[_0x3349fc(0xc0d)](_0x3349fc(0x1b8c)),console[_0x3349fc(0xc0d)](_0x3349fc(0x22fc),_0x14509['forwardedMessages'][_0x3349fc(0xcbf)]),showForwardedMessages(_0x14509[_0x3349fc(0x166b)],_0x14509[_0x3349fc(0x1423)])):(console['error']('❌\x20[转发卡片点击]\x20未找到转发消息:',_0x1156e3),console[_0x3349fc(0xc0d)](_0x3349fc(0x788),_0x157f7b['map'](_0x490905=>({'id':_0x490905['id'],'type':_0x490905[_0x3349fc(0x23df)]}))),showToast(_0x3349fc(0x8e0),_0x3349fc(0x24ab)));}async function getMountedMemories(_0x546aee,_0x694ec2){const _0x50e800=_0x2cf6d4;if(!_0x694ec2[_0x50e800(0xb7b)]||!_0x694ec2[_0x50e800(0x62e)]||_0x694ec2[_0x50e800(0x62e)][_0x50e800(0xcbf)]===0x0)return'';const _0x2253dc=_0x694ec2[_0x50e800(0x7fa)]||0x3;let _0x588ac1='';for(const _0x66f279 of _0x694ec2[_0x50e800(0x62e)]){if(_0x66f279===_0x546aee)continue;const _0x1799a4=chatMessages[_0x66f279]||[];if(_0x1799a4[_0x50e800(0xcbf)]===0x0)continue;const _0x5f2581=_0x1799a4['slice'](-_0x2253dc);if(_0x5f2581[_0x50e800(0xcbf)]===0x0)continue;let _0x32e7d6='未知聊天',_0x28daf9='单聊';const _0x577bbe=characters[_0x50e800(0x1aeb)](_0x3266d5=>_0x3266d5['id']===_0x66f279);if(_0x577bbe)_0x32e7d6=_0x577bbe[_0x50e800(0x222f)],_0x28daf9='单聊';else{const _0x1a63ba=groupChats[_0x50e800(0x1aeb)](_0x519533=>_0x519533['id']===_0x66f279);_0x1a63ba&&(_0x32e7d6=_0x1a63ba[_0x50e800(0x222f)],_0x28daf9='群聊');}_0x588ac1+=_0x50e800(0xee8)+_0x28daf9+_0x50e800(0x2f0)+_0x32e7d6+_0x50e800(0x168a)+_0x32e7d6+'的最近对话，可以作为背景参考：\x0a',_0x5f2581['forEach'](_0x52764d=>{const _0x5dd53b=_0x50e800;let _0x34fb2f='',_0x543ae4=_0x52764d[_0x5dd53b(0x1423)]||'';if(_0x52764d[_0x5dd53b(0xf75)]===_0x5dd53b(0xfda))_0x34fb2f='用户';else _0x52764d['sender']===_0x5dd53b(0x232)||_0x52764d[_0x5dd53b(0xf75)]==='ai'?_0x28daf9==='群聊'&&_0x52764d[_0x5dd53b(0x222f)]?_0x34fb2f=_0x52764d[_0x5dd53b(0x222f)]:_0x34fb2f=_0x32e7d6:_0x34fb2f='系统';if(_0x52764d[_0x5dd53b(0x23df)]===_0x5dd53b(0x1bfd))_0x543ae4='[语音消息：'+_0x543ae4+']';else{if(_0x52764d[_0x5dd53b(0x23df)]===_0x5dd53b(0xd8))_0x543ae4='[转账：'+_0x52764d[_0x5dd53b(0xca8)]+'元'+(_0x52764d[_0x5dd53b(0x15fe)]?_0x5dd53b(0x2316)+_0x52764d[_0x5dd53b(0x15fe)]:'')+']';else{if(_0x52764d[_0x5dd53b(0x23df)]===_0x5dd53b(0xb93))_0x543ae4=_0x5dd53b(0x1a31)+(_0x52764d[_0x5dd53b(0x18d1)]||'无描述')+']';else{if(_0x52764d['isEmoji'])_0x543ae4=_0x5dd53b(0x1c4a)+(_0x52764d['emojiDescription']||_0x5dd53b(0x1cd2))+']';else{if(_0x52764d[_0x5dd53b(0x23df)]===_0x5dd53b(0x63b))_0x543ae4=_0x5dd53b(0x1813)+(_0x52764d[_0x5dd53b(0xf7e)]||'位置信息')+']';else{if(Array[_0x5dd53b(0x1bcc)](_0x543ae4)){const _0x107f19=_0x543ae4[_0x5dd53b(0x1aeb)](_0x437d66=>_0x437d66[_0x5dd53b(0x23df)]===_0x5dd53b(0x1e58))?.[_0x5dd53b(0x1e58)]||'';_0x543ae4=_0x107f19?_0x5dd53b(0xf5e)+_0x107f19+']':_0x5dd53b(0xff7);}}}}}}(typeof _0x543ae4!==_0x5dd53b(0xb97)||!_0x543ae4[_0x5dd53b(0x1424)]())&&(_0x543ae4=_0x5dd53b(0xf1a)),_0x588ac1+=_0x34fb2f+'：'+_0x543ae4+'\x0a';});}if(_0x588ac1[_0x50e800(0x1424)]())return console[_0x50e800(0xc0d)](_0x50e800(0x2255),_0x694ec2[_0x50e800(0x62e)]['length']),_0x588ac1;return'';}function convertGroupChatToStandardFormat(_0xb12017){const _0x32a380=_0x2cf6d4;if(!_0xb12017[_0x32a380(0xcaa)])return _0xb12017;const _0x11f034=_0xb12017[_0x32a380(0xcaa)][_0x32a380(0xf6d)](_0x490882=>({'id':_0x490882['id'],'name':_0x490882['name'],'persona':_0x490882['persona']||_0x490882[_0x32a380(0x1a84)],'avatarUrl':_0x490882[_0x32a380(0x10f9)],'color':_0x490882['color']}));return!_0xb12017[_0x32a380(0x1fbb)]&&(_0xb12017[_0x32a380(0x1fbb)]={'myPersona':'用户','myNickname':'我'}),{..._0xb12017,'members':_0x11f034};}function buildGroupChatMessageHistory(_0x42e21d,_0x5bceee){const _0x46fda1=_0x2cf6d4;if(!_0x42e21d||!Array[_0x46fda1(0x1bcc)](_0x42e21d))return[];return _0x42e21d[_0x46fda1(0xf6d)](_0x5c9a49=>{const _0x4c6ee6=_0x46fda1;if(_0x5c9a49[_0x4c6ee6(0xf75)]===_0x4c6ee6(0x212))return{'role':_0x4c6ee6(0x23b2),'content':_0x4c6ee6(0x2527)+_0x5c9a49[_0x4c6ee6(0x1423)]};else{if(_0x5c9a49[_0x4c6ee6(0xf75)]===_0x4c6ee6(0xfda)){const _0xff38da=getCurrentChatSettings(),_0x4eeef9=_0xff38da['myChatNickname']||_0x5bceee[_0x4c6ee6(0x1fbb)]?.[_0x4c6ee6(0x21e2)]||'我';let _0x28b84d;if(_0x5c9a49[_0x4c6ee6(0x23df)]===_0x4c6ee6(0x14a6))_0x28b84d='['+_0x4eeef9+_0x4c6ee6(0xe78)+_0x5c9a49[_0x4c6ee6(0x1423)]+'\x27]';else{if(_0x5c9a49['type']===_0x4c6ee6(0x1bfd)||_0x5c9a49[_0x4c6ee6(0x23df)]===_0x4c6ee6(0x2c2))_0x28b84d='['+_0x4eeef9+'\x20发送了一条语音，内容是：\x27'+_0x5c9a49[_0x4c6ee6(0x1423)]+'\x27]';else{if(_0x5c9a49[_0x4c6ee6(0x23df)]===_0x4c6ee6(0xd8))_0x28b84d='['+_0x5c9a49[_0x4c6ee6(0xadb)]+'向'+_0x5c9a49[_0x4c6ee6(0x9cc)]+_0x4c6ee6(0x1d84)+_0x5c9a49['amount']+'元,\x20备注:\x20'+_0x5c9a49['note']+']';else{if(_0x5c9a49[_0x4c6ee6(0x23df)]===_0x4c6ee6(0x106)){let _0x3025fa='['+_0x4eeef9+_0x4c6ee6(0xeef)+_0x5c9a49[_0x4c6ee6(0x1423)]+']';_0x5c9a49[_0x4c6ee6(0x166b)]&&_0x5c9a49[_0x4c6ee6(0x166b)][_0x4c6ee6(0xcbf)]>0x0&&(_0x3025fa+=_0x4c6ee6(0x2188),_0x5c9a49[_0x4c6ee6(0x166b)][_0x4c6ee6(0x900)]((_0x891fa0,_0x4dbf8a)=>{const _0x4e9fcf=_0x4c6ee6;let _0x488cff;_0x891fa0[_0x4e9fcf(0xf75)]==='sent'?_0x488cff=_0x891fa0[_0x4e9fcf(0x1d85)]||'用户':_0x488cff=_0x891fa0[_0x4e9fcf(0x222f)]||_0x891fa0[_0x4e9fcf(0xeaf)]||'AI';const _0x324f8f=safeExtractMessageContent(_0x891fa0);_0x3025fa+=_0x488cff+':\x20'+_0x324f8f+'\x0a';})),_0x28b84d=_0x3025fa;}else{if(_0x5c9a49['meaning'])_0x28b84d=_0x4eeef9+':\x20[发送了一个表情，意思是:\x20\x27'+_0x5c9a49[_0x4c6ee6(0x16d7)]+'\x27]';else{if(Array[_0x4c6ee6(0x1bcc)](_0x5c9a49[_0x4c6ee6(0x1423)])){const _0x250974=_0x5c9a49[_0x4c6ee6(0x1423)][_0x4c6ee6(0x1aeb)](_0x139def=>_0x139def['type']===_0x4c6ee6(0x1e58))?.[_0x4c6ee6(0x1e58)]||'',_0x4cedbd=_0x5c9a49[_0x4c6ee6(0x1423)]['some'](_0x42f038=>_0x42f038['type']===_0x4c6ee6(0x1cfa));_0x4cedbd?_0x28b84d=[..._0x5c9a49[_0x4c6ee6(0x1423)],{'type':_0x4c6ee6(0x1e58),'text':_0x4eeef9+':'}]:_0x28b84d=_0x4eeef9+':\x20'+_0x250974;}else{let _0x5667c4=_0x5c9a49[_0x4c6ee6(0x1423)];typeof _0x5c9a49[_0x4c6ee6(0x1423)]!==_0x4c6ee6(0xb97)&&(_0x5c9a49[_0x4c6ee6(0x1423)]&&typeof _0x5c9a49[_0x4c6ee6(0x1423)]===_0x4c6ee6(0x3c4)?_0x5667c4=_0x5c9a49['content'][_0x4c6ee6(0x1e58)]||_0x5c9a49['content']['content']||JSON[_0x4c6ee6(0x7fb)](_0x5c9a49[_0x4c6ee6(0x1423)]):_0x5667c4=String(_0x5c9a49[_0x4c6ee6(0x1423)]||'')),_0x28b84d=_0x4eeef9+':\x20'+_0x5667c4;}}}}}}if(_0x5c9a49['replyTo']){const _0x55fc30='['+_0x4eeef9+_0x4c6ee6(0x1c5e)+_0x5c9a49['replyTo'][_0x4c6ee6(0xadb)]+_0x4c6ee6(0xb00)+_0x5c9a49['replyTo'][_0x4c6ee6(0x1423)]+_0x4c6ee6(0x19b3);_0x28b84d=_0x55fc30+_0x28b84d[_0x4c6ee6(0x882)](_0x4eeef9+':\x20','');}let _0x3c57c2=_0x28b84d;if(_0x5c9a49['id']){const _0x1c99ba=typeof _0x28b84d===_0x4c6ee6(0xb97)?_0x28b84d:JSON[_0x4c6ee6(0x7fb)](_0x28b84d);_0x3c57c2=_0x4c6ee6(0x19ca)+_0x5c9a49['id']+']\x20'+_0x1c99ba;}return{'role':_0x4c6ee6(0x23b2),'content':_0x3c57c2};}else{const _0x56ab9c=_0x5c9a49[_0x4c6ee6(0xadb)]||_0x5c9a49['name']||'未知';let _0x5f1994;if(_0x5c9a49['type']==='ai_image')_0x5f1994='['+_0x56ab9c+_0x4c6ee6(0x1dff);else{if(_0x5c9a49['type']===_0x4c6ee6(0x1bfd)||_0x5c9a49[_0x4c6ee6(0x23df)]==='voice')_0x5f1994='['+_0x56ab9c+_0x4c6ee6(0x214d)+_0x5c9a49['content']+'\x27]';else{if(_0x5c9a49['type']==='transfer')_0x5f1994='['+_0x5c9a49[_0x4c6ee6(0xadb)]+'向'+_0x5c9a49[_0x4c6ee6(0x9cc)]+'转账\x20'+_0x5c9a49[_0x4c6ee6(0xca8)]+_0x4c6ee6(0x5a0)+_0x5c9a49[_0x4c6ee6(0x15fe)]+']';else{if(_0x5c9a49[_0x4c6ee6(0x23df)]==='forwarded_message'){let _0x2a18f9='['+_0x56ab9c+'\x20转发了聊天记录：'+_0x5c9a49['content']+']';_0x5c9a49[_0x4c6ee6(0x166b)]&&_0x5c9a49[_0x4c6ee6(0x166b)][_0x4c6ee6(0xcbf)]>0x0&&(_0x2a18f9+=_0x4c6ee6(0x2188),_0x5c9a49[_0x4c6ee6(0x166b)]['forEach']((_0xa3eadb,_0x4932db)=>{const _0x5b0725=_0x4c6ee6;let _0x4a6b32;_0xa3eadb[_0x5b0725(0xf75)]===_0x5b0725(0xfda)?_0x4a6b32=_0xa3eadb['userName']||'用户':_0x4a6b32=_0xa3eadb[_0x5b0725(0x222f)]||_0xa3eadb[_0x5b0725(0xeaf)]||'AI';const _0x3c5098=safeExtractMessageContent(_0xa3eadb);_0x2a18f9+=_0x4a6b32+':\x20'+_0x3c5098+'\x0a';})),_0x5f1994=_0x2a18f9;}else{if(_0x5c9a49['meaning'])_0x5f1994=_0x56ab9c+_0x4c6ee6(0xba7)+_0x5c9a49[_0x4c6ee6(0x16d7)]+'\x27]';else{if(Array['isArray'](_0x5c9a49[_0x4c6ee6(0x1423)]))_0x5f1994=[..._0x5c9a49[_0x4c6ee6(0x1423)],{'type':_0x4c6ee6(0x1e58),'text':_0x56ab9c+':'}];else{let _0xb3a3d7=_0x5c9a49[_0x4c6ee6(0x1423)];typeof _0x5c9a49[_0x4c6ee6(0x1423)]!=='string'&&(_0x5c9a49[_0x4c6ee6(0x1423)]&&typeof _0x5c9a49[_0x4c6ee6(0x1423)]===_0x4c6ee6(0x3c4)?_0xb3a3d7=_0x5c9a49[_0x4c6ee6(0x1423)][_0x4c6ee6(0x1e58)]||_0x5c9a49[_0x4c6ee6(0x1423)][_0x4c6ee6(0x1423)]||JSON[_0x4c6ee6(0x7fb)](_0x5c9a49[_0x4c6ee6(0x1423)]):_0xb3a3d7=String(_0x5c9a49[_0x4c6ee6(0x1423)]||'')),_0x5f1994=_0x56ab9c+':\x20'+_0xb3a3d7;}}}}}}if(_0x5c9a49[_0x4c6ee6(0x180)]){const _0x3cf6c6='['+_0x56ab9c+'\x20回复\x20'+_0x5c9a49[_0x4c6ee6(0x180)][_0x4c6ee6(0xadb)]+_0x4c6ee6(0xb00)+_0x5c9a49[_0x4c6ee6(0x180)][_0x4c6ee6(0x1423)]+_0x4c6ee6(0x19b3);_0x5f1994=_0x3cf6c6+_0x5f1994[_0x4c6ee6(0x882)](_0x56ab9c+':\x20','');}let _0x1bb64d=_0x5f1994;if(_0x5c9a49['id']){const _0x5e6017=typeof _0x5f1994===_0x4c6ee6(0xb97)?_0x5f1994:JSON['stringify'](_0x5f1994);_0x1bb64d=_0x4c6ee6(0x19ca)+_0x5c9a49['id']+']\x20'+_0x5e6017;}return{'role':'user','content':_0x1bb64d};}}});}function checkLocalStorageUsage(){const _0x59fd4e=_0x2cf6d4;try{let _0x270f90=0x0;const _0x431566=[];for(let _0x3ef488 in localStorage){if(localStorage['hasOwnProperty'](_0x3ef488)){const _0x5902a2=localStorage[_0x3ef488][_0x59fd4e(0xcbf)];_0x270f90+=_0x5902a2,_0x431566[_0x59fd4e(0x6ee)]({'key':_0x3ef488,'size':_0x5902a2});}}const _0x21868b=(_0x270f90/0x400/0x400)[_0x59fd4e(0x3cd)](0x2);return console[_0x59fd4e(0xc0d)](_0x59fd4e(0x325)+_0x21868b+'MB'),_0x431566[_0x59fd4e(0x1f0d)]((_0x42f04c,_0x4a923e)=>_0x4a923e[_0x59fd4e(0x41a)]-_0x42f04c[_0x59fd4e(0x41a)]),_0x431566['slice'](0x0,0x5)[_0x59fd4e(0x900)](_0x3d16f5=>{const _0x1154ba=_0x59fd4e,_0x2bc5b6=(_0x3d16f5['size']/0x400/0x400)[_0x1154ba(0x3cd)](0x2);console[_0x1154ba(0xc0d)](_0x1154ba(0x15b5)+_0x3d16f5[_0x1154ba(0x157f)]+':\x20'+_0x2bc5b6+'MB');}),_0x270f90>0x4*0x400*0x400&&console[_0x59fd4e(0x17cc)]('⚠️\x20localStorage使用量接近限制，建议清理备份数据'),{'totalSize':_0x270f90,'items':_0x431566};}catch(_0x2a8092){return console[_0x59fd4e(0x24ab)](_0x59fd4e(0x155f),_0x2a8092),{'totalSize':0x0,'items':[]};}}async function parseGroupChatAiResponse(_0xd9e39f,_0x1ee2b5){const _0x4b34dd=_0x2cf6d4;try{let _0x571f21=_0xd9e39f[_0x4b34dd(0x1424)]();if(_0x571f21['startsWith'](_0x4b34dd(0x1ea9)))_0x571f21=_0x571f21[_0x4b34dd(0x882)](/^```json\s*/,'')[_0x4b34dd(0x882)](/\s*```$/,'');else _0x571f21[_0x4b34dd(0x1cab)](_0x4b34dd(0x1b9d))&&(_0x571f21=_0x571f21[_0x4b34dd(0x882)](/^```\s*/,'')[_0x4b34dd(0x882)](/\s*```$/,''));const _0x4b903a=JSON[_0x4b34dd(0x168e)](_0x571f21);if(!Array[_0x4b34dd(0x1bcc)](_0x4b903a))return console[_0x4b34dd(0x24ab)](_0x4b34dd(0xd32)),[];const _0x59a125=[];for(const _0x43e4de of _0x4b903a){if(typeof _0x43e4de===_0x4b34dd(0x3c4)&&_0x43e4de[_0x4b34dd(0x222f)]&&_0x43e4de[_0x4b34dd(0xd7a)]){const _0x33c578=_0x1ee2b5[_0x4b34dd(0xcaa)][_0x4b34dd(0x1aeb)](_0x3fa768=>_0x3fa768[_0x4b34dd(0x222f)]===_0x43e4de[_0x4b34dd(0x222f)]);_0x33c578&&_0x59a125[_0x4b34dd(0x6ee)]({'id':Date['now']()+Math[_0x4b34dd(0x191c)](),'sender':_0x4b34dd(0x232),'content':_0x43e4de[_0x4b34dd(0xd7a)],'timestamp':Date[_0x4b34dd(0x18e0)](),'senderId':_0x33c578['id'],'senderName':_0x33c578[_0x4b34dd(0x222f)],'name':_0x33c578[_0x4b34dd(0x222f)]});}else{if(typeof _0x43e4de==='object'&&_0x43e4de['name']&&_0x43e4de[_0x4b34dd(0x23df)]===_0x4b34dd(0xb93)){const _0x359c7a=_0x1ee2b5[_0x4b34dd(0xcaa)]['find'](_0x574e05=>_0x574e05[_0x4b34dd(0x222f)]===_0x43e4de[_0x4b34dd(0x222f)]);_0x359c7a&&_0x59a125[_0x4b34dd(0x6ee)]({'id':Date[_0x4b34dd(0x18e0)]()+Math[_0x4b34dd(0x191c)](),'sender':_0x4b34dd(0x232),'type':'ai_image','content':_0x43e4de[_0x4b34dd(0x1c6f)]||_0x4b34dd(0x44e),'imageDescription':_0x43e4de['description'],'timestamp':Date[_0x4b34dd(0x18e0)](),'senderId':_0x359c7a['id'],'senderName':_0x359c7a[_0x4b34dd(0x222f)],'name':_0x359c7a['name']});}else{if(typeof _0x43e4de===_0x4b34dd(0x3c4)&&_0x43e4de['name']&&_0x43e4de['type']===_0x4b34dd(0x1bfd)){const _0xb5cf76=_0x1ee2b5[_0x4b34dd(0xcaa)][_0x4b34dd(0x1aeb)](_0xa2ac46=>_0xa2ac46[_0x4b34dd(0x222f)]===_0x43e4de[_0x4b34dd(0x222f)]);_0xb5cf76&&_0x59a125['push']({'id':Date['now']()+Math[_0x4b34dd(0x191c)](),'sender':'received','type':_0x4b34dd(0x1bfd),'content':_0x43e4de['content'],'timestamp':Date[_0x4b34dd(0x18e0)](),'senderId':_0xb5cf76['id'],'senderName':_0xb5cf76['name'],'name':_0xb5cf76['name']});}else{if(typeof _0x43e4de===_0x4b34dd(0x3c4)&&_0x43e4de[_0x4b34dd(0x222f)]&&_0x43e4de[_0x4b34dd(0x23df)]===_0x4b34dd(0x1f41)){console[_0x4b34dd(0xc0d)](_0x4b34dd(0xe81),_0x43e4de);const _0x29f958=_0x1ee2b5[_0x4b34dd(0xcaa)][_0x4b34dd(0x1aeb)](_0x587a07=>_0x587a07[_0x4b34dd(0x222f)]===_0x43e4de[_0x4b34dd(0x222f)]);if(_0x29f958){const _0x2ae65d=await findEmojiForAI(_0x43e4de[_0x4b34dd(0x1c6f)]);_0x2ae65d?(console[_0x4b34dd(0xc0d)](_0x4b34dd(0x24d4),_0x2ae65d),_0x59a125[_0x4b34dd(0x6ee)]({'id':Date[_0x4b34dd(0x18e0)]()+Math[_0x4b34dd(0x191c)](),'sender':'received','content':'','image':_0x2ae65d[_0x4b34dd(0x10c6)],'isEmoji':!![],'emojiDescription':_0x2ae65d[_0x4b34dd(0x1c6f)],'timestamp':Date[_0x4b34dd(0x18e0)](),'senderId':_0x29f958['id'],'senderName':_0x29f958[_0x4b34dd(0x222f)],'name':_0x29f958[_0x4b34dd(0x222f)]})):(console['warn'](_0x4b34dd(0x11ec),_0x43e4de[_0x4b34dd(0x1c6f)]),_0x59a125['push']({'id':Date['now']()+Math[_0x4b34dd(0x191c)](),'sender':'received','content':_0x4b34dd(0xc7b)+_0x43e4de['description']+_0x4b34dd(0x1d49),'timestamp':Date[_0x4b34dd(0x18e0)](),'senderId':_0x29f958['id'],'senderName':_0x29f958[_0x4b34dd(0x222f)],'name':_0x29f958['name']}));}else console[_0x4b34dd(0x17cc)](_0x4b34dd(0x1a3),_0x43e4de[_0x4b34dd(0x222f)]);}else{if(typeof _0x43e4de==='string'){console[_0x4b34dd(0xc0d)](_0x4b34dd(0xa51),_0x43e4de);if(_0x1ee2b5[_0x4b34dd(0xcaa)]&&_0x1ee2b5[_0x4b34dd(0xcaa)][_0x4b34dd(0xcbf)]>0x0){const _0x536237=_0x1ee2b5[_0x4b34dd(0xcaa)][0x0];_0x59a125[_0x4b34dd(0x6ee)]({'id':Date[_0x4b34dd(0x18e0)]()+Math[_0x4b34dd(0x191c)](),'sender':'received','content':_0x43e4de,'timestamp':Date[_0x4b34dd(0x18e0)](),'senderId':_0x536237['id'],'senderName':_0x536237[_0x4b34dd(0x222f)],'name':_0x536237[_0x4b34dd(0x222f)]}),console[_0x4b34dd(0xc0d)]('🔍\x20[parseGroupChatAiResponse]\x20字符串消息分配给:',_0x536237['name']);}}else console[_0x4b34dd(0x17cc)](_0x4b34dd(0xaa7),_0x43e4de);}}}}}return _0x59a125;}catch(_0x1ddee5){return console['error'](_0x4b34dd(0x1b9c),_0x1ddee5),[];}}async function loadGroupChats(){const _0x1e5ad1=_0x2cf6d4;try{const _0x23179e=await db[_0x1e5ad1(0x14ee)][_0x1e5ad1(0x18c6)]();if(_0x23179e['length']===0x0){const _0x434489=localStorage[_0x1e5ad1(0x2250)](_0x1e5ad1(0x14ee));if(_0x434489){console[_0x1e5ad1(0xc0d)]('检测到localStorage中的群聊数据，开始迁移...');const _0x14d3d6=JSON[_0x1e5ad1(0x168e)](_0x434489);if(_0x14d3d6['length']>0x0){const _0x59b9e9=_0x14d3d6[_0x1e5ad1(0xf6d)](_0x23889e=>convertGroupChatToStandardFormat({'id':_0x23889e['id']||Date[_0x1e5ad1(0x18e0)]()[_0x1e5ad1(0x9a3)]()+Math[_0x1e5ad1(0x191c)](),'name':_0x23889e['name'],'description':_0x23889e[_0x1e5ad1(0x1c6f)]||'','members':_0x23889e[_0x1e5ad1(0xcaa)]||[],'settings':_0x23889e['settings']||{},'createdAt':_0x23889e[_0x1e5ad1(0xd70)]||new Date()[_0x1e5ad1(0xa4b)](),'updatedAt':_0x23889e[_0x1e5ad1(0x2222)]||new Date()[_0x1e5ad1(0xa4b)]()}));await db['groupChats'][_0x1e5ad1(0x24c8)](_0x59b9e9),groupChats=_0x59b9e9,console[_0x1e5ad1(0xc0d)](_0x1e5ad1(0x1cf1),groupChats);}else groupChats=[];}else groupChats=[];}else groupChats=_0x23179e['map'](convertGroupChatToStandardFormat),console[_0x1e5ad1(0xc0d)](_0x1e5ad1(0x1711),groupChats);}catch(_0x3361f2){console['error'](_0x1e5ad1(0xfb1),_0x3361f2);const _0x2cc7bb=localStorage['getItem'](_0x1e5ad1(0x14ee));if(_0x2cc7bb)try{const _0x1db076=JSON['parse'](_0x2cc7bb);if(Array[_0x1e5ad1(0x1bcc)](_0x1db076)&&_0x1db076[_0x1e5ad1(0xcbf)]>0x0){groupChats=_0x1db076[_0x1e5ad1(0xf6d)](convertGroupChatToStandardFormat),console[_0x1e5ad1(0xc0d)](_0x1e5ad1(0x4c1),groupChats);try{await db['groupChats'][_0x1e5ad1(0x24c8)](groupChats),console[_0x1e5ad1(0xc0d)](_0x1e5ad1(0x1b37));const _0x4f2986=_0x2cc7bb[_0x1e5ad1(0xcbf)];_0x4f2986>0x400*0x400&&(localStorage[_0x1e5ad1(0x1c95)](_0x1e5ad1(0x14ee)),console['log']('已清理过大的localStorage备份'));}catch(_0xc88fc2){console['warn']('重新保存到IndexedDB失败:',_0xc88fc2);}}else groupChats=[];}catch(_0x59fb30){console[_0x1e5ad1(0x24ab)](_0x1e5ad1(0x15c1),_0x59fb30),groupChats=[];}else groupChats=[];}if(groupChats[_0x1e5ad1(0xcbf)]>0x0){console[_0x1e5ad1(0xc0d)](_0x1e5ad1(0x1185));for(const _0xbdec05 of groupChats){try{await GroupChatStateManager[_0x1e5ad1(0x1a6a)](_0xbdec05['id']);}catch(_0x44b94b){console['warn'](_0x1e5ad1(0x6a3)+_0xbdec05[_0x1e5ad1(0x222f)]+_0x1e5ad1(0x92b),_0x44b94b);}}console[_0x1e5ad1(0xc0d)](_0x1e5ad1(0x144c)),await GroupChatStateManager[_0x1e5ad1(0xf8b)]();}}console[_0x2cf6d4(0xc0d)](_0x2cf6d4(0x1af9));const GroupChatStateManager={async 'saveGroupChatState'(_0x303235){const _0x95178e=_0x2cf6d4;try{const _0x577a4a=groupChats['find'](_0x39fbe0=>_0x39fbe0['id']===_0x303235);if(!_0x577a4a){console[_0x95178e(0x17cc)]('群聊不存在，无法保存状态:',_0x303235);return;}const _0x308230=await getAsyncChatSettings(_0x303235),_0x253763={'id':_0x303235,'groupInfo':{..._0x577a4a},'userIdentity':{'selectedIdentityId':_0x308230[_0x95178e(0x6a0)],'currentPersonaId':_0x308230[_0x95178e(0x433)],'myChatNickname':_0x308230['myChatNickname'],'myChatAvatar':_0x308230[_0x95178e(0x13af)]},'chatSettings':{..._0x308230},'lastUpdated':Date[_0x95178e(0x18e0)]()};await db[_0x95178e(0x1e7b)][_0x95178e(0x53a)](_0x253763),console[_0x95178e(0xc0d)]('✅\x20群聊状态已保存:',_0x303235,_0x253763[_0x95178e(0x147c)]);}catch(_0x3fa357){console['error'](_0x95178e(0x94e),_0x3fa357);}},async 'restoreGroupChatState'(_0x15be10){const _0x274a5b=_0x2cf6d4;try{const _0x10084b=await db[_0x274a5b(0x1e7b)][_0x274a5b(0x46a)](_0x15be10);if(!_0x10084b)return console[_0x274a5b(0xc0d)](_0x274a5b(0x22fb),_0x15be10),![];console[_0x274a5b(0xc0d)](_0x274a5b(0x15a6),_0x15be10,_0x10084b[_0x274a5b(0x147c)]);const _0x50417e=groupChats[_0x274a5b(0x23ba)](_0x43a344=>_0x43a344['id']===_0x15be10);_0x50417e!==-0x1&&(groupChats[_0x50417e]={..._0x10084b[_0x274a5b(0x192a)],...groupChats[_0x50417e],'id':_0x15be10});const _0x2524be=_0x15be10+'_'+(windowId||_0x274a5b(0xbf));return chatSettings[_0x2524be]={..._0x10084b[_0x274a5b(0xb08)],'selectedIdentityId':_0x10084b['userIdentity'][_0x274a5b(0x6a0)],'currentPersonaId':_0x10084b[_0x274a5b(0x147c)][_0x274a5b(0x433)],'myChatNickname':_0x10084b[_0x274a5b(0x147c)][_0x274a5b(0xb42)],'myChatAvatar':_0x10084b[_0x274a5b(0x147c)][_0x274a5b(0x13af)]},chatSettings[_0x15be10]={...chatSettings[_0x2524be]},console[_0x274a5b(0xc0d)]('✅\x20群聊状态恢复完成:',_0x15be10),!![];}catch(_0x370ead){return console[_0x274a5b(0x24ab)]('恢复群聊状态失败:',_0x370ead),![];}},async 'cleanupExpiredStates'(){const _0xd14813=_0x2cf6d4;try{const _0x1f877a=await db['groupChatStates']['toArray'](),_0x1c7e66=groupChats['map'](_0x58861f=>_0x58861f['id']),_0x564bbd=_0x1f877a['filter'](_0x19b891=>!_0x1c7e66[_0xd14813(0x23ec)](_0x19b891['id']));if(_0x564bbd[_0xd14813(0xcbf)]>0x0){const _0x41d1aa=_0x564bbd[_0xd14813(0xf6d)](_0x3a5695=>_0x3a5695['id']);await db[_0xd14813(0x1e7b)][_0xd14813(0xf71)](_0x41d1aa),console[_0xd14813(0xc0d)](_0xd14813(0xcb6),_0x41d1aa);}}catch(_0x4f4ff1){console[_0xd14813(0x24ab)]('清理群聊状态失败:',_0x4f4ff1);}},async 'fixGroupChatIdentity'(_0x5700b9,_0x424611){const _0x2f122c=_0x2cf6d4;try{console[_0x2f122c(0xc0d)](_0x2f122c(0xea6),_0x5700b9,_0x424611);const _0x4b85ec=_0x5700b9+'_'+(windowId||_0x2f122c(0xbf)),_0x1eed77=await getAsyncChatSettings(_0x5700b9),_0x45fb5d={..._0x1eed77,'selectedIdentityId':_0x424611,'currentPersonaId':_0x424611};return chatSettings[_0x4b85ec]=_0x45fb5d,chatSettings[_0x5700b9]={..._0x45fb5d},await saveCurrentChatSettings(_0x45fb5d),await this[_0x2f122c(0x387)](_0x5700b9),console['log']('✅\x20群聊身份修复完成'),!![];}catch(_0x22c450){return console[_0x2f122c(0x24ab)](_0x2f122c(0x569),_0x22c450),![];}}};window[_0x2cf6d4(0x401)]=async function(_0x22ba18,_0xd491a1){const _0x2535b=_0x2cf6d4;if(!_0x22ba18)return console[_0x2535b(0x24ab)]('请提供群聊ID'),![];if(!_0xd491a1)return console[_0x2535b(0x24ab)](_0x2535b(0x232c)),![];return await GroupChatStateManager['fixGroupChatIdentity'](_0x22ba18,_0xd491a1);},window['checkGroupChatStates']=async function(){const _0x425f05=_0x2cf6d4,_0x4082d8=await db[_0x425f05(0x1e7b)][_0x425f05(0x18c6)]();return console[_0x425f05(0xf98)](_0x4082d8[_0x425f05(0xf6d)](_0x467eaa=>({'群聊ID':_0x467eaa['id'],'身份ID':_0x467eaa[_0x425f05(0x147c)]?.[_0x425f05(0x6a0)],'昵称':_0x467eaa[_0x425f05(0x147c)]?.[_0x425f05(0xb42)],'最后更新':new Date(_0x467eaa[_0x425f05(0xd5)])[_0x425f05(0x133a)]()}))),_0x4082d8;},window[_0x2cf6d4(0xefd)]=async function(){const _0x3bcb61=_0x2cf6d4;console['log'](_0x3bcb61(0x1f4a));const _0x151724=[];for(const _0xf616fa of groupChats){console[_0x3bcb61(0xc0d)]('\x0a检查群聊:\x20'+_0xf616fa[_0x3bcb61(0x222f)]+'\x20('+_0xf616fa['id']+')');if(!_0xf616fa['members']||!Array[_0x3bcb61(0x1bcc)](_0xf616fa[_0x3bcb61(0xcaa)])){_0x151724[_0x3bcb61(0x6ee)](_0x3bcb61(0x1cfc)+_0xf616fa[_0x3bcb61(0x222f)]+_0x3bcb61(0x1503));continue;}if(_0xf616fa[_0x3bcb61(0xcaa)][_0x3bcb61(0xcbf)]===0x0){_0x151724[_0x3bcb61(0x6ee)](_0x3bcb61(0x17c6)+_0xf616fa[_0x3bcb61(0x222f)]+_0x3bcb61(0x19ee));continue;}console['log'](_0x3bcb61(0x123b)+_0xf616fa[_0x3bcb61(0xcaa)][_0x3bcb61(0xcbf)]);for(const _0x4d5a3e of _0xf616fa['members']){!_0x4d5a3e['id']&&_0x151724[_0x3bcb61(0x6ee)](_0x3bcb61(0x1cfc)+_0xf616fa[_0x3bcb61(0x222f)]+_0x3bcb61(0x712)+_0x4d5a3e['name']+_0x3bcb61(0x1166));!_0x4d5a3e['name']&&_0x151724[_0x3bcb61(0x6ee)](_0x3bcb61(0x1cfc)+_0xf616fa['name']+'\x20中的成员\x20'+_0x4d5a3e['id']+_0x3bcb61(0x5a1));const _0x236b02=characters[_0x3bcb61(0x1aeb)](_0x11ce18=>_0x11ce18['id']===_0x4d5a3e['id']);!_0x236b02&&_0x151724[_0x3bcb61(0x6ee)](_0x3bcb61(0x17c6)+_0xf616fa[_0x3bcb61(0x222f)]+'\x20中的成员\x20'+_0x4d5a3e[_0x3bcb61(0x222f)]+'\x20('+_0x4d5a3e['id']+_0x3bcb61(0x1341));}const _0x3f1e48=chatMessages[_0xf616fa['id']]||[],_0x223c19=_0x3f1e48['slice'](-0xa);for(const _0x153ea5 of _0x223c19){if(_0x153ea5[_0x3bcb61(0xf75)]===_0x3bcb61(0x232)){let _0x20292f=![];if(_0x153ea5[_0x3bcb61(0x210b)])_0x20292f=_0xf616fa[_0x3bcb61(0xcaa)][_0x3bcb61(0x184b)](_0x2523f2=>_0x2523f2['id']===_0x153ea5[_0x3bcb61(0x210b)]),!_0x20292f&&_0x151724[_0x3bcb61(0x6ee)](_0x3bcb61(0x1cfc)+_0xf616fa[_0x3bcb61(0x222f)]+_0x3bcb61(0x1d89)+_0x153ea5[_0x3bcb61(0x210b)]+_0x3bcb61(0x24e1));else _0x153ea5[_0x3bcb61(0x222f)]&&(_0x20292f=_0xf616fa[_0x3bcb61(0xcaa)][_0x3bcb61(0x184b)](_0x2a549b=>_0x2a549b[_0x3bcb61(0x222f)]===_0x153ea5['name']),!_0x20292f&&_0x151724[_0x3bcb61(0x6ee)](_0x3bcb61(0x1cfc)+_0xf616fa[_0x3bcb61(0x222f)]+_0x3bcb61(0xdac)+_0x153ea5[_0x3bcb61(0x222f)]+'\x20在成员列表中不存在'));}}console[_0x3bcb61(0xc0d)](_0x3bcb61(0xb5)+_0xf616fa[_0x3bcb61(0x222f)]+_0x3bcb61(0x2d8));}return console[_0x3bcb61(0xc0d)](_0x3bcb61(0x1659)),_0x151724[_0x3bcb61(0xcbf)]===0x0?console['log'](_0x3bcb61(0x904)):(console[_0x3bcb61(0xc0d)]('❌\x20发现\x20'+_0x151724[_0x3bcb61(0xcbf)]+'\x20个问题：'),_0x151724[_0x3bcb61(0x900)](_0x28a635=>console['log'](_0x28a635))),{'totalGroups':groupChats[_0x3bcb61(0xcbf)],'issues':_0x151724,'isHealthy':_0x151724[_0x3bcb61(0xcbf)]===0x0};};async function debugGroupChatData(){const _0x2c1ad4=_0x2cf6d4;try{console[_0x2c1ad4(0xc0d)](_0x2c1ad4(0x1464)),console[_0x2c1ad4(0xc0d)](_0x2c1ad4(0x1d76),groupChats),console['log'](_0x2c1ad4(0x69c),groupChats[_0x2c1ad4(0xcbf)]);const _0x1281aa=await db[_0x2c1ad4(0x14ee)]['toArray']();console[_0x2c1ad4(0xc0d)]('IndexedDB中的群聊数据:',_0x1281aa),console[_0x2c1ad4(0xc0d)](_0x2c1ad4(0x19d8),_0x1281aa['length']);const _0x165991=await db['groupChatStates'][_0x2c1ad4(0x18c6)]();console[_0x2c1ad4(0xc0d)]('群聊状态数据:',_0x165991),console[_0x2c1ad4(0xc0d)](_0x2c1ad4(0x1fb2),_0x165991['length']);for(const _0xd68d1d of groupChats){const _0x2eae11=await getAsyncChatSettings(_0xd68d1d['id']);console['log']('群聊\x20'+_0xd68d1d[_0x2c1ad4(0x222f)]+'\x20的身份设置:',{'selectedIdentityId':_0x2eae11[_0x2c1ad4(0x6a0)],'currentPersonaId':_0x2eae11[_0x2c1ad4(0x433)],'myChatNickname':_0x2eae11[_0x2c1ad4(0xb42)],'myChatAvatar':_0x2eae11[_0x2c1ad4(0x13af)]});}let _0x34a933=0x0,_0x5d3af6=0x0;groupChats[_0x2c1ad4(0xcbf)]>0x0&&(console['log'](_0x2c1ad4(0x19a5)),groupChats[_0x2c1ad4(0x900)]((_0x24be70,_0x333450)=>{const _0x4cda61=_0x2c1ad4;console[_0x4cda61(0xc0d)]('群聊\x20'+(_0x333450+0x1)+':\x20'+_0x24be70['name']+_0x4cda61(0x192)+_0x24be70['id']+')'),console[_0x4cda61(0xc0d)](_0x4cda61(0x241d),_0x24be70[_0x4cda61(0xcaa)]);_0x24be70[_0x4cda61(0xcaa)]&&Array['isArray'](_0x24be70[_0x4cda61(0xcaa)])&&(_0x5d3af6+=_0x24be70['members'][_0x4cda61(0xcbf)]);const _0x575b05=chatMessages[_0x24be70['id']]||[];console[_0x4cda61(0xc0d)](_0x4cda61(0x1a0d)+_0x575b05[_0x4cda61(0xcbf)]),_0x34a933+=_0x575b05[_0x4cda61(0xcbf)],_0x575b05[_0x4cda61(0xcbf)]>0x0&&console[_0x4cda61(0xc0d)](_0x4cda61(0x7f1),_0x575b05[_0x4cda61(0x136)](-0x3));}));console[_0x2c1ad4(0xc0d)]('⚠️\x20注意：groupChatMessages和groupChatMembers表已废弃'),console[_0x2c1ad4(0xc0d)](_0x2c1ad4(0x1de7)),console['log'](_0x2c1ad4(0x12b)),console[_0x2c1ad4(0xc0d)](_0x2c1ad4(0x1f5));const _0x267883='\x0a群聊调试结果：\x0a-\x20内存中群聊数量:\x20'+groupChats[_0x2c1ad4(0xcbf)]+_0x2c1ad4(0x1ac9)+_0x1281aa[_0x2c1ad4(0xcbf)]+'\x0a-\x20群聊消息数量:\x20'+_0x34a933+_0x2c1ad4(0x1537)+_0x5d3af6+_0x2c1ad4(0x1f5b)+(groupChats[_0x2c1ad4(0xcbf)]>0x0?_0x2c1ad4(0x1fa):_0x2c1ad4(0x2224))+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';alert(_0x267883);}catch(_0x5e5f68){console['error']('调试群聊数据失败:',_0x5e5f68),alert('调试失败:\x20'+_0x5e5f68['message']);}}function showHistorySettings(){const _0x56fe6d=_0x2cf6d4,_0x4c2158=getCurrentChatSettings(),_0x8a56ca=_0x4c2158[_0x56fe6d(0xe03)];document[_0x56fe6d(0x566)](_0x56fe6d(0x1b23))[_0x56fe6d(0xc34)]=Math[_0x56fe6d(0x21f7)](_0x8a56ca,0x64),document[_0x56fe6d(0x566)](_0x56fe6d(0x1118))[_0x56fe6d(0xc34)]=_0x8a56ca,document[_0x56fe6d(0x566)]('history-count-display')['textContent']=_0x8a56ca+'回合',document['getElementById'](_0x56fe6d(0x1b23))[_0x56fe6d(0x116e)]=function(){const _0x4fe711=_0x56fe6d,_0x4fbf87=parseInt(this[_0x4fe711(0xc34)]);document[_0x4fe711(0x566)](_0x4fe711(0x11ad))[_0x4fe711(0x21dc)]=_0x4fbf87+'回合',document[_0x4fe711(0x566)](_0x4fe711(0x1118))['value']=_0x4fbf87;},document[_0x56fe6d(0x566)]('custom-history-count')['oninput']=function(){const _0x5c971c=_0x56fe6d,_0x4e42b3=Math['max'](0x0,Math['min'](0x1f4,parseInt(this[_0x5c971c(0xc34)])||0x0));this[_0x5c971c(0xc34)]=_0x4e42b3,_0x4e42b3<=0x64&&(document['getElementById']('history-messages-count')[_0x5c971c(0xc34)]=_0x4e42b3),document['getElementById'](_0x5c971c(0x11ad))[_0x5c971c(0x21dc)]=_0x4e42b3+'回合';},showModal(_0x56fe6d(0x18fa));}function saveHistorySettings(){const _0x48ca73=_0x2cf6d4,_0x8f835d=getCurrentChatSettings(),_0x4b246d=parseInt(document[_0x48ca73(0x566)](_0x48ca73(0x1118))['value']);_0x8f835d[_0x48ca73(0xe03)]=Math[_0x48ca73(0x910)](0x0,Math[_0x48ca73(0x21f7)](0x1f4,_0x4b246d||0x0)),document[_0x48ca73(0x566)](_0x48ca73(0x6b2))['textContent']=_0x8f835d[_0x48ca73(0xe03)]+'回合',saveCurrentChatSettings(_0x8f835d),hideModal(_0x48ca73(0x18fa)),showToast(_0x48ca73(0x62b),_0x48ca73(0xb27));}function showAvatarSettings(){const _0x4170ad=_0x2cf6d4,_0x20798f=getCurrentChatSettings(),_0x56aca7=document[_0x4170ad(0x566)](_0x4170ad(0x1625));_0x56aca7&&(_0x56aca7[_0x4170ad(0x306)]=_0x20798f[_0x4170ad(0x1e22)]||![]);const _0x5cd0c8=_0x20798f['avatarShape']||'circle',_0x4fdcd5=document[_0x4170ad(0x1ed9)]('input[name=\x22avatar-shape\x22]');_0x4fdcd5[_0x4170ad(0x900)](_0x215794=>{const _0x5156af=_0x4170ad;_0x215794['checked']=_0x215794['value']===_0x5cd0c8;const _0x54fd13=_0x215794['closest']('.shape-radio-option');_0x215794[_0x5156af(0x306)]?_0x54fd13[_0x5156af(0x226e)]['add'](_0x5156af(0x876)):_0x54fd13[_0x5156af(0x226e)]['remove'](_0x5156af(0x876));}),updateAvatarPreviewShape(_0x5cd0c8);const _0x120b2c=document[_0x4170ad(0x566)](_0x4170ad(0x1045));_0x20798f[_0x4170ad(0x13af)]?(_0x120b2c['style']['backgroundImage']=_0x4170ad(0xcb5)+_0x20798f[_0x4170ad(0x13af)]+')',_0x120b2c[_0x4170ad(0x655)][_0x4170ad(0x2000)]=_0x4170ad(0xe3e),_0x120b2c[_0x4170ad(0x655)][_0x4170ad(0x18b3)]=_0x4170ad(0x23a1),_0x120b2c[_0x4170ad(0xc02)]=''):(_0x120b2c[_0x4170ad(0x655)][_0x4170ad(0x1584)]=_0x4170ad(0xfe9),_0x120b2c[_0x4170ad(0xc02)]=_0x4170ad(0x976));const _0x361b7e=document[_0x4170ad(0x566)](_0x4170ad(0x182f)),_0x585ed2=_0x20798f[_0x4170ad(0x23e0)];_0x585ed2?(_0x361b7e['style'][_0x4170ad(0x1584)]=_0x4170ad(0xcb5)+_0x585ed2+')',_0x361b7e[_0x4170ad(0x655)][_0x4170ad(0x2000)]='cover',_0x361b7e['style'][_0x4170ad(0x18b3)]=_0x4170ad(0x23a1),_0x361b7e[_0x4170ad(0xc02)]='',_0x361b7e['title']=_0x4170ad(0x1ecf)):(_0x361b7e['style'][_0x4170ad(0x1584)]=_0x4170ad(0xfe9),_0x361b7e['innerHTML']=_0x4170ad(0xf6),_0x361b7e[_0x4170ad(0x1c18)]=_0x4170ad(0xc6d)),bindAvatarUploadEvents(),bindAvatarShapeEvents(),showModal('avatar-settings-modal');}function updateAvatarPreviewShape(_0x46c0cf){const _0x100934=_0x2cf6d4,_0x745840=document[_0x100934(0x566)]('my-chat-avatar-preview'),_0x54b2a2=document[_0x100934(0x566)](_0x100934(0x182f));_0x745840[_0x100934(0x226e)]['remove'](_0x100934(0x1fdd)),_0x54b2a2[_0x100934(0x226e)][_0x100934(0x128)](_0x100934(0x1fdd)),_0x46c0cf===_0x100934(0x1fdd)&&(_0x745840[_0x100934(0x226e)][_0x100934(0xe1)](_0x100934(0x1fdd)),_0x54b2a2[_0x100934(0x226e)]['add'](_0x100934(0x1fdd)));}function bindAvatarShapeEvents(){const _0x38684b=_0x2cf6d4,_0x1c039e=document['querySelectorAll'](_0x38684b(0x616));_0x1c039e['forEach'](_0x3e1889=>{const _0x4d735b=_0x38684b,_0xdcc2db=_0x3e1889['closest'](_0x4d735b(0x16fc));if(!_0xdcc2db){console[_0x4d735b(0x17cc)](_0x4d735b(0x55e),_0x3e1889);return;}_0xdcc2db[_0x4d735b(0x167)](_0x4d735b(0x1e62),function(){const _0x46bfb=_0x4d735b;_0x1c039e['forEach'](_0x2d8c8b=>{const _0x48bee3=_0x3a81;_0x2d8c8b[_0x48bee3(0x306)]=![],_0x2d8c8b['closest'](_0x48bee3(0x16fc))[_0x48bee3(0x226e)][_0x48bee3(0x128)](_0x48bee3(0x876));}),_0x3e1889[_0x46bfb(0x306)]=!![],this[_0x46bfb(0x226e)][_0x46bfb(0xe1)](_0x46bfb(0x876)),updateAvatarPreviewShape(_0x3e1889[_0x46bfb(0xc34)]);}),_0x3e1889[_0x4d735b(0x167)](_0x4d735b(0x17ef),function(){const _0x1653a3=_0x4d735b;this[_0x1653a3(0x306)]&&(_0x1c039e['forEach'](_0xafd56f=>{const _0x9fc9f6=_0x1653a3;_0xafd56f!==this&&_0xafd56f[_0x9fc9f6(0x2026)](_0x9fc9f6(0x16fc))[_0x9fc9f6(0x226e)][_0x9fc9f6(0x128)](_0x9fc9f6(0x876));}),_0xdcc2db[_0x1653a3(0x226e)]['add'](_0x1653a3(0x876)),updateAvatarPreviewShape(this['value']));});});}function generateAvatarHtml(_0x35af73){const _0x470209=_0x2cf6d4,{avatarUrl:_0x12a84d,backgroundColor:_0x2b5bd5,displayName:_0x2a2954,onClick:_0x5d9c3f,title:_0x495559,timestamp:_0x506a1b,timestampEnabled:_0x818293,timestampPosition:_0x54a7f5,chatSettings:_0x2860c8}=_0x35af73,_0x28310c=_0x2860c8?.['avatarShape']||_0x470209(0x1887),_0x802231=_0x28310c===_0x470209(0x1fdd)?_0x470209(0x1191):'',_0x29b6d4=_0x12a84d?_0x470209(0x1910)+_0x12a84d+_0x470209(0x1051):_0x470209(0x154)+_0x2b5bd5+';',_0x3f262e=_0x5d9c3f?_0x470209(0x162)+_0x5d9c3f+'\x22':'',_0xd8bdcc=_0x495559?_0x470209(0x14cf)+_0x495559+'\x22':'',_0x247f99=_0x818293&&_0x54a7f5===_0x470209(0x107f)&&_0x506a1b?'<div\x20class=\x22timestamp\x20timestamp-avatar\x22>'+formatTimeOnly(_0x506a1b)+'</div>':'',_0x5e3be=_0x12a84d?'':_0x2a2954?_0x2a2954[_0x470209(0x1518)](0x0):_0x470209(0x976);return _0x470209(0x1a62)+_0x802231+_0x470209(0xd2c)+_0x29b6d4+'\x22\x20'+_0x3f262e+'\x20'+_0xd8bdcc+'>'+_0x5e3be+_0x247f99+_0x470209(0xa54);}function showNicknameSettings(){const _0x2ae48d=_0x2cf6d4,_0x13ff41=getCurrentChatSettings();document['getElementById'](_0x2ae48d(0x19df))['value']=_0x13ff41[_0x2ae48d(0xb42)]||'',document[_0x2ae48d(0x566)](_0x2ae48d(0x9bf))[_0x2ae48d(0xc34)]=_0x13ff41[_0x2ae48d(0x1967)]||'',showModal(_0x2ae48d(0x1b73));}function showPokeSuffixSettings(){const _0x306f57=_0x2cf6d4,_0x3308ea=getCurrentChatSettings();document[_0x306f57(0x566)](_0x306f57(0xb3c))[_0x306f57(0xc34)]=_0x3308ea['myPokeSuffix']||'',document[_0x306f57(0x566)](_0x306f57(0x16aa))[_0x306f57(0xc34)]=_0x3308ea['aiPokeSuffix']||'',showModal(_0x306f57(0x1fc));}function showBackgroundSettings(){const _0x353816=_0x2cf6d4,_0x300ad4=document['getElementById'](_0x353816(0x2273));window[_0x353816(0x16f0)]=undefined,currentChatCharacter&&currentChatCharacter[_0x353816(0xc3c)]?(_0x300ad4[_0x353816(0x655)][_0x353816(0x1584)]=_0x353816(0xcb5)+currentChatCharacter[_0x353816(0xc3c)]+')',_0x300ad4[_0x353816(0x655)][_0x353816(0x2000)]=_0x353816(0xe3e),_0x300ad4[_0x353816(0x655)]['backgroundPosition']=_0x353816(0x23a1),_0x300ad4['querySelector'](_0x353816(0x757))[_0x353816(0x655)]['display']='none'):(_0x300ad4[_0x353816(0x655)][_0x353816(0x1584)]='none',_0x300ad4[_0x353816(0x15b8)](_0x353816(0x757))[_0x353816(0x655)][_0x353816(0x2526)]=_0x353816(0x2d4),_0x300ad4[_0x353816(0x15b8)](_0x353816(0x757))[_0x353816(0x21dc)]=_0x353816(0x56d)),document[_0x353816(0x566)]('background-upload')[_0x353816(0x1889)]=function(_0x28ccf3){const _0x1102b1=_0x353816;if(_0x28ccf3[_0x1102b1(0x1144)][_0x1102b1(0x173e)]&&_0x28ccf3[_0x1102b1(0x1144)][_0x1102b1(0x173e)][0x0]){const _0x5084cf=new FileReader();_0x5084cf[_0x1102b1(0xc28)]=function(_0x457c93){const _0x358a5a=_0x1102b1;_0x300ad4[_0x358a5a(0x655)][_0x358a5a(0x1584)]=_0x358a5a(0xcb5)+_0x457c93[_0x358a5a(0x1144)][_0x358a5a(0x1fff)]+')',_0x300ad4[_0x358a5a(0x655)]['backgroundSize']='cover',_0x300ad4[_0x358a5a(0x655)][_0x358a5a(0x18b3)]=_0x358a5a(0x23a1),_0x300ad4[_0x358a5a(0x15b8)]('.preview-text')[_0x358a5a(0x655)][_0x358a5a(0x2526)]='none',window[_0x358a5a(0x16f0)]=_0x457c93[_0x358a5a(0x1144)][_0x358a5a(0x1fff)];},_0x5084cf[_0x1102b1(0x145e)](_0x28ccf3['target'][_0x1102b1(0x173e)][0x0]);}},showModal('background-settings-modal');}function showBubbleStyleSettings(){const _0xdd4aa1=_0x2cf6d4,_0x57f1aa=getCurrentChatSettings(),_0xc2b84=document[_0xdd4aa1(0x566)](_0xdd4aa1(0x207));currentChatCharacter&&currentChatCharacter['isGroup']?_0xc2b84[_0xdd4aa1(0x655)]['display']='block':_0xc2b84['style'][_0xdd4aa1(0x2526)]=_0xdd4aa1(0xfe9);const _0x328f7e=_0x57f1aa[_0xdd4aa1(0xa7e)]||_0xdd4aa1(0xbf);document[_0xdd4aa1(0x566)](_0xdd4aa1(0x1d50))[_0xdd4aa1(0xc34)]=_0x57f1aa['myBubbleColor']||_0xdd4aa1(0x1f03),document['getElementById'](_0xdd4aa1(0x1cb1))[_0xdd4aa1(0xc34)]=_0x57f1aa['aiBubbleColor']||_0xdd4aa1(0x1679),document[_0xdd4aa1(0x566)](_0xdd4aa1(0x19bc))[_0xdd4aa1(0xc34)]=_0x57f1aa[_0xdd4aa1(0x24c3)]||'1',document['getElementById'](_0xdd4aa1(0xa36))[_0xdd4aa1(0x21dc)]=Math[_0xdd4aa1(0x5f3)]((_0x57f1aa['myBubbleOpacity']||0x1)*0x64)+'%',document['getElementById'](_0xdd4aa1(0xbc2))[_0xdd4aa1(0xc34)]=_0x57f1aa[_0xdd4aa1(0xaf0)]||'1',document[_0xdd4aa1(0x566)](_0xdd4aa1(0x220c))[_0xdd4aa1(0x21dc)]=Math[_0xdd4aa1(0x5f3)]((_0x57f1aa[_0xdd4aa1(0xaf0)]||0x1)*0x64)+'%',document['querySelectorAll'](_0xdd4aa1(0x206a))['forEach'](_0x4399da=>{const _0x22732f=_0xdd4aa1;_0x4399da['classList'][_0x22732f(0x128)](_0x22732f(0x876)),_0x4399da[_0x22732f(0x1f26)]['style']===_0x328f7e&&_0x4399da[_0x22732f(0x226e)][_0x22732f(0xe1)](_0x22732f(0x876));}),document[_0xdd4aa1(0x1ed9)](_0xdd4aa1(0x206a))[_0xdd4aa1(0x900)](_0xb9772a=>{const _0x31cbd4=_0xdd4aa1;_0xb9772a[_0x31cbd4(0x11cf)]=function(){const _0x548f66=_0x31cbd4;document[_0x548f66(0x1ed9)](_0x548f66(0x206a))[_0x548f66(0x900)](_0x1e206a=>{const _0x538bfd=_0x548f66;_0x1e206a['classList'][_0x538bfd(0x128)](_0x538bfd(0x876));}),this['classList']['add'](_0x548f66(0x876)),window[_0x548f66(0x1c5)]=this[_0x548f66(0x1f26)][_0x548f66(0x655)],updatePreview();};}),document[_0xdd4aa1(0x566)](_0xdd4aa1(0x19bc))[_0xdd4aa1(0x116e)]=function(){const _0x11f3af=_0xdd4aa1;document[_0x11f3af(0x566)](_0x11f3af(0xa36))[_0x11f3af(0x21dc)]=Math[_0x11f3af(0x5f3)](this['value']*0x64)+'%',updatePreview();},document[_0xdd4aa1(0x566)](_0xdd4aa1(0xbc2))[_0xdd4aa1(0x116e)]=function(){const _0x44b3ed=_0xdd4aa1;document[_0x44b3ed(0x566)]('ai-bubble-opacity-value')[_0x44b3ed(0x21dc)]=Math['round'](this[_0x44b3ed(0xc34)]*0x64)+'%',updatePreview();},document[_0xdd4aa1(0x566)](_0xdd4aa1(0x1d50))[_0xdd4aa1(0x116e)]=updatePreview,document[_0xdd4aa1(0x566)](_0xdd4aa1(0x1cb1))[_0xdd4aa1(0x116e)]=updatePreview,document['getElementById'](_0xdd4aa1(0x1d6c))[_0xdd4aa1(0xc34)]=_0x57f1aa[_0xdd4aa1(0x1068)]||'12',updatePaddingValue(_0x57f1aa[_0xdd4aa1(0x1068)]||'12'),document['getElementById'](_0xdd4aa1(0x1d6c))[_0xdd4aa1(0x116e)]=function(){updatePaddingValue(this['value']),updatePreview();};const _0x28e981=document[_0xdd4aa1(0x566)]('custom-bubble-css');_0x28e981&&(_0x28e981[_0xdd4aa1(0xc34)]=_0x57f1aa[_0xdd4aa1(0x1e5e)]||''),window[_0xdd4aa1(0x1c5)]=_0x328f7e,showModal(_0xdd4aa1(0x1103)),setTimeout(updatePreview,0x64);}function showScheduleSettings(){const _0x26f778=_0x2cf6d4,_0x1d2bda=getCurrentChatSettings();document['getElementById']('schedule-enabled')[_0x26f778(0x306)]=_0x1d2bda[_0x26f778(0x21d8)]||![],document[_0x26f778(0x566)]('schedule-enabled')[_0x26f778(0x1889)]=function(){const _0x26d8df=_0x26f778;document['getElementById']('schedule-times-group')[_0x26d8df(0x655)][_0x26d8df(0x2526)]=this['checked']?_0x26d8df(0x2d4):'none';},document['getElementById'](_0x26f778(0x204))[_0x26f778(0x655)]['display']=document[_0x26f778(0x566)](_0x26f778(0x5e4))[_0x26f778(0x306)]?_0x26f778(0x2d4):_0x26f778(0xfe9),renderScheduleTimes(),showModal(_0x26f778(0xe62));}async function getAsyncChatSettings(_0x444860=null){const _0x2ea4c9=_0x2cf6d4,_0x306694=_0x444860||(currentChatCharacter?currentChatCharacter['id']:null);if(!_0x306694)return console[_0x2ea4c9(0x17cc)](_0x2ea4c9(0x1e37)),{'historyCount':0x1e,'timestampEnabled':!![],'timestampPosition':'center','bubbleStyle':_0x2ea4c9(0xbf),'characterStatusEnabled':![],'selectedIdentityId':_0x2ea4c9(0xbf),'myChatNickname':'','myChatAvatar':''};const _0x5dc2cb=_0x444860!==null&&_0x444860!==undefined,_0x4b9386=_0x306694+'_'+(windowId||_0x2ea4c9(0xbf));if(!_0x5dc2cb&&chatSettings[_0x4b9386])return console['log'](_0x2ea4c9(0x912)+_0x306694+'\x20(窗口'+windowId+_0x2ea4c9(0x11cb)),chatSettings[_0x4b9386];if(!_0x5dc2cb&&!chatSettings[_0x4b9386]&&chatSettings[_0x306694])return console['log'](_0x2ea4c9(0x912)+_0x306694+_0x2ea4c9(0x1229)),chatSettings[_0x4b9386]=JSON['parse'](JSON[_0x2ea4c9(0x7fb)](chatSettings[_0x306694])),chatSettings[_0x4b9386];try{let _0x178a88=null;windowId&&(_0x178a88=await db[_0x2ea4c9(0x243d)][_0x2ea4c9(0x4a6)]('[chatId+windowId]')[_0x2ea4c9(0x14a)]([_0x306694,windowId])[_0x2ea4c9(0x2200)]());!_0x178a88&&(_0x178a88=await db['chatSettings'][_0x2ea4c9(0x46a)](_0x306694));if(_0x178a88&&_0x178a88[_0x2ea4c9(0x1fbb)]){const _0x50b070=_0x5dc2cb?_0x2ea4c9(0x78e):'首次加载';return console[_0x2ea4c9(0xc0d)]('✅\x20从数据库'+_0x50b070+_0x2ea4c9(0x13a3)+_0x306694+'\x20(窗口'+windowId+')的设置'),chatSettings[_0x4b9386]=_0x178a88[_0x2ea4c9(0x1fbb)],!chatSettings[_0x306694]&&(chatSettings[_0x306694]=JSON[_0x2ea4c9(0x168e)](JSON[_0x2ea4c9(0x7fb)](_0x178a88[_0x2ea4c9(0x1fbb)]))),_0x178a88['settings'];}}catch(_0x1002f5){console[_0x2ea4c9(0x24ab)](_0x2ea4c9(0xa3a)+_0x306694+_0x2ea4c9(0xd9)+windowId+_0x2ea4c9(0x137d),_0x1002f5);}console[_0x2ea4c9(0xc0d)](_0x2ea4c9(0x1de9)+_0x306694+_0x2ea4c9(0x145));const _0x4e605a={'historyCount':0x1e,'crossChatMemory':0x3,'enableDynamicMemory':!![],'enableMusicMemory':!![],'memoryMountEnabled':![],'memoryMountCount':0x3,'selectedMemoryChats':[],'timeAwarenessEnabled':!![],'aiCallEnabled':!![],'aiHeartrateEnabled':![],'heartratePosition':'center','socialEnabled':![],'socialFrequency':_0x2ea4c9(0x1e86),'backgroundInteractionEnabled':![],'backgroundChatEnabled':!![],'backgroundMomentsEnabled':!![],'backgroundChatFrequency':_0x2ea4c9(0x222d),'backgroundMomentsFrequency':_0x2ea4c9(0x222d),'scheduledMomentsEnabled':![],'scheduledMomentsTimes':[],'worldbookMountEnabled':![],'selectedWorldbooks':[],'linkedWorldBookIds':[],'timestampEnabled':!![],'timestampPosition':_0x2ea4c9(0x23a1),'characterStatusEnabled':![],'statusUpdateFrequency':_0x2ea4c9(0x1e86),'aiChatAvatar':'','userChatAvatar':''};chatSettings[_0x4b9386]=_0x4e605a;!chatSettings[_0x306694]&&(chatSettings[_0x306694]=JSON[_0x2ea4c9(0x168e)](JSON[_0x2ea4c9(0x7fb)](_0x4e605a)));try{if(windowId){const _0xedecf=await db[_0x2ea4c9(0x243d)][_0x2ea4c9(0x4a6)](_0x2ea4c9(0x1e9))[_0x2ea4c9(0x14a)]([_0x306694,windowId])[_0x2ea4c9(0x2200)]();!_0xedecf&&(await db[_0x2ea4c9(0x243d)][_0x2ea4c9(0xe1)]({'chatId':_0x306694,'windowId':windowId,'settings':_0x4e605a,'timestamp':Date[_0x2ea4c9(0x18e0)]()}),console['log'](_0x2ea4c9(0x2425)+_0x306694+_0x2ea4c9(0xd9)+windowId+_0x2ea4c9(0x714)));}await db['chatSettings'][_0x2ea4c9(0x53a)]({'id':_0x306694,'chatId':_0x306694,'settings':_0x4e605a}),console[_0x2ea4c9(0xc0d)](_0x2ea4c9(0x2425)+_0x306694+_0x2ea4c9(0x13c1));}catch(_0x39bab2){console[_0x2ea4c9(0x24ab)](_0x2ea4c9(0x1b64)+_0x306694+'\x20(窗口'+windowId+')保存默认设置失败:',_0x39bab2);}return _0x4e605a;}function getCurrentChatSettings(){const _0x2946c4=_0x2cf6d4;if(!currentChatCharacter)return{};const _0x42c029=currentChatCharacter['id'],_0x351abb=_0x42c029+'_'+(windowId||_0x2946c4(0xbf));if(chatSettings[_0x351abb])return JSON['parse'](JSON[_0x2946c4(0x7fb)](chatSettings[_0x351abb]));if(chatSettings[_0x42c029])return chatSettings[_0x351abb]=JSON[_0x2946c4(0x168e)](JSON[_0x2946c4(0x7fb)](chatSettings[_0x42c029])),chatSettings[_0x351abb];console[_0x2946c4(0x17cc)](_0x2946c4(0x1d33)+_0x42c029+_0x2946c4(0xd9)+windowId+')的设置时内存中没有缓存，正在异步加载...');const _0x1aa286={'historyCount':0x1e,'crossChatMemory':0x3,'enableDynamicMemory':!![],'enableMusicMemory':!![],'memoryMountEnabled':![],'memoryMountCount':0x3,'selectedMemoryChats':[],'timeAwarenessEnabled':!![],'aiCallEnabled':!![],'aiHeartrateEnabled':![],'heartratePosition':_0x2946c4(0x23a1),'characterStatusEnabled':![],'socialEnabled':![],'socialFrequency':_0x2946c4(0x1e86),'backgroundInteractionEnabled':![],'backgroundChatEnabled':!![],'backgroundMomentsEnabled':!![],'backgroundChatFrequency':_0x2946c4(0x222d),'backgroundMomentsFrequency':_0x2946c4(0x222d),'scheduledMomentsEnabled':![],'scheduledMomentsTimes':[],'timestampEnabled':!![],'timestampPosition':_0x2946c4(0x23a1),'worldbookMountEnabled':![],'selectedWorldbooks':[],'linkedWorldBookIds':[],'statusUpdateFrequency':'medium','aiChatAvatar':'','userChatAvatar':'','selectedIdentityId':_0x2946c4(0xbf),'myChatNickname':'','myChatAvatar':''};return chatSettings[_0x351abb]=_0x1aa286,getAsyncChatSettings()[_0x2946c4(0x1ccc)](_0x51c6a1=>{const _0x89ba75=_0x2946c4;JSON[_0x89ba75(0x7fb)](_0x51c6a1)!==JSON[_0x89ba75(0x7fb)](_0x1aa286)?(chatSettings[_0x351abb]=_0x51c6a1,console[_0x89ba75(0xc0d)]('✅\x20后台异步加载ID为\x20'+_0x42c029+_0x89ba75(0x15d5))):saveCurrentChatSettings(_0x1aa286)['then'](()=>{const _0x4cefb6=_0x89ba75;console['log'](_0x4cefb6(0xf03)+_0x42c029+'\x20的聊天创建并保存了默认设置');})[_0x89ba75(0x9e5)](_0x388dd7=>{const _0x395b33=_0x89ba75;console[_0x395b33(0x24ab)](_0x395b33(0x151e),_0x388dd7);});})[_0x2946c4(0x9e5)](_0x2437ee=>{const _0x259499=_0x2946c4;console['error'](_0x259499(0xc29)+_0x42c029+_0x259499(0x1239),_0x2437ee),saveCurrentChatSettings(_0x1aa286)[_0x259499(0x9e5)](_0x5921b7=>{const _0x4058e3=_0x259499;console[_0x4058e3(0x24ab)](_0x4058e3(0x8b2),_0x5921b7);});}),_0x1aa286;}async function saveCurrentChatSettings(_0x4b90b4){const _0x4130f8=_0x2cf6d4;if(!currentChatCharacter){console[_0x4130f8(0x17cc)](_0x4130f8(0xe61));return;}const _0x3c9a23=currentChatCharacter['id'],_0x53271e=_0x3c9a23+'_'+(windowId||_0x4130f8(0xbf)),_0x574260={'historyCount':0x1e,'crossChatMemory':0x3,'enableDynamicMemory':!![],'enableMusicMemory':!![],'memoryMountEnabled':![],'memoryMountCount':0x3,'selectedMemoryChats':[],'timeAwarenessEnabled':!![],'aiCallEnabled':!![],'aiHeartrateEnabled':![],'heartratePosition':_0x4130f8(0x23a1),'characterStatusEnabled':![],'socialEnabled':![],'socialFrequency':'medium','backgroundInteractionEnabled':![],'backgroundChatEnabled':!![],'backgroundMomentsEnabled':!![],'backgroundChatFrequency':'low','backgroundMomentsFrequency':_0x4130f8(0x222d),'scheduledMomentsEnabled':![],'scheduledMomentsTimes':[],'timestampEnabled':!![],'timestampPosition':'center','worldbookMountEnabled':![],'selectedWorldbooks':[],'linkedWorldBookIds':[],'statusUpdateFrequency':_0x4130f8(0x1e86),'aiChatAvatar':'','userChatAvatar':'',..._0x4b90b4};chatSettings[_0x53271e]=_0x574260,chatSettings[_0x3c9a23]=JSON[_0x4130f8(0x168e)](JSON[_0x4130f8(0x7fb)](_0x574260));try{if(!_0x574260||typeof _0x574260!==_0x4130f8(0x3c4))throw new Error(_0x4130f8(0x23f6));await db[_0x4130f8(0x174a)]('rw',[db[_0x4130f8(0xb08)],db[_0x4130f8(0x243d)]],async()=>{const _0x427192=_0x4130f8;if(windowId){const _0x3f1672=await db['windowChatSettings']['where'](_0x427192(0x1e9))['equals']([_0x3c9a23,windowId])[_0x427192(0x2200)]();_0x3f1672?await db[_0x427192(0x243d)][_0x427192(0x2180)](_0x3f1672['id'],{'settings':_0x574260,'timestamp':Date[_0x427192(0x18e0)]()}):await db[_0x427192(0x243d)][_0x427192(0xe1)]({'chatId':_0x3c9a23,'windowId':windowId,'settings':_0x574260,'timestamp':Date[_0x427192(0x18e0)]()});}await db[_0x427192(0xb08)][_0x427192(0x53a)]({'id':_0x3c9a23,'chatId':_0x3c9a23,'settings':_0x574260});});const _0x2ec0fe=windowId?await db[_0x4130f8(0x243d)][_0x4130f8(0x4a6)]('[chatId+windowId]')[_0x4130f8(0x14a)]([_0x3c9a23,windowId])[_0x4130f8(0x2200)]():await db[_0x4130f8(0xb08)][_0x4130f8(0x46a)](_0x3c9a23);if(!_0x2ec0fe||!_0x2ec0fe['settings'])throw new Error(_0x4130f8(0x6d6));_0x574260[_0x4130f8(0x9af)]!==undefined||_0x574260[_0x4130f8(0xefa)]!==undefined||_0x574260['selectedIdentityId']!==undefined?console[_0x4130f8(0xc0d)](_0x4130f8(0x23b5)):scheduleAutoSave(_0x3c9a23);}catch(_0xc7627b){console['error'](_0x4130f8(0x1f54),_0xc7627b);try{console[_0x4130f8(0x17cc)](_0x4130f8(0x166c));const _0x195387={'selectedIdentityId':_0x4b90b4['selectedIdentityId'],'aiChatNickname':_0x4b90b4[_0x4130f8(0x1967)],'myChatNickname':_0x4b90b4[_0x4130f8(0xb42)],'hideAvatars':_0x4b90b4['hideAvatars'],'bubbleStyle':_0x4b90b4[_0x4130f8(0xa7e)],'timestampEnabled':_0x4b90b4['timestampEnabled'],'timestampPosition':_0x4b90b4[_0x4130f8(0x19ec)]},_0x989e64=windowId?_0x4130f8(0x20f4)+_0x3c9a23+'_'+windowId:_0x4130f8(0x20f4)+_0x3c9a23;localStorage[_0x4130f8(0x2055)](_0x989e64,JSON[_0x4130f8(0x7fb)](_0x195387)),console[_0x4130f8(0xc0d)](_0x4130f8(0x223b)),showToast(_0x4130f8(0x114e),_0x4130f8(0x13bb));}catch(_0x206944){console[_0x4130f8(0x24ab)](_0x4130f8(0xa85),_0x206944),showToast('❌\x20设置保存失败！请检查存储空间',_0x4130f8(0x24ab));}}if(currentChatCharacter&&currentChatCharacter['isGroup'])try{await GroupChatStateManager[_0x4130f8(0x387)](currentChatCharacter['id']);}catch(_0xdcf2a6){console[_0x4130f8(0x17cc)](_0x4130f8(0x94e),_0xdcf2a6);}}async function showMemoryMountSettings(){const _0x30f0a8=_0x2cf6d4,_0x3fd6d6=await getAsyncChatSettings();document[_0x30f0a8(0x566)](_0x30f0a8(0xed0))[_0x30f0a8(0x306)]=_0x3fd6d6['memoryMountEnabled']||![],document[_0x30f0a8(0x566)]('memory-mount-count')['value']=_0x3fd6d6[_0x30f0a8(0x7fa)]||0x3,document[_0x30f0a8(0x566)](_0x30f0a8(0xc5c))[_0x30f0a8(0x21dc)]=(_0x3fd6d6[_0x30f0a8(0x7fa)]||0x3)+'条',toggleMemoryMountDetails(),document[_0x30f0a8(0x566)](_0x30f0a8(0xed0))[_0x30f0a8(0x1889)]=toggleMemoryMountDetails,document['getElementById'](_0x30f0a8(0x219b))['oninput']=function(){const _0x1c18d3=_0x30f0a8;document[_0x1c18d3(0x566)]('memory-mount-display')[_0x1c18d3(0x21dc)]=this[_0x1c18d3(0xc34)]+'条';},renderMemoryMountChatList(),showModal(_0x30f0a8(0x1418));}function toggleMemoryMountDetails(){const _0x2c63fe=_0x2cf6d4,_0x52bb69=document['getElementById']('memory-mount-enabled')[_0x2c63fe(0x306)];document[_0x2c63fe(0x566)](_0x2c63fe(0x127d))[_0x2c63fe(0x655)][_0x2c63fe(0x2526)]=_0x52bb69?_0x2c63fe(0x2d4):_0x2c63fe(0xfe9),document[_0x2c63fe(0x566)]('memory-mount-chats')[_0x2c63fe(0x655)][_0x2c63fe(0x2526)]=_0x52bb69?'block':_0x2c63fe(0xfe9),document[_0x2c63fe(0x566)]('current-memory-mount')['textContent']=_0x52bb69?_0x2c63fe(0xc5d):_0x2c63fe(0x24b4);}async function renderMemoryMountChatList(){const _0x188d70=_0x2cf6d4,_0x19dca1=document['getElementById'](_0x188d70(0x1bf4));_0x19dca1[_0x188d70(0xc02)]='';if(characters[_0x188d70(0xcbf)]===0x0&&groupChats[_0x188d70(0xcbf)]===0x0){_0x19dca1[_0x188d70(0xc02)]=_0x188d70(0x438);return;}characters[_0x188d70(0x900)](_0x3a52e6=>{const _0x3ceb59=_0x188d70;if(currentChatCharacter&&_0x3a52e6['id']===currentChatCharacter['id'])return;const _0x4edb9f=document[_0x3ceb59(0x1ad8)](_0x3ceb59(0x526));_0x4edb9f[_0x3ceb59(0x221)]=_0x3ceb59(0x1f3c),_0x4edb9f['innerHTML']=_0x3ceb59(0x5ed)+_0x3a52e6['id']+_0x3ceb59(0x8c3)+_0x3a52e6['id']+_0x3ceb59(0x2431)+_0x3a52e6['color']+';\x20'+(_0x3a52e6[_0x3ceb59(0x10f9)]?'background-image:\x20url('+_0x3a52e6[_0x3ceb59(0x10f9)]+');\x20background-size:\x20cover;\x20background-position:\x20center;':'')+_0x3ceb59(0xa2e)+(_0x3a52e6[_0x3ceb59(0x10f9)]?'':_0x3a52e6['name'][_0x3ceb59(0x1518)](0x0))+_0x3ceb59(0x462)+_0x3a52e6[_0x3ceb59(0x222f)]+_0x3ceb59(0x129e),_0x19dca1[_0x3ceb59(0x1925)](_0x4edb9f);}),groupChats[_0x188d70(0x900)](_0x515005=>{const _0x886b62=_0x188d70;if(currentChatCharacter&&_0x515005['id']===currentChatCharacter['id'])return;const _0x4d4907=document[_0x886b62(0x1ad8)]('div');_0x4d4907['className']=_0x886b62(0x1f3c),_0x4d4907[_0x886b62(0xc02)]=_0x886b62(0x5ed)+_0x515005['id']+_0x886b62(0x8c3)+_0x515005['id']+_0x886b62(0x158c)+_0x515005['name']+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mount-type\x22>群聊\x20('+(_0x515005['members']?_0x515005[_0x886b62(0xcaa)][_0x886b62(0xcbf)]+0x1:0x1)+'人)</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x19dca1[_0x886b62(0x1925)](_0x4d4907);});const _0x1df2e8=await getAsyncChatSettings(),_0x2e2e64=_0x1df2e8[_0x188d70(0x62e)]||[];_0x2e2e64[_0x188d70(0x900)](_0x4e7395=>{const _0x431c44=_0x188d70,_0xa9bde8=document[_0x431c44(0x566)](_0x431c44(0x1b53)+_0x4e7395);if(_0xa9bde8)_0xa9bde8[_0x431c44(0x306)]=!![];});}async function saveMemoryMountSettings(){const _0x353236=_0x2cf6d4,_0x43cdbb=await getAsyncChatSettings();_0x43cdbb['memoryMountEnabled']=document[_0x353236(0x566)](_0x353236(0xed0))[_0x353236(0x306)],_0x43cdbb[_0x353236(0x7fa)]=parseInt(document[_0x353236(0x566)](_0x353236(0x219b))[_0x353236(0xc34)]);const _0x34031a=document['querySelectorAll'](_0x353236(0x1ac8));_0x43cdbb[_0x353236(0x62e)]=Array['from'](_0x34031a)[_0x353236(0xf6d)](_0x163bf2=>_0x163bf2[_0x353236(0xc34)]),document[_0x353236(0x566)](_0x353236(0x1d97))[_0x353236(0x21dc)]=_0x43cdbb[_0x353236(0xb7b)]?_0x353236(0xc5d):_0x353236(0x24b4),await saveCurrentChatSettings(_0x43cdbb),hideModal(_0x353236(0x1418)),showToast('记忆挂载设置已保存',_0x353236(0xb27));}function updatePreview(){const _0x29c50b=_0x2cf6d4,_0x518e31=document[_0x29c50b(0x566)](_0x29c50b(0x1a74)),_0x284440=document[_0x29c50b(0x566)]('preview-user'),_0x76a171=document[_0x29c50b(0x566)](_0x29c50b(0x1c6a));if(!_0x518e31||!_0x284440||!_0x76a171)return;const _0x32378a=document[_0x29c50b(0x566)]('my-bubble-color')?.[_0x29c50b(0xc34)]||_0x29c50b(0x1f03),_0x534e3f=document[_0x29c50b(0x566)](_0x29c50b(0x1cb1))?.[_0x29c50b(0xc34)]||_0x29c50b(0x1679),_0x3cd6f9=document['getElementById']('my-bubble-opacity')?.[_0x29c50b(0xc34)]||'1',_0x4e52d1=document[_0x29c50b(0x566)](_0x29c50b(0xbc2))?.[_0x29c50b(0xc34)]||'1',_0x2b8ed6=document[_0x29c50b(0x566)]('bubble-padding')?.[_0x29c50b(0xc34)]||'12',_0x589ecd=document[_0x29c50b(0x566)]('custom-bubble-css')?.[_0x29c50b(0xc34)]||'';_0x284440[_0x29c50b(0x655)][_0x29c50b(0xacd)]=_0x32378a,_0x284440['style'][_0x29c50b(0x671)]=_0x3cd6f9,_0x284440[_0x29c50b(0x655)]['padding']=_0x2b8ed6+'px',_0x518e31[_0x29c50b(0x655)][_0x29c50b(0xacd)]=_0x534e3f,_0x518e31[_0x29c50b(0x655)][_0x29c50b(0x671)]=_0x4e52d1,_0x518e31[_0x29c50b(0x655)][_0x29c50b(0x856)]=_0x2b8ed6+'px',_0x76a171[_0x29c50b(0x221)]=_0x29c50b(0x11d9),window[_0x29c50b(0x1c5)]&&_0x76a171[_0x29c50b(0x226e)][_0x29c50b(0xe1)](_0x29c50b(0x19e8)+window[_0x29c50b(0x1c5)]),applyPreviewCSS(_0x589ecd);}function applyPreviewCSS(_0x2ea105){const _0x5eb8a0=_0x2cf6d4,_0x16396f=document['getElementById'](_0x5eb8a0(0x5c3));if(_0x16396f)_0x16396f[_0x5eb8a0(0x128)]();if(!_0x2ea105['trim']())return;const _0x2a193e=document[_0x5eb8a0(0x1ad8)]('style');_0x2a193e['id']=_0x5eb8a0(0x5c3);let _0x454c78=_0x2ea105['replace'](/^/gm,_0x5eb8a0(0x22c0));_0x454c78+=_0x5eb8a0(0x1bb),_0x2a193e['textContent']=_0x454c78,document[_0x5eb8a0(0x1e4c)][_0x5eb8a0(0x1925)](_0x2a193e);}function applyCustomBubbleCSS(){const _0x5d0283=_0x2cf6d4,_0x3bd059=getCurrentChatSettings(),_0x3deefc=_0x3bd059[_0x5d0283(0x1e5e)],_0x4d8de2=document[_0x5d0283(0x566)]('custom-bubble-style');if(_0x4d8de2)_0x4d8de2[_0x5d0283(0x128)]();if(!_0x3deefc||!_0x3deefc[_0x5d0283(0x1424)]()){window[_0x5d0283(0x91e)]=![];return;}let _0xe4056f=_0x3deefc;_0xe4056f+=_0x5d0283(0x6e9);const _0x1655d9=document['createElement'](_0x5d0283(0x655));_0x1655d9['id']=_0x5d0283(0xdd4),_0x1655d9[_0x5d0283(0x21dc)]=_0xe4056f,document[_0x5d0283(0x1e4c)][_0x5d0283(0x1925)](_0x1655d9),window[_0x5d0283(0x91e)]=!![],console[_0x5d0283(0xc0d)](_0x5d0283(0x1ba1));}async function saveChatAvatarSettings(){const _0x37ba8f=_0x2cf6d4,_0x1b527b=getCurrentChatSettings(),_0x49eed9=document[_0x37ba8f(0x566)](_0x37ba8f(0x1625));_0x49eed9&&(_0x1b527b[_0x37ba8f(0x1e22)]=_0x49eed9[_0x37ba8f(0x306)]);const _0x56ab26=document[_0x37ba8f(0x1ed9)]('input[name=\x22avatar-shape\x22]');for(const _0x435b4c of _0x56ab26){if(_0x435b4c[_0x37ba8f(0x306)]){_0x1b527b[_0x37ba8f(0xb8e)]=_0x435b4c[_0x37ba8f(0xc34)];break;}}window[_0x37ba8f(0x209)]&&(_0x1b527b[_0x37ba8f(0x13af)]=await compressImage(window[_0x37ba8f(0x209)],0xc8,0.7));window[_0x37ba8f(0x1285)]&&(_0x1b527b[_0x37ba8f(0x23e0)]=await compressImage(window[_0x37ba8f(0x1285)],0xc8,0.7));try{await saveCurrentChatSettings(_0x1b527b),hideModal(_0x37ba8f(0xc4f)),currentChatCharacter&&renderChatMessages(currentChatCharacter['id']),showToast(_0x37ba8f(0x2257),_0x37ba8f(0xb27));}catch(_0x4e3e6d){console[_0x37ba8f(0x24ab)](_0x37ba8f(0xa44),_0x4e3e6d),showToast(_0x37ba8f(0x1f66),_0x37ba8f(0x24ab));}}async function saveChatNicknameSettings(){const _0x227370=_0x2cf6d4,_0x10ef64=getCurrentChatSettings();_0x10ef64['myChatNickname']=document['getElementById'](_0x227370(0x19df))[_0x227370(0xc34)][_0x227370(0x1424)](),_0x10ef64[_0x227370(0x1967)]=document[_0x227370(0x566)](_0x227370(0x9bf))[_0x227370(0xc34)][_0x227370(0x1424)](),await saveCurrentChatSettings(_0x10ef64),hideModal(_0x227370(0x1b73)),currentChatCharacter&&updateChatHeader(),currentChatCharacter&&renderChatMessages(currentChatCharacter['id']),renderMessageList(),renderContactList(),showToast(_0x227370(0x1d83),'success');}async function savePokeSuffixSettings(){const _0x297bea=_0x2cf6d4,_0x2801fc=getCurrentChatSettings();_0x2801fc[_0x297bea(0x582)]=document[_0x297bea(0x566)](_0x297bea(0xb3c))[_0x297bea(0xc34)][_0x297bea(0x1424)](),_0x2801fc[_0x297bea(0x490)]=document['getElementById'](_0x297bea(0x16aa))['value'][_0x297bea(0x1424)](),await saveCurrentChatSettings(_0x2801fc),hideModal(_0x297bea(0x1fc)),showToast(_0x297bea(0x2bb),_0x297bea(0xb27));}async function saveChatBackgroundSettings(){const _0x12ac33=_0x2cf6d4;if(!currentChatCharacter)return;let _0xcbf3af;if(window[_0x12ac33(0x16f0)]===null)_0xcbf3af=null;else window['selectedChatBackground']?_0xcbf3af=await compressImage(window[_0x12ac33(0x16f0)],0x320,0.8):_0xcbf3af=currentChatCharacter['background'];await applyChatBackground(_0xcbf3af),hideModal(_0x12ac33(0x22d9)),window[_0x12ac33(0x16f0)]=undefined,showToast(_0x12ac33(0x5d7),_0x12ac33(0xb27));}function removeBackground(){const _0x77e58b=_0x2cf6d4,_0xc13457=document['getElementById'](_0x77e58b(0x2273));_0xc13457[_0x77e58b(0x655)][_0x77e58b(0x1584)]=_0x77e58b(0xfe9),_0xc13457[_0x77e58b(0x15b8)]('.preview-text')[_0x77e58b(0x655)][_0x77e58b(0x2526)]='block',_0xc13457[_0x77e58b(0x15b8)](_0x77e58b(0x757))[_0x77e58b(0x21dc)]='已移除背景',window[_0x77e58b(0x16f0)]=null;}function updatePaddingValue(_0x52480b){const _0xef6a9b=_0x2cf6d4,_0x19c24f=document[_0xef6a9b(0x566)](_0xef6a9b(0x3ec));if(_0x19c24f){if(_0x52480b<=0x6)_0x19c24f[_0xef6a9b(0x21dc)]='超紧凑';else{if(_0x52480b<=0xa)_0x19c24f[_0xef6a9b(0x21dc)]='紧凑';else _0x52480b<=0xe?_0x19c24f['textContent']='中等':_0x19c24f[_0xef6a9b(0x21dc)]='宽松';}}}async function saveBubbleStyleSettings(){const _0xbbe3aa=_0x2cf6d4,_0x214b0b=getCurrentChatSettings();window['selectedBubbleStyle']&&(_0x214b0b['bubbleStyle']=window[_0xbbe3aa(0x1c5)]);_0x214b0b['myBubbleColor']=document[_0xbbe3aa(0x566)]('my-bubble-color')[_0xbbe3aa(0xc34)],_0x214b0b[_0xbbe3aa(0x2116)]=document['getElementById']('ai-bubble-color')[_0xbbe3aa(0xc34)],_0x214b0b[_0xbbe3aa(0x24c3)]=document[_0xbbe3aa(0x566)]('my-bubble-opacity')[_0xbbe3aa(0xc34)],_0x214b0b[_0xbbe3aa(0xaf0)]=document['getElementById'](_0xbbe3aa(0xbc2))['value'],_0x214b0b[_0xbbe3aa(0x1068)]=document[_0xbbe3aa(0x566)](_0xbbe3aa(0x1d6c))[_0xbbe3aa(0xc34)];const _0x200d91=document['getElementById'](_0xbbe3aa(0x1f72))[_0xbbe3aa(0xc34)];_0x214b0b[_0xbbe3aa(0x1e5e)]=_0x200d91,await saveCurrentChatSettings(_0x214b0b),applyBubbleStyle(),applyCustomBubbleCSS(),updateBubbleStyleDisplay(),hideModal(_0xbbe3aa(0x1103)),currentChatCharacter&&renderChatMessages(currentChatCharacter['id']),showToast(_0xbbe3aa(0x116),_0xbbe3aa(0xb27));}function showTimestampSettings(){const _0x52dec6=_0x2cf6d4,_0x39dc6d=getCurrentChatSettings(),_0x2f9688=document['getElementById'](_0x52dec6(0x131d));_0x2f9688&&(_0x2f9688[_0x52dec6(0x306)]=_0x39dc6d[_0x52dec6(0x9c1)]!==![]);const _0x74bf76=_0x39dc6d[_0x52dec6(0x19ec)]||_0x52dec6(0x23a1),_0x434b66=document[_0x52dec6(0x1ed9)](_0x52dec6(0x20e2));_0x434b66[_0x52dec6(0x900)](_0x3da59f=>{const _0x254205=_0x52dec6;_0x3da59f[_0x254205(0x306)]=_0x3da59f['value']===_0x74bf76;});if(_0x2f9688){_0x2f9688[_0x52dec6(0x1889)]=function(){const _0x37c37f=_0x52dec6,_0x17b116=document[_0x37c37f(0x566)](_0x37c37f(0x130a));_0x17b116&&(_0x17b116['style'][_0x37c37f(0x2526)]=this['checked']?_0x37c37f(0x2d4):_0x37c37f(0xfe9));};const _0x18b27c=document['getElementById'](_0x52dec6(0x130a));_0x18b27c&&(_0x18b27c[_0x52dec6(0x655)][_0x52dec6(0x2526)]=_0x2f9688[_0x52dec6(0x306)]?_0x52dec6(0x2d4):_0x52dec6(0xfe9));}showModal(_0x52dec6(0xc36));}async function saveTimestampSettings(){const _0x4a6379=_0x2cf6d4,_0x81db5=getCurrentChatSettings(),_0x18ab4f=document[_0x4a6379(0x566)]('timestamp-modal-enabled');_0x18ab4f&&(_0x81db5[_0x4a6379(0x9c1)]=_0x18ab4f[_0x4a6379(0x306)]);const _0x5e6f12=document[_0x4a6379(0x15b8)](_0x4a6379(0xbde));_0x5e6f12&&(_0x81db5[_0x4a6379(0x19ec)]=_0x5e6f12[_0x4a6379(0xc34)]),await saveCurrentChatSettings(_0x81db5),hideModal('timestamp-settings-modal'),currentChatCharacter&&renderChatMessages(currentChatCharacter['id']),showToast('时间戳设置已保存','success');}function showGroupMemberColorSettings(){const _0x494d8f=_0x2cf6d4;if(!currentChatCharacter||!currentChatCharacter[_0x494d8f(0x4b7)]){showToast('只有群聊可以设置成员气泡颜色','warning');return;}hideModal(_0x494d8f(0x1103));const _0x3a29d7=document[_0x494d8f(0x566)]('group-member-colors-list');_0x3a29d7[_0x494d8f(0xc02)]='';const _0x113273=getCurrentChatSettings(),_0x4ecd90=_0x113273[_0x494d8f(0xb52)]||{},_0x5dcec2=groupChats[_0x494d8f(0x1aeb)](_0x121867=>_0x121867['id']===currentChatCharacter['id']);console[_0x494d8f(0xc0d)]('当前群聊:',currentChatCharacter),console[_0x494d8f(0xc0d)](_0x494d8f(0x418),_0x5dcec2),console[_0x494d8f(0xc0d)](_0x494d8f(0x112),_0x5dcec2?.[_0x494d8f(0xcaa)]);if(!_0x5dcec2||!_0x5dcec2[_0x494d8f(0xcaa)]||_0x5dcec2[_0x494d8f(0xcaa)]['length']===0x0){_0x3a29d7[_0x494d8f(0xc02)]=_0x494d8f(0x1d30),showModal(_0x494d8f(0x1831));return;}_0x5dcec2[_0x494d8f(0xcaa)][_0x494d8f(0x900)](_0x44d7ee=>{const _0x236f0f=_0x494d8f,_0x138645=typeof _0x44d7ee===_0x236f0f(0xb97)?_0x44d7ee:_0x44d7ee['id'],_0x31a00b=characters[_0x236f0f(0x1aeb)](_0x2bc7d4=>_0x2bc7d4['id']===_0x138645);if(!_0x31a00b){console[_0x236f0f(0xc0d)](_0x236f0f(0x1d48),_0x138645,'所有角色:',characters[_0x236f0f(0xf6d)](_0x454b88=>({'id':_0x454b88['id'],'name':_0x454b88[_0x236f0f(0x222f)]})));return;}const _0x323013=_0x4ecd90[_0x138645]||_0x236f0f(0x1679),_0x37c5e9=document[_0x236f0f(0x1ad8)]('div');_0x37c5e9[_0x236f0f(0x221)]=_0x236f0f(0x287),_0x37c5e9[_0x236f0f(0xc02)]=_0x236f0f(0xdb4)+_0x31a00b[_0x236f0f(0x2099)]+';\x20'+(_0x31a00b['avatarUrl']?_0x236f0f(0x1910)+_0x31a00b[_0x236f0f(0x10f9)]+_0x236f0f(0x1051):'')+_0x236f0f(0x1cf)+(_0x31a00b[_0x236f0f(0x10f9)]?'':_0x31a00b['name'][_0x236f0f(0x1518)](0x0))+_0x236f0f(0x677)+_0x31a00b[_0x236f0f(0x222f)]+_0x236f0f(0x123c)+_0x31a00b['name']+_0x236f0f(0xe89)+_0x138645+_0x236f0f(0x1b0c)+_0x323013+'\x22\x20style=\x22width:\x2040px;\x20height:\x2030px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x3a29d7[_0x236f0f(0x1925)](_0x37c5e9);}),showModal(_0x494d8f(0x1831));}function saveGroupMemberColors(){const _0x200431=_0x2cf6d4;if(!currentChatCharacter||!currentChatCharacter[_0x200431(0x4b7)])return;const _0x3f73af=getCurrentChatSettings();!_0x3f73af['memberBubbleColors']&&(_0x3f73af[_0x200431(0xb52)]={});const _0x5ddfaf=groupChats[_0x200431(0x1aeb)](_0x3e42f6=>_0x3e42f6['id']===currentChatCharacter['id']);if(!_0x5ddfaf||!_0x5ddfaf['members'])return;_0x5ddfaf[_0x200431(0xcaa)]['forEach'](_0xe69abd=>{const _0x815f63=_0x200431,_0x368cb1=typeof _0xe69abd===_0x815f63(0xb97)?_0xe69abd:_0xe69abd['id'],_0x22d7c0=document[_0x815f63(0x566)]('member-color-'+_0x368cb1);_0x22d7c0&&(_0x3f73af[_0x815f63(0xb52)][_0x368cb1]=_0x22d7c0[_0x815f63(0xc34)]);}),saveCurrentChatSettings(_0x3f73af),hideModal(_0x200431(0x1831)),currentChatCharacter&&renderChatMessages(currentChatCharacter['id']),showToast(_0x200431(0xd37),_0x200431(0xb27));}function avatarUploadHandler(_0x34c87c){const _0xecbda1=_0x2cf6d4;console[_0xecbda1(0xc0d)](_0xecbda1(0xbae));if(_0x34c87c[_0xecbda1(0x1144)][_0xecbda1(0x173e)]&&_0x34c87c['target'][_0xecbda1(0x173e)][0x0]){const _0x19e326=_0x34c87c['target'][_0xecbda1(0x173e)][0x0];console['log'](_0xecbda1(0x496),_0x19e326[_0xecbda1(0x222f)],_0xecbda1(0x1112),_0x19e326['size'],_0xecbda1(0xba8),'类型:',_0x19e326[_0xecbda1(0x23df)]);if(!_0x19e326[_0xecbda1(0x23df)]['startsWith'](_0xecbda1(0x1183))){alert('请选择图片文件'),_0x34c87c[_0xecbda1(0x1144)][_0xecbda1(0xc34)]='';return;}if(_0x19e326[_0xecbda1(0x41a)]>0x5*0x400*0x400){alert(_0xecbda1(0x1c09)),_0x34c87c['target'][_0xecbda1(0xc34)]='';return;}const _0xf1139=new FileReader();_0xf1139[_0xecbda1(0xc28)]=function(_0x525dac){const _0x34bb13=_0xecbda1;try{const _0x3675d4=document[_0x34bb13(0x566)](_0x34bb13(0x524)),_0xc19fae=document[_0x34bb13(0x566)]('avatar-preview-text');console[_0x34bb13(0xc0d)]('文件读取成功，开始设置预览');if(!_0x3675d4){console[_0x34bb13(0x24ab)](_0x34bb13(0x396)),alert(_0x34bb13(0x216a));return;}_0x3675d4[_0x34bb13(0x226e)][_0x34bb13(0xe1)](_0x34bb13(0x1d41)),_0x3675d4['style'][_0x34bb13(0x16db)](_0x34bb13(0xc3c),_0x34bb13(0xcb5)+_0x525dac[_0x34bb13(0x1144)][_0x34bb13(0x1fff)]+')',_0x34bb13(0x153c)),_0x3675d4[_0x34bb13(0x655)]['setProperty']('background-size',_0x34bb13(0xe3e),_0x34bb13(0x153c)),_0x3675d4[_0x34bb13(0x655)][_0x34bb13(0x16db)](_0x34bb13(0x2dd),'center','important'),_0x3675d4[_0x34bb13(0x655)][_0x34bb13(0x16db)]('background-repeat','no-repeat',_0x34bb13(0x153c)),_0xc19fae&&(_0xc19fae[_0x34bb13(0x655)][_0x34bb13(0x2526)]=_0x34bb13(0xfe9)),window[_0x34bb13(0x151a)]=_0x525dac['target'][_0x34bb13(0x1fff)],console['log'](_0x34bb13(0x650)),console['log']('当前avatar-preview的样式:',{'background':_0x3675d4[_0x34bb13(0x655)][_0x34bb13(0xc3c)],'backgroundSize':_0x3675d4[_0x34bb13(0x655)][_0x34bb13(0x2000)],'backgroundPosition':_0x3675d4[_0x34bb13(0x655)][_0x34bb13(0x18b3)],'className':_0x3675d4[_0x34bb13(0x221)]}),console[_0x34bb13(0xc0d)]('头像预览设置成功，图片数据已存储');}catch(_0x3b5065){console[_0x34bb13(0x24ab)](_0x34bb13(0x493),_0x3b5065),alert(_0x34bb13(0x172d)+_0x3b5065[_0x34bb13(0xd7a)]);}},_0xf1139[_0xecbda1(0x1795)]=function(){const _0x2177c2=_0xecbda1;console[_0x2177c2(0x24ab)](_0x2177c2(0x140e)),alert(_0x2177c2(0x12d2)),_0x34c87c[_0x2177c2(0x1144)][_0x2177c2(0xc34)]='';},_0xf1139['readAsDataURL'](_0x19e326);}else console[_0xecbda1(0xc0d)](_0xecbda1(0x1bab));}async function loadCustomEmojis(){const _0x15f2cc=_0x2cf6d4;try{const _0x4004a9=await db[_0x15f2cc(0x20c7)]['toArray']();if(_0x4004a9[_0x15f2cc(0xcbf)]===0x0){const _0x58cbfc=localStorage[_0x15f2cc(0x2250)](_0x15f2cc(0x20c7));if(_0x58cbfc){console[_0x15f2cc(0xc0d)](_0x15f2cc(0x1234));const _0x4bf5c6=JSON[_0x15f2cc(0x168e)](_0x58cbfc),_0x1c0598=_0x4bf5c6[_0x15f2cc(0xf6d)](_0xd5141d=>({..._0xd5141d,'isPersonal':_0xd5141d[_0x15f2cc(0xd6e)]!==undefined?_0xd5141d['isPersonal']:!![]}));_0x1c0598[_0x15f2cc(0xcbf)]>0x0&&await db[_0x15f2cc(0x20c7)]['bulkAdd'](_0x1c0598),customEmojis=_0x1c0598[_0x15f2cc(0x803)](_0x2b7f05=>_0x2b7f05[_0x15f2cc(0xd6e)]!==![]),console[_0x15f2cc(0xc0d)](_0x15f2cc(0x2573),customEmojis);}else customEmojis=[];}else customEmojis=_0x4004a9['filter'](_0x121f5f=>_0x121f5f['isPersonal']!==![]),console['log'](_0x15f2cc(0x1245),customEmojis);const _0x5cf9b2=await db['recentEmojis']['orderBy'](_0x15f2cc(0xc49))['reverse']()[_0x15f2cc(0x18c6)]();if(_0x5cf9b2[_0x15f2cc(0xcbf)]===0x0){const _0x41877c=localStorage['getItem'](_0x15f2cc(0xa1f));if(_0x41877c){console[_0x15f2cc(0xc0d)](_0x15f2cc(0x294));const _0x199015=JSON[_0x15f2cc(0x168e)](_0x41877c);if(_0x199015[_0x15f2cc(0xcbf)]>0x0){const _0x53aa88=_0x199015[_0x15f2cc(0x136)](0x0,0xa),_0x180b62=_0x53aa88[_0x15f2cc(0xf6d)]((_0x133c15,_0x12686d)=>({'id':_0x12686d+0x1,'url':_0x133c15['imageData']||_0x133c15[_0x15f2cc(0x10c6)],'description':_0x133c15[_0x15f2cc(0x1c6f)]||_0x15f2cc(0x1cd2),'lastUsed':Date[_0x15f2cc(0x18e0)]()-_0x12686d*0x3e8}));await db[_0x15f2cc(0xa1f)][_0x15f2cc(0x24c8)](_0x180b62),recentEmojis=_0x53aa88,localStorage[_0x15f2cc(0x1c95)](_0x15f2cc(0xa1f)),console[_0x15f2cc(0xc0d)](_0x15f2cc(0x12dc));}else recentEmojis=[];}else recentEmojis=[];}else recentEmojis=_0x5cf9b2[_0x15f2cc(0xf6d)](_0x320026=>({'url':_0x320026[_0x15f2cc(0x10c6)],'description':_0x320026[_0x15f2cc(0x1c6f)]})),console[_0x15f2cc(0xc0d)](_0x15f2cc(0x1ad1),recentEmojis);}catch(_0x54750a){console[_0x15f2cc(0x24ab)]('加载自定义表情包失败:',_0x54750a);const _0x3a8997=localStorage[_0x15f2cc(0x2250)](_0x15f2cc(0x20c7));_0x3a8997?(customEmojis=JSON[_0x15f2cc(0x168e)](_0x3a8997),console[_0x15f2cc(0xc0d)](_0x15f2cc(0x1819),customEmojis)):customEmojis=[];try{const _0x3a6d0f=await db['recentEmojis'][_0x15f2cc(0x1902)](_0x15f2cc(0xc49))[_0x15f2cc(0x2253)]()[_0x15f2cc(0x18c6)]();_0x3a6d0f[_0x15f2cc(0xcbf)]>0x0?recentEmojis=_0x3a6d0f[_0x15f2cc(0xf6d)](_0x38335d=>({'url':_0x38335d['url'],'description':_0x38335d[_0x15f2cc(0x1c6f)]})):recentEmojis=[];}catch(_0x3756ca){const _0x9a2ab8=localStorage[_0x15f2cc(0x2250)]('recentEmojis');_0x9a2ab8?recentEmojis=JSON[_0x15f2cc(0x168e)](_0x9a2ab8):recentEmojis=[];}}}async function saveCustomEmojis(){const _0x305497=_0x2cf6d4;try{await db['transaction']('rw',db[_0x305497(0x20c7)],async()=>{const _0x48b3b7=_0x305497;await db[_0x48b3b7(0x20c7)][_0x48b3b7(0x803)](_0x544058=>_0x544058[_0x48b3b7(0xd6e)]!==![])['delete']();if(customEmojis[_0x48b3b7(0xcbf)]>0x0){const _0xe8a5a3=customEmojis[_0x48b3b7(0xf6d)](_0x14d5ad=>({..._0x14d5ad,'isPersonal':!![]}));await db[_0x48b3b7(0x20c7)][_0x48b3b7(0x24c8)](_0xe8a5a3);}}),console[_0x305497(0xc0d)]('个人表情包保存成功');}catch(_0x2f2668){console[_0x305497(0x24ab)]('保存自定义表情包失败:',_0x2f2668),showToast(_0x305497(0x2123),_0x305497(0x24ab));}}function showCustomEmojiPanel(){const _0x572c58=_0x2cf6d4,_0xacd755=document[_0x572c58(0x566)]('custom-emoji-panel'),_0x4b55d7=_0xacd755[_0x572c58(0x655)]['display']===_0x572c58(0x2d4);_0x4b55d7?(_0xacd755[_0x572c58(0x655)][_0x572c58(0x2526)]=_0x572c58(0xfe9),document[_0x572c58(0x6be)](_0x572c58(0x1e62),hideCustomEmojiPanel)):(_0xacd755['style']['display']='block',renderEmojiGrid(),setTimeout(()=>{const _0x2a7029=_0x572c58;document[_0x2a7029(0x167)](_0x2a7029(0x1e62),hideCustomEmojiPanel);},0x64));}function hideCustomEmojiPanel(_0x1cd78c){const _0x3559fe=_0x2cf6d4,_0x30d307=document['getElementById']('custom-emoji-panel');if(!_0x1cd78c){_0x30d307&&(_0x30d307[_0x3559fe(0x655)][_0x3559fe(0x2526)]=_0x3559fe(0xfe9),document['removeEventListener'](_0x3559fe(0x1e62),hideCustomEmojiPanel));return;}const _0x3719b0=_0x1cd78c[_0x3559fe(0x1144)]['closest'](_0x3559fe(0x21a5));_0x30d307&&!_0x30d307[_0x3559fe(0x1f9)](_0x1cd78c[_0x3559fe(0x1144)])&&!_0x3719b0&&(_0x30d307[_0x3559fe(0x655)]['display']=_0x3559fe(0xfe9),document[_0x3559fe(0x6be)]('click',hideCustomEmojiPanel));}async function renderEmojiGrid(){const _0x5222fe=_0x2cf6d4,_0x541f20=document['getElementById'](_0x5222fe(0x1460));_0x541f20[_0x5222fe(0xc02)]='';let _0x5da28b=[];if(currentEmojiTab===_0x5222fe(0x1274))_0x5da28b=await getFilteredEmojis(recentEmojis);else currentEmojiTab==='custom'&&(_0x5da28b=await getFilteredEmojis(customEmojis));_0x5da28b[_0x5222fe(0x900)]((_0x4906d6,_0x5b3020)=>{const _0x39df48=_0x5222fe,_0x18297f=document[_0x39df48(0x1ad8)](_0x39df48(0x526));_0x18297f[_0x39df48(0x221)]=_0x39df48(0xc0c);const _0x1473e1=_0x4906d6['imageData']||_0x4906d6[_0x39df48(0x10c6)]||'';_0x18297f[_0x39df48(0x655)]['backgroundImage']=_0x1473e1&&_0x1473e1!=='undefined'?_0x39df48(0xcb5)+_0x1473e1+')':_0x39df48(0xfe9),_0x18297f[_0x39df48(0x11cf)]=()=>sendEmojiMessage(_0x4906d6);const _0xe899b5=currentEmojiTab==='recent'||currentEmojiTab===_0x39df48(0x13a8)&&_0x4906d6['isPersonal']!==![];if(_0xe899b5){const _0x51a6e5=document[_0x39df48(0x1ad8)](_0x39df48(0x217f));_0x51a6e5[_0x39df48(0x221)]='emoji-delete-btn',_0x51a6e5[_0x39df48(0xc02)]='×',_0x51a6e5[_0x39df48(0x11cf)]=_0x4aa5ff=>{const _0x54568e=_0x39df48;_0x4aa5ff[_0x54568e(0x1023)]();if(currentEmojiTab==='custom')deleteCustomEmoji(_0x5b3020);else currentEmojiTab===_0x54568e(0x1274)&&deleteRecentEmoji(_0x5b3020);},_0x18297f['appendChild'](_0x51a6e5);}_0x541f20[_0x39df48(0x1925)](_0x18297f);});if(currentEmojiTab==='custom'){const _0x543980=document[_0x5222fe(0x1ad8)](_0x5222fe(0x526));_0x543980[_0x5222fe(0x221)]=_0x5222fe(0x194c),_0x543980[_0x5222fe(0xc02)]='+',_0x543980[_0x5222fe(0x11cf)]=()=>document[_0x5222fe(0x566)](_0x5222fe(0x6af))[_0x5222fe(0x1e62)](),_0x541f20[_0x5222fe(0x1925)](_0x543980);}if(_0x5da28b[_0x5222fe(0xcbf)]===0x0){const _0x5b4586=document[_0x5222fe(0x1ad8)]('div');_0x5b4586[_0x5222fe(0x221)]=_0x5222fe(0x486),currentEmojiTab===_0x5222fe(0x1274)?_0x5b4586[_0x5222fe(0x21dc)]='还没有使用过表情包':_0x5b4586['textContent']=_0x5222fe(0x12f1),_0x541f20[_0x5222fe(0x1925)](_0x5b4586);}}async function sendEmojiMessage(_0xd10ca7){const _0x417c5f=_0x2cf6d4;console[_0x417c5f(0xc0d)](_0x417c5f(0x83f),_0xd10ca7);if(!currentChatCharacter)return;addToRecentEmojis(_0xd10ca7);const _0x40ef47=Date[_0x417c5f(0x18e0)]()[_0x417c5f(0x9a3)](),_0x4f36a4={'id':_0x40ef47,'sender':_0x417c5f(0xfda),'content':'','image':_0xd10ca7[_0x417c5f(0xfe5)]||_0xd10ca7[_0x417c5f(0x10c6)],'isEmoji':!![],'emojiDescription':_0xd10ca7[_0x417c5f(0x1c6f)]||_0x417c5f(0x13b5),'timestamp':Date['now']()};!chatMessages[currentChatCharacter['id']]&&(chatMessages[currentChatCharacter['id']]=[]);chatMessages[currentChatCharacter['id']][_0x417c5f(0x6ee)](_0x4f36a4);try{const _0x5c8f6d=currentChatCharacter['id']+'_'+_0x4f36a4['id']+'_'+(chatMessages[currentChatCharacter['id']][_0x417c5f(0xcbf)]-0x1);await db[_0x417c5f(0x464)][_0x417c5f(0xe1)]({'id':_0x5c8f6d,'characterId':currentChatCharacter['id'],'timestamp':_0x4f36a4[_0x417c5f(0x7aa)],'messageOrder':chatMessages[currentChatCharacter['id']][_0x417c5f(0xcbf)]-0x1,'originalMessageId':_0x4f36a4['id'],'messageData':_0x4f36a4}),console[_0x417c5f(0xc0d)](_0x417c5f(0x1d66));}catch(_0x508f62){console[_0x417c5f(0x24ab)](_0x417c5f(0x2050),_0x508f62),saveChatMessages();}renderChatMessages(currentChatCharacter['id']),triggerStatusUpdateAfterMessage(currentChatCharacter['id']),hideCustomEmojiPanel(),pendingUserMessage=_0x4f36a4;const _0x551023=document[_0x417c5f(0x566)](_0x417c5f(0x9c));_0x551023&&(_0x551023[_0x417c5f(0x655)][_0x417c5f(0x4ce)]=_0x417c5f(0x23f0),_0x551023[_0x417c5f(0x226e)][_0x417c5f(0xe1)](_0x417c5f(0x1f33)),_0x551023['title']=_0x417c5f(0x100f));}async function saveRecentEmojis(){const _0x2791f7=_0x2cf6d4;try{const _0x431a64=0xa;recentEmojis[_0x2791f7(0xcbf)]>_0x431a64&&(recentEmojis=recentEmojis[_0x2791f7(0x136)](0x0,_0x431a64)),await db[_0x2791f7(0x174a)]('rw',db[_0x2791f7(0xa1f)],async()=>{const _0x3f096e=_0x2791f7;await db[_0x3f096e(0xa1f)][_0x3f096e(0x2215)]();if(recentEmojis['length']>0x0){const _0x141d6c=recentEmojis['map']((_0x145c6b,_0x5d51ad)=>({'id':_0x5d51ad+0x1,'url':_0x145c6b['imageData']||_0x145c6b[_0x3f096e(0x10c6)],'description':_0x145c6b['description']||_0x3f096e(0x1cd2),'lastUsed':Date[_0x3f096e(0x18e0)]()-_0x5d51ad*0x3e8}));await db[_0x3f096e(0xa1f)][_0x3f096e(0x24c8)](_0x141d6c);}});}catch(_0x77d0d4){console[_0x2791f7(0x24ab)](_0x2791f7(0x1b4c),_0x77d0d4);}}async function addToRecentEmojis(_0x295bcf){const _0x11b932=_0x2cf6d4,_0x42d7cf=_0x295bcf['imageData']||_0x295bcf[_0x11b932(0x10c6)];recentEmojis=recentEmojis[_0x11b932(0x803)](_0x509905=>(_0x509905[_0x11b932(0xfe5)]||_0x509905['url'])!==_0x42d7cf),recentEmojis[_0x11b932(0x50a)](_0x295bcf),recentEmojis[_0x11b932(0xcbf)]>0x14&&(recentEmojis=recentEmojis['slice'](0x0,0x14)),await saveRecentEmojis();}function isVisionModelSupported(){const _0x480a11=_0x2cf6d4,_0xd5e344=['gpt-4-vision',_0x480a11(0x13e),_0x480a11(0x254c),_0x480a11(0x78f),'gemini-1.5-pro',_0x480a11(0x1a86),_0x480a11(0x249c),_0x480a11(0x13c5),_0x480a11(0x18a9),_0x480a11(0x1057),_0x480a11(0x9aa),_0x480a11(0x4a7),_0x480a11(0x641),_0x480a11(0x479),'claude-3.5-sonnet',_0x480a11(0xd17),_0x480a11(0x320),_0x480a11(0x1e2c),'yi-vision',_0x480a11(0x8c5),_0x480a11(0x134c),_0x480a11(0x153e),_0x480a11(0x13aa),_0x480a11(0x4ac),_0x480a11(0x497)],_0x28d598=apiSettings[_0x480a11(0xeea)]?.[_0x480a11(0x1d64)]()||'',_0x11b37b=_0xd5e344[_0x480a11(0x184b)](_0x3d265b=>_0x28d598[_0x480a11(0x23ec)](_0x3d265b[_0x480a11(0x1d64)]()));return console[_0x480a11(0xc0d)]('当前模型:',_0x28d598),console['log'](_0x480a11(0x200c),_0x11b37b),_0x11b37b;}async function deleteCustomEmoji(_0x1884d7){const _0x5908d0=_0x2cf6d4;if(confirm('确定要彻底删除这个表情包吗？\x0a\x0a删除后无法恢复！')){const _0x35b68a=customEmojis[_0x1884d7];customEmojis[_0x5908d0(0x220f)](_0x1884d7,0x1);if(_0x35b68a['id'])try{await db[_0x5908d0(0x20c7)][_0x5908d0(0xc2b)](_0x35b68a['id']),await db[_0x5908d0(0xa1f)][_0x5908d0(0x4a6)]('id')[_0x5908d0(0x14a)](_0x35b68a['id'])['delete'](),await db[_0x5908d0(0x156f)][_0x5908d0(0x4a6)](_0x5908d0(0x1a7))[_0x5908d0(0x14a)](_0x35b68a['id'])[_0x5908d0(0xc2b)]();}catch(_0x10571a){console[_0x5908d0(0x24ab)](_0x5908d0(0x1b2a),_0x10571a);}saveCustomEmojis(),renderEmojiGrid(),showToast(_0x5908d0(0xe51),'success');}}async function deleteRecentEmoji(_0x114d5e){const _0xce0cba=_0x2cf6d4;if(confirm('确定要彻底删除这个表情包吗？\x0a\x0a删除后无法恢复！')){const _0x5033cd=recentEmojis[_0x114d5e];recentEmojis[_0xce0cba(0x220f)](_0x114d5e,0x1);if(_0x5033cd['id'])try{await db['customEmojis'][_0xce0cba(0xc2b)](_0x5033cd['id']),await db['recentEmojis']['where']('id')[_0xce0cba(0x14a)](_0x5033cd['id'])['delete'](),await db[_0xce0cba(0x156f)][_0xce0cba(0x4a6)]('emojiId')[_0xce0cba(0x14a)](_0x5033cd['id'])[_0xce0cba(0xc2b)]();}catch(_0x517a83){console[_0xce0cba(0x24ab)](_0xce0cba(0x1b2a),_0x517a83);}saveCustomEmojis(),renderEmojiGrid(),showToast(_0xce0cba(0xe51),_0xce0cba(0xb27));}}function initializeEmojiUpload(){const _0x54acfb=_0x2cf6d4,_0x20da6b=document[_0x54acfb(0x566)]('emoji-upload');_0x20da6b&&_0x20da6b[_0x54acfb(0x167)](_0x54acfb(0x17ef),handleEmojiUpload),document[_0x54acfb(0x1ed9)](_0x54acfb(0x1b29))[_0x54acfb(0x900)](_0x4bfbb9=>{const _0x160bca=_0x54acfb;_0x4bfbb9[_0x160bca(0x167)]('click',function(){const _0x382f56=_0x160bca;document['querySelectorAll'](_0x382f56(0x1b29))[_0x382f56(0x900)](_0x37bc6a=>_0x37bc6a[_0x382f56(0x226e)][_0x382f56(0x128)](_0x382f56(0x105d))),this[_0x382f56(0x226e)][_0x382f56(0xe1)](_0x382f56(0x105d)),currentEmojiTab=this['dataset']['tab'],renderEmojiGrid();});});}function toggleToolsPanel(){const _0x3610b9=_0x2cf6d4,_0x5297e1=document[_0x3610b9(0x566)]('tools-panel'),_0x578a10=document[_0x3610b9(0x566)](_0x3610b9(0xab)),_0x33018a=document[_0x3610b9(0x566)]('custom-emoji-panel');if(!_0x5297e1||!_0x578a10)return;const _0x31b956=_0x5297e1['style'][_0x3610b9(0x2526)]===_0x3610b9(0x2d4);_0x31b956?hideToolsPanel():(showToolsPanel(),_0x33018a&&(_0x33018a[_0x3610b9(0x655)][_0x3610b9(0x2526)]='none'),setTimeout(()=>{const _0x535f33=_0x3610b9;document[_0x535f33(0x167)](_0x535f33(0x1e62),handleToolsPanelOutsideClick);},0x64));}function showToolsPanel(){const _0xb3c3b6=_0x2cf6d4,_0x42ae0d=document[_0xb3c3b6(0x566)](_0xb3c3b6(0x90a)),_0x327b4d=document[_0xb3c3b6(0x566)]('toggle-tools-btn'),_0x166458=document[_0xb3c3b6(0x1ed9)](_0xb3c3b6(0x384)),_0xfbe0d2=currentChatCharacter&&currentChatCharacter['isGroup'];_0x166458['forEach'](_0x2c99b7=>{const _0x254a2f=_0xb3c3b6;_0xfbe0d2?_0x2c99b7['style']['display']='none':_0x2c99b7[_0x254a2f(0x655)][_0x254a2f(0x2526)]='';}),_0x42ae0d&&(_0x42ae0d['style'][_0xb3c3b6(0x2526)]='block',_0x42ae0d[_0xb3c3b6(0x655)]['animation']=_0xb3c3b6(0x164a)),_0x327b4d&&_0x327b4d['classList'][_0xb3c3b6(0xe1)](_0xb3c3b6(0x105d));}function hideToolsPanel(){const _0x47bb7f=_0x2cf6d4,_0x41ad79=document[_0x47bb7f(0x566)](_0x47bb7f(0x90a)),_0x1eb734=document['getElementById'](_0x47bb7f(0xab));_0x41ad79&&(_0x41ad79[_0x47bb7f(0x655)]['display']=_0x47bb7f(0xfe9)),_0x1eb734&&_0x1eb734[_0x47bb7f(0x226e)][_0x47bb7f(0x128)](_0x47bb7f(0x105d)),document[_0x47bb7f(0x6be)](_0x47bb7f(0x1e62),handleToolsPanelOutsideClick);}function handleToolsPanelOutsideClick(_0x41bfcb){const _0x103b64=_0x2cf6d4,_0x475859=document['getElementById'](_0x103b64(0x90a)),_0x5683f0=document['getElementById'](_0x103b64(0xab));_0x475859&&!_0x475859[_0x103b64(0x1f9)](_0x41bfcb['target'])&&_0x5683f0&&!_0x5683f0['contains'](_0x41bfcb[_0x103b64(0x1144)])&&hideToolsPanel();}function handleEmojiUpload(_0x1a3119){const _0x484375=_0x2cf6d4,_0x276694=_0x1a3119[_0x484375(0x1144)][_0x484375(0x173e)];if(!_0x276694||_0x276694[_0x484375(0xcbf)]===0x0)return;Array['from'](_0x276694)[_0x484375(0x900)](_0x662d17=>{const _0x3dd0f8=_0x484375;if(!_0x662d17[_0x3dd0f8(0x23df)][_0x3dd0f8(0x1cab)](_0x3dd0f8(0x1183))){alert(_0x3dd0f8(0x76b));return;}if(_0x662d17[_0x3dd0f8(0x23df)]==='image/gif'){const _0x2050e7=confirm('检测到GIF格式的表情包！\x0a\x0a⚠️\x20注意事项：\x0a•\x20AI可以发送这个GIF动图\x0a•\x20但Gemini\x20API无法识别GIF内容\x0a•\x20重新生成功能可能失效\x0a•\x20建议使用静态图片格式\x0a\x0a是否仍要上传这个GIF表情包？');if(!_0x2050e7)return;}if(_0x662d17[_0x3dd0f8(0x41a)]>0x5*0x400*0x400){alert(_0x3dd0f8(0x1c09));return;}const _0x183182=new FileReader();_0x183182[_0x3dd0f8(0xc28)]=function(_0x184969){const _0x7bf2cf=_0x3dd0f8,_0x4b86ba={'id':Date[_0x7bf2cf(0x18e0)]()['toString']()+'_'+Math[_0x7bf2cf(0x191c)]()[_0x7bf2cf(0x9a3)](0x24)['substr'](0x2,0x9),'url':_0x184969['target']['result'],'addedAt':new Date()[_0x7bf2cf(0xa4b)](),'isPersonal':!![]};pendingPersonalEmojiData=_0x4b86ba,showPersonalEmojiDescriptionModal(_0x184969[_0x7bf2cf(0x1144)][_0x7bf2cf(0x1fff)]);},_0x183182[_0x3dd0f8(0x145e)](_0x662d17);}),_0x1a3119['target'][_0x484375(0xc34)]='';}function showPersonalEmojiDescriptionModal(_0x6c33a2){const _0x30675a=_0x2cf6d4,_0x288929=document[_0x30675a(0x566)](_0x30675a(0x2e7)),_0x45aa5f=document['getElementById']('personal-emoji-preview-image'),_0x39bde5=document[_0x30675a(0x566)](_0x30675a(0xffe));_0x45aa5f['src']=_0x6c33a2,_0x39bde5['value']='',_0x288929[_0x30675a(0x655)][_0x30675a(0x2526)]=_0x30675a(0x1f0b),setTimeout(()=>{const _0x55e04b=_0x30675a;_0x39bde5[_0x55e04b(0x1b12)]();},0x64);const _0x3e77c9=_0x48d917=>{const _0xc65f17=_0x30675a;if(_0x48d917['key']==='Enter'&&(_0x48d917[_0xc65f17(0x1870)]||_0x48d917[_0xc65f17(0x1b7f)]))confirmPersonalEmojiDescription(),_0x39bde5[_0xc65f17(0x6be)](_0xc65f17(0x695),_0x3e77c9);else _0x48d917['key']===_0xc65f17(0x1cdd)&&(hidePersonalEmojiDescriptionModal(),_0x39bde5[_0xc65f17(0x6be)](_0xc65f17(0x695),_0x3e77c9));};_0x39bde5[_0x30675a(0x167)](_0x30675a(0x695),_0x3e77c9);}function hidePersonalEmojiDescriptionModal(_0x528515){const _0x5f2bdf=_0x2cf6d4;if(_0x528515&&_0x528515[_0x5f2bdf(0x1144)]!==_0x528515[_0x5f2bdf(0x52b)])return;const _0x7be36f=document[_0x5f2bdf(0x566)](_0x5f2bdf(0x2e7));_0x7be36f[_0x5f2bdf(0x655)]['display']='none',pendingPersonalEmojiData=null;}function confirmPersonalEmojiDescription(){const _0x2b0b06=_0x2cf6d4;if(!pendingPersonalEmojiData)return;const _0x1eea16=document[_0x2b0b06(0x566)](_0x2b0b06(0xffe)),_0x3d4b67=_0x1eea16[_0x2b0b06(0xc34)][_0x2b0b06(0x1424)]()||'表情包',_0x342881={'id':pendingPersonalEmojiData['id'],'url':pendingPersonalEmojiData[_0x2b0b06(0x10c6)],'description':_0x3d4b67,'addedAt':pendingPersonalEmojiData[_0x2b0b06(0x20d0)],'isPersonal':pendingPersonalEmojiData[_0x2b0b06(0xd6e)]};customEmojis[_0x2b0b06(0x6ee)](_0x342881),saveCustomEmojis(),currentEmojiTab===_0x2b0b06(0x13a8)&&renderEmojiGrid(),document[_0x2b0b06(0x566)](_0x2b0b06(0x2e7))[_0x2b0b06(0x655)][_0x2b0b06(0x2526)]='none',pendingPersonalEmojiData=null,showToast(_0x2b0b06(0x98a),'success');}async function loadEmojiLibraries(){const _0x253aff=_0x2cf6d4;try{emojiLibraries=await db[_0x253aff(0x19c1)][_0x253aff(0x18c6)](),renderEmojiLibraryList();}catch(_0x2401bc){console[_0x253aff(0x24ab)](_0x253aff(0x1516),_0x2401bc),emojiLibraries=[];}}async function saveEmojiLibraries(){const _0x248ba9=_0x2cf6d4;try{await db['transaction']('rw',db[_0x248ba9(0x19c1)],async()=>{const _0xcd4234=_0x248ba9;await db[_0xcd4234(0x19c1)][_0xcd4234(0x2215)](),emojiLibraries[_0xcd4234(0xcbf)]>0x0&&await db[_0xcd4234(0x19c1)][_0xcd4234(0x24c8)](emojiLibraries);}),console[_0x248ba9(0xc0d)](_0x248ba9(0x17fb));}catch(_0x2fc5f7){console[_0x248ba9(0x24ab)](_0x248ba9(0x228f),_0x2fc5f7);}}function togglePersonaSection(){const _0x4d0cec=_0x2cf6d4,_0x1e0211=document[_0x4d0cec(0x566)](_0x4d0cec(0x2227)),_0x2d4eda=document[_0x4d0cec(0x566)](_0x4d0cec(0x126c));isPersonaExpanded=!isPersonaExpanded,isPersonaExpanded?(_0x1e0211[_0x4d0cec(0x655)]['display']=_0x4d0cec(0x2d4),_0x2d4eda[_0x4d0cec(0x226e)][_0x4d0cec(0xe1)](_0x4d0cec(0x5c2))):(_0x1e0211['style'][_0x4d0cec(0x2526)]=_0x4d0cec(0xfe9),_0x2d4eda[_0x4d0cec(0x226e)]['remove'](_0x4d0cec(0x5c2)));}function toggleEmojiLibrarySection(){const _0x1474f4=_0x2cf6d4,_0x9f9916=document[_0x1474f4(0x566)](_0x1474f4(0x2390)),_0x341012=document['getElementById'](_0x1474f4(0x1884));isEmojiLibraryExpanded=!isEmojiLibraryExpanded,isEmojiLibraryExpanded?(_0x9f9916[_0x1474f4(0x655)]['display']=_0x1474f4(0x2d4),_0x341012['classList'][_0x1474f4(0xe1)](_0x1474f4(0x5c2)),renderEmojiLibraryList()):(_0x9f9916['style'][_0x1474f4(0x2526)]=_0x1474f4(0xfe9),_0x341012[_0x1474f4(0x226e)][_0x1474f4(0x128)]('expanded'));}function renderEmojiLibraryList(){const _0x200fbd=_0x2cf6d4,_0x32acfb=document[_0x200fbd(0x566)](_0x200fbd(0x1ef0));if(!_0x32acfb)return;if(emojiLibraries[_0x200fbd(0xcbf)]===0x0){_0x32acfb['innerHTML']=_0x200fbd(0x12b5);return;}_0x32acfb[_0x200fbd(0xc02)]=emojiLibraries[_0x200fbd(0xf6d)](_0x28fb2c=>_0x200fbd(0x21d3)+_0x28fb2c['id']+_0x200fbd(0x1aaa)+_0x28fb2c[_0x200fbd(0x222f)]+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22emoji-library-item-stats\x22\x20id=\x22library-stats-'+_0x28fb2c['id']+_0x200fbd(0xea)+_0x28fb2c['id']+_0x200fbd(0xe7)+_0x28fb2c['id']+_0x200fbd(0x7bd)+_0x28fb2c['id']+_0x200fbd(0x126f))[_0x200fbd(0x140c)](''),emojiLibraries[_0x200fbd(0x900)](async _0x35ed1=>{const _0x28b75e=_0x200fbd,_0x4baef6=await getEmojiLibraryItemCount(_0x35ed1['id']),_0x37bf0f=document[_0x28b75e(0x566)](_0x28b75e(0x2458)+_0x35ed1['id']);_0x37bf0f&&(_0x37bf0f[_0x28b75e(0x21dc)]=_0x4baef6+_0x28b75e(0x1b50));});}async function getEmojiLibraryItemCount(_0x47dfc7){const _0x39e0d0=_0x2cf6d4;try{const _0x3cf331=await db['emojiLibraryItems'][_0x39e0d0(0x4a6)]('libraryId')['equals'](_0x47dfc7)[_0x39e0d0(0x35e)]();return _0x3cf331;}catch(_0x2a72a5){return console[_0x39e0d0(0x24ab)](_0x39e0d0(0x15d8),_0x2a72a5),0x0;}}async function checkAllEmojiData(){const _0x147607=_0x2cf6d4;console[_0x147607(0xc0d)]('🚨\x20[URGENT]\x20详细检查所有表情包数据...');try{const _0x37e0ac=await db['customEmojis']['toArray']();console[_0x147607(0xc0d)](_0x147607(0xda7)),_0x37e0ac['forEach']((_0x3a1dfb,_0x418576)=>{const _0x45262d=_0x147607;console[_0x45262d(0xc0d)](_0x418576+0x1+_0x45262d(0x940)+_0x3a1dfb['id']),console[_0x45262d(0xc0d)](_0x45262d(0x22c6)+_0x3a1dfb[_0x45262d(0x1c6f)]+'\x22'),console['log'](_0x45262d(0x2362)+_0x3a1dfb[_0x45262d(0x222f)]),console[_0x45262d(0xc0d)](_0x45262d(0x2328)+_0x3a1dfb['uploadTime']),console[_0x45262d(0xc0d)](_0x45262d(0x100)+_0x3a1dfb['isPersonal']),console[_0x45262d(0xc0d)](_0x45262d(0x1a58));});const _0x4f3e42=await db['emojiLibraryItems'][_0x147607(0x18c6)]();console[_0x147607(0xc0d)](_0x147607(0x17b3)),_0x4f3e42['forEach'](_0x565c46=>{const _0x5cbdad=_0x147607;console['log']('\x20\x20库:\x20'+_0x565c46[_0x5cbdad(0x245b)]+_0x5cbdad(0xc81)+_0x565c46[_0x5cbdad(0x1a7)]);});const _0x281ea8=_0x37e0ac['filter'](_0xb40031=>{const _0x29b610=_0x147607,_0x1c864d=new Date(_0xb40031[_0x29b610(0xf8a)]),_0x4218f0=new Date(),_0xd5d3eb=(_0x4218f0-_0x1c864d)/(0x3e8*0x3c*0x3c);return _0xd5d3eb<0x18;});return console[_0x147607(0xc0d)](_0x147607(0x721),_0x281ea8[_0x147607(0xcbf)],'个'),_0x281ea8[_0x147607(0x900)](_0x279d33=>{const _0x3479c7=_0x147607;console['log'](_0x3479c7(0x7ef)+_0x279d33[_0x3479c7(0x1c6f)]+_0x3479c7(0x1d99)+_0x279d33[_0x3479c7(0xd6e)]);}),{'allEmojis':_0x37e0ac,'recentEmojis':_0x281ea8,'associations':_0x4f3e42};}catch(_0x2f63fe){return console[_0x147607(0x24ab)](_0x147607(0x270),_0x2f63fe),{'error':_0x2f63fe[_0x147607(0xd7a)]};}}async function diagnoseBrowserStorage(){const _0x38519a=_0x2cf6d4;console[_0x38519a(0xc0d)]('🚨\x20[DIAGNOSE]\x20开始诊断浏览器存储状态...');try{if(_0x38519a(0x1408)in navigator&&'estimate'in navigator[_0x38519a(0x1408)]){const _0x326641=await navigator[_0x38519a(0x1408)][_0x38519a(0xed4)]();console[_0x38519a(0xc0d)](_0x38519a(0x10d4),{'已使用':Math[_0x38519a(0x5f3)](_0x326641[_0x38519a(0x1ad6)]/0x400/0x400)+'MB','总配额':Math[_0x38519a(0x5f3)](_0x326641[_0x38519a(0xb86)]/0x400/0x400)+'MB','使用率':Math[_0x38519a(0x5f3)](_0x326641['usage']/_0x326641['quota']*0x64)+'%'});}const _0x13aa2d=await db[_0x38519a(0x20c7)][_0x38519a(0x18c6)](),_0x4b35ea=_0x13aa2d[_0x38519a(0x14f5)]((_0x139050,_0x255a6f)=>{const _0x26095e=_0x38519a,_0x51b162=_0x255a6f[_0x26095e(0xfe5)]||_0x255a6f[_0x26095e(0x10c6)]||'';return _0x139050+_0x51b162[_0x26095e(0xcbf)];},0x0);console['log'](_0x38519a(0x19a6),{'表情包数量':_0x13aa2d[_0x38519a(0xcbf)],'估计大小':Math['round'](_0x4b35ea/0x400/0x400)+'MB'});const _0x1b37f9=_0x13aa2d['reduce']((_0x1f5cac,_0x141453)=>{const _0x9d6700=_0x38519a,_0xc9e81e=new Date(_0x141453['uploadTime']),_0x42a251=new Date(_0x1f5cac[_0x9d6700(0xf8a)]);return _0xc9e81e<_0x42a251?_0x141453:_0x1f5cac;},_0x13aa2d[0x0]);if(_0x1b37f9){const _0x31cada=new Date(_0x1b37f9[_0x38519a(0xf8a)]),_0x4fcda7=(new Date()-_0x31cada)/(0x3e8*0x3c*0x3c);console[_0x38519a(0xc0d)](_0x38519a(0x2017),{'描述':_0x1b37f9[_0x38519a(0x1c6f)],'上传时间':_0x1b37f9[_0x38519a(0xf8a)],'距今小时数':Math[_0x38519a(0x5f3)](_0x4fcda7)});}return{'allEmojis':_0x13aa2d,'totalSize':_0x4b35ea};}catch(_0x275f85){return console[_0x38519a(0x24ab)](_0x38519a(0xd33),_0x275f85),{'error':_0x275f85['message']};}}function showEmojiRecoveryInstructions(){const _0x1b4a25=_0x2cf6d4;console[_0x1b4a25(0xc0d)]('🚨\x20[RECOVERY]\x20表情包数据完全丢失，需要重新上传');const _0x2de8a9=_0x1b4a25(0xec9);return console['log'](_0x2de8a9),showToast(_0x1b4a25(0x6d9),_0x1b4a25(0x2422)),_0x2de8a9;}async function manualRecoverEmojis(_0x35715f){const _0x9bede1=_0x2cf6d4;console['log'](_0x9bede1(0x56c),_0x35715f);try{const _0x35d2cb=emojiLibraries['find'](_0x121f1b=>_0x121f1b[_0x9bede1(0x222f)]===_0x35715f);if(!_0x35d2cb){console[_0x9bede1(0x24ab)](_0x9bede1(0x4b1),_0x35715f);return;}const _0x11b62b=await db[_0x9bede1(0x20c7)][_0x9bede1(0x4a6)](_0x9bede1(0xd6e))['equals'](![])[_0x9bede1(0x18c6)](),_0x3e7d1b=await db[_0x9bede1(0x156f)][_0x9bede1(0x18c6)](),_0x2035e2=_0x11b62b['filter'](_0x5a5f3a=>!_0x3e7d1b['some'](_0x2ee45d=>_0x2ee45d[_0x9bede1(0x1a7)]===_0x5a5f3a['id']));console[_0x9bede1(0xc0d)](_0x9bede1(0x1148),_0x2035e2['length'],'个'),_0x2035e2['forEach'](_0x3284e8=>{const _0x30c733=_0x9bede1;console[_0x30c733(0xc0d)](_0x30c733(0x1ff5)+_0x3284e8[_0x30c733(0x1c6f)]+_0x30c733(0x3a7)+_0x3284e8['id']+')');});const _0x3384fe=_0x2035e2['map'](_0x5a39d5=>({'libraryId':_0x35d2cb['id'],'emojiId':_0x5a39d5['id'],'addedAt':_0x5a39d5['uploadTime']||new Date()[_0x9bede1(0xa4b)]()}));_0x3384fe[_0x9bede1(0xcbf)]>0x0?(await db['emojiLibraryItems'][_0x9bede1(0x4c5)](_0x3384fe),console['log'](_0x9bede1(0x1708),_0x3384fe[_0x9bede1(0xcbf)],'个关联记录到库:',_0x35715f),await loadEmojiLibraries(),showToast(_0x9bede1(0x1f20)+_0x3384fe[_0x9bede1(0xcbf)]+_0x9bede1(0x185)+_0x35715f,_0x9bede1(0xb27))):showToast(_0x9bede1(0x16f8),_0x9bede1(0x2422));}catch(_0x22238c){console[_0x9bede1(0x24ab)](_0x9bede1(0x1ad9),_0x22238c),showToast(_0x9bede1(0x175a)+_0x22238c[_0x9bede1(0xd7a)],'error');}}async function recoverEmojiLibraryAssociations(){const _0x21e1fc=_0x2cf6d4;console[_0x21e1fc(0xc0d)](_0x21e1fc(0x4f9));try{const _0x3ec213=await db['emojiLibraries'][_0x21e1fc(0x18c6)]();console[_0x21e1fc(0xc0d)](_0x21e1fc(0x20af),_0x3ec213[_0x21e1fc(0xcbf)],'个');const _0x15cb68=await db[_0x21e1fc(0x20c7)][_0x21e1fc(0x4a6)](_0x21e1fc(0xd6e))[_0x21e1fc(0x14a)](![])[_0x21e1fc(0x18c6)]();console[_0x21e1fc(0xc0d)](_0x21e1fc(0x11d7),_0x15cb68['length'],'个'),console[_0x21e1fc(0xc0d)]('🔧\x20[RECOVER]\x20库表情包详情:',_0x15cb68[_0x21e1fc(0xf6d)](_0x510ecc=>({'id':_0x510ecc['id'],'name':_0x510ecc[_0x21e1fc(0x222f)],'description':_0x510ecc['description'],'uploadTime':_0x510ecc['uploadTime']})));const _0x56eaec=await db[_0x21e1fc(0x156f)]['toArray']();console['log'](_0x21e1fc(0x680),_0x56eaec[_0x21e1fc(0xcbf)],'个');const _0x386230=_0x15cb68['filter'](_0x412700=>!_0x56eaec['some'](_0x455914=>_0x455914[_0x21e1fc(0x1a7)]===_0x412700['id']));console[_0x21e1fc(0xc0d)](_0x21e1fc(0x13bd),_0x386230['length'],'个');if(_0x386230['length']>0x0){console[_0x21e1fc(0xc0d)]('🔧\x20[RECOVER]\x20孤立表情包详情:',_0x386230[_0x21e1fc(0xf6d)](_0x292152=>({'id':_0x292152['id'],'name':_0x292152[_0x21e1fc(0x222f)],'description':_0x292152['description'],'uploadTime':_0x292152['uploadTime']})));const _0x30543a=_0x3ec213['map']((_0x41887e,_0x37bc14)=>_0x37bc14+0x1+'.\x20'+_0x41887e[_0x21e1fc(0x222f)])[_0x21e1fc(0x140c)]('\x0a'),_0xca39d6=prompt('发现\x20'+_0x386230[_0x21e1fc(0xcbf)]+_0x21e1fc(0x1c59)+_0x30543a+_0x21e1fc(0xc92));if(_0xca39d6===null){showToast(_0x21e1fc(0xe3),_0x21e1fc(0x2422));return;}const _0x7b1d9a=[];if(_0xca39d6['toLowerCase']()===_0x21e1fc(0x153f))for(const _0x2aad27 of _0x386230){const _0x14d9e8=new Date(_0x2aad27[_0x21e1fc(0xf8a)])['getTime']();let _0x4f1ccf=null,_0x104302=Infinity;for(const _0x3a0ca5 of _0x3ec213){const _0x3fdc3f=new Date(_0x3a0ca5[_0x21e1fc(0xd70)])[_0x21e1fc(0xa57)](),_0x5c864c=Math[_0x21e1fc(0x2424)](_0x14d9e8-_0x3fdc3f);_0x5c864c<_0x104302&&(_0x104302=_0x5c864c,_0x4f1ccf=_0x3a0ca5);}_0x4f1ccf&&(_0x7b1d9a[_0x21e1fc(0x6ee)]({'libraryId':_0x4f1ccf['id'],'emojiId':_0x2aad27['id'],'addedAt':_0x2aad27[_0x21e1fc(0xf8a)]||new Date()['toISOString']()}),console['log'](_0x21e1fc(0x1415)+_0x2aad27[_0x21e1fc(0x1c6f)]+'\x22\x20到库\x20\x22'+_0x4f1ccf[_0x21e1fc(0x222f)]+'\x22'));}else{const _0x286fb5=parseInt(_0xca39d6)-0x1;if(_0x286fb5>=0x0&&_0x286fb5<_0x3ec213[_0x21e1fc(0xcbf)]){const _0x1fb788=_0x3ec213[_0x286fb5];for(const _0x13362a of _0x386230){_0x7b1d9a['push']({'libraryId':_0x1fb788['id'],'emojiId':_0x13362a['id'],'addedAt':_0x13362a[_0x21e1fc(0xf8a)]||new Date()[_0x21e1fc(0xa4b)]()}),console[_0x21e1fc(0xc0d)](_0x21e1fc(0xff3)+_0x13362a[_0x21e1fc(0x1c6f)]+_0x21e1fc(0x1f99)+_0x1fb788['name']+'\x22');}}else{showToast('无效的库选择',_0x21e1fc(0x24ab));return;}}_0x7b1d9a['length']>0x0?(await db['emojiLibraryItems']['bulkPut'](_0x7b1d9a),console[_0x21e1fc(0xc0d)](_0x21e1fc(0x20eb),_0x7b1d9a[_0x21e1fc(0xcbf)],_0x21e1fc(0x5be)),await loadEmojiLibraries(),showToast(_0x21e1fc(0x1f20)+_0x7b1d9a[_0x21e1fc(0xcbf)]+'\x20个表情包的关联记录','success')):showToast(_0x21e1fc(0x49e),_0x21e1fc(0x2422));}else showToast(_0x21e1fc(0x111a),'success');}catch(_0x2b9dfe){console[_0x21e1fc(0x24ab)]('🔧\x20[RECOVER]\x20恢复关联记录失败:',_0x2b9dfe),showToast('恢复失败:\x20'+_0x2b9dfe['message'],_0x21e1fc(0x24ab));}}function showCreateLibraryForm(){const _0x4b4296=_0x2cf6d4;document['getElementById'](_0x4b4296(0xb48))[_0x4b4296(0x21dc)]='新建表情包库',document[_0x4b4296(0x566)](_0x4b4296(0xa27))['value']='',document[_0x4b4296(0x566)]('emoji-library-description-input')[_0x4b4296(0xc34)]='',document[_0x4b4296(0x566)]('emoji-library-form-modal')[_0x4b4296(0x655)][_0x4b4296(0x2526)]=_0x4b4296(0x1f0b),currentEmojiLibrary=null,setTimeout(()=>{const _0x194349=_0x4b4296,_0x575568=document[_0x194349(0x566)](_0x194349(0x16d8));_0x575568&&!_0x575568[_0x194349(0xfd2)]('data-event-bound')&&(_0x575568[_0x194349(0x1dd4)](_0x194349(0x1360),_0x194349(0x8f1)),_0x575568[_0x194349(0x167)](_0x194349(0xf52),function(_0x3121b5){const _0x21de49=_0x194349;_0x3121b5['preventDefault'](),console[_0x21de49(0xc0d)](_0x21de49(0x244a));}),_0x575568[_0x194349(0x167)]('touchend',function(_0x380418){const _0x2cdecd=_0x194349;_0x380418[_0x2cdecd(0x4d9)](),console[_0x2cdecd(0xc0d)]('🔧\x20[表情包库]\x20触摸结束，触发保存'),saveEmojiLibrary();}));},0x64);}function editEmojiLibrary(_0x58d8e6){const _0x283c35=_0x2cf6d4,_0x5c10c3=emojiLibraries[_0x283c35(0x1aeb)](_0x35e69f=>_0x35e69f['id']===_0x58d8e6);if(!_0x5c10c3)return;document[_0x283c35(0x566)](_0x283c35(0xb48))[_0x283c35(0x21dc)]='编辑表情包库',document['getElementById'](_0x283c35(0xa27))[_0x283c35(0xc34)]=_0x5c10c3[_0x283c35(0x222f)],document[_0x283c35(0x566)](_0x283c35(0x3e0))[_0x283c35(0xc34)]=_0x5c10c3['description']||'',document['getElementById'](_0x283c35(0x2192))[_0x283c35(0x655)][_0x283c35(0x2526)]='flex',currentEmojiLibrary=_0x5c10c3,setTimeout(()=>{const _0x3094f8=_0x283c35,_0x189703=document[_0x3094f8(0x566)](_0x3094f8(0x16d8));_0x189703&&!_0x189703['hasAttribute'](_0x3094f8(0x1360))&&(_0x189703[_0x3094f8(0x1dd4)]('data-event-bound',_0x3094f8(0x8f1)),_0x189703['addEventListener'](_0x3094f8(0xf52),function(_0x457f78){const _0x4c81c8=_0x3094f8;_0x457f78['preventDefault'](),console[_0x4c81c8(0xc0d)](_0x4c81c8(0x244a));}),_0x189703[_0x3094f8(0x167)](_0x3094f8(0x1263),function(_0x33acd8){const _0x4379b0=_0x3094f8;_0x33acd8[_0x4379b0(0x4d9)](),console[_0x4379b0(0xc0d)]('🔧\x20[表情包库]\x20触摸结束，触发保存'),saveEmojiLibrary();}));},0x64);}function hideEmojiLibraryForm(_0x29bb43){const _0xecd75=_0x2cf6d4;if(_0x29bb43&&_0x29bb43[_0xecd75(0x1144)]!==_0x29bb43[_0xecd75(0x52b)])return;const _0x792395=document[_0xecd75(0x566)](_0xecd75(0x16d8));if(_0x792395&&_0x792395[_0xecd75(0xfd2)]('data-event-bound')){_0x792395[_0xecd75(0x10b3)](_0xecd75(0x1360));const _0x528157=_0x792395['cloneNode'](!![]);_0x792395[_0xecd75(0xe9)]['replaceChild'](_0x528157,_0x792395);}document[_0xecd75(0x566)]('emoji-library-form-modal')['style']['display']=_0xecd75(0xfe9),currentEmojiLibrary=null;}async function saveEmojiLibrary(){const _0x25ee8e=_0x2cf6d4;console['log']('🔧\x20[表情包库]\x20开始保存表情包库');const _0x2d5af7=document[_0x25ee8e(0x15b8)](_0x25ee8e(0x15b9));_0x2d5af7&&(_0x2d5af7[_0x25ee8e(0x194e)]=!![],_0x2d5af7[_0x25ee8e(0x21dc)]=_0x25ee8e(0xdf2));try{const _0x3bf8e5=document[_0x25ee8e(0x566)](_0x25ee8e(0xa27)),_0xaaca5e=document['getElementById'](_0x25ee8e(0x3e0));if(!_0x3bf8e5||!_0xaaca5e)throw new Error(_0x25ee8e(0x8ab));const _0x381b31=_0x3bf8e5[_0x25ee8e(0xc34)][_0x25ee8e(0x1424)](),_0x15ff71=_0xaaca5e[_0x25ee8e(0xc34)][_0x25ee8e(0x1424)]();console[_0x25ee8e(0xc0d)]('🔧\x20[表情包库]\x20表单数据:',{'name':_0x381b31,'description':_0x15ff71,'isEdit':!!currentEmojiLibrary});if(!_0x381b31){alert('请输入库名称');return;}if(currentEmojiLibrary)console['log'](_0x25ee8e(0x67a),currentEmojiLibrary['id']),currentEmojiLibrary[_0x25ee8e(0x222f)]=_0x381b31,currentEmojiLibrary['description']=_0x15ff71,currentEmojiLibrary[_0x25ee8e(0x2222)]=new Date()[_0x25ee8e(0xa4b)](),await db[_0x25ee8e(0x19c1)][_0x25ee8e(0x53a)](currentEmojiLibrary),console[_0x25ee8e(0xc0d)](_0x25ee8e(0x225e));else{console['log'](_0x25ee8e(0x1a14));const _0x35810b={'id':_0x25ee8e(0x124d)+Date[_0x25ee8e(0x18e0)]()+'_'+Math[_0x25ee8e(0x191c)]()['toString'](0x24)[_0x25ee8e(0x18cf)](0x2,0x9),'name':_0x381b31,'description':_0x15ff71,'createdAt':new Date()['toISOString'](),'updatedAt':new Date()['toISOString']()};emojiLibraries[_0x25ee8e(0x6ee)](_0x35810b),await db[_0x25ee8e(0x19c1)][_0x25ee8e(0xe1)](_0x35810b),console[_0x25ee8e(0xc0d)](_0x25ee8e(0x1a71),_0x35810b['id']);}hideEmojiLibraryForm(),renderEmojiLibraryList(),showToast(currentEmojiLibrary?_0x25ee8e(0x1bae):_0x25ee8e(0x581),_0x25ee8e(0xb27)),console['log'](_0x25ee8e(0xfca));}catch(_0x2a4b34){console['error'](_0x25ee8e(0x1fc9),_0x2a4b34),showToast(_0x25ee8e(0x145c)+_0x2a4b34[_0x25ee8e(0xd7a)],_0x25ee8e(0x24ab));}finally{const _0x292fa2=document[_0x25ee8e(0x15b8)](_0x25ee8e(0x15b9));_0x292fa2&&(_0x292fa2[_0x25ee8e(0x194e)]=![],_0x292fa2[_0x25ee8e(0x21dc)]='保存');}}async function deleteEmojiLibrary(_0xbfec4c){const _0x512292=_0x2cf6d4,_0x1fbe92=emojiLibraries[_0x512292(0x1aeb)](_0x58c3bc=>_0x58c3bc['id']===_0xbfec4c);if(!_0x1fbe92)return;const _0x11f41f=await getEmojiLibraryItemCount(_0xbfec4c),_0xe954d8=_0x11f41f>0x0?_0x512292(0x6b9)+_0x1fbe92[_0x512292(0x222f)]+_0x512292(0x255d)+_0x11f41f+_0x512292(0x3b5):_0x512292(0x6b9)+_0x1fbe92[_0x512292(0x222f)]+'\x22吗？';if(!confirm(_0xe954d8))return;try{const _0x13d21e=await db['emojiLibraryItems'][_0x512292(0x4a6)](_0x512292(0x245b))[_0x512292(0x14a)](_0xbfec4c)[_0x512292(0x18c6)]();for(const _0x487a08 of _0x13d21e){await db[_0x512292(0x20c7)]['delete'](_0x487a08[_0x512292(0x1a7)]);}await db[_0x512292(0x156f)][_0x512292(0x4a6)]('libraryId')['equals'](_0xbfec4c)[_0x512292(0xc2b)](),await db[_0x512292(0x19c1)][_0x512292(0xc2b)](_0xbfec4c),emojiLibraries=emojiLibraries['filter'](_0x2f8dbe=>_0x2f8dbe['id']!==_0xbfec4c),renderEmojiLibraryList(),showToast(_0x512292(0xf67)+_0x11f41f+_0x512292(0x24e4),_0x512292(0xb27));}catch(_0x18acf1){console[_0x512292(0x24ab)](_0x512292(0x333),_0x18acf1),showToast(_0x512292(0x20ef),_0x512292(0x24ab));}}async function openEmojiLibrary(_0x35bf57){const _0x338d4c=_0x2cf6d4,_0x917b23=emojiLibraries[_0x338d4c(0x1aeb)](_0xe22184=>_0xe22184['id']===_0x35bf57);if(!_0x917b23)return;currentEmojiLibrary=_0x917b23,document[_0x338d4c(0x566)]('emoji-library-title')['textContent']=_0x917b23[_0x338d4c(0x222f)],showApp(_0x338d4c(0x12f5)),await loadEmojiLibraryContent(_0x35bf57);}async function loadEmojiLibraryContent(_0x2e2367){const _0x1fa962=_0x2cf6d4;try{const _0x1954b4=await db[_0x1fa962(0x156f)][_0x1fa962(0x4a6)](_0x1fa962(0x245b))[_0x1fa962(0x14a)](_0x2e2367)[_0x1fa962(0x18c6)](),_0x111133=_0x1954b4[_0x1fa962(0xf6d)](_0x1c70f5=>_0x1c70f5[_0x1fa962(0x1a7)]),_0x491743=await db['customEmojis'][_0x1fa962(0x4a6)]('id')['anyOf'](_0x111133)['toArray']();renderEmojiLibraryGrid(_0x491743);}catch(_0x840247){console[_0x1fa962(0x24ab)](_0x1fa962(0x1908),_0x840247),showToast(_0x1fa962(0x361),'error');}}function renderEmojiLibraryGrid(_0x47ccbd){const _0x4fbe3c=_0x2cf6d4,_0x49bb60=document[_0x4fbe3c(0x566)](_0x4fbe3c(0xca2)),_0x4e233e=document[_0x4fbe3c(0x566)]('emoji-library-empty'),_0x1e9e19=document['getElementById'](_0x4fbe3c(0x213f));if(_0x47ccbd[_0x4fbe3c(0xcbf)]===0x0){_0x49bb60[_0x4fbe3c(0x655)][_0x4fbe3c(0x2526)]=_0x4fbe3c(0xfe9),_0x4e233e[_0x4fbe3c(0x655)][_0x4fbe3c(0x2526)]=_0x4fbe3c(0x2d4),_0x1e9e19[_0x4fbe3c(0x655)][_0x4fbe3c(0x2526)]=_0x4fbe3c(0xfe9);return;}_0x49bb60[_0x4fbe3c(0x655)]['display']=_0x4fbe3c(0x6bb),_0x4e233e[_0x4fbe3c(0x655)][_0x4fbe3c(0x2526)]='none',_0x1e9e19[_0x4fbe3c(0x655)][_0x4fbe3c(0x2526)]=_0x4fbe3c(0x1f0b);const _0x5cc921=_0x47ccbd[_0x4fbe3c(0xcbf)],_0x1054f4=_0x47ccbd[_0x4fbe3c(0x803)](_0x45fc39=>_0x45fc39[_0x4fbe3c(0x1c6f)]&&_0x45fc39[_0x4fbe3c(0x1c6f)]!==_0x45fc39[_0x4fbe3c(0x222f)]&&_0x45fc39[_0x4fbe3c(0x1c6f)][_0x4fbe3c(0x1424)]()!=='')[_0x4fbe3c(0xcbf)],_0x5b7d61=_0x5cc921-_0x1054f4;document[_0x4fbe3c(0x566)](_0x4fbe3c(0x5dc))[_0x4fbe3c(0x21dc)]=_0x5cc921,document[_0x4fbe3c(0x566)](_0x4fbe3c(0x394))[_0x4fbe3c(0x21dc)]=_0x1054f4,document[_0x4fbe3c(0x566)](_0x4fbe3c(0x207d))['textContent']=_0x5b7d61;const _0x339b23=document[_0x4fbe3c(0x566)]('undescribed-warning');_0x5b7d61>0x0?_0x339b23[_0x4fbe3c(0x655)]['display']=_0x4fbe3c(0x2d4):_0x339b23['style']['display']=_0x4fbe3c(0xfe9),_0x49bb60[_0x4fbe3c(0xc02)]=_0x47ccbd['map'](_0x53c877=>{const _0x145261=_0x4fbe3c,_0x9762cf=_0x53c877[_0x145261(0x1c6f)]&&_0x53c877[_0x145261(0x1c6f)]!==_0x53c877['name']&&_0x53c877[_0x145261(0x1c6f)][_0x145261(0x1424)]()!=='',_0x52fc81=_0x9762cf?_0x53c877['description']:'点击添加描述';return'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22emoji-library-grid-item\x22\x20data-emoji-id=\x22'+_0x53c877['id']+_0x145261(0xe71)+_0x53c877['id']+_0x145261(0x120a)+(_0x53c877['imageData']||_0x53c877['url']||'')+_0x145261(0x1ca8)+(_0x53c877[_0x145261(0x1c6f)]||_0x53c877[_0x145261(0x222f)]||_0x145261(0x1cd2))+'\x22\x20title=\x22'+(_0x53c877[_0x145261(0x1c6f)]||_0x53c877[_0x145261(0x222f)]||_0x145261(0x1cd2))+_0x145261(0x1ce4)+_0x53c877['id']+_0x145261(0x832)+(!_0x9762cf?_0x145261(0x406):'')+_0x145261(0xc4d)+_0x53c877['id']+_0x145261(0x341)+_0x52fc81+_0x145261(0xb39)+(!_0x9762cf?_0x145261(0xf94):'✓\x20已设置描述')+_0x145261(0xfe6);})['join']('');}async function removeEmojiFromLibrary(_0x4799e1){const _0x339454=_0x2cf6d4;if(!currentEmojiLibrary)return;if(!confirm(_0x339454(0x831)))return;try{await db[_0x339454(0x156f)][_0x339454(0x4a6)](_0x339454(0xb5d))[_0x339454(0x14a)]([currentEmojiLibrary['id'],_0x4799e1])[_0x339454(0xc2b)](),await db[_0x339454(0x156f)]['where'](_0x339454(0x1a7))[_0x339454(0x14a)](_0x4799e1)['delete'](),await db[_0x339454(0x20c7)][_0x339454(0xc2b)](_0x4799e1),await db[_0x339454(0xa1f)][_0x339454(0x4a6)]('id')[_0x339454(0x14a)](_0x4799e1)[_0x339454(0xc2b)](),await loadEmojiLibraryContent(currentEmojiLibrary['id']),showToast(_0x339454(0xe51),_0x339454(0xb27));}catch(_0x34c296){console[_0x339454(0x24ab)](_0x339454(0xfad),_0x34c296),showToast(_0x339454(0x9c3),_0x339454(0x24ab));}}async function editEmojiDescription(_0x3d1743){const _0x52853c=_0x2cf6d4,_0x446957=await db[_0x52853c(0x20c7)][_0x52853c(0x46a)](_0x3d1743);if(!_0x446957)return;const _0x2de58c=document[_0x52853c(0x566)](_0x52853c(0x1000));_0x2de58c&&_0x2de58c[_0x52853c(0x128)]();const _0x58b77a=_0x446957['description']&&_0x446957[_0x52853c(0x1c6f)]!==_0x446957['name']?_0x446957['description']:'',_0x25ef91=document[_0x52853c(0x1ad8)]('div');_0x25ef91['id']=_0x52853c(0x1000),_0x25ef91[_0x52853c(0x221)]=_0x52853c(0x12a0),_0x25ef91['style'][_0x52853c(0x2526)]='flex',_0x25ef91[_0x52853c(0xc02)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22\x20style=\x22max-width:\x20400px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3>编辑表情包描述</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-close-btn\x22\x20onclick=\x22closeEmojiDescriptionModal()\x22>×</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22emoji-preview\x22\x20style=\x22text-align:\x20center;\x20margin-bottom:\x2015px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22'+(_0x446957['imageData']||_0x446957[_0x52853c(0x10c6)]||'')+'\x22\x20alt=\x22表情包预览\x22\x20style=\x22max-width:\x2080px;\x20max-height:\x2080px;\x20border-radius:\x208px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22form-label\x22>表情包描述</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22emoji-description-input\x22\x20class=\x22form-textarea\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20placeholder=\x22请描述这个表情包的含义、情绪或使用场景，帮助AI理解何时使用...\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20rows=\x223\x22\x20maxlength=\x22100\x22>'+_0x58b77a+_0x52853c(0xf08)+_0x3d1743+_0x52853c(0x1536),document['body'][_0x52853c(0x1925)](_0x25ef91),setTimeout(()=>{const _0x53c453=_0x52853c,_0x3651b0=document[_0x53c453(0x566)]('emoji-description-input');_0x3651b0&&(_0x3651b0[_0x53c453(0x1b12)](),_0x3651b0[_0x53c453(0x5f1)](_0x3651b0[_0x53c453(0xc34)][_0x53c453(0xcbf)],_0x3651b0[_0x53c453(0xc34)][_0x53c453(0xcbf)]));},0x64);}function closeEmojiDescriptionModal(){const _0x3d7e55=_0x2cf6d4,_0x3c1601=document[_0x3d7e55(0x566)](_0x3d7e55(0x1000));_0x3c1601&&_0x3c1601[_0x3d7e55(0x128)]();}async function saveEmojiDescription(_0x29f8f2){const _0x5819bb=_0x2cf6d4,_0x5775e3=document[_0x5819bb(0x566)]('emoji-description-input');if(!_0x5775e3){console['error'](_0x5819bb(0x1d2b)),showToast(_0x5819bb(0x1cd1),'error');return;}const _0x18be9a=_0x5775e3[_0x5819bb(0xc34)]['trim']();if(!_0x18be9a){alert(_0x5819bb(0x1568));return;}try{const _0x3d7971=await db[_0x5819bb(0x20c7)][_0x5819bb(0x46a)](_0x29f8f2);if(_0x3d7971){_0x3d7971[_0x5819bb(0x1c6f)]=_0x18be9a;if(_0x3d7971[_0x5819bb(0xd6e)]!==![]){const _0x39585d=customEmojis[_0x5819bb(0x1aeb)](_0x2e5beb=>_0x2e5beb['id']===_0x29f8f2);_0x39585d&&(_0x39585d[_0x5819bb(0x1c6f)]=_0x18be9a);}await db[_0x5819bb(0x20c7)][_0x5819bb(0x53a)](_0x3d7971),currentEmojiLibrary&&await loadEmojiLibraryContent(currentEmojiLibrary['id']),showToast(_0x5819bb(0x1257),_0x5819bb(0xb27)),closeEmojiDescriptionModal();}else showToast('找不到对应的表情包','error');}catch(_0x1a5e49){console[_0x5819bb(0x24ab)](_0x5819bb(0x1352),_0x1a5e49),showToast(_0x5819bb(0x857),_0x5819bb(0x24ab));}}function hideEmojiLibraryScreen(){const _0x5e931b=_0x2cf6d4;hideApp('emoji-library-screen'),currentEmojiLibrary=null,showApp(_0x5e931b(0xa76)),switchChatTab(_0x5e931b(0x10de));}function triggerEmojiUpload(){const _0x3e1d84=_0x2cf6d4;document['getElementById']('emoji-library-upload')[_0x3e1d84(0x1e62)]();}async function deleteCurrentEmojiLibrary(){const _0x54f23c=_0x2cf6d4;if(!currentEmojiLibrary)return;const _0x59fdf3=await getEmojiLibraryItemCount(currentEmojiLibrary['id']),_0x346d0f=_0x59fdf3>0x0?_0x54f23c(0x6b9)+currentEmojiLibrary['name']+_0x54f23c(0x255d)+_0x59fdf3+_0x54f23c(0x3b5):_0x54f23c(0x6b9)+currentEmojiLibrary[_0x54f23c(0x222f)]+_0x54f23c(0x2032);if(confirm(_0x346d0f))try{const _0x2c7990=await db['emojiLibraryItems']['where'](_0x54f23c(0x245b))[_0x54f23c(0x14a)](currentEmojiLibrary['id'])[_0x54f23c(0x18c6)]();for(const _0x2c2044 of _0x2c7990){await db[_0x54f23c(0x20c7)][_0x54f23c(0xc2b)](_0x2c2044[_0x54f23c(0x1a7)]);}await db['emojiLibraryItems'][_0x54f23c(0x4a6)](_0x54f23c(0x245b))[_0x54f23c(0x14a)](currentEmojiLibrary['id'])['delete'](),await db['emojiLibraries'][_0x54f23c(0xc2b)](currentEmojiLibrary['id']),showToast('表情包库删除成功，已释放\x20'+_0x59fdf3+_0x54f23c(0x24e4),_0x54f23c(0xb27)),showEmojiLibraryList();}catch(_0x542378){console[_0x54f23c(0x24ab)]('删除表情包库失败:',_0x542378),showToast(_0x54f23c(0x20ef),_0x54f23c(0x24ab));}}function initEmojiLibraryUpload(){const _0x172895=_0x2cf6d4,_0x5627f1=document[_0x172895(0x566)](_0x172895(0x17be)),_0x691c46=document[_0x172895(0x566)](_0x172895(0x1550)),_0x48eae3=document[_0x172895(0x566)](_0x172895(0x1ef4));_0x5627f1&&_0x5627f1[_0x172895(0x167)](_0x172895(0x17ef),handleEmojiLibraryUpload),_0x48eae3&&_0x48eae3[_0x172895(0x167)](_0x172895(0x17ef),function(_0x38f7ed){const _0x488b23=_0x172895,_0x4b4290=_0x38f7ed[_0x488b23(0x1144)][_0x488b23(0x173e)][0x0];_0x4b4290&&importEmojiLibrary(_0x4b4290),_0x38f7ed[_0x488b23(0x1144)][_0x488b23(0xc34)]='';}),initUrlInputEvents(),_0x691c46&&(_0x691c46['addEventListener'](_0x172895(0x14cc),_0x15d384=>{const _0x19ccee=_0x172895;_0x15d384[_0x19ccee(0x4d9)](),_0x691c46['classList']['add'](_0x19ccee(0x14cc));}),_0x691c46[_0x172895(0x167)](_0x172895(0x1ee),_0x20075f=>{const _0x406eb5=_0x172895;_0x20075f[_0x406eb5(0x4d9)](),_0x691c46[_0x406eb5(0x226e)]['remove']('dragover');}),_0x691c46[_0x172895(0x167)](_0x172895(0x16dd),_0x41c5a7=>{const _0x5813f5=_0x172895;_0x41c5a7['preventDefault'](),_0x691c46['classList'][_0x5813f5(0x128)](_0x5813f5(0x14cc));const _0x35e021=Array[_0x5813f5(0x2308)](_0x41c5a7[_0x5813f5(0xc61)]['files'])[_0x5813f5(0x803)](_0x151ee6=>_0x151ee6[_0x5813f5(0x23df)]['startsWith'](_0x5813f5(0x1183)));_0x35e021[_0x5813f5(0xcbf)]>0x0&&processEmojiFiles(_0x35e021);}));}async function handleEmojiLibraryUpload(_0x40b227){const _0x2126b9=_0x2cf6d4,_0x25cfd0=Array[_0x2126b9(0x2308)](_0x40b227[_0x2126b9(0x1144)][_0x2126b9(0x173e)]);if(_0x25cfd0[_0x2126b9(0xcbf)]===0x0)return;await processEmojiFiles(_0x25cfd0),_0x40b227[_0x2126b9(0x1144)][_0x2126b9(0xc34)]='';}function _0x3a81(_0x4db18a,_0x465424){const _0x353ce3=_0x353c();return _0x3a81=function(_0x3a81bc,_0x5b2fd2){_0x3a81bc=_0x3a81bc-0x9a;let _0x3d1d47=_0x353ce3[_0x3a81bc];return _0x3d1d47;},_0x3a81(_0x4db18a,_0x465424);}async function processEmojiFiles(_0xd45a19){const _0x571d43=_0x2cf6d4;if(!currentEmojiLibrary){showToast('请先选择一个表情包库',_0x571d43(0x24ab));return;}const _0x2eadda=_0xd45a19[_0x571d43(0x803)](_0x23426c=>_0x23426c['type'][_0x571d43(0x1cab)]('image/'));if(_0x2eadda[_0x571d43(0xcbf)]===0x0){showToast(_0x571d43(0x1314),_0x571d43(0x24ab));return;}let _0x227e80=0x0,_0x58d84c=0x0;for(const _0x3728ba of _0x2eadda){try{await uploadEmojiToLibrary(_0x3728ba),_0x227e80++;}catch(_0x4b5aae){console[_0x571d43(0x24ab)](_0x571d43(0x128f),_0x4b5aae),_0x58d84c++;}}_0x227e80>0x0&&(showToast(_0x571d43(0x293)+_0x227e80+_0x571d43(0x1b50),_0x571d43(0xb27)),await loadEmojiLibraryContent(currentEmojiLibrary['id'])),_0x58d84c>0x0&&showToast(_0x58d84c+'\x20个文件上传失败',_0x571d43(0x24ab));}async function uploadEmojiToLibrary(_0x41812f){return new Promise((_0x56897e,_0x4a9a68)=>{const _0x432416=_0x3a81,_0x538781=new FileReader();_0x538781[_0x432416(0xc28)]=async _0x597111=>{const _0x40a979=_0x432416;try{const _0x3db17a=_0x597111[_0x40a979(0x1144)][_0x40a979(0x1fff)],_0x5964d3={'id':_0x40a979(0x48e)+Date[_0x40a979(0x18e0)]()+'_'+Math['random']()['toString'](0x24)['substr'](0x2,0x9),'name':_0x41812f[_0x40a979(0x222f)][_0x40a979(0x633)]('.')[0x0],'description':'','url':_0x3db17a,'category':_0x40a979(0x13a8),'uploadTime':new Date()[_0x40a979(0xa4b)](),'isPersonal':![]};await db[_0x40a979(0x20c7)]['add'](_0x5964d3);const _0x270258={'libraryId':currentEmojiLibrary['id'],'emojiId':_0x5964d3['id'],'addedAt':new Date()[_0x40a979(0xa4b)]()};await db[_0x40a979(0x156f)][_0x40a979(0xe1)](_0x270258),_0x56897e(_0x5964d3);}catch(_0x58c078){_0x4a9a68(_0x58c078);}},_0x538781['onerror']=()=>_0x4a9a68(new Error(_0x432416(0x140e))),_0x538781[_0x432416(0x145e)](_0x41812f);});}function showEmojiLibraryMountSettings(){const _0x518362=_0x2cf6d4;console[_0x518362(0xc0d)](_0x518362(0xea5));if(!currentChatCharacter){console[_0x518362(0xc0d)]('No\x20current\x20chat\x20character');return;}const _0x186944=getCurrentChatSettings();console[_0x518362(0xc0d)]('Chat\x20settings:',_0x186944),document['getElementById']('emoji-library-mount-enabled')[_0x518362(0x306)]=_0x186944['emojiLibraryMountEnabled']||![],renderEmojiLibraryMountList(),toggleEmojiLibraryMountDetails(),console[_0x518362(0xc0d)](_0x518362(0xbf2)),showModal('emoji-library-mount-modal'),console[_0x518362(0xc0d)](_0x518362(0x2020));}function toggleEmojiLibraryMountDetails(){const _0x125d4f=_0x2cf6d4,_0x4bf1d0=document[_0x125d4f(0x566)]('emoji-library-mount-enabled')[_0x125d4f(0x306)];document[_0x125d4f(0x566)](_0x125d4f(0x9e2))[_0x125d4f(0x655)][_0x125d4f(0x2526)]=_0x4bf1d0?_0x125d4f(0x2d4):'none',updateEmojiLibraryMountDisplay();}function renderEmojiLibraryMountList(){const _0x12757c=_0x2cf6d4,_0x7a21b2=document[_0x12757c(0x566)](_0x12757c(0x198f));if(!_0x7a21b2)return;if(emojiLibraries[_0x12757c(0xcbf)]===0x0){_0x7a21b2[_0x12757c(0xc02)]=_0x12757c(0x1912);return;}const _0x337923=getCurrentChatSettings(),_0x2cce3a=_0x337923[_0x12757c(0x3db)]||[];_0x7a21b2[_0x12757c(0xc02)]=emojiLibraries[_0x12757c(0xf6d)](_0x4e83be=>_0x12757c(0x1fa5)+_0x4e83be['id']+_0x12757c(0x24d3)+(_0x2cce3a['includes'](_0x4e83be['id'])?_0x12757c(0x306):'')+_0x12757c(0xa66)+_0x4e83be[_0x12757c(0x222f)]+_0x12757c(0x920)+(_0x4e83be[_0x12757c(0x1c6f)]||_0x12757c(0x185c))+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20')[_0x12757c(0x140c)]('');}function updateEmojiLibraryMountDisplay(){const _0x4b47dc=_0x2cf6d4,_0x267a3f=document[_0x4b47dc(0x566)](_0x4b47dc(0x1a5a));if(!_0x267a3f)return;const _0x1104d4=getCurrentChatSettings(),_0x57fcbd=_0x1104d4['emojiLibraryMountEnabled']||![],_0x20a85d=_0x1104d4['selectedEmojiLibraries']||[];if(!_0x57fcbd){_0x267a3f[_0x4b47dc(0x21dc)]=_0x4b47dc(0x1d80),_0x267a3f['style']['color']=_0x4b47dc(0x150e);return;}if(_0x20a85d['length']===0x0){_0x267a3f[_0x4b47dc(0x21dc)]='已启用，未选择库',_0x267a3f['style']['color']=_0x4b47dc(0x111d);return;}const _0x50d6ed=_0x20a85d[_0x4b47dc(0xf6d)](_0x151188=>{const _0x64d80=_0x4b47dc,_0x59d408=emojiLibraries[_0x64d80(0x1aeb)](_0x4b4b8b=>_0x4b4b8b['id']===_0x151188);return _0x59d408?_0x59d408['name']:'未知库';});_0x50d6ed[_0x4b47dc(0xcbf)]===0x1?_0x267a3f[_0x4b47dc(0x21dc)]=_0x50d6ed[0x0]:_0x267a3f[_0x4b47dc(0x21dc)]=_0x50d6ed[_0x4b47dc(0xcbf)]+'个库',_0x267a3f['style'][_0x4b47dc(0x2099)]='';}async function saveEmojiLibraryMountSettings(){const _0x22f54a=_0x2cf6d4;if(!currentChatCharacter)return;const _0x149884=getCurrentChatSettings();_0x149884[_0x22f54a(0xf0b)]=document[_0x22f54a(0x566)](_0x22f54a(0x1084))[_0x22f54a(0x306)];const _0x511887=document[_0x22f54a(0x1ed9)](_0x22f54a(0xcfc));_0x149884[_0x22f54a(0x3db)]=Array[_0x22f54a(0x2308)](_0x511887)['map'](_0x3a9818=>_0x3a9818[_0x22f54a(0xc34)]),await saveCurrentChatSettings(_0x149884),updateEmojiLibraryMountDisplay(),hideModal('emoji-library-mount-modal');const _0x525779=_0x149884[_0x22f54a(0x3db)]?_0x149884[_0x22f54a(0x3db)]['length']:0x0;if(_0x149884[_0x22f54a(0xf0b)]&&_0x525779>0x0)showToast(_0x22f54a(0x2500)+_0x525779+_0x22f54a(0x241c),_0x22f54a(0xb27)),document[_0x22f54a(0x566)]('custom-emoji-panel')[_0x22f54a(0x655)][_0x22f54a(0x2526)]===_0x22f54a(0x2d4)&&renderEmojiGrid();else _0x149884['emojiLibraryMountEnabled']?showToast(_0x22f54a(0x1dc1),_0x22f54a(0x2422)):showToast(_0x22f54a(0x1d2a),'info');}async function getFilteredEmojis(_0x3c6ba5){const _0x1a8caf=_0x2cf6d4;if(currentEmojiTab===_0x1a8caf(0x1274))return _0x3c6ba5;else{if(currentEmojiTab==='custom'){let _0x5db070=_0x3c6ba5[_0x1a8caf(0x803)](_0x1ef299=>_0x1ef299[_0x1a8caf(0xd6e)]!==![]);const _0x29af2d=getCurrentChatSettings();if(_0x29af2d[_0x1a8caf(0xf0b)]&&_0x29af2d[_0x1a8caf(0x3db)]&&_0x29af2d['selectedEmojiLibraries']['length']>0x0)for(const _0x827d12 of _0x29af2d[_0x1a8caf(0x3db)]){try{const _0x5d567b=await getLibraryEmojis(_0x827d12);_0x5db070=_0x5db070[_0x1a8caf(0x1fa8)](_0x5d567b);}catch(_0x519792){console['error'](_0x1a8caf(0x1616),_0x519792);}}return _0x5db070;}}return _0x3c6ba5[_0x1a8caf(0x803)](_0x5dd8e8=>_0x5dd8e8[_0x1a8caf(0xd6e)]!==![]);}async function getLibraryEmojis(_0x3aeaad){const _0x3e096f=_0x2cf6d4;try{const _0x2044ea=await db['emojiLibraryItems'][_0x3e096f(0x4a6)](_0x3e096f(0x245b))[_0x3e096f(0x14a)](_0x3aeaad)['toArray'](),_0x449ec3=[];for(const _0x2d64bb of _0x2044ea){const _0x56c635=await db[_0x3e096f(0x20c7)][_0x3e096f(0x46a)](_0x2d64bb['emojiId']);_0x56c635&&_0x449ec3[_0x3e096f(0x6ee)](_0x56c635);}return _0x449ec3;}catch(_0x29cd45){return console[_0x3e096f(0x24ab)](_0x3e096f(0x1616),_0x29cd45),[];}}async function cleanupEmojiLibraryItems(){const _0xa56f91=_0x2cf6d4;try{console['log'](_0xa56f91(0x2307));const _0x3a1cde=await db[_0xa56f91(0x156f)]['toArray']();console[_0xa56f91(0xc0d)](_0xa56f91(0x16f1),_0x3a1cde[_0xa56f91(0xcbf)]);const _0x101e8e=[];for(const _0x502af8 of _0x3a1cde){const _0x114c60=await db['customEmojis']['get'](_0x502af8['emojiId']);!_0x114c60&&_0x101e8e[_0xa56f91(0x6ee)](_0x502af8);}console['log'](_0xa56f91(0x376),_0x101e8e[_0xa56f91(0xcbf)]);if(_0x101e8e[_0xa56f91(0xcbf)]>0x0){const _0x2be60d=_0x101e8e[_0xa56f91(0xf6d)](_0x1db77f=>_0x1db77f['id']);await db[_0xa56f91(0x156f)][_0xa56f91(0xf71)](_0x2be60d),console[_0xa56f91(0xc0d)](_0xa56f91(0x6f5),_0x2be60d);}return _0x101e8e['length'];}catch(_0x2038ef){return console[_0xa56f91(0x24ab)](_0xa56f91(0x79d),_0x2038ef),0x0;}}async function exportEmojiLibrary(_0x33d039){const _0x111fd4=_0x2cf6d4;try{const _0x1ba897=emojiLibraries['find'](_0x2e0c0b=>_0x2e0c0b['id']===_0x33d039);if(!_0x1ba897){showToast(_0x111fd4(0x1692),_0x111fd4(0x24ab));return;}showToast(_0x111fd4(0xc39),_0x111fd4(0x2422));const _0x59131a=await db[_0x111fd4(0x156f)][_0x111fd4(0x4a6)](_0x111fd4(0x245b))[_0x111fd4(0x14a)](_0x33d039)[_0x111fd4(0x18c6)](),_0x3fd1a3=_0x59131a['map'](_0x4d411a=>_0x4d411a[_0x111fd4(0x1a7)]),_0x439b8b=await db[_0x111fd4(0x20c7)]['where']('id')[_0x111fd4(0xe07)](_0x3fd1a3)[_0x111fd4(0x18c6)](),_0x49b9b9={'version':_0x111fd4(0xf59),'exportTime':new Date()[_0x111fd4(0xa4b)](),'library':_0x1ba897,'emojis':_0x439b8b,'libraryItems':_0x59131a},_0x1b3b1b=_0x111fd4(0x1b1d)+_0x1ba897[_0x111fd4(0x222f)]+'_'+new Date()[_0x111fd4(0xa4b)]()[_0x111fd4(0x633)]('T')[0x0]+_0x111fd4(0x539),_0x5b2e62=JSON[_0x111fd4(0x7fb)](_0x49b9b9,null,0x2),_0x3c9af6=new Blob([_0x5b2e62],{'type':_0x111fd4(0x179f)}),_0x36ea98=URL[_0x111fd4(0x17c3)](_0x3c9af6),_0x110329=document[_0x111fd4(0x1ad8)]('a');_0x110329['href']=_0x36ea98,_0x110329['download']=_0x1b3b1b,document[_0x111fd4(0x172c)][_0x111fd4(0x1925)](_0x110329),_0x110329[_0x111fd4(0x1e62)](),document[_0x111fd4(0x172c)][_0x111fd4(0x1624)](_0x110329),URL[_0x111fd4(0x2101)](_0x36ea98),showToast(_0x111fd4(0x1af6)+_0x1ba897[_0x111fd4(0x222f)]+_0x111fd4(0xfec)+_0x439b8b[_0x111fd4(0xcbf)]+'\x20个表情包',_0x111fd4(0xb27));}catch(_0x4519d6){console[_0x111fd4(0x24ab)](_0x111fd4(0x237b),_0x4519d6),showToast(_0x111fd4(0x133e),_0x111fd4(0x24ab));}}function showImportEmojiLibraryDialog(){const _0x154cd5=_0x2cf6d4;document['getElementById'](_0x154cd5(0x1ef4))[_0x154cd5(0x1e62)]();}async function importEmojiLibrary(_0x4f6e04){const _0x14f833=_0x2cf6d4;try{showToast('正在导入表情包库...','info');const _0x581f82=await _0x4f6e04[_0x14f833(0x1e58)](),_0x28c904=JSON['parse'](_0x581f82);if(!_0x28c904[_0x14f833(0x21bd)]||!_0x28c904[_0x14f833(0x1e9c)]||!_0x28c904[_0x14f833(0xb80)])throw new Error(_0x14f833(0x1704));const _0xef3932=_0x28c904['library'],_0x5789c1=_0x28c904[_0x14f833(0x1e9c)],_0x130e03=_0x28c904[_0x14f833(0xb80)],_0x4b1247=emojiLibraries[_0x14f833(0x1aeb)](_0x540cf0=>_0x540cf0['name']===_0xef3932[_0x14f833(0x222f)]);let _0x1254ab=![];_0x4b1247&&(_0x1254ab=confirm(_0x14f833(0x20be)+_0xef3932[_0x14f833(0x222f)]+_0x14f833(0x5c1)+'点击\x22确定\x22覆盖现有库\x0a'+'点击\x22取消\x22重命名导入库'),!_0x1254ab?(_0xef3932[_0x14f833(0x222f)]=_0xef3932[_0x14f833(0x222f)]+_0x14f833(0x12b2)+Date[_0x14f833(0x18e0)](),_0xef3932['id']=_0x14f833(0x124d)+Date[_0x14f833(0x18e0)]()+'_'+Math[_0x14f833(0x191c)]()[_0x14f833(0x9a3)](0x24)[_0x14f833(0x18cf)](0x2,0x9)):(_0xef3932['id']=_0x4b1247['id'],await db[_0x14f833(0x156f)]['where']('libraryId')[_0x14f833(0x14a)](_0x4b1247['id'])['delete']()));for(const _0x848918 of _0x5789c1){const _0x5d61ba=await db[_0x14f833(0x20c7)][_0x14f833(0x46a)](_0x848918['id']);!_0x5d61ba&&await db[_0x14f833(0x20c7)][_0x14f833(0xe1)](_0x848918);}_0x1254ab&&_0x4b1247?await db[_0x14f833(0x19c1)][_0x14f833(0x53a)](_0xef3932):(await db[_0x14f833(0x19c1)][_0x14f833(0xe1)](_0xef3932),emojiLibraries['push'](_0xef3932));const _0x50f3bb=_0x130e03['map'](_0x58a19c=>({..._0x58a19c,'libraryId':_0xef3932['id']}));try{await db[_0x14f833(0x156f)]['bulkPut'](_0x50f3bb);}catch(_0x1c3ab0){console[_0x14f833(0x17cc)](_0x14f833(0x88f),_0x1c3ab0);let _0x3aeae6=0x0;for(const _0x10b271 of _0x50f3bb){try{await db[_0x14f833(0x156f)][_0x14f833(0x53a)](_0x10b271),_0x3aeae6++;}catch(_0x5927d9){console[_0x14f833(0x17cc)](_0x14f833(0x13e8),_0x10b271,_0x5927d9);}}console[_0x14f833(0xc0d)](_0x14f833(0xf85)+_0x3aeae6+'/'+_0x50f3bb[_0x14f833(0xcbf)]+_0x14f833(0xe6d));}await loadEmojiLibraries(),showToast('表情包库\x22'+_0xef3932['name']+_0x14f833(0x1dd8)+_0x5789c1[_0x14f833(0xcbf)]+'\x20个表情包',_0x14f833(0xb27));}catch(_0x37fa5c){console['error'](_0x14f833(0x2305),_0x37fa5c),showToast('导入失败：'+_0x37fa5c[_0x14f833(0xd7a)],_0x14f833(0x24ab));}}async function addEmojiFromUrl(){const _0x587ea7=_0x2cf6d4,_0x191da7=document['getElementById'](_0x587ea7(0xa38)),_0xfe7be3=_0x191da7['value'][_0x587ea7(0x1424)]();if(!_0xfe7be3){showToast(_0x587ea7(0x103),_0x587ea7(0x13bb));return;}try{new URL(_0xfe7be3);}catch(_0xaa92e1){showToast(_0x587ea7(0x1279),_0x587ea7(0x24ab));return;}const _0x19c0cc=[_0x587ea7(0x19d6),_0x587ea7(0x101c),_0x587ea7(0x1050),_0x587ea7(0x12f2),_0x587ea7(0xbeb),_0x587ea7(0x15c7)],_0x29fb94=_0x19c0cc['some'](_0x6f2b1e=>_0xfe7be3[_0x587ea7(0x1d64)]()[_0x587ea7(0x23ec)](_0x6f2b1e)||_0xfe7be3[_0x587ea7(0x1d64)]()[_0x587ea7(0xd7e)](_0x6f2b1e));if(!_0x29fb94&&!_0xfe7be3[_0x587ea7(0x23ec)](_0x587ea7(0xd48))&&!_0xfe7be3[_0x587ea7(0x23ec)](_0x587ea7(0x1e14))&&!_0xfe7be3['includes'](_0x587ea7(0x13e9))){const _0x22a2c9=confirm(_0x587ea7(0x1242));if(!_0x22a2c9)return;}try{showToast('正在添加表情包...','info');const _0xd35949=new Image();_0xd35949[_0x587ea7(0x4c9)]=_0x587ea7(0xb99);const _0x34a242=new Promise((_0x1896b5,_0x4b223a)=>{const _0x3ec424=_0x587ea7;_0xd35949[_0x3ec424(0xc28)]=()=>_0x1896b5(_0xd35949),_0xd35949[_0x3ec424(0x1795)]=()=>_0x4b223a(new Error(_0x3ec424(0x1547))),setTimeout(()=>_0x4b223a(new Error(_0x3ec424(0x1d1c))),0x2710);});_0xd35949[_0x587ea7(0x107)]=_0xfe7be3,await _0x34a242;const _0x2a2b69='emoji_'+Date['now']()+'_'+Math[_0x587ea7(0x191c)]()['toString'](0x24)[_0x587ea7(0x18cf)](0x2,0x9),_0x5c4e4a=_0xfe7be3['split']('/')['pop']()||'emoji',_0x6a4fc4=_0x5c4e4a['split']('.')[0x0]||_0x587ea7(0x1f41),_0x5451a2={'id':_0x2a2b69,'name':_0x6a4fc4,'category':_0x587ea7(0x10c6),'imageData':_0xfe7be3,'isPersonal':![],'isUrl':!![],'originalUrl':_0xfe7be3,'addedTime':Date[_0x587ea7(0x18e0)]()};await db[_0x587ea7(0x20c7)]['add'](_0x5451a2),currentEmojiLibrary&&(await db[_0x587ea7(0x156f)]['add']({'libraryId':currentEmojiLibrary['id'],'emojiId':_0x2a2b69,'addedAt':Date['now']()}),await loadEmojiLibraryContent(currentEmojiLibrary['id'])),_0x191da7['value']='',showToast(_0x587ea7(0x1743),_0x587ea7(0xb27));}catch(_0x5c0106){console[_0x587ea7(0x24ab)](_0x587ea7(0x78c),_0x5c0106),showToast(_0x587ea7(0x7d2)+_0x5c0106[_0x587ea7(0xd7a)],_0x587ea7(0x24ab));}}function switchUrlInputMode(_0x34d846){const _0x1f8917=_0x2cf6d4,_0x90c0bd=document[_0x1f8917(0x566)]('single-mode-btn'),_0x11ae4e=document[_0x1f8917(0x566)](_0x1f8917(0xf93)),_0x248c33=document[_0x1f8917(0x566)]('single-url-input'),_0x14ffe3=document[_0x1f8917(0x566)](_0x1f8917(0x1c69));_0x34d846==='single'?(_0x90c0bd['classList']['add'](_0x1f8917(0x105d)),_0x11ae4e['classList']['remove'](_0x1f8917(0x105d)),_0x248c33[_0x1f8917(0x655)]['display']=_0x1f8917(0x2d4),_0x14ffe3['style'][_0x1f8917(0x2526)]=_0x1f8917(0xfe9)):(_0x90c0bd[_0x1f8917(0x226e)][_0x1f8917(0x128)](_0x1f8917(0x105d)),_0x11ae4e[_0x1f8917(0x226e)]['add'](_0x1f8917(0x105d)),_0x248c33[_0x1f8917(0x655)][_0x1f8917(0x2526)]=_0x1f8917(0xfe9),_0x14ffe3[_0x1f8917(0x655)][_0x1f8917(0x2526)]=_0x1f8917(0x2d4));}function parseBatchEmojiInput(_0x52220f){const _0x8925ef=_0x2cf6d4,_0x16f6a3=_0x52220f[_0x8925ef(0x633)]('\x0a')[_0x8925ef(0xf6d)](_0xc2a2b8=>_0xc2a2b8[_0x8925ef(0x1424)]())['filter'](_0x5daf00=>_0x5daf00),_0x3db9f0=[];let _0x375bf4='';for(const _0x599f4b of _0x16f6a3){if(_0x599f4b[_0x8925ef(0x23ec)](_0x8925ef(0x246d))&&(_0x599f4b[_0x8925ef(0x23ec)](_0x8925ef(0x22a7))||_0x599f4b[_0x8925ef(0xd7e)]('/'))){_0x375bf4=_0x599f4b[_0x8925ef(0x882)](_0x8925ef(0x22a7),'')[_0x8925ef(0x1424)]();if(!_0x375bf4[_0x8925ef(0xd7e)]('/'))_0x375bf4+='/';continue;}let _0x5f1772='',_0x1c06b7='';if(_0x599f4b['includes']('：')){const _0x3c05f2=_0x599f4b[_0x8925ef(0x633)]('：');_0x5f1772=_0x3c05f2[0x0][_0x8925ef(0x1424)](),_0x1c06b7=_0x3c05f2[0x1]['trim']();}else{if(_0x599f4b[_0x8925ef(0x23ec)]('\x20')&&!_0x599f4b['includes']('://')){const _0x5bda00=_0x599f4b[_0x8925ef(0x174d)]('\x20');_0x5f1772=_0x599f4b[_0x8925ef(0x4b2)](0x0,_0x5bda00)['trim'](),_0x1c06b7=_0x599f4b['substring'](_0x5bda00+0x1)['trim']();}else{if(_0x599f4b[_0x8925ef(0x23ec)](_0x8925ef(0x246d))){_0x1c06b7=_0x599f4b;const _0x3f45e6=_0x599f4b['split']('/')[_0x8925ef(0x1d5d)]()||_0x8925ef(0x1f41);_0x5f1772=_0x3f45e6[_0x8925ef(0x633)]('.')[0x0]||_0x8925ef(0x1f41);}}}if(_0x5f1772&&_0x1c06b7){let _0xa15421=_0x1c06b7;_0x375bf4&&!_0x1c06b7[_0x8925ef(0x23ec)]('://')&&(_0xa15421=_0x375bf4+_0x1c06b7),_0x3db9f0[_0x8925ef(0x6ee)]({'description':_0x5f1772,'url':_0xa15421,'originalLine':_0x599f4b});}}return _0x3db9f0;}function previewBatchEmojis(){const _0x522913=_0x2cf6d4,_0x3c871c=document[_0x522913(0x566)](_0x522913(0x834)),_0x318e6a=_0x3c871c[_0x522913(0xc34)][_0x522913(0x1424)]();if(!_0x318e6a){showToast(_0x522913(0x23ef),_0x522913(0x13bb));return;}const _0xbf5e1a=parseBatchEmojiInput(_0x318e6a);if(_0xbf5e1a[_0x522913(0xcbf)]===0x0){showToast(_0x522913(0x20e5),'error');return;}let _0x89a910=_0x522913(0xddd)+_0xbf5e1a[_0x522913(0xcbf)]+_0x522913(0x7de);_0xbf5e1a[_0x522913(0x900)]((_0x56bab4,_0x629ec6)=>{const _0x192411=_0x522913;_0x89a910+=_0x192411(0xf6b)+(_0x629ec6+0x1)+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22preview-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22preview-description\x22>'+_0x56bab4['description']+_0x192411(0x1cd3)+_0x56bab4['url']+_0x192411(0x22ed)+_0x56bab4[_0x192411(0x10c6)]+_0x192411(0x1ca8)+_0x56bab4['description']+_0x192411(0x4cf);}),_0x89a910+=_0x522913(0x6c2);const _0x5cf43b=document[_0x522913(0x1ad8)](_0x522913(0x526));_0x5cf43b['id']=_0x522913(0x2324),_0x5cf43b[_0x522913(0xc02)]=_0x89a910,document[_0x522913(0x172c)][_0x522913(0x1925)](_0x5cf43b),window[_0x522913(0x1948)]=_0xbf5e1a;}function closeBatchPreview(){const _0x18afa4=_0x2cf6d4,_0x5dd761=document[_0x18afa4(0x566)](_0x18afa4(0x2324));_0x5dd761&&_0x5dd761[_0x18afa4(0x128)](),window['batchEmojiData']=null;}async function confirmBatchImport(){const _0x20d922=_0x2cf6d4;if(!window[_0x20d922(0x1948)])return;closeBatchPreview(),await importBatchEmojisFromData(window[_0x20d922(0x1948)]);}async function importBatchEmojis(){const _0x3c5aa5=_0x2cf6d4,_0x4dacef=document[_0x3c5aa5(0x566)]('batch-emoji-input'),_0x494e18=_0x4dacef['value'][_0x3c5aa5(0x1424)]();if(!_0x494e18){showToast(_0x3c5aa5(0x23ef),'warning');return;}const _0x54267a=parseBatchEmojiInput(_0x494e18);if(_0x54267a['length']===0x0){showToast(_0x3c5aa5(0x20e5),_0x3c5aa5(0x24ab));return;}await importBatchEmojisFromData(_0x54267a);}async function importBatchEmojisFromData(_0x3d6ee0){const _0x36918a=_0x2cf6d4;try{showToast('开始批量导入\x20'+_0x3d6ee0[_0x36918a(0xcbf)]+_0x36918a(0x3ce),'info');let _0x32b6b8=0x0,_0x4f3a18=0x0;const _0x1d7066=[];for(let _0xa30e2d=0x0;_0xa30e2d<_0x3d6ee0[_0x36918a(0xcbf)];_0xa30e2d++){const _0x4f090e=_0x3d6ee0[_0xa30e2d];try{showToast(_0x36918a(0x1e24)+(_0xa30e2d+0x1)+'/'+_0x3d6ee0[_0x36918a(0xcbf)]+':\x20'+_0x4f090e['description'],'info');const _0x41cf62=new Image();_0x41cf62[_0x36918a(0x4c9)]=_0x36918a(0xb99);const _0x367ccd=new Promise((_0x3e457c,_0x1927bb)=>{const _0x1c6217=_0x36918a;_0x41cf62[_0x1c6217(0xc28)]=()=>_0x3e457c(_0x41cf62),_0x41cf62[_0x1c6217(0x1795)]=()=>_0x1927bb(new Error('图片加载失败')),setTimeout(()=>_0x1927bb(new Error(_0x1c6217(0x1d1c))),0x1f40);});_0x41cf62[_0x36918a(0x107)]=_0x4f090e[_0x36918a(0x10c6)],await _0x367ccd;const _0x423524=_0x36918a(0x48e)+Date[_0x36918a(0x18e0)]()+'_'+Math[_0x36918a(0x191c)]()[_0x36918a(0x9a3)](0x24)[_0x36918a(0x18cf)](0x2,0x9),_0x5f4d06={'id':_0x423524,'name':'表情包_'+Date[_0x36918a(0x18e0)](),'description':_0x4f090e[_0x36918a(0x1c6f)],'category':_0x36918a(0x2532),'imageData':_0x4f090e[_0x36918a(0x10c6)],'isPersonal':![],'isUrl':!![],'originalUrl':_0x4f090e[_0x36918a(0x10c6)],'addedTime':Date[_0x36918a(0x18e0)]()};await db[_0x36918a(0x20c7)][_0x36918a(0xe1)](_0x5f4d06),currentEmojiLibrary&&await db[_0x36918a(0x156f)][_0x36918a(0xe1)]({'libraryId':currentEmojiLibrary['id'],'emojiId':_0x423524,'addedAt':Date[_0x36918a(0x18e0)]()}),_0x32b6b8++,_0xa30e2d%0x5===0x0&&await new Promise(_0x3ff312=>setTimeout(_0x3ff312,0x64));}catch(_0x465941){console[_0x36918a(0x24ab)]('导入表情包失败\x20['+_0x4f090e[_0x36918a(0x1c6f)]+']:',_0x465941),_0x1d7066[_0x36918a(0x6ee)](_0x4f090e['description']+':\x20'+_0x465941[_0x36918a(0xd7a)]),_0x4f3a18++;}}currentEmojiLibrary&&await loadEmojiLibraryContent(currentEmojiLibrary['id']),document[_0x36918a(0x566)](_0x36918a(0x834))['value']='',_0x32b6b8>0x0?showToast(_0x36918a(0x466)+_0x32b6b8+'个，失败:\x20'+_0x4f3a18+'个',_0x36918a(0xb27)):showToast(_0x36918a(0x1b98),_0x36918a(0x24ab)),_0x1d7066[_0x36918a(0xcbf)]>0x0&&_0x1d7066['length']<=0x5&&console['log'](_0x36918a(0x7f6),_0x1d7066);}catch(_0x44b2f7){console[_0x36918a(0x24ab)](_0x36918a(0x1b06),_0x44b2f7),showToast(_0x36918a(0x2524)+_0x44b2f7['message'],_0x36918a(0x24ab));}}function initUrlInputEvents(){const _0xe11eed=_0x2cf6d4,_0x27775f=document['getElementById'](_0xe11eed(0xa38));_0x27775f&&_0x27775f[_0xe11eed(0x167)](_0xe11eed(0x1a17),function(_0x596937){const _0x979c0e=_0xe11eed;_0x596937[_0x979c0e(0x157f)]===_0x979c0e(0x165c)&&addEmojiFromUrl();});}async function getMountedEmojiLibraryEmojis(){const _0x479098=_0x2cf6d4;try{const _0xc7c847=getCurrentChatSettings();if(!_0xc7c847['emojiLibraryMountEnabled']||!_0xc7c847[_0x479098(0x3db)]||_0xc7c847[_0x479098(0x3db)][_0x479098(0xcbf)]===0x0)return customEmojis;await cleanupEmojiLibraryItems();const _0x204355=[];for(const _0x49f57e of _0xc7c847[_0x479098(0x3db)]){const _0x4a4f3f=await db[_0x479098(0x156f)][_0x479098(0x4a6)](_0x479098(0x245b))['equals'](_0x49f57e)[_0x479098(0x18c6)](),_0x49d6d6=_0x4a4f3f[_0x479098(0xf6d)](_0x2c4ce3=>_0x2c4ce3['emojiId']),_0x423f12=await db[_0x479098(0x20c7)][_0x479098(0x4a6)]('id')[_0x479098(0xe07)](_0x49d6d6)[_0x479098(0x18c6)]();_0x204355[_0x479098(0x6ee)](..._0x423f12);}return _0x204355;}catch(_0x46f4e8){return console[_0x479098(0x24ab)](_0x479098(0x3d0),_0x46f4e8),customEmojis;}}async function findEmojiForAI(_0x3a2bd4){const _0x2f3e47=_0x2cf6d4;try{const _0x3d0a2d=getCurrentChatSettings();if(_0x3d0a2d[_0x2f3e47(0xf0b)]&&_0x3d0a2d[_0x2f3e47(0x3db)]&&_0x3d0a2d[_0x2f3e47(0x3db)][_0x2f3e47(0xcbf)]>0x0){for(const _0x36d5fc of _0x3d0a2d[_0x2f3e47(0x3db)]){const _0x433bac=await db[_0x2f3e47(0x156f)][_0x2f3e47(0x4a6)](_0x2f3e47(0x245b))[_0x2f3e47(0x14a)](_0x36d5fc)['toArray'](),_0x2a10ee=_0x433bac['map'](_0x5d6a17=>_0x5d6a17[_0x2f3e47(0x1a7)]),_0x3da56c=await db[_0x2f3e47(0x20c7)][_0x2f3e47(0x4a6)]('id')['anyOf'](_0x2a10ee)['toArray']();let _0x167fb3=_0x3da56c[_0x2f3e47(0x1aeb)](_0x3f591f=>_0x3f591f[_0x2f3e47(0x1c6f)]===_0x3a2bd4);!_0x167fb3&&(_0x167fb3=_0x3da56c[_0x2f3e47(0x1aeb)](_0x4603c2=>_0x4603c2[_0x2f3e47(0x1c6f)]?.['trim']()===_0x3a2bd4?.['trim']()));!_0x167fb3&&(_0x167fb3=_0x3da56c['find'](_0x11a0c1=>_0x11a0c1[_0x2f3e47(0x1c6f)]?.['toLowerCase']()['trim']()===_0x3a2bd4?.[_0x2f3e47(0x1d64)]()[_0x2f3e47(0x1424)]()));if(_0x167fb3)return{..._0x167fb3,'url':_0x167fb3['imageData']||_0x167fb3[_0x2f3e47(0x10c6)]};}return null;}else{const _0x26db37=customEmojis['find'](_0x4cb56b=>_0x4cb56b[_0x2f3e47(0x1c6f)]===_0x3a2bd4);if(_0x26db37)return{..._0x26db37,'url':_0x26db37[_0x2f3e47(0xfe5)]||_0x26db37['url']};return null;}}catch(_0x5ed31c){console[_0x2f3e47(0x24ab)]('查找表情包时出错:',_0x5ed31c);const _0x4712e0=customEmojis['find'](_0x4c7a0e=>_0x4c7a0e['description']===_0x3a2bd4);if(_0x4712e0)return{..._0x4712e0,'url':_0x4712e0[_0x2f3e47(0xfe5)]||_0x4712e0[_0x2f3e47(0x10c6)]};return null;}}function isLightColor(_0x2c27e1){const _0x192dfc=_0x2cf6d4;let _0x46acbc,_0x16f4ae,_0x318102;if(_0x2c27e1['startsWith']('#')){const _0x44d61a=_0x2c27e1[_0x192dfc(0x136)](0x1);_0x44d61a['length']===0x3?(_0x46acbc=parseInt(_0x44d61a[0x0]+_0x44d61a[0x0],0x10),_0x16f4ae=parseInt(_0x44d61a[0x1]+_0x44d61a[0x1],0x10),_0x318102=parseInt(_0x44d61a[0x2]+_0x44d61a[0x2],0x10)):(_0x46acbc=parseInt(_0x44d61a[_0x192dfc(0x18cf)](0x0,0x2),0x10),_0x16f4ae=parseInt(_0x44d61a[_0x192dfc(0x18cf)](0x2,0x2),0x10),_0x318102=parseInt(_0x44d61a['substr'](0x4,0x2),0x10));}else{if(_0x2c27e1['startsWith'](_0x192dfc(0x4d8))){const _0x54ea15=_0x2c27e1[_0x192dfc(0x1316)](/\d+/g);_0x54ea15&&_0x54ea15[_0x192dfc(0xcbf)]>=0x3&&(_0x46acbc=parseInt(_0x54ea15[0x0]),_0x16f4ae=parseInt(_0x54ea15[0x1]),_0x318102=parseInt(_0x54ea15[0x2]));}else return![];}const _0xe23d0e=(_0x46acbc*0x12b+_0x16f4ae*0x24b+_0x318102*0x72)/0x3e8;return _0xe23d0e>0x80;}function updateBubblePreview(){const _0xf0ec62=_0x2cf6d4,_0x353174=document['getElementById'](_0xf0ec62(0x1d50))?.[_0xf0ec62(0xc34)]||_0xf0ec62(0x1f03),_0x1c2514=document['getElementById']('ai-bubble-color')?.[_0xf0ec62(0xc34)]||_0xf0ec62(0x1679),_0x3bdb25=document[_0xf0ec62(0x566)]('my-bubble-opacity')?.[_0xf0ec62(0xc34)]||'1',_0x2dffec=document['getElementById'](_0xf0ec62(0xbc2))?.[_0xf0ec62(0xc34)]||'1',_0x36fc20=document[_0xf0ec62(0x566)](_0xf0ec62(0xf02)),_0x512c84=document[_0xf0ec62(0x566)](_0xf0ec62(0x3f6));if(_0x36fc20){const _0x2d8ce0=convertColorWithOpacity(_0x353174,_0x3bdb25);_0x36fc20['style'][_0xf0ec62(0xacd)]=_0x2d8ce0,_0x36fc20[_0xf0ec62(0x655)][_0xf0ec62(0x2099)]=isLightColor(_0x353174)?'#333':_0xf0ec62(0x18a7);}if(_0x512c84){const _0x1ca124=convertColorWithOpacity(_0x1c2514,_0x2dffec);_0x512c84[_0xf0ec62(0x655)][_0xf0ec62(0xacd)]=_0x1ca124,_0x512c84[_0xf0ec62(0x655)][_0xf0ec62(0x2099)]=isLightColor(_0x1c2514)?_0xf0ec62(0x194f):'#fff';}const _0x43e32b=document[_0xf0ec62(0x566)](_0xf0ec62(0x2329)),_0x4f195d=document['getElementById'](_0xf0ec62(0x8dd));if(_0x43e32b){const _0x173e55=convertColorWithOpacity(_0x353174,_0x3bdb25);_0x43e32b['style'][_0xf0ec62(0xacd)]=_0x173e55,_0x43e32b[_0xf0ec62(0x21dc)]=_0xf0ec62(0x24d8);}if(_0x4f195d){const _0x16078c=convertColorWithOpacity(_0x1c2514,_0x2dffec);_0x4f195d['style']['backgroundColor']=_0x16078c,_0x4f195d[_0xf0ec62(0x21dc)]=_0xf0ec62(0xa56);}}function bindAvatarUploadEvents(){const _0x295cc8=_0x2cf6d4,_0x4476a4=document[_0x295cc8(0x566)](_0x295cc8(0x207e));_0x4476a4&&(_0x4476a4[_0x295cc8(0x1889)]=function(_0x206a5d){const _0x1faa5f=_0x295cc8;if(_0x206a5d['target'][_0x1faa5f(0x173e)]&&_0x206a5d[_0x1faa5f(0x1144)][_0x1faa5f(0x173e)][0x0]){const _0x299bc8=new FileReader();_0x299bc8['onload']=function(_0x11d7a5){const _0xd266ba=_0x1faa5f,_0x136968=document['getElementById'](_0xd266ba(0x1045));_0x136968&&(_0x136968['style'][_0xd266ba(0x1584)]=_0xd266ba(0xcb5)+_0x11d7a5[_0xd266ba(0x1144)][_0xd266ba(0x1fff)]+')',_0x136968[_0xd266ba(0x655)][_0xd266ba(0x2000)]=_0xd266ba(0xe3e),_0x136968[_0xd266ba(0x655)][_0xd266ba(0x18b3)]=_0xd266ba(0x23a1),_0x136968[_0xd266ba(0xc02)]='',window[_0xd266ba(0x209)]=_0x11d7a5[_0xd266ba(0x1144)][_0xd266ba(0x1fff)]);},_0x299bc8[_0x1faa5f(0x145e)](_0x206a5d['target']['files'][0x0]);}});const _0x364ed0=document['getElementById'](_0x295cc8(0x18e1));_0x364ed0&&(_0x364ed0[_0x295cc8(0x1889)]=function(_0x3626b8){const _0x2a326a=_0x295cc8;if(_0x3626b8['target']['files']&&_0x3626b8[_0x2a326a(0x1144)]['files'][0x0]){const _0x5b0307=new FileReader();_0x5b0307['onload']=function(_0x150a72){const _0x3dba92=_0x2a326a,_0x1aa29f=document['getElementById'](_0x3dba92(0x182f));_0x1aa29f&&(_0x1aa29f['style']['backgroundImage']=_0x3dba92(0xcb5)+_0x150a72[_0x3dba92(0x1144)]['result']+')',_0x1aa29f[_0x3dba92(0x655)]['backgroundSize']='cover',_0x1aa29f['style']['backgroundPosition']='center',_0x1aa29f[_0x3dba92(0xc02)]='',window[_0x3dba92(0x1285)]=_0x150a72['target'][_0x3dba92(0x1fff)]);},_0x5b0307['readAsDataURL'](_0x3626b8[_0x2a326a(0x1144)][_0x2a326a(0x173e)][0x0]);}});}function initializeAvatarUpload(){const _0x3d0e91=_0x2cf6d4,_0x94c8d2=document[_0x3d0e91(0x566)](_0x3d0e91(0x1d44));if(!_0x94c8d2){console[_0x3d0e91(0x24ab)](_0x3d0e91(0x4e9));return;}_0x94c8d2[_0x3d0e91(0x6be)]('change',avatarUploadHandler),_0x94c8d2['addEventListener'](_0x3d0e91(0x17ef),avatarUploadHandler),console['log']('头像上传事件监听器已绑定');}async function updateChatSettingsDisplay(){const _0x355f81=_0x2cf6d4;if(!currentChatCharacter){console[_0x355f81(0xc0d)](_0x355f81(0x2f8));return;}const _0x508e5b=await getAsyncChatSettings(),_0x326415=document['getElementById'](_0x355f81(0x2492));if(_0x326415){const _0x37bd4c=currentChatCharacter[_0x355f81(0x4b7)];_0x326415['style'][_0x355f81(0x2526)]=_0x37bd4c?_0x355f81(0xfe9):'block';}const _0xeb3cda=document[_0x355f81(0x566)]('current-history-count');_0xeb3cda&&(_0xeb3cda['textContent']=_0x508e5b[_0x355f81(0xe03)]+'回合');const _0x2594e9=document[_0x355f81(0x566)]('current-memory-mount');_0x2594e9&&(_0x2594e9[_0x355f81(0x21dc)]=_0x508e5b['memoryMountEnabled']?_0x355f81(0xc5d):_0x355f81(0x24b4));updateWorldbookMountDisplay()[_0x355f81(0x9e5)](_0x5d6aa8=>console[_0x355f81(0x24ab)](_0x355f81(0x1581),_0x5d6aa8)),updateEmojiLibraryMountDisplay();const _0x3010a8=document[_0x355f81(0x566)](_0x355f81(0x1d4c));_0x3010a8&&(_0x3010a8['checked']=_0x508e5b['timeAwarenessEnabled']);const _0x4dca5f=document[_0x355f81(0x566)](_0x355f81(0x146e));_0x4dca5f&&(_0x4dca5f[_0x355f81(0x306)]=_0x508e5b[_0x355f81(0xfb)]);const _0x125941=document[_0x355f81(0x566)](_0x355f81(0x1c14));if(_0x125941){_0x125941[_0x355f81(0x306)]=_0x508e5b[_0x355f81(0xbb1)];const _0x2310b1=document[_0x355f81(0x566)](_0x355f81(0x696));_0x2310b1&&(_0x2310b1[_0x355f81(0x655)][_0x355f81(0x2526)]=_0x508e5b[_0x355f81(0xbb1)]?_0x355f81(0x1f0b):'none');}const _0x5507ff=document[_0x355f81(0x566)](_0x355f81(0x2520));_0x5507ff&&(_0x5507ff['value']=_0x508e5b[_0x355f81(0xd87)]||_0x355f81(0x23a1));const _0x40f358=document[_0x355f81(0x566)](_0x355f81(0xb3e));if(_0x40f358){_0x40f358[_0x355f81(0x306)]=_0x508e5b[_0x355f81(0x261)]||![];const _0x397f97=document[_0x355f81(0x566)]('status-frequency-setting');_0x397f97&&(_0x397f97[_0x355f81(0x655)][_0x355f81(0x2526)]=_0x508e5b[_0x355f81(0x261)]?_0x355f81(0x1f0b):_0x355f81(0xfe9));}const _0x2f1602=document[_0x355f81(0x566)]('status-update-frequency');if(_0x2f1602){const _0x3e35fc=localStorage['getItem'](_0x355f81(0x193e))||_0x355f81(0x1e86);_0x2f1602[_0x355f81(0xc34)]=_0x3e35fc;}updateCurrentPersonaDisplay();const _0x4aa815=document[_0x355f81(0x566)]('background-interaction-enabled');if(_0x4aa815){_0x4aa815[_0x355f81(0x306)]=_0x508e5b[_0x355f81(0x961)];const _0x1e048d=document[_0x355f81(0x566)](_0x355f81(0x1510));_0x1e048d&&(_0x1e048d[_0x355f81(0x655)]['display']=_0x508e5b[_0x355f81(0x961)]?_0x355f81(0x2d4):_0x355f81(0xfe9));}const _0x4b154b=document[_0x355f81(0x566)](_0x355f81(0x1b48));_0x4b154b&&(_0x4b154b['value']=_0x508e5b[_0x355f81(0x22c9)]||_0x355f81(0x222d));const _0x1c313f=document['getElementById'](_0x355f81(0x1129));if(_0x1c313f){_0x1c313f[_0x355f81(0x306)]=_0x508e5b['backgroundChatEnabled']===!![];const _0x10273a=document[_0x355f81(0x566)](_0x355f81(0xfd7));_0x10273a&&(_0x10273a[_0x355f81(0x655)][_0x355f81(0x2526)]=_0x508e5b['backgroundInteractionEnabled']===!![]&&_0x508e5b['backgroundChatEnabled']===!![]?_0x355f81(0x2d4):'none');}const _0x5f08f2=document['getElementById'](_0x355f81(0x1985));if(_0x5f08f2){_0x5f08f2[_0x355f81(0x306)]=_0x508e5b[_0x355f81(0xefc)]===!![];const _0x1f9c59=_0x508e5b[_0x355f81(0x961)]===!![]&&_0x508e5b['backgroundMomentsEnabled']===!![],_0x2a9bc5=document['getElementById'](_0x355f81(0x5a3)),_0x4fd5cc=document[_0x355f81(0x566)](_0x355f81(0x764)),_0x423dae=document[_0x355f81(0x566)](_0x355f81(0x1621));_0x2a9bc5&&(_0x2a9bc5[_0x355f81(0x655)]['display']=_0x1f9c59?_0x355f81(0x1f0b):_0x355f81(0xfe9)),_0x4fd5cc&&(_0x4fd5cc[_0x355f81(0x655)]['display']=_0x1f9c59?_0x355f81(0x1f0b):_0x355f81(0xfe9)),_0x423dae&&(_0x423dae['style'][_0x355f81(0x2526)]=_0x1f9c59?_0x355f81(0x1f0b):_0x355f81(0xfe9));}const _0x242374=document[_0x355f81(0x566)](_0x355f81(0xc9c));_0x242374&&(_0x242374[_0x355f81(0xc34)]=_0x508e5b[_0x355f81(0x383)]||_0x355f81(0x222d));const _0x15ac63=document[_0x355f81(0x566)](_0x355f81(0x10ac));if(_0x15ac63){_0x15ac63[_0x355f81(0x306)]=_0x508e5b[_0x355f81(0x4c6)]||![];const _0xdd9b39=document[_0x355f81(0x15b8)](_0x355f81(0x15c8));_0xdd9b39&&(_0xdd9b39[_0x355f81(0x655)]['display']=_0x508e5b[_0x355f81(0x4c6)]?_0x355f81(0xf09):'none');}updateScheduleTimesDisplay();const _0x3d9b5a=document[_0x355f81(0x566)](_0x355f81(0xfd6));if(_0x3d9b5a){_0x3d9b5a[_0x355f81(0x306)]=_0x508e5b[_0x355f81(0x1ad2)]===!![];const _0xcb0b8f=document['getElementById']('diary-time-setting');if(_0xcb0b8f){const _0x56e1df=_0x508e5b[_0x355f81(0x961)]===!![]&&_0x508e5b[_0x355f81(0x1ad2)]===!![];_0xcb0b8f[_0x355f81(0x655)][_0x355f81(0x2526)]=_0x56e1df?_0x355f81(0x1f0b):'none';}}const _0x18971c=document[_0x355f81(0x566)]('diary-time-input');_0x18971c&&(_0x18971c[_0x355f81(0xc34)]=_0x508e5b['backgroundDiaryTime']||'',console[_0x355f81(0xc0d)](_0x355f81(0xda8)+(_0x508e5b[_0x355f81(0x1f8a)]||_0x355f81(0x1465))));const _0x96dc7c=document[_0x355f81(0x566)](_0x355f81(0x120c));if(_0x96dc7c){const _0x1dfe0b=_0x508e5b[_0x355f81(0x9c1)]!==![];_0x96dc7c[_0x355f81(0x306)]=_0x1dfe0b,console['log'](_0x355f81(0x765),_0x1dfe0b);}const _0x21daef=document[_0x355f81(0x566)](_0x355f81(0x115b));if(_0x21daef){const _0x368f8a=_0x508e5b['showOfflineInOnline']===!![];_0x21daef[_0x355f81(0x306)]=_0x368f8a,console['log'](_0x355f81(0x179e),_0x368f8a);}bindChatSettingsEvents();}function bindChatSettingsEvents(){const _0x15b025=_0x2cf6d4,_0xf3ded4=document[_0x15b025(0x566)](_0x15b025(0x1d4c));_0xf3ded4&&(_0xf3ded4['onchange']=async function(){const _0x1e449e=_0x15b025,_0x1aecf9=getCurrentChatSettings();_0x1aecf9['timeAwarenessEnabled']=this[_0x1e449e(0x306)],await saveCurrentChatSettings(_0x1aecf9);});const _0x379620=document[_0x15b025(0x566)](_0x15b025(0x146e));_0x379620&&(_0x379620[_0x15b025(0x1889)]=async function(){const _0x2309a4=_0x15b025,_0x404283=getCurrentChatSettings();_0x404283[_0x2309a4(0xfb)]=this['checked'],await saveCurrentChatSettings(_0x404283),showToast(_0x2309a4(0x20b2)+(this['checked']?'开启':'关闭'),'success');});const _0x87d5b=document[_0x15b025(0x566)](_0x15b025(0x1c14));_0x87d5b&&(_0x87d5b[_0x15b025(0x1889)]=async function(){const _0x137811=_0x15b025,_0x2dea56=getCurrentChatSettings();_0x2dea56[_0x137811(0xbb1)]=this[_0x137811(0x306)],await saveCurrentChatSettings(_0x2dea56);const _0x133b76=document[_0x137811(0x566)](_0x137811(0x696));_0x133b76&&(_0x133b76[_0x137811(0x655)][_0x137811(0x2526)]=this[_0x137811(0x306)]?_0x137811(0x1f0b):_0x137811(0xfe9)),currentChatCharacter&&updateAiHeartrate(),showToast(_0x137811(0xa1)+(this[_0x137811(0x306)]?'开启':'关闭'),_0x137811(0xb27));});const _0x5cd2a9=document[_0x15b025(0x566)](_0x15b025(0x2520));_0x5cd2a9&&(_0x5cd2a9[_0x15b025(0x1889)]=async function(){const _0x5e2c9b=_0x15b025,_0x282ae5=getCurrentChatSettings();_0x282ae5[_0x5e2c9b(0xd87)]=this[_0x5e2c9b(0xc34)],await saveCurrentChatSettings(_0x282ae5),currentChatCharacter&&updateAiHeartrate(),showToast(_0x5e2c9b(0x1695)+(this['value']==='center'?_0x5e2c9b(0x215a):'右侧'),'success');});const _0x2e8413=document[_0x15b025(0x566)]('background-interaction-enabled');_0x2e8413&&(_0x2e8413['onchange']=async function(){const _0x4bc0cd=_0x15b025,_0x5e0114=getCurrentChatSettings();_0x5e0114[_0x4bc0cd(0x961)]=this[_0x4bc0cd(0x306)],await saveCurrentChatSettings(_0x5e0114);const _0x575bf2=document[_0x4bc0cd(0x566)](_0x4bc0cd(0x1510));_0x575bf2&&(_0x575bf2[_0x4bc0cd(0x655)][_0x4bc0cd(0x2526)]=this[_0x4bc0cd(0x306)]?'block':_0x4bc0cd(0xfe9));if(!this[_0x4bc0cd(0x306)]){_0x5e0114['backgroundChatEnabled']=![],_0x5e0114[_0x4bc0cd(0xefc)]=![],await saveCurrentChatSettings(_0x5e0114);const _0x2d092b=document[_0x4bc0cd(0x566)](_0x4bc0cd(0x1129)),_0x1b778e=document['getElementById'](_0x4bc0cd(0x1985));if(_0x2d092b)_0x2d092b[_0x4bc0cd(0x306)]=![];if(_0x1b778e)_0x1b778e[_0x4bc0cd(0x306)]=![];const _0x3eb75f=document['getElementById'](_0x4bc0cd(0xfd7)),_0x66c5c4=document[_0x4bc0cd(0x566)]('moments-frequency-setting'),_0x1ae738=document[_0x4bc0cd(0x566)](_0x4bc0cd(0x764)),_0x1c4510=document[_0x4bc0cd(0x566)](_0x4bc0cd(0x1621));if(_0x3eb75f)_0x3eb75f[_0x4bc0cd(0x655)][_0x4bc0cd(0x2526)]=_0x4bc0cd(0xfe9);if(_0x66c5c4)_0x66c5c4[_0x4bc0cd(0x655)][_0x4bc0cd(0x2526)]=_0x4bc0cd(0xfe9);if(_0x1ae738)_0x1ae738[_0x4bc0cd(0x655)][_0x4bc0cd(0x2526)]='none';if(_0x1c4510)_0x1c4510[_0x4bc0cd(0x655)][_0x4bc0cd(0x2526)]=_0x4bc0cd(0xfe9);clearAllBackgroundTimers();}else{const _0x47ca37=_0x5e0114['backgroundChatEnabled']===!![],_0x957dd6=_0x5e0114['backgroundMomentsEnabled']===!![],_0x477343=document['getElementById'](_0x4bc0cd(0xfd7)),_0x9ffd6f=document[_0x4bc0cd(0x566)](_0x4bc0cd(0x5a3)),_0x4defd6=document['getElementById']('scheduled-moments-setting'),_0x3fbd65=document[_0x4bc0cd(0x566)]('test-publish-setting');if(_0x477343)_0x477343[_0x4bc0cd(0x655)][_0x4bc0cd(0x2526)]=_0x47ca37?_0x4bc0cd(0x2d4):_0x4bc0cd(0xfe9);if(_0x9ffd6f)_0x9ffd6f[_0x4bc0cd(0x655)][_0x4bc0cd(0x2526)]=_0x957dd6?_0x4bc0cd(0x1f0b):_0x4bc0cd(0xfe9);if(_0x4defd6)_0x4defd6['style']['display']=_0x957dd6?'block':_0x4bc0cd(0xfe9);if(_0x3fbd65)_0x3fbd65[_0x4bc0cd(0x655)][_0x4bc0cd(0x2526)]=_0x957dd6?_0x4bc0cd(0x1f0b):_0x4bc0cd(0xfe9);}currentChatCharacter&&(await scheduleProactiveChatForCharacter(currentChatCharacter['id']),console[_0x4bc0cd(0xc0d)](_0x4bc0cd(0x1e1b)+currentChatCharacter[_0x4bc0cd(0x222f)]+'\x20主动聊天定时器已重新设置'));});const _0xf067f0=document[_0x15b025(0x566)]('background-chat-frequency');_0xf067f0&&(_0xf067f0[_0x15b025(0x1889)]=async function(){const _0x2398f7=getCurrentChatSettings();_0x2398f7['backgroundChatFrequency']=this['value'],await saveCurrentChatSettings(_0x2398f7);});const _0x56b7a5=document['getElementById'](_0x15b025(0x1129));_0x56b7a5&&(_0x56b7a5[_0x15b025(0x1889)]=async function(){const _0x530877=_0x15b025,_0x1ce9da=getCurrentChatSettings();_0x1ce9da[_0x530877(0x1bb5)]=this[_0x530877(0x306)],await saveCurrentChatSettings(_0x1ce9da);const _0x10703a=document[_0x530877(0x566)](_0x530877(0xfd7));if(_0x10703a){const _0x37d1ea=_0x1ce9da[_0x530877(0x961)]===!![]&&this[_0x530877(0x306)];_0x10703a[_0x530877(0x655)][_0x530877(0x2526)]=_0x37d1ea?'block':_0x530877(0xfe9);}currentChatCharacter&&(await scheduleProactiveChatForCharacter(currentChatCharacter['id']),console[_0x530877(0xc0d)](_0x530877(0x1e1b)+currentChatCharacter[_0x530877(0x222f)]+_0x530877(0x2282)));});const _0x375baf=document[_0x15b025(0x566)](_0x15b025(0x1985));_0x375baf&&(_0x375baf[_0x15b025(0x1889)]=async function(){const _0x185b01=_0x15b025,_0x262a60=getCurrentChatSettings();_0x262a60['backgroundMomentsEnabled']=this['checked'],await saveCurrentChatSettings(_0x262a60);const _0x22a621=document[_0x185b01(0x566)](_0x185b01(0x5a3)),_0x290d58=document[_0x185b01(0x566)]('scheduled-moments-setting'),_0x39251c=document[_0x185b01(0x566)](_0x185b01(0x1621)),_0x1f46af=_0x262a60[_0x185b01(0x961)]===!![]&&this[_0x185b01(0x306)];_0x22a621&&(_0x22a621[_0x185b01(0x655)][_0x185b01(0x2526)]=_0x1f46af?_0x185b01(0x1f0b):'none'),_0x290d58&&(_0x290d58[_0x185b01(0x655)][_0x185b01(0x2526)]=_0x1f46af?_0x185b01(0x1f0b):_0x185b01(0xfe9)),_0x39251c&&(_0x39251c[_0x185b01(0x655)][_0x185b01(0x2526)]=_0x1f46af?'flex':_0x185b01(0xfe9)),currentChatCharacter&&(await scheduleProactiveChatForCharacter(currentChatCharacter['id']),console[_0x185b01(0xc0d)](_0x185b01(0x1e1b)+currentChatCharacter[_0x185b01(0x222f)]+_0x185b01(0x2282)));});const _0x589996=document[_0x15b025(0x566)](_0x15b025(0xc9c));_0x589996&&(_0x589996[_0x15b025(0x1889)]=async function(){const _0x4b60a9=_0x15b025,_0x19c1d5=getCurrentChatSettings();_0x19c1d5[_0x4b60a9(0x383)]=this[_0x4b60a9(0xc34)],await saveCurrentChatSettings(_0x19c1d5),await initGlobalBackgroundInteractionSystem();});const _0x42e4c2=document[_0x15b025(0x566)](_0x15b025(0x10ac));_0x42e4c2&&(_0x42e4c2['onchange']=async function(){const _0x2cd6bf=_0x15b025,_0x49cc2d=getCurrentChatSettings();_0x49cc2d[_0x2cd6bf(0x4c6)]=this[_0x2cd6bf(0x306)],await saveCurrentChatSettings(_0x49cc2d);const _0x140a17=document[_0x2cd6bf(0x15b8)](_0x2cd6bf(0x15c8));_0x140a17&&(_0x140a17['style'][_0x2cd6bf(0x2526)]=this[_0x2cd6bf(0x306)]?_0x2cd6bf(0xf09):'none'),initScheduledMomentsSystem();});const _0x1829dc=document[_0x15b025(0x566)](_0x15b025(0xfd6));_0x1829dc&&(_0x1829dc[_0x15b025(0x1889)]=async function(){const _0x504ddf=_0x15b025,_0x41ec92=getCurrentChatSettings();_0x41ec92['backgroundDiaryEnabled']=this['checked'],await saveCurrentChatSettings(_0x41ec92);const _0x5f68b7=document[_0x504ddf(0x566)](_0x504ddf(0xba9));if(_0x5f68b7){const _0x4b379d=_0x41ec92[_0x504ddf(0x961)]===!![]&&this[_0x504ddf(0x306)];_0x5f68b7[_0x504ddf(0x655)][_0x504ddf(0x2526)]=_0x4b379d?_0x504ddf(0x1f0b):_0x504ddf(0xfe9);}currentChatCharacter&&await initBackgroundDiarySystem(currentChatCharacter['id']),showToast(_0x504ddf(0x1fce)+(this['checked']?'开启':'关闭'),'success');});const _0x2dd810=document[_0x15b025(0x566)]('timestamp-enabled');_0x2dd810&&(_0x2dd810[_0x15b025(0x1889)]=async function(){const _0x1a7e51=_0x15b025,_0x3e6139=getCurrentChatSettings();_0x3e6139['timestampEnabled']=this[_0x1a7e51(0x306)],await saveCurrentChatSettings(_0x3e6139),currentChatCharacter&&renderChatMessages(currentChatCharacter['id']),console['log'](_0x1a7e51(0x2367),this[_0x1a7e51(0x306)]);});const _0x4aabf6=document[_0x15b025(0x566)]('show-offline-in-online-enabled');_0x4aabf6&&(_0x4aabf6['onchange']=async function(){const _0x16b674=_0x15b025,_0x1d8d3a=getCurrentChatSettings();_0x1d8d3a[_0x16b674(0x14f7)]=this[_0x16b674(0x306)],await saveCurrentChatSettings(_0x1d8d3a),currentChatCharacter&&renderChatMessages(currentChatCharacter['id']),console[_0x16b674(0xc0d)](_0x16b674(0x22dd),this[_0x16b674(0x306)]),showToast(_0x16b674(0xc7f)+(this[_0x16b674(0x306)]?'开启':'关闭'),_0x16b674(0xb27));});const _0x202880=document[_0x15b025(0x566)](_0x15b025(0xb3e));_0x202880?_0x202880[_0x15b025(0x1889)]=async function(){const _0x4a3c58=_0x15b025;console['log'](_0x4a3c58(0x1ea5),this[_0x4a3c58(0x306)]);const _0x6d18f7=getCurrentChatSettings();_0x6d18f7['characterStatusEnabled']=this[_0x4a3c58(0x306)],await saveCurrentChatSettings(_0x6d18f7);const _0xdd8ad6=document[_0x4a3c58(0x566)](_0x4a3c58(0x17cd));_0xdd8ad6&&(_0xdd8ad6[_0x4a3c58(0x655)]['display']=this[_0x4a3c58(0x306)]?_0x4a3c58(0x1f0b):_0x4a3c58(0xfe9));if(currentChatCharacter){renderChatMessages(currentChatCharacter['id']);const _0x8c4c1a=document['querySelector'](_0x4a3c58(0x229b));_0x8c4c1a&&renderCharacterStatus(currentChatCharacter['id'],_0x8c4c1a);}restartCharacterStatusTimer(),showToast('角色状态显示已'+(this[_0x4a3c58(0x306)]?'开启':'关闭'),_0x4a3c58(0xb27));}:console[_0x15b025(0x17cc)](_0x15b025(0xdbb));const _0x3a4191=document[_0x15b025(0x566)](_0x15b025(0xf83));_0x3a4191&&(_0x3a4191[_0x15b025(0x1889)]=async function(){const _0x1d9da8=_0x15b025;localStorage[_0x1d9da8(0x2055)]('globalStatusUpdateFrequency',this[_0x1d9da8(0xc34)]);const _0x49b5ec=getCurrentChatSettings();_0x49b5ec[_0x1d9da8(0x1e39)]=this['value'],await saveCurrentChatSettings(_0x49b5ec),restartCharacterStatusTimer();const _0x558cf8={'high':'高频','medium-high':_0x1d9da8(0x78b),'medium':'中频','medium-low':'中低频','low':'低频'};showToast('状态更新频率已设置为'+_0x558cf8[this[_0x1d9da8(0xc34)]],_0x1d9da8(0xb27));});}async function initializeChatSettings(){const _0x572743=_0x2cf6d4;console[_0x572743(0xc0d)](_0x572743(0x13fd)),initChatSettingsUIEvents();if(!currentChatCharacter){console[_0x572743(0xc0d)](_0x572743(0xdff));return;}await updateChatIdentityDisplay(),await updateBubbleStyleDisplay(),await initCharacterSoundSettings(),await updateChatSettingsDisplay();if(currentChatCharacter){const _0x46b02a=await getAsyncChatSettings();}}function initChatSettingsUIEvents(){const _0x1cae86=_0x2cf6d4,_0x5a5b85=document[_0x1cae86(0x566)](_0x1cae86(0x1ec6));_0x5a5b85&&_0x5a5b85[_0x1cae86(0x167)](_0x1cae86(0x17ef),async function(){const _0x4fb0cf=_0x1cae86,_0x1cead7=document[_0x4fb0cf(0x566)](_0x4fb0cf(0x1510));_0x1cead7&&(_0x1cead7[_0x4fb0cf(0x655)][_0x4fb0cf(0x2526)]=this['checked']?_0x4fb0cf(0x2d4):_0x4fb0cf(0xfe9));if(!this['checked']){const _0x1890bc=document[_0x4fb0cf(0x566)](_0x4fb0cf(0xfd7)),_0x12e6b7=document['getElementById'](_0x4fb0cf(0x5a3)),_0x1e444f=document[_0x4fb0cf(0x566)]('scheduled-moments-setting'),_0x21e4c3=document[_0x4fb0cf(0x566)](_0x4fb0cf(0x1621)),_0x3a22bf=document[_0x4fb0cf(0x566)](_0x4fb0cf(0xba9));if(_0x1890bc)_0x1890bc[_0x4fb0cf(0x655)]['display']='none';if(_0x12e6b7)_0x12e6b7[_0x4fb0cf(0x655)][_0x4fb0cf(0x2526)]=_0x4fb0cf(0xfe9);if(_0x1e444f)_0x1e444f[_0x4fb0cf(0x655)][_0x4fb0cf(0x2526)]=_0x4fb0cf(0xfe9);if(_0x21e4c3)_0x21e4c3[_0x4fb0cf(0x655)]['display']=_0x4fb0cf(0xfe9);if(_0x3a22bf)_0x3a22bf['style'][_0x4fb0cf(0x2526)]=_0x4fb0cf(0xfe9);clearAllBackgroundTimers();}else await initGlobalBackgroundInteractionSystem();});const _0x3d26c1=document[_0x1cae86(0x566)](_0x1cae86(0x1129));_0x3d26c1&&_0x3d26c1[_0x1cae86(0x167)](_0x1cae86(0x17ef),async function(){const _0x22a840=_0x1cae86,_0x1afe05=document[_0x22a840(0x566)](_0x22a840(0x1ec6)),_0x571ed8=_0x1afe05?_0x1afe05[_0x22a840(0x306)]:![],_0x2759d8=document[_0x22a840(0x566)](_0x22a840(0xfd7));if(_0x2759d8){const _0x165779=_0x571ed8&&this[_0x22a840(0x306)];_0x2759d8[_0x22a840(0x655)]['display']=_0x165779?_0x22a840(0x2d4):_0x22a840(0xfe9);}await initGlobalBackgroundInteractionSystem();});const _0x1dd311=document['getElementById'](_0x1cae86(0x1985));_0x1dd311&&_0x1dd311[_0x1cae86(0x167)](_0x1cae86(0x17ef),async function(){const _0x29b8d5=_0x1cae86,_0x31dec6=document['getElementById']('background-interaction-enabled'),_0x1861d7=_0x31dec6?_0x31dec6[_0x29b8d5(0x306)]:![],_0x2263c9=_0x1861d7&&this['checked'],_0x11f8e5=document['getElementById'](_0x29b8d5(0x5a3)),_0x2ed9d8=document[_0x29b8d5(0x566)](_0x29b8d5(0x764)),_0x313ec4=document[_0x29b8d5(0x566)](_0x29b8d5(0x1621));if(_0x11f8e5)_0x11f8e5[_0x29b8d5(0x655)]['display']=_0x2263c9?_0x29b8d5(0x1f0b):_0x29b8d5(0xfe9);if(_0x2ed9d8)_0x2ed9d8[_0x29b8d5(0x655)]['display']=_0x2263c9?'flex':'none';if(_0x313ec4)_0x313ec4[_0x29b8d5(0x655)][_0x29b8d5(0x2526)]=_0x2263c9?_0x29b8d5(0x1f0b):_0x29b8d5(0xfe9);if(currentChatCharacter){const _0x4acfd6=currentChatCharacter['id'];backgroundTimers[_0x4acfd6+'_moments']&&(clearInterval(backgroundTimers[_0x4acfd6+_0x29b8d5(0x1f6e)]),delete backgroundTimers[_0x4acfd6+_0x29b8d5(0x1f6e)]);const _0x15a4d1=getCurrentChatSettings();if(_0x15a4d1[_0x29b8d5(0x961)]&&_0x15a4d1['backgroundMomentsEnabled']){const _0x42a2a8=getBackgroundMomentsInterval(_0x15a4d1['backgroundMomentsFrequency']||_0x29b8d5(0x222d));backgroundTimers[_0x4acfd6+_0x29b8d5(0x1f6e)]=setInterval(()=>{triggerBackgroundMoments(_0x4acfd6);},_0x42a2a8),console[_0x29b8d5(0xc0d)](_0x29b8d5(0x1e1b)+currentChatCharacter[_0x29b8d5(0x222f)]+_0x29b8d5(0x2569)+_0x42a2a8+'ms');}else console[_0x29b8d5(0xc0d)]('🚫\x20[设置更改]\x20'+currentChatCharacter[_0x29b8d5(0x222f)]+_0x29b8d5(0x715));}});const _0xf1cbea=document[_0x1cae86(0x566)](_0x1cae86(0xfd6));_0xf1cbea&&_0xf1cbea[_0x1cae86(0x167)](_0x1cae86(0x17ef),async function(){const _0x2b1d37=_0x1cae86,_0x4397e3=document[_0x2b1d37(0x566)](_0x2b1d37(0x1ec6)),_0x358e55=_0x4397e3?_0x4397e3[_0x2b1d37(0x306)]:![],_0x7a4d30=document[_0x2b1d37(0x566)](_0x2b1d37(0xba9));if(_0x7a4d30){const _0x4f67bc=_0x358e55&&this[_0x2b1d37(0x306)];_0x7a4d30[_0x2b1d37(0x655)][_0x2b1d37(0x2526)]=_0x4f67bc?_0x2b1d37(0x1f0b):'none';}currentChatCharacter&&await initBackgroundDiarySystem(currentChatCharacter['id']);});const _0x1a6804=document[_0x1cae86(0x566)](_0x1cae86(0x1724)),_0x4f18e6=document['getElementById'](_0x1cae86(0x11e0));_0x1a6804&&_0x1a6804[_0x1cae86(0x167)](_0x1cae86(0x1e62),exitMessageSelectionMode),_0x4f18e6&&_0x4f18e6[_0x1cae86(0x167)](_0x1cae86(0x1e62),function(){if(selectedMessages['size']===0x0)return;deleteSelectedMessages();});}async function pokeCharacter(_0x36aef1){const _0x380fa2=_0x2cf6d4;if(!currentChatCharacter)return;const _0x304940=getCurrentChatSettings();let _0x1b9c45='',_0x2c0438='',_0x2f4083=currentChatCharacter['id'];if(currentChatCharacter[_0x380fa2(0x4b7)]){const _0x32c6fb=currentChatCharacter[_0x380fa2(0xcaa)][_0x380fa2(0x1aeb)](_0x1b4192=>_0x1b4192['id']===_0x36aef1);if(!_0x32c6fb){console[_0x380fa2(0x17cc)]('群聊中未找到被戳的成员:',_0x36aef1);return;}_0x1b9c45=_0x32c6fb['name'],_0x2c0438=_0x304940['aiPokeSuffix']||'',console[_0x380fa2(0xc0d)](_0x380fa2(0x1dd),_0x1b9c45);}else{if(currentChatCharacter['id']!==_0x36aef1)return;_0x1b9c45=_0x304940['aiChatNickname']||currentChatCharacter[_0x380fa2(0x222f)],_0x2c0438=_0x304940['aiPokeSuffix']||'',console[_0x380fa2(0xc0d)]('🔍\x20[单聊戳一戳]\x20戳了戳角色:',_0x1b9c45);}const _0x17891e={'id':Date[_0x380fa2(0x18e0)]()['toString'](),'sender':_0x380fa2(0x212),'content':'你戳了戳'+_0x1b9c45+_0x2c0438,'timestamp':Date['now'](),'isPoke':!![]};!chatMessages[_0x2f4083]&&(chatMessages[_0x2f4083]=[]);chatMessages[_0x2f4083]['push'](_0x17891e);try{const _0x2360fd=_0x2f4083+_0x380fa2(0x621)+_0x17891e[_0x380fa2(0x7aa)]+'_'+Math['random']()[_0x380fa2(0x9a3)](0x24)[_0x380fa2(0x18cf)](0x2,0x9)+'_'+(chatMessages[_0x2f4083]['length']-0x1);await db[_0x380fa2(0x464)]['add']({'id':_0x2360fd,'characterId':_0x2f4083,'timestamp':_0x17891e[_0x380fa2(0x7aa)],'messageOrder':chatMessages[_0x2f4083]['length']-0x1,'originalMessageId':_0x17891e['id'],'messageData':_0x17891e}),console[_0x380fa2(0xc0d)]('✅\x20[高效戳一戳]\x20戳一戳消息已保存到数据库');}catch(_0x2da7da){console[_0x380fa2(0x24ab)]('戳一戳消息单条保存失败，回退到批量保存:',_0x2da7da),saveChatMessages();}renderChatMessages(_0x2f4083),currentChatCharacter[_0x380fa2(0x4b7)]?Math['random']()<0.3&&setTimeout(()=>{const _0x2fb507=_0x380fa2,_0x678f0=_0x304940[_0x2fb507(0x582)]||'',_0x133d04=_0x304940[_0x2fb507(0xb42)]||'你',_0x13ae21={'id':Date[_0x2fb507(0x18e0)]()[_0x2fb507(0x9a3)](),'sender':_0x2fb507(0x212),'content':_0x1b9c45+_0x2fb507(0xb6d)+_0x133d04+_0x678f0,'timestamp':Date['now'](),'isPoke':!![]};chatMessages[_0x2f4083][_0x2fb507(0x6ee)](_0x13ae21);try{const _0x27b2c9=_0x2f4083+_0x2fb507(0x10b1)+_0x13ae21[_0x2fb507(0x7aa)]+'_'+Math[_0x2fb507(0x191c)]()[_0x2fb507(0x9a3)](0x24)[_0x2fb507(0x18cf)](0x2,0x9)+'_'+(chatMessages[_0x2f4083][_0x2fb507(0xcbf)]-0x1);db[_0x2fb507(0x464)]['add']({'id':_0x27b2c9,'characterId':_0x2f4083,'timestamp':_0x13ae21['timestamp'],'messageOrder':chatMessages[_0x2f4083][_0x2fb507(0xcbf)]-0x1,'originalMessageId':_0x13ae21['id'],'messageData':_0x13ae21})[_0x2fb507(0x1ccc)](()=>{const _0x327233=_0x2fb507;console[_0x327233(0xc0d)](_0x327233(0x242d));})[_0x2fb507(0x9e5)](_0x5990b5=>{const _0x4f620a=_0x2fb507;console[_0x4f620a(0x24ab)](_0x4f620a(0x1d32),_0x5990b5);});}catch(_0x2444b6){console[_0x2fb507(0x24ab)](_0x2fb507(0xad5),_0x2444b6),saveChatMessages();}renderChatMessages(_0x2f4083);},0x3e8+Math[_0x380fa2(0x191c)]()*0x7d0):Math[_0x380fa2(0x191c)]()<0.4&&setTimeout(()=>{const _0x144353=_0x380fa2,_0x524374=_0x304940['myPokeSuffix']||'',_0x521766={'id':Date[_0x144353(0x18e0)]()['toString'](),'sender':'system','content':_0x1b9c45+_0x144353(0x12e4)+_0x524374,'timestamp':Date[_0x144353(0x18e0)](),'isPoke':!![]};chatMessages[_0x2f4083][_0x144353(0x6ee)](_0x521766);try{const _0x1e5e7f=_0x2f4083+_0x144353(0x10b1)+_0x521766[_0x144353(0x7aa)]+'_'+Math[_0x144353(0x191c)]()[_0x144353(0x9a3)](0x24)[_0x144353(0x18cf)](0x2,0x9)+'_'+(chatMessages[_0x2f4083][_0x144353(0xcbf)]-0x1);db[_0x144353(0x464)][_0x144353(0xe1)]({'id':_0x1e5e7f,'characterId':_0x2f4083,'timestamp':_0x521766[_0x144353(0x7aa)],'messageOrder':chatMessages[_0x2f4083][_0x144353(0xcbf)]-0x1,'originalMessageId':_0x521766['id'],'messageData':_0x521766})['then'](()=>{const _0x4ab378=_0x144353;console[_0x4ab378(0xc0d)](_0x4ab378(0x1986));})[_0x144353(0x9e5)](_0xa445b6=>{const _0x534a97=_0x144353;console[_0x534a97(0x24ab)]('单聊戳一戳回应保存失败:',_0xa445b6);});}catch(_0x8e3e58){console[_0x144353(0x24ab)]('单聊戳一戳回应保存失败，回退到批量保存:',_0x8e3e58),saveChatMessages();}renderChatMessages(_0x2f4083);},0x3e8+Math[_0x380fa2(0x191c)]()*0x7d0);}function showChatOptions(){showModal('chat-options-modal');}function showSingleChatSelector(){hideModal('chat-options-modal'),showPersonaSelectionForSingleChat();}function showPersonaSelectionForSingleChat(){const _0x3c6f69=_0x2cf6d4,_0x8db33f='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal\x22\x20id=\x22persona-selection-modal\x22\x20style=\x22display:\x20flex;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22modal-title\x22>选择身份</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-close\x22\x20onclick=\x22hidePersonaSelectionModal()\x22>&times;</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22selection-description\x22>请选择你在这次对话中使用的身份面具</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22persona-selection-list\x22\x20id=\x22persona-selection-list\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+personas[_0x3c6f69(0xf6d)](_0x24a544=>_0x3c6f69(0x2162)+_0x24a544['id']+_0x3c6f69(0xabb)+(_0x24a544[_0x3c6f69(0x10f9)]?_0x3c6f69(0x1910)+_0x24a544[_0x3c6f69(0x10f9)]+_0x3c6f69(0x1051):'')+_0x3c6f69(0x113b)+(_0x24a544[_0x3c6f69(0x10f9)]?'':_0x24a544[_0x3c6f69(0x222f)]['charAt'](0x0))+_0x3c6f69(0x1d26)+_0x24a544[_0x3c6f69(0x222f)]+_0x3c6f69(0x185a)+truncateText(_0x24a544[_0x3c6f69(0x1c6f)]||_0x3c6f69(0x220a),0x64)+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22persona-selection-check\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-check\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20')[_0x3c6f69(0x140c)]('')+_0x3c6f69(0x33a),_0x200c3e=document[_0x3c6f69(0x566)]('persona-selection-modal');_0x200c3e&&_0x200c3e[_0x3c6f69(0x128)](),document['body'][_0x3c6f69(0x22ba)](_0x3c6f69(0x580),_0x8db33f),document[_0x3c6f69(0x1ed9)](_0x3c6f69(0x1e25))[_0x3c6f69(0x900)](_0x3d1ac4=>{const _0x2ef15c=_0x3c6f69;_0x3d1ac4[_0x2ef15c(0x167)](_0x2ef15c(0x1e62),function(){const _0x475e1f=_0x2ef15c;document[_0x475e1f(0x1ed9)](_0x475e1f(0x1e25))[_0x475e1f(0x900)](_0xeec50a=>_0xeec50a[_0x475e1f(0x226e)][_0x475e1f(0x128)]('selected')),this[_0x475e1f(0x226e)][_0x475e1f(0xe1)](_0x475e1f(0x876)),window[_0x475e1f(0xb9a)]=this[_0x475e1f(0x1f26)]['personaId'],document[_0x475e1f(0x566)]('confirm-persona-btn')[_0x475e1f(0x194e)]=![];});});}function hidePersonaSelectionModal(){const _0x111f83=_0x2cf6d4,_0x37feb7=document[_0x111f83(0x566)](_0x111f83(0x1393));_0x37feb7&&_0x37feb7['remove'](),window['selectedPersonaForChat']=null;}function confirmPersonaAndShowCharacters(){if(!window['selectedPersonaForChat'])return;hidePersonaSelectionModal(),showCharacterSelectionForSingleChat();}function showCharacterSelectionForSingleChat(){const _0x13b589=_0x2cf6d4,_0x407841=window[_0x13b589(0xb9a)];console['log'](_0x13b589(0x9f1)),console[_0x13b589(0xc0d)](_0x13b589(0x367),_0x407841);const _0x1f6c4e=document[_0x13b589(0x566)]('single-chat-body');_0x1f6c4e['innerHTML']='',characters[_0x13b589(0xcbf)]===0x0?_0x1f6c4e[_0x13b589(0xc02)]='<p\x20class=\x22empty-mount-chats\x22>还没有角色，请先创建角色</p>':characters['forEach'](_0x1f3efb=>{const _0x444ba8=_0x13b589,_0x2f7b2a=document[_0x444ba8(0x1ad8)](_0x444ba8(0x526)),_0x2595cf=contacts[_0x444ba8(0x23ec)](_0x1f3efb['id']);_0x2f7b2a[_0x444ba8(0x221)]=_0x444ba8(0x1b1e)+(_0x2595cf?_0x444ba8(0x176b):''),_0x2f7b2a['onclick']=()=>{const _0x3de37d=_0x444ba8;console[_0x3de37d(0xc0d)](_0x3de37d(0x156)),console[_0x3de37d(0xc0d)]('选中的角色:',_0x1f3efb[_0x3de37d(0x222f)]),console['log'](_0x3de37d(0x541),_0x407841),hideModal(_0x3de37d(0x1065)),startChatWithPersona(_0x1f3efb,_0x407841),window['selectedPersonaForChat']=null;};const _0x983ebb=_0x2595cf?'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-status-indicator\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-comments\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>已有对话</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20':'';_0x2f7b2a[_0x444ba8(0xc02)]=_0x444ba8(0x1e0d)+_0x1f3efb['color']+';\x20'+(_0x1f3efb[_0x444ba8(0x10f9)]?_0x444ba8(0x1910)+_0x1f3efb[_0x444ba8(0x10f9)]+_0x444ba8(0x1051):'')+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x1f3efb['avatarUrl']?'':_0x1f3efb[_0x444ba8(0x222f)][_0x444ba8(0x1518)](0x0))+_0x444ba8(0xa1c)+_0x1f3efb['name']+(_0x2595cf?_0x444ba8(0x2ea):'')+_0x444ba8(0x924)+truncateText(_0x1f3efb[_0x444ba8(0x1a84)]||'暂无描述',0x50)+_0x444ba8(0x2280)+_0x983ebb+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x1f6c4e[_0x444ba8(0x1925)](_0x2f7b2a);}),showModal(_0x13b589(0x1065));}async function startChatWithPersona(_0x24a931,_0x498452){const _0x5307fa=_0x2cf6d4;console[_0x5307fa(0xc0d)]('🔧\x20[面具调试]\x20startChatWithPersona\x20被调用，角色:',_0x24a931[_0x5307fa(0x222f)],_0x5307fa(0x2034),_0x498452);if(contacts[_0x5307fa(0x23ec)](_0x24a931['id'])){const _0x21e090=chatSettings[_0x24a931['id']]||{},_0x50ede1=personas[_0x5307fa(0x1aeb)](_0x439cd3=>_0x439cd3['id']===_0x21e090['selectedIdentityId']),_0x43700b=_0x50ede1?_0x50ede1['name']:_0x5307fa(0x1064);console[_0x5307fa(0xc0d)](_0x5307fa(0x201e),_0x43700b);const _0x4fe14a=confirm(_0x5307fa(0x80c)+_0x24a931[_0x5307fa(0x222f)]+_0x5307fa(0x2157)+(_0x5307fa(0x1edb)+_0x43700b+'\x0a\x0a')+_0x5307fa(0x1fd5)+_0x5307fa(0x189d));if(_0x4fe14a){startChat(_0x24a931);return;}else return;}console[_0x5307fa(0xc0d)](_0x5307fa(0x1988)),Object[_0x5307fa(0x16c7)](chatSettings)[_0x5307fa(0x900)](_0x5601e1=>{const _0x424375=_0x5307fa,_0x3d2903=chatSettings[_0x5601e1];if(_0x3d2903&&_0x3d2903['selectedIdentityId']){const _0x403a41=personas['find'](_0x436ce0=>_0x436ce0['id']===_0x3d2903[_0x424375(0x6a0)]);console[_0x424375(0xc0d)](_0x424375(0x11f)+_0x5601e1+_0x424375(0x11c)+(_0x403a41?_0x403a41['name']:'未知')+_0x424375(0x192)+_0x3d2903[_0x424375(0x6a0)]+')');}});if(_0x498452){console['log'](_0x5307fa(0x425));let _0x109510={};chatSettings[_0x24a931['id']]?(_0x109510=JSON[_0x5307fa(0x168e)](JSON[_0x5307fa(0x7fb)](chatSettings[_0x24a931['id']])),console[_0x5307fa(0xc0d)](_0x5307fa(0x1286))):console[_0x5307fa(0xc0d)]('🔧\x20[面具调试]\x20创建全新的设置对象');_0x109510[_0x5307fa(0x6a0)]=_0x498452;const _0x2b1d2e=personas['find'](_0x5a98e9=>_0x5a98e9['id']===_0x498452);_0x2b1d2e&&(_0x109510[_0x5307fa(0x13af)]=_0x2b1d2e['avatarUrl']||'',_0x109510['myChatNickname']=_0x2b1d2e[_0x5307fa(0x222f)]||'',console[_0x5307fa(0xc0d)]('🔧\x20[面具调试]\x20设置面具信息:',_0x2b1d2e[_0x5307fa(0x222f)],_0x5307fa(0x1a24),_0x2b1d2e[_0x5307fa(0x10f9)]?'有':'无'));chatSettings[_0x24a931['id']]=_0x109510;const _0x2a195e=_0x24a931['id']+'_'+(windowId||_0x5307fa(0xbf));chatSettings[_0x2a195e]=JSON[_0x5307fa(0x168e)](JSON[_0x5307fa(0x7fb)](_0x109510)),console[_0x5307fa(0xc0d)](_0x5307fa(0x20db)+_0x24a931['id']+_0x5307fa(0x1e18)+_0x2a195e),console[_0x5307fa(0xc0d)](_0x5307fa(0x1d53),chatSettings[_0x24a931['id']]),console[_0x5307fa(0xc0d)](_0x5307fa(0x28e)),Object[_0x5307fa(0x16c7)](chatSettings)[_0x5307fa(0x900)](_0x4f86dc=>{const _0x5941ea=_0x5307fa;if(_0x4f86dc!==_0x24a931['id']){const _0xfe95d9=chatSettings[_0x4f86dc];if(_0xfe95d9&&_0xfe95d9['selectedIdentityId']){const _0x522df3=personas['find'](_0x3f37bd=>_0x3f37bd['id']===_0xfe95d9['selectedIdentityId']);console[_0x5941ea(0xc0d)](_0x5941ea(0x1f88)+_0x4f86dc+_0x5941ea(0x11c)+(_0x522df3?_0x522df3[_0x5941ea(0x222f)]:'未知')+'\x20(ID:\x20'+_0xfe95d9[_0x5941ea(0x6a0)]+')');}}});try{await db[_0x5307fa(0xb08)][_0x5307fa(0x53a)]({'id':_0x24a931['id'],'chatId':_0x24a931['id'],'settings':_0x109510,'timestamp':Date[_0x5307fa(0x18e0)]()});if(windowId)try{await db[_0x5307fa(0x243d)][_0x5307fa(0x4a6)](_0x5307fa(0x1e9))[_0x5307fa(0x14a)]([_0x24a931['id'],windowId])[_0x5307fa(0xc2b)](),await db[_0x5307fa(0x243d)][_0x5307fa(0xe1)]({'id':_0x24a931['id']+'_'+windowId,'chatId':_0x24a931['id'],'windowId':windowId,'settings':JSON[_0x5307fa(0x168e)](JSON[_0x5307fa(0x7fb)](_0x109510)),'timestamp':Date['now']()}),console[_0x5307fa(0xc0d)](_0x5307fa(0x1525));}catch(_0xbf0728){console[_0x5307fa(0x17cc)](_0x5307fa(0x242b),_0xbf0728[_0x5307fa(0xd7a)]);}else console[_0x5307fa(0xc0d)]('🔧\x20[面具调试]\x20设置已保存到数据库（仅全局）');}catch(_0x326675){console[_0x5307fa(0x24ab)](_0x5307fa(0x22f7),_0x326675);}}console[_0x5307fa(0xc0d)]('🔧\x20[面具调试]\x20添加到联系人列表...'),contacts[_0x5307fa(0x6ee)](_0x24a931['id']),await saveContacts(),console[_0x5307fa(0xc0d)](_0x5307fa(0x1a01),contacts),renderMessageList(),console[_0x5307fa(0xc0d)]('🔧\x20[面具调试]\x20准备开始聊天...'),setTimeout(()=>{startChat(_0x24a931);},0x64);}function toggleGroupMemberSelection(_0x284745){const _0x549569=_0x2cf6d4,_0x29f9cd=selectedGroupMembers[_0x549569(0x167a)](_0x284745),_0x36e4ff=document['getElementById'](_0x549569(0x2cd)+_0x284745),_0x29f6be=_0x36e4ff['closest']('.group-member-item');if(_0x29f9cd>-0x1)selectedGroupMembers[_0x549569(0x220f)](_0x29f9cd,0x1),_0x36e4ff[_0x549569(0x226e)][_0x549569(0x128)](_0x549569(0x306)),_0x36e4ff[_0x549569(0xc02)]='',_0x29f6be[_0x549569(0x226e)]['remove'](_0x549569(0x876));else{if(selectedGroupMembers['length']>=0x14){alert('最多只能选择20个成员');return;}selectedGroupMembers[_0x549569(0x6ee)](_0x284745),_0x36e4ff['classList'][_0x549569(0xe1)](_0x549569(0x306)),_0x36e4ff[_0x549569(0xc02)]=_0x549569(0x1ee5),_0x29f6be['classList']['add'](_0x549569(0x876));}}function showGroupChatSelector(){const _0x62645e=_0x2cf6d4;hideModal(_0x62645e(0x6e5)),showPersonaSelectionForGroupChat();}function showPersonaSelectionForGroupChat(){const _0x3b5a2a=_0x2cf6d4,_0xc743a8=_0x3b5a2a(0xd93)+personas['map'](_0x387ea6=>'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22persona-selection-item\x22\x20data-persona-id=\x22'+_0x387ea6['id']+_0x3b5a2a(0x533)+(_0x387ea6[_0x3b5a2a(0x10f9)]?_0x3b5a2a(0x191a)+_0x387ea6[_0x3b5a2a(0x10f9)]+_0x3b5a2a(0x902):'')+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x387ea6[_0x3b5a2a(0x10f9)]?'':_0x387ea6['name']['charAt'](0x0))+_0x3b5a2a(0x1d26)+_0x387ea6[_0x3b5a2a(0x222f)]+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22persona-selection-desc\x22>'+truncateText(_0x387ea6[_0x3b5a2a(0x1c6f)]||_0x3b5a2a(0x220a),0x64)+_0x3b5a2a(0x322))[_0x3b5a2a(0x140c)]('')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-secondary\x22\x20onclick=\x22hidePersonaSelectionGroupModal()\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-primary\x22\x20id=\x22confirm-group-persona-btn\x22\x20disabled>下一步：设置群聊</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x233214=document[_0x3b5a2a(0x566)](_0x3b5a2a(0x14d7));if(_0x233214)_0x233214[_0x3b5a2a(0x128)]();document[_0x3b5a2a(0x172c)][_0x3b5a2a(0x22ba)](_0x3b5a2a(0x580),_0xc743a8);let _0x3f2e5e=null;document['querySelectorAll']('#persona-selection-group-modal\x20.persona-selection-item')['forEach'](_0x3e0b04=>{const _0x2bd01d=_0x3b5a2a;_0x3e0b04[_0x2bd01d(0x167)](_0x2bd01d(0x1e62),function(){const _0x193eb0=_0x2bd01d;document[_0x193eb0(0x1ed9)](_0x193eb0(0x1e1))[_0x193eb0(0x900)](_0x3ddf34=>_0x3ddf34['classList'][_0x193eb0(0x128)](_0x193eb0(0x876))),this['classList']['add']('selected'),_0x3f2e5e=this[_0x193eb0(0x1f26)][_0x193eb0(0x202d)],document[_0x193eb0(0x566)](_0x193eb0(0x1dd1))[_0x193eb0(0x194e)]=![],console[_0x193eb0(0xc0d)](_0x193eb0(0x1707),_0x3f2e5e,_0x193eb0(0x1706),this[_0x193eb0(0x15b8)](_0x193eb0(0xb0c))[_0x193eb0(0x21dc)]);});}),document[_0x3b5a2a(0x566)](_0x3b5a2a(0x1dd1))['onclick']=()=>{const _0x54ee1c=_0x3b5a2a;console[_0x54ee1c(0xc0d)](_0x54ee1c(0x22a3),_0x3f2e5e),_0x3f2e5e?(console['log'](_0x54ee1c(0x3e7),_0x3f2e5e),confirmPersonaAndShowGroupSettings(_0x3f2e5e)):(console[_0x54ee1c(0x24ab)]('❌\x20未选择身份就点击了下一步'),alert('请先选择一个身份面具'));};}function hidePersonaSelectionGroupModal(){const _0x99977a=_0x2cf6d4,_0x17fb28=document[_0x99977a(0x566)](_0x99977a(0x14d7));if(_0x17fb28)_0x17fb28['remove']();}function confirmPersonaAndShowGroupSettings(_0x1ba271){const _0x1cf6b2=_0x2cf6d4;console[_0x1cf6b2(0xc0d)]('✅\x20confirmPersonaAndShowGroupSettings被调用，接收到的personaId:',_0x1ba271),hidePersonaSelectionGroupModal(),showGroupChatMemberSelection(_0x1ba271);}function showGroupChatMemberSelection(_0x5924bc){const _0x4d6655=_0x2cf6d4;console['log'](_0x4d6655(0x132a),_0x5924bc),window[_0x4d6655(0x135)]=_0x5924bc,document[_0x4d6655(0x566)](_0x4d6655(0x20ec))[_0x4d6655(0xc34)]='',selectedGroupMembers=[];const _0x4e5aad=document[_0x4d6655(0x566)](_0x4d6655(0x12fa));_0x4e5aad[_0x4d6655(0xc02)]='';characters['length']<0x2?_0x4e5aad[_0x4d6655(0xc02)]=_0x4d6655(0x1749):characters['forEach'](_0x2d1acc=>{const _0x53c1a5=_0x4d6655,_0x33f3c0=document[_0x53c1a5(0x1ad8)]('div');_0x33f3c0[_0x53c1a5(0x221)]='group-member-item',_0x33f3c0[_0x53c1a5(0x11cf)]=()=>toggleGroupMemberSelection(_0x2d1acc['id']),_0x33f3c0[_0x53c1a5(0xc02)]=_0x53c1a5(0x1265)+_0x2d1acc['id']+_0x53c1a5(0x1ddb)+_0x2d1acc[_0x53c1a5(0x2099)]+';\x20'+(_0x2d1acc[_0x53c1a5(0x10f9)]?_0x53c1a5(0x191a)+_0x2d1acc[_0x53c1a5(0x10f9)]+'\x27);':'')+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x2d1acc[_0x53c1a5(0x10f9)]?'':_0x2d1acc[_0x53c1a5(0x222f)]['charAt'](0x0))+_0x53c1a5(0xa1c)+_0x2d1acc[_0x53c1a5(0x222f)]+_0x53c1a5(0x1a0a)+truncateText(_0x2d1acc[_0x53c1a5(0x1a84)]||_0x53c1a5(0x1b7a),0x50)+_0x53c1a5(0x17fe),_0x4e5aad[_0x53c1a5(0x1925)](_0x33f3c0);});console[_0x4d6655(0xc0d)]('✅\x20在第一个位置绑定创建按钮，personaId:',_0x5924bc);const _0x36d0a3=document['getElementById'](_0x4d6655(0x6c5))[_0x4d6655(0x15b8)](_0x4d6655(0x71c));_0x36d0a3[_0x4d6655(0x11cf)]=()=>{const _0x1f1537=_0x4d6655;console[_0x1f1537(0xc0d)]('✅\x20第一个位置的创建群聊按钮被点击，直接使用参数personaId:',_0x5924bc),createGroupChat(_0x5924bc);},showModal(_0x4d6655(0x6c5));}function toggleGroupMemberSelection(_0x59c033){const _0x5f21ba=_0x2cf6d4,_0x45ae83=selectedGroupMembers[_0x5f21ba(0x167a)](_0x59c033),_0x293b84=document['getElementById'](_0x5f21ba(0x2cd)+_0x59c033),_0x34ae93=_0x293b84[_0x5f21ba(0x2026)](_0x5f21ba(0x2471));if(_0x45ae83>-0x1)selectedGroupMembers[_0x5f21ba(0x220f)](_0x45ae83,0x1),_0x293b84[_0x5f21ba(0x226e)][_0x5f21ba(0x128)](_0x5f21ba(0x306)),_0x293b84[_0x5f21ba(0xc02)]='',_0x34ae93[_0x5f21ba(0x226e)][_0x5f21ba(0x128)]('selected');else{if(selectedGroupMembers['length']>=0x14){alert(_0x5f21ba(0x1f2));return;}selectedGroupMembers['push'](_0x59c033),_0x293b84[_0x5f21ba(0x226e)]['add']('checked'),_0x293b84[_0x5f21ba(0xc02)]=_0x5f21ba(0x1ee5),_0x34ae93[_0x5f21ba(0x226e)][_0x5f21ba(0xe1)](_0x5f21ba(0x876));}}async function createGroupChat(_0x35171a){const _0x5585dc=_0x2cf6d4;console['log'](_0x5585dc(0x873)+_0x35171a);const _0x26e187=document['getElementById'](_0x5585dc(0x20ec))[_0x5585dc(0xc34)][_0x5585dc(0x1424)]();if(!_0x26e187)return alert(_0x5585dc(0x253d));if(selectedGroupMembers[_0x5585dc(0xcbf)]<0x2)return alert(_0x5585dc(0x23c));const _0x234a8a=selectedGroupMembers[_0x5585dc(0xf6d)](_0x1f3685=>{const _0x173f4d=_0x5585dc,_0x296706=characters[_0x173f4d(0x1aeb)](_0x2e6c01=>_0x2e6c01['id']===_0x1f3685);return{'id':_0x296706['id'],'name':_0x296706[_0x173f4d(0x222f)],'persona':_0x296706[_0x173f4d(0x1a84)],'avatarUrl':_0x296706[_0x173f4d(0x10f9)],'color':_0x296706[_0x173f4d(0x2099)]};}),_0x543d45={'id':'group_'+Date[_0x5585dc(0x18e0)]()[_0x5585dc(0x9a3)](),'name':_0x26e187,'members':_0x234a8a,'isGroup':!![],'createdAt':new Date()[_0x5585dc(0xa4b)](),'settings':{'myPersona':'','myNickname':'我'}};if(_0x35171a){const _0x2dd34f=personas[_0x5585dc(0x1aeb)](_0x55b461=>_0x55b461['id']===_0x35171a);if(_0x2dd34f){_0x543d45['settings'][_0x5585dc(0x835)]=_0x2dd34f['description']||_0x2dd34f['name'],_0x543d45[_0x5585dc(0x1fbb)]['myNickname']=_0x2dd34f['name'];const _0x49c586={'selectedIdentityId':_0x35171a,'myChatAvatar':_0x2dd34f[_0x5585dc(0x10f9)],'myChatNickname':_0x2dd34f[_0x5585dc(0x222f)],'selectedPersonaData':{..._0x2dd34f},'myPersona':_0x2dd34f[_0x5585dc(0x1c6f)]||_0x2dd34f[_0x5585dc(0x222f)]};!window[_0x5585dc(0xb08)]&&(window[_0x5585dc(0xb08)]={}),window[_0x5585dc(0xb08)][_0x543d45['id']]=_0x49c586,await db[_0x5585dc(0xb08)][_0x5585dc(0x53a)]({'id':_0x543d45['id'],'chatId':_0x543d45['id'],'settings':_0x49c586}),console['log'](_0x5585dc(0x163f));}else console['error']('❌\x20创建群聊时未找到ID为\x20'+_0x35171a+_0x5585dc(0xf99));}if(!groupChats)groupChats=[];groupChats[_0x5585dc(0x6ee)](_0x543d45),await saveGroupChats(),await GroupChatStateManager[_0x5585dc(0x387)](_0x543d45['id']),hideModal('group-chat-modal'),renderMessageList(),alert(_0x5585dc(0x11ee)+_0x26e187+_0x5585dc(0x1c1e));}async function saveGroupChats(){const _0x1c0947=_0x2cf6d4;try{console[_0x1c0947(0xc0d)](_0x1c0947(0x8ec),groupChats);(!groupChats||!Array[_0x1c0947(0x1bcc)](groupChats))&&(console[_0x1c0947(0x24ab)](_0x1c0947(0x1ea6),groupChats),groupChats=[]);const _0x3617e1=groupChats['filter'](_0x1b084a=>{const _0x4cdc0c=_0x1c0947;if(!_0x1b084a||!_0x1b084a['id']||!_0x1b084a[_0x4cdc0c(0x222f)])return console[_0x4cdc0c(0x17cc)](_0x4cdc0c(0x134e),_0x1b084a),![];return!![];});_0x3617e1[_0x1c0947(0xcbf)]!==groupChats['length']&&(groupChats=_0x3617e1,console['log']('已过滤无效数据，有效群聊数量:',groupChats['length']));await db[_0x1c0947(0x174a)]('rw',db['groupChats'],async()=>{const _0x2b9ab6=_0x1c0947;await db[_0x2b9ab6(0x14ee)][_0x2b9ab6(0x2215)]();for(const _0x226600 of groupChats){try{await db[_0x2b9ab6(0x14ee)][_0x2b9ab6(0xe1)](_0x226600);}catch(_0x2f36e0){console[_0x2b9ab6(0x17cc)](_0x2b9ab6(0xc2c),_0x226600['id'],_0x2f36e0),await db[_0x2b9ab6(0x14ee)][_0x2b9ab6(0x53a)](_0x226600);}}}),console[_0x1c0947(0xc0d)](_0x1c0947(0x154e));try{const _0x44eb26=JSON[_0x1c0947(0x7fb)](groupChats)[_0x1c0947(0xcbf)],_0x356726=0x400*0x400;_0x44eb26<_0x356726?(localStorage[_0x1c0947(0x2055)]('groupChats',JSON[_0x1c0947(0x7fb)](groupChats)),console[_0x1c0947(0xc0d)](_0x1c0947(0x35b)+(_0x44eb26/0x400)[_0x1c0947(0x3cd)](0x1)+_0x1c0947(0x111))):(localStorage[_0x1c0947(0x1c95)](_0x1c0947(0x14ee)),console[_0x1c0947(0xc0d)](_0x1c0947(0x1573)+(_0x44eb26/0x400/0x400)[_0x1c0947(0x3cd)](0x1)+'MB)，跳过localStorage备份，仅使用IndexedDB'));}catch(_0x3be913){console[_0x1c0947(0x17cc)](_0x1c0947(0x10e),_0x3be913);if(_0x3be913[_0x1c0947(0x222f)]===_0x1c0947(0xf22))try{localStorage[_0x1c0947(0x1c95)](_0x1c0947(0x14ee)),console[_0x1c0947(0xc0d)]('localStorage容量不足，已清理群聊备份');}catch(_0xbb5acb){console['warn'](_0x1c0947(0x432),_0xbb5acb);}}}catch(_0x5be062){console[_0x1c0947(0x24ab)]('保存群聊到IndexedDB失败:',_0x5be062),console[_0x1c0947(0x24ab)](_0x1c0947(0xd29),_0x5be062[_0x1c0947(0x222f)],_0x5be062[_0x1c0947(0xd7a)]);try{localStorage['setItem'](_0x1c0947(0x14ee),JSON[_0x1c0947(0x7fb)](groupChats||[])),console[_0x1c0947(0xc0d)](_0x1c0947(0x63d)),showToast(_0x1c0947(0x979),'info');}catch(_0x1d4a05){console[_0x1c0947(0x24ab)]('localStorage保存也失败:',_0x1d4a05),console[_0x1c0947(0x24ab)]('localStorage错误详情:',_0x1d4a05[_0x1c0947(0x222f)],_0x1d4a05[_0x1c0947(0xd7a)]);_0x1d4a05['name']===_0x1c0947(0xf22)?alert('存储空间不足，请清理一些数据后重试'):alert('保存群聊失败，请尝试刷新页面重新操作');groupChats[_0x1c0947(0x1d5d)]();throw _0x1d4a05;}}}function renderScheduleTimes(){const _0x1e9769=_0x2cf6d4,_0x32435e=document[_0x1e9769(0x566)](_0x1e9769(0x17f));if(!_0x32435e)return;const _0x3692df=getCurrentChatSettings(),_0x5f3648=_0x3692df[_0x1e9769(0x139c)]||[];_0x32435e['innerHTML']='',_0x5f3648[_0x1e9769(0x900)]((_0x5c7602,_0x33df18)=>{const _0x21e560=_0x1e9769,_0x21b7a2=document['createElement'](_0x21e560(0x526));_0x21b7a2['className']=_0x21e560(0x1ddc),_0x21b7a2[_0x21e560(0xc02)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22time\x22\x20value=\x22'+_0x5c7602+_0x21e560(0x166e)+_0x33df18+',\x20this.value)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22removeScheduleTime('+_0x33df18+')\x22>×</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x32435e[_0x21e560(0x1925)](_0x21b7a2);});}async function addScheduleTime(){const _0x11045a=_0x2cf6d4,_0x2c1936=getCurrentChatSettings();!_0x2c1936['scheduleTimes']&&(_0x2c1936[_0x11045a(0x139c)]=[]);if(_0x2c1936['scheduleTimes']['length']>=0xa){alert(_0x11045a(0x2291));return;}_0x2c1936[_0x11045a(0x139c)][_0x11045a(0x6ee)]('09:00'),await saveCurrentChatSettings(_0x2c1936),renderScheduleTimes();}async function updateScheduleTime(_0x46d5b0,_0x2216c7){const _0x2829c8=_0x2cf6d4,_0x508a48=getCurrentChatSettings();_0x508a48[_0x2829c8(0x139c)]&&_0x508a48[_0x2829c8(0x139c)][_0x46d5b0]!==undefined&&(_0x508a48[_0x2829c8(0x139c)][_0x46d5b0]=_0x2216c7,await saveCurrentChatSettings(_0x508a48));}async function removeScheduleTime(_0x2159d2){const _0x928686=_0x2cf6d4,_0x46278d=getCurrentChatSettings();_0x46278d['scheduleTimes']&&_0x46278d[_0x928686(0x139c)][_0x2159d2]!==undefined&&(_0x46278d[_0x928686(0x139c)][_0x928686(0x220f)](_0x2159d2,0x1),await saveCurrentChatSettings(_0x46278d),renderScheduleTimes());}async function saveScheduleSettings(){const _0x4e7c0c=_0x2cf6d4,_0x15622c=getCurrentChatSettings();_0x15622c['scheduleEnabled']=document[_0x4e7c0c(0x566)](_0x4e7c0c(0x5e4))[_0x4e7c0c(0x306)],await saveCurrentChatSettings(_0x15622c),hideModal(_0x4e7c0c(0xe62)),showToast('定时发布设置已保存',_0x4e7c0c(0xb27));}function showWorldbookMountSettings(){const _0x3f98f2=_0x2cf6d4,_0x30e2d0=getCurrentChatSettings();console[_0x3f98f2(0xc0d)](_0x3f98f2(0x1801),{'worldbookMountEnabled':_0x30e2d0[_0x3f98f2(0x9af)],'selectedWorldbooks':_0x30e2d0[_0x3f98f2(0xefa)]}),document[_0x3f98f2(0x566)]('worldbook-mount-enabled')[_0x3f98f2(0x306)]=_0x30e2d0[_0x3f98f2(0x9af)]||![],toggleWorldbookMountDetails(),document['getElementById'](_0x3f98f2(0x16ac))['onchange']=toggleWorldbookMountDetails,renderWorldbookMountList(),showModal(_0x3f98f2(0x14d2));}function toggleWorldbookMountDetails(){const _0x2f98e9=_0x2cf6d4,_0x3806e3=document[_0x2f98e9(0x566)](_0x2f98e9(0x16ac))['checked'];document[_0x2f98e9(0x566)]('worldbook-mount-details')[_0x2f98e9(0x655)]['display']=_0x3806e3?_0x2f98e9(0x2d4):'none',updateWorldbookMountDisplay()[_0x2f98e9(0x9e5)](_0x5d4181=>console['error'](_0x2f98e9(0x1581),_0x5d4181));}async function updateWorldbookMountDisplay(){const _0x15cbff=_0x2cf6d4;if(!currentChatCharacter){console[_0x15cbff(0xc0d)](_0x15cbff(0x1d0a));return;}const _0x5aca77=document['getElementById'](_0x15cbff(0x23c6));if(!_0x5aca77){console[_0x15cbff(0xc0d)]('更新世界书挂载显示：无显示元素，跳过操作');return;}try{const _0x133e90=await getAsyncChatSettings();if(!_0x133e90[_0x15cbff(0x9af)]){_0x5aca77['textContent']=_0x15cbff(0xd21);return;}const _0x314796=_0x133e90[_0x15cbff(0xefa)]||[],_0x1f28c4=_0x314796[_0x15cbff(0x803)](_0x425c8c=>{const _0x25d7d3=_0x15cbff,_0x3af2d8=worldbooks[_0x25d7d3(0x1aeb)](_0x1f59bd=>_0x1f59bd['id']===_0x425c8c);return _0x3af2d8;});if(_0x1f28c4[_0x15cbff(0xcbf)]!==_0x314796[_0x15cbff(0xcbf)]){_0x133e90['selectedWorldbooks']=_0x1f28c4;try{await saveCurrentChatSettings(_0x133e90);}catch(_0x299892){console[_0x15cbff(0x24ab)]('🚨\x20保存清理后的设置失败:',_0x299892);}}if(_0x1f28c4[_0x15cbff(0xcbf)]===0x0)_0x5aca77[_0x15cbff(0x21dc)]='已启用但未选择';else{if(_0x1f28c4[_0x15cbff(0xcbf)]===0x1){const _0xe83f91=worldbooks['find'](_0x34cd89=>_0x34cd89['id']===_0x1f28c4[0x0]),_0x6382c0=_0xe83f91?_0x15cbff(0x2bd)+_0xe83f91['title']:_0x15cbff(0x11bb);_0x5aca77[_0x15cbff(0x21dc)]=_0x6382c0;}else{const _0x3554b4=_0x15cbff(0x2bd)+_0x1f28c4['length']+'个';_0x5aca77[_0x15cbff(0x21dc)]=_0x3554b4;}}}catch(_0x4e8bb4){console[_0x15cbff(0x24ab)](_0x15cbff(0x20e6),_0x4e8bb4),_0x5aca77[_0x15cbff(0x21dc)]=_0x15cbff(0x361);}}function renderWorldbookMountList(){const _0x2b8eb5=_0x2cf6d4,_0x1a5df2=document['getElementById']('worldbook-mount-list');_0x1a5df2[_0x2b8eb5(0xc02)]='';const _0x1319a6=worldbooks['filter'](_0x52531f=>!_0x52531f[_0x2b8eb5(0x58b)]);if(_0x1319a6[_0x2b8eb5(0xcbf)]===0x0){_0x1a5df2['innerHTML']='<p\x20class=\x22empty-mount-chats\x22>暂无局部世界书，请先在世界书应用中创建</p>';return;}const _0x3f474d=getCurrentChatSettings();let _0x39fec8=_0x3f474d['selectedWorldbooks']||[];console['log'](_0x2b8eb5(0x9d2),_0x39fec8),console[_0x2b8eb5(0xc0d)](_0x2b8eb5(0xf91),_0x1319a6[_0x2b8eb5(0xf6d)](_0x4f7bcc=>_0x4f7bcc[_0x2b8eb5(0x1c18)]+'\x20('+_0x4f7bcc['id']+')'));const _0x13d796=_0x39fec8[_0x2b8eb5(0x803)](_0x47379d=>{const _0x5f1551=_0x2b8eb5,_0x3d12ef=_0x1319a6[_0x5f1551(0x1aeb)](_0x335f90=>_0x335f90['id']===_0x47379d);return!_0x3d12ef&&console['warn'](_0x5f1551(0x1e8b)+_0x47379d+_0x5f1551(0x16a0)),_0x3d12ef;});_0x13d796[_0x2b8eb5(0xcbf)]!==_0x39fec8[_0x2b8eb5(0xcbf)]&&(console[_0x2b8eb5(0xc0d)](_0x2b8eb5(0x150b)+_0x39fec8[_0x2b8eb5(0xcbf)]+_0x2b8eb5(0x214b)+_0x13d796['length']+'\x20个'),_0x3f474d[_0x2b8eb5(0xefa)]=_0x13d796,_0x39fec8=_0x13d796,saveCurrentChatSettings(_0x3f474d));_0x1319a6[_0x2b8eb5(0x900)](_0x381c9f=>{const _0x52060e=_0x2b8eb5,_0x5e96dd=document['createElement'](_0x52060e(0x526));_0x5e96dd['className']='mount-item\x20worldbook-mount-item';const _0x3e55ba=_0x39fec8['includes'](_0x381c9f['id']);console[_0x52060e(0xc0d)](_0x52060e(0x100a)+_0x381c9f['title']+_0x52060e(0x3a7)+_0x381c9f['id']+')\x20选中状态:',_0x3e55ba),_0x5e96dd[_0x52060e(0xc02)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22checkbox\x22\x20id=\x22worldbook-'+_0x381c9f['id']+_0x52060e(0x8c3)+_0x381c9f['id']+'\x22\x20'+(_0x3e55ba?'checked':'')+_0x52060e(0x2450)+_0x381c9f[_0x52060e(0x1c18)]+_0x52060e(0x16eb)+(_0x381c9f[_0x52060e(0x1423)][_0x52060e(0xcbf)]>0x64?_0x381c9f['content'][_0x52060e(0x4b2)](0x0,0x64)+'...':_0x381c9f[_0x52060e(0x1423)])+_0x52060e(0x24b9)+new Date(_0x381c9f[_0x52060e(0xd70)])[_0x52060e(0x177f)](_0x52060e(0x1c0b))+_0x52060e(0x4a0)+_0x381c9f[_0x52060e(0x1423)]['length']+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x5e96dd[_0x52060e(0x11cf)]=_0x46dad8=>{const _0x7a3d33=_0x52060e;if(_0x46dad8['target'][_0x7a3d33(0x23df)]!==_0x7a3d33(0x2284)){const _0x44b41a=_0x5e96dd[_0x7a3d33(0x15b8)](_0x7a3d33(0x9a7));_0x44b41a[_0x7a3d33(0x306)]=!_0x44b41a[_0x7a3d33(0x306)];}},_0x1a5df2['appendChild'](_0x5e96dd);});const _0x48861e=document['createElement']('div');_0x48861e[_0x2b8eb5(0x221)]='worldbook-global-info',_0x48861e['innerHTML']=_0x2b8eb5(0xfcb),_0x1a5df2[_0x2b8eb5(0x1925)](_0x48861e);}async function saveWorldbookMountSettings(){const _0x3002fb=_0x2cf6d4;try{const _0x12b399=await getAsyncChatSettings();_0x12b399['worldbookMountEnabled']=document[_0x3002fb(0x566)](_0x3002fb(0x16ac))[_0x3002fb(0x306)];if(!_0x12b399['worldbookMountEnabled'])_0x12b399[_0x3002fb(0xefa)]=[],console[_0x3002fb(0xc0d)]('🔧\x20[世界书修复]\x20总开关关闭，已清空选中的世界书列表');else{const _0x424339=document['querySelectorAll'](_0x3002fb(0x6b1));_0x12b399[_0x3002fb(0xefa)]=Array[_0x3002fb(0x2308)](_0x424339)[_0x3002fb(0xf6d)](_0x55aded=>_0x55aded['value']);}await saveCurrentChatSettings(_0x12b399),await updateWorldbookMountDisplay(),hideModal(_0x3002fb(0x14d2));const _0x77bd0=_0x12b399['selectedWorldbooks']?_0x12b399[_0x3002fb(0xefa)][_0x3002fb(0xcbf)]:0x0;if(_0x12b399[_0x3002fb(0x9af)]&&_0x77bd0>0x0)showToast(_0x3002fb(0x1901)+_0x77bd0+'\x20个世界书',_0x3002fb(0xb27));else _0x12b399[_0x3002fb(0x9af)]?showToast(_0x3002fb(0x22ad),_0x3002fb(0x2422)):showToast('世界书挂载已关闭',_0x3002fb(0x2422));}catch(_0x5807d9){console['error'](_0x3002fb(0x45c),_0x5807d9),showToast(_0x3002fb(0xf69),_0x3002fb(0x24ab));}}function showPersonaSwitchModal(){const _0x304886=_0x2cf6d4;renderPersonaSwitchList(),showModal(_0x304886(0x127a));}function renderPersonaSwitchList(){const _0x5cac70=_0x2cf6d4,_0xb3d8ce=document[_0x5cac70(0x566)](_0x5cac70(0x1efd));if(!_0xb3d8ce)return;const _0x284d9f=getCurrentPersonaId();let _0x32bf68='';const _0x4df5e4=!_0x284d9f||_0x284d9f===_0x5cac70(0xbf),_0x797e8=getCurrentChatSettings(),_0x2b3ec6=_0x797e8[_0x5cac70(0x6a0)]?personas[_0x5cac70(0x1aeb)](_0x13c03a=>_0x13c03a['id']===_0x797e8[_0x5cac70(0x6a0)]):null,_0x502a62=_0x2b3ec6&&_0x2b3ec6[_0x5cac70(0x10f9)]?'<img\x20src=\x22'+_0x2b3ec6[_0x5cac70(0x10f9)]+_0x5cac70(0x1ca8)+_0x2b3ec6['name']+'\x22>':_0x5cac70(0x976),_0x50c6c3=_0x2b3ec6?_0x2b3ec6[_0x5cac70(0x222f)]+_0x5cac70(0x109b):'默认身份';_0x32bf68+=_0x5cac70(0x2cb)+(_0x4df5e4?_0x5cac70(0x876):'')+'\x22\x20onclick=\x22switchToPersona(\x27default\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22persona-item-avatar\x20'+(_0x2b3ec6&&_0x2b3ec6[_0x5cac70(0x10f9)]?'':_0x5cac70(0x1ad0))+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x502a62+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22persona-item-name\x22>'+_0x50c6c3+_0x5cac70(0x24bf),personas[_0x5cac70(0x900)](_0x2e2809=>{const _0x19bd0c=_0x5cac70,_0x2ae193=_0x284d9f===_0x2e2809['id'],_0x87529a=_0x2e2809[_0x19bd0c(0x10f9)]||_0x2e2809['avatar'],_0xdeec9a=_0x87529a?_0x19bd0c(0x2001)+_0x87529a+_0x19bd0c(0x1ca8)+_0x2e2809[_0x19bd0c(0x222f)]+'\x22>':_0x19bd0c(0x124a);_0x32bf68+=_0x19bd0c(0x1d25)+(_0x2ae193?_0x19bd0c(0x876):'')+_0x19bd0c(0xaaf)+_0x2e2809['id']+'\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22persona-item-avatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0xdeec9a+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22persona-item-name\x22>'+_0x2e2809['name']+_0x19bd0c(0x92d);}),_0xb3d8ce['innerHTML']=_0x32bf68;}async function switchToPersona(_0x23e112){const _0x54b011=_0x2cf6d4;try{if(!currentChatCharacter){showToast(_0x54b011(0x12a8),'error');return;}const _0xcbeaaa=await getAsyncChatSettings(currentChatCharacter['id']);if(_0x23e112===_0x54b011(0xbf)){const _0x2a8b8e=_0xcbeaaa['selectedIdentityId']?personas[_0x54b011(0x1aeb)](_0x50a195=>_0x50a195['id']===_0xcbeaaa[_0x54b011(0x6a0)]):null;_0xcbeaaa[_0x54b011(0x13af)]=_0x2a8b8e?.[_0x54b011(0x10f9)]||'',_0xcbeaaa[_0x54b011(0x433)]=null;}else{const _0x3fa681=personas[_0x54b011(0x1aeb)](_0x1502b9=>_0x1502b9['id']===_0x23e112);_0xcbeaaa[_0x54b011(0x13af)]=_0x3fa681?.[_0x54b011(0x10f9)]||'',_0xcbeaaa[_0x54b011(0x433)]=_0x23e112;}await saveCurrentChatSettings(_0xcbeaaa),updateCurrentPersonaDisplay();currentChatCharacter&&renderChatMessages(currentChatCharacter['id']);hideModal(_0x54b011(0x127a));let _0x2fa7fc;if(_0x23e112==='default'){const _0x1c4b9c=getCurrentChatSettings(),_0x4639a2=_0x1c4b9c[_0x54b011(0x6a0)]?personas[_0x54b011(0x1aeb)](_0x28e64e=>_0x28e64e['id']===_0x1c4b9c['selectedIdentityId']):null;_0x2fa7fc=_0x4639a2?_0x4639a2['name']+_0x54b011(0x109b):_0x54b011(0xc2a);}else _0x2fa7fc=personas[_0x54b011(0x1aeb)](_0x2efd1a=>_0x2efd1a['id']===_0x23e112)?.[_0x54b011(0x222f)]||'未知面具';showToast(_0x54b011(0x134d)+_0x2fa7fc,_0x54b011(0xb27)),console[_0x54b011(0xc0d)](_0x54b011(0xd03),{'characterId':currentChatCharacter['id'],'personaId':_0x23e112,'personaName':_0x2fa7fc});}catch(_0x216e48){console[_0x54b011(0x24ab)]('❌\x20面具切换失败:',_0x216e48),showToast(_0x54b011(0x113f),_0x54b011(0x24ab));}}function getCurrentPersonaId(){const _0x55ce89=_0x2cf6d4;if(!currentChatCharacter)return null;const _0x42dd45=getCurrentChatSettings();return _0x42dd45['currentPersonaId']||_0x55ce89(0xbf);}function updateCurrentPersonaDisplay(){const _0x4794b3=_0x2cf6d4,_0x11d9e4=document[_0x4794b3(0x566)](_0x4794b3(0x1338));if(!_0x11d9e4)return;const _0x1c1915=getCurrentPersonaId();if(!_0x1c1915||_0x1c1915===_0x4794b3(0xbf)){const _0x10d8e8=getCurrentChatSettings(),_0x3b2a22=_0x10d8e8[_0x4794b3(0x6a0)]?personas['find'](_0x3a5988=>_0x3a5988['id']===_0x10d8e8[_0x4794b3(0x6a0)]):null,_0xdd6f85=document[_0x4794b3(0x566)](_0x4794b3(0x1af2));_0xdd6f85&&(_0x3b2a22&&_0x3b2a22[_0x4794b3(0x10f9)]?_0xdd6f85[_0x4794b3(0xc02)]=_0x4794b3(0x2001)+_0x3b2a22[_0x4794b3(0x10f9)]+_0x4794b3(0x1ca8)+_0x3b2a22[_0x4794b3(0x222f)]+_0x4794b3(0x1177):_0xdd6f85['innerHTML']=_0x4794b3(0x124a));}else{const _0x10c97d=personas[_0x4794b3(0x1aeb)](_0x4e99be=>_0x4e99be['id']===_0x1c1915),_0x5556df=_0x10c97d&&(_0x10c97d['avatarUrl']||_0x10c97d[_0x4794b3(0x107f)]);if(_0x5556df){const _0x1ccdff=document[_0x4794b3(0x566)](_0x4794b3(0x1af2));_0x1ccdff&&(_0x1ccdff['innerHTML']=_0x4794b3(0x2001)+_0x5556df+_0x4794b3(0x1ca8)+_0x10c97d[_0x4794b3(0x222f)]+_0x4794b3(0x1177));}else{const _0x501776=document[_0x4794b3(0x566)](_0x4794b3(0x1af2));_0x501776&&(_0x501776[_0x4794b3(0xc02)]=_0x4794b3(0x124a));}}}function compressImage(_0x434422,_0x521eab=0x12c,_0x13e628=0.8){return new Promise(_0x4306d4=>{const _0x4b6081=_0x3a81,_0x3db4f4=new Image();_0x3db4f4[_0x4b6081(0xc28)]=function(){const _0x3decaa=_0x4b6081,_0x5ecdd0=document[_0x3decaa(0x1ad8)](_0x3decaa(0x1def)),_0x2e5c59=_0x5ecdd0[_0x3decaa(0x20ff)]('2d');let {width:_0x36a248,height:_0x3379e6}=_0x3db4f4;_0x36a248>_0x3379e6?_0x36a248>_0x521eab&&(_0x3379e6=_0x3379e6*_0x521eab/_0x36a248,_0x36a248=_0x521eab):_0x3379e6>_0x521eab&&(_0x36a248=_0x36a248*_0x521eab/_0x3379e6,_0x3379e6=_0x521eab);_0x5ecdd0[_0x3decaa(0xaab)]=_0x36a248,_0x5ecdd0[_0x3decaa(0x16b8)]=_0x3379e6,_0x2e5c59[_0x3decaa(0x1173)](_0x3db4f4,0x0,0x0,_0x36a248,_0x3379e6);const _0x48cc59=_0x5ecdd0[_0x3decaa(0x577)](_0x3decaa(0xf4f),_0x13e628);console[_0x3decaa(0xc0d)](_0x3decaa(0x16f3)+Math[_0x3decaa(0x5f3)](_0x434422[_0x3decaa(0xcbf)]/0x400)+_0x3decaa(0x15b0)+Math['round'](_0x48cc59['length']/0x400)+'KB'),_0x4306d4(_0x48cc59);},_0x3db4f4['src']=_0x434422;});}function recoverAndRefreshSettings(){const _0x453963=_0x2cf6d4;if(!currentChatCharacter){showToast(_0x453963(0x5e9),_0x453963(0x13bb));return;}const _0x2b0d=currentChatCharacter['id'];console[_0x453963(0xc0d)](_0x453963(0x183)+_0x2b0d),console[_0x453963(0xc0d)](_0x453963(0x1ecd),JSON[_0x453963(0x7fb)](chatSettings[_0x2b0d],null,0x2)),showToast(_0x453963(0xf49),_0x453963(0x2422));const _0x5522f4=localStorage[_0x453963(0x2250)](_0x453963(0xc63)+_0x2b0d);if(_0x5522f4)try{const _0x3912b0=JSON[_0x453963(0x168e)](_0x5522f4);console[_0x453963(0xc0d)](_0x453963(0x1b1b),JSON[_0x453963(0x7fb)](_0x3912b0,null,0x2)),chatSettings[_0x2b0d]=_0x3912b0;document['getElementById']('api-chat-settings-screen')[_0x453963(0x655)][_0x453963(0x2526)]!==_0x453963(0xfe9)&&updateChatSettingsDisplay();currentChatCharacter&&renderChatMessages(currentChatCharacter['id']);showToast('设置恢复成功！',_0x453963(0xb27)),console['log'](_0x453963(0x1c41),JSON[_0x453963(0x7fb)](chatSettings[_0x2b0d],null,0x2));return;}catch(_0x27121f){console['error'](_0x453963(0x19f0),_0x27121f);}db[_0x453963(0xb08)][_0x453963(0x46a)](_0x2b0d)['then'](_0x466732=>{const _0x108ba2=_0x453963;_0x466732&&_0x466732[_0x108ba2(0x1fbb)]?(console['log'](_0x108ba2(0x15bc),JSON[_0x108ba2(0x7fb)](_0x466732[_0x108ba2(0x1fbb)],null,0x2)),chatSettings[_0x2b0d]=_0x466732[_0x108ba2(0x1fbb)],localStorage[_0x108ba2(0x2055)](_0x108ba2(0xc63)+_0x2b0d,JSON[_0x108ba2(0x7fb)](_0x466732['settings'])),document[_0x108ba2(0x566)]('api-chat-settings-screen')[_0x108ba2(0x655)][_0x108ba2(0x2526)]!=='none'&&updateChatSettingsDisplay(),currentChatCharacter&&renderChatMessages(currentChatCharacter['id']),showToast('从备份数据恢复设置成功！',_0x108ba2(0xb27)),console[_0x108ba2(0xc0d)]('从IndexedDB恢复设置成功:',JSON['stringify'](_0x466732['settings'],null,0x2))):(showToast('未找到备份数据，设置可能已永久丢失',_0x108ba2(0x24ab)),console[_0x108ba2(0xc0d)]('未找到任何备份数据'));})[_0x453963(0x9e5)](_0x469071=>{const _0x1dfc50=_0x453963;console[_0x1dfc50(0x24ab)]('从IndexedDB恢复设置失败:',_0x469071),showToast(_0x1dfc50(0x1376),_0x1dfc50(0x24ab));});}function recoverChatSettings(){const _0x3999c0=_0x2cf6d4;if(!currentChatCharacter)return![];const _0x1252cf=currentChatCharacter['id'];console[_0x3999c0(0xc0d)](_0x3999c0(0xd09));const _0x45759b=localStorage[_0x3999c0(0x2250)](_0x3999c0(0xc63)+_0x1252cf);if(_0x45759b)try{const _0x8ead48=JSON[_0x3999c0(0x168e)](_0x45759b);return chatSettings[_0x1252cf]=_0x8ead48,console[_0x3999c0(0xc0d)]('从localStorage恢复聊天设置成功:',_0x8ead48),!![];}catch(_0x24d3d2){console[_0x3999c0(0x24ab)]('从localStorage恢复设置失败:',_0x24d3d2);}return db[_0x3999c0(0xb08)][_0x3999c0(0x46a)](_0x1252cf)[_0x3999c0(0x1ccc)](_0xb9277c=>{const _0x4ccb98=_0x3999c0;if(_0xb9277c&&_0xb9277c[_0x4ccb98(0x1fbb)])return chatSettings[_0x1252cf]=_0xb9277c[_0x4ccb98(0x1fbb)],console[_0x4ccb98(0xc0d)](_0x4ccb98(0x12f0),_0xb9277c[_0x4ccb98(0x1fbb)]),localStorage['setItem'](_0x4ccb98(0xc63)+_0x1252cf,JSON['stringify'](_0xb9277c[_0x4ccb98(0x1fbb)])),!![];})[_0x3999c0(0x9e5)](_0x3b8d79=>{const _0x1eb307=_0x3999c0;console[_0x1eb307(0x24ab)]('从IndexedDB恢复设置失败:',_0x3b8d79);}),![];}function forceRefreshAvatars(){const _0x46bdf8=_0x2cf6d4,_0x556a24=getCurrentChatSettings(),_0x1898d2=_0x556a24[_0x46bdf8(0x23e0)]||currentChatCharacter['avatarUrl'];console['log']('强制刷新头像显示，当前头像:',_0x1898d2?_0x1898d2[_0x46bdf8(0x4b2)](0x0,0x32)+_0x46bdf8(0x12da):_0x46bdf8(0x10e2));const _0x2daaaf=document[_0x46bdf8(0x1ed9)](_0x46bdf8(0xdef));_0x2daaaf['forEach'](_0x261768=>{const _0x4887d2=_0x46bdf8,_0x161719=_0x261768[_0x4887d2(0x1add)](_0x4887d2(0x11cf));_0x161719&&_0x161719[_0x4887d2(0x23ec)]('\x27'+currentChatCharacter['id']+'\x27')&&(_0x1898d2&&_0x1898d2!==_0x4887d2(0x1785)?(_0x261768[_0x4887d2(0x655)][_0x4887d2(0x1584)]=_0x4887d2(0xcb5)+_0x1898d2+')',_0x261768[_0x4887d2(0x655)][_0x4887d2(0x2000)]='cover',_0x261768[_0x4887d2(0x655)][_0x4887d2(0x18b3)]='center',_0x261768[_0x4887d2(0xc02)]=''):(_0x261768['style']['backgroundImage']=_0x4887d2(0xfe9),_0x261768[_0x4887d2(0xc02)]=currentChatCharacter[_0x4887d2(0x222f)][_0x4887d2(0x1518)](0x0)));});const _0x2e70b7=document['getElementById'](_0x46bdf8(0x182f));_0x2e70b7&&_0x1898d2&&_0x1898d2!==_0x46bdf8(0x1785)&&(_0x2e70b7['style'][_0x46bdf8(0x1584)]='url('+_0x1898d2+')',_0x2e70b7['style'][_0x46bdf8(0x2000)]=_0x46bdf8(0xe3e),_0x2e70b7['style'][_0x46bdf8(0x18b3)]=_0x46bdf8(0x23a1),_0x2e70b7[_0x46bdf8(0xc02)]='',_0x2e70b7['title']=_0x46bdf8(0x1ecf));}function formatBytes(_0x408413){const _0x5013f6=_0x2cf6d4;if(_0x408413===0x0)return _0x5013f6(0x119f);const _0x28148b=0x400,_0x99b207=['B','KB','MB','GB'],_0x2e89eb=Math['floor'](Math[_0x5013f6(0xc0d)](_0x408413)/Math[_0x5013f6(0xc0d)](_0x28148b));return parseFloat((_0x408413/Math[_0x5013f6(0x1c47)](_0x28148b,_0x2e89eb))[_0x5013f6(0x3cd)](0x2))+'\x20'+_0x99b207[_0x2e89eb];}async function compressAllImages(){const _0x544cb1=_0x2cf6d4;if(!confirm(_0x544cb1(0x8db)))return;showToast('正在压缩图片...','info');let _0x4e19dc=0x0;try{for(const _0x36117e of characters){_0x36117e['avatarUrl']&&_0x36117e[_0x544cb1(0x10f9)][_0x544cb1(0xcbf)]>0xc350&&(_0x36117e[_0x544cb1(0x10f9)]=await compressImage(_0x36117e['avatarUrl'],0x96,0.6),_0x4e19dc++);}await saveCharacters();for(const _0x251e3b of Object['keys'](chatSettings)){const _0x438b57=chatSettings[_0x251e3b];_0x438b57&&(_0x438b57[_0x544cb1(0x23e0)]&&_0x438b57[_0x544cb1(0x23e0)][_0x544cb1(0xcbf)]>0xc350&&(_0x438b57['aiChatAvatar']=await compressImage(_0x438b57[_0x544cb1(0x23e0)],0x96,0.6),_0x4e19dc++),_0x438b57[_0x544cb1(0x13af)]&&_0x438b57[_0x544cb1(0x13af)][_0x544cb1(0xcbf)]>0xc350&&(_0x438b57[_0x544cb1(0x13af)]=await compressImage(_0x438b57[_0x544cb1(0x13af)],0x96,0.6),_0x4e19dc++),_0x438b57['chatBackground']&&_0x438b57[_0x544cb1(0x182)][_0x544cb1(0xcbf)]>0x186a0&&(_0x438b57['chatBackground']=await compressImage(_0x438b57[_0x544cb1(0x182)],0x320,0.7),_0x4e19dc++));}await saveChatSettings(),calculateStorageUsage(),showToast(_0x544cb1(0xa04)+_0x4e19dc+_0x544cb1(0x36f),'success');}catch(_0x4b9dbd){console[_0x544cb1(0x24ab)](_0x544cb1(0x14c9),_0x4b9dbd),showToast('压缩过程中出现错误','error');}}async function cleanupStorageSpace(){const _0x2e775c=_0x2cf6d4;if(!confirm('将清理以下数据以释放存储空间：\x0a\x0a•\x20所有角色的动态头像\x0a•\x20localStorage中的过期数据\x0a•\x20压缩现有头像数据\x0a\x0a确定要继续吗？'))return;showToast(_0x2e775c(0x18e2),'info');let _0x244d5b=0x0,_0x53cd9b=0x0;try{Object[_0x2e775c(0x16c7)](chatSettings)['forEach'](_0x1930a5=>{const _0x51468f=_0x2e775c;chatSettings[_0x1930a5]&&chatSettings[_0x1930a5][_0x51468f(0x23e0)]&&(delete chatSettings[_0x1930a5][_0x51468f(0x23e0)],_0x53cd9b++);});for(let _0x48f824=localStorage['length']-0x1;_0x48f824>=0x0;_0x48f824--){const _0x1a1407=localStorage['key'](_0x48f824);if(_0x1a1407&&_0x1a1407['startsWith'](_0x2e775c(0xc63))){const _0x4dc472=localStorage['getItem'](_0x1a1407);_0x4dc472&&(_0x244d5b+=_0x4dc472[_0x2e775c(0xcbf)],localStorage['removeItem'](_0x1a1407),_0x53cd9b++);}}for(const _0x4c6052 of Object[_0x2e775c(0x16c7)](chatSettings)){const _0x151ab9=chatSettings[_0x4c6052];_0x151ab9&&(_0x151ab9['aiChatAvatar']&&_0x151ab9['aiChatAvatar'][_0x2e775c(0xcbf)]>0xc350&&(_0x151ab9[_0x2e775c(0x23e0)]=await compressImage(_0x151ab9[_0x2e775c(0x23e0)],0x96,0.6),_0x53cd9b++),_0x151ab9[_0x2e775c(0x13af)]&&_0x151ab9['myChatAvatar']['length']>0xc350&&(_0x151ab9[_0x2e775c(0x13af)]=await compressImage(_0x151ab9[_0x2e775c(0x13af)],0x96,0.6),_0x53cd9b++));}await saveChatSettings();currentChatCharacter&&renderChatMessages(currentChatCharacter['id']);const _0x14a879=Math['round'](_0x244d5b/0x400);showToast(_0x2e775c(0xfaa)+_0x14a879+'KB\x20空间，处理了\x20'+_0x53cd9b+_0x2e775c(0x58d),_0x2e775c(0xb27));}catch(_0x36c8cd){console[_0x2e775c(0x24ab)](_0x2e775c(0x2112),_0x36c8cd),showToast(_0x2e775c(0x12a5),'error');}}function clearAiChatAvatar(){const _0x45bf92=_0x2cf6d4;if(!currentChatCharacter)return;const _0x4a919f=getCurrentChatSettings();_0x4a919f[_0x45bf92(0x23e0)]?(delete _0x4a919f[_0x45bf92(0x23e0)],saveCurrentChatSettings(_0x4a919f),currentChatCharacter&&renderChatMessages(currentChatCharacter['id']),forceRefreshAvatars(),showToast(_0x45bf92(0xa97),'success')):showToast(_0x45bf92(0xa5b),'info');}function saveChatIdentity(){const _0x4bfa1d=_0x2cf6d4;if(!window[_0x4bfa1d(0x119c)]){alert('请选择一个身份');return;}const _0x2c66b3=getCurrentChatSettings(),_0x1f2ce5=personas['find'](_0x3e7f0e=>_0x3e7f0e['id']===window['selectedChatIdentityId']);_0x1f2ce5&&(_0x2c66b3['selectedIdentityId']=_0x1f2ce5['id'],_0x1f2ce5['avatarUrl']&&!_0x2c66b3[_0x4bfa1d(0x13af)]&&(_0x2c66b3[_0x4bfa1d(0x13af)]=_0x1f2ce5[_0x4bfa1d(0x10f9)]),_0x1f2ce5[_0x4bfa1d(0x222f)]&&!_0x2c66b3['myChatNickname']&&(_0x2c66b3['myChatNickname']=_0x1f2ce5[_0x4bfa1d(0x222f)]),saveCurrentChatSettings(_0x2c66b3),updateChatIdentityDisplay(),currentChatCharacter&&renderChatMessages(currentChatCharacter['id']),hideModal('identity-selector-modal'),showToast(_0x4bfa1d(0x15e5)+_0x1f2ce5['name']+'\x22',_0x4bfa1d(0xb27)));}async function updateChatIdentityDisplay(){const _0x33da1f=_0x2cf6d4;if(!currentChatCharacter){console[_0x33da1f(0xc0d)](_0x33da1f(0x6ec));return;}const _0x79733a=await getAsyncChatSettings(),_0x35ebc2=_0x79733a[_0x33da1f(0x6a0)]||_0x33da1f(0xbf),_0x4bcb5e=personas['find'](_0x46893a=>_0x46893a['id']===_0x35ebc2),_0x56056a=document['getElementById'](_0x33da1f(0x38e));if(_0x56056a){if(_0x4bcb5e)_0x56056a[_0x33da1f(0x21dc)]=_0x4bcb5e['name'],console[_0x33da1f(0xc0d)](_0x33da1f(0xf90),_0x4bcb5e['name']);else _0x35ebc2===_0x33da1f(0xbf)?(_0x56056a['textContent']='无用户身份',console[_0x33da1f(0xc0d)](_0x33da1f(0xa1e))):(_0x56056a[_0x33da1f(0x21dc)]=_0x33da1f(0x242a),console[_0x33da1f(0xc0d)](_0x33da1f(0x2023),_0x35ebc2));}}async function updateBubbleStyleDisplay(){const _0x25f8b4=_0x2cf6d4;if(!currentChatCharacter){console[_0x25f8b4(0xc0d)](_0x25f8b4(0x10fc));return;}const _0x22a6a6=await getAsyncChatSettings(),_0x3a9337={'default':_0x25f8b4(0x13ed),'shadow':_0x25f8b4(0xc41),'tail':_0x25f8b4(0x725),'paper':_0x25f8b4(0xd9b)},_0x5d6e12=document[_0x25f8b4(0x566)](_0x25f8b4(0x21d4));if(_0x5d6e12){const _0x38b223=_0x22a6a6[_0x25f8b4(0xa7e)]||'default';_0x5d6e12[_0x25f8b4(0x21dc)]=_0x3a9337[_0x38b223]||'默认样式';}}function handleAvatarUploadClick(){const _0x22aef2=_0x2cf6d4;console[_0x22aef2(0xc0d)](_0x22aef2(0x11dd));const _0x788866=document[_0x22aef2(0x566)](_0x22aef2(0x1d44));_0x788866?(console[_0x22aef2(0xc0d)](_0x22aef2(0x1d94)),_0x788866[_0x22aef2(0x1e62)]()):(console['error']('找不到avatar-upload元素'),alert(_0x22aef2(0x195f)));}function addMessageLongPressListener(_0x3640c8,_0x5cb943){const _0x5a60a9=_0x2cf6d4;let _0x30e9e4=null,_0x6662a4=![],_0x1e19bf={'x':0x0,'y':0x0};const _0x34382e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i[_0x5a60a9(0x17ba)](navigator[_0x5a60a9(0x473)])||'ontouchstart'in window||navigator[_0x5a60a9(0x1e9e)]>0x0,_0x39771c=_0x40ce18=>{const _0x154269=_0x5a60a9;if(isMessageSelectionMode)return;const _0x2d1ff6=_0x40ce18[_0x154269(0x1278)]?_0x40ce18[_0x154269(0x1278)][0x0]:_0x40ce18;_0x1e19bf['x']=_0x2d1ff6[_0x154269(0x1c1c)],_0x1e19bf['y']=_0x2d1ff6[_0x154269(0x11cd)],_0x6662a4=![],_0x30e9e4=setTimeout(()=>{const _0x162146=_0x154269;_0x6662a4=!![],navigator[_0x162146(0xd8f)]&&_0x34382e&&navigator[_0x162146(0xd8f)](0x32),_0x34382e?showMobileMessageMenu(_0x5cb943,_0x40ce18):enterMessageSelectionMode(_0x5cb943);},_0x34382e?0x258:0x320);},_0x117075=_0x283880=>{_0x30e9e4&&(clearTimeout(_0x30e9e4),_0x30e9e4=null),setTimeout(()=>{_0x6662a4=![];},0x64);},_0x40f449=_0x116dd6=>{const _0x15bcb0=_0x5a60a9;if(!_0x30e9e4)return;const _0x3b9076=_0x116dd6[_0x15bcb0(0x1278)]?_0x116dd6[_0x15bcb0(0x1278)][0x0]:_0x116dd6,_0x290f65=Math[_0x15bcb0(0x2424)](_0x3b9076[_0x15bcb0(0x1c1c)]-_0x1e19bf['x']),_0x290ecd=Math[_0x15bcb0(0x2424)](_0x3b9076[_0x15bcb0(0x11cd)]-_0x1e19bf['y']);(_0x290f65>0xa||_0x290ecd>0xa)&&_0x117075(_0x116dd6);},_0x4dd88a=_0x541307=>{const _0x1d3d69=_0x5a60a9;if(isMessageSelectionMode){_0x541307['preventDefault'](),_0x541307[_0x1d3d69(0x1023)](),toggleMessageSelection(_0x5cb943);return;}if(_0x6662a4){_0x541307['preventDefault'](),_0x541307[_0x1d3d69(0x1023)]();return;}};_0x34382e?(_0x3640c8[_0x5a60a9(0x167)](_0x5a60a9(0xf52),_0x39771c,{'passive':![]}),_0x3640c8[_0x5a60a9(0x167)]('touchend',_0x117075,{'passive':![]}),_0x3640c8[_0x5a60a9(0x167)](_0x5a60a9(0x1e8f),_0x40f449,{'passive':![]}),_0x3640c8[_0x5a60a9(0x167)](_0x5a60a9(0x5c8),_0x117075,{'passive':![]})):(_0x3640c8['addEventListener'](_0x5a60a9(0xa69),_0x39771c),_0x3640c8[_0x5a60a9(0x167)](_0x5a60a9(0x1fb0),_0x117075),_0x3640c8[_0x5a60a9(0x167)](_0x5a60a9(0x1761),_0x117075),_0x3640c8['addEventListener']('mousemove',_0x40f449)),_0x3640c8[_0x5a60a9(0x167)](_0x5a60a9(0x1e62),_0x4dd88a,!![]);}function showMobileMessageMenu(_0x2652a5,_0x25e546){const _0x37c15a=_0x2cf6d4;console['log'](_0x37c15a(0x1823),_0x2652a5),selectedMessageId=_0x2652a5;const _0x4e2246=chatMessages[currentChatCharacter['id']]||[],_0x54b1fd=_0x4e2246[_0x37c15a(0x1aeb)](_0x5b70b6=>_0x5b70b6['id']===_0x2652a5),_0x4908fe=_0x54b1fd&&_0x54b1fd[_0x37c15a(0xf75)]==='sent';hideMessageActionBar();const _0x42e465=document[_0x37c15a(0x15b8)](_0x37c15a(0x64f)+_0x2652a5+'\x22]');if(!_0x42e465){console[_0x37c15a(0xc0d)](_0x37c15a(0x617));return;}console[_0x37c15a(0xc0d)](_0x37c15a(0x1a78),_0x42e465);const _0x1ef9ad=document[_0x37c15a(0x1ad8)](_0x37c15a(0x526));_0x1ef9ad[_0x37c15a(0x221)]=_0x37c15a(0x1a10),_0x1ef9ad['id']=_0x37c15a(0x1a10);const _0x418b90=['引用','复制'];!_0x4908fe&&_0x418b90[_0x37c15a(0x6ee)]('心声'),_0x418b90[_0x37c15a(0x6ee)]('编辑'),_0x4908fe&&_0x418b90[_0x37c15a(0x6ee)]('撤回'),_0x418b90[_0x37c15a(0x6ee)]('多选'),_0x1ef9ad[_0x37c15a(0xc02)]=_0x418b90[_0x37c15a(0xf6d)](_0x2215ed=>{const _0x3f62b2=_0x37c15a;let _0x2d998c='';switch(_0x2215ed){case'引用':_0x2d998c=_0x3f62b2(0xf7d)+_0x2652a5+'\x27)';break;case'复制':_0x2d998c='copyMessage(\x27'+_0x2652a5+'\x27)';break;case'心声':_0x2d998c=_0x3f62b2(0x20a4)+_0x2652a5+'\x27)';break;case'编辑':_0x2d998c=_0x3f62b2(0x1687)+_0x2652a5+'\x27)';break;case'撤回':_0x2d998c='deleteMessage(\x27'+_0x2652a5+'\x27)';break;case'多选':_0x2d998c='enterMessageSelectionMode(\x27'+_0x2652a5+'\x27)';break;}return _0x3f62b2(0x1809)+_0x2d998c+';\x20hideMessageActionBar();\x22>'+_0x2215ed+_0x3f62b2(0x21e8);})[_0x37c15a(0x140c)](''),_0x42e465[_0x37c15a(0x1925)](_0x1ef9ad),setTimeout(()=>{const _0x2ba17d=_0x37c15a;_0x1ef9ad[_0x2ba17d(0x226e)][_0x2ba17d(0xe1)]('show');},0xa),setTimeout(()=>{const _0x4e839a=_0x37c15a;document[_0x4e839a(0x167)]('click',hideMessageActionBarOnClickOutside),document['addEventListener'](_0x4e839a(0xf52),hideMessageActionBarOnClickOutside);},0x64);}function hideMessageActionBar(){const _0x54e572=_0x2cf6d4,_0x37ab05=document[_0x54e572(0x566)](_0x54e572(0x1a10));_0x37ab05&&(_0x37ab05[_0x54e572(0x226e)]['remove'](_0x54e572(0xd16)),setTimeout(()=>{const _0x49820e=_0x54e572;_0x37ab05[_0x49820e(0xe9)]&&_0x37ab05[_0x49820e(0xe9)]['removeChild'](_0x37ab05);},0x12c)),selectedMessageId=null,document['removeEventListener'](_0x54e572(0x1e62),hideMessageActionBarOnClickOutside),document[_0x54e572(0x6be)](_0x54e572(0xf52),hideMessageActionBarOnClickOutside);}function hideMessageActionBarOnClickOutside(_0x4e70ac){const _0x1cf645=_0x2cf6d4,_0x3d0c19=document[_0x1cf645(0x566)](_0x1cf645(0x1a10));_0x3d0c19&&!_0x3d0c19[_0x1cf645(0x1f9)](_0x4e70ac[_0x1cf645(0x1144)])&&hideMessageActionBar();}function hideMobileMessageMenu(){hideMessageActionBar();}function enterMessageSelectionMode(_0x19e44f){const _0x137bd5=_0x2cf6d4;if(isMessageSelectionMode)return;isMessageSelectionMode=!![],selectedMessages[_0x137bd5(0x2215)](),selectedMessages[_0x137bd5(0xe1)](_0x19e44f);const _0x300765=document[_0x137bd5(0x566)](_0x137bd5(0x1154));_0x300765&&_0x300765['classList']['add'](_0x137bd5(0xe5e)),updateMessageSelectionUI();}function toggleMessageSelection(_0x39b839){const _0x1100bf=_0x2cf6d4;if(!isMessageSelectionMode)return;selectedMessages[_0x1100bf(0x1af1)](_0x39b839)?selectedMessages[_0x1100bf(0xc2b)](_0x39b839):selectedMessages['add'](_0x39b839),updateMessageSelectionUI(),selectedMessages[_0x1100bf(0x41a)]===0x0&&exitMessageSelectionMode();}function exitMessageSelectionMode(){const _0x3bc4c0=_0x2cf6d4;if(!isMessageSelectionMode)return;isMessageSelectionMode=![];const _0x5e9273=document[_0x3bc4c0(0x566)](_0x3bc4c0(0x1154));_0x5e9273&&_0x5e9273[_0x3bc4c0(0x226e)][_0x3bc4c0(0x128)](_0x3bc4c0(0xe5e));const _0x90afd4=document[_0x3bc4c0(0x1ed9)](_0x3bc4c0(0x923));_0x90afd4[_0x3bc4c0(0x900)](_0xa3e07=>{const _0x23c60e=_0x3bc4c0;_0xa3e07['classList'][_0x23c60e(0x128)]('selected');}),selectedMessages[_0x3bc4c0(0x2215)](),updateMessageSelectionUI();}function updateMessageSelectionUI(){const _0x2a4084=_0x2cf6d4,_0x347a65=document[_0x2a4084(0x1ed9)](_0x2a4084(0x219e));_0x347a65[_0x2a4084(0x900)](_0x16b03a=>{const _0x2757f7=_0x2a4084,_0x32fede=_0x16b03a['dataset'][_0x2757f7(0x61f)];_0x32fede&&(selectedMessages['has'](_0x32fede)?_0x16b03a[_0x2757f7(0x226e)][_0x2757f7(0xe1)]('selected'):_0x16b03a[_0x2757f7(0x226e)]['remove'](_0x2757f7(0x876)));});const _0x30ce50=document[_0x2a4084(0x566)]('selection-count');_0x30ce50&&(_0x30ce50[_0x2a4084(0x21dc)]='已选\x20'+selectedMessages['size']+'\x20条');}let isDeletingMessages=![];async function deleteSelectedMessages(){const _0x28969d=_0x2cf6d4;if(isDeletingMessages){console[_0x28969d(0xc0d)](_0x28969d(0x1bb0));return;}if(selectedMessages[_0x28969d(0x41a)]===0x0)return;if(!currentChatCharacter)return;if(confirm(_0x28969d(0x5d1)+selectedMessages[_0x28969d(0x41a)]+'\x20条消息吗？此操作不可恢复！')){isDeletingMessages=!![];const _0x41b9dd=currentChatCharacter['id'];if(chatMessages[_0x41b9dd])try{const _0x20e660=[];chatMessages[_0x41b9dd]['forEach'](_0x54e1bf=>{const _0x429508=_0x28969d;selectedMessages[_0x429508(0x1af1)](_0x54e1bf['id'])&&_0x20e660[_0x429508(0x6ee)](_0x54e1bf);});for(const _0x190561 of _0x20e660){try{await deleteRelatedTimelineEvents(_0x190561);const _0x146f2e=typeof _0x190561[_0x28969d(0x1423)]===_0x28969d(0xb97)?_0x190561[_0x28969d(0x1423)][_0x28969d(0x4b2)](0x0,0x1e):_0x190561[_0x28969d(0x1423)]?.[_0x28969d(0x1e58)]||_0x190561['content']?.[_0x28969d(0xd7a)]||_0x28969d(0x1b4a);console['log'](_0x28969d(0x1c98)+_0x146f2e+_0x28969d(0x12da));}catch(_0x40038a){console[_0x28969d(0x24ab)](_0x28969d(0x1e56),_0x40038a);}}const _0x7e0d8c=[];for(const _0x30823a of _0x20e660){const _0x1b60e8=await db[_0x28969d(0x464)][_0x28969d(0x4a6)](_0x28969d(0x10df))[_0x28969d(0x14a)](_0x41b9dd)[_0x28969d(0x1534)](_0xd92e2e=>_0xd92e2e[_0x28969d(0xc48)]===_0x30823a['id'])[_0x28969d(0x2200)]();_0x1b60e8&&_0x7e0d8c['push'](_0x1b60e8['id']);}_0x7e0d8c[_0x28969d(0xcbf)]>0x0&&(await db['chatMessages'][_0x28969d(0xf71)](_0x7e0d8c),console[_0x28969d(0xc0d)]('✅\x20[高效删除]\x20数据库删除了\x20'+_0x7e0d8c[_0x28969d(0xcbf)]+_0x28969d(0x16d2))),chatMessages[_0x41b9dd]=chatMessages[_0x41b9dd][_0x28969d(0x803)](_0x5adbd1=>{return!selectedMessages['has'](_0x5adbd1['id']);}),renderChatMessages(_0x41b9dd),renderMessageList();}catch(_0x32a5f9){console[_0x28969d(0x24ab)](_0x28969d(0x2080),_0x32a5f9),chatMessages[_0x41b9dd]=chatMessages[_0x41b9dd][_0x28969d(0x803)](_0x3fea6b=>{const _0x316617=_0x28969d;return!selectedMessages[_0x316617(0x1af1)](_0x3fea6b['id']);}),saveChatMessages(),renderChatMessages(_0x41b9dd),renderMessageList();}exitMessageSelectionMode(),isDeletingMessages=![];}else isDeletingMessages=![];}let isWaitingForReply=![],pendingUserMessage=null;async function regenerateLastResponse(){const _0x5ca3a5=_0x2cf6d4;if(!currentChatCharacter){alert(_0x5ca3a5(0x1268));return;}if(window[_0x5ca3a5(0x5d9)]){console[_0x5ca3a5(0xc0d)]('重新生成正在进行中，忽略重复调用');return;}window[_0x5ca3a5(0x5d9)]=!![];const _0x7af54f=currentChatCharacter['id'],_0xba905a=chatMessages[_0x7af54f]||[];let _0x369949=-0x1,_0x3f40be=-0x1;for(let _0x3ba5f4=_0xba905a['length']-0x1;_0x3ba5f4>=0x0;_0x3ba5f4--){_0xba905a[_0x3ba5f4][_0x5ca3a5(0xf75)]==='received'&&_0x369949===-0x1&&(_0x369949=_0x3ba5f4);if(_0x369949!==-0x1&&_0xba905a[_0x3ba5f4][_0x5ca3a5(0xf75)]===_0x5ca3a5(0xfda)&&_0x3f40be===-0x1){_0x3f40be=_0x3ba5f4;break;}}if(_0x369949===-0x1){alert(_0x5ca3a5(0x1ef9));return;}if(_0x3f40be===-0x1){alert(_0x5ca3a5(0x141));return;}const _0xc3dd05=_0xba905a[_0x3f40be],_0x3bfcd4=_0xba905a[_0x5ca3a5(0x136)](_0x3f40be+0x1);chatMessages[_0x7af54f]=_0xba905a[_0x5ca3a5(0x136)](0x0,_0x3f40be+0x1);try{for(const _0x277dfb of _0x3bfcd4){await deleteRelatedTimelineEvents(_0x277dfb);}console[_0x5ca3a5(0xc0d)](_0x5ca3a5(0xe75)+_0x3bfcd4[_0x5ca3a5(0xcbf)]+'\x20条消息的相关时间线记忆');}catch(_0x2ffd56){console[_0x5ca3a5(0x24ab)](_0x5ca3a5(0xce7),_0x2ffd56);}try{const _0x440984=[];for(let _0x2f4252=_0x3f40be+0x1;_0x2f4252<_0xba905a['length'];_0x2f4252++){const _0xf8d853=_0xba905a[_0x2f4252],_0x163601=await db[_0x5ca3a5(0x464)]['where'](_0x5ca3a5(0x10df))[_0x5ca3a5(0x14a)](_0x7af54f)['and'](_0x58c7b6=>_0x58c7b6['originalMessageId']===_0xf8d853['id'])[_0x5ca3a5(0x2200)]();_0x163601&&_0x440984['push'](_0x163601['id']);}_0x440984[_0x5ca3a5(0xcbf)]>0x0&&(await db['chatMessages']['bulkDelete'](_0x440984),console[_0x5ca3a5(0xc0d)]('✅\x20[高效重新生成]\x20删除了\x20'+_0x440984[_0x5ca3a5(0xcbf)]+_0x5ca3a5(0x1cbc)));}catch(_0x347de8){console[_0x5ca3a5(0x24ab)](_0x5ca3a5(0x23ee),_0x347de8),await saveChatMessages();}await renderChatMessagesAsync(_0x7af54f),console[_0x5ca3a5(0xc0d)]('🔧\x20[regenerateLastResponse]\x20准备显示typing-indicator'),await new Promise(_0x436053=>{setTimeout(()=>{showTypingIndicator(),_0x436053();},0x64);});const _0x3674ae=Math[_0x5ca3a5(0x191c)]()*0x7d0+0x3e8;await new Promise(_0x17a555=>setTimeout(_0x17a555,_0x3674ae));try{let _0x216e21;console['log'](_0x5ca3a5(0x18c3),_0xc3dd05),console['log'](_0x5ca3a5(0x210),!!_0xc3dd05['image']),console[_0x5ca3a5(0xc0d)](_0x5ca3a5(0x2242),_0xc3dd05['isEmoji']),console[_0x5ca3a5(0xc0d)]('🔍\x20[AI处理调试]\x20content是否为数组:',Array[_0x5ca3a5(0x1bcc)](_0xc3dd05[_0x5ca3a5(0x1423)]));if(Array['isArray'](_0xc3dd05[_0x5ca3a5(0x1423)])){console['log'](_0x5ca3a5(0xc45));const _0x1e52dd=_0xc3dd05[_0x5ca3a5(0x1423)]['some'](_0x17f0bf=>_0x17f0bf[_0x5ca3a5(0x23df)]===_0x5ca3a5(0x1cfa)),_0x307dc5=_0xc3dd05[_0x5ca3a5(0x874)]?.[_0x5ca3a5(0x184b)](_0x1f25e4=>_0x1f25e4['isEmoji']);console['log'](_0x5ca3a5(0x1661),_0x1e52dd),console[_0x5ca3a5(0xc0d)](_0x5ca3a5(0x1bc8),_0x307dc5),console[_0x5ca3a5(0xc0d)](_0x5ca3a5(0x97e),apiSettings[_0x5ca3a5(0x168d)]);const _0x26a1c8=_0xc3dd05[_0x5ca3a5(0x874)]?.[_0x5ca3a5(0x1aeb)](_0x4af798=>_0x4af798[_0x5ca3a5(0xe29)]),_0x4b715a=_0x26a1c8?.['image']?.['includes']('data:image/gif')||_0x26a1c8?.['url']?.[_0x5ca3a5(0x23ec)](_0x5ca3a5(0x38d))||_0x26a1c8?.[_0x5ca3a5(0xe5b)]?.[_0x5ca3a5(0x1d64)]()[_0x5ca3a5(0x23ec)](_0x5ca3a5(0x12f2))||_0x26a1c8?.[_0x5ca3a5(0x10c6)]?.[_0x5ca3a5(0x1d64)]()['includes'](_0x5ca3a5(0x12f2));console[_0x5ca3a5(0xc0d)]('🔍\x20[动图检测]\x20是否为GIF表情包:',_0x4b715a);const _0x39f5c5=_0x26a1c8?.[_0x5ca3a5(0xe5b)]&&(_0x26a1c8[_0x5ca3a5(0xe5b)]['startsWith'](_0x5ca3a5(0x1c85))||_0x26a1c8[_0x5ca3a5(0xe5b)]['startsWith'](_0x5ca3a5(0x2403)))||_0x26a1c8?.[_0x5ca3a5(0x10c6)]&&(_0x26a1c8[_0x5ca3a5(0x10c6)][_0x5ca3a5(0x1cab)]('http://')||_0x26a1c8[_0x5ca3a5(0x10c6)][_0x5ca3a5(0x1cab)](_0x5ca3a5(0x2403)));if(_0x1e52dd&&_0x307dc5&&(apiSettings[_0x5ca3a5(0x168d)]===![]||_0x4b715a||_0x39f5c5)){const _0x2adf1a=_0x4b715a?_0x5ca3a5(0x1903):_0x39f5c5?_0x5ca3a5(0x1acf):_0x5ca3a5(0x226),_0xe31bc6=_0xc3dd05[_0x5ca3a5(0x1423)]?.[_0x5ca3a5(0x1aeb)](_0x54224b=>_0x54224b[_0x5ca3a5(0x23df)]===_0x5ca3a5(0x1e58));let _0x1fc3dc;_0xe31bc6&&_0xe31bc6[_0x5ca3a5(0x1e58)]&&_0xe31bc6[_0x5ca3a5(0x1e58)][_0x5ca3a5(0x1424)]()?(_0x1fc3dc=_0xe31bc6[_0x5ca3a5(0x1e58)][_0x5ca3a5(0x1424)]()+_0x5ca3a5(0x698)+(_0x26a1c8?.[_0x5ca3a5(0x13e3)]||_0x5ca3a5(0x13b5))+']',console[_0x5ca3a5(0xc0d)]('🔍\x20[多模态修复]\x20发送文字+表情包描述\x20('+_0x2adf1a+'):',_0x1fc3dc)):(_0x1fc3dc='[用户发送了表情包：'+(_0x26a1c8?.['emojiDescription']||_0x5ca3a5(0x13b5))+']',console[_0x5ca3a5(0xc0d)](_0x5ca3a5(0xc26)+_0x2adf1a+'):',_0x1fc3dc)),_0x216e21=await callChatAPI(_0x1fc3dc,currentChatCharacter);}else _0x216e21=await callChatAPI(_0xc3dd05[_0x5ca3a5(0x1423)],currentChatCharacter);}else{if(_0xc3dd05[_0x5ca3a5(0xe5b)]){console[_0x5ca3a5(0xc0d)](_0x5ca3a5(0x1645));const _0x14c9ed=_0xc3dd05[_0x5ca3a5(0xe29)]&&(_0xc3dd05[_0x5ca3a5(0xe5b)]?.[_0x5ca3a5(0x23ec)](_0x5ca3a5(0x38d))||_0xc3dd05[_0x5ca3a5(0xe5b)]?.[_0x5ca3a5(0x1d64)]()[_0x5ca3a5(0x23ec)](_0x5ca3a5(0x12f2)));console['log']('🔍\x20[图片分支动图检测]\x20是否为GIF表情包:',_0x14c9ed);const _0x1b54e5=_0xc3dd05['isEmoji']&&_0xc3dd05['image']&&(_0xc3dd05['image'][_0x5ca3a5(0x1cab)](_0x5ca3a5(0x1c85))||_0xc3dd05[_0x5ca3a5(0xe5b)][_0x5ca3a5(0x1cab)](_0x5ca3a5(0x2403)));if(_0xc3dd05['isEmoji']&&(apiSettings[_0x5ca3a5(0x168d)]===![]||_0x14c9ed||_0x1b54e5)){const _0x39e92f=_0x14c9ed?_0x5ca3a5(0x1903):_0x1b54e5?_0x5ca3a5(0x1acf):_0x5ca3a5(0x226);let _0x1b400a;_0xc3dd05['content']&&_0xc3dd05[_0x5ca3a5(0x1423)][_0x5ca3a5(0x1424)]()?(_0x1b400a=_0xc3dd05[_0x5ca3a5(0x1423)]['trim']()+_0x5ca3a5(0x698)+(_0xc3dd05[_0x5ca3a5(0x13e3)]||_0x5ca3a5(0x13b5))+']',console[_0x5ca3a5(0xc0d)]('🔍\x20[图片分支修复]\x20发送文字+表情包描述\x20('+_0x39e92f+'):',_0x1b400a)):(_0x1b400a='[用户发送了表情包：'+(_0xc3dd05[_0x5ca3a5(0x13e3)]||_0x5ca3a5(0x13b5))+']',console[_0x5ca3a5(0xc0d)](_0x5ca3a5(0x6d1)+_0x39e92f+'):',_0x1b400a)),_0x216e21=await callChatAPI(_0x1b400a,currentChatCharacter);}else{const _0x57c018=[{'type':_0x5ca3a5(0x1e58),'text':_0xc3dd05[_0x5ca3a5(0x1423)]||''},{'type':_0x5ca3a5(0x1cfa),'image_url':{'url':_0xc3dd05['image']}}];console[_0x5ca3a5(0xc0d)]('🔍\x20[表情包调试]\x20发送给AI的消息内容:',_0x57c018),console[_0x5ca3a5(0xc0d)](_0x5ca3a5(0x1514),_0xc3dd05[_0x5ca3a5(0xe5b)]),console[_0x5ca3a5(0xc0d)](_0x5ca3a5(0xd36),_0xc3dd05[_0x5ca3a5(0xe29)]),_0x216e21=await callChatAPI(_0x57c018,currentChatCharacter);}}else{if(_0xc3dd05[_0x5ca3a5(0x23df)]===_0x5ca3a5(0xd8)){let _0xee55b1=_0x5ca3a5(0xe7d)+_0xc3dd05[_0x5ca3a5(0xca8)]+_0x5ca3a5(0x20de)+(_0xc3dd05[_0x5ca3a5(0x15fe)]||'无')+']';_0xc3dd05[_0x5ca3a5(0x65d)]&&(_0xee55b1=_0x5ca3a5(0x2058)+_0xc3dd05[_0x5ca3a5(0x65d)]+_0x5ca3a5(0x228a)+_0xc3dd05['amount']+_0x5ca3a5(0x20de)+(_0xc3dd05[_0x5ca3a5(0x15fe)]||'无')+']'),_0x216e21=await callChatAPI(_0xee55b1,currentChatCharacter);}else{console[_0x5ca3a5(0xc0d)]('🔍\x20[AI处理调试]\x20走普通文本分支'),console['log'](_0x5ca3a5(0x1c7a),_0xc3dd05),console[_0x5ca3a5(0xc0d)]('🔍\x20[AI处理调试]\x20userMessage.image存在吗:',!!_0xc3dd05[_0x5ca3a5(0xe5b)]),console['log'](_0x5ca3a5(0x1017),_0xc3dd05[_0x5ca3a5(0xe29)]);if(_0xc3dd05[_0x5ca3a5(0xe5b)]&&_0xc3dd05[_0x5ca3a5(0xe29)]){console['log']('🔍\x20[AI处理调试]\x20检测到表情包消息，重新路由到图片处理'),console[_0x5ca3a5(0xc0d)](_0x5ca3a5(0x9f3),_0xc3dd05[_0x5ca3a5(0xe5b)]),console[_0x5ca3a5(0xc0d)](_0x5ca3a5(0x2128),_0xc3dd05[_0x5ca3a5(0x13e3)]),console[_0x5ca3a5(0xc0d)](_0x5ca3a5(0x1ac),apiSettings['emojiRecognitionEnabled']),console[_0x5ca3a5(0xc0d)]('🔍\x20[表情包开关调试]\x20apiSettings:',apiSettings),console['log'](_0x5ca3a5(0x262),apiSettings[_0x5ca3a5(0x168d)]);const _0x10148f=_0xc3dd05[_0x5ca3a5(0xe5b)]?.[_0x5ca3a5(0x23ec)]('data:image/gif')||_0xc3dd05[_0x5ca3a5(0xe5b)]?.[_0x5ca3a5(0x1d64)]()[_0x5ca3a5(0x23ec)](_0x5ca3a5(0x12f2));console['log'](_0x5ca3a5(0xe21),_0x10148f);const _0x504631=_0xc3dd05[_0x5ca3a5(0xe5b)]&&(_0xc3dd05[_0x5ca3a5(0xe5b)]['startsWith']('http://')||_0xc3dd05[_0x5ca3a5(0xe5b)]['startsWith']('https://'));if(apiSettings['emojiRecognitionEnabled']===![]||_0x10148f||_0x504631){const _0x22527a=_0x10148f?'动图表情包':_0x504631?_0x5ca3a5(0x1acf):_0x5ca3a5(0x226);let _0x129b7c;_0xc3dd05[_0x5ca3a5(0x1423)]&&_0xc3dd05[_0x5ca3a5(0x1423)]['trim']()?(_0x129b7c=_0xc3dd05[_0x5ca3a5(0x1423)][_0x5ca3a5(0x1424)]()+_0x5ca3a5(0x698)+(_0xc3dd05[_0x5ca3a5(0x13e3)]||_0x5ca3a5(0x13b5))+']',console[_0x5ca3a5(0xc0d)]('🔍\x20[else分支修复]\x20发送文字+表情包描述\x20('+_0x22527a+'):',_0x129b7c)):(_0x129b7c=_0x5ca3a5(0x2019)+(_0xc3dd05[_0x5ca3a5(0x13e3)]||_0x5ca3a5(0x13b5))+']',console[_0x5ca3a5(0xc0d)](_0x5ca3a5(0x974)+_0x22527a+'):',_0x129b7c)),_0x216e21=await callChatAPI(_0x129b7c,currentChatCharacter);}else{const _0x124dee=[{'type':'text','text':_0xc3dd05[_0x5ca3a5(0x1423)]||''},{'type':'image_url','image_url':{'url':_0xc3dd05[_0x5ca3a5(0xe5b)]}}];console[_0x5ca3a5(0xc0d)](_0x5ca3a5(0x238f),_0x124dee),console[_0x5ca3a5(0xc0d)]('🔍\x20[表情包修复]\x20图片URL长度:',_0xc3dd05['image']?.['length']),_0x216e21=await callChatAPI(_0x124dee,currentChatCharacter);}}else{let _0x11cfe4=_0xc3dd05[_0x5ca3a5(0x1423)];if(_0xc3dd05['replyTo']){const _0xda9fb6=summarizeLastMessage({'content':_0xc3dd05['replyTo'][_0x5ca3a5(0x1423)]});_0x11cfe4='[回复\x20'+_0xc3dd05[_0x5ca3a5(0x180)][_0x5ca3a5(0xadb)]+_0x5ca3a5(0x1c8)+_0xda9fb6+_0x5ca3a5(0x19b3)+_0xc3dd05[_0x5ca3a5(0x1423)],console[_0x5ca3a5(0xc0d)]('✅\x20[重新生成]\x20构建用户引用提示:',_0x11cfe4);}_0x216e21=await callChatAPI(_0x11cfe4,currentChatCharacter);}}}}const _0x417621=await parseAiResponse(_0x216e21);for(let _0x1408c8=0x0;_0x1408c8<_0x417621[_0x5ca3a5(0xcbf)];_0x1408c8++){const _0x354a80=_0x417621[_0x1408c8];let _0x14270a;console[_0x5ca3a5(0xc0d)](_0x5ca3a5(0x1e5b),_0x1408c8,_0x354a80);if(typeof _0x354a80===_0x5ca3a5(0x3c4)&&_0x354a80!==null){if(_0x354a80[_0x5ca3a5(0x23df)]==='voice_message')_0x14270a={'id':(Date[_0x5ca3a5(0x18e0)]()+_0x1408c8)[_0x5ca3a5(0x9a3)](),'sender':_0x5ca3a5(0x232),'type':_0x5ca3a5(0x1bfd),'content':_0x354a80[_0x5ca3a5(0x1423)],'timestamp':Date[_0x5ca3a5(0x18e0)]()+_0x1408c8*0x64};else{if(_0x354a80[_0x5ca3a5(0x23df)]==='ai_image'){_0x14270a={'id':(Date[_0x5ca3a5(0x18e0)]()+_0x1408c8)[_0x5ca3a5(0x9a3)](),'sender':_0x5ca3a5(0x232),'type':'ai_image','content':_0x354a80[_0x5ca3a5(0x1c6f)]||_0x5ca3a5(0x44e),'imageDescription':_0x354a80[_0x5ca3a5(0x1c6f)],'timestamp':Date['now']()+_0x1408c8*0x64};if(_0x354a80[_0x5ca3a5(0x222f)]){console[_0x5ca3a5(0xc0d)]('🔍\x20[callChatAPI-AI图片]\x20检测到群聊消息，发送者:',_0x354a80[_0x5ca3a5(0x222f)]),_0x14270a[_0x5ca3a5(0x222f)]=_0x354a80[_0x5ca3a5(0x222f)];if(currentChatCharacter&&currentChatCharacter[_0x5ca3a5(0x4b7)]&&currentChatCharacter[_0x5ca3a5(0xcaa)]){const _0x1cd7f4=currentChatCharacter[_0x5ca3a5(0xcaa)]['find'](_0x4ab125=>_0x4ab125['name']===_0x354a80[_0x5ca3a5(0x222f)]);_0x1cd7f4?(_0x14270a['senderId']=_0x1cd7f4['id'],console[_0x5ca3a5(0xc0d)](_0x5ca3a5(0x2082),_0x1cd7f4['id'])):console[_0x5ca3a5(0xc0d)]('🔍\x20[callChatAPI-AI图片]\x20未找到群成员:',_0x354a80['name']);}}}else{if(_0x354a80[_0x5ca3a5(0x23df)]===_0x5ca3a5(0xd8))_0x14270a={'id':(Date[_0x5ca3a5(0x18e0)]()+_0x1408c8)['toString'](),'sender':'received','type':_0x5ca3a5(0xd8),'amount':_0x354a80['amount'],'note':_0x354a80[_0x5ca3a5(0x15fe)],'timestamp':Date[_0x5ca3a5(0x18e0)]()+_0x1408c8*0x64};else{if(_0x354a80[_0x5ca3a5(0x23df)]===_0x5ca3a5(0x252a)){console['log'](_0x5ca3a5(0x988),_0x354a80);const _0x30ae24=getCurrentChatSettings(),_0x68c575=_0x30ae24[_0x5ca3a5(0xb42)]||'你',_0x3bc9d6=_0x30ae24[_0x5ca3a5(0x582)]||'';_0x14270a={'id':(Date[_0x5ca3a5(0x18e0)]()+_0x1408c8)[_0x5ca3a5(0x9a3)](),'sender':'system','content':currentChatCharacter[_0x5ca3a5(0x222f)]+_0x5ca3a5(0xb6d)+_0x68c575+_0x3bc9d6,'timestamp':Date[_0x5ca3a5(0x18e0)]()+_0x1408c8*0x64,'isPoke':!![]};}else{if(_0x354a80['type']==='payment_request')console[_0x5ca3a5(0xc0d)](_0x5ca3a5(0x75e),_0x354a80),_0x14270a=null;else{if(_0x354a80[_0x5ca3a5(0x23df)]===_0x5ca3a5(0x1f41)&&!_0x354a80[_0x5ca3a5(0x222f)]){console[_0x5ca3a5(0xc0d)](_0x5ca3a5(0x1720),_0x354a80);const _0xd22af9=await findEmojiForAI(_0x354a80[_0x5ca3a5(0x1c6f)]);_0xd22af9?_0x14270a={'id':(Date[_0x5ca3a5(0x18e0)]()+_0x1408c8)[_0x5ca3a5(0x9a3)](),'sender':_0x5ca3a5(0x232),'content':'','image':_0xd22af9['url'],'isEmoji':!![],'emojiDescription':_0xd22af9['description'],'timestamp':Date[_0x5ca3a5(0x18e0)]()+_0x1408c8*0x64}:_0x14270a={'id':(Date['now']()+_0x1408c8)[_0x5ca3a5(0x9a3)](),'sender':_0x5ca3a5(0x232),'content':_0x5ca3a5(0xc7b)+_0x354a80['description']+_0x5ca3a5(0x1d49),'timestamp':Date[_0x5ca3a5(0x18e0)]()+_0x1408c8*0x64};}else{if(_0x354a80[_0x5ca3a5(0x23df)]===_0x5ca3a5(0x1913)){console['log'](_0x5ca3a5(0x165),_0x354a80);if(window[_0x5ca3a5(0x68c)]){console[_0x5ca3a5(0x17cc)](_0x5ca3a5(0x1d9b));continue;}const _0x218bea=chatMessages[currentChatCharacter['id']]||[];let _0x146baf=-0x1;for(let _0x460d0d=_0x218bea['length']-0x1;_0x460d0d>=0x0;_0x460d0d--){if(_0x218bea[_0x460d0d]['sender']===_0x5ca3a5(0x232)&&!_0x218bea[_0x460d0d][_0x5ca3a5(0x1dfd)]&&_0x218bea[_0x460d0d][_0x5ca3a5(0x23df)]!=='recalled_message'){_0x146baf=_0x460d0d;break;}}if(_0x146baf!==-0x1){const _0x5dc947=_0x218bea[_0x146baf];console[_0x5ca3a5(0xc0d)](_0x5ca3a5(0x19e6),_0x5dc947),await handleRecalledMessage(_0x5dc947[_0x5ca3a5(0x1423)],_0x5dc947['id']);}else console[_0x5ca3a5(0x17cc)](_0x5ca3a5(0x2522)),_0x14270a={'id':(Date[_0x5ca3a5(0x18e0)]()+_0x1408c8)[_0x5ca3a5(0x9a3)](),'sender':_0x5ca3a5(0x232),'content':_0x5ca3a5(0x27e),'timestamp':Date['now']()+_0x1408c8*0x64};continue;}else{if(_0x354a80['type']===_0x5ca3a5(0x777)){if(_0x354a80[_0x5ca3a5(0xc2e)]){let _0x4c38dc=_0x354a80[_0x5ca3a5(0xc2e)];if(_0x354a80[_0x5ca3a5(0xc2e)]===_0x5ca3a5(0xbb3)||_0x354a80['avatar_url']===_0x5ca3a5(0xbb3)||_0x354a80['avatar_url']===_0x5ca3a5(0xdaf)||_0x354a80['avatar_url']===_0x5ca3a5(0x1ef1)){const _0x545bae=getRecentUserImage();if(_0x545bae)_0x4c38dc=_0x545bae;else{_0x14270a={'id':(Date['now']()+_0x1408c8)[_0x5ca3a5(0x9a3)](),'sender':_0x5ca3a5(0x232),'content':_0x5ca3a5(0x20c2),'timestamp':Date['now']()+_0x1408c8*0x64};continue;}}const _0x57a393=await validateAvatarSource(_0x4c38dc);if(_0x57a393){const _0x2d26ba=await changeCharacterAvatarByAI(_0x4c38dc,_0x354a80[_0x5ca3a5(0xec5)]||'心情变化');if(_0x2d26ba)continue;else _0x14270a={'id':(Date['now']()+_0x1408c8)[_0x5ca3a5(0x9a3)](),'sender':_0x5ca3a5(0x232),'content':'[头像更换失败]','timestamp':Date[_0x5ca3a5(0x18e0)]()+_0x1408c8*0x64};}else _0x14270a={'id':(Date[_0x5ca3a5(0x18e0)]()+_0x1408c8)[_0x5ca3a5(0x9a3)](),'sender':_0x5ca3a5(0x232),'content':_0x5ca3a5(0x623),'timestamp':Date[_0x5ca3a5(0x18e0)]()+_0x1408c8*0x64};}else continue;}else{if(_0x354a80[_0x5ca3a5(0x23df)]===_0x5ca3a5(0x1fe5)){console[_0x5ca3a5(0xc0d)](_0x5ca3a5(0x227b),_0x354a80);const _0x2be85a=findMessageById(_0x354a80[_0x5ca3a5(0x16e)]);console[_0x5ca3a5(0xc0d)](_0x5ca3a5(0x1f4b),_0x2be85a);if(_0x2be85a){_0x14270a={'id':(Date[_0x5ca3a5(0x18e0)]()+_0x1408c8)[_0x5ca3a5(0x9a3)](),'sender':_0x5ca3a5(0x232),'content':_0x354a80[_0x5ca3a5(0x1423)],'replyTo':{'id':_0x2be85a['id'],'content':_0x2be85a[_0x5ca3a5(0x1423)],'senderName':_0x2be85a[_0x5ca3a5(0xf75)]===_0x5ca3a5(0xfda)?getCurrentPersonaName()||'用户':currentChatCharacter[_0x5ca3a5(0x222f)]||'AI'},'timestamp':Date[_0x5ca3a5(0x18e0)]()+_0x1408c8*0x64};if(_0x354a80[_0x5ca3a5(0x222f)]&&currentChatCharacter?.['isGroup']&&currentChatCharacter['members']){const _0x1914e2=currentChatCharacter[_0x5ca3a5(0xcaa)]['find'](_0x58ac71=>_0x58ac71['name']===_0x354a80['name']);_0x1914e2?(_0x14270a[_0x5ca3a5(0x222f)]=_0x354a80[_0x5ca3a5(0x222f)],_0x14270a['senderId']=_0x1914e2['id'],console['log']('🔍\x20[引用回复-早期分支]\x20设置群聊发送者:',_0x354a80[_0x5ca3a5(0x222f)],'ID:',_0x1914e2['id'])):console['log'](_0x5ca3a5(0x1556),_0x354a80[_0x5ca3a5(0x222f)]);}}else{console[_0x5ca3a5(0x17cc)](_0x5ca3a5(0x9b),_0x354a80[_0x5ca3a5(0x16e)]),_0x14270a={'id':(Date[_0x5ca3a5(0x18e0)]()+_0x1408c8)[_0x5ca3a5(0x9a3)](),'sender':_0x5ca3a5(0x232),'content':_0x354a80[_0x5ca3a5(0x1423)],'timestamp':Date[_0x5ca3a5(0x18e0)]()+_0x1408c8*0x64};if(_0x354a80[_0x5ca3a5(0x222f)]&&currentChatCharacter?.['isGroup']&&currentChatCharacter[_0x5ca3a5(0xcaa)]){const _0x2169fa=currentChatCharacter[_0x5ca3a5(0xcaa)][_0x5ca3a5(0x1aeb)](_0x43e9d5=>_0x43e9d5[_0x5ca3a5(0x222f)]===_0x354a80[_0x5ca3a5(0x222f)]);_0x2169fa?(_0x14270a['name']=_0x354a80[_0x5ca3a5(0x222f)],_0x14270a[_0x5ca3a5(0x210b)]=_0x2169fa['id'],console[_0x5ca3a5(0xc0d)](_0x5ca3a5(0x2078),_0x354a80[_0x5ca3a5(0x222f)],_0x5ca3a5(0xc91),_0x2169fa['id'])):console[_0x5ca3a5(0xc0d)](_0x5ca3a5(0x4d5),_0x354a80[_0x5ca3a5(0x222f)]);}}}else{if(_0x354a80[_0x5ca3a5(0x222f)]&&_0x354a80['type']===_0x5ca3a5(0x1f41)){console[_0x5ca3a5(0xc0d)](_0x5ca3a5(0xab0),_0x354a80);let _0x15b4d3=null;if(currentChatCharacter&&currentChatCharacter[_0x5ca3a5(0x4b7)]&&currentChatCharacter[_0x5ca3a5(0xcaa)]){console['log'](_0x5ca3a5(0xee3),{'targetName':_0x354a80[_0x5ca3a5(0x222f)],'allMembers':currentChatCharacter[_0x5ca3a5(0xcaa)],'memberNames':currentChatCharacter[_0x5ca3a5(0xcaa)][_0x5ca3a5(0xf6d)](_0x527c13=>_0x527c13['name'])});const _0x3cfe47=currentChatCharacter['members'][_0x5ca3a5(0x1aeb)](_0x23fe52=>_0x23fe52[_0x5ca3a5(0x222f)]===_0x354a80[_0x5ca3a5(0x222f)]);_0x3cfe47?(_0x15b4d3=_0x3cfe47['id'],console[_0x5ca3a5(0xc0d)](_0x5ca3a5(0x1d40),_0x3cfe47,_0x5ca3a5(0x1db9),_0x15b4d3)):(console[_0x5ca3a5(0x17cc)](_0x5ca3a5(0x175d),_0x354a80[_0x5ca3a5(0x222f)]),console[_0x5ca3a5(0x17cc)](_0x5ca3a5(0xcd5),currentChatCharacter[_0x5ca3a5(0xcaa)][_0x5ca3a5(0xf6d)](_0x585205=>_0x585205[_0x5ca3a5(0x222f)])));}const _0x58ce97=await findEmojiForAI(_0x354a80[_0x5ca3a5(0x1c6f)]);_0x58ce97?(console[_0x5ca3a5(0xc0d)](_0x5ca3a5(0x1362),_0x58ce97),_0x14270a={'id':(Date[_0x5ca3a5(0x18e0)]()+_0x1408c8)[_0x5ca3a5(0x9a3)](),'sender':_0x5ca3a5(0x232),'name':_0x354a80[_0x5ca3a5(0x222f)],'senderId':_0x15b4d3,'content':'','image':_0x58ce97[_0x5ca3a5(0x10c6)],'isEmoji':!![],'emojiDescription':_0x58ce97[_0x5ca3a5(0x1c6f)],'timestamp':Date[_0x5ca3a5(0x18e0)]()+_0x1408c8*0x64},console[_0x5ca3a5(0xc0d)](_0x5ca3a5(0x23b6),_0x14270a)):(console[_0x5ca3a5(0x17cc)](_0x5ca3a5(0x9f5),_0x354a80[_0x5ca3a5(0x1c6f)]),_0x14270a={'id':(Date['now']()+_0x1408c8)[_0x5ca3a5(0x9a3)](),'sender':_0x5ca3a5(0x232),'name':_0x354a80['name'],'senderId':_0x15b4d3,'content':'[表情包\x22'+_0x354a80[_0x5ca3a5(0x1c6f)]+_0x5ca3a5(0x1d49),'timestamp':Date[_0x5ca3a5(0x18e0)]()+_0x1408c8*0x64});}else{if(_0x354a80['name']&&_0x354a80['message']){console['log'](_0x5ca3a5(0x2029),_0x354a80),console['log'](_0x5ca3a5(0x3d2),typeof _0x354a80['message'],_0x5ca3a5(0x1ae5),_0x354a80[_0x5ca3a5(0xd7a)]);let _0x10de6c=null;if(currentChatCharacter&&currentChatCharacter[_0x5ca3a5(0x4b7)]&&currentChatCharacter[_0x5ca3a5(0xcaa)]){console[_0x5ca3a5(0xc0d)](_0x5ca3a5(0x25d),_0x354a80['name'],_0x5ca3a5(0x5de),currentChatCharacter[_0x5ca3a5(0x222f)]),console[_0x5ca3a5(0xc0d)](_0x5ca3a5(0x845),currentChatCharacter[_0x5ca3a5(0xcaa)]);const _0x5b1c19=currentChatCharacter[_0x5ca3a5(0xcaa)]['find'](_0x34cc54=>_0x34cc54[_0x5ca3a5(0x222f)]===_0x354a80[_0x5ca3a5(0x222f)]);_0x5b1c19?(_0x10de6c=_0x5b1c19['id'],console[_0x5ca3a5(0xc0d)](_0x5ca3a5(0x14e5),_0x5b1c19,_0x5ca3a5(0x1db9),_0x10de6c)):console['warn'](_0x5ca3a5(0x1bc7),_0x354a80['name']);}if(typeof _0x354a80[_0x5ca3a5(0xd7a)]===_0x5ca3a5(0x3c4)&&_0x354a80['message'][_0x5ca3a5(0x23df)]===_0x5ca3a5(0x1bfd))_0x14270a={'id':(Date[_0x5ca3a5(0x18e0)]()+_0x1408c8)[_0x5ca3a5(0x9a3)](),'sender':_0x5ca3a5(0x232),'type':_0x5ca3a5(0x1bfd),'name':_0x354a80[_0x5ca3a5(0x222f)],'senderId':_0x10de6c,'content':_0x354a80[_0x5ca3a5(0xd7a)][_0x5ca3a5(0x1423)],'timestamp':Date['now']()+_0x1408c8*0x64};else{if(typeof _0x354a80[_0x5ca3a5(0xd7a)]==='object'&&_0x354a80[_0x5ca3a5(0xd7a)][_0x5ca3a5(0x23df)]==='reply_to'){const _0x48421e=findMessageById(_0x354a80[_0x5ca3a5(0xd7a)][_0x5ca3a5(0x16e)]);_0x48421e?_0x14270a={'id':(Date['now']()+_0x1408c8)[_0x5ca3a5(0x9a3)](),'sender':_0x5ca3a5(0x232),'name':_0x354a80[_0x5ca3a5(0x222f)],'senderId':_0x10de6c,'content':_0x354a80[_0x5ca3a5(0xd7a)][_0x5ca3a5(0x1423)],'replyTo':{'id':_0x48421e['id'],'content':_0x48421e[_0x5ca3a5(0x1423)],'senderName':_0x48421e[_0x5ca3a5(0xf75)]==='sent'?getCurrentPersonaName()||'用户':_0x48421e['name']||_0x48421e[_0x5ca3a5(0xadb)]||'AI'},'timestamp':Date['now']()+_0x1408c8*0x64}:_0x14270a={'id':(Date['now']()+_0x1408c8)[_0x5ca3a5(0x9a3)](),'sender':'received','name':_0x354a80[_0x5ca3a5(0x222f)],'senderId':_0x10de6c,'content':_0x354a80[_0x5ca3a5(0xd7a)][_0x5ca3a5(0x1423)],'timestamp':Date['now']()+_0x1408c8*0x64};}else{if(typeof _0x354a80[_0x5ca3a5(0xd7a)]===_0x5ca3a5(0x3c4)&&_0x354a80[_0x5ca3a5(0xd7a)][_0x5ca3a5(0x23df)]===_0x5ca3a5(0x1f41)){console['log']('🔍\x20[群聊表情包]\x20检测到群聊表情包消息:',_0x354a80);const _0x43c7a9=await findEmojiForAI(_0x354a80['message'][_0x5ca3a5(0x1c6f)]);_0x43c7a9?(console['log'](_0x5ca3a5(0x1ab5),_0x43c7a9),_0x14270a={'id':(Date[_0x5ca3a5(0x18e0)]()+_0x1408c8)[_0x5ca3a5(0x9a3)](),'sender':_0x5ca3a5(0x232),'name':_0x354a80[_0x5ca3a5(0x222f)],'senderId':_0x10de6c,'content':'','image':_0x43c7a9['url'],'isEmoji':!![],'emojiDescription':_0x43c7a9['description'],'timestamp':Date[_0x5ca3a5(0x18e0)]()+_0x1408c8*0x64},console[_0x5ca3a5(0xc0d)](_0x5ca3a5(0xc7e),_0x14270a),console[_0x5ca3a5(0xc0d)](_0x5ca3a5(0x1434),_0x10de6c,_0x5ca3a5(0x2170),_0x354a80[_0x5ca3a5(0x222f)])):(console[_0x5ca3a5(0x17cc)]('🔍\x20[群聊表情包]\x20找不到匹配的表情包:',_0x354a80['message']['description']),_0x14270a={'id':(Date[_0x5ca3a5(0x18e0)]()+_0x1408c8)[_0x5ca3a5(0x9a3)](),'sender':_0x5ca3a5(0x232),'name':_0x354a80[_0x5ca3a5(0x222f)],'senderId':_0x10de6c,'content':_0x5ca3a5(0xc7b)+_0x354a80['message'][_0x5ca3a5(0x1c6f)]+'\x22不存在]','timestamp':Date['now']()+_0x1408c8*0x64});}else{if(typeof _0x354a80[_0x5ca3a5(0xd7a)]==='object'&&_0x354a80['message'][_0x5ca3a5(0x23df)]==='transfer')_0x14270a={'id':(Date['now']()+_0x1408c8)[_0x5ca3a5(0x9a3)](),'sender':_0x5ca3a5(0x232),'type':_0x5ca3a5(0xd8),'name':_0x354a80['name'],'senderId':_0x10de6c,'amount':_0x354a80[_0x5ca3a5(0xd7a)][_0x5ca3a5(0xca8)],'note':_0x354a80[_0x5ca3a5(0xd7a)][_0x5ca3a5(0x15fe)],'timestamp':Date[_0x5ca3a5(0x18e0)]()+_0x1408c8*0x64};else typeof _0x354a80[_0x5ca3a5(0xd7a)]==='object'&&_0x354a80[_0x5ca3a5(0xd7a)]['type']===_0x5ca3a5(0x14f2)?_0x14270a={'id':(Date[_0x5ca3a5(0x18e0)]()+_0x1408c8)[_0x5ca3a5(0x9a3)](),'sender':_0x5ca3a5(0x232),'type':_0x5ca3a5(0x14f2),'name':_0x354a80[_0x5ca3a5(0x222f)],'senderId':_0x10de6c,'message':_0x354a80[_0x5ca3a5(0xd7a)][_0x5ca3a5(0xd7a)],'timestamp':Date[_0x5ca3a5(0x18e0)]()+_0x1408c8*0x64}:_0x14270a={'id':(Date[_0x5ca3a5(0x18e0)]()+_0x1408c8)['toString'](),'sender':_0x5ca3a5(0x232),'name':_0x354a80[_0x5ca3a5(0x222f)],'senderId':_0x10de6c,'content':_0x354a80[_0x5ca3a5(0xd7a)],'timestamp':Date[_0x5ca3a5(0x18e0)]()+_0x1408c8*0x64};}}}}else{if(typeof _0x354a80===_0x5ca3a5(0x3c4)&&_0x354a80!==null){if(_0x354a80[_0x5ca3a5(0x23df)]===_0x5ca3a5(0xd8))_0x14270a={'id':(Date['now']()+_0x1408c8)[_0x5ca3a5(0x9a3)](),'sender':'received','type':'transfer','amount':_0x354a80[_0x5ca3a5(0xca8)],'note':_0x354a80[_0x5ca3a5(0x15fe)],'timestamp':Date[_0x5ca3a5(0x18e0)]()+_0x1408c8*0x64};else{if(_0x354a80['type']===_0x5ca3a5(0x1bfd))_0x14270a={'id':(Date[_0x5ca3a5(0x18e0)]()+_0x1408c8)[_0x5ca3a5(0x9a3)](),'sender':_0x5ca3a5(0x232),'type':_0x5ca3a5(0x1bfd),'content':_0x354a80[_0x5ca3a5(0x1423)],'timestamp':Date['now']()+_0x1408c8*0x64};else{if(_0x354a80[_0x5ca3a5(0x23df)]===_0x5ca3a5(0xb93))_0x14270a={'id':(Date['now']()+_0x1408c8)['toString'](),'sender':_0x5ca3a5(0x232),'type':_0x5ca3a5(0xb93),'content':'','image':_0x5ca3a5(0xfd)+encodeURIComponent(_0x5ca3a5(0x12a)),'imageDescription':_0x354a80[_0x5ca3a5(0x1c6f)],'timestamp':Date[_0x5ca3a5(0x18e0)]()+_0x1408c8*0x64};else{if(_0x354a80['type']===_0x5ca3a5(0x674))console[_0x5ca3a5(0xc0d)](_0x5ca3a5(0x13a5),_0x354a80),_0x14270a=null;else{if(_0x354a80['type']===_0x5ca3a5(0x1f41)){console['log']('🔍\x20[遗漏表情包]\x20检测到遗漏的表情包对象:',_0x354a80);const _0x4e6a9d=await findEmojiForAI(_0x354a80[_0x5ca3a5(0x1c6f)]);if(_0x4e6a9d){_0x14270a={'id':(Date[_0x5ca3a5(0x18e0)]()+_0x1408c8)[_0x5ca3a5(0x9a3)](),'sender':_0x5ca3a5(0x232),'content':'','image':_0x4e6a9d[_0x5ca3a5(0x10c6)],'isEmoji':!![],'emojiDescription':_0x4e6a9d[_0x5ca3a5(0x1c6f)],'timestamp':Date[_0x5ca3a5(0x18e0)]()+_0x1408c8*0x64};if(currentChatCharacter&&currentChatCharacter[_0x5ca3a5(0x4b7)]){if(currentChatCharacter['members']&&currentChatCharacter[_0x5ca3a5(0xcaa)][_0x5ca3a5(0xcbf)]>0x0){const _0x59d62e=currentChatCharacter[_0x5ca3a5(0xcaa)][0x0];_0x14270a[_0x5ca3a5(0x222f)]=_0x59d62e['name'],_0x14270a[_0x5ca3a5(0x210b)]=_0x59d62e['id'],console[_0x5ca3a5(0xc0d)](_0x5ca3a5(0xd5e),_0x59d62e[_0x5ca3a5(0x222f)],_0x5ca3a5(0xc91),_0x59d62e['id']);}}console[_0x5ca3a5(0xc0d)]('🔍\x20[遗漏表情包]\x20创建的消息对象:',_0x14270a);}else{_0x14270a={'id':(Date[_0x5ca3a5(0x18e0)]()+_0x1408c8)['toString'](),'sender':'received','content':_0x5ca3a5(0xc7b)+_0x354a80['description']+_0x5ca3a5(0x1d49),'timestamp':Date['now']()+_0x1408c8*0x64};if(currentChatCharacter&&currentChatCharacter['isGroup']){if(currentChatCharacter['members']&&currentChatCharacter[_0x5ca3a5(0xcaa)]['length']>0x0){const _0x363709=currentChatCharacter[_0x5ca3a5(0xcaa)][0x0];_0x14270a[_0x5ca3a5(0x222f)]=_0x363709[_0x5ca3a5(0x222f)],_0x14270a[_0x5ca3a5(0x210b)]=_0x363709['id'];}}}}else{if(_0x354a80[_0x5ca3a5(0x23df)]&&[_0x5ca3a5(0x20b8),_0x5ca3a5(0xb18),'block_user',_0x5ca3a5(0xac3),_0x5ca3a5(0x246f),_0x5ca3a5(0x1f1e),_0x5ca3a5(0xdfb)][_0x5ca3a5(0x23ec)](_0x354a80[_0x5ca3a5(0x23df)])){console[_0x5ca3a5(0xc0d)](_0x5ca3a5(0x23f3),_0x354a80);continue;}const _0x5cfe1c=_0x354a80[_0x5ca3a5(0x1423)]||_0x354a80[_0x5ca3a5(0xd7a)]||_0x354a80[_0x5ca3a5(0x1e58)]||_0x354a80[_0x5ca3a5(0x222b)]||_0x5ca3a5(0x1a55);_0x14270a={'id':(Date[_0x5ca3a5(0x18e0)]()+_0x1408c8)[_0x5ca3a5(0x9a3)](),'sender':'received','content':_0x5cfe1c,'timestamp':Date[_0x5ca3a5(0x18e0)]()+_0x1408c8*0x64};}}}}}}else{const _0x2608d6=String(_0x354a80);_0x14270a={'id':(Date['now']()+_0x1408c8)[_0x5ca3a5(0x9a3)](),'sender':_0x5ca3a5(0x232),'content':_0x2608d6,'timestamp':Date['now']()+_0x1408c8*0x64};}}}}}}}}}}}}}else{if(typeof _0x354a80===_0x5ca3a5(0x3c4)&&_0x354a80!==null){if(_0x354a80[_0x5ca3a5(0x23df)]===_0x5ca3a5(0xd8))_0x14270a={'id':(Date[_0x5ca3a5(0x18e0)]()+_0x1408c8)[_0x5ca3a5(0x9a3)](),'sender':'received','type':'transfer','amount':_0x354a80[_0x5ca3a5(0xca8)],'note':_0x354a80[_0x5ca3a5(0x15fe)],'timestamp':Date['now']()+_0x1408c8*0x64};else{if(_0x354a80[_0x5ca3a5(0x23df)]===_0x5ca3a5(0x1bfd))_0x14270a={'id':(Date['now']()+_0x1408c8)[_0x5ca3a5(0x9a3)](),'sender':_0x5ca3a5(0x232),'type':_0x5ca3a5(0x1bfd),'content':_0x354a80[_0x5ca3a5(0x1423)],'timestamp':Date[_0x5ca3a5(0x18e0)]()+_0x1408c8*0x64};else{if(_0x354a80[_0x5ca3a5(0x23df)]===_0x5ca3a5(0xb93)){_0x14270a={'id':(Date['now']()+_0x1408c8)['toString'](),'sender':_0x5ca3a5(0x232),'type':'ai_image','content':_0x354a80[_0x5ca3a5(0x1c6f)]||_0x5ca3a5(0x44e),'imageDescription':_0x354a80[_0x5ca3a5(0x1c6f)],'timestamp':Date[_0x5ca3a5(0x18e0)]()+_0x1408c8*0x64};if(_0x354a80['name']){console[_0x5ca3a5(0xc0d)]('🔍\x20[第四处-AI图片]\x20检测到群聊消息，发送者:',_0x354a80[_0x5ca3a5(0x222f)]),_0x14270a[_0x5ca3a5(0x222f)]=_0x354a80[_0x5ca3a5(0x222f)];if(currentChatCharacter&&currentChatCharacter[_0x5ca3a5(0x4b7)]&&currentChatCharacter[_0x5ca3a5(0xcaa)]){const _0x4eba53=currentChatCharacter[_0x5ca3a5(0xcaa)][_0x5ca3a5(0x1aeb)](_0x7c5039=>_0x7c5039[_0x5ca3a5(0x222f)]===_0x354a80[_0x5ca3a5(0x222f)]);_0x4eba53?(_0x14270a[_0x5ca3a5(0x210b)]=_0x4eba53['id'],console['log'](_0x5ca3a5(0x21a),_0x4eba53['id'])):console[_0x5ca3a5(0xc0d)](_0x5ca3a5(0x1e79),_0x354a80['name']);}}}else{if(_0x354a80[_0x5ca3a5(0x23df)]===_0x5ca3a5(0x1f41)){const _0x589697=await findEmojiForAI(_0x354a80[_0x5ca3a5(0x1c6f)]);_0x589697?_0x14270a={'id':(Date[_0x5ca3a5(0x18e0)]()+_0x1408c8)[_0x5ca3a5(0x9a3)](),'sender':_0x5ca3a5(0x232),'content':'','image':_0x589697[_0x5ca3a5(0x10c6)],'isEmoji':!![],'emojiDescription':_0x589697[_0x5ca3a5(0x1c6f)],'timestamp':Date[_0x5ca3a5(0x18e0)]()+_0x1408c8*0x64}:_0x14270a={'id':(Date[_0x5ca3a5(0x18e0)]()+_0x1408c8)[_0x5ca3a5(0x9a3)](),'sender':'received','content':_0x5ca3a5(0xc7b)+_0x354a80['description']+_0x5ca3a5(0x1d49),'timestamp':Date[_0x5ca3a5(0x18e0)]()+_0x1408c8*0x64};}else{if(_0x354a80[_0x5ca3a5(0x23df)]&&['create_anniversary','create_appointment',_0x5ca3a5(0x1db6),_0x5ca3a5(0xac3),_0x5ca3a5(0x246f),'background_task',_0x5ca3a5(0xdfb)][_0x5ca3a5(0x23ec)](_0x354a80[_0x5ca3a5(0x23df)])){console[_0x5ca3a5(0xc0d)](_0x5ca3a5(0x1f59),_0x354a80);continue;}const _0xdef200=_0x354a80[_0x5ca3a5(0x1423)]||_0x354a80[_0x5ca3a5(0xd7a)]||_0x354a80[_0x5ca3a5(0x1e58)]||_0x354a80['reply']||_0x5ca3a5(0x1a55);_0x14270a={'id':(Date[_0x5ca3a5(0x18e0)]()+_0x1408c8)['toString'](),'sender':_0x5ca3a5(0x232),'content':_0xdef200,'timestamp':Date[_0x5ca3a5(0x18e0)]()+_0x1408c8*0x64};}}}}}else typeof _0x354a80===_0x5ca3a5(0xb97)?(console['log'](_0x5ca3a5(0x2552),_0x354a80),_0x14270a={'id':(Date[_0x5ca3a5(0x18e0)]()+_0x1408c8)[_0x5ca3a5(0x9a3)](),'sender':'received','content':_0x354a80,'timestamp':Date[_0x5ca3a5(0x18e0)]()+_0x1408c8*0x64}):(console[_0x5ca3a5(0xc0d)]('🔥\x20[DEBUG]\x20处理其他类型消息:',typeof _0x354a80,_0x354a80),_0x14270a={'id':(Date['now']()+_0x1408c8)[_0x5ca3a5(0x9a3)](),'sender':_0x5ca3a5(0x232),'content':String(_0x354a80),'timestamp':Date[_0x5ca3a5(0x18e0)]()+_0x1408c8*0x64});}chatMessages[_0x7af54f][_0x5ca3a5(0x6ee)](_0x14270a);try{const _0x5753b8=_0x7af54f+_0x5ca3a5(0xae2)+_0x14270a[_0x5ca3a5(0x7aa)]+'_'+Math[_0x5ca3a5(0x191c)]()[_0x5ca3a5(0x9a3)](0x24)[_0x5ca3a5(0x18cf)](0x2,0x9)+'_'+(chatMessages[_0x7af54f][_0x5ca3a5(0xcbf)]-0x1);await db[_0x5ca3a5(0x464)][_0x5ca3a5(0xe1)]({'id':_0x5753b8,'characterId':_0x7af54f,'timestamp':_0x14270a[_0x5ca3a5(0x7aa)],'messageOrder':chatMessages[_0x7af54f]['length']-0x1,'originalMessageId':_0x14270a['id'],'messageData':_0x14270a}),console[_0x5ca3a5(0xc0d)](_0x5ca3a5(0x11a2));}catch(_0x4d84ee){console[_0x5ca3a5(0x24ab)](_0x5ca3a5(0x2380),_0x4d84ee),await saveChatMessages();}const _0x1ce37f=characters[_0x5ca3a5(0x1aeb)](_0x25dc1c=>_0x25dc1c['id']===_0x7af54f);if(_0x1ce37f){const _0x3a5dea={'sender':_0x7af54f,'content':_0x14270a['content']||'[特殊消息]','messageType':_0x14270a[_0x5ca3a5(0x23df)]||_0x5ca3a5(0x1e58)};_0x14270a[_0x5ca3a5(0x180)]&&(_0x3a5dea[_0x5ca3a5(0x23d2)]=_0x14270a[_0x5ca3a5(0x180)]['id'],_0x3a5dea['replyToSender']=_0x14270a[_0x5ca3a5(0x180)][_0x5ca3a5(0xadb)],_0x3a5dea[_0x5ca3a5(0x177a)]=_0x14270a[_0x5ca3a5(0x180)][_0x5ca3a5(0x1423)]),await recordMemoryEvent([_0x7af54f,_0x5ca3a5(0x23b2)],{'type':_0x1ce37f['isGroup']?'group_chat':_0x5ca3a5(0x10d7),'id':_0x7af54f},_0x5ca3a5(0xd7a),_0x3a5dea,0.7);}_0x1408c8===0x0&&hideTypingIndicator();addMessageWithAnimation(_0x14270a,_0x7af54f);if(_0x1408c8<_0x417621[_0x5ca3a5(0xcbf)]-0x1){const _0x1276e7=Math[_0x5ca3a5(0x191c)]()*0x3e8+0x1f4;await new Promise(_0x2d792f=>setTimeout(_0x2d792f,_0x1276e7)),showTypingIndicator(),await new Promise(_0x47e45d=>setTimeout(_0x47e45d,Math['random']()*0x320+0x190)),hideTypingIndicator();}}}catch(_0x196f07){console[_0x5ca3a5(0x24ab)](_0x5ca3a5(0xeb6),_0x196f07),hideTypingIndicator();const _0x189158={'id':Date[_0x5ca3a5(0x18e0)]()['toString'](),'sender':_0x5ca3a5(0x232),'content':'[重新生成失败:\x20'+_0x196f07[_0x5ca3a5(0xd7a)]+']','timestamp':Date['now']()};chatMessages[_0x7af54f]['push'](_0x189158);try{await saveChatMessagesImmediate([_0x7af54f]),console[_0x5ca3a5(0xc0d)](_0x5ca3a5(0x388));}catch(_0x319537){console[_0x5ca3a5(0x24ab)]('错误消息保存失败，回退到全量保存:',_0x319537),await saveChatMessages();}renderChatMessages(_0x7af54f);}finally{pendingUserMessage=null,window[_0x5ca3a5(0x5d9)]=![];}updateFloatingButtonsVisibility();}function triggerSmartReply(){const _0x135f6f=_0x2cf6d4;console[_0x135f6f(0xc0d)](_0x135f6f(0x1c87)),console[_0x135f6f(0xc0d)](_0x135f6f(0x6fd),new Error()[_0x135f6f(0x181c)]);if(!currentChatCharacter){alert('请先选择一个角色');return;}if(isWaitingForReply)return;const _0x17be0f=chatMessages[currentChatCharacter['id']]||[];let _0x4be03b=[],_0x5a95ee=-0x1;for(let _0x5a342a=_0x17be0f[_0x135f6f(0xcbf)]-0x1;_0x5a342a>=0x0;_0x5a342a--){if(_0x17be0f[_0x5a342a]['sender']===_0x135f6f(0x232)){_0x5a95ee=_0x5a342a;break;}}for(let _0x2ac20c=_0x5a95ee+0x1;_0x2ac20c<_0x17be0f[_0x135f6f(0xcbf)];_0x2ac20c++){_0x17be0f[_0x2ac20c][_0x135f6f(0xf75)]===_0x135f6f(0xfda)&&_0x4be03b[_0x135f6f(0x6ee)](_0x17be0f[_0x2ac20c]);}const _0x5b3a8e=_0x17be0f[_0x135f6f(0x136)]()[_0x135f6f(0x2253)]()[_0x135f6f(0x1aeb)](_0x1cca6f=>_0x1cca6f[_0x135f6f(0xf75)]===_0x135f6f(0xfda)),_0x3db1e1=_0x4be03b['length']>0x0;if(_0x4be03b[_0x135f6f(0xcbf)]>0x0){console[_0x135f6f(0xc0d)](_0x135f6f(0x1839),_0x4be03b['length']);const _0x4b890c=[];let _0x79e6c5='',_0x203866=0x0;_0x4be03b[_0x135f6f(0x900)]((_0x5474a3,_0x448b40)=>{const _0x44b0e5=_0x135f6f;console[_0x44b0e5(0xc0d)](_0x44b0e5(0x106b)+(_0x448b40+0x1)+':',{'id':_0x5474a3['id'],'type':_0x5474a3[_0x44b0e5(0x23df)],'contentLength':Array[_0x44b0e5(0x1bcc)](_0x5474a3[_0x44b0e5(0x1423)])?_0x5474a3[_0x44b0e5(0x1423)]['length']:0x1,'hasImage':Array[_0x44b0e5(0x1bcc)](_0x5474a3[_0x44b0e5(0x1423)])?_0x5474a3[_0x44b0e5(0x1423)][_0x44b0e5(0x184b)](_0x54b8d5=>_0x54b8d5['type']===_0x44b0e5(0x1cfa)):!!(_0x5474a3[_0x44b0e5(0xe5b)]||_0x5474a3[_0x44b0e5(0xd59)])});if(_0x5474a3[_0x44b0e5(0x23df)]===_0x44b0e5(0xd8)&&_0x5474a3[_0x44b0e5(0xe54)]){console[_0x44b0e5(0xc0d)](_0x44b0e5(0x1276),_0x5474a3);return;}if(Array[_0x44b0e5(0x1bcc)](_0x5474a3['content'])){const _0x2f8bdc=_0x5474a3[_0x44b0e5(0x1423)][_0x44b0e5(0x184b)](_0x2ddf94=>_0x2ddf94['type']===_0x44b0e5(0x1cfa)),_0x14755d=_0x5474a3[_0x44b0e5(0x1423)][_0x44b0e5(0x803)](_0xda8206=>_0xda8206[_0x44b0e5(0x23df)]===_0x44b0e5(0x1e58)&&_0xda8206[_0x44b0e5(0x1e58)]&&_0xda8206[_0x44b0e5(0x1e58)][_0x44b0e5(0x1424)]()),_0x34298e=_0x5474a3[_0x44b0e5(0x1423)][_0x44b0e5(0x803)](_0x7c8822=>_0x7c8822[_0x44b0e5(0x23df)]===_0x44b0e5(0x1cfa));_0x14755d[_0x44b0e5(0xcbf)]>0x0&&_0x14755d[_0x44b0e5(0x900)](_0x4dafb4=>{const _0xc2197e=_0x44b0e5;_0x4b890c[_0xc2197e(0x6ee)]({'type':_0xc2197e(0x1e58),'text':_0xc2197e(0x19ca)+_0x5474a3['id']+']\x20'+_0x4dafb4[_0xc2197e(0x1e58)],'originalMessageId':_0x5474a3['id']});}),_0x34298e['length']>0x0&&_0x34298e[_0x44b0e5(0x900)](_0x33d5ff=>{_0x4b890c['push'](_0x33d5ff);}),console['log'](_0x44b0e5(0x1477)+_0x14755d[_0x44b0e5(0xcbf)]+_0x44b0e5(0x1c86)+_0x34298e[_0x44b0e5(0xcbf)]+'个');}else{if(_0x5474a3['type']===_0x44b0e5(0xd8)){let _0x46c4ce=_0x44b0e5(0xe7d)+_0x5474a3[_0x44b0e5(0xca8)]+'元，备注：'+(_0x5474a3['note']||'无')+']';_0x5474a3[_0x44b0e5(0x65d)]&&(_0x46c4ce=_0x44b0e5(0x2058)+_0x5474a3[_0x44b0e5(0x65d)]+_0x44b0e5(0x228a)+_0x5474a3[_0x44b0e5(0xca8)]+_0x44b0e5(0x20de)+(_0x5474a3[_0x44b0e5(0x15fe)]||'无')+']'),_0x4b890c[_0x44b0e5(0x6ee)]({'type':_0x44b0e5(0x1e58),'text':'[ID:'+_0x5474a3['id']+']\x20'+_0x46c4ce,'originalMessageId':_0x5474a3['id']}),console[_0x44b0e5(0xc0d)](_0x44b0e5(0x5ea),_0x46c4ce);}else{if(_0x5474a3[_0x44b0e5(0x23df)]===_0x44b0e5(0x1bfd)||_0x5474a3[_0x44b0e5(0x23df)]===_0x44b0e5(0x2c2)){const _0x20df77='[用户发来一条语音消息，内容是：\x27'+_0x5474a3[_0x44b0e5(0x1423)]+'\x27]';_0x4b890c[_0x44b0e5(0x6ee)]({'type':'text','text':'[ID:'+_0x5474a3['id']+']\x20'+_0x20df77,'originalMessageId':_0x5474a3['id']}),console[_0x44b0e5(0xc0d)](_0x44b0e5(0x7e5),_0x20df77);}else{if(_0x5474a3[_0x44b0e5(0x23df)]==='user_photo'){const _0x3eb0f0=_0x44b0e5(0xdce)+_0x5474a3[_0x44b0e5(0x1423)]+'\x27]';_0x4b890c[_0x44b0e5(0x6ee)]({'type':_0x44b0e5(0x1e58),'text':'[ID:'+_0x5474a3['id']+']\x20'+_0x3eb0f0,'originalMessageId':_0x5474a3['id']}),console[_0x44b0e5(0xc0d)](_0x44b0e5(0x21cb),_0x3eb0f0);}else{if(_0x5474a3[_0x44b0e5(0x23df)]===_0x44b0e5(0x63b)){const _0x224c5d=_0x5474a3[_0x44b0e5(0x1423)]||_0x44b0e5(0x20e4)+_0x5474a3['locationName']+']';_0x4b890c[_0x44b0e5(0x6ee)]({'type':'text','text':_0x44b0e5(0x19ca)+_0x5474a3['id']+']\x20'+_0x224c5d,'originalMessageId':_0x5474a3['id']}),console[_0x44b0e5(0xc0d)](_0x44b0e5(0x17b4),_0x224c5d);}else{if((_0x5474a3[_0x44b0e5(0xe5b)]||_0x5474a3[_0x44b0e5(0xd59)])&&!Array['isArray'](_0x5474a3[_0x44b0e5(0x1423)])){console[_0x44b0e5(0xc0d)](_0x44b0e5(0x1552)+_0x5474a3['id']+_0x44b0e5(0x217d)+!!_0x5474a3[_0x44b0e5(0xe5b)]+',\x20hasImageUrl:'+!!_0x5474a3[_0x44b0e5(0xd59)]);const _0x1f6456=_0x5474a3[_0x44b0e5(0xe5b)]||_0x5474a3[_0x44b0e5(0xd59)],_0x4bb987=_0x1f6456&&(_0x1f6456[_0x44b0e5(0x1cab)](_0x44b0e5(0x1c85))||_0x1f6456[_0x44b0e5(0x1cab)]('https://')),_0x1b2223=_0x5474a3['isEmoji']&&(_0x1f6456?.[_0x44b0e5(0x23ec)](_0x44b0e5(0x38d))||_0x1f6456?.[_0x44b0e5(0x1d64)]()[_0x44b0e5(0x23ec)](_0x44b0e5(0x12f2)));console[_0x44b0e5(0xc0d)](_0x44b0e5(0x2388)+_0x5474a3['isEmoji']+_0x44b0e5(0x678)+_0x4bb987+_0x44b0e5(0x1d52)+_0x1b2223);if(_0x5474a3['isEmoji']&&(apiSettings[_0x44b0e5(0x168d)]===![]||_0x1b2223||_0x4bb987)){const _0xed5042=_0x1b2223?_0x44b0e5(0x1903):_0x4bb987?_0x44b0e5(0x1acf):'表情包识别已关闭';console[_0x44b0e5(0xc0d)](_0x44b0e5(0x1a99)+_0xed5042+_0x44b0e5(0x1ea8));let _0x1ae7e3=_0x5474a3[_0x44b0e5(0x1423)]||_0x44b0e5(0x2019)+(_0x5474a3[_0x44b0e5(0x13e3)]||'表情包')+']';_0x4b890c[_0x44b0e5(0x6ee)]({'type':_0x44b0e5(0x1e58),'text':'[ID:'+_0x5474a3['id']+']\x20'+_0x1ae7e3,'originalMessageId':_0x5474a3['id']});}else _0x5474a3[_0x44b0e5(0x1423)]&&typeof _0x5474a3['content']==='string'&&_0x4b890c['push']({'type':_0x44b0e5(0x1e58),'text':_0x44b0e5(0x19ca)+_0x5474a3['id']+']\x20'+_0x5474a3[_0x44b0e5(0x1423)],'originalMessageId':_0x5474a3['id']}),_0x4b890c[_0x44b0e5(0x6ee)]({'type':_0x44b0e5(0x1cfa),'image_url':{'url':_0x1f6456}});}else{if(_0x5474a3['type']===_0x44b0e5(0x8fa)){console[_0x44b0e5(0xc0d)](_0x44b0e5(0x5cc),_0x5474a3);const _0x84d190=_0x5474a3[_0x44b0e5(0x103c)]||{},_0x5db0dd=_0x84d190[_0x44b0e5(0x24ef)]||[],_0x504aba=_0x5db0dd[_0x44b0e5(0xf6d)](_0x3d422d=>{const _0x28fdfa=_0x44b0e5;let _0x536765=_0x3d422d[_0x28fdfa(0x222f)]+'\x20x'+_0x3d422d['quantity']+'\x20(¥'+_0x3d422d[_0x28fdfa(0xbfc)]+')';if(_0x3d422d[_0x28fdfa(0xebe)]&&Object[_0x28fdfa(0x16c7)](_0x3d422d[_0x28fdfa(0xebe)])[_0x28fdfa(0xcbf)]>0x0){const _0x3e4536=Object[_0x28fdfa(0x230e)](_0x3d422d[_0x28fdfa(0xebe)])['map'](([_0x5ef3df,_0x52eab3])=>getOptionLabel(_0x5ef3df)+':\x20'+_0x52eab3)[_0x28fdfa(0x140c)](',\x20');_0x536765+='\x20['+_0x3e4536+']';}return _0x536765;})[_0x44b0e5(0x140c)]('、'),_0x273e26=_0x5474a3['orderType']===_0x44b0e5(0x1c4e)?_0x44b0e5(0x22aa):_0x5474a3[_0x44b0e5(0x87a)]===_0x44b0e5(0x589)?_0x44b0e5(0x70a):_0x5474a3[_0x44b0e5(0x87a)]==='request_pay_self'?_0x44b0e5(0x1147):_0x5474a3[_0x44b0e5(0x87a)]===_0x44b0e5(0x870)?'请对方代付为对方下单':'下单',_0x2df1a0=_0x44b0e5(0x202b)+_0x273e26+_0x44b0e5(0x1d63)+(_0x84d190[_0x44b0e5(0x1dbe)]||0x0)+_0x44b0e5(0xfd9)+(_0x504aba||_0x44b0e5(0x100b))+']';console['log']('🛒\x20[triggerSmartReply]\x20转换后的内容:',_0x2df1a0),_0x4b890c['push']({'type':_0x44b0e5(0x1e58),'text':_0x44b0e5(0x19ca)+_0x5474a3['id']+']\x20'+_0x2df1a0,'originalMessageId':_0x5474a3['id']});}else _0x4b890c[_0x44b0e5(0x6ee)]({'type':_0x44b0e5(0x1e58),'text':_0x44b0e5(0x19ca)+_0x5474a3['id']+']\x20'+_0x5474a3[_0x44b0e5(0x1423)],'originalMessageId':_0x5474a3['id']});}}}}}}_0x79e6c5+=_0x5474a3['id']+'_',_0x203866=Math[_0x44b0e5(0x910)](_0x203866,_0x5474a3['timestamp']);}),pendingUserMessage={'id':_0x79e6c5[_0x135f6f(0x136)](0x0,-0x1),'sender':_0x135f6f(0xfda),'content':_0x4b890c,'timestamp':_0x203866,'isMerged':!![],'originalMessages':_0x4be03b},console[_0x135f6f(0xc0d)](_0x135f6f(0x1248),{'contentLength':pendingUserMessage[_0x135f6f(0x1423)][_0x135f6f(0xcbf)],'hasText':pendingUserMessage[_0x135f6f(0x1423)]['some'](_0x59fa66=>_0x59fa66[_0x135f6f(0x23df)]===_0x135f6f(0x1e58)),'hasImage':pendingUserMessage[_0x135f6f(0x1423)]['some'](_0x58bbfe=>_0x58bbfe['type']===_0x135f6f(0x1cfa)),'textCount':pendingUserMessage[_0x135f6f(0x1423)]['filter'](_0x20dd21=>_0x20dd21[_0x135f6f(0x23df)]==='text')['length'],'imageCount':pendingUserMessage[_0x135f6f(0x1423)][_0x135f6f(0x803)](_0x154989=>_0x154989[_0x135f6f(0x23df)]===_0x135f6f(0x1cfa))[_0x135f6f(0xcbf)]}),processAIReply();return;}if(_0x5b3a8e&&!_0x3db1e1){let _0x104f86=0x0,_0x267e40=-0x1;for(let _0x167854=_0x17be0f[_0x135f6f(0xcbf)]-0x1;_0x167854>=0x0;_0x167854--){if(_0x17be0f[_0x167854][_0x135f6f(0xf75)]===_0x135f6f(0xfda)){_0x267e40=_0x167854;break;}}if(_0x267e40!==-0x1){let _0x5434c2=![];for(let _0xafb091=_0x267e40+0x1;_0xafb091<_0x17be0f['length'];_0xafb091++){_0x17be0f[_0xafb091][_0x135f6f(0xf75)]===_0x135f6f(0x232)?!_0x5434c2&&(_0x104f86++,_0x5434c2=!![]):_0x5434c2=![];}}if(_0x104f86>=0x3){const _0x425a0f=currentChatCharacter[_0x135f6f(0x222f)];alert(_0x425a0f+_0x135f6f(0x1d3d)+_0x425a0f+_0x135f6f(0x101f));return;}const _0x38877f=_0x17be0f['slice']()[_0x135f6f(0x2253)]()[_0x135f6f(0x1aeb)](_0x445503=>_0x445503[_0x135f6f(0xf75)]==='sent'&&_0x445503[_0x135f6f(0x23df)]==='transfer'&&!_0x445503[_0x135f6f(0xe54)]);if(_0x38877f){pendingUserMessage=_0x38877f,processAIReply();return;}processAIContinuation();return;}alert(_0x135f6f(0x1baa));}async function processAIContinuation(){const _0x7dcf89=_0x2cf6d4;if(!currentChatCharacter)return;if(isWaitingForReply){console[_0x7dcf89(0xc0d)](_0x7dcf89(0x498));return;}const _0x3de59f=currentChatCharacter['id'];isWaitingForReply=!![];const _0x3fe9df=document[_0x7dcf89(0x566)](_0x7dcf89(0x9c));_0x3fe9df&&(_0x3fe9df[_0x7dcf89(0x194e)]=!![],_0x3fe9df[_0x7dcf89(0x655)]['opacity']=_0x7dcf89(0x6e3),_0x3fe9df['innerHTML']=_0x7dcf89(0x18ce));showTypingIndicator();const _0x4a98b5=Math[_0x7dcf89(0x191c)]()*0x7d0+0x3e8;await new Promise(_0x462bfc=>setTimeout(_0x462bfc,_0x4a98b5));try{const _0x44ccfd=chatMessages[_0x3de59f]||[];let _0x3e2c41='';for(let _0x14f27a=_0x44ccfd[_0x7dcf89(0xcbf)]-0x1;_0x14f27a>=0x0;_0x14f27a--){if(_0x44ccfd[_0x14f27a]['sender']===_0x7dcf89(0x232)){_0x3e2c41=_0x44ccfd[_0x14f27a][_0x7dcf89(0x1423)]||'';break;}}let _0x2c1ebb=_0x7dcf89(0x599)+_0x3e2c41+_0x7dcf89(0x817);_0x2c1ebb+=_0x7dcf89(0x1521),_0x2c1ebb+=_0x7dcf89(0x109f);const _0x365726=await callChatAPI(_0x2c1ebb,currentChatCharacter),_0x41698f=await parseAiResponse(_0x365726),_0x2f6f59=chatMessages[_0x3de59f]||[],_0x46bf16=_0x2f6f59[_0x7dcf89(0x136)]()[_0x7dcf89(0x2253)]()[_0x7dcf89(0x1aeb)](_0xceba15=>_0xceba15[_0x7dcf89(0xf75)]==='sent'&&_0xceba15[_0x7dcf89(0x23df)]===_0x7dcf89(0xd8)&&!_0xceba15[_0x7dcf89(0xe54)]);_0x46bf16&&(console['log'](_0x7dcf89(0x1956),{'lastUserMessage':_0x46bf16,'aiMessages':_0x41698f,'characterName':currentChatCharacter?.[_0x7dcf89(0x222f)]}),await processUserTransfer(_0x46bf16,_0x41698f,_0x3de59f));hideTypingIndicator();for(let _0x4ef6=0x0;_0x4ef6<_0x41698f[_0x7dcf89(0xcbf)];_0x4ef6++){const _0x16079a=_0x41698f[_0x4ef6];let _0x5b0d16;if(typeof _0x16079a==='object'&&_0x16079a[_0x7dcf89(0x23df)]===_0x7dcf89(0x1913)){console[_0x7dcf89(0xc0d)]('🔥\x20[续写]\x20AI请求撤回上一条消息:',_0x16079a);if(window[_0x7dcf89(0x68c)]){console[_0x7dcf89(0x17cc)](_0x7dcf89(0x1261));continue;}const _0x554d32=chatMessages[_0x3de59f]||[];let _0x436e08=-0x1;for(let _0x5662a1=_0x554d32['length']-0x1;_0x5662a1>=0x0;_0x5662a1--){if(_0x554d32[_0x5662a1]['sender']===_0x7dcf89(0x232)&&!_0x554d32[_0x5662a1]['isRecalled']&&_0x554d32[_0x5662a1][_0x7dcf89(0x23df)]!=='recalled_message'){_0x436e08=_0x5662a1;break;}}if(_0x436e08!==-0x1){const _0x85aa73=_0x554d32[_0x436e08];console['log'](_0x7dcf89(0x1a6f),_0x85aa73),await handleRecalledMessage(_0x85aa73['content'],_0x85aa73['id']);}else console[_0x7dcf89(0x17cc)]('🔥\x20[续写]\x20没有找到可撤回的AI消息');continue;}else{if(typeof _0x16079a===_0x7dcf89(0x3c4)&&_0x16079a[_0x7dcf89(0x23df)]===_0x7dcf89(0x1bfd))_0x5b0d16={'id':(Date[_0x7dcf89(0x18e0)]()+_0x4ef6)['toString'](),'sender':_0x7dcf89(0x232),'type':_0x7dcf89(0x1bfd),'content':_0x16079a[_0x7dcf89(0x1423)],'timestamp':Date[_0x7dcf89(0x18e0)]()+_0x4ef6*0x64};else{if(typeof _0x16079a===_0x7dcf89(0x3c4)&&_0x16079a['type']===_0x7dcf89(0xb93)){_0x5b0d16={'id':(Date[_0x7dcf89(0x18e0)]()+_0x4ef6)[_0x7dcf89(0x9a3)](),'sender':_0x7dcf89(0x232),'type':_0x7dcf89(0xb93),'content':_0x16079a[_0x7dcf89(0x1c6f)]||'AI描述的图片','imageDescription':_0x16079a['description'],'timestamp':Date['now']()+_0x4ef6*0x64};if(_0x16079a[_0x7dcf89(0x222f)]){console[_0x7dcf89(0xc0d)](_0x7dcf89(0x1f3),_0x16079a[_0x7dcf89(0x222f)]),_0x5b0d16['name']=_0x16079a[_0x7dcf89(0x222f)];if(currentChatCharacter&&currentChatCharacter[_0x7dcf89(0x4b7)]&&currentChatCharacter[_0x7dcf89(0xcaa)]){const _0x15ab47=currentChatCharacter[_0x7dcf89(0xcaa)][_0x7dcf89(0x1aeb)](_0x5e5b84=>_0x5e5b84[_0x7dcf89(0x222f)]===_0x16079a['name']);_0x15ab47?(_0x5b0d16[_0x7dcf89(0x210b)]=_0x15ab47['id'],console[_0x7dcf89(0xc0d)](_0x7dcf89(0xd52),_0x15ab47['id'])):console[_0x7dcf89(0xc0d)](_0x7dcf89(0x1946),_0x16079a[_0x7dcf89(0x222f)]);}}}else{if(typeof _0x16079a==='object'&&_0x16079a['type']===_0x7dcf89(0xd8)){_0x5b0d16={'id':(Date[_0x7dcf89(0x18e0)]()+_0x4ef6)['toString'](),'sender':_0x7dcf89(0x232),'type':_0x7dcf89(0xd8),'amount':_0x16079a[_0x7dcf89(0xca8)],'note':_0x16079a[_0x7dcf89(0x15fe)],'timestamp':Date[_0x7dcf89(0x18e0)]()+_0x4ef6*0x64};if(_0x16079a[_0x7dcf89(0x222f)]){const _0x494212=currentChatCharacter[_0x7dcf89(0xcaa)][_0x7dcf89(0x1aeb)](_0x5118eb=>_0x5118eb[_0x7dcf89(0x222f)]===_0x16079a['name']);_0x494212&&(_0x5b0d16[_0x7dcf89(0x210b)]=_0x494212['id'],_0x5b0d16[_0x7dcf89(0x222f)]=_0x16079a[_0x7dcf89(0x222f)]);}}else{if(typeof _0x16079a===_0x7dcf89(0x3c4)&&_0x16079a[_0x7dcf89(0x23df)]==='poke'){console[_0x7dcf89(0xc0d)](_0x7dcf89(0x1a20),_0x16079a);const _0x49889a=getCurrentChatSettings(),_0x2e2116=_0x49889a[_0x7dcf89(0xb42)]||'你',_0x3e25e5=_0x49889a['myPokeSuffix']||'';_0x5b0d16={'id':(Date['now']()+_0x4ef6)[_0x7dcf89(0x9a3)](),'sender':'system','content':currentChatCharacter['name']+_0x7dcf89(0xb6d)+_0x2e2116+_0x3e25e5,'timestamp':Date['now']()+_0x4ef6*0x64,'isPoke':!![]};}else{if(typeof _0x16079a===_0x7dcf89(0x3c4)&&_0x16079a['type']===_0x7dcf89(0x1f41)){console['log']('🔍\x20[callChatAPI]\x20进入通用表情包分支:',_0x16079a);const _0x1210ad=await findEmojiForAI(_0x16079a[_0x7dcf89(0x1c6f)]);if(_0x1210ad){_0x5b0d16={'id':(Date[_0x7dcf89(0x18e0)]()+_0x4ef6)['toString'](),'sender':_0x7dcf89(0x232),'content':'','image':_0x1210ad[_0x7dcf89(0x10c6)],'isEmoji':!![],'emojiDescription':_0x1210ad[_0x7dcf89(0x1c6f)],'timestamp':Date[_0x7dcf89(0x18e0)]()+_0x4ef6*0x64};if(_0x16079a[_0x7dcf89(0x222f)]){_0x5b0d16[_0x7dcf89(0x222f)]=_0x16079a[_0x7dcf89(0x222f)];if(currentChatCharacter&&currentChatCharacter[_0x7dcf89(0x4b7)]&&currentChatCharacter[_0x7dcf89(0xcaa)]){const _0xfe2c99=currentChatCharacter[_0x7dcf89(0xcaa)][_0x7dcf89(0x1aeb)](_0x2a2042=>_0x2a2042['name']===_0x16079a[_0x7dcf89(0x222f)]);_0xfe2c99&&(_0x5b0d16[_0x7dcf89(0x210b)]=_0xfe2c99['id']);}}}else _0x5b0d16={'id':(Date[_0x7dcf89(0x18e0)]()+_0x4ef6)[_0x7dcf89(0x9a3)](),'sender':_0x7dcf89(0x232),'content':_0x7dcf89(0xc7b)+_0x16079a[_0x7dcf89(0x1c6f)]+_0x7dcf89(0x1d49),'timestamp':Date[_0x7dcf89(0x18e0)]()+_0x4ef6*0x64};}else{if(typeof _0x16079a===_0x7dcf89(0x3c4)&&_0x16079a['type']===_0x7dcf89(0x777)){console[_0x7dcf89(0xc0d)](_0x7dcf89(0xd24),_0x16079a);if(_0x16079a['avatar_url']){let _0x24f6b1=_0x16079a[_0x7dcf89(0xc2e)];if(_0x16079a['avatar_url']==='CURRENT_USER_IMAGE'||_0x16079a[_0x7dcf89(0xc2e)]===_0x7dcf89(0xbb3)||_0x16079a[_0x7dcf89(0xc2e)]===_0x7dcf89(0xdaf)||_0x16079a['avatar_url']===_0x7dcf89(0x1ef1)){const _0x4c2fe4=getRecentUserImage();if(_0x4c2fe4)_0x24f6b1=_0x4c2fe4;else{_0x5b0d16={'id':(Date[_0x7dcf89(0x18e0)]()+_0x4ef6)[_0x7dcf89(0x9a3)](),'sender':_0x7dcf89(0x232),'content':'[无法更换头像，没有找到可用的图片]','timestamp':Date[_0x7dcf89(0x18e0)]()+_0x4ef6*0x64};continue;}}const _0x44ce2c=await validateAvatarSource(_0x24f6b1);console[_0x7dcf89(0xc0d)](_0x7dcf89(0x1f5d),_0x44ce2c,'头像URL:',_0x24f6b1);if(_0x44ce2c){const _0x325c2f=await changeCharacterAvatarByAI(_0x24f6b1,_0x16079a['reason']||_0x7dcf89(0x1e07));console[_0x7dcf89(0xc0d)]('头像更换执行结果(续写):',_0x325c2f);if(_0x325c2f)continue;else _0x5b0d16={'id':(Date['now']()+_0x4ef6)[_0x7dcf89(0x9a3)](),'sender':_0x7dcf89(0x232),'content':_0x7dcf89(0x13d6),'timestamp':Date[_0x7dcf89(0x18e0)]()+_0x4ef6*0x64};}else _0x5b0d16={'id':(Date[_0x7dcf89(0x18e0)]()+_0x4ef6)['toString'](),'sender':_0x7dcf89(0x232),'content':_0x7dcf89(0x623),'timestamp':Date[_0x7dcf89(0x18e0)]()+_0x4ef6*0x64};}else{console[_0x7dcf89(0xc0d)](_0x7dcf89(0x24ba));continue;}}else{if(typeof _0x16079a===_0x7dcf89(0x3c4)&&_0x16079a!==null&&_0x16079a[_0x7dcf89(0x222f)]&&_0x16079a['message']){console['log'](_0x7dcf89(0x199e),_0x16079a);let _0x43d153=null;if(currentChatCharacter&&currentChatCharacter[_0x7dcf89(0x4b7)]&&currentChatCharacter['members']){const _0x885f9e=currentChatCharacter[_0x7dcf89(0xcaa)][_0x7dcf89(0x1aeb)](_0x472b21=>_0x472b21[_0x7dcf89(0x222f)]===_0x16079a[_0x7dcf89(0x222f)]);_0x885f9e&&(_0x43d153=_0x885f9e['id']);}typeof _0x16079a['message']===_0x7dcf89(0x3c4)&&_0x16079a['message']['type']===_0x7dcf89(0x1bfd)?_0x5b0d16={'id':(Date['now']()+_0x4ef6)[_0x7dcf89(0x9a3)](),'sender':'received','type':_0x7dcf89(0x1bfd),'name':_0x16079a[_0x7dcf89(0x222f)],'senderId':_0x43d153,'content':_0x16079a[_0x7dcf89(0xd7a)][_0x7dcf89(0x1423)],'timestamp':Date[_0x7dcf89(0x18e0)]()+_0x4ef6*0x64}:_0x5b0d16={'id':(Date['now']()+_0x4ef6)[_0x7dcf89(0x9a3)](),'sender':_0x7dcf89(0x232),'name':_0x16079a['name'],'senderId':_0x43d153,'content':_0x16079a['message'],'timestamp':Date[_0x7dcf89(0x18e0)]()+_0x4ef6*0x64},console['log'](_0x7dcf89(0x2cc),_0x5b0d16);}else{if(typeof _0x16079a==='object'&&_0x16079a!==null){if(_0x16079a[_0x7dcf89(0x23df)]==='transfer'){_0x5b0d16={'id':(Date[_0x7dcf89(0x18e0)]()+_0x4ef6)[_0x7dcf89(0x9a3)](),'sender':'received','type':_0x7dcf89(0xd8),'amount':_0x16079a[_0x7dcf89(0xca8)],'note':_0x16079a[_0x7dcf89(0x15fe)],'timestamp':Date[_0x7dcf89(0x18e0)]()+_0x4ef6*0x64};if(_0x16079a['name']){const _0x473df6=currentChatCharacter[_0x7dcf89(0xcaa)][_0x7dcf89(0x1aeb)](_0x210dd0=>_0x210dd0['name']===_0x16079a['name']);_0x473df6&&(_0x5b0d16[_0x7dcf89(0x210b)]=_0x473df6['id'],_0x5b0d16['name']=_0x16079a['name']);}}else{if(_0x16079a[_0x7dcf89(0x23df)]==='voice_message')_0x5b0d16={'id':(Date[_0x7dcf89(0x18e0)]()+_0x4ef6)['toString'](),'sender':_0x7dcf89(0x232),'type':'voice_message','content':_0x16079a['content'],'timestamp':Date[_0x7dcf89(0x18e0)]()+_0x4ef6*0x64};else{if(_0x16079a['type']===_0x7dcf89(0xb93)){_0x5b0d16={'id':(Date[_0x7dcf89(0x18e0)]()+_0x4ef6)[_0x7dcf89(0x9a3)](),'sender':'received','type':_0x7dcf89(0xb93),'content':_0x16079a[_0x7dcf89(0x1c6f)]||_0x7dcf89(0x44e),'imageDescription':_0x16079a['description'],'timestamp':Date[_0x7dcf89(0x18e0)]()+_0x4ef6*0x64};if(_0x16079a[_0x7dcf89(0x222f)]){console['log'](_0x7dcf89(0x14aa),_0x16079a[_0x7dcf89(0x222f)]),_0x5b0d16[_0x7dcf89(0x222f)]=_0x16079a['name'];if(currentChatCharacter&&currentChatCharacter['isGroup']&&currentChatCharacter['members']){const _0x3d30ac=currentChatCharacter[_0x7dcf89(0xcaa)]['find'](_0x371876=>_0x371876['name']===_0x16079a[_0x7dcf89(0x222f)]);_0x3d30ac?(_0x5b0d16[_0x7dcf89(0x210b)]=_0x3d30ac['id'],console[_0x7dcf89(0xc0d)](_0x7dcf89(0x1113),_0x3d30ac['id'])):console['log']('🔍\x20[第五处-AI图片]\x20未找到群成员:',_0x16079a['name']);}}}else{if(_0x16079a['type']==='emoji'){const _0xbfd5e8=await findEmojiForAI(_0x16079a[_0x7dcf89(0x1c6f)]);if(_0xbfd5e8){_0x5b0d16={'id':(Date['now']()+_0x4ef6)['toString'](),'sender':_0x7dcf89(0x232),'content':'','image':_0xbfd5e8[_0x7dcf89(0x10c6)],'isEmoji':!![],'emojiDescription':_0xbfd5e8[_0x7dcf89(0x1c6f)],'timestamp':Date[_0x7dcf89(0x18e0)]()+_0x4ef6*0x64};if(_0x16079a[_0x7dcf89(0x222f)]){_0x5b0d16[_0x7dcf89(0x222f)]=_0x16079a[_0x7dcf89(0x222f)];if(currentChatCharacter&&currentChatCharacter[_0x7dcf89(0x4b7)]&&currentChatCharacter[_0x7dcf89(0xcaa)]){const _0x457d42=currentChatCharacter[_0x7dcf89(0xcaa)][_0x7dcf89(0x1aeb)](_0x524081=>_0x524081[_0x7dcf89(0x222f)]===_0x16079a[_0x7dcf89(0x222f)]);_0x457d42&&(_0x5b0d16['senderId']=_0x457d42['id']);}}}else _0x5b0d16={'id':(Date[_0x7dcf89(0x18e0)]()+_0x4ef6)[_0x7dcf89(0x9a3)](),'sender':_0x7dcf89(0x232),'content':_0x7dcf89(0xc7b)+_0x16079a[_0x7dcf89(0x1c6f)]+_0x7dcf89(0x1d49),'timestamp':Date[_0x7dcf89(0x18e0)]()+_0x4ef6*0x64};}else{if(_0x16079a[_0x7dcf89(0x23df)]&&['create_anniversary',_0x7dcf89(0xb18),_0x7dcf89(0x1db6),_0x7dcf89(0xac3),_0x7dcf89(0x246f),_0x7dcf89(0x1f1e),_0x7dcf89(0xdfb)][_0x7dcf89(0x23ec)](_0x16079a['type'])){console[_0x7dcf89(0xc0d)](_0x7dcf89(0x1994),_0x16079a);continue;}const _0x500f01=_0x16079a[_0x7dcf89(0x1423)]||_0x16079a[_0x7dcf89(0xd7a)]||_0x16079a[_0x7dcf89(0x1e58)]||_0x16079a['reply']||_0x7dcf89(0x1a55);_0x5b0d16={'id':(Date[_0x7dcf89(0x18e0)]()+_0x4ef6)[_0x7dcf89(0x9a3)](),'sender':_0x7dcf89(0x232),'content':_0x500f01,'timestamp':Date[_0x7dcf89(0x18e0)]()+_0x4ef6*0x64};}}}}}else typeof _0x16079a==='string'?_0x5b0d16={'id':(Date['now']()+_0x4ef6)['toString'](),'sender':_0x7dcf89(0x232),'content':_0x16079a,'timestamp':Date[_0x7dcf89(0x18e0)]()+_0x4ef6*0x64}:_0x5b0d16={'id':(Date[_0x7dcf89(0x18e0)]()+_0x4ef6)[_0x7dcf89(0x9a3)](),'sender':_0x7dcf89(0x232),'content':String(_0x16079a),'timestamp':Date[_0x7dcf89(0x18e0)]()+_0x4ef6*0x64};}}}}}}}}chatMessages[_0x3de59f][_0x7dcf89(0x6ee)](_0x5b0d16);try{const _0x145330=_0x3de59f+_0x7dcf89(0x1ff9)+_0x5b0d16[_0x7dcf89(0x7aa)]+'_'+Math[_0x7dcf89(0x191c)]()[_0x7dcf89(0x9a3)](0x24)[_0x7dcf89(0x18cf)](0x2,0x9)+'_'+(chatMessages[_0x3de59f]['length']-0x1);await db[_0x7dcf89(0x464)]['add']({'id':_0x145330,'characterId':_0x3de59f,'timestamp':_0x5b0d16[_0x7dcf89(0x7aa)],'messageOrder':chatMessages[_0x3de59f][_0x7dcf89(0xcbf)]-0x1,'originalMessageId':_0x5b0d16['id'],'messageData':_0x5b0d16}),console[_0x7dcf89(0xc0d)](_0x7dcf89(0x2086));}catch(_0x284eac){console['error']('续写消息单条保存失败，回退到批量保存:',_0x284eac),saveChatMessages();}addMessageWithAnimation(_0x5b0d16,_0x3de59f);if(typeof _0x16079a===_0x7dcf89(0xb97)||typeof _0x16079a===_0x7dcf89(0x3c4)&&(_0x16079a[_0x7dcf89(0x23df)]||_0x16079a[_0x7dcf89(0x222f)]&&_0x16079a['message'])){console[_0x7dcf89(0xc0d)](_0x7dcf89(0x17a4),_0x16079a);const _0x47439a=characters[_0x7dcf89(0x1aeb)](_0x5c426c=>_0x5c426c['id']===_0x3de59f);_0x47439a&&createPushNotification(_0x47439a,_0x16079a,_0x4ef6*0x1f4);}if(_0x4ef6<_0x41698f['length']-0x1){const _0x36b5e2=Math[_0x7dcf89(0x191c)]()*0x3e8+0x1f4;await new Promise(_0x18a28a=>setTimeout(_0x18a28a,_0x36b5e2)),_0x4ef6<_0x41698f[_0x7dcf89(0xcbf)]-0x1&&(showTypingIndicator(),await new Promise(_0x23d8c9=>setTimeout(_0x23d8c9,Math[_0x7dcf89(0x191c)]()*0x320+0x190)),hideTypingIndicator());}}renderMessageList();}catch(_0x114169){console[_0x7dcf89(0x24ab)](_0x7dcf89(0xdcb),_0x114169),hideTypingIndicator();const _0x5df968={'id':Date[_0x7dcf89(0x18e0)]()['toString'](),'sender':_0x7dcf89(0x232),'content':_0x7dcf89(0x1eda)+_0x114169[_0x7dcf89(0xd7a)]+']','timestamp':Date['now']()};chatMessages[_0x3de59f][_0x7dcf89(0x6ee)](_0x5df968);try{const _0x2fedfa=_0x3de59f+'_'+_0x5df968['id']+'_'+(chatMessages[_0x3de59f][_0x7dcf89(0xcbf)]-0x1);await db['chatMessages'][_0x7dcf89(0xe1)]({'id':_0x2fedfa,'characterId':_0x3de59f,'timestamp':_0x5df968['timestamp'],'messageOrder':chatMessages[_0x3de59f]['length']-0x1,'originalMessageId':_0x5df968['id'],'messageData':_0x5df968}),console['log'](_0x7dcf89(0x1d3b));}catch(_0x320d96){console[_0x7dcf89(0x24ab)](_0x7dcf89(0x2d2),_0x320d96),saveChatMessages();}addMessageWithAnimation(_0x5df968,_0x3de59f),renderMessageList();}finally{isWaitingForReply=![],pendingUserMessage=null,_0x3fe9df&&(_0x3fe9df['disabled']=![],_0x3fe9df[_0x7dcf89(0x655)]['opacity']='',_0x3fe9df[_0x7dcf89(0x655)]['animation']=_0x7dcf89(0xfe9),_0x3fe9df[_0x7dcf89(0x226e)][_0x7dcf89(0x128)](_0x7dcf89(0x1f33)),_0x3fe9df[_0x7dcf89(0xc02)]=_0x7dcf89(0x18b2),_0x3fe9df['title']=_0x7dcf89(0x1302)),updateFloatingButtonsVisibility();}}async function createAIMessage(_0x2fce06,_0x29c39e=0x0){const _0x1c5103=_0x2cf6d4,_0x19ec56={'id':(Date[_0x1c5103(0x18e0)]()+_0x29c39e)[_0x1c5103(0x9a3)](),'sender':'received','timestamp':Date['now']()+_0x29c39e*0x64};if(_0x2fce06[_0x1c5103(0x222f)]&&currentChatCharacter?.[_0x1c5103(0x4b7)]&&currentChatCharacter[_0x1c5103(0xcaa)]){const _0x3273c5=currentChatCharacter[_0x1c5103(0xcaa)][_0x1c5103(0x1aeb)](_0x5198d4=>_0x5198d4[_0x1c5103(0x222f)]===_0x2fce06[_0x1c5103(0x222f)]);_0x3273c5?(_0x19ec56[_0x1c5103(0x222f)]=_0x2fce06[_0x1c5103(0x222f)],_0x19ec56[_0x1c5103(0x210b)]=_0x3273c5['id'],console[_0x1c5103(0xc0d)](_0x1c5103(0x73e)+_0x2fce06[_0x1c5103(0x222f)]+_0x1c5103(0x192)+_0x3273c5['id']+')')):console[_0x1c5103(0x17cc)](_0x1c5103(0x1873)+_0x2fce06['name']);}switch(_0x2fce06[_0x1c5103(0x23df)]){case _0x1c5103(0xb93):return{..._0x19ec56,'type':'ai_image','content':_0x2fce06['description']||_0x1c5103(0x44e),'imageDescription':_0x2fce06[_0x1c5103(0x1c6f)]};case _0x1c5103(0x1bfd):return{..._0x19ec56,'type':_0x1c5103(0x1bfd),'content':_0x2fce06['content']};case _0x1c5103(0xd8):const _0x1939ea={..._0x19ec56,'type':'transfer','amount':_0x2fce06[_0x1c5103(0xca8)],'note':_0x2fce06[_0x1c5103(0x15fe)]};if(_0x2fce06['name']){const _0x525ff0=currentChatCharacter[_0x1c5103(0xcaa)][_0x1c5103(0x1aeb)](_0x28dc80=>_0x28dc80[_0x1c5103(0x222f)]===_0x2fce06['name']);_0x525ff0&&(_0x1939ea[_0x1c5103(0x210b)]=_0x525ff0['id'],_0x1939ea[_0x1c5103(0x222f)]=_0x2fce06[_0x1c5103(0x222f)]);}return _0x1939ea;case _0x1c5103(0x252a):const _0x39142f=getCurrentChatSettings(),_0x39b9eb=_0x39142f[_0x1c5103(0xb42)]||'你',_0x1ca7f7=_0x39142f[_0x1c5103(0x582)]||'';return{..._0x19ec56,'sender':_0x1c5103(0x212),'content':currentChatCharacter[_0x1c5103(0x222f)]+_0x1c5103(0xb6d)+_0x39b9eb+_0x1ca7f7,'isPoke':!![]};case _0x1c5103(0x1f41):const _0x543b91=await findEmojiForAI(_0x2fce06[_0x1c5103(0x1c6f)]);if(_0x543b91){const _0x40fe22={..._0x19ec56,'content':'','image':_0x543b91[_0x1c5103(0x10c6)],'isEmoji':!![],'emojiDescription':_0x543b91[_0x1c5103(0x1c6f)]};return _0x40fe22;}else return{..._0x19ec56,'content':_0x1c5103(0xc7b)+_0x2fce06[_0x1c5103(0x1c6f)]+_0x1c5103(0x1d49)};case'update_poke_suffix':console[_0x1c5103(0xc0d)]('🔍\x20[createAIMessage]\x20角色更新戳一戳后缀:',_0x2fce06);if(_0x2fce06['suffix']!==undefined){const _0x3e5cd8=getCurrentChatSettings();_0x3e5cd8[_0x1c5103(0x490)]=_0x2fce06[_0x1c5103(0xfac)]||'',await saveCurrentChatSettings(_0x3e5cd8),console['log'](_0x1c5103(0x1160),_0x2fce06['suffix']);}return{'id':(Date['now']()+_0x29c39e)[_0x1c5103(0x9a3)](),'sender':_0x1c5103(0x212),'content':currentChatCharacter[_0x1c5103(0x222f)]+'修改了自己的戳一戳后缀'+(_0x2fce06['suffix']?'为\x22'+_0x2fce06[_0x1c5103(0xfac)]+'\x22':_0x1c5103(0x1bde)),'timestamp':Date['now']()+_0x29c39e*0x64,'type':'system_notification'};case _0x1c5103(0xdfb):console[_0x1c5103(0xc0d)]('🔍\x20[createAIMessage]\x20角色更新昵称:',_0x2fce06);if(_0x2fce06['nickname']!==undefined){const _0x1bc291=getCurrentChatSettings();_0x1bc291[_0x1c5103(0x1967)]=_0x2fce06[_0x1c5103(0x201a)]||'',await saveCurrentChatSettings(_0x1bc291),console['log'](_0x1c5103(0x7ff),_0x2fce06[_0x1c5103(0x201a)]),updateChatHeader();}return{'id':(Date[_0x1c5103(0x18e0)]()+_0x29c39e)[_0x1c5103(0x9a3)](),'sender':_0x1c5103(0x212),'content':currentChatCharacter['name']+_0x1c5103(0x1e6f)+(_0x2fce06[_0x1c5103(0x201a)]?'为\x22'+_0x2fce06[_0x1c5103(0x201a)]+'\x22':'（恢复原名）'),'timestamp':Date[_0x1c5103(0x18e0)]()+_0x29c39e*0x64,'type':_0x1c5103(0x1cbd)};default:return{..._0x19ec56,'content':_0x2fce06[_0x1c5103(0x1423)]||_0x2fce06['message']||''};}}async function processAIReply(){const _0x4bfefe=_0x2cf6d4;console['log'](_0x4bfefe(0x1de0)),console['log'](_0x4bfefe(0x6fd),new Error()[_0x4bfefe(0x181c)]);if(!currentChatCharacter)return;if(isWaitingForReply){console['log'](_0x4bfefe(0x1b1));return;}const _0x56fba1=currentChatCharacter['id'];console['log']('🔍\x20[processAIReply]\x20函数开始时的\x20pendingUserMessage:',pendingUserMessage);const _0x285a87=chatMessages[_0x56fba1]||[];console[_0x4bfefe(0xc0d)](_0x4bfefe(0x1db4),_0x285a87[_0x4bfefe(0xcbf)]),console[_0x4bfefe(0xc0d)](_0x4bfefe(0x6e4),_0x285a87[_0x4bfefe(0x136)](-0x5));const _0x138b13=_0x285a87[_0x4bfefe(0x803)](_0x448bf2=>_0x448bf2['sender']===_0x4bfefe(0xfda));console[_0x4bfefe(0xc0d)](_0x4bfefe(0xa10),_0x138b13[_0x4bfefe(0xcbf)]),console[_0x4bfefe(0xc0d)](_0x4bfefe(0x4a5),_0x138b13[_0x4bfefe(0x136)](-0x3));const _0x3baf44=_0x138b13[_0x4bfefe(0x136)](-0x3);_0x3baf44[_0x4bfefe(0x900)]((_0x2fe87b,_0x22cb8e)=>{const _0x4d9176=_0x4bfefe;console[_0x4d9176(0xc0d)]('🔍\x20[processAIReply]\x20用户消息'+(_0x22cb8e+0x1)+':',{'id':_0x2fe87b['id'],'content':_0x2fe87b['content'],'isArray':Array[_0x4d9176(0x1bcc)](_0x2fe87b[_0x4d9176(0x1423)]),'timestamp':_0x2fe87b['timestamp']});});const _0x2d9aa0=_0x138b13[_0x4bfefe(0x136)](-0x5),_0xb3b1dd=_0x2d9aa0['reverse']()[_0x4bfefe(0x1aeb)](_0x471235=>_0x471235['type']===_0x4bfefe(0x106));if(_0xb3b1dd&&!pendingUserMessage)pendingUserMessage=_0xb3b1dd,console[_0x4bfefe(0xc0d)](_0x4bfefe(0x13f4),_0xb3b1dd);else{if(!pendingUserMessage){const _0x231ec6=_0x138b13[_0x4bfefe(0x136)](-0x1)[0x0];console[_0x4bfefe(0xc0d)](_0x4bfefe(0x1282),_0x231ec6);if(_0x231ec6)pendingUserMessage=_0x231ec6,console[_0x4bfefe(0xc0d)]('🔍\x20[processAIReply]\x20设置最后一条用户消息为待处理:',_0x231ec6);else return;}}console[_0x4bfefe(0xc0d)](_0x4bfefe(0xeb7),pendingUserMessage),console['log'](_0x4bfefe(0x42f),pendingUserMessage?.[_0x4bfefe(0x23df)]),console[_0x4bfefe(0xc0d)](_0x4bfefe(0x118d),pendingUserMessage?.[_0x4bfefe(0x1423)]),console[_0x4bfefe(0xc0d)](_0x4bfefe(0x19c4),Array[_0x4bfefe(0x1bcc)](pendingUserMessage?.[_0x4bfefe(0x1423)])),console[_0x4bfefe(0xc0d)](_0x4bfefe(0x6bd),!!pendingUserMessage?.[_0x4bfefe(0x166b)]),console['log'](_0x4bfefe(0xa6c),pendingUserMessage?.['forwardedMessages']?.[_0x4bfefe(0xcbf)]),isWaitingForReply=!![];const _0x3302b5=document['getElementById'](_0x4bfefe(0x9c));_0x3302b5&&(_0x3302b5['disabled']=!![],_0x3302b5[_0x4bfefe(0x655)][_0x4bfefe(0x671)]=_0x4bfefe(0x6e3),_0x3302b5[_0x4bfefe(0xc02)]='<i\x20class=\x22fas\x20fa-spinner\x20fa-spin\x22></i>');showTypingIndicator();const _0x5d23a1=Math[_0x4bfefe(0x191c)]()*0x7d0+0x3e8;await new Promise(_0x5f1170=>setTimeout(_0x5f1170,_0x5d23a1));try{let _0x576ccd;console[_0x4bfefe(0xc0d)](_0x4bfefe(0x14a5),pendingUserMessage),console[_0x4bfefe(0xc0d)](_0x4bfefe(0x8d9),pendingUserMessage[_0x4bfefe(0x23df)]),console['log'](_0x4bfefe(0x719),currentChatCharacter?.['isGroup']);if(pendingUserMessage[_0x4bfefe(0x23df)]==='forwarded_message'){console['log']('🔍\x20[转发消息处理]\x20开始处理转发消息'),console[_0x4bfefe(0xc0d)](_0x4bfefe(0xf9b),pendingUserMessage['forwardedMessages']);const _0x4f321f=getCurrentChatSettings(),_0x33c57d=_0x4f321f[_0x4bfefe(0x433)]||_0x4f321f[_0x4bfefe(0x6a0)],_0x2dbc3b=_0x4f321f[_0x4bfefe(0xb42)]||(personas['find'](_0x3fe344=>_0x3fe344['id']===_0x33c57d)?.[_0x4bfefe(0x222f)]||'我');let _0x55230d='['+_0x2dbc3b+_0x4bfefe(0xe30)+pendingUserMessage[_0x4bfefe(0x1423)]+_0x4bfefe(0x23d7);pendingUserMessage[_0x4bfefe(0x166b)]&&pendingUserMessage[_0x4bfefe(0x166b)][_0x4bfefe(0xcbf)]>0x0?(console[_0x4bfefe(0xc0d)]('🔍\x20[转发消息处理]\x20找到转发消息，数量:',pendingUserMessage['forwardedMessages']['length']),pendingUserMessage[_0x4bfefe(0x166b)][_0x4bfefe(0x900)]((_0x427c85,_0x139a6b)=>{const _0x1a0577=_0x4bfefe;let _0x307d86;_0x427c85[_0x1a0577(0xf75)]===_0x1a0577(0xfda)?_0x307d86=_0x427c85[_0x1a0577(0x1d85)]||_0x2dbc3b:_0x307d86=_0x427c85['name']||_0x427c85[_0x1a0577(0xeaf)]||'AI';const _0x810596=safeExtractMessageContent(_0x427c85);console[_0x1a0577(0xc0d)](_0x1a0577(0x1b9e)+(_0x139a6b+0x1)+':\x20'+_0x307d86+':\x20'+_0x810596),_0x55230d+=_0x307d86+':\x20'+_0x810596+'\x0a';})):(console[_0x4bfefe(0xc0d)](_0x4bfefe(0x1cb6)),_0x55230d+=_0x4bfefe(0x2102)),console['log']('🔍\x20[转发消息]\x20当前聊天角色:',currentChatCharacter?.[_0x4bfefe(0x222f)],_0x4bfefe(0x9c8),currentChatCharacter?.[_0x4bfefe(0x4b7)]),console[_0x4bfefe(0xc0d)](_0x4bfefe(0x2036),_0x55230d),_0x576ccd=await callChatAPI(_0x55230d,currentChatCharacter),console[_0x4bfefe(0xc0d)](_0x4bfefe(0x310),_0x576ccd);}else{if(Array['isArray'](pendingUserMessage[_0x4bfefe(0x1423)])){console[_0x4bfefe(0xc0d)](_0x4bfefe(0xaec),pendingUserMessage[_0x4bfefe(0x1423)]);const _0x4a3fe1=pendingUserMessage[_0x4bfefe(0x1423)][_0x4bfefe(0x184b)](_0x5ccda9=>_0x5ccda9[_0x4bfefe(0x23df)]===_0x4bfefe(0x1cfa)),_0x444ac3=pendingUserMessage[_0x4bfefe(0x874)]?.[_0x4bfefe(0x184b)](_0x9e15f2=>_0x9e15f2[_0x4bfefe(0xe29)]);console[_0x4bfefe(0xc0d)]('🔍\x20[processAIReply多模态调试]\x20包含图片:',_0x4a3fe1),console[_0x4bfefe(0xc0d)](_0x4bfefe(0xdb9),_0x444ac3),console[_0x4bfefe(0xc0d)](_0x4bfefe(0x21d),apiSettings[_0x4bfefe(0x168d)]);const _0x46eb9d=pendingUserMessage[_0x4bfefe(0x874)]?.['find'](_0x5617b5=>_0x5617b5[_0x4bfefe(0xe29)]),_0x109045=_0x46eb9d?.[_0x4bfefe(0xe5b)]?.[_0x4bfefe(0x23ec)](_0x4bfefe(0x38d))||_0x46eb9d?.['url']?.[_0x4bfefe(0x23ec)](_0x4bfefe(0x38d))||_0x46eb9d?.[_0x4bfefe(0xe5b)]?.[_0x4bfefe(0x1d64)]()[_0x4bfefe(0x23ec)]('.gif')||_0x46eb9d?.[_0x4bfefe(0x10c6)]?.[_0x4bfefe(0x1d64)]()[_0x4bfefe(0x23ec)]('.gif');console[_0x4bfefe(0xc0d)](_0x4bfefe(0x34a),_0x109045);const _0x2878e2=_0x46eb9d?.['image']&&(_0x46eb9d[_0x4bfefe(0xe5b)][_0x4bfefe(0x1cab)](_0x4bfefe(0x1c85))||_0x46eb9d[_0x4bfefe(0xe5b)][_0x4bfefe(0x1cab)]('https://'))||_0x46eb9d?.[_0x4bfefe(0x10c6)]&&(_0x46eb9d[_0x4bfefe(0x10c6)]['startsWith'](_0x4bfefe(0x1c85))||_0x46eb9d[_0x4bfefe(0x10c6)][_0x4bfefe(0x1cab)](_0x4bfefe(0x2403)));if(_0x4a3fe1&&_0x444ac3&&(apiSettings['emojiRecognitionEnabled']===![]||_0x109045||_0x2878e2)){const _0x5e6f51=_0x109045?_0x4bfefe(0x1903):_0x2878e2?_0x4bfefe(0x1acf):_0x4bfefe(0x226);let _0x17e667='',_0x2e9412=![];for(let _0x324686=0x0;_0x324686<pendingUserMessage[_0x4bfefe(0x1423)]['length'];_0x324686++){const _0x5deeb0=pendingUserMessage[_0x4bfefe(0x1423)][_0x324686];if(_0x5deeb0[_0x4bfefe(0x23df)]===_0x4bfefe(0x1e58)&&_0x5deeb0['text']?.[_0x4bfefe(0x1424)]())_0x17e667+=_0x5deeb0[_0x4bfefe(0x1e58)][_0x4bfefe(0x1424)]()+'\x20',_0x2e9412=!![];else _0x5deeb0[_0x4bfefe(0x23df)]===_0x4bfefe(0x1cfa)&&(_0x17e667+=_0x4bfefe(0x1c4a)+(_0x46eb9d?.[_0x4bfefe(0x13e3)]||_0x4bfefe(0x13b5))+']\x20');}_0x17e667=_0x17e667[_0x4bfefe(0x1424)](),!_0x2e9412&&(_0x17e667=_0x4bfefe(0x2019)+(_0x46eb9d?.[_0x4bfefe(0x13e3)]||'自定义表情包')+']'),console[_0x4bfefe(0xc0d)](_0x4bfefe(0x1fb6)+_0x5e6f51+'):',_0x17e667),_0x576ccd=await callChatAPI(_0x17e667,currentChatCharacter);}else _0x576ccd=await callChatAPI(pendingUserMessage[_0x4bfefe(0x1423)],currentChatCharacter);}else{if(pendingUserMessage[_0x4bfefe(0xe5b)]){const _0x529d50=pendingUserMessage['isEmoji']&&(pendingUserMessage[_0x4bfefe(0xe5b)]?.[_0x4bfefe(0x23ec)](_0x4bfefe(0x38d))||pendingUserMessage[_0x4bfefe(0xe5b)]?.['toLowerCase']()[_0x4bfefe(0x23ec)]('.gif'));console[_0x4bfefe(0xc0d)](_0x4bfefe(0x3b6),_0x529d50);const _0x27d717=pendingUserMessage[_0x4bfefe(0xe29)]&&pendingUserMessage[_0x4bfefe(0xe5b)]&&(pendingUserMessage[_0x4bfefe(0xe5b)]['startsWith'](_0x4bfefe(0x1c85))||pendingUserMessage['image'][_0x4bfefe(0x1cab)](_0x4bfefe(0x2403)));if(pendingUserMessage['isEmoji']&&(apiSettings['emojiRecognitionEnabled']===![]||_0x529d50||_0x27d717)){const _0x418d74=_0x529d50?_0x4bfefe(0x1903):_0x27d717?_0x4bfefe(0x1acf):_0x4bfefe(0x226);let _0x282570;pendingUserMessage[_0x4bfefe(0x1423)]&&pendingUserMessage['content']['trim']()?(_0x282570=pendingUserMessage['content']['trim']()+'\x20[并发送了表情包：'+(pendingUserMessage[_0x4bfefe(0x13e3)]||_0x4bfefe(0x13b5))+']',console['log'](_0x4bfefe(0x139e)+_0x418d74+'):',_0x282570)):(_0x282570=_0x4bfefe(0x2019)+(pendingUserMessage[_0x4bfefe(0x13e3)]||_0x4bfefe(0x13b5))+']',console[_0x4bfefe(0xc0d)](_0x4bfefe(0x212a)+_0x418d74+'):',_0x282570)),_0x576ccd=await callChatAPI(_0x282570,currentChatCharacter);}else{const _0x59d41c=[{'type':_0x4bfefe(0x1e58),'text':pendingUserMessage[_0x4bfefe(0x1423)]||''},{'type':_0x4bfefe(0x1cfa),'image_url':{'url':pendingUserMessage[_0x4bfefe(0xe5b)]}}];_0x576ccd=await callChatAPI(_0x59d41c,currentChatCharacter);}}else{if(pendingUserMessage[_0x4bfefe(0x23df)]===_0x4bfefe(0xd8)){let _0x4c99a4=_0x4bfefe(0xe7d)+pendingUserMessage['amount']+_0x4bfefe(0x20de)+(pendingUserMessage[_0x4bfefe(0x15fe)]||'无')+']';pendingUserMessage[_0x4bfefe(0x65d)]&&(_0x4c99a4=_0x4bfefe(0x2058)+pendingUserMessage[_0x4bfefe(0x65d)]+_0x4bfefe(0x228a)+pendingUserMessage['amount']+_0x4bfefe(0x20de)+(pendingUserMessage[_0x4bfefe(0x15fe)]||'无')+']'),_0x576ccd=await callChatAPI(_0x4c99a4,currentChatCharacter);}else{if(pendingUserMessage[_0x4bfefe(0xe5b)]&&pendingUserMessage[_0x4bfefe(0xe29)]){console[_0x4bfefe(0xc0d)](_0x4bfefe(0x144a)),console[_0x4bfefe(0xc0d)](_0x4bfefe(0xdfc),apiSettings),console[_0x4bfefe(0xc0d)]('🔍\x20[processAIReply开关调试]\x20emojiRecognitionEnabled值:',apiSettings[_0x4bfefe(0x168d)]);const _0x28aa75=pendingUserMessage[_0x4bfefe(0xe5b)]?.[_0x4bfefe(0x23ec)]('data:image/gif')||pendingUserMessage[_0x4bfefe(0xe5b)]?.[_0x4bfefe(0x1d64)]()[_0x4bfefe(0x23ec)](_0x4bfefe(0x12f2));console['log'](_0x4bfefe(0x22a8),_0x28aa75);const _0x4bc479=pendingUserMessage[_0x4bfefe(0xe5b)]&&(pendingUserMessage[_0x4bfefe(0xe5b)][_0x4bfefe(0x1cab)]('http://')||pendingUserMessage[_0x4bfefe(0xe5b)][_0x4bfefe(0x1cab)](_0x4bfefe(0x2403)));if(apiSettings[_0x4bfefe(0x168d)]===![]||_0x28aa75||_0x4bc479){const _0x330a0c=_0x28aa75?_0x4bfefe(0x1903):_0x4bc479?_0x4bfefe(0x1acf):_0x4bfefe(0x226);let _0x53ad16;pendingUserMessage[_0x4bfefe(0x1423)]&&pendingUserMessage[_0x4bfefe(0x1423)]['trim']()?(_0x53ad16=pendingUserMessage[_0x4bfefe(0x1423)]['trim']()+_0x4bfefe(0x698)+(pendingUserMessage[_0x4bfefe(0x13e3)]||_0x4bfefe(0x13b5))+']',console[_0x4bfefe(0xc0d)]('🔍\x20[processAIReply\x20else分支修复]\x20发送文字+表情包描述\x20('+_0x330a0c+'):',_0x53ad16)):(_0x53ad16='[用户发送了表情包：'+(pendingUserMessage[_0x4bfefe(0x13e3)]||_0x4bfefe(0x13b5))+']',console[_0x4bfefe(0xc0d)](_0x4bfefe(0x23bc)+_0x330a0c+'):',_0x53ad16)),_0x576ccd=await callChatAPI(_0x53ad16,currentChatCharacter);}else{const _0x22e207=[{'type':_0x4bfefe(0x1e58),'text':pendingUserMessage['content']||''},{'type':_0x4bfefe(0x1cfa),'image_url':{'url':pendingUserMessage[_0x4bfefe(0xe5b)]}}];console[_0x4bfefe(0xc0d)](_0x4bfefe(0xdd0),_0x22e207),_0x576ccd=await callChatAPI(_0x22e207,currentChatCharacter);}}else{let _0x4f16f7=pendingUserMessage[_0x4bfefe(0x1423)];if(pendingUserMessage[_0x4bfefe(0x180)]){const _0x3e0f44=summarizeLastMessage({'content':pendingUserMessage[_0x4bfefe(0x180)][_0x4bfefe(0x1423)]});_0x4f16f7=_0x4bfefe(0x9e4)+pendingUserMessage['replyTo'][_0x4bfefe(0xadb)]+_0x4bfefe(0x1c8)+_0x3e0f44+'\x22]\x20'+pendingUserMessage[_0x4bfefe(0x1423)],console[_0x4bfefe(0xc0d)]('✅\x20构建用户引用提示:',_0x4f16f7);}_0x576ccd=await callChatAPI(_0x4f16f7,currentChatCharacter);}}}}}const _0x3dd605=await parseAiResponse(_0x576ccd);console[_0x4bfefe(0xc0d)](_0x4bfefe(0x1f7c),_0x3dd605[_0x4bfefe(0xcbf)],'条'),console[_0x4bfefe(0xc0d)](_0x4bfefe(0x3c8),_0x576ccd['substring'](0x0,0xc8)+'...'),console[_0x4bfefe(0xc0d)]('🔥\x20[DEBUG]\x20解析后的消息详情:',_0x3dd605[_0x4bfefe(0xf6d)]((_0x5a0e2c,_0x361494)=>_0x361494+0x1+':\x20'+typeof _0x5a0e2c+_0x4bfefe(0x2316)+(typeof _0x5a0e2c===_0x4bfefe(0xb97)?_0x5a0e2c[_0x4bfefe(0x4b2)](0x0,0x1e):JSON[_0x4bfefe(0x7fb)](_0x5a0e2c)[_0x4bfefe(0x4b2)](0x0,0x1e))));for(let _0x2139bb=0x0;_0x2139bb<_0x3dd605[_0x4bfefe(0xcbf)];_0x2139bb++){const _0xc39cf6=_0x3dd605[_0x2139bb];if(typeof _0xc39cf6===_0x4bfefe(0x3c4)&&_0xc39cf6!==null&&_0xc39cf6[_0x4bfefe(0x23df)]===_0x4bfefe(0x1db6)){console[_0x4bfefe(0xc0d)](_0x4bfefe(0x328),_0xc39cf6),await aiBlockUser(currentChatCharacter['id'],_0xc39cf6[_0x4bfefe(0xec5)]||_0x4bfefe(0x203));break;}if(typeof _0xc39cf6==='object'&&_0xc39cf6!==null&&_0xc39cf6['type']==='create_anniversary'){console[_0x4bfefe(0xc0d)](_0x4bfefe(0xd49),_0xc39cf6);const _0x36216b={'name':_0xc39cf6['name']||_0x4bfefe(0xa5),'date':_0xc39cf6['date']||new Date()['toISOString']()[_0x4bfefe(0x633)]('T')[0x0],'type':_0xc39cf6['anniversary_type']||_0x4bfefe(0x9dd),'description':_0xc39cf6['description']||_0x4bfefe(0x1ef)};await createAnniversaryByCharacter(_0x56fba1,_0x36216b);}if(typeof _0xc39cf6===_0x4bfefe(0x3c4)&&_0xc39cf6!==null&&_0xc39cf6[_0x4bfefe(0x23df)]===_0x4bfefe(0xb18)){console[_0x4bfefe(0xc0d)](_0x4bfefe(0x23f8),_0xc39cf6);const _0x1bac42={'name':_0xc39cf6[_0x4bfefe(0x222f)]||_0x4bfefe(0x516),'date':_0xc39cf6[_0x4bfefe(0x1c5b)]||new Date()[_0x4bfefe(0xa4b)]()[_0x4bfefe(0x633)]('T')[0x0],'type':_0xc39cf6[_0x4bfefe(0x1134)]||_0x4bfefe(0x9dd),'description':_0xc39cf6[_0x4bfefe(0x1c6f)]||_0x4bfefe(0x705),'neverExpires':_0xc39cf6[_0x4bfefe(0x1fab)]===!![]||_0xc39cf6[_0x4bfefe(0x517)]===!![]};await createAppointmentByCharacter(_0x56fba1,_0x1bac42);}}let _0x18c22c=null;if(pendingUserMessage&&pendingUserMessage['type']==='transfer')_0x18c22c=pendingUserMessage;else pendingUserMessage&&pendingUserMessage['isMerged']&&pendingUserMessage[_0x4bfefe(0x874)]&&(_0x18c22c=pendingUserMessage['originalMessages'][_0x4bfefe(0x1aeb)](_0x5e47e8=>_0x5e47e8[_0x4bfefe(0x23df)]===_0x4bfefe(0xd8)&&!_0x5e47e8[_0x4bfefe(0xe54)]));_0x18c22c&&(console[_0x4bfefe(0xc0d)]('🔥\x20检测到用户转账消息，开始处理转账:',{'transferMessage':_0x18c22c,'aiMessages':_0x3dd605,'characterName':currentChatCharacter?.[_0x4bfefe(0x222f)]}),await processUserTransfer(_0x18c22c,_0x3dd605,_0x56fba1));const _0x51bcd7=chatMessages[_0x56fba1]||[];console[_0x4bfefe(0xc0d)](_0x4bfefe(0x1607));const _0x25bc23=_0x51bcd7[_0x4bfefe(0x136)]()[_0x4bfefe(0x2253)]()[_0x4bfefe(0x1aeb)](_0x2f55f9=>_0x2f55f9[_0x4bfefe(0xf75)]===_0x4bfefe(0xfda)&&_0x2f55f9['type']==='payment_request'&&!_0x2f55f9[_0x4bfefe(0x20c6)]);_0x25bc23&&(console[_0x4bfefe(0xc0d)]('🛒\x20[代付处理]\x20发现未处理代付请求，分析AI回复:',_0x25bc23),await processPaymentRequestResponse(_0x25bc23,_0x3dd605,_0x56fba1));if(pendingUserMessage&&_0x576ccd){let _0x3050f7='';if(Array[_0x4bfefe(0x1bcc)](pendingUserMessage['content'])){const _0x5ef24e=pendingUserMessage[_0x4bfefe(0x1423)][_0x4bfefe(0x803)](_0xd58359=>_0xd58359['type']===_0x4bfefe(0x1e58));_0x3050f7=_0x5ef24e[_0x4bfefe(0xf6d)](_0x569b84=>_0x569b84['text'])[_0x4bfefe(0x140c)]('\x20');}else _0x3050f7=pendingUserMessage[_0x4bfefe(0x1423)]||'';checkForAICallTrigger(_0x3050f7,_0x576ccd);}console[_0x4bfefe(0xc0d)](_0x4bfefe(0x2064),_0x3dd605['length']),console[_0x4bfefe(0xc0d)](_0x4bfefe(0x46b),_0x56fba1),console[_0x4bfefe(0xc0d)](_0x4bfefe(0x1f55),currentChatCharacter);let _0x181a2f=characters['find'](_0x5dab9a=>_0x5dab9a['id']===_0x56fba1);if(!_0x181a2f){const _0x49c02d=groupChats[_0x4bfefe(0x1aeb)](_0x40deb4=>_0x40deb4['id']===_0x56fba1);_0x49c02d&&(console[_0x4bfefe(0xc0d)](_0x4bfefe(0x16ad),_0x49c02d[_0x4bfefe(0x222f)]),_0x181a2f=_0x49c02d);}!_0x181a2f&&currentChatCharacter&&(console['log']('🔔\x20[推送通知]\x20使用当前聊天角色对象作为回复角色'),_0x181a2f=currentChatCharacter);if(_0x181a2f){console[_0x4bfefe(0xc0d)](_0x4bfefe(0x95f),_0x181a2f[_0x4bfefe(0x222f)],'是否为群聊:',_0x181a2f[_0x4bfefe(0x4b7)]);for(let _0xccd1fc=0x0;_0xccd1fc<_0x3dd605[_0x4bfefe(0xcbf)];_0xccd1fc++){const _0x4462f6=_0x3dd605[_0xccd1fc];console['log'](_0x4bfefe(0x19af),_0xccd1fc,':',_0x4462f6),(typeof _0x4462f6===_0x4bfefe(0xb97)||typeof _0x4462f6==='object'&&(_0x4462f6[_0x4bfefe(0x23df)]||_0x4462f6['name']&&_0x4462f6['message']))&&createPushNotification(_0x181a2f,_0x4462f6,_0xccd1fc*0x1f4);}}else console[_0x4bfefe(0x17cc)](_0x4bfefe(0x690),_0x56fba1);hideTypingIndicator();for(let _0x162e1e=0x0;_0x162e1e<_0x3dd605['length'];_0x162e1e++){const _0x168095=_0x3dd605[_0x162e1e];let _0x1c6e6b;console[_0x4bfefe(0xc0d)](_0x4bfefe(0x1d0e),_0x162e1e+0x1,'/',_0x3dd605[_0x4bfefe(0xcbf)],_0x4bfefe(0x2418)),console[_0x4bfefe(0xc0d)]('🔍\x20[AI回复处理]\x20处理消息',_0x162e1e,_0x4bfefe(0x8a2),typeof _0x168095,_0x4bfefe(0x2186),_0x168095),console[_0x4bfefe(0xc0d)](_0x4bfefe(0x18aa),currentChatCharacter?.['name'],'是否为群聊:',currentChatCharacter?.['isGroup']);if(typeof _0x168095===_0x4bfefe(0x3c4)&&_0x168095!==null&&_0x168095[_0x4bfefe(0x23df)]===_0x4bfefe(0xdfb))console['log']('🔧\x20[第一分支]\x20处理昵称修改指令:',_0x168095),_0x1c6e6b=await createAIMessage(_0x168095,_0x162e1e),console[_0x4bfefe(0xc0d)]('🔧\x20[第一分支]\x20createAIMessage返回结果:',_0x1c6e6b);else{if(typeof _0x168095===_0x4bfefe(0x3c4)&&_0x168095!==null){if(_0x168095[_0x4bfefe(0x23df)]===_0x4bfefe(0x1db6)){console[_0x4bfefe(0xc0d)](_0x4bfefe(0x1945),_0x168095);continue;}if(_0x168095[_0x4bfefe(0x23df)]===_0x4bfefe(0x20b8)){console['log']('🎉\x20跳过纪念日创建指令对象，不显示为消息:',_0x168095);continue;}if(_0x168095[_0x4bfefe(0x23df)]===_0x4bfefe(0xb18)){console[_0x4bfefe(0xc0d)](_0x4bfefe(0xcf),_0x168095);continue;}if(_0x168095['type']&&[_0x4bfefe(0xac3),_0x4bfefe(0x246f),_0x4bfefe(0x1f1e)][_0x4bfefe(0x23ec)](_0x168095['type'])){console[_0x4bfefe(0xc0d)](_0x4bfefe(0xc67),_0x168095);continue;}}}if(!_0x1c6e6b&&typeof _0x168095===_0x4bfefe(0x3c4)&&_0x168095!==null){if(_0x168095['type']===_0x4bfefe(0x1bfd))_0x1c6e6b=await createAIMessage(_0x168095,_0x162e1e);else{if(_0x168095['type']==='ai_image')_0x1c6e6b=await createAIMessage(_0x168095,_0x162e1e);else{if(_0x168095['type']===_0x4bfefe(0xd8))_0x1c6e6b=await createAIMessage(_0x168095,_0x162e1e);else{if(_0x168095[_0x4bfefe(0x23df)]===_0x4bfefe(0x252a))_0x1c6e6b=await createAIMessage(_0x168095,_0x162e1e);else{if(_0x168095[_0x4bfefe(0x23df)]==='update_poke_suffix')_0x1c6e6b=await createAIMessage(_0x168095,_0x162e1e);else{if(_0x168095['type']==='emoji')_0x1c6e6b=await createAIMessage(_0x168095,_0x162e1e);else{if(_0x168095['type']===_0x4bfefe(0x909)){console[_0x4bfefe(0xc0d)](_0x4bfefe(0x177c),_0x168095);const _0x4652fd=_0x168095[_0x4bfefe(0x1c6f)]||_0x168095['content']||_0x168095[_0x4bfefe(0x18cb)]||'角色发送的照片';console[_0x4bfefe(0xc0d)](_0x4bfefe(0x88e),_0x4652fd),_0x1c6e6b={'id':(Date[_0x4bfefe(0x18e0)]()+_0x162e1e)[_0x4bfefe(0x9a3)](),'sender':_0x4bfefe(0x232),'type':_0x4bfefe(0x14a6),'content':_0x4652fd,'photoDescription':_0x4652fd,'timestamp':Date[_0x4bfefe(0x18e0)]()+_0x162e1e*0x64};if(_0x168095[_0x4bfefe(0x222f)]){const _0x46175b=currentChatCharacter[_0x4bfefe(0xcaa)]['find'](_0x576bea=>_0x576bea[_0x4bfefe(0x222f)]===_0x168095[_0x4bfefe(0x222f)]);_0x46175b&&(_0x1c6e6b[_0x4bfefe(0x210b)]=_0x46175b['id'],_0x1c6e6b[_0x4bfefe(0x222f)]=_0x168095[_0x4bfefe(0x222f)],console[_0x4bfefe(0xc0d)](_0x4bfefe(0x1af7),_0x1c6e6b[_0x4bfefe(0x222f)],_0x1c6e6b[_0x4bfefe(0x210b)]));}}else{if(_0x168095[_0x4bfefe(0x23df)]===_0x4bfefe(0x63b)){console[_0x4bfefe(0xc0d)](_0x4bfefe(0x1f77),_0x168095);const _0xd3ab2f=_0x168095[_0x4bfefe(0xf7e)]||_0x168095[_0x4bfefe(0x222f)]||_0x4bfefe(0x254d);console[_0x4bfefe(0xc0d)]('位置名称:',_0xd3ab2f,_0x4bfefe(0x11e2),_0x168095[_0x4bfefe(0x239)]||_0x4bfefe(0xbea)),_0x1c6e6b={'id':(Date[_0x4bfefe(0x18e0)]()+_0x162e1e)['toString'](),'sender':'received','type':_0x4bfefe(0x63b),'locationName':_0xd3ab2f,'coordinates':_0x168095[_0x4bfefe(0x239)]||'未知坐标','content':_0x4bfefe(0x2437)+_0xd3ab2f+']','timestamp':Date['now']()+_0x162e1e*0x64};if(_0x168095[_0x4bfefe(0x222f)]&&isGroupChat){_0x1c6e6b[_0x4bfefe(0x222f)]=_0x168095[_0x4bfefe(0x222f)];const _0x4045cf=currentChatCharacter[_0x4bfefe(0xcaa)]['find'](_0x5576a2=>_0x5576a2[_0x4bfefe(0x222f)]===_0x168095[_0x4bfefe(0x222f)]);_0x4045cf&&(_0x1c6e6b['senderId']=_0x4045cf['id']);}}else{if(_0x168095[_0x4bfefe(0x23df)]===_0x4bfefe(0xd8)){_0x1c6e6b={'id':(Date[_0x4bfefe(0x18e0)]()+_0x162e1e)[_0x4bfefe(0x9a3)](),'sender':'received','type':_0x4bfefe(0xd8),'amount':_0x168095[_0x4bfefe(0xca8)],'note':_0x168095[_0x4bfefe(0x15fe)],'timestamp':Date[_0x4bfefe(0x18e0)]()+_0x162e1e*0x64};if(_0x168095[_0x4bfefe(0x222f)]){const _0x3d85ae=currentChatCharacter[_0x4bfefe(0xcaa)]['find'](_0x10ef72=>_0x10ef72['name']===_0x168095['name']);_0x3d85ae&&(_0x1c6e6b[_0x4bfefe(0x210b)]=_0x3d85ae['id'],_0x1c6e6b[_0x4bfefe(0x222f)]=_0x168095[_0x4bfefe(0x222f)]);}}else{if(_0x168095[_0x4bfefe(0x23df)]===_0x4bfefe(0x252a)){console[_0x4bfefe(0xc0d)]('🔍\x20[processAIReply-第二处]\x20AI主动戳一戳:',_0x168095);const _0x3fd429=getCurrentChatSettings(),_0x393353=_0x3fd429[_0x4bfefe(0xb42)]||'你',_0x49200d=_0x3fd429[_0x4bfefe(0x582)]||'';_0x1c6e6b={'id':(Date['now']()+_0x162e1e)[_0x4bfefe(0x9a3)](),'sender':_0x4bfefe(0x212),'content':currentChatCharacter[_0x4bfefe(0x222f)]+_0x4bfefe(0xb6d)+_0x393353+_0x49200d,'timestamp':Date[_0x4bfefe(0x18e0)]()+_0x162e1e*0x64,'isPoke':!![]};}else{if(_0x168095[_0x4bfefe(0x23df)]===_0x4bfefe(0x674))console[_0x4bfefe(0xc0d)](_0x4bfefe(0x1e2f),_0x168095),_0x1c6e6b=null;else{if(_0x168095[_0x4bfefe(0x23df)]===_0x4bfefe(0x8fa)){console[_0x4bfefe(0xc0d)](_0x4bfefe(0xb7d),_0x168095);const _0x430aec='SP'+Date[_0x4bfefe(0x18e0)]()[_0x4bfefe(0x9a3)]()['slice'](-0x8),_0x1bd2bc={'orderNumber':_0x430aec,'items':_0x168095[_0x4bfefe(0x24ef)]||[],'total':_0x168095[_0x4bfefe(0x1dbe)]||0x0,'recipient':_0x168095[_0x4bfefe(0x9a0)]||currentChatCharacter?.[_0x4bfefe(0x222f)]||'AI','timestamp':Date[_0x4bfefe(0x18e0)]()};_0x1c6e6b={'id':(Date[_0x4bfefe(0x18e0)]()+_0x162e1e)[_0x4bfefe(0x9a3)](),'sender':_0x4bfefe(0x232),'type':_0x4bfefe(0x8fa),'content':_0x4bfefe(0x2549),'orderDetails':_0x1bd2bc,'orderType':_0x168095[_0x4bfefe(0x1b71)]||'ai_order','timestamp':Date[_0x4bfefe(0x18e0)]()+_0x162e1e*0x64},console[_0x4bfefe(0xc0d)]('🛒\x20[AI订单确认]\x20创建的订单确认消息:',_0x1c6e6b);}else{if(_0x168095[_0x4bfefe(0x23df)]===_0x4bfefe(0x1f41)){console['log']('🔍\x20[processAIReply-表情包]\x20原始msgData:',_0x168095);const _0x14523d=await findEmojiForAI(_0x168095[_0x4bfefe(0x1c6f)]);if(_0x14523d){_0x1c6e6b={'id':(Date['now']()+_0x162e1e)[_0x4bfefe(0x9a3)](),'sender':'received','content':'','image':_0x14523d['url'],'isEmoji':!![],'emojiDescription':_0x14523d[_0x4bfefe(0x1c6f)],'timestamp':Date[_0x4bfefe(0x18e0)]()+_0x162e1e*0x64};if(_0x168095[_0x4bfefe(0x222f)]){console['log']('🔍\x20[processAIReply-表情包]\x20检测到群聊消息，发送者:',_0x168095[_0x4bfefe(0x222f)]),_0x1c6e6b[_0x4bfefe(0x222f)]=_0x168095[_0x4bfefe(0x222f)];if(currentChatCharacter&&currentChatCharacter[_0x4bfefe(0x4b7)]&&currentChatCharacter[_0x4bfefe(0xcaa)]){const _0x49940c=currentChatCharacter[_0x4bfefe(0xcaa)][_0x4bfefe(0x1aeb)](_0x180022=>_0x180022['name']===_0x168095[_0x4bfefe(0x222f)]);_0x49940c?(_0x1c6e6b[_0x4bfefe(0x210b)]=_0x49940c['id'],console[_0x4bfefe(0xc0d)]('🔍\x20[processAIReply-表情包]\x20找到群成员ID:',_0x49940c['id'])):console[_0x4bfefe(0xc0d)]('🔍\x20[processAIReply-表情包]\x20未找到群成员:',_0x168095['name']);}}else console[_0x4bfefe(0xc0d)](_0x4bfefe(0x1a3a));console['log']('🔍\x20[processAIReply-表情包]\x20创建的表情包消息:',_0x1c6e6b);}else _0x1c6e6b={'id':(Date[_0x4bfefe(0x18e0)]()+_0x162e1e)[_0x4bfefe(0x9a3)](),'sender':_0x4bfefe(0x232),'content':_0x4bfefe(0xc7b)+_0x168095[_0x4bfefe(0x1c6f)]+_0x4bfefe(0x1d49),'timestamp':Date[_0x4bfefe(0x18e0)]()+_0x162e1e*0x64};}else{if(_0x168095[_0x4bfefe(0x23df)]===_0x4bfefe(0x1fe5)){console['log'](_0x4bfefe(0xf25),_0x168095),console[_0x4bfefe(0xc0d)](_0x4bfefe(0xc54),_0x168095[_0x4bfefe(0x16e)]),console[_0x4bfefe(0xc0d)](_0x4bfefe(0x105e),_0x56fba1),console[_0x4bfefe(0xc0d)](_0x4bfefe(0xdf9),currentChatCharacter?.['id']);const _0x5b1c63=currentChatCharacter?.['id']||_0x56fba1,_0x4e15c4=chatMessages[_0x5b1c63]||[];console[_0x4bfefe(0xc0d)]('🔍\x20[引用回复-主分支]\x20使用角色ID:',_0x5b1c63),console[_0x4bfefe(0xc0d)](_0x4bfefe(0xd8a),_0x4e15c4['length']);try{_0x4e15c4['slice'](-0x5)[_0x4bfefe(0xf6d)](_0x2f7933=>_0x2f7933?.['id']||_0x4bfefe(0x1785));}catch(_0x2a0e47){console[_0x4bfefe(0x24ab)](_0x4bfefe(0x614),_0x2a0e47),console[_0x4bfefe(0xc0d)](_0x4bfefe(0x281),_0x4e15c4);}const _0x363c9b=_0x4e15c4[_0x4bfefe(0x1aeb)](_0x2fdf48=>_0x2fdf48['id']===_0x168095[_0x4bfefe(0x16e)]);if(!_0x363c9b){console['log'](_0x4bfefe(0x1f78)),console[_0x4bfefe(0xc0d)](_0x4bfefe(0x187a),typeof _0x168095[_0x4bfefe(0x16e)],'值:',_0x168095[_0x4bfefe(0x16e)]);const _0x5b6c31=parseInt(_0x168095['message_id']),_0x2695dc=_0x4e15c4['find'](_0x5f1311=>_0x5f1311['id']===_0x5b6c31);console[_0x4bfefe(0xc0d)](_0x4bfefe(0x1c5f),_0x2695dc);const _0x13ff95=_0x4e15c4[_0x4bfefe(0x1aeb)](_0xf978cc=>_0xf978cc['id']===_0x168095[_0x4bfefe(0x16e)][_0x4bfefe(0x9a3)]());console[_0x4bfefe(0xc0d)]('🔍\x20[引用回复-主分支]\x20字符串格式查找结果:',_0x13ff95),console['log'](_0x4bfefe(0x1736),_0x4e15c4[_0x4bfefe(0xf6d)](_0x402923=>({'id':_0x402923['id'],'type':typeof _0x402923['id'],'content':_0x402923['content']?.[_0x4bfefe(0x4b2)]?.(0x0,0x14)})));}if(_0x363c9b){let _0x33b9e0='';if(Array[_0x4bfefe(0x1bcc)](_0x363c9b['content'])){const _0x2d4882=_0x363c9b['content'][_0x4bfefe(0x1aeb)](_0x38a2dd=>_0x38a2dd['type']===_0x4bfefe(0x1e58)),_0x1c6339=_0x363c9b[_0x4bfefe(0x1423)][_0x4bfefe(0x1aeb)](_0x4f7c23=>_0x4f7c23[_0x4bfefe(0x23df)]===_0x4bfefe(0x1cfa));if(_0x2d4882?.[_0x4bfefe(0x1e58)])_0x33b9e0=_0x2d4882[_0x4bfefe(0x1e58)];else _0x1c6339?_0x33b9e0=_0x4bfefe(0xff7):_0x33b9e0=_0x4bfefe(0x1f6f);}else _0x33b9e0=_0x363c9b['content']||'';const _0x25c231={'id':_0x363c9b['id'],'content':_0x33b9e0,'senderName':_0x363c9b[_0x4bfefe(0xf75)]===_0x4bfefe(0xfda)?'你':_0x363c9b['name']||currentChatCharacter?.[_0x4bfefe(0x222f)]||'对方'};_0x1c6e6b={'id':(Date[_0x4bfefe(0x18e0)]()+_0x162e1e)[_0x4bfefe(0x9a3)](),'sender':_0x4bfefe(0x232),'content':_0x168095[_0x4bfefe(0x1423)]||'','replyTo':_0x25c231,'timestamp':Date['now']()+_0x162e1e*0x64};if(_0x168095['name']&&currentChatCharacter?.[_0x4bfefe(0x4b7)]&&currentChatCharacter[_0x4bfefe(0xcaa)]){const _0x33b62b=currentChatCharacter[_0x4bfefe(0xcaa)]['find'](_0x20e853=>_0x20e853[_0x4bfefe(0x222f)]===_0x168095[_0x4bfefe(0x222f)]);_0x33b62b?(_0x1c6e6b['name']=_0x168095[_0x4bfefe(0x222f)],_0x1c6e6b[_0x4bfefe(0x210b)]=_0x33b62b['id'],console['log'](_0x4bfefe(0x22e9),_0x168095[_0x4bfefe(0x222f)],_0x4bfefe(0xc91),_0x33b62b['id'])):console['log'](_0x4bfefe(0x15f3),_0x168095[_0x4bfefe(0x222f)]);}}else{console[_0x4bfefe(0x17cc)](_0x4bfefe(0x1262),_0x168095[_0x4bfefe(0x16e)]),_0x1c6e6b={'id':(Date['now']()+_0x162e1e)['toString'](),'sender':_0x4bfefe(0x232),'content':_0x168095[_0x4bfefe(0x1423)]||'','timestamp':Date[_0x4bfefe(0x18e0)]()+_0x162e1e*0x64};if(_0x168095['name']&&currentChatCharacter?.['isGroup']&&currentChatCharacter[_0x4bfefe(0xcaa)]){const _0x1f0cc5=currentChatCharacter[_0x4bfefe(0xcaa)][_0x4bfefe(0x1aeb)](_0x4b47e1=>_0x4b47e1[_0x4bfefe(0x222f)]===_0x168095[_0x4bfefe(0x222f)]);_0x1f0cc5?(_0x1c6e6b[_0x4bfefe(0x222f)]=_0x168095[_0x4bfefe(0x222f)],_0x1c6e6b['senderId']=_0x1f0cc5['id'],console['log']('🔍\x20[引用回复-主分支-fallback]\x20设置群聊发送者:',_0x168095[_0x4bfefe(0x222f)],_0x4bfefe(0xc91),_0x1f0cc5['id'])):console['log']('🔍\x20[引用回复-主分支-fallback]\x20未找到群成员:',_0x168095[_0x4bfefe(0x222f)]);}}}else{if(_0x168095[_0x4bfefe(0x23df)]==='change_avatar'){if(_0x168095[_0x4bfefe(0xc2e)]){let _0x5e955c=_0x168095['avatar_url'];if(_0x168095['avatar_url']==='CURRENT_USER_IMAGE'||_0x168095['avatar_url']===_0x4bfefe(0xbb3)||_0x168095[_0x4bfefe(0xc2e)]===_0x4bfefe(0xdaf)||_0x168095[_0x4bfefe(0xc2e)]===_0x4bfefe(0x1ef1)){const _0x3ee7b7=getRecentUserImage();if(_0x3ee7b7)_0x5e955c=_0x3ee7b7;else{_0x1c6e6b={'id':(Date[_0x4bfefe(0x18e0)]()+_0x162e1e)[_0x4bfefe(0x9a3)](),'sender':'received','content':'[无法更换头像，没有找到可用的图片]','timestamp':Date[_0x4bfefe(0x18e0)]()+_0x162e1e*0x64};continue;}}const _0x250385=await validateAvatarSource(_0x5e955c);if(_0x250385){const _0xff9f19=await changeCharacterAvatarByAI(_0x5e955c,_0x168095['reason']||_0x4bfefe(0x1e07));if(_0xff9f19)continue;else _0x1c6e6b={'id':(Date[_0x4bfefe(0x18e0)]()+_0x162e1e)[_0x4bfefe(0x9a3)](),'sender':_0x4bfefe(0x232),'content':_0x4bfefe(0x13d6),'timestamp':Date[_0x4bfefe(0x18e0)]()+_0x162e1e*0x64};}else _0x1c6e6b={'id':(Date[_0x4bfefe(0x18e0)]()+_0x162e1e)[_0x4bfefe(0x9a3)](),'sender':_0x4bfefe(0x232),'content':_0x4bfefe(0x623),'timestamp':Date[_0x4bfefe(0x18e0)]()+_0x162e1e*0x64};}else continue;}else{if(_0x168095[_0x4bfefe(0x23df)]==='recall_previous'){console['log'](_0x4bfefe(0x165),_0x168095);if(window[_0x4bfefe(0x68c)]){console[_0x4bfefe(0x17cc)]('🔥\x20正在处理撤回，跳过重复撤回请求');continue;}const _0x1cb924=chatMessages[_0x56fba1]||[];let _0x58fbf5=-0x1;for(let _0x37a418=_0x1cb924['length']-0x1;_0x37a418>=0x0;_0x37a418--){if(_0x1cb924[_0x37a418][_0x4bfefe(0xf75)]===_0x4bfefe(0x232)&&!_0x1cb924[_0x37a418][_0x4bfefe(0x1dfd)]&&_0x1cb924[_0x37a418]['type']!==_0x4bfefe(0x1e4b)){_0x58fbf5=_0x37a418;break;}}if(_0x58fbf5!==-0x1){const _0x41b457=_0x1cb924[_0x58fbf5];console[_0x4bfefe(0xc0d)](_0x4bfefe(0x19e6),_0x41b457),await handleRecalledMessage(_0x41b457[_0x4bfefe(0x1423)],_0x41b457['id']);}else console['warn'](_0x4bfefe(0x2522)),_0x1c6e6b={'id':(Date[_0x4bfefe(0x18e0)]()+_0x162e1e)[_0x4bfefe(0x9a3)](),'sender':_0x4bfefe(0x232),'content':_0x4bfefe(0x27e),'timestamp':Date['now']()+_0x162e1e*0x64};continue;}else{if(_0x168095['type']===_0x4bfefe(0x1fe9)){console[_0x4bfefe(0xc0d)]('🔔\x20AI请求发起语音通话:',_0x168095),setTimeout(()=>{const _0x17cbc3=_0x4bfefe;initiateAICall(currentChatCharacter,_0x168095[_0x17cbc3(0xec5)]||_0x17cbc3(0x1028));},0x64+Math['random']()*0xc8);continue;}else{if(_0x168095['type']==='video_call'){console[_0x4bfefe(0xc0d)](_0x4bfefe(0x197d),_0x168095),setTimeout(()=>{const _0x187097=_0x4bfefe;initiateAIVideoCall(currentChatCharacter,_0x168095[_0x187097(0xec5)]||_0x187097(0x61b));},0x64+Math[_0x4bfefe(0x191c)]()*0xc8);continue;}else{if(_0x168095[_0x4bfefe(0x222f)]&&_0x168095[_0x4bfefe(0xd7a)]){console['log'](_0x4bfefe(0x2530),_0x168095[_0x4bfefe(0x222f)],_0x168095[_0x4bfefe(0xd7a)]);let _0x111868=null;if(currentChatCharacter&&currentChatCharacter['isGroup']&&currentChatCharacter['members']){const _0x150c55=currentChatCharacter[_0x4bfefe(0xcaa)][_0x4bfefe(0x1aeb)](_0x5dde41=>_0x5dde41[_0x4bfefe(0x222f)]===_0x168095[_0x4bfefe(0x222f)]);_0x150c55?(_0x111868=_0x150c55['id'],console[_0x4bfefe(0xc0d)](_0x4bfefe(0x1f3f),_0x111868)):console['log']('🔍\x20[AI回复处理]\x20未找到群成员:',_0x168095[_0x4bfefe(0x222f)]);}if(typeof _0x168095[_0x4bfefe(0xd7a)]==='object'&&_0x168095[_0x4bfefe(0xd7a)][_0x4bfefe(0x23df)]===_0x4bfefe(0x1bfd))_0x1c6e6b={'id':(Date['now']()+_0x162e1e)[_0x4bfefe(0x9a3)](),'sender':'received','type':_0x4bfefe(0x1bfd),'name':_0x168095[_0x4bfefe(0x222f)],'senderId':_0x111868,'content':_0x168095[_0x4bfefe(0xd7a)][_0x4bfefe(0x1423)],'timestamp':Date[_0x4bfefe(0x18e0)]()+_0x162e1e*0x64};else{if(typeof _0x168095[_0x4bfefe(0xd7a)]==='object'&&_0x168095[_0x4bfefe(0xd7a)]['type']===_0x4bfefe(0xd8))_0x1c6e6b={'id':(Date['now']()+_0x162e1e)[_0x4bfefe(0x9a3)](),'sender':_0x4bfefe(0x232),'type':'transfer','name':_0x168095[_0x4bfefe(0x222f)],'senderId':_0x111868,'amount':_0x168095[_0x4bfefe(0xd7a)]['amount'],'note':_0x168095[_0x4bfefe(0xd7a)][_0x4bfefe(0x15fe)],'timestamp':Date[_0x4bfefe(0x18e0)]()+_0x162e1e*0x64},console[_0x4bfefe(0xc0d)](_0x4bfefe(0x1f24),_0x1c6e6b);else typeof _0x168095[_0x4bfefe(0xd7a)]===_0x4bfefe(0x3c4)&&_0x168095['message'][_0x4bfefe(0x23df)]===_0x4bfefe(0x14f2)?_0x1c6e6b={'id':(Date[_0x4bfefe(0x18e0)]()+_0x162e1e)[_0x4bfefe(0x9a3)](),'sender':_0x4bfefe(0x232),'type':_0x4bfefe(0x14f2),'message':_0x168095[_0x4bfefe(0xd7a)]['message'],'timestamp':Date[_0x4bfefe(0x18e0)]()+_0x162e1e*0x64}:(console[_0x4bfefe(0xc0d)]('🔍\x20[AI回复处理]\x20创建普通文本消息，name:',_0x168095[_0x4bfefe(0x222f)],_0x4bfefe(0x1db9),_0x111868),_0x1c6e6b={'id':(Date[_0x4bfefe(0x18e0)]()+_0x162e1e)[_0x4bfefe(0x9a3)](),'sender':_0x4bfefe(0x232),'name':_0x168095[_0x4bfefe(0x222f)],'senderId':_0x111868,'content':_0x168095[_0x4bfefe(0xd7a)],'timestamp':Date[_0x4bfefe(0x18e0)]()+_0x162e1e*0x64},console['log'](_0x4bfefe(0x1fc2),_0x1c6e6b));}}else{let _0x62eb31;if(_0x168095[_0x4bfefe(0x1423)]&&typeof _0x168095[_0x4bfefe(0x1423)]===_0x4bfefe(0xb97))_0x62eb31=_0x168095['content'];else{if(_0x168095['message']&&typeof _0x168095[_0x4bfefe(0xd7a)]==='string')_0x62eb31=_0x168095['message'];else{if(_0x168095[_0x4bfefe(0x1e58)]&&typeof _0x168095[_0x4bfefe(0x1e58)]===_0x4bfefe(0xb97))_0x62eb31=_0x168095[_0x4bfefe(0x1e58)];else{if(_0x168095[_0x4bfefe(0x222b)]&&typeof _0x168095[_0x4bfefe(0x222b)]===_0x4bfefe(0xb97))_0x62eb31=_0x168095['reply'];else{if(typeof _0x168095===_0x4bfefe(0xb97))_0x62eb31=_0x168095;else{if(_0x168095[_0x4bfefe(0x23df)]&&[_0x4bfefe(0x20b8),_0x4bfefe(0xb18),_0x4bfefe(0x1db6),_0x4bfefe(0xac3),_0x4bfefe(0x246f),_0x4bfefe(0x1f1e),_0x4bfefe(0x12d5)]['includes'](_0x168095[_0x4bfefe(0x23df)])){console[_0x4bfefe(0xc0d)](_0x4bfefe(0x1669),_0x168095);continue;}console[_0x4bfefe(0x17cc)](_0x4bfefe(0x13df),_0x168095),_0x62eb31=_0x4bfefe(0x1a55);}}}}}_0x1c6e6b={'id':(Date[_0x4bfefe(0x18e0)]()+_0x162e1e)['toString'](),'sender':_0x4bfefe(0x232),'content':_0x62eb31,'timestamp':Date[_0x4bfefe(0x18e0)]()+_0x162e1e*0x64};}}}}}}}}}}}}}}}}}}}}else{if(typeof _0x168095===_0x4bfefe(0xb97))_0x1c6e6b={'id':(Date[_0x4bfefe(0x18e0)]()+_0x162e1e)[_0x4bfefe(0x9a3)](),'sender':_0x4bfefe(0x232),'content':_0x168095,'timestamp':Date[_0x4bfefe(0x18e0)]()+_0x162e1e*0x64};else{if(typeof _0x168095===_0x4bfefe(0x3c4)&&_0x168095!==null&&_0x168095[_0x4bfefe(0x23df)]){if([_0x4bfefe(0xdfb),'update_poke_suffix',_0x4bfefe(0x20b8),'create_appointment','block_user',_0x4bfefe(0xac3),_0x4bfefe(0x246f),_0x4bfefe(0x1f1e),'transfer_action'][_0x4bfefe(0x23ec)](_0x168095[_0x4bfefe(0x23df)])){console[_0x4bfefe(0xc0d)](_0x4bfefe(0x673),_0x168095);continue;}}const _0x360a4e=typeof _0x168095===_0x4bfefe(0x3c4)?'[不支持的消息格式]':String(_0x168095);_0x1c6e6b={'id':(Date[_0x4bfefe(0x18e0)]()+_0x162e1e)[_0x4bfefe(0x9a3)](),'sender':_0x4bfefe(0x232),'content':_0x360a4e,'timestamp':Date[_0x4bfefe(0x18e0)]()+_0x162e1e*0x64};}}chatMessages[_0x56fba1][_0x4bfefe(0x6ee)](_0x1c6e6b);try{const _0x27b1a9=_0x56fba1+_0x4bfefe(0x1323)+_0x1c6e6b['timestamp']+'_'+Math[_0x4bfefe(0x191c)]()[_0x4bfefe(0x9a3)](0x24)['substr'](0x2,0x9)+'_'+(chatMessages[_0x56fba1][_0x4bfefe(0xcbf)]-0x1);await db[_0x4bfefe(0x464)][_0x4bfefe(0xe1)]({'id':_0x27b1a9,'characterId':_0x56fba1,'timestamp':_0x1c6e6b[_0x4bfefe(0x7aa)],'messageOrder':chatMessages[_0x56fba1][_0x4bfefe(0xcbf)]-0x1,'originalMessageId':_0x1c6e6b['id'],'messageData':_0x1c6e6b}),console[_0x4bfefe(0xc0d)]('✅\x20[高效回复]\x20单条消息已保存到数据库');}catch(_0x3a0af4){console[_0x4bfefe(0x24ab)](_0x4bfefe(0xff9),_0x3a0af4),await saveChatMessages();}console[_0x4bfefe(0xc0d)](_0x4bfefe(0x19d3),_0x162e1e+0x1,':',_0x1c6e6b[_0x4bfefe(0x1423)]?.[_0x4bfefe(0x4b2)](0x0,0x32)||_0x4bfefe(0xf1a)),addMessageWithAnimation(_0x1c6e6b,_0x56fba1),triggerStatusUpdateAfterMessage(_0x56fba1),setTimeout(async()=>{const _0x3520d7=_0x4bfefe;try{let _0x2ab00c='',_0x421f3e=_0x56fba1;if(typeof _0x168095===_0x3520d7(0xb97))_0x2ab00c=_0x168095;else{if(typeof _0x168095===_0x3520d7(0x3c4)&&_0x168095[_0x3520d7(0x222f)]&&_0x168095[_0x3520d7(0xd7a)]){_0x2ab00c=_0x168095['message'];if(currentChatCharacter&&currentChatCharacter[_0x3520d7(0x4b7)]&&currentChatCharacter[_0x3520d7(0xcaa)]){const _0x2fb8eb=currentChatCharacter[_0x3520d7(0xcaa)][_0x3520d7(0x1aeb)](_0x277de1=>_0x277de1['name']===_0x168095[_0x3520d7(0x222f)]);if(_0x2fb8eb)_0x421f3e=_0x2fb8eb['id'];}}else{if(typeof _0x168095===_0x3520d7(0x3c4)&&_0x168095[_0x3520d7(0x1423)])_0x2ab00c=_0x168095[_0x3520d7(0x1423)];else _0x1c6e6b&&_0x1c6e6b[_0x3520d7(0x1423)]&&(_0x2ab00c=_0x1c6e6b[_0x3520d7(0x1423)]);}}if(_0x2ab00c&&_0x421f3e){if(currentChatCharacter?.[_0x3520d7(0x4b7)])for(const _0x5db7de of currentChatCharacter[_0x3520d7(0xcaa)]||[]){const _0x3bf27d=await shouldRecordGroupMemoryForCharacter(_0x5db7de['id'],currentChatCharacter['id']);_0x3bf27d?(await recordCrossAppEvent(_0x5db7de['id'],_0x3520d7(0x23b3),'ai_reply',{'id':_0x5db7de['id'],'type':_0x3520d7(0x1f01),'sender':'ai','content':_0x2ab00c,'chatType':_0x3520d7(0x22f5),'groupName':currentChatCharacter[_0x3520d7(0x222f)],'groupId':currentChatCharacter['id']},_0x1c6e6b['id']),console['log'](_0x3520d7(0x2c9)+_0x5db7de['id']+_0x3520d7(0x594)+_0x2ab00c[_0x3520d7(0x4b2)](0x0,0x32)+_0x3520d7(0x12da))):console[_0x3520d7(0xc0d)]('⏭️\x20跳过记录\x20-\x20角色\x20'+_0x5db7de['id']+_0x3520d7(0x1e8a)+currentChatCharacter['id']+_0x3520d7(0x2349));}else await recordCrossAppEvent(_0x56fba1,_0x3520d7(0x23b3),_0x3520d7(0x10bd),{'id':currentChatCharacter['id'],'type':_0x3520d7(0x10d7),'sender':'ai','content':_0x2ab00c,'chatType':_0x3520d7(0xc1e)},_0x1c6e6b['id']),console[_0x3520d7(0xc0d)](_0x3520d7(0x2c9)+_0x56fba1+',\x20内容:\x20'+_0x2ab00c[_0x3520d7(0x4b2)](0x0,0x32)+_0x3520d7(0x12da));}}catch(_0x42c7eb){console[_0x3520d7(0x24ab)]('AI回复后记忆处理失败:',_0x42c7eb);}},0x3e8+_0x162e1e*0xc8);if(_0x162e1e<_0x3dd605['length']-0x1){const _0x36c0a4=Math[_0x4bfefe(0x191c)]()*0x3e8+0x1f4;await new Promise(_0x3e01f8=>setTimeout(_0x3e01f8,_0x36c0a4)),_0x162e1e<_0x3dd605[_0x4bfefe(0xcbf)]-0x1&&(showTypingIndicator(),await new Promise(_0x497c1d=>setTimeout(_0x497c1d,Math[_0x4bfefe(0x191c)]()*0x320+0x190)),hideTypingIndicator());}}renderMessageList();}catch(_0x4b3889){console[_0x4bfefe(0x24ab)](_0x4bfefe(0xb59),_0x4b3889),hideTypingIndicator();const _0x446767={'id':Date[_0x4bfefe(0x18e0)]()[_0x4bfefe(0x9a3)](),'sender':_0x4bfefe(0x232),'content':_0x4bfefe(0x2491)+_0x4b3889[_0x4bfefe(0xd7a)]+']','timestamp':Date['now']()};chatMessages[_0x56fba1][_0x4bfefe(0x6ee)](_0x446767);try{const _0xce02f9=_0x56fba1+'_'+_0x446767['id']+'_'+(chatMessages[_0x56fba1][_0x4bfefe(0xcbf)]-0x1);await db[_0x4bfefe(0x464)][_0x4bfefe(0xe1)]({'id':_0xce02f9,'characterId':_0x56fba1,'timestamp':_0x446767[_0x4bfefe(0x7aa)],'messageOrder':chatMessages[_0x56fba1][_0x4bfefe(0xcbf)]-0x1,'originalMessageId':_0x446767['id'],'messageData':_0x446767}),console['log'](_0x4bfefe(0x1b9a));}catch(_0x5aeb57){console[_0x4bfefe(0x24ab)](_0x4bfefe(0xdf1),_0x5aeb57),saveChatMessages();}addMessageWithAnimation(_0x446767,_0x56fba1),renderMessageList();}finally{isWaitingForReply=![],pendingUserMessage=null,_0x3302b5&&(_0x3302b5['disabled']=![],_0x3302b5[_0x4bfefe(0x655)][_0x4bfefe(0x671)]='',_0x3302b5[_0x4bfefe(0x655)][_0x4bfefe(0x4ce)]='none',_0x3302b5[_0x4bfefe(0x226e)][_0x4bfefe(0x128)](_0x4bfefe(0x1f33)),_0x3302b5[_0x4bfefe(0xc02)]=_0x4bfefe(0x18b2),_0x3302b5[_0x4bfefe(0x1c18)]=_0x4bfefe(0x1302)),updateFloatingButtonsVisibility();}}function resetFloatingButtonsState(){const _0x515383=_0x2cf6d4;pendingUserMessage=null,isWaitingForReply=![];const _0xc39d5a=document[_0x515383(0x566)](_0x515383(0x9c));_0xc39d5a&&(_0xc39d5a[_0x515383(0x194e)]=![],_0xc39d5a['style'][_0x515383(0x671)]='',_0xc39d5a[_0x515383(0x655)]['animation']=_0x515383(0xfe9),_0xc39d5a[_0x515383(0xc02)]='<i\x20class=\x22fas\x20fa-comment-dots\x22></i>',_0xc39d5a[_0x515383(0x1c18)]='获取AI回复',_0xc39d5a[_0x515383(0x226e)][_0x515383(0x128)]('waiting')),updateFloatingButtonsVisibility();}function updateFloatingButtonsVisibility(){const _0x1388e7=_0x2cf6d4;if(!currentChatCharacter)return;const _0x1613e1=document[_0x1388e7(0x566)](_0x1388e7(0x36e)),_0x311d29=document[_0x1388e7(0x566)]('smart-reply-btn'),_0x1248d0=chatMessages[currentChatCharacter['id']]||[],_0x1db329=_0x1248d0[_0x1388e7(0x184b)](_0x33abdc=>_0x33abdc[_0x1388e7(0xf75)]===_0x1388e7(0x232));_0x1613e1&&(_0x1db329?_0x1613e1['style'][_0x1388e7(0x2526)]=_0x1388e7(0x1f0b):_0x1613e1['style']['display']=_0x1388e7(0xfe9)),_0x311d29&&_0x311d29['classList'][_0x1388e7(0x128)](_0x1388e7(0x1a2c));}function handleMentionInput(_0x4149ad){const _0x59ac2f=_0x2cf6d4,_0x4492f2=_0x4149ad['target'],_0x576979=_0x4492f2['value'],_0x7d1284=_0x4492f2[_0x59ac2f(0xc77)];let _0x4d3211=-0x1;for(let _0x2ad509=_0x7d1284-0x1;_0x2ad509>=0x0;_0x2ad509--){if(_0x576979[_0x2ad509]==='@'){_0x4d3211=_0x2ad509;break;}else{if(_0x576979[_0x2ad509]==='\x20'||_0x576979[_0x2ad509]==='\x0a')break;}}if(_0x4d3211!==-0x1&&isGroupChat()){const _0x2ba7d0=_0x576979[_0x59ac2f(0x4b2)](_0x4d3211+0x1,_0x7d1284);mentionStartPos=_0x4d3211,currentMentionQuery=_0x2ba7d0,showMentionDropdown(_0x2ba7d0);}else hideMentionDropdown();}function handleMentionKeydown(_0x295583){const _0x3aa7ab=_0x2cf6d4,_0x59effc=document[_0x3aa7ab(0x566)](_0x3aa7ab(0x1fb7)),_0x167b4f=_0x59effc[_0x3aa7ab(0x1ed9)]('.mention-item');if(_0x295583['key']===_0x3aa7ab(0x4af))_0x295583['preventDefault'](),selectedMentionIndex=Math['min'](selectedMentionIndex+0x1,_0x167b4f[_0x3aa7ab(0xcbf)]-0x1),updateMentionSelection(_0x167b4f);else{if(_0x295583[_0x3aa7ab(0x157f)]===_0x3aa7ab(0xe63))_0x295583[_0x3aa7ab(0x4d9)](),selectedMentionIndex=Math[_0x3aa7ab(0x910)](selectedMentionIndex-0x1,0x0),updateMentionSelection(_0x167b4f);else{if(_0x295583[_0x3aa7ab(0x157f)]==='Enter'||_0x295583[_0x3aa7ab(0x157f)]===_0x3aa7ab(0x245))_0x295583[_0x3aa7ab(0x4d9)](),selectedMentionIndex>=0x0&&_0x167b4f[selectedMentionIndex]&&selectMention(_0x167b4f[selectedMentionIndex]);else _0x295583[_0x3aa7ab(0x157f)]===_0x3aa7ab(0x1cdd)&&(_0x295583[_0x3aa7ab(0x4d9)](),hideMentionDropdown());}}}function isGroupChat(){return currentChatCharacter&&groupChats['find'](_0x2d462e=>_0x2d462e['id']===currentChatCharacter['id']);}function showMentionDropdown(_0x4caa86){const _0xfd1643=_0x2cf6d4;if(!isGroupChat())return;const _0x53a854=groupChats[_0xfd1643(0x1aeb)](_0xee27c7=>_0xee27c7['id']===currentChatCharacter['id']);if(!_0x53a854||!_0x53a854[_0xfd1643(0xcaa)])return;const _0x5b8912=document[_0xfd1643(0x566)](_0xfd1643(0x1fb7)),_0x23d855=_0x53a854['members'][_0xfd1643(0x803)](_0x4b59f7=>_0x4b59f7[_0xfd1643(0x222f)][_0xfd1643(0x1d64)]()[_0xfd1643(0x23ec)](_0x4caa86[_0xfd1643(0x1d64)]()));if(_0x23d855[_0xfd1643(0xcbf)]===0x0){hideMentionDropdown();return;}_0x5b8912[_0xfd1643(0xc02)]='',_0x23d855[_0xfd1643(0x900)]((_0xf958a8,_0x2ac2dd)=>{const _0x4cdad6=_0xfd1643,_0x1e518a=document[_0x4cdad6(0x1ad8)](_0x4cdad6(0x526));_0x1e518a['className']='mention-item',_0x1e518a[_0x4cdad6(0xc02)]=_0x4cdad6(0x13fb)+(_0xf958a8[_0x4cdad6(0x2099)]||_0x4cdad6(0x23b8))+';\x20'+(_0xf958a8[_0x4cdad6(0x10f9)]?'background-image:\x20url('+_0xf958a8['avatarUrl']+_0x4cdad6(0x1051):'')+_0x4cdad6(0x2105)+(_0xf958a8[_0x4cdad6(0x10f9)]?'':_0xf958a8[_0x4cdad6(0x222f)][_0x4cdad6(0x1518)](0x0))+_0x4cdad6(0x17bb)+_0xf958a8[_0x4cdad6(0x222f)]+_0x4cdad6(0x1416),_0x1e518a[_0x4cdad6(0x11cf)]=()=>selectMention(_0x1e518a),_0x1e518a['dataset'][_0x4cdad6(0x1ec)]=_0xf958a8[_0x4cdad6(0x222f)],_0x1e518a['dataset']['memberId']=_0xf958a8['id'],_0x5b8912['appendChild'](_0x1e518a);}),selectedMentionIndex=0x0,updateMentionSelection(_0x5b8912[_0xfd1643(0x1ed9)]('.mention-item')),_0x5b8912[_0xfd1643(0x655)]['display']=_0xfd1643(0x2d4),mentionDropdownVisible=!![];}function hideMentionDropdown(){const _0x5a3218=_0x2cf6d4,_0x153de9=document[_0x5a3218(0x566)]('mention-dropdown');_0x153de9[_0x5a3218(0x655)][_0x5a3218(0x2526)]='none',mentionDropdownVisible=![],selectedMentionIndex=-0x1,mentionStartPos=-0x1,currentMentionQuery='';}function updateMentionSelection(_0x12c673){_0x12c673['forEach']((_0x33b8d4,_0x540bcd)=>{const _0xbdc0e2=_0x3a81;_0x540bcd===selectedMentionIndex?_0x33b8d4[_0xbdc0e2(0x226e)][_0xbdc0e2(0xe1)]('selected'):_0x33b8d4['classList'][_0xbdc0e2(0x128)](_0xbdc0e2(0x876));});}function selectMention(_0xc30235){const _0x3aa820=_0x2cf6d4,_0x3747b0=_0xc30235[_0x3aa820(0x1f26)]['memberName'],_0x318d6c=document[_0x3aa820(0x566)](_0x3aa820(0x3c0)),_0x1f6be5=_0x318d6c[_0x3aa820(0xc34)],_0x30334f=_0x1f6be5['substring'](0x0,mentionStartPos),_0x305f3f=_0x1f6be5['substring'](mentionStartPos+0x1+currentMentionQuery[_0x3aa820(0xcbf)]),_0x2cb733=_0x30334f+('@'+_0x3747b0+'\x20')+_0x305f3f;_0x318d6c['value']=_0x2cb733;const _0x449718=mentionStartPos+_0x3747b0[_0x3aa820(0xcbf)]+0x2;_0x318d6c[_0x3aa820(0x5f1)](_0x449718,_0x449718),hideMentionDropdown(),_0x318d6c[_0x3aa820(0x1b12)]();}function processMentions(_0x471387){const _0x48c825=_0x2cf6d4;if(!_0x471387||typeof _0x471387!==_0x48c825(0xb97))return _0x471387;return _0x471387[_0x48c825(0x882)](/@([^\s@，。！？、；：""''（）【】《》〈〉「」『』〔〕［］｛｝〖〗〘〙〚〛]+)/g,'<span\x20class=\x22mention-text\x22>@$1</span>');}async function buildContextualMemoryForGroupChat(_0x2fdd3d,_0x2a4f32){const _0x27a401=_0x2cf6d4;try{let _0x545d05='';const _0x1195d2=_0x2a4f32[_0x27a401(0x1316)](/@([^\s@]+)/g);if(_0x1195d2)for(const _0x5ac344 of _0x1195d2){const _0xe3b22b=_0x5ac344[_0x27a401(0x4b2)](0x1),_0x2b4a12=_0x2fdd3d[_0x27a401(0xcaa)]?.['find'](_0x30c89f=>_0x30c89f['name']===_0xe3b22b);if(_0x2b4a12){const _0x27c200=await getPrivateChatMemoryForMember(_0x2b4a12['id'],_0x2a4f32);_0x27c200&&(_0x545d05+='\x0a\x0a#\x20与'+_0xe3b22b+_0x27a401(0x135e)+_0x27c200);}}const _0x4eec74=_0x2a4f32['match'](/\b\d{6,}\b/g);if(_0x4eec74)for(const _0x5dcf71 of _0x4eec74){for(const _0x39b1d7 of _0x2fdd3d[_0x27a401(0xcaa)]||[]){const _0x15d1a9=await searchNumberInPrivateChat(_0x39b1d7['id'],_0x5dcf71);if(_0x15d1a9){_0x545d05+=_0x27a401(0x2254)+_0x5dcf71+_0x27a401(0x214a)+_0x39b1d7[_0x27a401(0x222f)]+_0x27a401(0xbb7)+_0x15d1a9;break;}}}return _0x545d05;}catch(_0x12f038){return console[_0x27a401(0x24ab)](_0x27a401(0x1331),_0x12f038),'';}}async function getPrivateChatMemoryForMember(_0x184312,_0x2a4a9e){const _0x33586f=_0x2cf6d4;try{const _0x2a889a=await db[_0x33586f(0x75b)][_0x33586f(0x4a6)](_0x33586f(0x10df))[_0x33586f(0x14a)](_0x184312)[_0x33586f(0x1534)](_0x30e6aa=>_0x30e6aa[_0x33586f(0x12e0)]==='chat'&&_0x30e6aa[_0x33586f(0x30b)]?.[_0x33586f(0x23df)]===_0x33586f(0x10d7))['reverse']()[_0x33586f(0x149c)](0x5)[_0x33586f(0x18c6)]();if(_0x2a889a[_0x33586f(0xcbf)]===0x0)return'';let _0x339ce2='';return _0x2a889a['forEach'](_0x15fb6d=>{const _0x268c1c=_0x33586f,_0x13e5fd=new Date(_0x15fb6d['timestamp'])[_0x268c1c(0x133a)](),_0x345bc4=_0x15fb6d['context']?.[_0x268c1c(0x1423)]||_0x15fb6d[_0x268c1c(0x30b)]?.['message']||'';_0x345bc4&&(_0x339ce2+='['+_0x13e5fd+']\x20'+(_0x15fb6d['context']?.[_0x268c1c(0xf75)]==='user'?'用户':'AI')+_0x268c1c(0xd7f)+_0x345bc4[_0x268c1c(0x4b2)](0x0,0x32)+(_0x345bc4[_0x268c1c(0xcbf)]>0x32?_0x268c1c(0x12da):'')+'\x0a');}),_0x339ce2;}catch(_0x5b54f2){return console[_0x33586f(0x24ab)](_0x33586f(0xa99),_0x5b54f2),'';}}async function searchNumberInPrivateChat(_0x349e90,_0x190b9b){const _0x271de0=_0x2cf6d4;try{const _0x3875d3=await db[_0x271de0(0x75b)][_0x271de0(0x4a6)](_0x271de0(0x10df))[_0x271de0(0x14a)](_0x349e90)[_0x271de0(0x1534)](_0x41d73b=>_0x41d73b[_0x271de0(0x12e0)]===_0x271de0(0x23b3)&&_0x41d73b['context']?.[_0x271de0(0x23df)]===_0x271de0(0x10d7)&&(_0x41d73b[_0x271de0(0x30b)]?.['content']?.[_0x271de0(0x23ec)](_0x190b9b)||_0x41d73b[_0x271de0(0x30b)]?.[_0x271de0(0xd7a)]?.[_0x271de0(0x23ec)](_0x190b9b)))[_0x271de0(0x2253)]()['limit'](0x3)[_0x271de0(0x18c6)]();if(_0x3875d3[_0x271de0(0xcbf)]===0x0)return'';let _0x458f64='';return _0x3875d3[_0x271de0(0x900)](_0x3d5add=>{const _0x353061=_0x271de0,_0x5d19f6=new Date(_0x3d5add[_0x353061(0x7aa)])[_0x353061(0x133a)](),_0x220d29=_0x3d5add[_0x353061(0x30b)]?.[_0x353061(0x1423)]||_0x3d5add[_0x353061(0x30b)]?.[_0x353061(0xd7a)]||'';_0x220d29&&(_0x458f64+='['+_0x5d19f6+']\x20'+(_0x3d5add[_0x353061(0x30b)]?.[_0x353061(0xf75)]===_0x353061(0x23b2)?'用户':'AI')+_0x353061(0xd7f)+_0x220d29+'\x0a');}),_0x458f64;}catch(_0x4f2e4b){return console['error']('搜索数字记忆失败:',_0x4f2e4b),'';}}async function handleSendButtonClick(){const _0x5129f3=_0x2cf6d4;console['log'](_0x5129f3(0x1378));const _0x229862=document[_0x5129f3(0x566)](_0x5129f3(0x3c0));_0x229862&&/Android/[_0x5129f3(0x17ba)](navigator[_0x5129f3(0x473)])?(console['log'](_0x5129f3(0x1e72)),_0x229862['blur'](),setTimeout(()=>{sendApiMessage();},0x96)):sendApiMessage();}async function sendApiMessage(){const _0x2a53df=_0x2cf6d4;if(isOfflineMode){console['log'](_0x2a53df(0x1a7b));const _0x267cdc=document['getElementById']('offline-input'),_0x4d4c04=document[_0x2a53df(0x566)](_0x2a53df(0x3c0));_0x4d4c04&&_0x267cdc&&_0x4d4c04['value'][_0x2a53df(0x1424)]()&&(_0x267cdc[_0x2a53df(0xc34)]=_0x4d4c04[_0x2a53df(0xc34)][_0x2a53df(0x1424)](),_0x4d4c04['value']='',await sendOfflineMessage());return;}const _0x1dd74f=document[_0x2a53df(0x566)](_0x2a53df(0x3c0)),_0xd57ff2=_0x1dd74f[_0x2a53df(0xc34)][_0x2a53df(0x1424)]();if(!_0xd57ff2)return;if(!currentChatCharacter){alert(_0x2a53df(0x1268));return;}if(_0x1dd74f[_0x2a53df(0x1543)])return;_0x1dd74f[_0x2a53df(0x1543)]=!![];try{const _0x537fbe=Date[_0x2a53df(0x18e0)]()['toString'](),_0x170219={'id':_0x537fbe,'sender':_0x2a53df(0xfda),'content':[{'type':'text','text':_0xd57ff2}],'timestamp':Date['now'](),'replyTo':currentReplyTo?{'id':currentReplyTo['id'],'content':currentReplyTo[_0x2a53df(0x1423)],'senderName':currentReplyTo[_0x2a53df(0xadb)]}:null};!chatMessages[currentChatCharacter['id']]&&(chatMessages[currentChatCharacter['id']]=[]);chatMessages[currentChatCharacter['id']][_0x2a53df(0x6ee)](_0x170219);try{const _0x45e1a1=currentChatCharacter['id']+'_'+_0x170219['id']+'_'+(chatMessages[currentChatCharacter['id']]['length']-0x1);await db[_0x2a53df(0x464)][_0x2a53df(0xe1)]({'id':_0x45e1a1,'characterId':currentChatCharacter['id'],'timestamp':_0x170219['timestamp'],'messageOrder':chatMessages[currentChatCharacter['id']][_0x2a53df(0xcbf)]-0x1,'originalMessageId':_0x170219['id'],'messageData':_0x170219}),console[_0x2a53df(0xc0d)](_0x2a53df(0x216));}catch(_0x4e1992){console[_0x2a53df(0x24ab)](_0x2a53df(0x160c),_0x4e1992),await saveChatMessagesImmediate();}_0x1dd74f[_0x2a53df(0xc34)]='',SoundManager[_0x2a53df(0x10f4)](SoundManager[_0x2a53df(0x24a1)][_0x2a53df(0x864)],currentChatCharacter?.['id']),cancelReply();currentChatCharacter&&delete chatReplyStates[currentChatCharacter['id']];adjustHeartrateForMessage(_0xd57ff2,!![]),onUserMessageSent(currentChatCharacter['id']),addMessageWithAnimation(_0x170219,currentChatCharacter['id']),checkAndCreateBlockedSystemMessage(_0x170219,currentChatCharacter['id']),pendingUserMessage=_0x170219;const _0x9a1f15=document['getElementById'](_0x2a53df(0x9c));_0x9a1f15&&(_0x9a1f15[_0x2a53df(0x655)][_0x2a53df(0x4ce)]=_0x2a53df(0x23f0),_0x9a1f15['classList']['add']('waiting'),_0x9a1f15[_0x2a53df(0x1c18)]=_0x2a53df(0x100f)),setTimeout(async()=>{const _0x1ea1f1=_0x2a53df;try{const _0x1356dd=chatMessages[currentChatCharacter['id']]||[];if(currentChatCharacter?.[_0x1ea1f1(0x4b7)])for(const _0x497e52 of currentChatCharacter[_0x1ea1f1(0xcaa)]||[]){const _0x169369=await shouldRecordGroupMemoryForCharacter(_0x497e52['id'],currentChatCharacter['id']);_0x169369?await recordCrossAppEvent(_0x497e52['id'],_0x1ea1f1(0x23b3),_0x1ea1f1(0x12b4),{'id':_0x497e52['id'],'type':_0x1ea1f1(0x1f01),'sender':_0x1ea1f1(0x23b2),'content':_0xd57ff2,'chatType':_0x1ea1f1(0x22f5),'groupName':currentChatCharacter['name'],'groupId':currentChatCharacter['id']},_0x1356dd[_0x1356dd[_0x1ea1f1(0xcbf)]-0x1]?.['id']):console[_0x1ea1f1(0xc0d)](_0x1ea1f1(0x1324)+_0x497e52['id']+_0x1ea1f1(0x1e8a)+currentChatCharacter['id']+_0x1ea1f1(0x2349));}else await recordCrossAppEvent(currentChatCharacter['id'],'chat','user_message',{'id':currentChatCharacter['id'],'type':_0x1ea1f1(0x10d7),'sender':_0x1ea1f1(0x23b2),'content':_0xd57ff2,'chatType':_0x1ea1f1(0xc1e)},_0x1356dd[_0x1356dd['length']-0x1]?.['id']);if(_0x1356dd[_0x1ea1f1(0xcbf)]%MEMORY_CONFIG[_0x1ea1f1(0xa2c)]===0x0){const _0xdaf4e2=_0x1356dd['slice'](-MEMORY_CONFIG[_0x1ea1f1(0xa2c)]);await extractMemoriesWithAI(currentChatCharacter['id'],_0xdaf4e2,currentChatCharacter['id']),console[_0x1ea1f1(0xc0d)](_0x1ea1f1(0x2523)+currentChatCharacter['name']+_0x1ea1f1(0x172)+_0x1356dd['length']);}}catch(_0x393c1e){console[_0x1ea1f1(0x24ab)]('记忆处理失败:',_0x393c1e);}},0x3e8);}finally{setTimeout(()=>{const _0x20b502=_0x2a53df;_0x1dd74f[_0x20b502(0x1543)]=![];},0x64);}}let isRecording=![],recordingStartTime=0x0;async function handleVoiceRecording(){const _0x47b980=_0x2cf6d4;if(!currentChatCharacter){alert('请先选择一个角色');return;}try{const _0x5010ba=await showVoiceInputDialog();_0x5010ba&&_0x5010ba['trim']()&&(sendVoiceMessage(_0x5010ba[_0x47b980(0x1424)]()),console[_0x47b980(0xc0d)](_0x47b980(0x1167)));}catch(_0x3f5f3a){_0x3f5f3a[_0x47b980(0xd7a)]===_0x47b980(0x515)?console[_0x47b980(0xc0d)](_0x47b980(0x252b)):console[_0x47b980(0x24ab)]('语音消息发送失败:',_0x3f5f3a);}}function resetRecordingState(){isRecording=![];}function showVoiceInputDialog(){return new Promise((_0x195cd6,_0x8d92b8)=>{const _0x34d50e=_0x3a81,_0x4725c1=document[_0x34d50e(0x1ad8)](_0x34d50e(0x526));_0x4725c1[_0x34d50e(0x655)][_0x34d50e(0x17a3)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20position:\x20fixed;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20top:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x20100%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20height:\x20100%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20rgba(0,\x200,\x200,\x200.5);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20align-items:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20justify-content:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20z-index:\x2010000;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';const _0x51f5b2=document[_0x34d50e(0x1ad8)]('div');_0x51f5b2['style'][_0x34d50e(0x17a3)]=_0x34d50e(0xf1c),_0x51f5b2[_0x34d50e(0xc02)]=_0x34d50e(0x225c),_0x4725c1[_0x34d50e(0x1925)](_0x51f5b2),document[_0x34d50e(0x172c)][_0x34d50e(0x1925)](_0x4725c1);const _0x1dabf8=_0x51f5b2[_0x34d50e(0x15b8)](_0x34d50e(0x7cf)),_0x33f900=_0x51f5b2[_0x34d50e(0x15b8)](_0x34d50e(0x13f3)),_0x11cec8=_0x51f5b2[_0x34d50e(0x15b8)](_0x34d50e(0xe83));setTimeout(()=>_0x1dabf8['focus'](),0x64),_0x33f900[_0x34d50e(0x11cf)]=()=>{const _0x2fc8d6=_0x34d50e;document[_0x2fc8d6(0x172c)][_0x2fc8d6(0x1624)](_0x4725c1),_0x8d92b8(new Error(_0x2fc8d6(0x515)));},_0x11cec8['onclick']=()=>{const _0x5c0f8b=_0x34d50e,_0x11d908=_0x1dabf8['value'][_0x5c0f8b(0x1424)]();_0x11d908?(console[_0x5c0f8b(0xc0d)](_0x5c0f8b(0xabe),_0x11d908),document[_0x5c0f8b(0x172c)][_0x5c0f8b(0x1624)](_0x4725c1),_0x195cd6(_0x11d908)):(console['log'](_0x5c0f8b(0x374)),_0x1dabf8[_0x5c0f8b(0x1b12)]());},_0x4725c1[_0x34d50e(0x11cf)]=_0x3a1882=>{const _0xa32eba=_0x34d50e;_0x3a1882[_0xa32eba(0x1144)]===_0x4725c1&&(document[_0xa32eba(0x172c)]['removeChild'](_0x4725c1),_0x8d92b8(new Error(_0xa32eba(0x515))));},_0x1dabf8['onkeydown']=_0x244b5d=>{const _0x14cbdf=_0x34d50e;_0x244b5d['key']==='Enter'&&!_0x244b5d[_0x14cbdf(0x1dad)]&&(_0x244b5d[_0x14cbdf(0x4d9)](),console[_0x14cbdf(0xc0d)](_0x14cbdf(0xcc5)),_0x11cec8[_0x14cbdf(0x1e62)]());};});}async function sendVoiceMessage(_0x172e6a){const _0x3c128c=_0x2cf6d4;console['log']('开始发送语音消息:',_0x172e6a);const _0x4d904b=Date[_0x3c128c(0x18e0)]()[_0x3c128c(0x9a3)](),_0x5b17ab=Math['max'](0x1,Math['ceil'](_0x172e6a[_0x3c128c(0xcbf)]/0x8)),_0x24c0bb={'id':_0x4d904b,'sender':_0x3c128c(0xfda),'type':_0x3c128c(0x2c2),'content':_0x172e6a,'duration':_0x5b17ab,'timestamp':Date[_0x3c128c(0x18e0)]()};!chatMessages[currentChatCharacter['id']]&&(chatMessages[currentChatCharacter['id']]=[]);chatMessages[currentChatCharacter['id']]['push'](_0x24c0bb),console[_0x3c128c(0xc0d)](_0x3c128c(0x7b1));try{const _0xe5a61e=currentChatCharacter['id']+'_'+_0x24c0bb['id']+'_'+(chatMessages[currentChatCharacter['id']][_0x3c128c(0xcbf)]-0x1);await db['chatMessages'][_0x3c128c(0xe1)]({'id':_0xe5a61e,'characterId':currentChatCharacter['id'],'timestamp':_0x24c0bb[_0x3c128c(0x7aa)],'messageOrder':chatMessages[currentChatCharacter['id']]['length']-0x1,'originalMessageId':_0x24c0bb['id'],'messageData':_0x24c0bb}),console['log'](_0x3c128c(0x2168));}catch(_0x7b002){console['error'](_0x3c128c(0xd56),_0x7b002),saveChatMessages();}adjustHeartrateForMessage(_0x172e6a,!![]),onUserMessageSent(currentChatCharacter['id']),addMessageWithAnimation(_0x24c0bb,currentChatCharacter['id']),console[_0x3c128c(0xc0d)](_0x3c128c(0x2319)),checkAndCreateBlockedSystemMessage(_0x24c0bb,currentChatCharacter['id']),triggerStatusUpdateAfterMessage(currentChatCharacter['id']),pendingUserMessage=_0x24c0bb;const _0x3b3e90=document['getElementById'](_0x3c128c(0x9c));_0x3b3e90&&(_0x3b3e90[_0x3c128c(0x655)][_0x3c128c(0x4ce)]=_0x3c128c(0x23f0),_0x3b3e90[_0x3c128c(0x226e)]['add'](_0x3c128c(0x1f33)),_0x3b3e90['title']=_0x3c128c(0x100f)),console[_0x3c128c(0xc0d)](_0x3c128c(0x4bf));}function toggleVoiceText(_0x1952da){const _0x2310a1=_0x2cf6d4,_0x3db6f8=_0x1952da['closest']('.voice-message-container')||_0x1952da[_0x2310a1(0x2026)](_0x2310a1(0x5a7));if(!_0x3db6f8)return;const _0x4a8d3e=_0x3db6f8['querySelector']('.voice-text-content');if(!_0x4a8d3e){const _0x35679e=_0x1952da['getAttribute']('data-text');if(!_0x35679e)return;const _0x30ac86=document['createElement'](_0x2310a1(0x526));_0x30ac86[_0x2310a1(0x221)]=_0x2310a1(0x2353),_0x30ac86[_0x2310a1(0x21dc)]=_0x35679e;if(_0x3db6f8[_0x2310a1(0x226e)][_0x2310a1(0x1f9)](_0x2310a1(0x1272)))_0x3db6f8[_0x2310a1(0x1925)](_0x30ac86);else{const _0x29139c=document[_0x2310a1(0x1ad8)](_0x2310a1(0x526));_0x29139c[_0x2310a1(0x221)]=_0x3db6f8['classList'][_0x2310a1(0x1f9)](_0x2310a1(0xfda))?_0x2310a1(0x254b):_0x2310a1(0x71a);const _0x2887ea=_0x3db6f8[_0x2310a1(0x15b8)](_0x2310a1(0x37c));_0x2887ea&&(_0x3db6f8[_0x2310a1(0x1624)](_0x2887ea),_0x29139c[_0x2310a1(0x1925)](_0x2887ea),_0x29139c['appendChild'](_0x30ac86),_0x3db6f8[_0x2310a1(0x1925)](_0x29139c));}setTimeout(()=>{const _0x3c8509=_0x2310a1;_0x30ac86['classList'][_0x3c8509(0xe1)](_0x3c8509(0x1e35));},0xa);return;}_0x4a8d3e[_0x2310a1(0x226e)][_0x2310a1(0x1f9)]('visible')?(_0x4a8d3e[_0x2310a1(0x226e)][_0x2310a1(0x128)](_0x2310a1(0x1e35)),setTimeout(()=>{const _0x5446e7=_0x2310a1;_0x4a8d3e[_0x5446e7(0x655)][_0x5446e7(0x2526)]=_0x5446e7(0xfe9);},0x12c)):(_0x4a8d3e[_0x2310a1(0x655)][_0x2310a1(0x2526)]='block',setTimeout(()=>{const _0x205e55=_0x2310a1;_0x4a8d3e[_0x205e55(0x226e)]['add'](_0x205e55(0x1e35));},0xa));}let isLoadingMoments=![];async function loadMoments(){const _0x264fe8=_0x2cf6d4;try{if(isLoadingMoments){console[_0x264fe8(0xc0d)](_0x264fe8(0xe97));return;}isLoadingMoments=!![];const _0xeb903a=document['getElementById'](_0x264fe8(0x768));if(!_0xeb903a){isLoadingMoments=![];return;}const _0x402d42=new Set();Array[_0x264fe8(0x2308)](_0xeb903a[_0x264fe8(0xebd)])[_0x264fe8(0x900)](_0x1c594a=>{const _0x47a2ca=_0x264fe8,_0x3722cf=_0x1c594a[_0x47a2ca(0x1add)]('data-moment-id');_0x3722cf&&_0x402d42[_0x47a2ca(0xe1)](_0x3722cf);});const _0x22d408=await db[_0x264fe8(0x1a72)]['orderBy'](_0x264fe8(0x7aa))[_0x264fe8(0x2253)]()[_0x264fe8(0x18c6)]();_0x402d42[_0x264fe8(0x41a)]===0x0?(_0xeb903a[_0x264fe8(0xc02)]='',console[_0x264fe8(0xc0d)]('动态列表为空，加载所有动态')):console[_0x264fe8(0xc0d)](_0x264fe8(0x1be5));if(_0x22d408[_0x264fe8(0xcbf)]>0x0){for(const _0x1f7c25 of _0x22d408){if(_0x402d42['has'](_0x1f7c25['id'][_0x264fe8(0x9a3)]()))continue;const _0x2f7e3f=await db[_0x264fe8(0x101)][_0x264fe8(0x4a6)](_0x264fe8(0x2289))[_0x264fe8(0x14a)](_0x1f7c25['id'])[_0x264fe8(0x35e)](),_0x4aef05=await db[_0x264fe8(0x1733)][_0x264fe8(0x4a6)](_0x264fe8(0x2289))[_0x264fe8(0x14a)](_0x1f7c25['id'])[_0x264fe8(0x35e)](),_0x178ce4=await db[_0x264fe8(0x1733)][_0x264fe8(0x4a6)](_0x264fe8(0x2289))[_0x264fe8(0x14a)](_0x1f7c25['id'])[_0x264fe8(0x18c6)]();_0x178ce4[_0x264fe8(0x1f0d)]((_0x2a9a8a,_0x28f6e7)=>_0x2a9a8a[_0x264fe8(0x7aa)]-_0x28f6e7[_0x264fe8(0x7aa)]);const _0x516920=await db[_0x264fe8(0x19b2)][_0x264fe8(0x4a6)]('momentId')['equals'](_0x1f7c25['id'])['first'](),_0xa4cb45=_0x516920?_0x516920[_0x264fe8(0xf7e)]:'',_0x25c4a4=await db[_0x264fe8(0x1879)][_0x264fe8(0x4a6)](_0x264fe8(0x2289))[_0x264fe8(0x14a)](_0x1f7c25['id'])[_0x264fe8(0x18c6)](),_0x538a50=_0x25c4a4['map'](_0x573ce0=>_0x573ce0[_0x264fe8(0x12f6)]),_0x7fba93=await db[_0x264fe8(0x18da)][_0x264fe8(0x4a6)](_0x264fe8(0x2289))['equals'](_0x1f7c25['id'])[_0x264fe8(0x2200)](),_0x4c40fd=_0x7fba93?_0x7fba93[_0x264fe8(0x311)]:_0x264fe8(0x2a3),_0x4d3a6d=_0x7fba93?_0x7fba93[_0x264fe8(0x1515)]:[];let _0x2e51c3=null;if(_0x1f7c25[_0x264fe8(0x3df)]===_0x264fe8(0x23b2))_0x2e51c3=await getDefaultAvatar();else{const _0x143ec4=characters['find'](_0x315c8c=>_0x315c8c['id']===_0x1f7c25[_0x264fe8(0x3df)]||_0x315c8c['id']===_0x1f7c25[_0x264fe8(0x10df)]);_0x143ec4?(_0x2e51c3=getCharacterAvatar(_0x143ec4),(!_0x2e51c3||!isValidAvatarUrl(_0x2e51c3))&&(_0x2e51c3=await getDefaultAvatar())):_0x2e51c3=await getDefaultAvatar();}if(_0x1f7c25[_0x264fe8(0x107f)]){console[_0x264fe8(0xc0d)](_0x264fe8(0xaff)+_0x1f7c25['id']+_0x264fe8(0x1653));try{await db['moments'][_0x264fe8(0x2180)](_0x1f7c25['id'],{'avatar':undefined});}catch(_0x1619ea){console['error'](_0x264fe8(0x156a),_0x1619ea);}}const _0x35509a=createMomentElement({'id':_0x1f7c25['id'],'authorId':_0x1f7c25[_0x264fe8(0x3df)],'nickname':_0x1f7c25['nickname'],'avatar':_0x2e51c3,'text':_0x1f7c25[_0x264fe8(0x1e58)],'images':_0x1f7c25['images']||[],'time':_0x1f7c25[_0x264fe8(0x8e1)],'timestamp':_0x1f7c25['timestamp'],'likes':_0x2f7e3f,'comments':_0x178ce4,'location':_0xa4cb45,'mentions':_0x538a50,'visibility':_0x4c40fd,'visibleGroups':_0x4d3a6d}),_0x5bd341=_0x1f7c25[_0x264fe8(0x7aa)];let _0x50e02c=null;for(let _0x2d1069=0x0;_0x2d1069<_0xeb903a[_0x264fe8(0xebd)][_0x264fe8(0xcbf)];_0x2d1069++){const _0x4ff87b=_0xeb903a[_0x264fe8(0xebd)][_0x2d1069],_0x43b5d3=parseInt(_0x4ff87b[_0x264fe8(0x1add)](_0x264fe8(0x8eb))||'0');if(_0x5bd341>_0x43b5d3){_0x50e02c=_0x4ff87b;break;}}_0x50e02c?_0xeb903a['insertBefore'](_0x35509a,_0x50e02c):_0xeb903a['appendChild'](_0x35509a),updateMomentLikeDisplay(_0x1f7c25['id']),_0x178ce4&&_0x178ce4['length']>0x0&&_0x178ce4[_0x264fe8(0x900)](_0x171996=>{const _0x698691=_0x264fe8;!_0x171996[_0x698691(0x8e1)]&&_0x171996[_0x698691(0x7aa)]&&(_0x171996[_0x698691(0x8e1)]=formatTime(new Date(_0x171996['timestamp']))),displayCommentUnderMoment(_0x1f7c25['id'],_0x171996);});}console['log']('成功加载',_0x22d408[_0x264fe8(0xcbf)],_0x264fe8(0x6cb));}else console['log']('没有找到保存的动态数据');startTimeUpdater(),console['log'](_0x264fe8(0x1ed4),_0x22d408[_0x264fe8(0xcbf)],_0x264fe8(0x6cb));}catch(_0x16afe0){console['error'](_0x264fe8(0xd83),_0x16afe0);}finally{isLoadingMoments=![];}}let momentImages=[],selectedLocation='',selectedMomentMentions=[],selectedVisibility=_0x2cf6d4(0x2a3),selectedVisibilityGroups=[];function showPublishMoment(){const _0x4c9c92=_0x2cf6d4;showApp(_0x4c9c92(0x570)),document[_0x4c9c92(0x566)](_0x4c9c92(0x10fd))[_0x4c9c92(0xc34)]='',momentImages=[],updateMomentImagesGrid(),document[_0x4c9c92(0x566)](_0x4c9c92(0x1f95))[_0x4c9c92(0x21dc)]='',selectedLocation='',document[_0x4c9c92(0x15b8)]('.location-icon')['classList']['remove']('active'),selectedMomentMentions=[],updateSelectedMomentMentionsDisplay(),selectedVisibility='public',selectedVisibilityGroups=[],updateSelectedVisibilityDisplay();const _0x340090=document['querySelector']('.publish-btn');_0x340090&&(_0x340090[_0x4c9c92(0x194e)]=![],_0x340090['textContent']='发表');}function hidePublishMoment(){const _0x2e066a=_0x2cf6d4;showApp(_0x2e066a(0xa76)),switchChatTab(_0x2e066a(0xbdc));}function showLocationModal(){const _0x2775d0=_0x2cf6d4;document['getElementById'](_0x2775d0(0x37a))['style'][_0x2775d0(0x2526)]='flex',document[_0x2775d0(0x566)](_0x2775d0(0x166f))[_0x2775d0(0xc34)]='',setTimeout(()=>{const _0x32c869=_0x2775d0;document[_0x32c869(0x566)](_0x32c869(0x166f))['focus']();},0x64);}function hideLocationModal(_0x3b1256){const _0x2243c6=_0x2cf6d4;if(_0x3b1256&&_0x3b1256[_0x2243c6(0x1144)]!==_0x3b1256[_0x2243c6(0x52b)])return;document[_0x2243c6(0x566)]('location-modal')[_0x2243c6(0x655)][_0x2243c6(0x2526)]=_0x2243c6(0xfe9);}function confirmLocation(){const _0x5a7c85=_0x2cf6d4,_0x3abb48=document['getElementById'](_0x5a7c85(0x166f)),_0x36a9d5=_0x3abb48[_0x5a7c85(0xc34)]['trim'](),_0x974a3a=document[_0x5a7c85(0x15b8)](_0x5a7c85(0x1726));_0x36a9d5?(selectedLocation=_0x36a9d5,document['getElementById'](_0x5a7c85(0x1f95))[_0x5a7c85(0x21dc)]=_0x36a9d5,_0x974a3a[_0x5a7c85(0x226e)]['add'](_0x5a7c85(0x105d))):(selectedLocation='',document[_0x5a7c85(0x566)](_0x5a7c85(0x1f95))['textContent']='',_0x974a3a[_0x5a7c85(0x226e)][_0x5a7c85(0x128)](_0x5a7c85(0x105d))),hideLocationModal();}document['addEventListener'](_0x2cf6d4(0x7f7),function(){const _0x5c2764=_0x2cf6d4,_0x47ec17=document['getElementById'](_0x5c2764(0x166f));_0x47ec17&&_0x47ec17[_0x5c2764(0x167)](_0x5c2764(0x695),function(_0x327c60){const _0x579149=_0x5c2764;_0x327c60[_0x579149(0x157f)]===_0x579149(0x165c)&&confirmLocation();});});function showMomentMentionModal(){const _0x44c815=_0x2cf6d4;document[_0x44c815(0x566)](_0x44c815(0x1e9a))[_0x44c815(0x655)][_0x44c815(0x2526)]=_0x44c815(0x1f0b),loadMomentMentionCharacters();}function hideMomentMentionModal(_0x1064c2){const _0x464e5d=_0x2cf6d4;if(_0x1064c2&&_0x1064c2[_0x464e5d(0x1144)]!==_0x1064c2[_0x464e5d(0x52b)])return;document['getElementById']('mention-modal')[_0x464e5d(0x655)]['display']=_0x464e5d(0xfe9);}function loadMomentMentionCharacters(){const _0x567f74=_0x2cf6d4,_0x31ea5d=document[_0x567f74(0x566)]('mention-characters-list');_0x31ea5d[_0x567f74(0xc02)]='';if(!characters||characters[_0x567f74(0xcbf)]===0x0){_0x31ea5d[_0x567f74(0xc02)]=_0x567f74(0x3b8);return;}characters['forEach'](_0x21df36=>{const _0x1c5c14=_0x567f74,_0x563fef=document['createElement'](_0x1c5c14(0x526));_0x563fef[_0x1c5c14(0x221)]=_0x1c5c14(0xefb),_0x563fef[_0x1c5c14(0x1dd4)](_0x1c5c14(0x1f97),_0x21df36['id']);selectedMomentMentions['includes'](_0x21df36['id'])&&_0x563fef['classList']['add'](_0x1c5c14(0x876));let _0x177210=_0x21df36[_0x1c5c14(0x10f9)]||createDefaultAvatar(_0x21df36[_0x1c5c14(0x222f)]);_0x563fef[_0x1c5c14(0xc02)]=_0x1c5c14(0x130d)+_0x177210+_0x1c5c14(0x1ca8)+_0x21df36[_0x1c5c14(0x222f)]+'\x22\x20class=\x22mention-character-avatar\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20onerror=\x22this.src=\x27'+createDefaultAvatar(_0x21df36['name'])+'\x27\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mention-character-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mention-character-name\x22>'+_0x21df36[_0x1c5c14(0x222f)]+_0x1c5c14(0xb30),_0x563fef[_0x1c5c14(0x11cf)]=_0x4cb537=>{const _0x1d5823=_0x1c5c14;_0x4cb537[_0x1d5823(0x4d9)](),_0x4cb537['stopPropagation'](),toggleMomentMentionCharacter(_0x21df36['id']);},_0x31ea5d['appendChild'](_0x563fef);});}function toggleMomentMentionCharacter(_0x1fbe28){const _0x5dee35=_0x2cf6d4,_0x18ddfa=selectedMomentMentions[_0x5dee35(0x167a)](_0x1fbe28),_0x1a7262=document[_0x5dee35(0x15b8)](_0x5dee35(0x251f)+_0x1fbe28+'\x22]');_0x18ddfa>-0x1?(selectedMomentMentions[_0x5dee35(0x220f)](_0x18ddfa,0x1),_0x1a7262['classList']['remove'](_0x5dee35(0x876))):(selectedMomentMentions['push'](_0x1fbe28),_0x1a7262['classList'][_0x5dee35(0xe1)](_0x5dee35(0x876))),console[_0x5dee35(0xc0d)]('Toggle\x20moment\x20mention:',_0x1fbe28,_0x5dee35(0x1238),selectedMomentMentions);}function confirmMomentMention(){updateSelectedMomentMentionsDisplay(),hideMomentMentionModal();}function updateSelectedMomentMentionsDisplay(){const _0x5869c4=_0x2cf6d4,_0x44f913=document[_0x5869c4(0x566)](_0x5869c4(0x2062)),_0x94ed13=document[_0x5869c4(0x15b8)](_0x5869c4(0x215c));_0x44f913[_0x5869c4(0xc02)]='',selectedMomentMentions[_0x5869c4(0xcbf)]>0x0?(_0x94ed13[_0x5869c4(0x226e)]['add'](_0x5869c4(0x105d)),selectedMomentMentions[_0x5869c4(0x900)](_0x5be7ee=>{const _0x3bb99c=_0x5869c4,_0x4c1629=characters[_0x3bb99c(0x1aeb)](_0x582a0e=>_0x582a0e['id']===_0x5be7ee);if(_0x4c1629){const _0x1a93d5=document[_0x3bb99c(0x1ad8)](_0x3bb99c(0x736));_0x1a93d5[_0x3bb99c(0x107)]=_0x4c1629[_0x3bb99c(0x10f9)]||createDefaultAvatar(_0x4c1629[_0x3bb99c(0x222f)]),_0x1a93d5['alt']=_0x4c1629[_0x3bb99c(0x222f)],_0x1a93d5['className']=_0x3bb99c(0x1ba7),_0x1a93d5[_0x3bb99c(0x1795)]=function(){const _0x3b8e61=_0x3bb99c;this['src']=createDefaultAvatar(_0x4c1629[_0x3b8e61(0x222f)]);},_0x44f913[_0x3bb99c(0x1925)](_0x1a93d5);}})):_0x94ed13[_0x5869c4(0x226e)][_0x5869c4(0x128)]('active');}function createMomentMentionsDisplay(_0x30e77b){const _0xdbbfce=_0x2cf6d4;if(!_0x30e77b||_0x30e77b[_0xdbbfce(0xcbf)]===0x0)return'';const _0x4288c9=_0x30e77b[_0xdbbfce(0xf6d)](_0x32ae4a=>{const _0x306138=_0xdbbfce,_0xe2d275=characters[_0x306138(0x1aeb)](_0x1e717f=>_0x1e717f['id']===_0x32ae4a);return _0xe2d275?_0xe2d275[_0x306138(0x222f)]:'未知角色';})[_0xdbbfce(0x803)](_0x59a3e8=>_0x59a3e8!==_0xdbbfce(0x20e7));if(_0x4288c9['length']===0x0)return'';return _0xdbbfce(0x6b3)+_0x4288c9['join']('，')+_0xdbbfce(0xa54);}function createVisibilityIndicator(_0x3a7faa,_0x141c00){const _0x56416d=_0x2cf6d4;if(!_0x3a7faa||_0x3a7faa===_0x56416d(0x2a3))return'';let _0x4bc8a5='',_0x32a202='',_0x2193ee='';switch(_0x3a7faa){case _0x56416d(0xda9):_0x4bc8a5=_0x56416d(0x1d2f),_0x32a202='私密',_0x2193ee='私密';break;case _0x56416d(0x2132):_0x4bc8a5=_0x56416d(0x47e),_0x32a202=_0x56416d(0x1bd9);if(_0x141c00&&_0x141c00[_0x56416d(0xcbf)]>0x0){const _0x5eac01=_0x141c00[_0x56416d(0xf6d)](_0x59b500=>{const _0x2dfa74=_0x56416d,_0x416281=characterGroups[_0x2dfa74(0x1aeb)](_0x1ca0ba=>_0x1ca0ba['id']===_0x59b500);return _0x416281?_0x416281['name']:'未知分组';})[_0x56416d(0x803)](_0x493893=>_0x493893!==_0x56416d(0x2f4));_0x2193ee=_0x5eac01[_0x56416d(0xcbf)]>0x0?_0x5eac01[_0x56416d(0x140c)]('、'):_0x56416d(0x1bd9);}else _0x2193ee=_0x56416d(0x1bd9);break;default:return'';}return _0x56416d(0x1e87)+_0x32a202+_0x56416d(0x1d08)+_0x4bc8a5+'\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>'+_0x2193ee+_0x56416d(0x1afd);}function showVisibilityModal(){const _0x2cbb73=_0x2cf6d4;document[_0x2cbb73(0x566)](_0x2cbb73(0x11b9))[_0x2cbb73(0x655)][_0x2cbb73(0x2526)]=_0x2cbb73(0x1f0b),loadVisibilityOptions();}function hideVisibilityModal(_0x4acdd2){const _0x4c5f3f=_0x2cf6d4;if(_0x4acdd2&&_0x4acdd2[_0x4c5f3f(0x1144)]!==_0x4acdd2[_0x4c5f3f(0x52b)])return;document['getElementById']('visibility-modal')['style']['display']='none';}function loadVisibilityOptions(){const _0x3b6958=_0x2cf6d4,_0x2f348a=document[_0x3b6958(0x1ed9)](_0x3b6958(0x531));_0x2f348a[_0x3b6958(0x900)](_0x1e8e89=>{const _0x1a4b15=_0x3b6958;_0x1e8e89['classList']['remove']('selected'),_0x1e8e89[_0x1a4b15(0x1f26)][_0x1a4b15(0xc34)]===selectedVisibility&&_0x1e8e89[_0x1a4b15(0x226e)][_0x1a4b15(0xe1)](_0x1a4b15(0x876)),_0x1e8e89[_0x1a4b15(0x11cf)]=()=>selectVisibilityOption(_0x1e8e89[_0x1a4b15(0x1f26)][_0x1a4b15(0xc34)]);}),selectedVisibility===_0x3b6958(0x2132)?showVisibilityGroups():hideVisibilityGroups();}function selectVisibilityOption(_0x4a9c7e){const _0x57f014=_0x2cf6d4;selectedVisibility=_0x4a9c7e;const _0x565ee5=document[_0x57f014(0x1ed9)](_0x57f014(0x531));_0x565ee5[_0x57f014(0x900)](_0x256b6a=>{const _0x2cf1b1=_0x57f014;_0x256b6a[_0x2cf1b1(0x226e)]['remove'](_0x2cf1b1(0x876)),_0x256b6a[_0x2cf1b1(0x1f26)][_0x2cf1b1(0xc34)]===_0x4a9c7e&&_0x256b6a[_0x2cf1b1(0x226e)][_0x2cf1b1(0xe1)](_0x2cf1b1(0x876));}),_0x4a9c7e===_0x57f014(0x2132)?showVisibilityGroups():(hideVisibilityGroups(),selectedVisibilityGroups=[]);}function showVisibilityGroups(){const _0xa78e23=_0x2cf6d4,_0x960911=document['getElementById'](_0xa78e23(0x1728)),_0x3a6737=document[_0xa78e23(0x566)](_0xa78e23(0x164c));_0x960911[_0xa78e23(0x655)][_0xa78e23(0x2526)]=_0xa78e23(0x2d4),_0x3a6737[_0xa78e23(0xc02)]='';const _0x437218=characterGroups['filter'](_0x2b4616=>!_0x2b4616[_0xa78e23(0x1b5)]);console[_0xa78e23(0xc0d)](_0xa78e23(0x1ca9),_0x437218['map'](_0x466401=>_0x466401['name']+_0xa78e23(0x1b05)+_0x466401[_0xa78e23(0xd0)]+')'));if(_0x437218[_0xa78e23(0xcbf)]===0x0){_0x3a6737[_0xa78e23(0xc02)]=_0xa78e23(0x152d);return;}_0x437218['forEach'](_0x83105b=>{const _0x458109=_0xa78e23,_0x2024b0=document[_0x458109(0x1ad8)]('div');_0x2024b0[_0x458109(0x221)]=_0x458109(0x63f),_0x2024b0[_0x458109(0x1dd4)]('data-group-id',_0x83105b['id']),selectedVisibilityGroups[_0x458109(0x23ec)](_0x83105b['id'])&&_0x2024b0[_0x458109(0x226e)]['add']('selected'),_0x2024b0['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22visibility-group-name\x22>'+_0x83105b['name']+_0x458109(0x235f),_0x2024b0['onclick']=()=>toggleVisibilityGroup(_0x83105b['id']),_0x3a6737[_0x458109(0x1925)](_0x2024b0);});}function hideVisibilityGroups(){const _0x5679bf=_0x2cf6d4,_0x18691c=document[_0x5679bf(0x566)](_0x5679bf(0x1728));_0x18691c[_0x5679bf(0x655)]['display']=_0x5679bf(0xfe9);}function toggleVisibilityGroup(_0x8cd41){const _0x78ce8f=_0x2cf6d4,_0x1f14a7=selectedVisibilityGroups[_0x78ce8f(0x167a)](_0x8cd41),_0xdcf434=document[_0x78ce8f(0x15b8)](_0x78ce8f(0x1882)+_0x8cd41+'\x22]');_0x1f14a7>-0x1?(selectedVisibilityGroups['splice'](_0x1f14a7,0x1),_0xdcf434[_0x78ce8f(0x226e)]['remove']('selected')):(selectedVisibilityGroups[_0x78ce8f(0x6ee)](_0x8cd41),_0xdcf434[_0x78ce8f(0x226e)]['add'](_0x78ce8f(0x876)));}function confirmVisibility(){updateSelectedVisibilityDisplay(),hideVisibilityModal();}function updateSelectedVisibilityDisplay(){const _0x1e5a4b=_0x2cf6d4,_0x349423=document['getElementById']('selected-visibility'),_0x28670f=document[_0x1e5a4b(0x15b8)]('.visibility-icon');let _0x473cb7='',_0x434d7f=![];switch(selectedVisibility){case _0x1e5a4b(0x2a3):_0x473cb7='公开',_0x434d7f=![];break;case'private':_0x473cb7='私密',_0x434d7f=!![];break;case _0x1e5a4b(0x2132):if(selectedVisibilityGroups['length']>0x0){const _0x47c49b=selectedVisibilityGroups[_0x1e5a4b(0xf6d)](_0x590105=>{const _0x3b779a=_0x1e5a4b,_0x2faa0b=characterGroups[_0x3b779a(0x1aeb)](_0x83f522=>_0x83f522['id']===_0x590105);return _0x2faa0b?_0x2faa0b[_0x3b779a(0x222f)]:'未知分组';})[_0x1e5a4b(0x803)](_0xe588e=>_0xe588e!==_0x1e5a4b(0x2f4));_0x473cb7=_0x47c49b[_0x1e5a4b(0x140c)]('、')+'可见',_0x434d7f=!![];}else _0x473cb7=_0x1e5a4b(0x1bd9),_0x434d7f=!![];break;}_0x349423['textContent']=_0x473cb7,_0x434d7f?_0x28670f['classList']['add'](_0x1e5a4b(0x105d)):_0x28670f['classList'][_0x1e5a4b(0x128)](_0x1e5a4b(0x105d));}function addMomentImage(){const _0x4173a5=_0x2cf6d4,_0x5c3f74=document['createElement'](_0x4173a5(0x627));_0x5c3f74['type']=_0x4173a5(0x199b),_0x5c3f74[_0x4173a5(0xd28)]=_0x4173a5(0x2239),_0x5c3f74[_0x4173a5(0x11ab)]=!![],_0x5c3f74[_0x4173a5(0x1889)]=function(_0x1184cf){const _0x113bd1=_0x4173a5,_0x9c16cf=Array[_0x113bd1(0x2308)](_0x1184cf[_0x113bd1(0x1144)]['files']);_0x9c16cf[_0x113bd1(0x900)](_0x33c219=>{const _0x130a1e=_0x113bd1;if(momentImages[_0x130a1e(0xcbf)]<0x9){const _0x2ddad1=new FileReader();_0x2ddad1[_0x130a1e(0xc28)]=async function(_0x20355c){const _0x738428=_0x130a1e;try{const _0x546010=await compressImage(_0x20355c['target'][_0x738428(0x1fff)],0x320,0.8);momentImages[_0x738428(0x6ee)](_0x546010),updateMomentImagesGrid();}catch(_0x3c79cb){showToast(_0x738428(0x22ee)),console[_0x738428(0x24ab)](_0x738428(0x14c9),_0x3c79cb);}},_0x2ddad1['readAsDataURL'](_0x33c219);}});},_0x5c3f74[_0x4173a5(0x1e62)]();}function removeMomentImage(_0x3d0b59){const _0x1dcd66=_0x2cf6d4;momentImages[_0x1dcd66(0x220f)](_0x3d0b59,0x1),updateMomentImagesGrid();}function updateMomentImagesGrid(){const _0x1a10ff=_0x2cf6d4,_0x27c40e=document['getElementById'](_0x1a10ff(0x1f2f));_0x27c40e[_0x1a10ff(0xc02)]='',momentImages[_0x1a10ff(0x900)]((_0x5ecceb,_0x382931)=>{const _0x22f5e2=_0x1a10ff,_0x3903c4=document['createElement'](_0x22f5e2(0x526));_0x3903c4[_0x22f5e2(0x221)]='moment-image-item',_0x3903c4[_0x22f5e2(0xc02)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22'+_0x5ecceb+'\x22\x20alt=\x22动态图片\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22remove-image-btn\x22\x20onclick=\x22removeMomentImage('+_0x382931+_0x22f5e2(0x1149),_0x27c40e[_0x22f5e2(0x1925)](_0x3903c4);});}async function getDefaultAvatar(){const _0x3ea9db=_0x2cf6d4;try{const _0x447181=await getMomentsImage(_0x3ea9db(0xbef));if(_0x447181&&isValidAvatarUrl(_0x447181))return console['log'](_0x3ea9db(0xc83)),_0x447181;if(window[_0x3ea9db(0x21cd)]&&isValidAvatarUrl(window[_0x3ea9db(0x21cd)]))return console[_0x3ea9db(0xc0d)]('使用全局用户头像'),window[_0x3ea9db(0x21cd)];return window[_0x3ea9db(0x21cd)]&&!isValidAvatarUrl(window[_0x3ea9db(0x21cd)])&&(console[_0x3ea9db(0xc0d)]('清理无效的用户头像数据'),window[_0x3ea9db(0x21cd)]=null),_0x447181&&!isValidAvatarUrl(_0x447181)&&console[_0x3ea9db(0xc0d)]('清理无效的动态头像数据'),console[_0x3ea9db(0xc0d)](_0x3ea9db(0x1c91)),'data:image/svg+xml;base64,'+btoa(_0x3ea9db(0x1e76));}catch(_0x2bedef){return console['error'](_0x3ea9db(0x187d),_0x2bedef),_0x3ea9db(0xe1a)+btoa('<svg\x20width=\x2250\x22\x20height=\x2250\x22\x20xmlns=\x22http://www.w3.org/2000/svg\x22><rect\x20width=\x2250\x22\x20height=\x2250\x22\x20fill=\x22#f0f0f0\x22/><circle\x20cx=\x2225\x22\x20cy=\x2220\x22\x20r=\x228\x22\x20fill=\x22#999\x22/><circle\x20cx=\x2225\x22\x20cy=\x2240\x22\x20r=\x2212\x22\x20fill=\x22#999\x22/></svg>');}}async function publishMoment(){const _0x3b9a62=_0x2cf6d4,_0x5acd48=document[_0x3b9a62(0x566)](_0x3b9a62(0x10fd))[_0x3b9a62(0xc34)][_0x3b9a62(0x1424)](),_0x4a651b=document[_0x3b9a62(0x15b8)]('.publish-btn');if(!_0x5acd48&&momentImages['length']===0x0){showToast(_0x3b9a62(0x170));return;}_0x4a651b[_0x3b9a62(0x194e)]=!![],_0x4a651b[_0x3b9a62(0x21dc)]='发布中...';const _0x321437=document[_0x3b9a62(0x566)](_0x3b9a62(0x1a54))?.[_0x3b9a62(0x21dc)]||'我',_0x53203c=await getDefaultAvatar(),_0x16aa4f=new Date(),_0x479e04={'id':Date[_0x3b9a62(0x18e0)](),'authorId':_0x3b9a62(0x23b2),'nickname':_0x321437,'avatar':_0x53203c,'text':_0x5acd48,'images':[...momentImages],'location':selectedLocation||'','mentions':[...selectedMomentMentions],'time':formatTime(_0x16aa4f),'timestamp':_0x16aa4f[_0x3b9a62(0xa57)](),'visibility':selectedVisibility,'visibleGroups':[...selectedVisibilityGroups]};try{await db[_0x3b9a62(0x1a72)][_0x3b9a62(0xe1)](_0x479e04);(selectedVisibility!==_0x3b9a62(0x2a3)||selectedVisibilityGroups[_0x3b9a62(0xcbf)]>0x0)&&await db[_0x3b9a62(0x18da)][_0x3b9a62(0xe1)]({'momentId':_0x479e04['id'],'visibility':selectedVisibility,'visibleGroups':selectedVisibilityGroups,'timestamp':new Date()});selectedLocation&&await db[_0x3b9a62(0x19b2)][_0x3b9a62(0xe1)]({'momentId':_0x479e04['id'],'locationName':selectedLocation,'latitude':null,'longitude':null,'timestamp':new Date()});if(selectedMomentMentions[_0x3b9a62(0xcbf)]>0x0)for(const _0x338553 of selectedMomentMentions){await db[_0x3b9a62(0x1879)][_0x3b9a62(0xe1)]({'momentId':_0x479e04['id'],'mentionedCharacterId':_0x338553,'timestamp':new Date(),'isRead':![]});}_0x4a651b[_0x3b9a62(0x194e)]=![],_0x4a651b[_0x3b9a62(0x21dc)]='发表',showToast(_0x3b9a62(0x5fc)),document['getElementById'](_0x3b9a62(0x10fd))[_0x3b9a62(0xc34)]='',momentImages=[],updateMomentImagesGrid(),document[_0x3b9a62(0x566)](_0x3b9a62(0x1f95))[_0x3b9a62(0x21dc)]='',selectedLocation='',document[_0x3b9a62(0x15b8)](_0x3b9a62(0x1726))[_0x3b9a62(0x226e)]['remove'](_0x3b9a62(0x105d)),selectedMomentMentions=[],updateSelectedMomentMentionsDisplay(),selectedVisibility=_0x3b9a62(0x2a3),selectedVisibilityGroups=[],updateSelectedVisibilityDisplay(),hidePublishMoment(),setTimeout(()=>{loadMoments();},0x64),startTimeUpdater(),setTimeout(()=>{const _0x2342ea=_0x3b9a62;triggerAIInteractions(_0x479e04['id'],_0x2342ea(0x166a));},0x3e8),setTimeout(()=>{triggerAIInteractions(_0x479e04['id'],'comment');},0xbb8);}catch(_0x1a4337){console[_0x3b9a62(0x24ab)]('发布动态失败:',_0x1a4337),showToast(_0x3b9a62(0xeb0)),_0x4a651b[_0x3b9a62(0x194e)]=![],_0x4a651b[_0x3b9a62(0x21dc)]='发表';}}function formatTime(_0x35dcc9){const _0x237594=_0x2cf6d4;if(!_0x35dcc9)return _0x237594(0x191f);!(_0x35dcc9 instanceof Date)&&(_0x35dcc9=new Date(_0x35dcc9));if(isNaN(_0x35dcc9[_0x237594(0xa57)]()))return'无效时间';const _0x32f35b=new Date(),_0x26fd30=_0x32f35b-_0x35dcc9;if(_0x26fd30<0xea60)return'刚刚';else{if(_0x26fd30<0x36ee80)return Math[_0x237594(0x1dac)](_0x26fd30/0xea60)+_0x237594(0x1dee);else{if(_0x26fd30<0x5265c00)return Math['floor'](_0x26fd30/0x36ee80)+_0x237594(0x243b);else return _0x26fd30<0x240c8400?Math['floor'](_0x26fd30/0x5265c00)+'天前':_0x35dcc9[_0x237594(0x177f)]();}}}function createMomentElement(_0x2b132e){const _0x33d687=_0x2cf6d4,_0x464cf6=document[_0x33d687(0x1ad8)](_0x33d687(0x526));_0x464cf6[_0x33d687(0x221)]=_0x33d687(0x875),_0x464cf6[_0x33d687(0x1dd4)](_0x33d687(0x9ee),_0x2b132e['id']);_0x2b132e[_0x33d687(0x7aa)]&&_0x464cf6['setAttribute'](_0x33d687(0x8eb),_0x2b132e[_0x33d687(0x7aa)]);let _0xbf26df='';_0x2b132e['images']&&_0x2b132e[_0x33d687(0x21d6)]['length']>0x0&&(_0xbf26df=_0x33d687(0xbaa)+_0x2b132e[_0x33d687(0x21d6)][_0x33d687(0xf6d)](_0x263c46=>_0x33d687(0x2001)+_0x263c46+_0x33d687(0x2320)+_0x263c46+_0x33d687(0x1ccf))[_0x33d687(0x140c)]('')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20');let _0x197ea0=null;if(_0x2b132e[_0x33d687(0x3df)]==='user')_0x197ea0=_0x2b132e[_0x33d687(0x107f)];else{_0x197ea0=_0x2b132e[_0x33d687(0x107f)];if(!_0x197ea0&&_0x2b132e[_0x33d687(0x10df)]){const _0x220f8e=characters[_0x33d687(0x1aeb)](_0x196b66=>_0x196b66['id']===_0x2b132e[_0x33d687(0x10df)]);_0x220f8e&&_0x220f8e[_0x33d687(0x10f9)]&&(_0x197ea0=_0x220f8e[_0x33d687(0x10f9)]);}}return _0x464cf6[_0x33d687(0xc02)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22moment-avatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x197ea0?_0x33d687(0x2001)+_0x197ea0+_0x33d687(0x802)+(_0x2b132e[_0x33d687(0x201a)]?_0x2b132e[_0x33d687(0x201a)][_0x33d687(0x1518)](0x0):'?')+_0x33d687(0xafc):_0x33d687(0x1ae8)+(_0x2b132e[_0x33d687(0x201a)]?_0x2b132e[_0x33d687(0x201a)][_0x33d687(0x1518)](0x0):'?')+'</div>')+_0x33d687(0x1205)+_0x2b132e[_0x33d687(0x201a)]+_0x33d687(0x2439)+formatMomentText(_0x2b132e[_0x33d687(0x1e58)])+_0x33d687(0xc38)+_0xbf26df+_0x33d687(0xf39)+(_0x2b132e['mentions']&&_0x2b132e[_0x33d687(0x4f0)][_0x33d687(0xcbf)]>0x0?createMomentMentionsDisplay(_0x2b132e[_0x33d687(0x4f0)]):'')+_0x33d687(0x11be)+_0x2b132e[_0x33d687(0x8e1)]+_0x33d687(0x1e38)+(_0x2b132e[_0x33d687(0x63b)]?'<div\x20class=\x22moment-location\x22><i\x20class=\x22fas\x20fa-map-marker-alt\x22></i>\x20'+_0x2b132e[_0x33d687(0x63b)]+_0x33d687(0xa54):'')+_0x33d687(0xbc6)+(_0x2b132e['authorId']===_0x33d687(0x23b2)?createVisibilityIndicator(_0x2b132e[_0x33d687(0x311)],_0x2b132e[_0x33d687(0x1515)]):'')+_0x33d687(0x2322)+_0x2b132e['id']+_0x33d687(0x477)+_0x2b132e['id']+_0x33d687(0xc6a)+_0x2b132e['id']+_0x33d687(0x109c)+_0x2b132e['id']+_0x33d687(0x17d3),addLongPressListener(_0x464cf6,_0x2b132e['id']),((async()=>{const _0x2b6114=_0x33d687;try{const _0xcdc134=await db[_0x2b6114(0x101)][_0x2b6114(0x4a6)]('[momentId+authorId]')[_0x2b6114(0x14a)]([_0x2b132e['id'],_0x2b6114(0x23b2)])[_0x2b6114(0x2200)]();if(_0xcdc134){const _0x64bf=_0x464cf6[_0x2b6114(0x15b8)](_0x2b6114(0x1858)),_0x487013=_0x64bf[_0x2b6114(0x15b8)]('i');_0x487013['classList'][_0x2b6114(0x128)](_0x2b6114(0xd2a)),_0x487013['classList'][_0x2b6114(0xe1)](_0x2b6114(0x1886)),_0x64bf['classList'][_0x2b6114(0xe1)](_0x2b6114(0xca7));}}catch(_0xb376b9){console[_0x2b6114(0x24ab)](_0x2b6114(0x23b9),_0xb376b9);}})()),_0x464cf6;}function previewImage(_0x51435d){const _0x16fdae=_0x2cf6d4,_0x10b96f=document[_0x16fdae(0x1ad8)](_0x16fdae(0x526));_0x10b96f[_0x16fdae(0x655)][_0x16fdae(0x17a3)]=_0x16fdae(0x914);const _0x196d13=document[_0x16fdae(0x1ad8)](_0x16fdae(0x736));_0x196d13['src']=_0x51435d,_0x196d13[_0x16fdae(0x655)][_0x16fdae(0x17a3)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20max-width:\x2090%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20max-height:\x2090%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20object-fit:\x20contain;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x10b96f[_0x16fdae(0x1925)](_0x196d13),_0x10b96f['onclick']=()=>document['body'][_0x16fdae(0x1624)](_0x10b96f),document[_0x16fdae(0x172c)][_0x16fdae(0x1925)](_0x10b96f);}function updateTextCount(){const _0x3422cb=_0x2cf6d4,_0x3a8cab=document[_0x3422cb(0x566)](_0x3422cb(0x10fd)),_0x47c3b0=document[_0x3422cb(0x566)](_0x3422cb(0x4b9));if(_0x3a8cab&&_0x47c3b0){const _0x24574b=_0x3a8cab[_0x3422cb(0xc34)][_0x3422cb(0xcbf)],_0x52b194=0x1f4;_0x47c3b0[_0x3422cb(0x21dc)]=_0x24574b+'/'+_0x52b194;if(_0x24574b>_0x52b194*0.9)_0x47c3b0[_0x3422cb(0x655)][_0x3422cb(0x2099)]=_0x3422cb(0xc03);else _0x24574b>_0x52b194*0.8?_0x47c3b0[_0x3422cb(0x655)][_0x3422cb(0x2099)]=_0x3422cb(0x1596):_0x47c3b0[_0x3422cb(0x655)]['color']=_0x3422cb(0x150e);}}function showToast(_0x10b124){const _0x4aa72d=_0x2cf6d4,_0x44d7ae=document[_0x4aa72d(0x1ad8)]('div');_0x44d7ae[_0x4aa72d(0x655)][_0x4aa72d(0x17a3)]=_0x4aa72d(0x160d),_0x44d7ae['textContent']=_0x10b124,document['body'][_0x4aa72d(0x1925)](_0x44d7ae),setTimeout(()=>{const _0x1de9ac=_0x4aa72d;document[_0x1de9ac(0x172c)][_0x1de9ac(0x1624)](_0x44d7ae);},0x7d0);}let timeUpdateInterval=null;function startTimeUpdater(){timeUpdateInterval&&clearInterval(timeUpdateInterval),updateMomentTimes(),timeUpdateInterval=setInterval(updateMomentTimes,0xea60);}function stopTimeUpdater(){timeUpdateInterval&&(clearInterval(timeUpdateInterval),timeUpdateInterval=null);}function updateMomentTimes(){const _0x1160d0=_0x2cf6d4;try{const _0x2eb54e=document[_0x1160d0(0x1ed9)](_0x1160d0(0x19e0));_0x2eb54e[_0x1160d0(0x900)](_0x4327ec=>{const _0x5cc14f=_0x1160d0,_0x3eeb32=parseInt(_0x4327ec[_0x5cc14f(0x1add)](_0x5cc14f(0x8eb)));if(_0x3eeb32){const _0xb4647c=_0x4327ec[_0x5cc14f(0x15b8)](_0x5cc14f(0x1753));if(_0xb4647c){const _0xe3693d=formatTime(new Date(_0x3eeb32));_0xb4647c[_0x5cc14f(0x21dc)]=_0xe3693d;}}});const _0x26b3b2=document[_0x1160d0(0x1ed9)](_0x1160d0(0xa0b));_0x26b3b2[_0x1160d0(0x900)](_0x3a72ef=>{const _0xbf400=_0x1160d0,_0x505b33=parseInt(_0x3a72ef[_0xbf400(0x1add)](_0xbf400(0x8eb)));if(_0x505b33){const _0x381935=_0x3a72ef['querySelector'](_0xbf400(0x1313));if(_0x381935){const _0x1522c6=formatTime(new Date(_0x505b33));_0x381935[_0xbf400(0x21dc)]=_0x1522c6;}}});}catch(_0x455cf3){console[_0x1160d0(0x24ab)](_0x1160d0(0x21da),_0x455cf3);}}let isSelectionMode=![],selectedMoments=new Set();async function toggleMomentLike(_0x2d4b0b){const _0x4aac79=_0x2cf6d4;if(isSelectionMode)return;const _0x1baa48=document[_0x4aac79(0x15b8)](_0x4aac79(0x2352)+_0x2d4b0b+'\x22]');if(!_0x1baa48)return;const _0x2f1a1c=_0x1baa48['querySelector'](_0x4aac79(0x1858)),_0x47860e=_0x2f1a1c[_0x4aac79(0x15b8)]('i');try{const _0x86c5bf=await db[_0x4aac79(0x101)][_0x4aac79(0x4a6)]('[momentId+authorId]')[_0x4aac79(0x14a)]([parseInt(_0x2d4b0b),_0x4aac79(0x23b2)])[_0x4aac79(0x2200)]();_0x86c5bf?(_0x47860e[_0x4aac79(0x226e)][_0x4aac79(0x128)](_0x4aac79(0x1886)),_0x47860e[_0x4aac79(0x226e)][_0x4aac79(0xe1)](_0x4aac79(0xd2a)),_0x2f1a1c[_0x4aac79(0x226e)][_0x4aac79(0x128)](_0x4aac79(0xca7)),await db[_0x4aac79(0x101)][_0x4aac79(0xc2b)]([parseInt(_0x2d4b0b),_0x4aac79(0x23b2)])):(_0x47860e['classList'][_0x4aac79(0xe1)]('fas'),_0x47860e[_0x4aac79(0x226e)]['remove'](_0x4aac79(0xd2a)),_0x2f1a1c[_0x4aac79(0x226e)][_0x4aac79(0xe1)](_0x4aac79(0xca7)),await db['momentLikes']['add']({'momentId':parseInt(_0x2d4b0b),'authorId':_0x4aac79(0x23b2),'characterId':_0x4aac79(0x23b2),'name':document[_0x4aac79(0x566)](_0x4aac79(0x1a54))?.['textContent']||'我','timestamp':Date[_0x4aac79(0x18e0)]()}),triggerAIInteractions(_0x2d4b0b,_0x4aac79(0x166a))),updateMomentLikeDisplay(_0x2d4b0b);}catch(_0xfa0c0f){console['error']('点赞操作失败:',_0xfa0c0f);}}function showMomentComments(_0x3235bf){if(isSelectionMode)return;showBottomCommentInput(_0x3235bf);}function showBottomCommentInput(_0x425463,_0x2e6839=null){const _0xbf9a8d=_0x2cf6d4;closeBottomCommentInput();const _0x5095d9=_0x2e6839?_0xbf9a8d(0x1198)+_0x2e6839+_0xbf9a8d(0x12da):_0xbf9a8d(0x2275),_0x1e5cab=document[_0xbf9a8d(0x1ad8)]('div');_0x1e5cab['id']='bottom-comment-input',_0x1e5cab[_0xbf9a8d(0x221)]='bottom-comment-input',_0x1e5cab[_0xbf9a8d(0xc02)]=_0xbf9a8d(0x9b3)+_0x5095d9+'\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20maxlength=\x22200\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id=\x22bottom-comment-text\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20data-moment-id=\x22'+_0x425463+'\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20data-reply-to=\x22'+(_0x2e6839||'')+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22bottom-comment-send\x22\x20onclick=\x22submitBottomComment()\x22>发送</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',document[_0xbf9a8d(0x172c)][_0xbf9a8d(0x1925)](_0x1e5cab);const _0x3215da=_0x1e5cab['querySelector']('#bottom-comment-text');setTimeout(()=>{const _0x175abe=_0xbf9a8d;_0x3215da[_0x175abe(0x1b12)](),window['scrollBy'](0x0,0x3c);},0x64),_0x3215da[_0xbf9a8d(0x167)](_0xbf9a8d(0x1a17),_0x4875c4=>{const _0x4aee19=_0xbf9a8d;_0x4875c4[_0x4aee19(0x157f)]===_0x4aee19(0x165c)&&submitBottomComment();}),setTimeout(()=>{const _0x3dd816=_0xbf9a8d;document[_0x3dd816(0x167)](_0x3dd816(0x1e62),handleBottomCommentClickOutside);},0x64);}function closeBottomCommentInput(){const _0x4a09be=_0x2cf6d4,_0x50dcab=document[_0x4a09be(0x566)]('bottom-comment-input');_0x50dcab&&(_0x50dcab[_0x4a09be(0x128)](),document[_0x4a09be(0x6be)](_0x4a09be(0x1e62),handleBottomCommentClickOutside));}function handleBottomCommentClickOutside(_0x2aa0c1){const _0x1c319f=_0x2cf6d4,_0x4e6520=document['getElementById'](_0x1c319f(0x2535));_0x4e6520&&!_0x4e6520[_0x1c319f(0x1f9)](_0x2aa0c1[_0x1c319f(0x1144)])&&closeBottomCommentInput();}async function submitBottomComment(){const _0x3e8b51=_0x2cf6d4,_0x5cfd81=document['getElementById'](_0x3e8b51(0x7c8));if(!_0x5cfd81)return;const _0x3330bd=_0x5cfd81[_0x3e8b51(0xc34)][_0x3e8b51(0x1424)](),_0x10be8f=_0x5cfd81[_0x3e8b51(0x1add)](_0x3e8b51(0x9ee)),_0xfb037d=_0x5cfd81['getAttribute'](_0x3e8b51(0xa77));if(!_0x3330bd){showToast(_0x3e8b51(0x17a0));return;}const _0x17434d=document[_0x3e8b51(0x566)](_0x3e8b51(0x1a54))?.[_0x3e8b51(0x21dc)]||'我',_0x313b75={'id':Date[_0x3e8b51(0x18e0)](),'nickname':_0x17434d,'avatar':await getDefaultAvatar(),'text':_0x3330bd,'time':formatTime(new Date()),'timestamp':Date['now'](),'authorId':_0x3e8b51(0x23b2),'replyTo':_0xfb037d||null};saveCommentToMoment(_0x10be8f,_0x313b75),updateMomentCommentCount(_0x10be8f),displayCommentUnderMoment(_0x10be8f,_0x313b75),closeBottomCommentInput(),showToast(_0x3e8b51(0x7f5));if(_0xfb037d&&_0xfb037d!=='我'){const _0x4fc202=_0x10be8f+'-'+_0xfb037d,_0x3f959f=commentConversationRounds[_0x3e8b51(0x46a)](_0x4fc202)||0x0;_0x3f959f<0x3?(commentConversationRounds[_0x3e8b51(0x21c0)](_0x4fc202,_0x3f959f+0x1),console['log'](_0x3e8b51(0x358)+_0xfb037d+_0x3e8b51(0x1e84)+_0x10be8f+_0x3e8b51(0xccb)+(_0x3f959f+0x1)+'/3'),setTimeout(()=>{const _0x47c6be=_0x3e8b51;console[_0x47c6be(0xc0d)](_0x47c6be(0x1613)+_0xfb037d+_0x47c6be(0x1bbc)+_0x3330bd+'\x22'),triggerAIReplyToUser(_0x10be8f,_0xfb037d,_0x3330bd);},Math[_0x3e8b51(0x191c)]()*0xbb8+0x7d0)):console['log'](_0xfb037d+'\x20在动态\x20'+_0x10be8f+_0x3e8b51(0x380));}else console[_0x3e8b51(0xc0d)]('用户发表了评论，replyTo:\x20'+_0xfb037d),!_0xfb037d&&checkAndTriggerCharacterMomentReply(_0x10be8f,_0x3330bd);}async function checkAndTriggerCharacterMomentReply(_0x226fb3,_0x2380b8){const _0xf7ae0c=_0x2cf6d4;try{const _0x23dca0=await db[_0xf7ae0c(0x1a72)][_0xf7ae0c(0x46a)](parseInt(_0x226fb3));if(!_0x23dca0||!_0x23dca0[_0xf7ae0c(0x10df)]||_0x23dca0[_0xf7ae0c(0x10df)]==='user'){console[_0xf7ae0c(0xc0d)]('不是角色发布的动态，跳过角色回复');return;}const _0x29cdb6=characters[_0xf7ae0c(0x1aeb)](_0x1d9116=>_0x1d9116['id']===_0x23dca0['characterId']);if(!_0x29cdb6){console[_0xf7ae0c(0xc0d)](_0xf7ae0c(0x1cf4)+_0x23dca0['characterId']);return;}const _0x5e5cfe=_0x226fb3+'-'+_0x29cdb6['name'],_0x594163=commentConversationRounds[_0xf7ae0c(0x46a)](_0x5e5cfe)||0x0;if(_0x594163>=0x3){console[_0xf7ae0c(0xc0d)](_0x29cdb6['name']+_0xf7ae0c(0x1e84)+_0x226fb3+_0xf7ae0c(0x380));return;}console[_0xf7ae0c(0xc0d)]('用户评论了\x20'+_0x29cdb6['name']+_0xf7ae0c(0x232b)+_0x594163+_0xf7ae0c(0x1ef8)),commentConversationRounds[_0xf7ae0c(0x21c0)](_0x5e5cfe,_0x594163+0x1),console[_0xf7ae0c(0xc0d)](_0xf7ae0c(0xd01)+_0x29cdb6[_0xf7ae0c(0x222f)]+_0xf7ae0c(0x1e84)+_0x226fb3+_0xf7ae0c(0xccb)+(_0x594163+0x1)+'/3'),setTimeout(()=>{const _0x1c0541=_0xf7ae0c;console[_0x1c0541(0xc0d)]('开始触发\x20'+_0x29cdb6[_0x1c0541(0x222f)]+_0x1c0541(0x463)+_0x2380b8+'\x22'),triggerAIReplyToUser(_0x226fb3,_0x29cdb6[_0x1c0541(0x222f)],_0x2380b8);},Math[_0xf7ae0c(0x191c)]()*0xbb8+0x7d0);}catch(_0x5b0948){console[_0xf7ae0c(0x24ab)](_0xf7ae0c(0x173f),_0x5b0948);}}function displayCommentUnderMoment(_0x3060fe,_0x1a7522){const _0x9c08f0=_0x2cf6d4,_0x38e8fb=document[_0x9c08f0(0x15b8)]('[data-moment-id=\x22'+_0x3060fe+'\x22]');if(!_0x38e8fb)return;let _0x22a879=_0x38e8fb[_0x9c08f0(0x15b8)](_0x9c08f0(0x175c));if(!_0x22a879){_0x22a879=document['createElement'](_0x9c08f0(0x526)),_0x22a879['className']=_0x9c08f0(0x1511);const _0x2b014e=_0x38e8fb[_0x9c08f0(0x15b8)](_0x9c08f0(0xb03)),_0x2bffd7=_0x2b014e?'0':'0';_0x22a879[_0x9c08f0(0x655)]['cssText']=_0x9c08f0(0x137c)+_0x2bffd7+_0x9c08f0(0x18d8);const _0x27f1a2=_0x38e8fb[_0x9c08f0(0x15b8)](_0x9c08f0(0x1fb1)),_0x244d56=_0x38e8fb[_0x9c08f0(0x15b8)](_0x9c08f0(0xdc9));_0x27f1a2&&_0x244d56&&(_0x2b014e?_0x2b014e['parentNode'][_0x9c08f0(0x1806)](_0x22a879,_0x2b014e[_0x9c08f0(0x91f)]):_0x244d56[_0x9c08f0(0xe9)][_0x9c08f0(0x1806)](_0x22a879,_0x244d56[_0x9c08f0(0x91f)]));}const _0x16eb16=document[_0x9c08f0(0x1ad8)](_0x9c08f0(0x526));_0x16eb16['className']=_0x9c08f0(0x9c9),_0x16eb16[_0x9c08f0(0x1dd4)]('data-timestamp',_0x1a7522['timestamp']||Date['now']()),_0x16eb16['style'][_0x9c08f0(0x17a3)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20gap:\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-bottom:\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20align-items:\x20flex-start;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';let _0x1d5c7d=_0x1a7522[_0x9c08f0(0x1e58)],_0x464a7d=_0x1a7522[_0x9c08f0(0x201a)]+'：';_0x1a7522[_0x9c08f0(0x180)]&&(_0x464a7d=_0x1a7522[_0x9c08f0(0x201a)],_0x1d5c7d=_0x9c08f0(0x144b)+_0x1a7522[_0x9c08f0(0x180)]+_0x9c08f0(0x1f58)+_0x1a7522['text']),_0x16eb16[_0x9c08f0(0xc02)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22'+_0x1a7522[_0x9c08f0(0x107f)]+'\x22\x20style=\x22width:\x2024px;\x20height:\x2024px;\x20border-radius:\x2050%;\x20object-fit:\x20cover;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22flex:\x201;\x20line-height:\x201.4;\x20cursor:\x20pointer;\x22\x20onclick=\x22replyToMomentComment(\x27'+_0x3060fe+'\x27,\x20\x27'+_0x1a7522[_0x9c08f0(0x201a)]+'\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20style=\x22color:\x20#576b95;\x20font-weight:\x20600;\x22>'+_0x464a7d+'</span><span\x20style=\x22margin-left:\x202px;\x20color:\x20#333;\x22>'+_0x1d5c7d+_0x9c08f0(0xdb7)+_0x1a7522[_0x9c08f0(0x8e1)]+_0x9c08f0(0x24bf),_0x22a879[_0x9c08f0(0x1925)](_0x16eb16);}function replyToMomentComment(_0x243cb7,_0x6ba88f){showBottomCommentInput(_0x243cb7,_0x6ba88f);}async function saveCommentToMoment(_0x416e49,_0x3bee76){const _0x8a4b3e=_0x2cf6d4;try{const _0x43769d={'id':_0x3bee76['id'],'momentId':parseInt(_0x416e49),'authorId':_0x3bee76[_0x8a4b3e(0x10df)]||_0x8a4b3e(0x23b2),'nickname':_0x3bee76['nickname'],'avatar':_0x3bee76[_0x8a4b3e(0x107f)],'text':_0x3bee76[_0x8a4b3e(0x1e58)],'timestamp':_0x3bee76['timestamp'],'replyTo':_0x3bee76[_0x8a4b3e(0x180)]||null};await db[_0x8a4b3e(0x1733)][_0x8a4b3e(0xe1)](_0x43769d),console[_0x8a4b3e(0xc0d)](_0x8a4b3e(0x223d),_0x416e49);}catch(_0x3afdca){console[_0x8a4b3e(0x24ab)](_0x8a4b3e(0x190f),_0x3afdca);}}async function updateMomentCommentCount(_0x592d3c){const _0x1d01d0=_0x2cf6d4;try{const _0x3c39ba=document['querySelector']('[data-moment-id=\x22'+_0x592d3c+'\x22]');if(!_0x3c39ba)return;const _0x444125=await db[_0x1d01d0(0x1733)][_0x1d01d0(0x4a6)](_0x1d01d0(0x2289))['equals'](parseInt(_0x592d3c))['count'](),_0x187861=_0x3c39ba[_0x1d01d0(0x1ed9)](_0x1d01d0(0x1858))[0x1],_0x172d6c=_0x187861[_0x1d01d0(0x15b8)](_0x1d01d0(0x213b));_0x172d6c[_0x1d01d0(0x21dc)]=_0x444125;}catch(_0x59f1c5){console['error']('更新评论数失败:',_0x59f1c5);}}async function triggerAIInteractions(_0x222542,_0x2534b6){const _0x57a115=_0x2cf6d4;try{if(!characters||characters[_0x57a115(0xcbf)]===0x0)return;const _0x5304eb=await db[_0x57a115(0x1a72)]['get'](parseInt(_0x222542));if(!_0x5304eb)return;const _0x1547f3=_0x5304eb[_0x57a115(0x10df)];if(!_0x1547f3||_0x1547f3==='user'){const _0x42f5f3=characters[_0x57a115(0x803)](_0x3a100a=>contacts[_0x57a115(0x23ec)](_0x3a100a['id'])),_0x5677b6=[];for(const _0x19b25f of _0x42f5f3){const _0x2d7037=await checkMomentVisibilityForCharacter(parseInt(_0x222542),_0x19b25f['id']);if(_0x2d7037){if(!blacklistData||blacklistData[_0x57a115(0xcbf)]===0x0)try{await loadBlacklistData();}catch(_0x5e93a4){console['error'](_0x57a115(0x2237),_0x5e93a4);}const _0x226225=isBlocked(_0x57a115(0x23b2),_0x19b25f['id']),_0x2f388c=isBlocked(_0x19b25f['id'],_0x57a115(0x23b2));if(_0x226225||_0x2f388c){console['log']('🚫\x20角色\x20'+_0x19b25f[_0x57a115(0x222f)]+_0x57a115(0x15fd));continue;}_0x5677b6['push'](_0x19b25f),console[_0x57a115(0xc0d)](_0x57a115(0x1f7e)+_0x19b25f[_0x57a115(0x222f)]+'\x20可以回复用户动态');}}if(_0x2534b6===_0x57a115(0x166a))for(const _0x553ee7 of _0x5677b6){Math[_0x57a115(0x191c)]()<0.85&&setTimeout(async()=>{await addAILikeWithPersonality(_0x222542,_0x553ee7,_0x5304eb);},Math[_0x57a115(0x191c)]()*0xbb8+0x3e8);}else{if(_0x2534b6===_0x57a115(0x8a4))for(const _0xafcb1a of _0x5677b6){Math[_0x57a115(0x191c)]()<0.85&&setTimeout(async()=>{await addAICommentWithPersonality(_0x222542,_0xafcb1a,_0x5304eb);},Math[_0x57a115(0x191c)]()*0x1388+0x7d0);}}}else{console[_0x57a115(0xc0d)](_0x57a115(0x17c));const _0x5797f6=characters[_0x57a115(0x1aeb)](_0x583afa=>_0x583afa['id']===_0x1547f3),_0x590dd7=characterGroups[_0x57a115(0x1aeb)](_0x17d0fc=>_0x17d0fc['id']===_0x5797f6['groupId']);if(!_0x590dd7||!_0x590dd7[_0x57a115(0xd0)]){console['log']('🚫\x20分组\x20'+(_0x590dd7?.[_0x57a115(0x222f)]||'未知')+_0x57a115(0x1332));return;}const _0x5b9f3f=characters[_0x57a115(0x803)](_0xf4c866=>_0xf4c866['id']!==_0x1547f3&&_0xf4c866[_0x57a115(0x1eb)]===_0x5797f6[_0x57a115(0x1eb)]),_0x24cbda=[];for(const _0x4f8ef3 of _0x5b9f3f){const _0x12e7ed=await checkMomentVisibilityForCharacter(parseInt(_0x222542),_0x4f8ef3['id']);_0x12e7ed&&_0x24cbda[_0x57a115(0x6ee)](_0x4f8ef3);}console[_0x57a115(0xc0d)](_0x57a115(0xa92)+_0x24cbda[_0x57a115(0xcbf)]+'/'+_0x5b9f3f['length']);if(_0x2534b6===_0x57a115(0x166a))for(const _0x427d59 of _0x24cbda){Math[_0x57a115(0x191c)]()<0.65&&setTimeout(async()=>{await addAILikeWithPersonality(_0x222542,_0x427d59,_0x5304eb);},Math[_0x57a115(0x191c)]()*0xbb8+0x3e8);}else{if(_0x2534b6===_0x57a115(0x8a4)){console['log'](_0x57a115(0xc31),_0x24cbda[_0x57a115(0xcbf)]);for(const _0xf64920 of _0x24cbda){const _0x5da574=Math[_0x57a115(0x191c)](),_0x55323a=_0x5da574<0.55;console[_0x57a115(0xc0d)](_0xf64920['name']+'\x20评论概率检查:\x20'+_0x5da574[_0x57a115(0x3cd)](0x3)+_0x57a115(0xfc6)+_0x55323a),_0x55323a?setTimeout(async()=>{const _0x2ad15b=_0x57a115;console['log'](_0xf64920[_0x2ad15b(0x222f)]+'\x20开始生成评论...'),await addAICommentWithPersonality(_0x222542,_0xf64920,_0x5304eb);},Math[_0x57a115(0x191c)]()*0x1388+0x7d0):console[_0x57a115(0xc0d)](_0xf64920[_0x57a115(0x222f)]+'\x20因为概率未通过，不会评论');}setTimeout(()=>{const _0x20c1d6=[..._0x24cbda];_0x5797f6&&_0x20c1d6['push'](_0x5797f6),triggerAiToAiInteractionWithPersonality(_0x222542,_0x20c1d6);},Math[_0x57a115(0x191c)]()*0x1f40+0x1388);}}}}catch(_0x4a425d){console[_0x57a115(0x24ab)](_0x57a115(0x2095),_0x4a425d);}}function getCharactersInSameGroups(_0x19a770){const _0x3fd9c0=[];return groupChats['forEach'](_0x198677=>{const _0x1a9b15=_0x3a81;_0x198677[_0x1a9b15(0xcaa)]&&_0x198677[_0x1a9b15(0xcaa)][_0x1a9b15(0x23ec)](_0x19a770)&&_0x198677[_0x1a9b15(0xcaa)][_0x1a9b15(0x900)](_0x5ba157=>{const _0x8a77c9=_0x1a9b15;if(_0x5ba157!==_0x19a770&&_0x5ba157!==_0x8a77c9(0x23b2)){const _0x47a8d7=characters[_0x8a77c9(0x1aeb)](_0x32e4de=>_0x32e4de['id']===_0x5ba157);_0x47a8d7&&!_0x3fd9c0[_0x8a77c9(0x1aeb)](_0x5e058c=>_0x5e058c['id']===_0x47a8d7['id'])&&_0x3fd9c0[_0x8a77c9(0x6ee)](_0x47a8d7);}});}),_0x3fd9c0;}async function addAILikeWithPersonality(_0x2f0b26,_0x21c7a0,_0x1d0658){const _0x24dc53=_0x2cf6d4;try{const _0x240149=document[_0x24dc53(0x15b8)](_0x24dc53(0x2352)+_0x2f0b26+'\x22]');if(!_0x240149)return;const _0x30283f=await db[_0x24dc53(0x101)][_0x24dc53(0x4a6)](_0x24dc53(0x159a))[_0x24dc53(0x14a)]([parseInt(_0x2f0b26),_0x21c7a0['id']])[_0x24dc53(0x2200)]();if(_0x30283f)return;const _0x257b2c=await shouldCharacterLikeMomentWithMemory(_0x21c7a0,_0x1d0658);if(!_0x257b2c){console[_0x24dc53(0xc0d)](_0x21c7a0['name']+_0x24dc53(0x660));return;}await db['momentLikes']['add']({'momentId':parseInt(_0x2f0b26),'authorId':_0x21c7a0['id'],'characterId':_0x21c7a0['id'],'name':_0x21c7a0[_0x24dc53(0x222f)],'timestamp':Date[_0x24dc53(0x18e0)]()}),updateMomentLikeDisplay(_0x2f0b26),_0x1d0658[_0x24dc53(0x3df)]==='user'&&(showToast(_0x21c7a0[_0x24dc53(0x222f)]+_0x24dc53(0xd98)),createPushNotification(_0x21c7a0,_0x24dc53(0x1a91),0x64)),await recordMemoryEvent([_0x21c7a0['id']],{'type':'moments','id':_0x24dc53(0x1a72)},_0x24dc53(0x1de4),_0x24dc53(0x16b)+(_0x1d0658[_0x24dc53(0x3df)]===_0x24dc53(0x23b2)?'用户':_0x1d0658[_0x24dc53(0x201a)])+_0x24dc53(0x175b));}catch(_0x118350){console['error']('AI点赞失败:',_0x118350);}}async function addAILike(_0x4ab846,_0x29507d,_0x4802de){return await addAILikeWithPersonality(_0x4ab846,_0x29507d,_0x4802de);}async function shouldCharacterLikeMomentWithMemory(_0x3fab31,_0x4d3bc6){const _0x47f677=_0x2cf6d4;try{let _0x21a0de=null;try{_0x21a0de=await db[_0x47f677(0xb08)]['get'](_0x3fab31['id']);}catch(_0x52f289){console[_0x47f677(0x24ab)]('获取聊天设置失败:',_0x52f289);}const _0x304566=_0x3fab31['bio']||_0x3fab31[_0x47f677(0x1f8f)]||'你是'+_0x3fab31[_0x47f677(0x222f)]+'。';let _0x40c699='';if(_0x4d3bc6[_0x47f677(0x10df)]&&_0x4d3bc6[_0x47f677(0x10df)]!=='user'){const _0xfbc82f=await db[_0x47f677(0xa1b)][_0x47f677(0x4a6)]('characterId')[_0x47f677(0x14a)](_0x3fab31['id'])[_0x47f677(0x18c6)](),_0x3e7401=_0xfbc82f['filter'](_0x4bd882=>_0x4bd882[_0x47f677(0x77b)]&&_0x4bd882['fact'][_0x47f677(0x23ec)](_0x4d3bc6['nickname']));_0x3e7401[_0x47f677(0xcbf)]>0x0&&(_0x40c699=_0x3e7401[_0x47f677(0xf6d)](_0xa8d0a1=>_0xa8d0a1[_0x47f677(0x77b)])[_0x47f677(0x140c)]('；'));}const _0xcca065=_0x304566[_0x47f677(0x1d64)](),_0xc47c1a=(_0x4d3bc6[_0x47f677(0x1e58)]||'')[_0x47f677(0x1d64)](),_0x2824f3=_0x4d3bc6[_0x47f677(0x201a)]||'用户';if(_0x40c699){const _0x939fe4=['吵架','争执','讨厌',_0x47f677(0xbe),'敌对','竞争','情敌','冲突'],_0x15f3e8=_0x939fe4[_0x47f677(0x184b)](_0x5e31e3=>_0x40c699['toLowerCase']()[_0x47f677(0x23ec)](_0x5e31e3));if(_0x15f3e8)return console[_0x47f677(0xc0d)](_0x3fab31[_0x47f677(0x222f)]+'\x20与\x20'+_0x2824f3+_0x47f677(0x1cb0)),![];}const _0x3107db=['冷漠','严肃',_0x47f677(0x14fa),'内向','沉默'],_0x1749a0=_0x3107db['some'](_0x46067a=>_0xcca065[_0x47f677(0x23ec)](_0x46067a));if(_0x1749a0&&Math[_0x47f677(0x191c)]()<0.7)return![];const _0x4846b0=extractInterestsFromBio(_0xcca065),_0x149f03=_0x4846b0[_0x47f677(0x184b)](_0x8f895a=>_0xc47c1a[_0x47f677(0x23ec)](_0x8f895a));if(_0x149f03)return Math['random']()<0.9;if(!_0x4d3bc6[_0x47f677(0x10df)]||_0x4d3bc6['characterId']==='user')return Math[_0x47f677(0x191c)]()<0.8;return Math[_0x47f677(0x191c)]()<0.7;}catch(_0x3f2d1c){return console['error'](_0x47f677(0x1e7d),_0x3f2d1c),Math[_0x47f677(0x191c)]()<0.6;}}async function shouldCharacterLikeMoment(_0x3a9f87,_0x30d4c5){return await shouldCharacterLikeMomentWithMemory(_0x3a9f87,_0x30d4c5);}function extractInterestsFromBio(_0x43f4af){const _0xef8b89=_0x2cf6d4,_0x475fd4=[],_0x808a02=['音乐','电影','读书','运动','游戏','美食','旅行','摄影','绘画','写作','代码','科技','动漫','小说','咖啡','茶','宠物','花','星空','雨天','阳光','学习','工作','朋友'];return _0x808a02[_0xef8b89(0x900)](_0x225a16=>{const _0x5c46f3=_0xef8b89;_0x43f4af[_0x5c46f3(0x23ec)](_0x225a16)&&_0x475fd4[_0x5c46f3(0x6ee)](_0x225a16);}),_0x475fd4;}async function updateMomentLikeDisplay(_0x398338){const _0xa19f61=_0x2cf6d4;try{const _0x4fb0be=document[_0xa19f61(0x15b8)](_0xa19f61(0x2352)+_0x398338+'\x22]');if(!_0x4fb0be)return;const _0x3609db=await db['momentLikes'][_0xa19f61(0x4a6)]('momentId')[_0xa19f61(0x14a)](parseInt(_0x398338))[_0xa19f61(0x18c6)](),_0x36e49b=_0x4fb0be['querySelector'](_0xa19f61(0x1c49));if(_0x36e49b){const _0x436667=_0x36e49b[_0xa19f61(0x15b8)](_0xa19f61(0x213b));_0x436667&&(_0x436667[_0xa19f61(0x21dc)]=_0x3609db[_0xa19f61(0xcbf)]);}let _0x26e484=_0x4fb0be[_0xa19f61(0x15b8)](_0xa19f61(0xb03));if(_0x3609db[_0xa19f61(0xcbf)]>0x0){if(!_0x26e484){_0x26e484=document[_0xa19f61(0x1ad8)]('div'),_0x26e484['className']='likes-display';const _0x5f12b1=_0x4fb0be[_0xa19f61(0x15b8)](_0xa19f61(0x175c)),_0x152109=_0x5f12b1?'0':'0';_0x26e484[_0xa19f61(0x655)][_0xa19f61(0x17a3)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-top:\x20'+_0x152109+_0xa19f61(0x137a);const _0x8a58c8=_0x4fb0be[_0xa19f61(0x15b8)]('.moment-content'),_0x134057=_0x4fb0be[_0xa19f61(0x15b8)]('.moment-time-actions'),_0x4885c4=_0x4fb0be[_0xa19f61(0x15b8)](_0xa19f61(0x175c));_0x8a58c8&&_0x134057&&(_0x4885c4?_0x8a58c8[_0xa19f61(0x1806)](_0x26e484,_0x4885c4):_0x134057[_0xa19f61(0xe9)][_0xa19f61(0x1806)](_0x26e484,_0x134057[_0xa19f61(0x91f)]));}const _0x40bf0d=_0xa19f61(0x6ba),_0x57a41e=_0x3609db[_0xa19f61(0xf6d)](_0x5c892f=>_0x5c892f[_0xa19f61(0x222f)])[_0xa19f61(0x140c)]('、');_0x26e484['innerHTML']=_0x40bf0d+_0xa19f61(0x2139)+_0x57a41e+_0xa19f61(0x19d2),_0x26e484[_0xa19f61(0x655)][_0xa19f61(0x2526)]='block';}else _0x26e484&&(_0x26e484[_0xa19f61(0x655)][_0xa19f61(0x2526)]=_0xa19f61(0xfe9));}catch(_0x3734e5){console[_0xa19f61(0x24ab)]('更新点赞显示失败:',_0x3734e5);}}async function addAICommentWithPersonality(_0x5b98f0,_0x1f116f,_0x2f9463){const _0x117b2b=_0x2cf6d4;try{const _0x4fbb5a=await generateCharacterCommentWithMemory(_0x1f116f,_0x2f9463);console['log'](_0x117b2b(0x830)+_0x1f116f[_0x117b2b(0x222f)]+_0x117b2b(0x8d2),_0x4fbb5a);if(!_0x4fbb5a||_0x4fbb5a[_0x117b2b(0xcbf)]===0x0){console['log'](_0x117b2b(0x1f75)+_0x1f116f[_0x117b2b(0x222f)]+_0x117b2b(0x643));return;}const _0x28e9b1=_0x4fbb5a[Math[_0x117b2b(0x1dac)](Math['random']()*_0x4fbb5a['length'])],_0x5c32a4={'id':Date[_0x117b2b(0x18e0)]()+Math[_0x117b2b(0x191c)](),'nickname':_0x1f116f[_0x117b2b(0x222f)],'avatar':_0x1f116f['avatarUrl'],'text':_0x28e9b1,'time':formatTime(new Date()),'timestamp':Date[_0x117b2b(0x18e0)](),'characterId':_0x1f116f['id']};saveCommentToMoment(_0x5b98f0,_0x5c32a4),updateMomentCommentCount(_0x5b98f0),displayCommentUnderMoment(_0x5b98f0,_0x5c32a4);_0x2f9463[_0x117b2b(0x3df)]===_0x117b2b(0x23b2)&&(showToast(_0x1f116f['name']+_0x117b2b(0x1fe7)),createPushNotification(_0x1f116f,'评论了你的动态：'+(_0x28e9b1[_0x117b2b(0xcbf)]>0xf?_0x28e9b1[_0x117b2b(0x4b2)](0x0,0xf)+_0x117b2b(0x12da):_0x28e9b1),0xc8));await recordMemoryEvent([_0x1f116f['id']],{'type':_0x117b2b(0x1a72),'id':_0x117b2b(0x1a72)},_0x117b2b(0x141f),'评论了'+(_0x2f9463[_0x117b2b(0x3df)]==='user'?'用户':_0x2f9463[_0x117b2b(0x201a)])+_0x117b2b(0x7c0)+_0x28e9b1);if(_0x2f9463[_0x117b2b(0x10df)]&&_0x2f9463[_0x117b2b(0x10df)]!==_0x117b2b(0x23b2)&&_0x2f9463[_0x117b2b(0x10df)]!==_0x1f116f['id']){const _0x39bef6=characters['find'](_0x2372e4=>_0x2372e4['id']===_0x2f9463[_0x117b2b(0x10df)]);_0x39bef6&&(console[_0x117b2b(0xc0d)]('🔔\x20'+_0x1f116f[_0x117b2b(0x222f)]+_0x117b2b(0x1f85)+_0x39bef6[_0x117b2b(0x222f)]+'\x20的动态，将在30-60秒后触发发布者回复'),setTimeout(async()=>{const _0x13eb1d=_0x117b2b;console[_0x13eb1d(0xc0d)](_0x13eb1d(0x74d)+_0x39bef6[_0x13eb1d(0x222f)]+_0x13eb1d(0x1141)+_0x1f116f[_0x13eb1d(0x222f)]+_0x13eb1d(0x1be7)),await triggerPublisherReplyToComments(_0x5b98f0,_0x39bef6);},Math[_0x117b2b(0x191c)]()*0x7530+0x7530));}}catch(_0x450c81){console[_0x117b2b(0x24ab)](_0x117b2b(0x6ac),_0x450c81);}}async function addAIComment(_0x3219f2,_0x2551ca,_0x2c1d8a){return await addAICommentWithPersonality(_0x3219f2,_0x2551ca,_0x2c1d8a);}async function triggerAiToAiInteractionWithPersonality(_0x126c7a,_0x5e64a6){const _0x34f7f0=_0x2cf6d4;try{const _0x3e8b17=await db[_0x34f7f0(0x1a72)][_0x34f7f0(0x46a)](parseInt(_0x126c7a));if(!_0x3e8b17)return;const _0x405e61=await db[_0x34f7f0(0x1733)][_0x34f7f0(0x4a6)](_0x34f7f0(0x2289))[_0x34f7f0(0x14a)](parseInt(_0x126c7a))['toArray']();if(_0x405e61[_0x34f7f0(0xcbf)]<0x2)return;const _0x1ce01e=[...new Set(_0x405e61[_0x34f7f0(0x803)](_0x33b3c7=>_0x33b3c7[_0x34f7f0(0x10df)]&&_0x33b3c7['characterId']!==_0x34f7f0(0x23b2))[_0x34f7f0(0xf6d)](_0x3b47bb=>_0x3b47bb[_0x34f7f0(0x10df)]))],_0x4e917f=_0x1ce01e['filter'](_0x484e3f=>_0x5e64a6[_0x34f7f0(0x184b)](_0x4fa064=>_0x4fa064['id']===_0x484e3f));if(_0x4e917f[_0x34f7f0(0xcbf)]<0x2){console[_0x34f7f0(0xc0d)](_0x34f7f0(0xb1b));return;}console[_0x34f7f0(0xc0d)]('发现\x20'+_0x4e917f[_0x34f7f0(0xcbf)]+'\x20个同群AI角色参与了评论，开始角色间互动');const _0x518c01=_0x4e917f[Math['floor'](Math['random']()*_0x4e917f[_0x34f7f0(0xcbf)])];let _0x324f14=_0x4e917f[Math[_0x34f7f0(0x1dac)](Math[_0x34f7f0(0x191c)]()*_0x4e917f[_0x34f7f0(0xcbf)])];while(_0x324f14===_0x518c01&&_0x4e917f[_0x34f7f0(0xcbf)]>0x1){_0x324f14=_0x4e917f[Math[_0x34f7f0(0x1dac)](Math['random']()*_0x4e917f[_0x34f7f0(0xcbf)])];}if(_0x518c01===_0x324f14)return;const _0x472b74=characters[_0x34f7f0(0x1aeb)](_0x418226=>_0x418226['id']===_0x518c01),_0x1ae245=characters[_0x34f7f0(0x1aeb)](_0x2afff3=>_0x2afff3['id']===_0x324f14);if(!_0x472b74||!_0x1ae245)return;const _0x5aca62=await shouldCharactersInteract(_0x472b74,_0x1ae245);if(!_0x5aca62){console[_0x34f7f0(0xc0d)](_0x472b74[_0x34f7f0(0x222f)]+'\x20和\x20'+_0x1ae245[_0x34f7f0(0x222f)]+_0x34f7f0(0x8f5));return;}const _0x2d6f17=_0x405e61[_0x34f7f0(0x1aeb)](_0x38faf7=>_0x38faf7[_0x34f7f0(0x10df)]===_0x518c01||_0x38faf7[_0x34f7f0(0x10df)]===_0x324f14);if(!_0x2d6f17)return;const _0x124681=_0x2d6f17[_0x34f7f0(0x10df)]===_0x518c01?_0x324f14:_0x518c01,_0x45f5c3=_0x2d6f17[_0x34f7f0(0x10df)],_0x5eb9c0=characters[_0x34f7f0(0x1aeb)](_0x28dee9=>_0x28dee9['id']===_0x124681),_0x55461d=characters[_0x34f7f0(0x1aeb)](_0x23e308=>_0x23e308['id']===_0x45f5c3);if(!_0x5eb9c0||!_0x55461d)return;console[_0x34f7f0(0xc0d)](_0x5eb9c0[_0x34f7f0(0x222f)]+_0x34f7f0(0x254)+_0x55461d[_0x34f7f0(0x222f)]+'\x20的评论'),await generateAiToAiReplyWithMemory(_0x126c7a,_0x2d6f17,_0x5eb9c0,_0x55461d);}catch(_0x2c6e06){console['error'](_0x34f7f0(0x222),_0x2c6e06);}}async function triggerAiToAiInteraction(_0x2934a2,_0x156553){return await triggerAiToAiInteractionWithPersonality(_0x2934a2,_0x156553);}async function shouldCharactersInteract(_0x1b1eb2,_0x20cde0){const _0x11266c=_0x2cf6d4;try{const _0x216b78=await db['coreMemories'][_0x11266c(0x4a6)](_0x11266c(0x10df))[_0x11266c(0x14a)](_0x1b1eb2['id'])[_0x11266c(0x18c6)](),_0x209e41=_0x216b78[_0x11266c(0x803)](_0x453a4d=>_0x453a4d[_0x11266c(0x77b)]&&_0x453a4d['fact'][_0x11266c(0x23ec)](_0x20cde0['name'])),_0x466719=await db[_0x11266c(0xa1b)][_0x11266c(0x4a6)](_0x11266c(0x10df))[_0x11266c(0x14a)](_0x20cde0['id'])['toArray'](),_0x3efcd3=_0x466719[_0x11266c(0x803)](_0x553cc9=>_0x553cc9[_0x11266c(0x77b)]&&_0x553cc9[_0x11266c(0x77b)][_0x11266c(0x23ec)](_0x1b1eb2['name'])),_0x22289e=[..._0x209e41,..._0x3efcd3],_0x1b6a10=['吵架','争执','讨厌',_0x11266c(0xbe),'敌对','竞争','情敌','冲突','矛盾'],_0x4ca386=_0x22289e[_0x11266c(0x184b)](_0x3ac688=>_0x1b6a10[_0x11266c(0x184b)](_0xaf8e7c=>_0x3ac688['fact'][_0x11266c(0x1d64)]()[_0x11266c(0x23ec)](_0xaf8e7c)));if(_0x4ca386)return Math['random']()<0.6;const _0x4158ba=['朋友','喜欢','亲密','合作','帮助','支持','关心'],_0x5f49e4=_0x22289e['some'](_0x20b912=>_0x4158ba[_0x11266c(0x184b)](_0x3874ef=>_0x20b912['fact'][_0x11266c(0x1d64)]()[_0x11266c(0x23ec)](_0x3874ef)));if(_0x5f49e4)return Math[_0x11266c(0x191c)]()<0.8;return Math[_0x11266c(0x191c)]()<0.8;}catch(_0x4ee54b){return console['error'](_0x11266c(0x251b),_0x4ee54b),Math['random']()<0.4;}}async function triggerAiToAiInteractionOld(_0x4fd69b,_0x1d1205){const _0x4add68=_0x2cf6d4;try{const _0x50438f=JSON[_0x4add68(0x168e)](sessionStorage[_0x4add68(0x2250)](_0x4add68(0x12cb))||'[]'),_0xbbd682=_0x50438f[_0x4add68(0x1aeb)](_0x5005a5=>_0x5005a5['id']==_0x4fd69b||_0x5005a5['timestamp']==_0x4fd69b);if(!_0xbbd682||!_0xbbd682['comments'])return;const _0x1e8cbd=_0xbbd682[_0x4add68(0x1508)];if(_0x1e8cbd[_0x4add68(0xcbf)]<0x2)return;const _0x55ae8f=[...new Set(_0x1e8cbd[_0x4add68(0x803)](_0xc9a98c=>_0xc9a98c['characterId']&&_0xc9a98c[_0x4add68(0x10df)]!==_0x4add68(0x23b2))[_0x4add68(0xf6d)](_0x14fe54=>_0x14fe54['characterId']))],_0x3ce880=_0x55ae8f[_0x4add68(0x803)](_0x3c3e5f=>_0x1d1205['some'](_0x96951e=>_0x96951e['id']===_0x3c3e5f));if(_0x3ce880['length']<0x2){console['log'](_0x4add68(0xb1b));return;}console[_0x4add68(0xc0d)]('发现\x20'+_0x3ce880[_0x4add68(0xcbf)]+_0x4add68(0x172b));const _0x68ae6=_0x3ce880[Math[_0x4add68(0x1dac)](Math[_0x4add68(0x191c)]()*_0x3ce880[_0x4add68(0xcbf)])];let _0x46125a=_0x3ce880[Math[_0x4add68(0x1dac)](Math[_0x4add68(0x191c)]()*_0x3ce880['length'])];while(_0x46125a===_0x68ae6&&_0x3ce880['length']>0x1){_0x46125a=_0x3ce880[Math[_0x4add68(0x1dac)](Math['random']()*_0x3ce880[_0x4add68(0xcbf)])];}if(_0x68ae6===_0x46125a)return;if(Math[_0x4add68(0x191c)]()>0.4){console[_0x4add68(0xc0d)](_0x4add68(0x987));return;}const _0x5eb6c5=_0x1e8cbd[_0x4add68(0x1aeb)](_0x17b8f8=>_0x17b8f8['characterId']===_0x68ae6||_0x17b8f8[_0x4add68(0x10df)]===_0x46125a);if(!_0x5eb6c5)return;const _0x2479e7=_0x5eb6c5[_0x4add68(0x10df)]===_0x68ae6?_0x46125a:_0x68ae6,_0xc3a726=_0x5eb6c5[_0x4add68(0x10df)],_0x104641=characters[_0x4add68(0x1aeb)](_0x2257a0=>_0x2257a0['id']===_0x2479e7),_0x14a952=characters[_0x4add68(0x1aeb)](_0x4780ab=>_0x4780ab['id']===_0xc3a726);if(!_0x104641||!_0x14a952)return;console[_0x4add68(0xc0d)](_0x104641[_0x4add68(0x222f)]+'\x20将回复\x20'+_0x14a952[_0x4add68(0x222f)]+_0x4add68(0x1b63)),await generateAiToAiReply(_0x4fd69b,_0x5eb6c5,_0x104641,_0x14a952);}catch(_0x33cc2d){console[_0x4add68(0x24ab)](_0x4add68(0x222),_0x33cc2d);}}function triggerCharacterInteractions(_0x186c2c,_0x139408){const _0x593de5=_0x2cf6d4;if(_0x139408['length']<0x2)return;const _0x4effed=getGroupRelations(_0x139408);for(let _0x3449cd=0x0;_0x3449cd<_0x139408['length']-0x1;_0x3449cd++){for(let _0x48b9f0=_0x3449cd+0x1;_0x48b9f0<_0x139408[_0x593de5(0xcbf)];_0x48b9f0++){const _0x177f49=_0x139408[_0x3449cd],_0x24d4e5=_0x139408[_0x48b9f0],_0x36cd2f=_0x4effed['some'](_0x208129=>_0x208129[_0x593de5(0x23ec)](_0x177f49['id'])&&_0x208129[_0x593de5(0x23ec)](_0x24d4e5['id']));_0x36cd2f&&Math[_0x593de5(0x191c)]()<0.6&&addCharacterInteraction(_0x186c2c,_0x177f49,_0x24d4e5);}}}function getGroupRelations(_0x483c5a){const _0x467e7e=_0x2cf6d4,_0x99b439=[],_0x2c1d5b={};return _0x483c5a[_0x467e7e(0x900)](_0x2721e0=>{const _0x51ad70=_0x467e7e,_0x4d685e=_0x2721e0['groupId']||'my_friends';!_0x2c1d5b[_0x4d685e]&&(_0x2c1d5b[_0x4d685e]=[]),_0x2c1d5b[_0x4d685e][_0x51ad70(0x6ee)](_0x2721e0['id']);}),Object[_0x467e7e(0x230e)](_0x2c1d5b)[_0x467e7e(0x900)](([_0x403094,_0x4f2cde])=>{const _0x5e6a6c=_0x467e7e,_0x284ffe=characterGroups['find'](_0x14b163=>_0x14b163['id']===_0x403094);_0x284ffe&&!_0x284ffe[_0x5e6a6c(0x1b5)]&&_0x284ffe[_0x5e6a6c(0xd0)]&&_0x4f2cde['length']>=0x2&&_0x99b439['push'](_0x4f2cde);}),_0x99b439;}async function generateAiToAiReplyWithMemory(_0x374d02,_0x37e896,_0x4450c7,_0x50e4e2){const _0x7d8d7b=_0x2cf6d4;try{const _0x5c4e3a=_0x374d02+'-'+_0x4450c7['name']+'-'+_0x50e4e2[_0x7d8d7b(0x222f)],_0xdfa9bb=commentConversationRounds['get'](_0x5c4e3a)||0x0;if(_0xdfa9bb>=0x3){console[_0x7d8d7b(0xc0d)](_0x4450c7['name']+_0x7d8d7b(0x3c1)+_0x50e4e2[_0x7d8d7b(0x222f)]+'\x20在动态\x20'+_0x374d02+_0x7d8d7b(0x2210));return;}const _0x538c66=Math[_0x7d8d7b(0x191c)]();console['log'](_0x7d8d7b(0x59b)+_0x4450c7[_0x7d8d7b(0x222f)]+_0x7d8d7b(0x1c5e)+_0x50e4e2['name']+_0x7d8d7b(0x2154)+_0x538c66[_0x7d8d7b(0x3cd)](0x3)+'\x20<\x200.8\x20=\x20'+(_0x538c66<0.8));if(_0x538c66>=0.8){console[_0x7d8d7b(0xc0d)](_0x7d8d7b(0x76d)+_0x4450c7[_0x7d8d7b(0x222f)]+_0x7d8d7b(0x22cb)+_0x50e4e2[_0x7d8d7b(0x222f)]+_0x7d8d7b(0x1b63));return;}const _0x270053=await db[_0x7d8d7b(0x1a72)]['get'](parseInt(_0x374d02));if(!_0x270053)return;let _0x3b4aa0=null;try{_0x3b4aa0=await db[_0x7d8d7b(0xb08)][_0x7d8d7b(0x46a)](_0x4450c7['id']);}catch(_0x48e31a){console[_0x7d8d7b(0x24ab)](_0x7d8d7b(0x11de),_0x48e31a);}const _0x1d0005=_0x4450c7[_0x7d8d7b(0x1a84)]||_0x4450c7[_0x7d8d7b(0x1f8f)]||'你是'+_0x4450c7[_0x7d8d7b(0x222f)]+'。';let _0x36e1df='';const _0xf25bc0=await db[_0x7d8d7b(0xa1b)][_0x7d8d7b(0x4a6)](_0x7d8d7b(0x10df))[_0x7d8d7b(0x14a)](_0x4450c7['id'])[_0x7d8d7b(0x18c6)](),_0x2b9856=_0xf25bc0[_0x7d8d7b(0x803)](_0x9615cc=>_0x9615cc[_0x7d8d7b(0x77b)]&&_0x9615cc[_0x7d8d7b(0x77b)][_0x7d8d7b(0x23ec)](_0x50e4e2[_0x7d8d7b(0x222f)]));_0x2b9856['length']>0x0&&(_0x36e1df=_0x7d8d7b(0x2043)+_0x2b9856['map'](_0x429d2f=>_0x429d2f[_0x7d8d7b(0x77b)])[_0x7d8d7b(0x140c)]('；'));let _0x1c5520='';try{const _0x4a1a4a=await db[_0x7d8d7b(0x1733)][_0x7d8d7b(0x4a6)](_0x7d8d7b(0x2289))[_0x7d8d7b(0x14a)](parseInt(_0x374d02))['toArray']();if(_0x4a1a4a['length']>0x0){_0x4a1a4a[_0x7d8d7b(0x1f0d)]((_0x8deef3,_0x1b5196)=>_0x8deef3[_0x7d8d7b(0x7aa)]-_0x1b5196[_0x7d8d7b(0x7aa)]);const _0x3120f1=[];for(const _0x31663f of _0x4a1a4a){if(_0x31663f[_0x7d8d7b(0x3df)]===_0x7d8d7b(0x23b2)||_0x31663f[_0x7d8d7b(0x3df)]===_0x4450c7['id']||_0x31663f['authorId']===_0x50e4e2['id']){_0x3120f1[_0x7d8d7b(0x6ee)](_0x31663f);continue;}const _0x3ac2d7=characters[_0x7d8d7b(0x1aeb)](_0x499267=>_0x499267['id']===_0x31663f[_0x7d8d7b(0x3df)]);_0x3ac2d7&&areCharactersInSameGroup(_0x4450c7,_0x3ac2d7)&&_0x3120f1[_0x7d8d7b(0x6ee)](_0x31663f);}_0x3120f1[_0x7d8d7b(0xcbf)]>0x1&&(_0x1c5520='\x0a\x0a评论区讨论上下文：\x0a',_0x3120f1['forEach']((_0x17d1da,_0x2a0cd6)=>{const _0x2455ae=_0x7d8d7b,_0x46f286=_0x17d1da[_0x2455ae(0x3df)]===_0x2455ae(0x23b2)?'用户':_0x17d1da['nickname'];_0x1c5520+=_0x2a0cd6+0x1+'.\x20'+_0x46f286+':\x20'+_0x17d1da[_0x2455ae(0x1e58)]+'\x0a';}));}}catch(_0x1b7eab){console[_0x7d8d7b(0x24ab)](_0x7d8d7b(0xc42),_0x1b7eab);}let _0x500da6='';if(_0x3b4aa0?.['linkedWorldBookIds']&&_0x3b4aa0['linkedWorldBookIds']['length']>0x0)try{const _0x15c3d0=await Promise[_0x7d8d7b(0x2339)](_0x3b4aa0[_0x7d8d7b(0x1cee)]['map'](_0x3eaac7=>db[_0x7d8d7b(0x195c)][_0x7d8d7b(0x46a)](_0x3eaac7))),_0x32a611=_0x15c3d0[_0x7d8d7b(0x803)](_0x5f4d8c=>_0x5f4d8c&&_0x5f4d8c[_0x7d8d7b(0x1423)]);_0x32a611['length']>0x0&&(_0x500da6=_0x7d8d7b(0xd4c)+_0x32a611[_0x7d8d7b(0xf6d)](_0x32cba5=>_0x32cba5[_0x7d8d7b(0x222f)]+'：'+_0x32cba5[_0x7d8d7b(0x1423)])['join']('\x0a\x0a'));}catch(_0x1902ee){console[_0x7d8d7b(0x24ab)]('获取世界书内容失败:',_0x1902ee);}const _0xd088a9='你是'+_0x4450c7['name']+_0x7d8d7b(0x1da8)+_0x1d0005+'。'+_0x500da6+_0x36e1df+_0x1c5520+_0x7d8d7b(0x3e6)+_0x50e4e2[_0x7d8d7b(0x222f)]+_0x7d8d7b(0x61d)+_0x37e896[_0x7d8d7b(0x1e58)]+_0x7d8d7b(0x57f)+_0x270053[_0x7d8d7b(0x1e58)]+_0x7d8d7b(0x18df)+_0x4450c7['name']+_0x7d8d7b(0x352)+_0x50e4e2['name']+_0x7d8d7b(0x223a),{base:_0x5b1679,key:_0x206410,model:_0x468e03}=apiSettings;if(!_0x5b1679||!_0x206410||!_0x468e03){console[_0x7d8d7b(0xc0d)](_0x7d8d7b(0x11ac));return;}const _0x588050=[{'role':_0x7d8d7b(0x212),'content':_0xd088a9},{'role':'user','content':_0x7d8d7b(0x1076)}],_0xc55a6a={'model':_0x468e03,'messages':_0x588050,'temperature':0.8,'stream':![]},_0x16f2b6=new AbortController(),_0x301c16=setTimeout(()=>_0x16f2b6[_0x7d8d7b(0x135b)](),0x7530),_0x2b640a=_0x5b1679[_0x7d8d7b(0x23ec)]('generativelanguage.googleapis.com');let _0x597708;if(_0x2b640a){const _0xc07bcc=_0x5b1679+'/models/'+_0x468e03+_0x7d8d7b(0x23aa)+_0x206410,_0x3f68d0=[];_0xc55a6a[_0x7d8d7b(0x1767)][0x0]?.[_0x7d8d7b(0x1562)]===_0x7d8d7b(0x212)&&(_0x3f68d0[_0x7d8d7b(0x6ee)]({'role':_0x7d8d7b(0x23b2),'parts':[{'text':_0xc55a6a[_0x7d8d7b(0x1767)][0x0]['content']}]}),_0x3f68d0[_0x7d8d7b(0x6ee)]({'role':'model','parts':[{'text':'我明白了，我会按照这些要求进行回复。'}]}));for(let _0x172de0=0x1;_0x172de0<_0xc55a6a['messages'][_0x7d8d7b(0xcbf)];_0x172de0++){const _0x31662f=_0xc55a6a[_0x7d8d7b(0x1767)][_0x172de0];if(_0x31662f[_0x7d8d7b(0x1562)]===_0x7d8d7b(0x212))continue;_0x3f68d0['push']({'role':_0x31662f[_0x7d8d7b(0x1562)]===_0x7d8d7b(0x23b2)?_0x7d8d7b(0x23b2):_0x7d8d7b(0xeea),'parts':[{'text':_0x31662f[_0x7d8d7b(0x1423)]}]});}_0x597708=await fetch(_0xc07bcc,{'method':'POST','headers':{'Content-Type':_0x7d8d7b(0x302)},'body':JSON[_0x7d8d7b(0x7fb)]({'contents':_0x3f68d0,'generationConfig':{'temperature':_0xc55a6a[_0x7d8d7b(0x2b0)]||0.8}}),'signal':_0x16f2b6[_0x7d8d7b(0x11f5)]});}else{let _0x19f08c;if(_0x5b1679['endsWith'](_0x7d8d7b(0x812)))_0x19f08c=_0x5b1679+_0x7d8d7b(0xb73);else _0x5b1679[_0x7d8d7b(0x23ec)](_0x7d8d7b(0x193c))?_0x19f08c=_0x5b1679+_0x7d8d7b(0xb73):_0x19f08c=_0x5b1679+_0x7d8d7b(0xce8);_0x597708=await fetch(_0x19f08c,{'method':_0x7d8d7b(0x227d),'headers':{'Content-Type':_0x7d8d7b(0x302),'Authorization':'Bearer\x20'+_0x206410},'body':JSON['stringify'](_0xc55a6a),'signal':_0x16f2b6['signal']});}clearTimeout(_0x301c16);if(!_0x597708['ok']){console[_0x7d8d7b(0x24ab)](_0x7d8d7b(0xbf8)+_0x597708[_0x7d8d7b(0xe54)]+')');return;}const _0x46c808=await _0x597708[_0x7d8d7b(0x2318)]();let _0x239cf7;_0x2b640a?_0x239cf7=_0x46c808[_0x7d8d7b(0x1d23)]?.[0x0]?.[_0x7d8d7b(0x1423)]?.['parts']?.[0x0]?.[_0x7d8d7b(0x1e58)]:_0x239cf7=_0x46c808[_0x7d8d7b(0x13cf)]?.[0x0]?.[_0x7d8d7b(0xd7a)]?.[_0x7d8d7b(0x1423)]||_0x46c808[_0x7d8d7b(0xd7a)]||_0x46c808[_0x7d8d7b(0x1e58)]||_0x46c808['response']||_0x46c808[_0x7d8d7b(0x1423)]||_0x46c808[_0x7d8d7b(0x1fff)];if(_0x239cf7&&_0x239cf7[_0x7d8d7b(0x1424)]()['length']>0x0){const _0x26a950=_0x239cf7[_0x7d8d7b(0x1424)](),_0x37875={'id':Date[_0x7d8d7b(0x18e0)]()+Math[_0x7d8d7b(0x191c)](),'nickname':_0x4450c7['name'],'avatar':_0x4450c7[_0x7d8d7b(0x10f9)],'text':_0x26a950,'time':formatTime(new Date()),'timestamp':Date[_0x7d8d7b(0x18e0)](),'characterId':_0x4450c7['id'],'replyTo':_0x50e4e2[_0x7d8d7b(0x222f)]};await saveCommentToMoment(_0x374d02,_0x37875),await updateMomentCommentCount(_0x374d02),displayCommentUnderMoment(_0x374d02,_0x37875),await recordMemoryEvent([_0x4450c7['id']],{'type':_0x7d8d7b(0x1a72),'id':'moments'},_0x7d8d7b(0x18c),_0x7d8d7b(0x1c01)+_0x50e4e2[_0x7d8d7b(0x222f)]+_0x7d8d7b(0xc08)+_0x26a950);const _0xe97866=_0x374d02+'-'+_0x4450c7[_0x7d8d7b(0x222f)]+'-'+_0x50e4e2['name'],_0x1ffe1e=commentConversationRounds[_0x7d8d7b(0x46a)](_0xe97866)||0x0;commentConversationRounds[_0x7d8d7b(0x21c0)](_0xe97866,_0x1ffe1e+0x1),console['log'](_0x4450c7['name']+_0x7d8d7b(0x3c1)+_0x50e4e2[_0x7d8d7b(0x222f)]+_0x7d8d7b(0x1e84)+_0x374d02+_0x7d8d7b(0xb22)+(_0x1ffe1e+0x1)+'/3'),console[_0x7d8d7b(0xc0d)](_0x4450c7[_0x7d8d7b(0x222f)]+_0x7d8d7b(0x21ae)+_0x50e4e2[_0x7d8d7b(0x222f)]+'：'+_0x26a950);}}catch(_0x6ffa8b){console[_0x7d8d7b(0x24ab)](_0x7d8d7b(0x18e4),_0x6ffa8b);}}async function generateAiToAiReply(_0x3fba19,_0x51f835,_0x796ffe,_0x587fbe){return await generateAiToAiReplyWithMemory(_0x3fba19,_0x51f835,_0x796ffe,_0x587fbe);}async function generateAiToAiReplyOld(_0x1f1c81,_0x11fdbc,_0x17a0e6,_0x5a0655){const _0x34dd10=_0x2cf6d4;try{const _0xee4114=JSON[_0x34dd10(0x168e)](sessionStorage[_0x34dd10(0x2250)]('momentsData')||'[]'),_0x5e4c37=_0xee4114['find'](_0x546082=>_0x546082['id']==_0x1f1c81||_0x546082[_0x34dd10(0x7aa)]==_0x1f1c81);if(!_0x5e4c37)return;const _0x754977=_0x5a0655[_0x34dd10(0x1f8f)]||'',_0x4f4969=_0x34dd10(0x1b74)+_0x5a0655[_0x34dd10(0x222f)]+_0x34dd10(0x1ea0)+_0x754977+_0x34dd10(0x142b)+_0x11fdbc[_0x34dd10(0x1e58)]+'\x22。\x0a\x0a原动态内容：'+_0x5e4c37['text']+'\x0a\x0a你要作为'+_0x17a0e6[_0x34dd10(0x222f)]+_0x34dd10(0x22d6)+_0x5a0655[_0x34dd10(0x222f)]+_0x34dd10(0x2503)+_0x5a0655[_0x34dd10(0x222f)]+'之间的互动关系\x0a5.\x20回复简短有趣，符合社交媒体的特点\x0a6.\x20根据你的人设选择合适的语气和用词\x0a7.\x20不要使用与角色性格不符的表情符号\x0a\x0a请回复'+_0x5a0655[_0x34dd10(0x222f)]+'的评论：';await recordCrossAppEvent(_0x17a0e6['id'],_0x34dd10(0x1a72),_0x34dd10(0x18c),{'targetCharacter':_0x5a0655[_0x34dd10(0x222f)],'originalComment':_0x11fdbc['text'],'momentContent':_0x5e4c37[_0x34dd10(0x1e58)]});const _0x111e33=await callChatAPI(_0x4f4969,_0x17a0e6),_0x339562=Array[_0x34dd10(0x1bcc)](_0x111e33)?_0x111e33[0x0]:_0x111e33;if(_0x339562&&_0x339562[_0x34dd10(0x1424)]()){const _0x143006={'id':Date[_0x34dd10(0x18e0)]()+Math['random'](),'nickname':_0x17a0e6[_0x34dd10(0x222f)],'avatar':_0x17a0e6['avatarUrl'],'text':_0x339562['trim'](),'time':formatTime(new Date()),'timestamp':Date[_0x34dd10(0x18e0)](),'replyTo':_0x5a0655[_0x34dd10(0x222f)],'characterId':_0x17a0e6['id']};saveCommentToMoment(_0x1f1c81,_0x143006),updateMomentCommentCount(_0x1f1c81),displayCommentUnderMoment(_0x1f1c81,_0x143006),showToast(_0x17a0e6[_0x34dd10(0x222f)]+_0x34dd10(0x21ae)+_0x5a0655[_0x34dd10(0x222f)]);}}catch(_0x506bd0){console[_0x34dd10(0x24ab)](_0x34dd10(0x18e4),_0x506bd0);}}async function triggerAIReplyToUser(_0x2bd19a,_0xa55c21,_0x403e13){const _0x14ebac=_0x2cf6d4;try{console[_0x14ebac(0xc0d)]('triggerAIReplyToUser被调用:\x20momentId='+_0x2bd19a+_0x14ebac(0xb4a)+_0xa55c21+',\x20userCommentText=\x22'+_0x403e13+'\x22');const _0x3d1aca=characters['find'](_0xb5ef82=>_0xb5ef82[_0x14ebac(0x222f)]===_0xa55c21);if(!_0x3d1aca){console[_0x14ebac(0xc0d)](_0x14ebac(0x19eb)+_0xa55c21+'，可用角色:',characters['map'](_0x3d6bf5=>_0x3d6bf5[_0x14ebac(0x222f)]));return;}const _0x1da243=await db[_0x14ebac(0x1a72)][_0x14ebac(0x46a)](parseInt(_0x2bd19a));if(!_0x1da243){console[_0x14ebac(0xc0d)]('未找到动态\x20'+_0x2bd19a);return;}const _0x2df85c=_0x14ebac(0xf41)+_0x403e13+'\x22。\x0a\x0a原动态内容：'+_0x1da243[_0x14ebac(0x1e58)]+_0x14ebac(0x18df)+_0x3d1aca[_0x14ebac(0x222f)]+'，基于你的人设对用户的回复做出自然的反应。要求：\x0a1.\x20严格按照你的人设进行回复，保持角色一致性\x0a2.\x20回复要自然、符合朋友圈评论风格，简短有趣\x0a3.\x20可以是继续讨论、表达感谢、开玩笑或者分享更多想法\x0a4.\x20体现出你和用户之间的友好互动\x0a5.\x20根据你的人设选择合适的语气和用词\x0a6.\x20不要使用与角色性格不符的表情符号\x0a\x0a🚨\x20**重要格式要求**：\x0a-\x20直接输出你的回复文本，不要使用JSON格式\x0a-\x20不要包含任何特殊标记或格式符号\x0a-\x20只输出你想说的话，10-30字左右\x0a\x0a请回复用户的评论：';await recordCrossAppEvent(_0x3d1aca['id'],'moments',_0x14ebac(0x1b3f),{'userComment':_0x403e13,'momentContent':_0x1da243[_0x14ebac(0x1e58)]}),await logMemoryUsageStats(_0x3d1aca,_0x14ebac(0x1907));const _0x3bd4a2=await callChatAPI(_0x2df85c,_0x3d1aca);let _0x4eeed4;if(Array[_0x14ebac(0x1bcc)](_0x3bd4a2)){const _0xcd507a=_0x3bd4a2[0x0];if(typeof _0xcd507a===_0x14ebac(0xb97))_0x4eeed4=_0xcd507a;else{if(typeof _0xcd507a==='object'&&_0xcd507a[_0x14ebac(0x1423)])_0x4eeed4=_0xcd507a[_0x14ebac(0x1423)];else typeof _0xcd507a===_0x14ebac(0x3c4)&&_0xcd507a['message']?_0x4eeed4=_0xcd507a[_0x14ebac(0xd7a)]:_0x4eeed4=String(_0xcd507a);}}else _0x4eeed4=_0x3bd4a2;console['log'](_0x14ebac(0xee6)+_0x3d1aca['name']+'，准备生成回复');if(_0x4eeed4&&_0x4eeed4[_0x14ebac(0x1424)]()){const _0xef4ae3={'id':Date[_0x14ebac(0x18e0)]()+Math[_0x14ebac(0x191c)](),'nickname':_0x3d1aca[_0x14ebac(0x222f)],'avatar':_0x3d1aca[_0x14ebac(0x10f9)],'text':_0x4eeed4['trim'](),'time':formatTime(new Date()),'timestamp':Date[_0x14ebac(0x18e0)](),'replyTo':'我','characterId':_0x3d1aca['id']};saveCommentToMoment(_0x2bd19a,_0xef4ae3),updateMomentCommentCount(_0x2bd19a),displayCommentUnderMoment(_0x2bd19a,_0xef4ae3);const _0x340400=_0x2bd19a+'-'+_0x3d1aca[_0x14ebac(0x222f)],_0x23efb7=commentConversationRounds['get'](_0x340400)||0x0;commentConversationRounds[_0x14ebac(0x21c0)](_0x340400,_0x23efb7+0x1),console[_0x14ebac(0xc0d)](_0x3d1aca['name']+'\x20在动态\x20'+_0x2bd19a+_0x14ebac(0xccb)+(_0x23efb7+0x1)+'/3'),showToast(_0x3d1aca[_0x14ebac(0x222f)]+_0x14ebac(0x12bb)),createPushNotification(_0x3d1aca,_0x14ebac(0xcc0)+(_0x4eeed4[_0x14ebac(0x1424)]()['length']>0xf?_0x4eeed4[_0x14ebac(0x1424)]()[_0x14ebac(0x4b2)](0x0,0xf)+_0x14ebac(0x12da):_0x4eeed4[_0x14ebac(0x1424)]()),0xc8);}}catch(_0xbe00ce){console[_0x14ebac(0x24ab)]('AI回复用户失败:',_0xbe00ce);}}async function generateCharacterCommentWithMemory(_0x5a00f8,_0x277220){const _0x3c04f7=_0x2cf6d4;try{console['log'](_0x5a00f8[_0x3c04f7(0x222f)]+_0x3c04f7(0x1f8)+(_0x277220[_0x3c04f7(0x201a)]||_0x277220['authorId']));const _0x30371d=_0x5a00f8[_0x3c04f7(0x1a84)]||_0x5a00f8['prompt']||'你是'+_0x5a00f8[_0x3c04f7(0x222f)]+'。';console['log'](_0x3c04f7(0x234c)+_0x30371d[_0x3c04f7(0x4b2)](0x0,0x32)+_0x3c04f7(0x12da));let _0xf6f205='';if(chatSettings?.['linkedWorldBookIds']&&chatSettings['linkedWorldBookIds'][_0x3c04f7(0xcbf)]>0x0)try{const _0xaf972e=await Promise[_0x3c04f7(0x2339)](chatSettings[_0x3c04f7(0x1cee)][_0x3c04f7(0xf6d)](_0x2a6be2=>db[_0x3c04f7(0x195c)]['get'](_0x2a6be2))),_0x5917a2=_0xaf972e[_0x3c04f7(0x803)](_0x34b638=>_0x34b638&&_0x34b638[_0x3c04f7(0x1423)]);_0x5917a2[_0x3c04f7(0xcbf)]>0x0&&(_0xf6f205=_0x3c04f7(0xd4c)+_0x5917a2[_0x3c04f7(0xf6d)](_0x2a6f2b=>_0x2a6f2b[_0x3c04f7(0x222f)]+'：'+_0x2a6f2b['content'])[_0x3c04f7(0x140c)]('\x0a\x0a'));}catch(_0x57836c){console[_0x3c04f7(0x24ab)](_0x3c04f7(0xf5c),_0x57836c);}let _0x48479f='';try{const _0x4392a6=await db[_0x3c04f7(0xa1b)][_0x3c04f7(0x4a6)](_0x3c04f7(0x10df))['equals'](_0x5a00f8['id'])['toArray'](),_0x5131b8=_0x4392a6['filter'](_0x4d98a7=>_0x4d98a7[_0x3c04f7(0x23df)]===_0x3c04f7(0x22c1))[_0x3c04f7(0x1f0d)]((_0x5aba77,_0x5dafea)=>_0x5dafea['importance']-_0x5aba77[_0x3c04f7(0x3d1)])['slice'](0x0,0x5);_0x5131b8[_0x3c04f7(0xcbf)]>0x0&&(_0x48479f+=_0x3c04f7(0x710),_0x5131b8['forEach']((_0x2b2915,_0x2d1380)=>{const _0x22e5da=_0x3c04f7;_0x48479f+=_0x2d1380+0x1+'.\x20'+_0x2b2915[_0x22e5da(0x77b)]+'\x0a';}));const _0x58c7c8=await db[_0x3c04f7(0x222e)][_0x3c04f7(0x4a6)](_0x3c04f7(0x10df))['equals'](_0x5a00f8['id'])[_0x3c04f7(0x18c6)](),_0x5bbd7c=_0x58c7c8[_0x3c04f7(0x1f0d)]((_0x1a6ac4,_0x2d2454)=>_0x2d2454['timestamp']-_0x1a6ac4[_0x3c04f7(0x7aa)])[_0x3c04f7(0x136)](0x0,0x3);_0x5bbd7c[_0x3c04f7(0xcbf)]>0x0&&(_0x48479f+=_0x3c04f7(0x188b),_0x5bbd7c[_0x3c04f7(0x900)]((_0x1cfe0a,_0x104473)=>{const _0x2df9bf=_0x3c04f7;_0x48479f+=_0x104473+0x1+'.\x20'+_0x1cfe0a[_0x2df9bf(0x77b)]+'\x0a';}));}catch(_0x38dd95){console[_0x3c04f7(0x24ab)](_0x3c04f7(0xc75),_0x38dd95);}let _0x142dc1='';const _0x140020=chatMessages[_0x5a00f8['id']]||[];if(_0x140020['length']>0x0){const _0x34b75b=_0x140020[_0x3c04f7(0x136)](-0xa);_0x34b75b['length']>0x0&&(_0x142dc1=_0x3c04f7(0x1f6d),_0x34b75b['forEach'](_0x48f859=>{const _0x40a4a0=_0x3c04f7;let _0x435e38='';if(typeof _0x48f859[_0x40a4a0(0x1423)]==='string')_0x435e38=_0x48f859[_0x40a4a0(0x1423)];else typeof _0x48f859[_0x40a4a0(0x1423)]===_0x40a4a0(0x3c4)&&_0x48f859[_0x40a4a0(0x1423)]!==null?_0x435e38=_0x48f859[_0x40a4a0(0x1423)][_0x40a4a0(0x1e58)]||_0x48f859['content'][_0x40a4a0(0xd7a)]||JSON['stringify'](_0x48f859[_0x40a4a0(0x1423)]):_0x435e38=String(_0x48f859[_0x40a4a0(0x1423)]||'');if(_0x48f859[_0x40a4a0(0xf75)]==='sent')_0x142dc1+=_0x40a4a0(0x6b8)+_0x435e38+'\x0a';else _0x48f859[_0x40a4a0(0xf75)]===_0x40a4a0(0x232)&&(_0x142dc1+=_0x40a4a0(0xe99)+_0x435e38+'\x0a');}),_0x142dc1+=_0x3c04f7(0x16ab));}const _0x1971d7=_0x277220['text']||'';let _0x14e28b='用户';const _0x160cc9=_0x277220[_0x3c04f7(0x3df)]==='user';if(!_0x160cc9){const _0x2f4220=characters[_0x3c04f7(0x1aeb)](_0x10ed4b=>_0x10ed4b['id']===_0x277220[_0x3c04f7(0x10df)]||_0x10ed4b['id']===_0x277220[_0x3c04f7(0x3df)]);_0x2f4220?(_0x14e28b=_0x2f4220[_0x3c04f7(0x222f)],console[_0x3c04f7(0xc0d)](_0x3c04f7(0x483)+_0x2f4220[_0x3c04f7(0x222f)]+_0x3c04f7(0x192)+_0x2f4220['id']+')')):(_0x14e28b=_0x277220[_0x3c04f7(0x201a)]||_0x3c04f7(0x13e4),console[_0x3c04f7(0xc0d)]('🔍\x20[身份确认]\x20未找到发布者角色，使用昵称:\x20'+_0x14e28b));}else console['log'](_0x3c04f7(0x44d));console['log'](_0x3c04f7(0xed)+_0x14e28b+'\x20(authorId:\x20'+_0x277220[_0x3c04f7(0x3df)]+')'),console[_0x3c04f7(0xc0d)](_0x3c04f7(0x1c60)+_0x160cc9);let _0x366ca4='',_0x4b0291=!![],_0x2493fa=![],_0x9efe8b=![],_0x2605ae=![];if(!_0x160cc9){const _0x99b877=characters['find'](_0x24a9a2=>_0x24a9a2['id']===_0x277220[_0x3c04f7(0x10df)]||_0x24a9a2['id']===_0x277220[_0x3c04f7(0x3df)]);console[_0x3c04f7(0xc0d)](_0x5a00f8[_0x3c04f7(0x222f)]+'\x20正在分析与动态发布者的关系，发布者:',_0x99b877?.[_0x3c04f7(0x222f)]||'未找到'),console['log'](_0x3c04f7(0x40a),_0x99b877);if(_0x99b877){const _0x5d917c=(_0x30371d||'')[_0x3c04f7(0x1d64)](),_0x3f0ef3=_0x99b877[_0x3c04f7(0x222f)][_0x3c04f7(0x1d64)]();console['log'](_0x3c04f7(0x1b52)+_0x5a00f8['name']+_0x3c04f7(0x1b39)+_0x99b877[_0x3c04f7(0x222f)]+_0x3c04f7(0x1c1a)),console[_0x3c04f7(0xc0d)](_0x3c04f7(0x7ac)+_0x5d917c);let _0x138ee3='';const _0x117db6=chatMessages[_0x5a00f8['id']]||[],_0x2b9c7f=_0x117db6[_0x3c04f7(0x803)](_0x40d765=>_0x40d765['content']&&_0x40d765[_0x3c04f7(0x1423)][_0x3c04f7(0x23ec)](_0x99b877['name']))[_0x3c04f7(0x136)](-0x2);_0x2b9c7f[_0x3c04f7(0xcbf)]>0x0&&(_0x138ee3=_0x3c04f7(0x21c1),_0x2b9c7f[_0x3c04f7(0x900)](_0x39f392=>{const _0x222e25=_0x3c04f7;_0x138ee3+='-\x20你曾说：'+_0x39f392[_0x222e25(0x1423)]['substring'](0x0,0x3c)+_0x222e25(0x230a);}),_0x138ee3+=_0x3c04f7(0x12b8));let _0x268c09='';try{const _0xb69ed1=await db[_0x3c04f7(0x1733)][_0x3c04f7(0x4a6)]('authorId')[_0x3c04f7(0x14a)](_0x5a00f8['id'])['limit'](0x5)[_0x3c04f7(0x18c6)]();_0xb69ed1[_0x3c04f7(0xcbf)]>0x0&&(_0x268c09=_0x3c04f7(0x2281),_0x268c09+=_0x3c04f7(0x19bd)+_0xb69ed1[0x0]['text']+'\x0a',_0x268c09+=_0x3c04f7(0x8f3));}catch(_0x3e1835){console[_0x3c04f7(0x24ab)](_0x3c04f7(0x17bc),_0x3e1835);}const _0xbe9eff=['情敌','敌人','讨厌',_0x3c04f7(0xbe),'竞争','对手','吵架','争执','矛盾','仇人','冷战','不和',_0x3c04f7(0x23a7),'警惕','提防','防备'],_0x1ab70b=['朋友','好友','闺蜜','兄弟','姐妹','恋人','喜欢','爱','亲密','信任','依赖','关心','在乎'],_0x564ab6=['同学','同事','室友','邻居','认识','同班'],_0x599c91=_0x5d917c[_0x3c04f7(0x167a)](_0x3f0ef3);if(_0x599c91!==-0x1){const _0x503e08=Math[_0x3c04f7(0x910)](0x0,_0x599c91-0x1e),_0x327ebe=Math[_0x3c04f7(0x21f7)](_0x5d917c[_0x3c04f7(0xcbf)],_0x599c91+_0x3f0ef3[_0x3c04f7(0xcbf)]+0x1e),_0x42db95=_0x5d917c['substring'](_0x503e08,_0x327ebe);console[_0x3c04f7(0xc0d)](_0x3c04f7(0x149a)+_0x42db95),_0x2493fa=_0xbe9eff[_0x3c04f7(0x184b)](_0x466ec6=>_0x42db95[_0x3c04f7(0x23ec)](_0x466ec6)),_0x9efe8b=_0x1ab70b[_0x3c04f7(0x184b)](_0x2c17b3=>_0x42db95[_0x3c04f7(0x23ec)](_0x2c17b3)),_0x2605ae=_0x564ab6[_0x3c04f7(0x184b)](_0x25428e=>_0x42db95[_0x3c04f7(0x23ec)](_0x25428e)),console['log'](_0x3c04f7(0x3a8)+_0x2493fa+_0x3c04f7(0x778)+_0x9efe8b+_0x3c04f7(0x1cb2)+_0x2605ae);}else console['log']('在人设中未找到发布者名字\x20\x22'+_0x3f0ef3+'\x22，按默认社交模式处理'),_0x2493fa=![],_0x9efe8b=![],_0x2605ae=![],console['log'](_0x3c04f7(0x16cf));if(_0x2493fa)_0x366ca4=_0x3c04f7(0xadc)+_0x99b877[_0x3c04f7(0x222f)]+_0x3c04f7(0x958)+_0x138ee3+_0x268c09+_0x3c04f7(0x134f),_0x4b0291=Math[_0x3c04f7(0x191c)]()<0.4;else{if(_0x9efe8b)_0x366ca4='\x0a\x0a💕\x20**关系状态**：你与'+_0x99b877[_0x3c04f7(0x222f)]+_0x3c04f7(0x2088)+_0x138ee3+_0x268c09+_0x3c04f7(0x4df);else _0x2605ae?_0x366ca4=_0x3c04f7(0x1daa)+_0x99b877['name']+_0x3c04f7(0x1b68)+_0x138ee3+_0x268c09+_0x3c04f7(0x1d8f):_0x366ca4=_0x3c04f7(0x133f)+_0x99b877[_0x3c04f7(0x222f)]+'自然互动。'+_0x138ee3+_0x268c09+_0x3c04f7(0xbdf);}}}if(!_0x4b0291)return console[_0x3c04f7(0xc0d)](_0x5a00f8[_0x3c04f7(0x222f)]+_0x3c04f7(0xb60)+_0x14e28b+_0x3c04f7(0xe24)),[];console['log'](_0x5a00f8[_0x3c04f7(0x222f)]+'\x20决定评论这条动态，开始生成评论内容...');let _0x15a43b='';try{const _0x53c967=await db[_0x3c04f7(0x1733)]['where'](_0x3c04f7(0x2289))[_0x3c04f7(0x14a)](_0x277220['id'])[_0x3c04f7(0x18c6)]();if(_0x53c967[_0x3c04f7(0xcbf)]>0x0){_0x53c967[_0x3c04f7(0x1f0d)]((_0x1ba921,_0x3ce0ce)=>_0x1ba921[_0x3c04f7(0x7aa)]-_0x3ce0ce[_0x3c04f7(0x7aa)]);const _0xd8baff=[];for(const _0x252e7d of _0x53c967){if(_0x252e7d[_0x3c04f7(0x3df)]==='user'){_0xd8baff[_0x3c04f7(0x6ee)](_0x252e7d);continue;}if(_0x252e7d['authorId']===_0x5a00f8['id']){_0xd8baff[_0x3c04f7(0x6ee)](_0x252e7d);continue;}if(_0x252e7d[_0x3c04f7(0x3df)]){const _0x14596b=characters[_0x3c04f7(0x1aeb)](_0x72a8d1=>_0x72a8d1['id']===_0x252e7d[_0x3c04f7(0x3df)]);_0x14596b&&areCharactersInSameGroup(_0x5a00f8,_0x14596b)&&_0xd8baff['push'](_0x252e7d);}}_0xd8baff[_0x3c04f7(0xcbf)]>0x0&&(_0x15a43b='\x0a\x0a📝\x20**评论区现有讨论**：\x0a',_0xd8baff['forEach']((_0x3c16ab,_0x32c912)=>{const _0x1baa44=_0x3c04f7,_0x35f5e6=_0x3c16ab[_0x1baa44(0x3df)]===_0x1baa44(0x23b2)?'用户':_0x3c16ab['nickname'];_0x15a43b+=_0x32c912+0x1+'.\x20'+_0x35f5e6+':\x20'+_0x3c16ab[_0x1baa44(0x1e58)]+'\x0a';}),_0x15a43b+=_0x3c04f7(0x1200));}}catch(_0x37352b){console['error'](_0x3c04f7(0x179),_0x37352b);}let _0x4e424b='';const _0x27f0e0=(_0x5a00f8[_0x3c04f7(0x1a84)]||'')['toLowerCase']();if(_0x27f0e0[_0x3c04f7(0x23ec)]('活泼')||_0x27f0e0['includes']('开朗')||_0x27f0e0['includes']('外向'))_0x4e424b='热情活泼，用词轻松有趣';else{if(_0x27f0e0[_0x3c04f7(0x23ec)]('冷静')||_0x27f0e0[_0x3c04f7(0x23ec)]('理性')||_0x27f0e0[_0x3c04f7(0x23ec)]('严谨'))_0x4e424b=_0x3c04f7(0xa7d);else{if(_0x27f0e0['includes']('温柔')||_0x27f0e0[_0x3c04f7(0x23ec)]('善良')||_0x27f0e0['includes']('体贴'))_0x4e424b=_0x3c04f7(0x13d);else{if(_0x27f0e0[_0x3c04f7(0x23ec)]('幽默')||_0x27f0e0[_0x3c04f7(0x23ec)]('搞笑')||_0x27f0e0[_0x3c04f7(0x23ec)]('风趣'))_0x4e424b=_0x3c04f7(0xddf);else _0x27f0e0[_0x3c04f7(0x23ec)]('内向')||_0x27f0e0[_0x3c04f7(0x23ec)]('安静')||_0x27f0e0[_0x3c04f7(0x23ec)]('害羞')?_0x4e424b=_0x3c04f7(0x1388):_0x4e424b=_0x3c04f7(0x317);}}}let _0x25bcdf='你是'+_0x5a00f8[_0x3c04f7(0x222f)]+_0x3c04f7(0x1da8)+_0x30371d+'。'+_0xf6f205+_0x48479f+_0x142dc1+_0x366ca4+_0x15a43b+_0x3c04f7(0x800)+_0x14e28b+_0x3c04f7(0x60d)+_0x1971d7+_0x3c04f7(0xba3)+(_0x2493fa?_0x3c04f7(0xae3):_0x9efe8b?_0x3c04f7(0x2317):_0x2605ae?_0x3c04f7(0x237d):_0x3c04f7(0x9f))+_0x3c04f7(0x945)+_0x4e424b+_0x3c04f7(0x96f)+_0x5a00f8[_0x3c04f7(0x222f)]+_0x3c04f7(0xc1f);console[_0x3c04f7(0xc0d)](_0x3c04f7(0x6b0)+_0x5a00f8[_0x3c04f7(0x222f)]+_0x3c04f7(0xd3)),console['log']('='[_0x3c04f7(0x18bf)](0x50)),console['log'](_0x25bcdf),console['log']('='['repeat'](0x50));let _0x1aea12=_0x3c04f7(0x1dda)+_0x1971d7,_0x1b6978=_0x277220[_0x3c04f7(0x21d6)]&&_0x277220[_0x3c04f7(0x21d6)][_0x3c04f7(0xcbf)]>0x0;_0x1b6978&&(_0x1aea12+=_0x3c04f7(0x19fe)+_0x277220[_0x3c04f7(0x21d6)][_0x3c04f7(0xcbf)]+_0x3c04f7(0xb7e));const _0x540c5f=_0x1aea12+_0x3c04f7(0x2313),_0x2a0fca=isVisionModelSupported();let _0x3d9b14;if(_0x1b6978&&_0x2a0fca){const _0x3febad=_0x277220[_0x3c04f7(0x21d6)][0x0];console[_0x3c04f7(0xc0d)]('为角色\x20'+_0x5a00f8[_0x3c04f7(0x222f)]+'\x20使用图片识别功能评论动态'),_0x3d9b14=[{'role':_0x3c04f7(0x212),'content':_0x25bcdf},{'role':_0x3c04f7(0x23b2),'content':[{'type':'text','text':'原动态文字：'+_0x1971d7+'\x0a\x0a这条动态还包含了一张图片，请仔细观察图片内容，然后发表你的看法：'},{'type':_0x3c04f7(0x1cfa),'image_url':{'url':_0x3febad}}]}];}else{if(_0x1b6978&&!_0x2a0fca){console[_0x3c04f7(0xc0d)]('当前模型不支持图片识别，'+_0x5a00f8[_0x3c04f7(0x222f)]+'\x20将基于文字内容评论');const _0x44d4d9=_0x1aea12+_0x3c04f7(0x225f);_0x3d9b14=[{'role':_0x3c04f7(0x212),'content':_0x25bcdf},{'role':_0x3c04f7(0x23b2),'content':_0x44d4d9}];}else _0x3d9b14=[{'role':_0x3c04f7(0x212),'content':_0x25bcdf},{'role':_0x3c04f7(0x23b2),'content':_0x540c5f}];}const {base:_0x340fdc,key:_0x5b3d5f,model:_0x3cee88}=apiSettings;if(!_0x340fdc||!_0x5b3d5f||!_0x3cee88)return console['log'](_0x3c04f7(0x1533)),[];const _0x2c6fd7={'model':_0x3cee88,'messages':_0x3d9b14,'temperature':0.8,'stream':![]},_0x1b91cb=new AbortController(),_0x33a0a9=setTimeout(()=>_0x1b91cb['abort'](),0xea60),_0x2f44c2=_0x340fdc[_0x3c04f7(0x23ec)](_0x3c04f7(0xad8));let _0x518b49;if(_0x2f44c2){const _0x11dc83=_0x340fdc+'/models/'+_0x3cee88+_0x3c04f7(0x23aa)+_0x5b3d5f,_0x662c55=[];_0x2c6fd7[_0x3c04f7(0x1767)][0x0]?.['role']===_0x3c04f7(0x212)&&(_0x662c55[_0x3c04f7(0x6ee)]({'role':'user','parts':[{'text':_0x2c6fd7[_0x3c04f7(0x1767)][0x0][_0x3c04f7(0x1423)]}]}),_0x662c55[_0x3c04f7(0x6ee)]({'role':_0x3c04f7(0xeea),'parts':[{'text':_0x3c04f7(0x13c8)}]}));for(let _0x3e1f4f=0x1;_0x3e1f4f<_0x2c6fd7[_0x3c04f7(0x1767)][_0x3c04f7(0xcbf)];_0x3e1f4f++){const _0x405a1e=_0x2c6fd7['messages'][_0x3e1f4f];if(_0x405a1e[_0x3c04f7(0x1562)]===_0x3c04f7(0x212))continue;if(Array[_0x3c04f7(0x1bcc)](_0x405a1e['content'])){const _0x36cfcb=[];_0x405a1e[_0x3c04f7(0x1423)][_0x3c04f7(0x900)](_0x2c9fa6=>{const _0x3fd17f=_0x3c04f7;if(_0x2c9fa6[_0x3fd17f(0x23df)]===_0x3fd17f(0x1e58))_0x36cfcb[_0x3fd17f(0x6ee)]({'text':_0x2c9fa6['text']});else{if(_0x2c9fa6['type']==='image_url'){const _0x200fd2=_0x2c9fa6[_0x3fd17f(0x1cfa)][_0x3fd17f(0x10c6)];if(_0x200fd2['startsWith']('data:')){const [_0x421da6,_0x524055]=_0x200fd2[_0x3fd17f(0x633)](','),_0x24edda=_0x421da6[_0x3fd17f(0x1316)](/data:([^;]+)/)?.[0x1]||_0x3fd17f(0xf4f);_0x36cfcb[_0x3fd17f(0x6ee)]({'inline_data':{'mime_type':_0x24edda,'data':_0x524055}});}else _0x36cfcb[_0x3fd17f(0x6ee)]({'text':_0x3fd17f(0x1447)+_0x200fd2+']'});}}}),_0x662c55[_0x3c04f7(0x6ee)]({'role':_0x405a1e[_0x3c04f7(0x1562)]===_0x3c04f7(0x23b2)?_0x3c04f7(0x23b2):_0x3c04f7(0xeea),'parts':_0x36cfcb});}else _0x662c55[_0x3c04f7(0x6ee)]({'role':_0x405a1e['role']===_0x3c04f7(0x23b2)?'user':_0x3c04f7(0xeea),'parts':[{'text':_0x405a1e[_0x3c04f7(0x1423)]}]});}_0x518b49=await fetch(_0x11dc83,{'method':'POST','headers':{'Content-Type':_0x3c04f7(0x302)},'body':JSON[_0x3c04f7(0x7fb)]({'contents':_0x662c55,'generationConfig':{'temperature':_0x2c6fd7[_0x3c04f7(0x2b0)]||0.8}}),'signal':_0x1b91cb[_0x3c04f7(0x11f5)]});}else{let _0x5df05f;if(_0x340fdc[_0x3c04f7(0xd7e)]('/v1'))_0x5df05f=_0x340fdc+'/chat/completions';else _0x340fdc['includes'](_0x3c04f7(0x193c))?_0x5df05f=_0x340fdc+_0x3c04f7(0xb73):_0x5df05f=_0x340fdc+_0x3c04f7(0xce8);_0x518b49=await fetch(_0x5df05f,{'method':'POST','headers':{'Content-Type':_0x3c04f7(0x302),'Authorization':_0x3c04f7(0x858)+_0x5b3d5f},'body':JSON['stringify'](_0x2c6fd7),'signal':_0x1b91cb[_0x3c04f7(0x11f5)]});}clearTimeout(_0x33a0a9);if(!_0x518b49['ok']){let _0x2b6995=await _0x518b49['text']();return console['error'](_0x3c04f7(0x101a)+_0x518b49[_0x3c04f7(0xe54)]+'):\x20'+_0x2b6995),[];}const _0x205bfb=await _0x518b49[_0x3c04f7(0x2318)]();let _0x209196;if(_0x2f44c2){_0x209196=_0x205bfb[_0x3c04f7(0x1d23)]?.[0x0]?.[_0x3c04f7(0x1423)]?.[_0x3c04f7(0x23c1)]?.[0x0]?.[_0x3c04f7(0x1e58)];if(!_0x209196)return console[_0x3c04f7(0xc0d)](_0x3c04f7(0x23ca),_0x205bfb),[];}else{if(_0x205bfb[_0x3c04f7(0x13cf)]&&_0x205bfb[_0x3c04f7(0x13cf)]['length']>0x0&&_0x205bfb[_0x3c04f7(0x13cf)][0x0]['message'])_0x209196=_0x205bfb[_0x3c04f7(0x13cf)][0x0]['message'][_0x3c04f7(0x1423)];else{if(_0x205bfb[_0x3c04f7(0xd7a)])_0x209196=_0x205bfb['message'];else{if(_0x205bfb[_0x3c04f7(0x1e58)])_0x209196=_0x205bfb['text'];else{if(_0x205bfb[_0x3c04f7(0xc35)])_0x209196=_0x205bfb[_0x3c04f7(0xc35)];else{if(_0x205bfb[_0x3c04f7(0x1423)])_0x209196=_0x205bfb[_0x3c04f7(0x1423)];else{if(_0x205bfb[_0x3c04f7(0x1fff)])_0x209196=_0x205bfb[_0x3c04f7(0x1fff)];else for(const _0x44bdce in _0x205bfb){if(typeof _0x205bfb[_0x44bdce]===_0x3c04f7(0xb97)&&_0x205bfb[_0x44bdce]['trim']()){_0x209196=_0x205bfb[_0x44bdce],console['log']('AI评论API使用字段\x20\x22'+_0x44bdce+_0x3c04f7(0x2167));break;}}}}}}}if(!_0x209196)return console[_0x3c04f7(0x24ab)](_0x3c04f7(0x379),_0x205bfb),[];}if(_0x209196&&_0x209196[_0x3c04f7(0x1424)]()[_0x3c04f7(0xcbf)]>0x0)return[_0x209196[_0x3c04f7(0x1424)]()];return[];}catch(_0x164340){return console[_0x3c04f7(0x24ab)](_0x3c04f7(0x1422),_0x164340),[];}}async function generateCharacterComment(_0x1aa3ea,_0x2bf5a5){return await generateCharacterCommentWithMemory(_0x1aa3ea,_0x2bf5a5);}const publisherReplyProcessing=new Map();async function triggerPublisherReplyToComments(_0x3b45ed,_0x47fcdb){const _0xfaadee=_0x2cf6d4;try{if(!_0x47fcdb)return;const _0x5f3d38=typeof _0x3b45ed===_0xfaadee(0xb97)?parseInt(_0x3b45ed):_0x3b45ed,_0x9e412=_0x5f3d38+'-'+_0x47fcdb['id'];if(publisherReplyProcessing[_0xfaadee(0x1af1)](_0x9e412)){console['log'](_0xfaadee(0xb32)+_0x47fcdb[_0xfaadee(0x222f)]+_0xfaadee(0xf36)+_0x5f3d38+_0xfaadee(0x1f98));return;}publisherReplyProcessing['set'](_0x9e412,!![]),console[_0xfaadee(0xc0d)](_0xfaadee(0x17b1)+_0x5f3d38+_0xfaadee(0x1be7));const _0x41ac0e=await db[_0xfaadee(0x1733)][_0xfaadee(0x4a6)](_0xfaadee(0x2289))[_0xfaadee(0x14a)](_0x5f3d38)[_0xfaadee(0x18c6)]();if(_0x41ac0e['length']===0x0){publisherReplyProcessing[_0xfaadee(0xc2b)](_0x9e412);return;}console[_0xfaadee(0xc0d)](_0xfaadee(0x83c)+_0x3b45ed+_0xfaadee(0x204b)+_0x47fcdb[_0xfaadee(0x222f)]+_0xfaadee(0x192)+_0x47fcdb['id']+')'),console[_0xfaadee(0xc0d)](_0xfaadee(0x10da)+_0x41ac0e[_0xfaadee(0xcbf)]+_0xfaadee(0x1670),_0x41ac0e[_0xfaadee(0xf6d)](_0xc6293a=>_0xc6293a[_0xfaadee(0x201a)]+_0xfaadee(0x47d)+_0xc6293a['authorId']+')'));const _0x1ce4ed=_0x41ac0e[_0xfaadee(0x803)](_0x10089c=>{const _0x4b3f5d=_0xfaadee,_0x855e29=_0x10089c['authorId']!==_0x47fcdb['id'],_0x1637cb=_0x10089c[_0x4b3f5d(0x3df)]!=='user',_0x58755d=_0x10089c[_0x4b3f5d(0x3df)]&&_0x10089c[_0x4b3f5d(0x3df)]!==_0x4b3f5d(0x23b2);return console[_0x4b3f5d(0xc0d)]('📋\x20评论筛选:\x20'+_0x10089c[_0x4b3f5d(0x201a)]+'\x20-\x20authorId:\x20'+_0x10089c[_0x4b3f5d(0x3df)]+_0x4b3f5d(0x859)+_0x855e29+',\x20不是用户:\x20'+_0x1637cb+_0x4b3f5d(0x1df9)+_0x58755d),_0x855e29&&_0x1637cb&&_0x58755d;}),_0x14ccf9=_0x1ce4ed[_0xfaadee(0x803)](_0x327159=>{const _0x1f9dd5=_0xfaadee,_0x394a34=_0x41ac0e['some'](_0x48005b=>_0x48005b[_0x1f9dd5(0x3df)]===_0x47fcdb['id']&&_0x48005b[_0x1f9dd5(0x180)]===_0x327159[_0x1f9dd5(0x201a)]);return _0x394a34&&console[_0x1f9dd5(0xc0d)](_0x1f9dd5(0xb32)+_0x327159[_0x1f9dd5(0x201a)]+'\x20的评论已被\x20'+_0x47fcdb[_0x1f9dd5(0x222f)]+'\x20回复过，跳过'),!_0x394a34;});console['log']('✅\x20筛选后的其他角色评论数量:\x20'+_0x1ce4ed[_0xfaadee(0xcbf)]),console[_0xfaadee(0xc0d)](_0xfaadee(0xb3)+_0x14ccf9['length']);if(_0x14ccf9['length']===0x0){console['log'](_0xfaadee(0xf1f)+_0x47fcdb[_0xfaadee(0x222f)]+_0xfaadee(0xf77)),publisherReplyProcessing[_0xfaadee(0xc2b)](_0x9e412);return;}const _0x5c5d72=Math[_0xfaadee(0x191c)]();console[_0xfaadee(0xc0d)](_0xfaadee(0x17eb)+_0x5c5d72[_0xfaadee(0x3cd)](0x3)+_0xfaadee(0x1614)+(_0x5c5d72<0.9)+'\x20(未回复评论数:\x20'+_0x14ccf9[_0xfaadee(0xcbf)]+')');if(_0x5c5d72<0.9){const _0x26b75f=_0x14ccf9[Math[_0xfaadee(0x1dac)](Math[_0xfaadee(0x191c)]()*_0x14ccf9['length'])];console['log'](_0xfaadee(0x5b3)+_0x47fcdb[_0xfaadee(0x222f)]+_0xfaadee(0x1808)+_0x26b75f[_0xfaadee(0x201a)]+'\x20的评论:\x20\x22'+_0x26b75f[_0xfaadee(0x1e58)]+'\x22');const _0x17ec49=await generatePublisherReply(_0x47fcdb,_0x26b75f,_0x5f3d38);if(_0x17ec49){const _0x48be63={'id':Date[_0xfaadee(0x18e0)]()+Math[_0xfaadee(0x191c)](),'nickname':_0x47fcdb[_0xfaadee(0x222f)],'avatar':_0x47fcdb[_0xfaadee(0x10f9)],'text':_0x17ec49,'time':formatTime(new Date()),'timestamp':Date[_0xfaadee(0x18e0)](),'characterId':_0x47fcdb['id'],'replyTo':_0x26b75f[_0xfaadee(0x201a)]};await saveCommentToMoment(_0x5f3d38,_0x48be63),await updateMomentCommentCount(_0x5f3d38),displayCommentUnderMoment(_0x5f3d38,_0x48be63),console[_0xfaadee(0xc0d)]('✅\x20'+_0x47fcdb[_0xfaadee(0x222f)]+_0xfaadee(0xbc9)+_0x26b75f[_0xfaadee(0x201a)]+_0xfaadee(0x10c9)+_0x17ec49+'\x22'),await recordCrossAppEvent(_0x47fcdb['id'],'moments','ai_to_ai_reply',{'repliedTo':_0x26b75f[_0xfaadee(0x201a)],'replyContent':_0x17ec49,'originalComment':_0x26b75f['text']});const _0x52145d=characters[_0xfaadee(0x1aeb)](_0x448a82=>_0x448a82[_0xfaadee(0x222f)]===_0x26b75f[_0xfaadee(0x201a)]);_0x52145d&&_0x52145d['id']!==_0x47fcdb['id']&&(console[_0xfaadee(0xc0d)](_0xfaadee(0x12ff)+_0x47fcdb[_0xfaadee(0x222f)]+_0xfaadee(0x21ae)+_0x52145d[_0xfaadee(0x222f)]+_0xfaadee(0x1a4e)+_0x52145d[_0xfaadee(0x222f)]+_0xfaadee(0x20d3)),setTimeout(async()=>{const _0x25cbbd=_0xfaadee;console[_0x25cbbd(0xc0d)]('🔄\x20检查\x20'+_0x52145d[_0x25cbbd(0x222f)]+_0x25cbbd(0x1141)+_0x47fcdb[_0x25cbbd(0x222f)]+'\x20的回复...'),await generateAiToAiReplyWithMemory(_0x5f3d38,_0x48be63,_0x52145d,_0x47fcdb);},Math[_0xfaadee(0x191c)]()*0x7530+0x7530));}else console['log']('❌\x20'+_0x47fcdb['name']+_0xfaadee(0xb9));}else console['log'](_0xfaadee(0x76d)+_0x47fcdb['name']+_0xfaadee(0x6d8));}catch(_0x283bff){console[_0xfaadee(0x24ab)](_0xfaadee(0x4e0),_0x283bff);}finally{const _0x5cf948=(typeof _0x3b45ed===_0xfaadee(0xb97)?parseInt(_0x3b45ed):_0x3b45ed)+'-'+_0x47fcdb?.['id'];publisherReplyProcessing[_0xfaadee(0xc2b)](_0x5cf948),console[_0xfaadee(0xc0d)]('🧹\x20清除处理标记:\x20'+_0x5cf948);}}async function generatePublisherReply(_0x32a0af,_0x18a3a4,_0x479362){const _0x12d226=_0x2cf6d4;try{const _0x56ba9e=await db[_0x12d226(0x1a72)][_0x12d226(0x46a)](parseInt(_0x479362));if(!_0x56ba9e)return'';let _0x38e05a=null;try{_0x38e05a=await db[_0x12d226(0xb08)][_0x12d226(0x46a)](_0x32a0af['id']);}catch(_0x3701e2){console[_0x12d226(0x24ab)](_0x12d226(0x11de),_0x3701e2);}const _0x1792a8=_0x32a0af[_0x12d226(0x1a84)]||_0x32a0af[_0x12d226(0x1f8f)]||'你是'+_0x32a0af[_0x12d226(0x222f)]+'。';let _0x526cca='';const _0x450598=await db[_0x12d226(0xa1b)][_0x12d226(0x4a6)](_0x12d226(0x10df))[_0x12d226(0x14a)](_0x32a0af['id'])[_0x12d226(0x18c6)](),_0x33dfd6=_0x450598[_0x12d226(0x803)](_0x31d38e=>_0x31d38e['fact']&&_0x31d38e['fact']['includes'](_0x18a3a4[_0x12d226(0x201a)]));_0x33dfd6[_0x12d226(0xcbf)]>0x0&&(_0x526cca='\x0a\x0a你们的关系记忆：\x0a'+_0x33dfd6[_0x12d226(0xf6d)](_0x32c240=>_0x32c240[_0x12d226(0x77b)])[_0x12d226(0x140c)]('；'));let _0x771732='';try{const _0xe688ee=await db[_0x12d226(0x1733)][_0x12d226(0x4a6)](_0x12d226(0x2289))['equals'](parseInt(_0x479362))[_0x12d226(0x18c6)]();_0xe688ee[_0x12d226(0xcbf)]>0x1&&(_0xe688ee[_0x12d226(0x1f0d)]((_0x1b6e0e,_0x509e3b)=>_0x1b6e0e['timestamp']-_0x509e3b[_0x12d226(0x7aa)]),_0x771732=_0x12d226(0xd90),_0xe688ee[_0x12d226(0x900)]((_0x5ce858,_0x50aa8e)=>{const _0x19f8da=_0x12d226,_0x5b32b8=_0x5ce858['authorId']===_0x19f8da(0x23b2)?'用户':_0x5ce858[_0x19f8da(0x201a)];_0x771732+=_0x50aa8e+0x1+'.\x20'+_0x5b32b8+':\x20'+_0x5ce858['text']+'\x0a';}));}catch(_0x3b4dd4){console[_0x12d226(0x24ab)](_0x12d226(0xc42),_0x3b4dd4);}const _0x2bc1d3='你是'+_0x32a0af[_0x12d226(0x222f)]+_0x12d226(0x1da8)+_0x1792a8+'。'+_0x526cca+_0x771732+_0x12d226(0xb4c)+_0x56ba9e[_0x12d226(0x1e58)]+'\x22\x0a\x0a'+_0x18a3a4[_0x12d226(0x201a)]+_0x12d226(0x1e1f)+_0x18a3a4['text']+_0x12d226(0x115f),{base:_0xc8b597,key:_0x3c0021,model:_0x9c7665}=apiSettings;if(!_0xc8b597||!_0x3c0021||!_0x9c7665)return console[_0x12d226(0xc0d)]('API配置不完整，跳过发布者回复'),'';const _0x26d282=[{'role':_0x12d226(0x212),'content':_0x2bc1d3},{'role':_0x12d226(0x23b2),'content':_0x12d226(0x1076)}],_0x556cc9={'model':_0x9c7665,'messages':_0x26d282,'temperature':0.8,'stream':![]},_0x6c27c1=new AbortController(),_0x4b7d3c=setTimeout(()=>_0x6c27c1['abort'](),0x7530),_0x7a39c1=_0xc8b597[_0x12d226(0x23ec)](_0x12d226(0xad8));let _0x39f440;if(_0x7a39c1){const _0x59b84a=_0xc8b597+_0x12d226(0x1f4e)+_0x9c7665+_0x12d226(0x23aa)+_0x3c0021,_0x2b0542=[];_0x556cc9[_0x12d226(0x1767)][0x0]?.['role']===_0x12d226(0x212)&&(_0x2b0542['push']({'role':'user','parts':[{'text':_0x556cc9[_0x12d226(0x1767)][0x0][_0x12d226(0x1423)]}]}),_0x2b0542[_0x12d226(0x6ee)]({'role':_0x12d226(0xeea),'parts':[{'text':_0x12d226(0x117f)}]}));for(let _0x439c27=0x1;_0x439c27<_0x556cc9['messages']['length'];_0x439c27++){const _0x2fd204=_0x556cc9[_0x12d226(0x1767)][_0x439c27];if(_0x2fd204['role']==='system')continue;_0x2b0542['push']({'role':_0x2fd204['role']==='user'?_0x12d226(0x23b2):'model','parts':[{'text':_0x2fd204[_0x12d226(0x1423)]}]});}_0x39f440=await fetch(_0x59b84a,{'method':_0x12d226(0x227d),'headers':{'Content-Type':_0x12d226(0x302)},'body':JSON[_0x12d226(0x7fb)]({'contents':_0x2b0542,'generationConfig':{'temperature':_0x556cc9[_0x12d226(0x2b0)]||0.8}}),'signal':_0x6c27c1[_0x12d226(0x11f5)]});}else{let _0x2ed08b;if(_0xc8b597[_0x12d226(0xd7e)](_0x12d226(0x812)))_0x2ed08b=_0xc8b597+'/chat/completions';else _0xc8b597[_0x12d226(0x23ec)](_0x12d226(0x193c))?_0x2ed08b=_0xc8b597+_0x12d226(0xb73):_0x2ed08b=_0xc8b597+'/v1/chat/completions';_0x39f440=await fetch(_0x2ed08b,{'method':_0x12d226(0x227d),'headers':{'Content-Type':_0x12d226(0x302),'Authorization':_0x12d226(0x858)+_0x3c0021},'body':JSON[_0x12d226(0x7fb)](_0x556cc9),'signal':_0x6c27c1[_0x12d226(0x11f5)]});}clearTimeout(_0x4b7d3c);if(!_0x39f440['ok'])return console[_0x12d226(0x24ab)](_0x12d226(0x88d)+_0x39f440[_0x12d226(0xe54)]+')'),'';const _0x336418=await _0x39f440[_0x12d226(0x2318)]();let _0x1b13f0;_0x7a39c1?_0x1b13f0=_0x336418[_0x12d226(0x1d23)]?.[0x0]?.[_0x12d226(0x1423)]?.[_0x12d226(0x23c1)]?.[0x0]?.['text']:_0x1b13f0=_0x336418['choices']?.[0x0]?.[_0x12d226(0xd7a)]?.[_0x12d226(0x1423)]||_0x336418[_0x12d226(0xd7a)]||_0x336418['text']||_0x336418[_0x12d226(0xc35)]||_0x336418['content']||_0x336418['result'];if(_0x1b13f0&&_0x1b13f0[_0x12d226(0x1424)]()[_0x12d226(0xcbf)]>0x0)return _0x1b13f0[_0x12d226(0x1424)]();return'';}catch(_0x9a752){return console[_0x12d226(0x24ab)](_0x12d226(0xa67),_0x9a752),'';}}async function generateCharacterInteraction(_0x457b84,_0x52822a,_0x2cb471){const _0x5c6a65=_0x2cf6d4;try{const _0x5a49b0=JSON['parse'](sessionStorage[_0x5c6a65(0x2250)](_0x5c6a65(0x12cb))||'[]'),_0x23dd04=_0x5a49b0[_0x5c6a65(0x1aeb)](_0x3a4dd5=>_0x3a4dd5['id']==_0x2cb471||_0x3a4dd5[_0x5c6a65(0x7aa)]==_0x2cb471);if(!_0x23dd04)return'';let _0x2dfeee=null,_0x38dc8f=null;try{_0x2dfeee=await db[_0x5c6a65(0xb08)]['get'](_0x457b84['id']),_0x38dc8f=await db[_0x5c6a65(0xb08)][_0x5c6a65(0x46a)](_0x52822a['id']);}catch(_0x5bdf67){console[_0x5c6a65(0x24ab)](_0x5c6a65(0x11de),_0x5bdf67);}const _0x2f66ef=(_0x23dd04[_0x5c6a65(0x1508)]||[])[_0x5c6a65(0x803)](_0x451ee5=>_0x451ee5[_0x5c6a65(0x10df)]===_0x52822a['id']),_0x3e4425=_0x2f66ef[_0x2f66ef[_0x5c6a65(0xcbf)]-0x1];let _0x22ed55=_0x5c6a65(0x8a9)+_0x23dd04[_0x5c6a65(0x1e58)]+'\x0a';_0x3e4425&&(_0x22ed55+=_0x52822a[_0x5c6a65(0x222f)]+_0x5c6a65(0x2135)+_0x3e4425['text']+'\x0a');const _0x32fd12=_0x457b84[_0x5c6a65(0x1a84)]||_0x457b84[_0x5c6a65(0x1f8f)]||'你是'+_0x457b84[_0x5c6a65(0x222f)]+'。',_0x4f1b79=parseInt(_0x2dfeee?.[_0x5c6a65(0x1c8e)])||0xa,_0x5aabbd=chatMessages[_0x457b84['id']]||[],_0x1c1874=_0x5aabbd[_0x5c6a65(0x136)](-_0x4f1b79);let _0x1b8f48='';_0x1c1874[_0x5c6a65(0xcbf)]>0x0&&(_0x1b8f48='你和用户最近的聊天记录（供参考）：\x0a',_0x1b8f48+=_0x1c1874[_0x5c6a65(0xf6d)](_0x2d6abc=>{const _0x4503f7=_0x5c6a65;if(_0x2d6abc['role']===_0x4503f7(0x23b2))return _0x4503f7(0x1e7e)+_0x2d6abc[_0x4503f7(0x1423)];if(_0x2d6abc['role']==='assistant')return _0x457b84[_0x4503f7(0x222f)]+'：'+_0x2d6abc[_0x4503f7(0x1423)];return'';})[_0x5c6a65(0x803)](_0x2db634=>_0x2db634)[_0x5c6a65(0x140c)]('\x0a'));let _0x2fe7c5='';if(_0x2dfeee?.[_0x5c6a65(0x1cee)]&&_0x2dfeee[_0x5c6a65(0x1cee)][_0x5c6a65(0xcbf)]>0x0)try{const _0x3a0676=await Promise['all'](_0x2dfeee[_0x5c6a65(0x1cee)][_0x5c6a65(0xf6d)](async _0x487f02=>{const _0x4759a5=_0x5c6a65;try{return await db[_0x4759a5(0x195c)][_0x4759a5(0x46a)](_0x487f02);}catch(_0x131ba5){return console[_0x4759a5(0x24ab)](_0x4759a5(0x332),_0x131ba5),null;}})),_0x5c8d1b=_0x3a0676['filter'](_0xd89a84=>_0xd89a84&&_0xd89a84[_0x5c6a65(0x1423)]);_0x5c8d1b[_0x5c6a65(0xcbf)]>0x0&&(_0x2fe7c5=_0x5c6a65(0xd4c)+_0x5c8d1b[_0x5c6a65(0xf6d)](_0x3ecdde=>_0x3ecdde[_0x5c6a65(0x222f)]+'：'+_0x3ecdde[_0x5c6a65(0x1423)])['join']('\x0a\x0a'));}catch(_0x4a692e){console[_0x5c6a65(0x24ab)]('获取世界书内容失败:',_0x4a692e);}let _0x1e4ee0='你是'+_0x457b84[_0x5c6a65(0x222f)]+_0x5c6a65(0x1da8)+_0x32fd12+'。'+_0x2fe7c5+_0x1b8f48+'\x0a\x0a';_0x1e4ee0+=_0x5c6a65(0x149e);const _0x2adbc3=_0x52822a['bio']||_0x52822a[_0x5c6a65(0x1f8f)];_0x2adbc3&&(_0x1e4ee0+='\x20（'+_0x52822a['name']+_0x5c6a65(0x119e)+_0x2adbc3+'）');_0x1e4ee0+=_0x5c6a65(0x15ea);const _0x36a546=[{'role':_0x5c6a65(0x212),'content':_0x1e4ee0},{'role':_0x5c6a65(0x23b2),'content':_0x22ed55}],{base:_0x1b1faa,key:_0x18f078,model:_0x469b85}=apiSettings;if(!_0x1b1faa||!_0x18f078||!_0x469b85)return console[_0x5c6a65(0xc0d)](_0x5c6a65(0xf61)),'';const _0x41eca9={'model':_0x469b85,'messages':_0x36a546,'temperature':0.8,'stream':![]},_0xe0c40=new AbortController(),_0xe75049=setTimeout(()=>_0xe0c40[_0x5c6a65(0x135b)](),0x7530),_0x50989b=_0x1b1faa[_0x5c6a65(0x23ec)](_0x5c6a65(0xad8));let _0xa6a233;if(_0x50989b){const _0x4c307b=_0x1b1faa+_0x5c6a65(0x1f4e)+_0x469b85+_0x5c6a65(0x23aa)+_0x18f078,_0x947b59=[];_0x41eca9[_0x5c6a65(0x1767)][0x0]?.['role']==='system'&&(_0x947b59['push']({'role':_0x5c6a65(0x23b2),'parts':[{'text':_0x41eca9[_0x5c6a65(0x1767)][0x0][_0x5c6a65(0x1423)]}]}),_0x947b59['push']({'role':_0x5c6a65(0xeea),'parts':[{'text':_0x5c6a65(0x13c8)}]}));for(let _0x4fadc3=0x1;_0x4fadc3<_0x41eca9['messages']['length'];_0x4fadc3++){const _0xf2b5d4=_0x41eca9[_0x5c6a65(0x1767)][_0x4fadc3];if(_0xf2b5d4[_0x5c6a65(0x1562)]===_0x5c6a65(0x212))continue;_0x947b59[_0x5c6a65(0x6ee)]({'role':_0xf2b5d4[_0x5c6a65(0x1562)]===_0x5c6a65(0x23b2)?_0x5c6a65(0x23b2):_0x5c6a65(0xeea),'parts':[{'text':_0xf2b5d4[_0x5c6a65(0x1423)]}]});}_0xa6a233=await fetch(_0x4c307b,{'method':_0x5c6a65(0x227d),'headers':{'Content-Type':'application/json'},'body':JSON['stringify']({'contents':_0x947b59,'generationConfig':{'temperature':_0x41eca9[_0x5c6a65(0x2b0)]||0.8}}),'signal':_0xe0c40[_0x5c6a65(0x11f5)]});}else{let _0x324e31;if(_0x1b1faa[_0x5c6a65(0xd7e)](_0x5c6a65(0x812)))_0x324e31=_0x1b1faa+_0x5c6a65(0xb73);else _0x1b1faa[_0x5c6a65(0x23ec)]('/v1/')?_0x324e31=_0x1b1faa+_0x5c6a65(0xb73):_0x324e31=_0x1b1faa+'/v1/chat/completions';_0xa6a233=await fetch(_0x324e31,{'method':_0x5c6a65(0x227d),'headers':{'Content-Type':_0x5c6a65(0x302),'Authorization':_0x5c6a65(0x858)+_0x18f078},'body':JSON[_0x5c6a65(0x7fb)](_0x41eca9),'signal':_0xe0c40[_0x5c6a65(0x11f5)]});}clearTimeout(_0xe75049);if(!_0xa6a233['ok']){let _0x39c9a1=await _0xa6a233[_0x5c6a65(0x1e58)]();return console[_0x5c6a65(0x24ab)]('角色互动API调用失败\x20('+_0xa6a233[_0x5c6a65(0xe54)]+_0x5c6a65(0xd38)+_0x39c9a1),'';}const _0x244da4=await _0xa6a233[_0x5c6a65(0x2318)]();let _0x2b9f79;if(_0x50989b){_0x2b9f79=_0x244da4[_0x5c6a65(0x1d23)]?.[0x0]?.[_0x5c6a65(0x1423)]?.['parts']?.[0x0]?.[_0x5c6a65(0x1e58)];if(!_0x2b9f79)return console[_0x5c6a65(0xc0d)](_0x5c6a65(0x23ca),_0x244da4),'';}else{if(_0x244da4[_0x5c6a65(0x13cf)]&&_0x244da4[_0x5c6a65(0x13cf)][_0x5c6a65(0xcbf)]>0x0&&_0x244da4[_0x5c6a65(0x13cf)][0x0][_0x5c6a65(0xd7a)])_0x2b9f79=_0x244da4[_0x5c6a65(0x13cf)][0x0][_0x5c6a65(0xd7a)][_0x5c6a65(0x1423)];else{if(_0x244da4[_0x5c6a65(0xd7a)])_0x2b9f79=_0x244da4[_0x5c6a65(0xd7a)];else{if(_0x244da4[_0x5c6a65(0x1e58)])_0x2b9f79=_0x244da4[_0x5c6a65(0x1e58)];else{if(_0x244da4[_0x5c6a65(0xc35)])_0x2b9f79=_0x244da4['response'];else{if(_0x244da4[_0x5c6a65(0x1423)])_0x2b9f79=_0x244da4[_0x5c6a65(0x1423)];else{if(_0x244da4[_0x5c6a65(0x1fff)])_0x2b9f79=_0x244da4['result'];else for(const _0x2cdaf3 in _0x244da4){if(typeof _0x244da4[_0x2cdaf3]===_0x5c6a65(0xb97)&&_0x244da4[_0x2cdaf3]['trim']()){_0x2b9f79=_0x244da4[_0x2cdaf3],console[_0x5c6a65(0xc0d)](_0x5c6a65(0x10f3)+_0x2cdaf3+'\x22\x20作为响应内容');break;}}}}}}}if(!_0x2b9f79)return console[_0x5c6a65(0x24ab)](_0x5c6a65(0x242e),_0x244da4),'';}return _0x2b9f79?_0x2b9f79['trim']():'';}catch(_0x16e3c7){return console['error']('生成角色互动失败:',_0x16e3c7),'';}}function addLongPressListener(_0x570e60,_0x1bb0e7){const _0x2a97ca=_0x2cf6d4;let _0x5c0ae3=null,_0xdadb7a=0x0,_0x12c728=![];const _0x35ffac=_0x59181b=>{const _0x36de1c=_0x3a81;if(isSelectionMode)return;_0xdadb7a=_0x59181b[_0x36de1c(0x1278)]?_0x59181b[_0x36de1c(0x1278)][0x0][_0x36de1c(0x11cd)]:_0x59181b[_0x36de1c(0x11cd)],_0x12c728=![],_0x5c0ae3=setTimeout(()=>{!_0x12c728&&(enterSelectionMode(),selectMoment(_0x1bb0e7));},0x1f4);},_0x54e8fa=()=>{clearTimeout(_0x5c0ae3),_0x5c0ae3=null;},_0x4f0526=_0x191081=>{const _0x4970ae=_0x3a81,_0x32f394=_0x191081[_0x4970ae(0x1278)]?_0x191081[_0x4970ae(0x1278)][0x0][_0x4970ae(0x11cd)]:_0x191081[_0x4970ae(0x11cd)];Math[_0x4970ae(0x2424)](_0x32f394-_0xdadb7a)>0xa&&(_0x12c728=!![],_0x54e8fa());};_0x570e60[_0x2a97ca(0x167)](_0x2a97ca(0xf52),_0x35ffac),_0x570e60['addEventListener'](_0x2a97ca(0x1263),_0x54e8fa),_0x570e60[_0x2a97ca(0x167)](_0x2a97ca(0x1e8f),_0x4f0526),_0x570e60[_0x2a97ca(0x167)](_0x2a97ca(0xa69),_0x35ffac),_0x570e60[_0x2a97ca(0x167)](_0x2a97ca(0x1fb0),_0x54e8fa),_0x570e60[_0x2a97ca(0x167)](_0x2a97ca(0x178d),_0x4f0526);}function enterSelectionMode(){const _0x217408=_0x2cf6d4;isSelectionMode=!![],selectedMoments[_0x217408(0x2215)](),showSelectionModeUI();const _0x18080c=document['querySelectorAll'](_0x217408(0x151f));_0x18080c[_0x217408(0x900)](_0x517899=>{const _0x43bc50=_0x217408,_0x2ca510=document[_0x43bc50(0x1ad8)](_0x43bc50(0x526));_0x2ca510[_0x43bc50(0x221)]='moment-checkbox',_0x2ca510[_0x43bc50(0xc02)]=_0x43bc50(0x7c7),_0x2ca510['onclick']=_0x759b4f=>{const _0x2a0180=_0x43bc50;_0x759b4f[_0x2a0180(0x1023)]();const _0x284682=_0x517899['getAttribute']('data-moment-id');toggleMomentSelection(_0x284682);},_0x517899['appendChild'](_0x2ca510),_0x517899[_0x43bc50(0x226e)][_0x43bc50(0xe1)](_0x43bc50(0xe5e));});}function exitSelectionMode(){const _0xad2e52=_0x2cf6d4;isSelectionMode=![],selectedMoments['clear'](),hideSelectionModeUI();const _0x557d89=document[_0xad2e52(0x1ed9)]('.moment-checkbox');_0x557d89['forEach'](_0x2d4fa7=>_0x2d4fa7[_0xad2e52(0x128)]());const _0x14937d=document[_0xad2e52(0x1ed9)](_0xad2e52(0x151f));_0x14937d[_0xad2e52(0x900)](_0x22e8ad=>{const _0x4c84c3=_0xad2e52;_0x22e8ad[_0x4c84c3(0x226e)]['remove'](_0x4c84c3(0xe5e),'selected');});}function showSelectionModeUI(){const _0x3303be=_0x2cf6d4,_0x1d30ef=document[_0x3303be(0x1ad8)](_0x3303be(0x526));_0x1d30ef[_0x3303be(0x221)]=_0x3303be(0x1333),_0x1d30ef[_0x3303be(0xc02)]=_0x3303be(0x48a),_0x1d30ef[_0x3303be(0x11cf)]=function(_0x456377){const _0x4efc01=_0x3303be,_0x74a9dd=_0x456377['target']['dataset'][_0x4efc01(0x23af)];if(_0x74a9dd==='cancel')exitSelectionMode();else _0x74a9dd===_0x4efc01(0xc2b)&&!_0x456377['target'][_0x4efc01(0x194e)]&&deleteSelectedMoments();};const _0x4d09d6=document[_0x3303be(0x566)](_0x3303be(0xbdc));_0x4d09d6[_0x3303be(0x1806)](_0x1d30ef,_0x4d09d6[_0x3303be(0x1bd8)]);}function hideSelectionModeUI(){const _0x1557d3=_0x2cf6d4,_0x2eefe8=document[_0x1557d3(0x15b8)](_0x1557d3(0xe9a));_0x2eefe8&&_0x2eefe8[_0x1557d3(0x128)]();}function toggleMomentSelection(_0x2bffa4){const _0x23b528=_0x2cf6d4,_0x10fbdd=document[_0x23b528(0x15b8)](_0x23b528(0x2352)+_0x2bffa4+'\x22]');if(!_0x10fbdd)return;const _0x3d187e=_0x10fbdd[_0x23b528(0x15b8)](_0x23b528(0x1656));if(!_0x3d187e)return;selectedMoments[_0x23b528(0x1af1)](_0x2bffa4)?(selectedMoments[_0x23b528(0xc2b)](_0x2bffa4),_0x3d187e['className']='far\x20fa-circle',_0x10fbdd[_0x23b528(0x226e)]['remove'](_0x23b528(0x876))):(selectedMoments[_0x23b528(0xe1)](_0x2bffa4),_0x3d187e['className']=_0x23b528(0xf4b),_0x10fbdd['classList'][_0x23b528(0xe1)](_0x23b528(0x876))),updateSelectionUI();}function selectMoment(_0x20cf9e){const _0x5ac92c=_0x2cf6d4;!selectedMoments[_0x5ac92c(0x1af1)](_0x20cf9e)&&toggleMomentSelection(_0x20cf9e);}function updateSelectionUI(){const _0x36c4b5=_0x2cf6d4,_0x5b0feb=document[_0x36c4b5(0x15b8)](_0x36c4b5(0x1bfa)),_0x367dd5=document[_0x36c4b5(0x15b8)](_0x36c4b5(0xdf5));_0x5b0feb&&(_0x5b0feb[_0x36c4b5(0x21dc)]=_0x36c4b5(0xae9)+selectedMoments[_0x36c4b5(0x41a)]+_0x36c4b5(0x1bca)),_0x367dd5&&(_0x367dd5[_0x36c4b5(0x194e)]=selectedMoments['size']===0x0);}async function deleteSelectedMoments(){const _0x367f98=_0x2cf6d4;if(selectedMoments[_0x367f98(0x41a)]===0x0)return;if(!confirm(_0x367f98(0xc0e)+selectedMoments[_0x367f98(0x41a)]+_0x367f98(0x1b47)))return;try{for(const _0x39e0e0 of selectedMoments){try{const _0x4ae160=await db['moments'][_0x367f98(0x46a)](parseInt(_0x39e0e0));_0x4ae160?(await db[_0x367f98(0x1a72)][_0x367f98(0xc2b)](parseInt(_0x39e0e0)),console[_0x367f98(0xc0d)](_0x367f98(0x2243)+_0x39e0e0+'\x20(ID:\x20'+_0x4ae160['id']+')')):console[_0x367f98(0x17cc)]('⚠️\x20动态\x20'+_0x39e0e0+'\x20不存在，可能已被删除');const _0x5ab42c=parseInt(_0x39e0e0);await db['momentLikes'][_0x367f98(0x4a6)](_0x367f98(0x2289))['equals'](_0x5ab42c)[_0x367f98(0xc2b)](),await db['momentLikes'][_0x367f98(0x4a6)](_0x367f98(0x2289))['equals'](_0x39e0e0)[_0x367f98(0xc2b)](),await db['momentComments'][_0x367f98(0x4a6)](_0x367f98(0x2289))[_0x367f98(0x14a)](_0x5ab42c)[_0x367f98(0xc2b)](),await db[_0x367f98(0x1733)]['where'](_0x367f98(0x2289))[_0x367f98(0x14a)](_0x39e0e0)[_0x367f98(0xc2b)]();}catch(_0x487517){console[_0x367f98(0x24ab)](_0x367f98(0x170e)+_0x39e0e0+'\x20失败:',_0x487517);throw _0x487517;}for(const [_0x30e799,_0x3c5675]of commentConversationRounds[_0x367f98(0x230e)]()){_0x30e799[_0x367f98(0x1cab)](_0x39e0e0+'-')&&commentConversationRounds[_0x367f98(0xc2b)](_0x30e799);}}selectedMoments['forEach'](_0x69bad=>{const _0x112ab1=_0x367f98,_0x580e25=document[_0x112ab1(0x15b8)](_0x112ab1(0x2352)+_0x69bad+'\x22]');_0x580e25&&_0x580e25['remove']();});try{const _0x3f22c6=sessionStorage[_0x367f98(0x2250)](_0x367f98(0x12cb));if(_0x3f22c6){const _0x259858=JSON['parse'](_0x3f22c6),_0x530b8d=_0x259858[_0x367f98(0x803)](_0xce8587=>!selectedMoments['has'](_0xce8587['id'][_0x367f98(0x9a3)]())&&!selectedMoments[_0x367f98(0x1af1)](_0xce8587[_0x367f98(0x7aa)]?.['toString']()));sessionStorage[_0x367f98(0x2055)](_0x367f98(0x12cb),JSON[_0x367f98(0x7fb)](_0x530b8d));}}catch(_0x113acd){console[_0x367f98(0x17cc)](_0x367f98(0x7ba),_0x113acd);}showToast(_0x367f98(0x174f)+selectedMoments[_0x367f98(0x41a)]+_0x367f98(0x1bca)),exitSelectionMode(),setTimeout(()=>{loadMoments();},0x1f4);}catch(_0x2dccb0){console[_0x367f98(0x24ab)](_0x367f98(0xe9f),_0x2dccb0),showToast(_0x367f98(0x315));}}async function forceCleanMoment(_0x146719){const _0x3ee315=_0x2cf6d4;try{const _0x152434=parseInt(_0x146719);console['log'](_0x3ee315(0x15ee)+_0x146719);let _0x203beb=![];const _0x5188a6=[_0x146719,_0x152434,String(_0x146719),Number(_0x146719)];for(const _0x38d0e4 of _0x5188a6){try{await db['moments']['delete'](_0x38d0e4),console[_0x3ee315(0xc0d)](_0x3ee315(0x691)+_0x38d0e4+_0x3ee315(0x60e)+typeof _0x38d0e4+')'),_0x203beb=!![];break;}catch(_0x2d3314){console[_0x3ee315(0xc0d)]('删除ID\x20'+_0x38d0e4+'\x20失败:\x20'+_0x2d3314[_0x3ee315(0xd7a)]);}}!_0x203beb&&await db[_0x3ee315(0x1a72)][_0x3ee315(0x4a6)]('id')[_0x3ee315(0x14a)](_0x146719)[_0x3ee315(0xc2b)]();await db[_0x3ee315(0x101)][_0x3ee315(0x4a6)](_0x3ee315(0x2289))['equals'](_0x152434)[_0x3ee315(0xc2b)](),await db[_0x3ee315(0x101)]['where'](_0x3ee315(0x2289))[_0x3ee315(0x14a)](_0x146719)[_0x3ee315(0xc2b)](),await db[_0x3ee315(0x1733)][_0x3ee315(0x4a6)](_0x3ee315(0x2289))[_0x3ee315(0x14a)](_0x152434)[_0x3ee315(0xc2b)](),await db['momentComments']['where'](_0x3ee315(0x2289))[_0x3ee315(0x14a)](_0x146719)[_0x3ee315(0xc2b)]();for(const [_0x4eb0ef,_0x1c14e4]of commentConversationRounds[_0x3ee315(0x230e)]()){_0x4eb0ef[_0x3ee315(0x1cab)](_0x146719+'-')&&commentConversationRounds['delete'](_0x4eb0ef);}const _0x3f096b=document[_0x3ee315(0x15b8)]('[data-moment-id=\x22'+_0x146719+'\x22]');_0x3f096b&&_0x3f096b[_0x3ee315(0x128)]();const _0x22441e=sessionStorage[_0x3ee315(0x2250)]('momentsData');if(_0x22441e){const _0x1e3bdf=JSON[_0x3ee315(0x168e)](_0x22441e),_0x385a3a=_0x1e3bdf[_0x3ee315(0x803)](_0x5bfef4=>_0x5bfef4['id']!=_0x146719&&_0x5bfef4[_0x3ee315(0x7aa)]!=_0x146719&&_0x5bfef4['id']['toString']()!==_0x146719[_0x3ee315(0x9a3)]());sessionStorage[_0x3ee315(0x2055)]('momentsData',JSON[_0x3ee315(0x7fb)](_0x385a3a));}return console[_0x3ee315(0xc0d)](_0x3ee315(0x16ea)+_0x146719+_0x3ee315(0x1592)),!![];}catch(_0x375e69){return console[_0x3ee315(0x24ab)](_0x3ee315(0x1a47),_0x375e69),![];}}async function cleanupCorruptedMoments(){const _0x3c8019=_0x2cf6d4;if(!confirm(_0x3c8019(0x203b)))return;try{let _0x12f218=0x0;const _0x51ffb1=await db[_0x3c8019(0x1a72)][_0x3c8019(0x18c6)]();for(const _0x437cce of _0x51ffb1){if(_0x437cce[_0x3c8019(0x107f)]&&!isValidAvatarUrl(_0x437cce['avatar'])){console[_0x3c8019(0xc0d)](_0x3c8019(0x200f)+_0x437cce['id']);const _0x4c9122=confirm('动态\x20\x22'+_0x437cce[_0x3c8019(0x1e58)]?.[_0x3c8019(0x4b2)](0x0,0x1e)+_0x3c8019(0xd4e));_0x4c9122?(await forceCleanMoment(_0x437cce['id']),_0x12f218++):await db[_0x3c8019(0x1a72)][_0x3c8019(0x2180)](_0x437cce['id'],{'avatar':getDefaultAvatar()});}}_0x12f218>0x0?(showToast(_0x3c8019(0xcca)+_0x12f218+'\x20条有问题的动态'),loadMoments()):showToast('没有发现需要清理的动态');}catch(_0x55148f){console['error'](_0x3c8019(0xfc),_0x55148f),showToast(_0x3c8019(0x749));}}function changeCoverImage(){const _0x110c32=_0x2cf6d4,_0x20e06a=document[_0x110c32(0x1ad8)]('input');_0x20e06a[_0x110c32(0x23df)]=_0x110c32(0x199b),_0x20e06a[_0x110c32(0xd28)]='image/*,.jpg,.jpeg,.png,.gif,.webp',_0x20e06a['onchange']=async function(_0x243170){const _0x4a4c8a=_0x110c32,_0x53e6ed=_0x243170[_0x4a4c8a(0x1144)]['files'][0x0];if(_0x53e6ed)try{const _0x5bb9c5=await compressImage(_0x53e6ed,0x4b0,0.8),_0x9504b7=document[_0x4a4c8a(0x566)](_0x4a4c8a(0xd4b)),_0x3e28e1=document['getElementById'](_0x4a4c8a(0xb50));_0x9504b7&&_0x3e28e1&&(_0x9504b7['src']=_0x5bb9c5,_0x9504b7['classList'][_0x4a4c8a(0x128)](_0x4a4c8a(0x22df)),_0x3e28e1[_0x4a4c8a(0x226e)]['add'](_0x4a4c8a(0x22df))),saveMomentsImage(_0x4a4c8a(0x780),_0x5bb9c5),showToast('封面已更新！',_0x4a4c8a(0xb27));}catch(_0x586a53){console[_0x4a4c8a(0x24ab)]('处理封面图片失败:',_0x586a53),showToast(_0x4a4c8a(0x21e0),'error');}},_0x20e06a[_0x110c32(0x1e62)]();}function changeAvatarImage(_0xa3854){const _0xd3d540=_0x2cf6d4;_0xa3854[_0xd3d540(0x1023)]();const _0x26822f=document[_0xd3d540(0x1ad8)](_0xd3d540(0x627));_0x26822f[_0xd3d540(0x23df)]=_0xd3d540(0x199b),_0x26822f[_0xd3d540(0xd28)]=_0xd3d540(0x2239),_0x26822f[_0xd3d540(0x1889)]=async function(_0x1f2fab){const _0x2b7bb0=_0xd3d540,_0x21e8db=_0x1f2fab[_0x2b7bb0(0x1144)][_0x2b7bb0(0x173e)][0x0];if(_0x21e8db)try{const _0x4f0cc0=await compressImage(_0x21e8db,0x190,0.9),_0x51110f=document['getElementById'](_0x2b7bb0(0xb41)),_0x37be80=_0x51110f['querySelector'](_0x2b7bb0(0x21fa));_0x51110f[_0x2b7bb0(0x655)]['backgroundImage']=_0x2b7bb0(0xcb5)+_0x4f0cc0+')',_0x37be80[_0x2b7bb0(0x655)][_0x2b7bb0(0x2526)]=_0x2b7bb0(0xfe9),saveMomentsImage(_0x2b7bb0(0xbef),_0x4f0cc0),showToast(_0x2b7bb0(0x1997),_0x2b7bb0(0xb27));}catch(_0x1e11c2){console[_0x2b7bb0(0x24ab)](_0x2b7bb0(0x6c9),_0x1e11c2),showToast(_0x2b7bb0(0x2fe),'error');}},_0x26822f[_0xd3d540(0x1e62)]();}async function loadMomentsImages(){const _0x2aea3e=_0x2cf6d4;try{const _0x398464=await getMomentsImage(_0x2aea3e(0x780));if(_0x398464){const _0x4e886f=document['getElementById'](_0x2aea3e(0xd4b)),_0x316230=document['getElementById'](_0x2aea3e(0xb50));_0x4e886f&&_0x316230&&(_0x4e886f[_0x2aea3e(0x107)]=_0x398464,_0x4e886f[_0x2aea3e(0x226e)][_0x2aea3e(0x128)]('hide'),_0x316230['classList'][_0x2aea3e(0xe1)]('hide'));}const _0x3afdb9=await getMomentsImage('avatarImage');if(_0x3afdb9){const _0x32ff0f=document[_0x2aea3e(0x566)](_0x2aea3e(0xb41)),_0x99f3a0=_0x32ff0f?.[_0x2aea3e(0x15b8)]('.moments-avatar-icon');_0x32ff0f&&(_0x32ff0f[_0x2aea3e(0x655)][_0x2aea3e(0x1584)]=_0x2aea3e(0xcb5)+_0x3afdb9+')',_0x99f3a0&&(_0x99f3a0['style'][_0x2aea3e(0x2526)]=_0x2aea3e(0xfe9)));}const _0x1188de=await getMomentsImage('username');if(_0x1188de){const _0x304a83=document[_0x2aea3e(0x566)]('moments-username');_0x304a83&&(_0x304a83[_0x2aea3e(0x21dc)]=_0x1188de);}console['log'](_0x2aea3e(0x625));}catch(_0x4180b1){console[_0x2aea3e(0x24ab)]('加载动态图片失败:',_0x4180b1);}}function toggleMomentActions(_0x42913b){const _0xacc6f8=_0x2cf6d4,_0x49eb04=document['getElementById']('moment-actions-'+_0x42913b),_0x253b81=document[_0xacc6f8(0x1ed9)](_0xacc6f8(0x407));_0x253b81[_0xacc6f8(0x900)](_0x1bc058=>{const _0x1238c9=_0xacc6f8;_0x1bc058['id']!==_0x1238c9(0x8ea)+_0x42913b&&(_0x1bc058[_0x1238c9(0x655)][_0x1238c9(0x2526)]=_0x1238c9(0xfe9));}),_0x49eb04[_0xacc6f8(0x655)][_0xacc6f8(0x2526)]==='none'||_0x49eb04[_0xacc6f8(0x655)][_0xacc6f8(0x2526)]===''?_0x49eb04[_0xacc6f8(0x655)][_0xacc6f8(0x2526)]=_0xacc6f8(0x1f0b):_0x49eb04[_0xacc6f8(0x655)]['display']=_0xacc6f8(0xfe9);}document[_0x2cf6d4(0x167)](_0x2cf6d4(0x1e62),function(_0x31db3f){const _0x5a492b=_0x2cf6d4;if(!_0x31db3f[_0x5a492b(0x1144)][_0x5a492b(0x2026)]('.moment-actions')){const _0x3f9125=document['querySelectorAll'](_0x5a492b(0x407));_0x3f9125[_0x5a492b(0x900)](_0x5c9602=>{const _0x3f9cfe=_0x5a492b;_0x5c9602[_0x3f9cfe(0x655)][_0x3f9cfe(0x2526)]=_0x3f9cfe(0xfe9);});}});function changeUsername(_0x3a4d4e){const _0x51a789=_0x2cf6d4;_0x3a4d4e[_0x51a789(0x1023)]();const _0x447518=document['getElementById']('moments-username')[_0x51a789(0x21dc)],_0x55406a=prompt(_0x51a789(0x1d96),_0x447518);if(_0x55406a!==null&&_0x55406a['trim']()!==''){const _0x20c30a=document['getElementById']('moments-username');_0x20c30a[_0x51a789(0x21dc)]=_0x55406a[_0x51a789(0x1424)](),saveMomentsImage('username',_0x55406a['trim']()),showToast(_0x51a789(0x120d),'success');}}function compressImage(_0x4916d1,_0x117dd6=0x320,_0x55786b=0.8){return new Promise(_0x1c8e42=>{const _0x324f02=_0x3a81,_0x45c4c8=document[_0x324f02(0x1ad8)](_0x324f02(0x1def)),_0x5680f9=_0x45c4c8[_0x324f02(0x20ff)]('2d'),_0x2a806d=new Image();_0x2a806d[_0x324f02(0xc28)]=function(){const _0x386e0a=_0x324f02;let {width:_0x170280,height:_0xb3c404}=_0x2a806d;_0x170280>_0x117dd6&&(_0xb3c404=_0xb3c404*_0x117dd6/_0x170280,_0x170280=_0x117dd6);_0x45c4c8[_0x386e0a(0xaab)]=_0x170280,_0x45c4c8[_0x386e0a(0x16b8)]=_0xb3c404,_0x5680f9[_0x386e0a(0x1173)](_0x2a806d,0x0,0x0,_0x170280,_0xb3c404);const _0x5b883e=_0x45c4c8[_0x386e0a(0x577)](_0x386e0a(0xf4f),_0x55786b);_0x1c8e42(_0x5b883e);},typeof _0x4916d1===_0x324f02(0xb97)?_0x2a806d[_0x324f02(0x107)]=_0x4916d1:_0x2a806d[_0x324f02(0x107)]=URL[_0x324f02(0x17c3)](_0x4916d1);});}async function saveMomentsImage(_0x2d03ba,_0x21645b){const _0x17daf5=_0x2cf6d4;try{let _0x59307a=_0x21645b;if(_0x21645b[_0x17daf5(0x1cab)](_0x17daf5(0xc14)))try{_0x59307a=await compressImage(_0x21645b,0x320,0.8);}catch(_0x44fca4){console[_0x17daf5(0x17cc)](_0x17daf5(0x34c),_0x44fca4);}await db[_0x17daf5(0x2217)][_0x17daf5(0x53a)]({'id':_0x17daf5(0x441)+_0x2d03ba,'type':_0x17daf5(0x1675),'data':_0x59307a}),console[_0x17daf5(0xc0d)](_0x17daf5(0x1d2)+_0x2d03ba);}catch(_0x18d79f){console['error'](_0x17daf5(0x1467),_0x18d79f);try{sessionStorage[_0x17daf5(0x2055)](_0x17daf5(0x441)+_0x2d03ba,_0x21645b),console[_0x17daf5(0xc0d)]('动态图片已保存到会话存储:\x20'+_0x2d03ba);}catch(_0x94ecaf){window['momentsImages']=window[_0x17daf5(0x10a)]||{},window['momentsImages'][_0x2d03ba]=_0x21645b,console['log'](_0x17daf5(0x227c)+_0x2d03ba);}}}async function getMomentsImage(_0x9e922f){const _0x35d836=_0x2cf6d4;try{const _0x2cf2ba=await db[_0x35d836(0x2217)][_0x35d836(0x46a)](_0x35d836(0x441)+_0x9e922f);if(_0x2cf2ba&&_0x2cf2ba['data'])return _0x2cf2ba[_0x35d836(0x4f2)];const _0x36a65f=sessionStorage['getItem'](_0x35d836(0x441)+_0x9e922f);if(_0x36a65f)return await saveMomentsImage(_0x9e922f,_0x36a65f),_0x36a65f;if(window[_0x35d836(0x10a)]&&window[_0x35d836(0x10a)][_0x9e922f])return window['momentsImages'][_0x9e922f];return null;}catch(_0x2743cd){console[_0x35d836(0x24ab)](_0x35d836(0x1334),_0x2743cd);try{return sessionStorage[_0x35d836(0x2250)](_0x35d836(0x441)+_0x9e922f);}catch(_0x20d5f9){return null;}}}function validateDataIntegrity(_0x4753d3,_0x4abb35){const _0x3052e5=_0x2cf6d4;if(!_0x4753d3)return![];switch(_0x4abb35){case _0x3052e5(0x164d):return Array[_0x3052e5(0x1bcc)](_0x4753d3)&&_0x4753d3[_0x3052e5(0xb05)](_0x27ebc0=>_0x27ebc0&&_0x27ebc0['id']&&_0x27ebc0[_0x3052e5(0x222f)]&&_0x27ebc0[_0x3052e5(0x222f)]!=='张三'&&_0x27ebc0[_0x3052e5(0x222f)]!=='李四');case'chatMessages':return Array[_0x3052e5(0x1bcc)](_0x4753d3)&&_0x4753d3['every'](_0x3dc327=>_0x3dc327&&_0x3dc327['id']&&_0x3dc327[_0x3052e5(0x10df)]);case _0x3052e5(0xb08):return Array[_0x3052e5(0x1bcc)](_0x4753d3)&&_0x4753d3[_0x3052e5(0xb05)](_0x54e81=>_0x54e81&&_0x54e81['id']&&_0x54e81[_0x3052e5(0x956)]);default:return Array[_0x3052e5(0x1bcc)](_0x4753d3)?_0x4753d3['length']>0x0:!!_0x4753d3;}}async function safeDataSave(_0xf30736,_0x1f14a4,_0x348a5a='replace'){const _0xdb689e=_0x2cf6d4;if(!_0x1f14a4||Array[_0xdb689e(0x1bcc)](_0x1f14a4)&&_0x1f14a4['length']===0x0)return console[_0xdb689e(0x17cc)]('⚠️\x20'+_0xf30736+'\x20数据为空，拒绝保存以防止数据丢失'),![];if(!validateDataIntegrity(_0x1f14a4,_0xf30736)){console[_0xdb689e(0x24ab)]('❌\x20'+_0xf30736+_0xdb689e(0x1dae));throw new Error(_0xf30736+_0xdb689e(0x1a8f));}try{const _0x2359d9=db[_0xf30736];if(!_0x2359d9)throw new Error('表\x20'+_0xf30736+_0xdb689e(0x1df1));await db[_0xdb689e(0x174a)]('rw',_0x2359d9,async()=>{const _0x45b57c=_0xdb689e;if(_0x348a5a===_0x45b57c(0x882))await _0x2359d9[_0x45b57c(0x2215)](),Array[_0x45b57c(0x1bcc)](_0x1f14a4)?await _0x2359d9['bulkPut'](_0x1f14a4):await _0x2359d9[_0x45b57c(0x53a)](_0x1f14a4);else _0x348a5a===_0x45b57c(0xe1)&&(Array[_0x45b57c(0x1bcc)](_0x1f14a4)?await _0x2359d9[_0x45b57c(0x24c8)](_0x1f14a4):await _0x2359d9[_0x45b57c(0xe1)](_0x1f14a4));});const _0x3d2a7a=Array[_0xdb689e(0x1bcc)](_0x1f14a4)?_0x1f14a4[_0xdb689e(0xcbf)]:0x1;return console[_0xdb689e(0xc0d)]('✅\x20安全保存了\x20'+_0x3d2a7a+_0xdb689e(0x17d4)+_0xf30736+_0xdb689e(0x2052)),!![];}catch(_0x22f1ea){console[_0xdb689e(0x24ab)](_0xdb689e(0x1e71)+_0xf30736+_0xdb689e(0x1384),_0x22f1ea);throw _0x22f1ea;}}async function resetDatabase(){const _0x48d317=_0x2cf6d4;try{await db['delete'](),console['log'](_0x48d317(0x1594)),location[_0x48d317(0x128e)]();}catch(_0x43c89c){console['error'](_0x48d317(0x612),_0x43c89c);}}async function recordGameEvent(_0x2b11a1,_0x35798d,_0x52e1a8){const _0x26cc93=_0x2cf6d4;try{await recordCrossAppEvent(_0x2b11a1,_0x26cc93(0xe67),_0x35798d,{'id':_0x26cc93(0x93c)+Date[_0x26cc93(0x18e0)](),'type':'game_session','gameName':_0x52e1a8['gameName'],'action':_0x35798d,'result':_0x52e1a8['result'],'score':_0x52e1a8[_0x26cc93(0xca5)],'chatContent':_0x52e1a8[_0x26cc93(0x542)],'timestamp':Date[_0x26cc93(0x18e0)]()}),console['log'](_0x26cc93(0x224f)+_0x35798d+'\x20-\x20'+_0x52e1a8['gameName']);}catch(_0x494e9a){console[_0x26cc93(0x24ab)]('记录游戏事件失败:',_0x494e9a);}}async function recordGameChat(_0x546f28,_0x144605,_0x308f82,_0x7eec4a){const _0x94ccd9=_0x2cf6d4;try{await recordCrossAppEvent(_0x546f28,_0x94ccd9(0xe67),_0x94ccd9(0x56a),{'id':'game_chat_'+Date[_0x94ccd9(0x18e0)](),'type':_0x94ccd9(0x56a),'sender':_0x144605,'content':_0x308f82,'gameName':_0x7eec4a[_0x94ccd9(0xb02)],'gameState':_0x7eec4a[_0x94ccd9(0xa96)],'timestamp':Date[_0x94ccd9(0x18e0)]()}),console[_0x94ccd9(0xc0d)](_0x94ccd9(0x205b)+_0x144605+_0x94ccd9(0x2316)+_0x308f82[_0x94ccd9(0x4b2)](0x0,0x1e)+_0x94ccd9(0x12da));}catch(_0x9d6fa8){console['error'](_0x94ccd9(0x1252),_0x9d6fa8);}}function startGame(_0x5afbe2){alert('🎮\x20游戏功能已移至聊天界面\x0a\x0a请在聊天界面的工具栏中点击游戏按钮来开始游戏！');}function togglePhoneBorder(){const _0x59f03=_0x2cf6d4,_0x3f9e3a=document[_0x59f03(0x566)]('phone-screen'),_0xe0273a=document['getElementById']('phone-border-toggle'),_0x29ca34=document[_0x59f03(0x172c)];_0xe0273a[_0x59f03(0x306)]?(_0x3f9e3a[_0x59f03(0x226e)]['add']('fullscreen-mode'),_0x29ca34[_0x59f03(0x226e)][_0x59f03(0xe1)](_0x59f03(0x20f6))):(_0x3f9e3a[_0x59f03(0x226e)][_0x59f03(0x128)](_0x59f03(0x20f6)),_0x29ca34['classList']['remove'](_0x59f03(0x20f6)));localStorage[_0x59f03(0x2055)](_0x59f03(0x1b87),_0xe0273a['checked']);const _0x28a022=_0xe0273a['checked']?_0x59f03(0x1495):_0x59f03(0x5c9);showToast(_0x28a022,_0x59f03(0xb27));}function showScreenSizeOptions(){showApp('screen-size-screen');}function changeScreenSize(_0x4c8578,_0x4cecbc,_0x224483){const _0x1eed6b=_0x2cf6d4,_0x14b172=document['getElementById'](_0x1eed6b(0x2379));_0x14b172[_0x1eed6b(0x655)][_0x1eed6b(0xaab)]=_0x4c8578+'px',_0x14b172[_0x1eed6b(0x655)][_0x1eed6b(0x16b8)]=_0x4cecbc+'px';const _0x32896d=document[_0x1eed6b(0x566)](_0x1eed6b(0x1ceb));_0x32896d&&(_0x32896d['textContent']=_0x1eed6b(0x1f65)+_0x4c8578+'×'+_0x4cecbc+'\x20('+_0x224483+')'),updateSizeSelectionState(_0x4c8578,_0x4cecbc,_0x224483),localStorage['setItem'](_0x1eed6b(0x1cdb),JSON['stringify']({'width':_0x4c8578,'height':_0x4cecbc,'name':_0x224483})),showToast(_0x1eed6b(0x188c)+_0x224483+'！',_0x1eed6b(0xb27)),setTimeout(()=>{const _0x3d3767=_0x1eed6b;showApp(_0x3d3767(0x203d));},0x12c);}function updateSizeSelectionState(_0x73c9aa,_0x5c81a9,_0x5d1fe8){const _0x30a73f=_0x2cf6d4;document[_0x30a73f(0x1ed9)](_0x30a73f(0xaf6))[_0x30a73f(0x900)](_0x217960=>{const _0x125edb=_0x30a73f;_0x217960[_0x125edb(0x655)][_0x125edb(0x2526)]=_0x125edb(0xfe9);}),document[_0x30a73f(0x1ed9)](_0x30a73f(0x1937))[_0x30a73f(0x900)](_0x13466f=>{const _0x4fe417=_0x30a73f;_0x13466f[_0x4fe417(0x655)][_0x4fe417(0xacd)]='';});let _0x4c81d0=null;if(_0x73c9aa===0x15e&&_0x5c81a9===0x2e4)_0x4c81d0=document[_0x30a73f(0x566)](_0x30a73f(0x85b));else{if(_0x73c9aa===0x1a9&&_0x5c81a9===0x35c)_0x4c81d0=document[_0x30a73f(0x15b8)]('.size-option[onclick*=\x22425,\x20860\x22]');else{if(_0x73c9aa===0x1c2&&_0x5c81a9===0x3b6)_0x4c81d0=document['querySelector'](_0x30a73f(0x103d));else{_0x4c81d0=document[_0x30a73f(0x566)](_0x30a73f(0x1085));const _0x308d44=document['getElementById']('custom-size-desc');_0x308d44&&(_0x308d44['textContent']=_0x73c9aa+'×'+_0x5c81a9+'\x20('+_0x5d1fe8+')');}}}if(_0x4c81d0){const _0x4e8549=_0x4c81d0[_0x30a73f(0x15b8)]('.check-icon');_0x4e8549&&(_0x4e8549[_0x30a73f(0x655)][_0x30a73f(0x2526)]=_0x30a73f(0x2d4)),_0x4c81d0[_0x30a73f(0x655)][_0x30a73f(0xacd)]=_0x30a73f(0x147a);}}function loadScreenSize(){const _0x3242f1=_0x2cf6d4,_0x5e3f6d=localStorage[_0x3242f1(0x2250)]('screenSize');if(_0x5e3f6d){const {width:_0x3bbc90,height:_0x2f5a22,name:_0x2209c6}=JSON[_0x3242f1(0x168e)](_0x5e3f6d),_0x2494a1=document[_0x3242f1(0x566)]('phone-screen');_0x2494a1[_0x3242f1(0x655)]['width']=_0x3bbc90+'px',_0x2494a1['style'][_0x3242f1(0x16b8)]=_0x2f5a22+'px';const _0x1169ab=document[_0x3242f1(0x566)]('current-screen-size');_0x1169ab&&(_0x1169ab[_0x3242f1(0x21dc)]=_0x3242f1(0x1f65)+_0x3bbc90+'×'+_0x2f5a22+'\x20('+_0x2209c6+')'),updateSizeSelectionState(_0x3bbc90,_0x2f5a22,_0x2209c6);}}function showCustomSizeModal(){const _0x1765a3=_0x2cf6d4,_0xfee945=localStorage[_0x1765a3(0x2250)]('screenSize');if(_0xfee945){const {width:_0x3ae951,height:_0x100abe,name:_0x406202}=JSON[_0x1765a3(0x168e)](_0xfee945);document[_0x1765a3(0x566)](_0x1765a3(0x22f2))[_0x1765a3(0xc34)]=_0x3ae951,document[_0x1765a3(0x566)](_0x1765a3(0x54a))[_0x1765a3(0xc34)]=_0x100abe,_0x406202[_0x1765a3(0x23ec)]('自定义')&&(document[_0x1765a3(0x566)](_0x1765a3(0xff2))[_0x1765a3(0xc34)]=_0x406202);}updateCustomSizePreview(),showModal(_0x1765a3(0x253c));}function updateCustomSizePreview(){const _0x3e863a=_0x2cf6d4,_0x5112c2=parseInt(document[_0x3e863a(0x566)](_0x3e863a(0x22f2))[_0x3e863a(0xc34)])||0x15e,_0x2b30a4=parseInt(document['getElementById']('custom-height')[_0x3e863a(0xc34)])||0x2e4,_0x48d24d=document['getElementById'](_0x3e863a(0x1f64)),_0x54d88c=_0x48d24d[_0x3e863a(0x15b8)](_0x3e863a(0x1aa1)),_0x16492e=0x64,_0x51b52e=0x96,_0x48290a=Math[_0x3e863a(0x21f7)](_0x16492e/_0x5112c2,_0x51b52e/_0x2b30a4),_0x490d92=_0x5112c2*_0x48290a,_0x201fb8=_0x2b30a4*_0x48290a;_0x54d88c[_0x3e863a(0x655)]['width']=_0x490d92+'px',_0x54d88c[_0x3e863a(0x655)][_0x3e863a(0x16b8)]=_0x201fb8+'px';}function applyCustomScreenSize(){const _0x1d6da9=_0x2cf6d4,_0x309c69=parseInt(document['getElementById'](_0x1d6da9(0x22f2))[_0x1d6da9(0xc34)]),_0x1556bf=parseInt(document['getElementById']('custom-height')[_0x1d6da9(0xc34)]),_0x3def20=document[_0x1d6da9(0x566)](_0x1d6da9(0xff2))[_0x1d6da9(0xc34)][_0x1d6da9(0x1424)]()||_0x1d6da9(0x1267);if(!_0x309c69||!_0x1556bf||_0x309c69<0xc8||_0x309c69>0x320||_0x1556bf<0x190||_0x1556bf>0x4b0){showToast(_0x1d6da9(0x1b80),_0x1d6da9(0x24ab));return;}const _0x1cc6b7=document[_0x1d6da9(0x566)](_0x1d6da9(0x2379));_0x1cc6b7['style'][_0x1d6da9(0xaab)]=_0x309c69+'px',_0x1cc6b7[_0x1d6da9(0x655)][_0x1d6da9(0x16b8)]=_0x1556bf+'px';const _0xd7f2a3=document[_0x1d6da9(0x566)]('current-screen-size');_0xd7f2a3&&(_0xd7f2a3[_0x1d6da9(0x21dc)]=_0x1d6da9(0x1f65)+_0x309c69+'×'+_0x1556bf+'\x20('+_0x3def20+')'),updateSizeSelectionState(_0x309c69,_0x1556bf,_0x3def20),localStorage['setItem'](_0x1d6da9(0x1cdb),JSON[_0x1d6da9(0x7fb)]({'width':_0x309c69,'height':_0x1556bf,'name':_0x3def20})),hideModal(_0x1d6da9(0x253c)),showToast(_0x1d6da9(0xcc3)+_0x3def20+'！',_0x1d6da9(0xb27)),setTimeout(()=>{const _0x2e823a=_0x1d6da9;showApp(_0x2e823a(0x203d));},0x12c);}document[_0x2cf6d4(0x167)](_0x2cf6d4(0x7f7),function(){const _0x203d69=_0x2cf6d4,_0x4f27ab=document[_0x203d69(0x566)](_0x203d69(0x22f2)),_0x24b633=document['getElementById'](_0x203d69(0x54a));_0x4f27ab&&_0x24b633&&(_0x4f27ab['addEventListener'](_0x203d69(0x627),updateCustomSizePreview),_0x24b633[_0x203d69(0x167)]('input',updateCustomSizePreview));});function updateStatusIcon(){const _0x5db1ae=_0x2cf6d4,_0xb50a60=document['getElementById'](_0x5db1ae(0x15d7)),_0x8e5774=_0xb50a60[_0x5db1ae(0xc34)][_0x5db1ae(0x1424)]()||'';document[_0x5db1ae(0x1788)]['style'][_0x5db1ae(0x16db)]('--status-icon','\x22'+_0x8e5774+'\x22'),localStorage[_0x5db1ae(0x2055)](_0x5db1ae(0x18d3),_0x8e5774);}function resetStatusIcon(){const _0x3a2d36=_0x2cf6d4,_0x2055af=document[_0x3a2d36(0x566)](_0x3a2d36(0x15d7));_0x2055af[_0x3a2d36(0xc34)]='',updateStatusIcon();}function toggleHomeFontDropdown(){const _0x23c7c4=_0x2cf6d4,_0x49f6b1=document[_0x23c7c4(0x566)]('home-font-dropdown'),_0x1c3788=document[_0x23c7c4(0x15b8)](_0x23c7c4(0xc99));_0x49f6b1['style'][_0x23c7c4(0x2526)]===_0x23c7c4(0xfe9)||!_0x49f6b1[_0x23c7c4(0x655)][_0x23c7c4(0x2526)]?(_0x49f6b1['style'][_0x23c7c4(0x2526)]=_0x23c7c4(0x2d4),_0x1c3788[_0x23c7c4(0x226e)][_0x23c7c4(0xe1)](_0x23c7c4(0x11cc)),setTimeout(()=>{const _0x388b74=_0x23c7c4;document[_0x388b74(0x167)](_0x388b74(0x1e62),closeHomeFontDropdown);},0x0)):(_0x49f6b1[_0x23c7c4(0x655)]['display']='none',_0x1c3788[_0x23c7c4(0x226e)]['remove']('open'),document['removeEventListener'](_0x23c7c4(0x1e62),closeHomeFontDropdown));}function closeHomeFontDropdown(_0x261afd){const _0x12e0e4=_0x2cf6d4,_0x12a88a=document[_0x12e0e4(0x566)](_0x12e0e4(0x218f)),_0x196e6b=document[_0x12e0e4(0x15b8)](_0x12e0e4(0xc99));!_0x196e6b['contains'](_0x261afd[_0x12e0e4(0x1144)])&&(_0x12a88a[_0x12e0e4(0x655)]['display']=_0x12e0e4(0xfe9),_0x196e6b['classList']['remove'](_0x12e0e4(0x11cc)),document[_0x12e0e4(0x6be)](_0x12e0e4(0x1e62),closeHomeFontDropdown));}function selectHomeFont(_0x5b2569){const _0x2f723b=_0x2cf6d4;document[_0x2f723b(0x172c)]['setAttribute']('data-home-font',_0x5b2569),updateHomeFontSelector(_0x5b2569),updateHomeFontDropdown(_0x5b2569),localStorage[_0x2f723b(0x2055)](_0x2f723b(0x1f47),_0x5b2569);const _0x1987f2=document['getElementById'](_0x2f723b(0x218f)),_0xce05bc=document[_0x2f723b(0x15b8)]('.home-font-selector');_0x1987f2[_0x2f723b(0x655)][_0x2f723b(0x2526)]='none',_0xce05bc['classList'][_0x2f723b(0x128)](_0x2f723b(0x11cc)),document['removeEventListener']('click',closeHomeFontDropdown);const _0x3be069={'black':'黑色','white':'白色'};showToast(_0x2f723b(0x18d6)+_0x3be069[_0x5b2569],_0x2f723b(0xb27));}function updateHomeFontSelector(_0x4e9891){const _0x1788ae=_0x2cf6d4,_0x573928={'black':'黑色','white':'白色'},_0x56d20e=document[_0x1788ae(0x566)]('current-home-font-text');_0x56d20e&&(_0x56d20e['textContent']=_0x573928[_0x4e9891]||'黑色');}function updateHomeFontDropdown(_0x5b9fd4){const _0x49f867=_0x2cf6d4,_0x161746=document['querySelectorAll'](_0x49f867(0x911));_0x161746[_0x49f867(0x900)](_0x3db646=>{const _0x3611c4=_0x49f867;_0x3db646[_0x3611c4(0x226e)][_0x3611c4(0x128)](_0x3611c4(0x876)),_0x3db646[_0x3611c4(0x11cf)][_0x3611c4(0x9a3)]()[_0x3611c4(0x23ec)]('\x27'+_0x5b9fd4+'\x27')&&_0x3db646[_0x3611c4(0x226e)]['add'](_0x3611c4(0x876));});}function setHomeFontColor(_0x3e431a){selectHomeFont(_0x3e431a);}function updateHomeFontColorButtons(_0x256afb){}function toggleClockStyleDropdown(){const _0x1fa3ed=_0x2cf6d4,_0x21f341=document[_0x1fa3ed(0x566)](_0x1fa3ed(0x2024)),_0x381864=document[_0x1fa3ed(0x15b8)](_0x1fa3ed(0x23d9));_0x21f341[_0x1fa3ed(0x655)][_0x1fa3ed(0x2526)]===_0x1fa3ed(0xfe9)||!_0x21f341[_0x1fa3ed(0x655)][_0x1fa3ed(0x2526)]?(_0x21f341['style'][_0x1fa3ed(0x2526)]=_0x1fa3ed(0x2d4),_0x381864[_0x1fa3ed(0x226e)][_0x1fa3ed(0xe1)]('open'),setTimeout(()=>{const _0x55b3e3=_0x1fa3ed;document[_0x55b3e3(0x167)](_0x55b3e3(0x1e62),closeClockStyleDropdown);},0x0)):(_0x21f341[_0x1fa3ed(0x655)][_0x1fa3ed(0x2526)]='none',_0x381864[_0x1fa3ed(0x226e)][_0x1fa3ed(0x128)](_0x1fa3ed(0x11cc)),document[_0x1fa3ed(0x6be)](_0x1fa3ed(0x1e62),closeClockStyleDropdown));}function closeClockStyleDropdown(_0x121a81){const _0x1d3643=_0x2cf6d4,_0x19403a=document['getElementById'](_0x1d3643(0x2024)),_0x53ac1f=document[_0x1d3643(0x15b8)](_0x1d3643(0x23d9));!_0x53ac1f[_0x1d3643(0x1f9)](_0x121a81[_0x1d3643(0x1144)])&&(_0x19403a[_0x1d3643(0x655)][_0x1d3643(0x2526)]='none',_0x53ac1f[_0x1d3643(0x226e)]['remove']('open'),document['removeEventListener'](_0x1d3643(0x1e62),closeClockStyleDropdown));}function selectClockStyle(_0x3c35f9){const _0x111c29=_0x2cf6d4;document[_0x111c29(0x172c)][_0x111c29(0x1dd4)]('data-clock-style',_0x3c35f9),updateClockStyleSelector(_0x3c35f9),updateClockStyleDropdown(_0x3c35f9),localStorage['setItem'](_0x111c29(0x2ac),_0x3c35f9);const _0x53e2d9=document['getElementById'](_0x111c29(0x2024)),_0x4ec4e3=document[_0x111c29(0x15b8)](_0x111c29(0x23d9));_0x53e2d9['style'][_0x111c29(0x2526)]=_0x111c29(0xfe9),_0x4ec4e3[_0x111c29(0x226e)]['remove']('open'),document[_0x111c29(0x6be)](_0x111c29(0x1e62),closeClockStyleDropdown);const _0x26cf62={'default':_0x111c29(0x13ed),'bold':_0x111c29(0x8f8),'compact':'紧凑样式','modern':_0x111c29(0x1531)};showToast('时间日期样式已设置为'+_0x26cf62[_0x3c35f9],_0x111c29(0xb27));}function updateClockStyleSelector(_0x158efd){const _0x16a6ac=_0x2cf6d4,_0x552b61={'default':'默认','bold':'粗体','compact':'紧凑','modern':'现代'},_0x39d260=document[_0x16a6ac(0x566)](_0x16a6ac(0x2194));_0x39d260&&(_0x39d260[_0x16a6ac(0x21dc)]=_0x552b61[_0x158efd]||'默认');}function updateClockStyleDropdown(_0x50ba3a){const _0x5db1d3=_0x2cf6d4,_0x29a42a=document['querySelectorAll'](_0x5db1d3(0x1d1a));_0x29a42a[_0x5db1d3(0x900)]((_0x430300,_0x429f83)=>{const _0x367c9f=_0x5db1d3,_0xf2f701=[_0x367c9f(0xbf),_0x367c9f(0x1807),_0x367c9f(0x1020),_0x367c9f(0x1dc)];_0xf2f701[_0x429f83]===_0x50ba3a?_0x430300[_0x367c9f(0x226e)][_0x367c9f(0xe1)](_0x367c9f(0x876)):_0x430300[_0x367c9f(0x226e)]['remove'](_0x367c9f(0x876));});}function loadClockStyleSetting(){const _0x43f5bb=_0x2cf6d4,_0x30e31d=localStorage[_0x43f5bb(0x2250)](_0x43f5bb(0x2ac))||_0x43f5bb(0xbf);document[_0x43f5bb(0x172c)]['setAttribute'](_0x43f5bb(0x31a),_0x30e31d),updateClockStyleSelector(_0x30e31d),updateClockStyleDropdown(_0x30e31d);}function loadHomeFontColorSetting(){const _0x30c769=_0x2cf6d4,_0x584fa8=localStorage[_0x30c769(0x2250)](_0x30c769(0x1f47))||_0x30c769(0x2326);document[_0x30c769(0x172c)][_0x30c769(0x1dd4)](_0x30c769(0x2de),_0x584fa8),updateHomeFontSelector(_0x584fa8),updateHomeFontDropdown(_0x584fa8);}function loadStatusIconSetting(){const _0x29ba83=_0x2cf6d4,_0x7b36b8=localStorage[_0x29ba83(0x2250)](_0x29ba83(0x18d3)),_0x2da2c2=document[_0x29ba83(0x566)](_0x29ba83(0x15d7)),_0x1316ea=_0x7b36b8||'';_0x2da2c2&&(_0x2da2c2[_0x29ba83(0xc34)]=_0x1316ea),document['documentElement'][_0x29ba83(0x655)][_0x29ba83(0x16db)](_0x29ba83(0x1a1e),'\x22'+_0x1316ea+'\x22');}function loadPhoneBorderSetting(){const _0x55d9aa=_0x2cf6d4,_0x4aecc0=localStorage['getItem'](_0x55d9aa(0x1b87)),_0x148b34=document[_0x55d9aa(0x566)](_0x55d9aa(0xe33)),_0x4195da=_0x4aecc0!==null?_0x4aecc0===_0x55d9aa(0x8f1):![];_0x148b34&&(_0x148b34['checked']=_0x4195da);const _0x2ced29=document[_0x55d9aa(0x566)]('phone-screen'),_0x159e8d=document['body'];_0x4195da?(_0x2ced29[_0x55d9aa(0x226e)][_0x55d9aa(0xe1)](_0x55d9aa(0x20f6)),_0x159e8d['classList'][_0x55d9aa(0xe1)](_0x55d9aa(0x20f6))):(_0x2ced29[_0x55d9aa(0x226e)][_0x55d9aa(0x128)](_0x55d9aa(0x20f6)),_0x159e8d['classList'][_0x55d9aa(0x128)](_0x55d9aa(0x20f6)));}function showToast(_0x362079,_0x284aed=_0x2cf6d4(0x2422)){const _0x4cebe8=_0x2cf6d4,_0x20f56c=document[_0x4cebe8(0x1ad8)]('div');_0x20f56c[_0x4cebe8(0x655)][_0x4cebe8(0x17a3)]=_0x4cebe8(0xe43)+(_0x284aed===_0x4cebe8(0xb27)?'#4CAF50':_0x284aed===_0x4cebe8(0x24ab)?_0x4cebe8(0x1dd7):_0x4cebe8(0x207c))+_0x4cebe8(0x15aa),_0x20f56c[_0x4cebe8(0x21dc)]=_0x362079,document[_0x4cebe8(0x172c)]['appendChild'](_0x20f56c),setTimeout(()=>{const _0x5177d3=_0x4cebe8;_0x20f56c[_0x5177d3(0x655)]['opacity']='1';},0xa),setTimeout(()=>{const _0x43dc44=_0x4cebe8;_0x20f56c[_0x43dc44(0x655)]['opacity']='0',setTimeout(()=>{const _0x7c31f0=_0x43dc44;_0x20f56c[_0x7c31f0(0xe9)]&&_0x20f56c[_0x7c31f0(0xe9)][_0x7c31f0(0x1624)](_0x20f56c);},0x12c);},0xbb8);}function truncateText(_0x4c767b,_0x923f3f=0x32){const _0x2a4163=_0x2cf6d4;let _0x2beaf8='';if(typeof _0x4c767b==='string')_0x2beaf8=_0x4c767b;else return _0x4c767b&&typeof _0x4c767b==='object'?(console[_0x2a4163(0x17cc)](_0x2a4163(0x1125),_0x4c767b),_0x2a4163(0x1f6f)):'';const _0x2d91ea=_0x2beaf8[_0x2a4163(0x882)](/<[^>]*>/g,''),_0x2c3fa3=_0x2d91ea[_0x2a4163(0x882)](/\s+/g,'\x20')['trim']();if(_0x2c3fa3[_0x2a4163(0xcbf)]<=_0x923f3f)return _0x2c3fa3;return _0x2c3fa3[_0x2a4163(0x4b2)](0x0,_0x923f3f)+_0x2a4163(0x12da);}function addMessageWithAnimation(_0x28a055,_0x34e032){const _0x4db150=_0x2cf6d4,_0x5b04d=document[_0x4db150(0x566)](_0x4db150(0x24e7));if(!_0x5b04d||!currentChatCharacter||_0x34e032!==currentChatCharacter['id'])return;_0x28a055[_0x4db150(0xf75)]==='received'&&!_0x28a055[_0x4db150(0xc7)]&&SoundManager[_0x4db150(0x10f4)](SoundManager[_0x4db150(0x24a1)]['MESSAGE_RECEIVED'],_0x34e032);const _0x1996d3=getCurrentChatSettings(),_0x4ce87a=_0x1996d3[_0x4db150(0x9c1)]!==![],_0xd8a66e=_0x1996d3[_0x4db150(0x19ec)]||_0x4db150(0x23a1);if(_0x4ce87a&&_0xd8a66e===_0x4db150(0x23a1)&&_0x28a055[_0x4db150(0xf75)]!==_0x4db150(0x212)){const _0x4725e0=_0x5b04d['querySelectorAll']('.timestamp-center');let _0x23c88a=!![];if(_0x4725e0['length']>0x0){const _0x134ee7=_0x4725e0[_0x4725e0['length']-0x1],_0x193bf6=parseInt(_0x134ee7[_0x4db150(0x1f26)][_0x4db150(0x253f)]),_0x12c2e7=_0x28a055['timestamp']-_0x193bf6;_0x23c88a=_0x12c2e7>0x5*0x3c*0x3e8;}if(_0x23c88a){const _0x1a929e=document[_0x4db150(0x1ad8)](_0x4db150(0x526));_0x1a929e['className']=_0x4db150(0x14db),_0x1a929e[_0x4db150(0x21dc)]=formatTimestamp(_0x28a055[_0x4db150(0x7aa)]),_0x1a929e[_0x4db150(0x1f26)][_0x4db150(0x253f)]=_0x28a055[_0x4db150(0x7aa)],_0x5b04d['appendChild'](_0x1a929e);}}if(_0x28a055[_0x4db150(0xf75)]==='system'){if(_0x28a055[_0x4db150(0x245d)]){const _0x1754c6=document[_0x4db150(0x1ad8)](_0x4db150(0x526));_0x1754c6[_0x4db150(0x655)]['display']=_0x4db150(0x1f0b),_0x1754c6[_0x4db150(0x655)]['justifyContent']=_0x4db150(0x23a1),_0x1754c6[_0x4db150(0x655)][_0x4db150(0x1bf7)]=_0x4db150(0x23dd),_0x1754c6[_0x4db150(0x1f26)][_0x4db150(0x61f)]=_0x28a055['id'];const _0x2fc18a=document[_0x4db150(0x1ad8)](_0x4db150(0x526));_0x2fc18a[_0x4db150(0x221)]=_0x4db150(0x21a7),_0x2fc18a['textContent']=_0x28a055[_0x4db150(0x1423)]||_0x4db150(0x81e),_0x1754c6[_0x4db150(0x1925)](_0x2fc18a),_0x5b04d[_0x4db150(0x1925)](_0x1754c6);return;}let _0x52fc1f;if(_0x28a055['isPoke']){const _0x5407e8=document[_0x4db150(0x1ad8)](_0x4db150(0x526));_0x5407e8[_0x4db150(0x221)]='poke-system-container';const _0x21e509=document[_0x4db150(0x1ad8)]('div');_0x21e509[_0x4db150(0x221)]=_0x4db150(0x23b4),_0x21e509['textContent']=_0x28a055[_0x4db150(0x1423)],_0x5407e8[_0x4db150(0x1925)](_0x21e509),_0x52fc1f=_0x5407e8;}else{if(_0x28a055['type']==='system_notification'){const _0xee21b3=document[_0x4db150(0x1ad8)](_0x4db150(0x526));_0xee21b3[_0x4db150(0x655)][_0x4db150(0x2526)]=_0x4db150(0x1f0b),_0xee21b3['style'][_0x4db150(0x1571)]=_0x4db150(0x23a1),_0xee21b3[_0x4db150(0x655)][_0x4db150(0x1bf7)]=_0x4db150(0x23dd),_0xee21b3[_0x4db150(0x1f26)][_0x4db150(0x61f)]=_0x28a055['id'];const _0x351e76=document[_0x4db150(0x1ad8)](_0x4db150(0x526));_0x351e76['className']='system-notification',_0x351e76[_0x4db150(0x655)]['cssText']=_0x4db150(0x1876);const _0x102e46=typeof _0x28a055[_0x4db150(0x1423)]===_0x4db150(0xb97)?_0x28a055['content']:_0x28a055['content']&&typeof _0x28a055[_0x4db150(0x1423)]===_0x4db150(0x3c4)?JSON[_0x4db150(0x7fb)](_0x28a055[_0x4db150(0x1423)]):String(_0x28a055[_0x4db150(0x1423)]||'');_0x351e76[_0x4db150(0x21dc)]=_0x102e46,typeof _0x28a055[_0x4db150(0x1423)]!==_0x4db150(0xb97)&&console[_0x4db150(0x17cc)](_0x4db150(0x9df),{'messageId':_0x28a055['id'],'contentType':typeof _0x28a055['content'],'content':_0x28a055[_0x4db150(0x1423)]}),_0xee21b3[_0x4db150(0x1925)](_0x351e76),_0x52fc1f=_0xee21b3;}else{if(_0x28a055[_0x4db150(0x23df)]==='recalled_message'){const _0xfa9c6e=document[_0x4db150(0x1ad8)](_0x4db150(0x526));_0xfa9c6e['style'][_0x4db150(0x2526)]=_0x4db150(0x1f0b),_0xfa9c6e[_0x4db150(0x655)]['justifyContent']=_0x4db150(0x23a1),_0xfa9c6e['style'][_0x4db150(0x1bf7)]=_0x4db150(0x23dd),_0xfa9c6e['dataset'][_0x4db150(0x61f)]=_0x28a055['id'];const _0x3c0d38=document[_0x4db150(0x1ad8)](_0x4db150(0x526));_0x3c0d38[_0x4db150(0x221)]='recalled-message';const _0x30cab1=_0x28a055[_0x4db150(0x1423)][_0x4db150(0x633)]('\x0a'),_0x29e8a7=_0x30cab1[0x0],_0x2772c7=_0x30cab1[0x1];_0x3c0d38['textContent']=_0x29e8a7;if(_0x2772c7&&_0x2772c7[_0x4db150(0x1cab)](_0x4db150(0xce4))){const _0x2904e6=document[_0x4db150(0x1ad8)](_0x4db150(0x526));_0x2904e6[_0x4db150(0x221)]='original-text',_0x2904e6['textContent']=_0x2772c7,_0x3c0d38['appendChild'](_0x2904e6);}_0xfa9c6e[_0x4db150(0x1925)](_0x3c0d38),_0x52fc1f=_0xfa9c6e,addMessageLongPressListener(_0xfa9c6e,_0x28a055['id']);}else{const _0x2c5b92=document[_0x4db150(0x1ad8)](_0x4db150(0x526));_0x2c5b92[_0x4db150(0x655)][_0x4db150(0x2526)]=_0x4db150(0x1f0b),_0x2c5b92[_0x4db150(0x655)]['justifyContent']=_0x4db150(0x23a1),_0x2c5b92[_0x4db150(0x655)][_0x4db150(0x1bf7)]=_0x4db150(0x23dd);const _0x19bf4b=document[_0x4db150(0x1ad8)](_0x4db150(0x526));_0x28a055[_0x4db150(0x158d)]?_0x19bf4b[_0x4db150(0x221)]=_0x4db150(0xe93):_0x19bf4b[_0x4db150(0x221)]=_0x4db150(0x21a7),_0x19bf4b['textContent']=_0x28a055[_0x4db150(0x1423)],_0x2c5b92['appendChild'](_0x19bf4b),_0x52fc1f=_0x2c5b92;}}}_0x52fc1f[_0x4db150(0x655)][_0x4db150(0x671)]='0',_0x52fc1f[_0x4db150(0x655)][_0x4db150(0x2006)]=_0x4db150(0x1c6b),_0x5b04d['appendChild'](_0x52fc1f),requestAnimationFrame(()=>{const _0xbc057a=_0x4db150;_0x52fc1f[_0xbc057a(0x226e)][_0xbc057a(0xe1)](_0xbc057a(0xe34));});return;}let _0x93e53d=document[_0x4db150(0x1ad8)](_0x4db150(0x526));const _0xfe1210=_0x28a055[_0x4db150(0xe29)]&&!_0x28a055[_0x4db150(0x1423)];_0x93e53d[_0x4db150(0x221)]=_0x4db150(0x51a)+_0x28a055[_0x4db150(0xf75)]+(_0x1996d3[_0x4db150(0x1e22)]?_0x4db150(0x2125):'')+(_0xfe1210?_0x4db150(0x6b4):''),_0x93e53d[_0x4db150(0x1f26)][_0x4db150(0x61f)]=_0x28a055['id'];if(_0x28a055[_0x4db150(0xf75)]===_0x4db150(0x232)){let _0x5c1e0d=characters['find'](_0x5e3487=>_0x5e3487['id']===_0x34e032),_0xd8779e=![],_0x2d7377=null;!_0x5c1e0d&&(_0x2d7377=groupChats[_0x4db150(0x1aeb)](_0x589a84=>_0x589a84['id']===_0x34e032),_0x2d7377&&(_0xd8779e=!![]));let _0x5d042e='',_0x18f868='',_0x4393ee=_0x4db150(0x23b8),_0x273d2e=null;if(_0xd8779e&&_0x2d7377){console[_0x4db150(0xc0d)](_0x4db150(0x3f1),_0x28a055[_0x4db150(0x210b)],'name:',_0x28a055[_0x4db150(0x222f)]),console['log']('🔍\x20[addMessageWithAnimation]\x20群成员列表:',_0x2d7377[_0x4db150(0xcaa)]),console[_0x4db150(0xc0d)](_0x4db150(0x10b9),_0x28a055);_0x28a055['isEmoji']&&console['log'](_0x4db150(0x18b9),{'senderId':_0x28a055[_0x4db150(0x210b)],'name':_0x28a055[_0x4db150(0x222f)],'image':_0x28a055[_0x4db150(0xe5b)],'emojiDescription':_0x28a055[_0x4db150(0x13e3)]});if(_0x28a055[_0x4db150(0x210b)])_0x273d2e=_0x2d7377[_0x4db150(0xcaa)]['find'](_0x16811c=>_0x16811c['id']===_0x28a055[_0x4db150(0x210b)]),console[_0x4db150(0xc0d)]('🔍\x20[addMessageWithAnimation]\x20通过senderId找到成员:',_0x273d2e);else _0x28a055['name']&&(_0x273d2e=_0x2d7377[_0x4db150(0xcaa)]['find'](_0x3ecb65=>_0x3ecb65[_0x4db150(0x222f)]===_0x28a055[_0x4db150(0x222f)]),console[_0x4db150(0xc0d)](_0x4db150(0x1989),_0x273d2e));_0x273d2e?(_0x5d042e=_0x273d2e['avatarUrl']||'',_0x18f868=_0x273d2e['name'],_0x4393ee=_0x273d2e[_0x4db150(0x2099)]||_0x4db150(0x23b8)):(_0x5d042e='',_0x18f868=_0x28a055[_0x4db150(0x222f)]||_0x4db150(0xd61),_0x4393ee=_0x4db150(0x23b8),console['warn'](_0x4db150(0x169),_0x28a055[_0x4db150(0x222f)])),console[_0x4db150(0xc0d)]('🔍\x20[addMessageWithAnimation]\x20最终头像:',_0x5d042e,'显示名:',_0x18f868);}else _0x5c1e0d?(_0x5d042e=_0x1996d3[_0x4db150(0x23e0)]||_0x5c1e0d['avatarUrl'],_0x18f868=_0x1996d3[_0x4db150(0x1967)]||_0x5c1e0d['name'],_0x4393ee=_0x5c1e0d[_0x4db150(0x2099)]||'#4CAF50'):(_0x5d042e='',_0x18f868='未知',_0x4393ee=_0x4db150(0x23b8));let _0xa49513=_0x1996d3[_0x4db150(0x2116)]||_0x4db150(0x1679);if(_0xd8779e&&_0x2d7377&&_0x28a055[_0x4db150(0x210b)]&&_0x1996d3['memberBubbleColors']){const _0x3cb3a0=_0x1996d3[_0x4db150(0xb52)][_0x28a055[_0x4db150(0x210b)]];_0x3cb3a0&&(_0xa49513=_0x3cb3a0);}const _0x175506=_0x1996d3[_0x4db150(0xaf0)]||'1',_0x32fdef=isLightColor(_0xa49513)?_0x4db150(0x194f):_0x4db150(0x18a7),_0x520769=_0x1996d3[_0x4db150(0x1068)]||'12';let _0x22f43b='';if(_0x28a055['type']===_0x4db150(0x1bfd))_0x22f43b='';else{if(_0x28a055[_0x4db150(0x23df)]===_0x4db150(0x14a6)){const _0x363335=_0x28a055[_0x4db150(0x18cb)]||_0x28a055[_0x4db150(0x1423)]||_0x4db150(0x2e0);_0x22f43b=_0x4db150(0xea2)+_0x363335[_0x4db150(0x882)](/'/g,'\x5c\x27')[_0x4db150(0x882)](/"/g,'&quot;')+_0x4db150(0x15fa)+_0x363335+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';}else{if(_0x28a055[_0x4db150(0x23df)]===_0x4db150(0xb93)){const _0x23237a=_0x28a055[_0x4db150(0x18d1)]||_0x28a055[_0x4db150(0x1423)]||'AI描述的图片';_0x22f43b=_0x4db150(0xea2)+_0x23237a['replace'](/'/g,'\x5c\x27')[_0x4db150(0x882)](/"/g,_0x4db150(0xca))+'\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22dreamy-photo\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22photo-misty-bg\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22photo-badge\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-image\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sparkle-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sparkle\x20sparkle-1\x22>✨</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sparkle\x20sparkle-2\x22>⭐</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sparkle\x20sparkle-3\x22>✨</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sparkle\x20sparkle-4\x22>⭐</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sparkle\x20sparkle-5\x22>💫</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22photo-text-overlay\x22\x20style=\x22display:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22photo-description\x22>'+_0x23237a+_0x4db150(0x40d);}else{if(_0x28a055[_0x4db150(0x23df)]===_0x4db150(0x63b)){const _0x229b6c=_0x28a055[_0x4db150(0xf7e)]||_0x28a055[_0x4db150(0x222f)]||_0x4db150(0x254d);_0x22f43b=_0x4db150(0x2190)+_0x229b6c+_0x4db150(0x33f)+_0x229b6c+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22location-card-map\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22map-background\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22map-roads\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22road\x20road-horizontal\x22\x20style=\x22top:\x2035%;\x20width:\x20100%;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22road\x20road-vertical\x22\x20style=\x22left:\x2040%;\x20height:\x20100%;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22road\x20road-horizontal\x22\x20style=\x22top:\x2065%;\x20width:\x2070%;\x20left:\x2030%;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22map-buildings\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22building\x22\x20style=\x22top:\x2020%;\x20left:\x2010%;\x20width:\x2015px;\x20height:\x2015px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22building\x22\x20style=\x22top:\x2045%;\x20left:\x2060%;\x20width:\x2012px;\x20height:\x2012px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22building\x22\x20style=\x22top:\x2070%;\x20left:\x2015%;\x20width:\x2018px;\x20height:\x2018px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22map-marker\x22\x20style=\x22top:\x2050%;\x20left:\x2050%;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';}else{if(_0x28a055[_0x4db150(0x23df)]===_0x4db150(0xd8)){const _0x224b5a=_0x28a055[_0x4db150(0x1562)]==='user',_0xef1022=_0x224b5a?'💕':'💖',_0x5f1b21=_0x224b5a?'你发起的转账':_0x4db150(0x1169);let _0x595246='',_0x540abd='',_0xc95d91='';if(_0x28a055[_0x4db150(0xe54)]===_0x4db150(0x15d2))_0x540abd='<div\x20class=\x22transfer-status\x22>'+(_0x224b5a?_0x4db150(0x1dd9):_0x4db150(0x1dde))+_0x4db150(0xa54),_0x595246=_0x4db150(0x15d2);else{if(_0x28a055['status']==='rejected')_0x540abd=_0x4db150(0x1f14)+(_0x224b5a?_0x4db150(0x1213):_0x4db150(0x939))+_0x4db150(0xa54),_0x595246=_0x4db150(0x1164);else!_0x224b5a&&(_0xc95d91=_0x4db150(0x120e)+JSON[_0x4db150(0x7fb)](_0x28a055)[_0x4db150(0x882)](/"/g,'&quot;')+')\x22');}_0x22f43b=_0x4db150(0x112d)+_0x595246+_0x4db150(0x21c4)+_0x28a055[_0x4db150(0x7aa)]+'\x22\x20'+_0xc95d91+_0x4db150(0xd43)+_0xef1022+'\x20'+_0x5f1b21+_0x4db150(0x151d)+Number(_0x28a055[_0x4db150(0xca8)])['toFixed'](0x2)+_0x4db150(0xc5e)+(_0x28a055[_0x4db150(0x15fe)]||'转账')+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x540abd+_0x4db150(0x6ad);}else{if(_0x28a055[_0x4db150(0x23df)]==='friend_request'){let _0xfea55c;if(_0x28a055[_0x4db150(0xcc9)]){const _0x14cdb1=_0x28a055[_0x4db150(0xe45)]?_0x4db150(0x5e0):_0x4db150(0x8a7),_0x1d2812=_0x28a055[_0x4db150(0xe45)]?_0x4db150(0x15d2):_0x4db150(0x1164);_0xfea55c=_0x4db150(0x93e)+_0x1d2812+'\x22>'+_0x14cdb1+_0x4db150(0xa54);}else _0xfea55c='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22friend-request-btn\x20accept\x22\x20onclick=\x22handleAIFriendRequest(\x27'+currentChatCharacter?.['id']+'\x27,\x20true,\x20\x27'+_0x28a055['id']+'\x27)\x22>同意</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22friend-request-btn\x20reject\x22\x20onclick=\x22handleAIFriendRequest(\x27'+currentChatCharacter?.['id']+'\x27,\x20false,\x20\x27'+_0x28a055['id']+_0x4db150(0x20ce);_0x22f43b=_0x4db150(0x1657)+(_0x28a055[_0x4db150(0xd7a)]||_0x4db150(0x12e7))+_0x4db150(0x575)+_0xfea55c+_0x4db150(0x2004);}else{if(_0x28a055[_0x4db150(0x23df)]===_0x4db150(0x674))_0x22f43b='<div\x20class=\x22message-bubble\x22>'+(_0x28a055[_0x4db150(0x1423)]||'代付请求')+_0x4db150(0xa54);else{if(_0x28a055[_0x4db150(0x23df)]===_0x4db150(0x8fa))_0x22f43b=generateAIOrderConfirmationContent(_0x28a055);else{const _0x33ae8e=_0x1996d3[_0x4db150(0x1ba)]||_0x4db150(0x20bb);let _0x449603;if(typeof _0x28a055[_0x4db150(0x1423)]===_0x4db150(0xb97))_0x449603=_0x28a055[_0x4db150(0x1423)];else{if(Array[_0x4db150(0x1bcc)](_0x28a055[_0x4db150(0x1423)])&&_0x28a055[_0x4db150(0x1423)][_0x4db150(0xcbf)]>0x0){const _0xce982f=_0x28a055[_0x4db150(0x1423)][0x0];_0xce982f&&_0xce982f[_0x4db150(0x23df)]===_0x4db150(0x1e58)&&_0xce982f[_0x4db150(0x1e58)]?_0x449603=_0xce982f['text']:_0x449603='[多媒体消息]';}else{if(_0x28a055[_0x4db150(0x1423)]&&typeof _0x28a055[_0x4db150(0x1423)]==='object'){if(_0x28a055['content'][_0x4db150(0x222f)]&&typeof _0x28a055[_0x4db150(0x1423)][_0x4db150(0x222f)]==='string'){if(_0x28a055[_0x4db150(0x1423)][_0x4db150(0x23df)]===_0x4db150(0xb18))_0x449603=_0x4db150(0x16b9)+_0x28a055[_0x4db150(0x1423)][_0x4db150(0x222f)];else _0x28a055[_0x4db150(0x1423)][_0x4db150(0x23df)]==='create_anniversary'?_0x449603='创建了纪念日：'+_0x28a055[_0x4db150(0x1423)][_0x4db150(0x222f)]:_0x449603='提及了：'+_0x28a055['content']['name'];}else _0x449603=_0x28a055[_0x4db150(0x1423)]['message']||_0x28a055[_0x4db150(0x1423)][_0x4db150(0x1e58)]||_0x4db150(0x1f6f);}else _0x449603=String(_0x28a055['content']||'');}}_0x33ae8e===_0x4db150(0x1685)&&(_0x449603=processOfflineContent(_0x449603)),_0x449603=processMentions(_0x449603),_0x28a055[_0x4db150(0x180)]?_0x22f43b=generateReplyHTML(_0x28a055[_0x4db150(0x180)])+_0x449603:_0x22f43b=_0x449603;}}}}}}}}let _0x4f8435='';if(!_0x1996d3[_0x4db150(0x1e22)]){let _0x1df10d='',_0x1a00c3=_0x18f868;if(_0xd8779e&&_0x2d7377&&_0x273d2e)_0x1df10d=_0x4db150(0x72b)+_0x273d2e['id']+'\x27)',_0x1a00c3=_0x4db150(0x2351)+_0x273d2e[_0x4db150(0x222f)];else _0x5c1e0d&&(_0x1df10d=_0x4db150(0x72b)+_0x5c1e0d['id']+'\x27)',_0x1a00c3=_0x4db150(0x58f));_0x4f8435=generateAvatarHtml({'avatarUrl':_0x5d042e,'backgroundColor':_0x4393ee,'displayName':_0x18f868,'chatSettings':_0x1996d3,'onClick':_0x1df10d,'title':_0x1a00c3});}const _0x41d431=convertColorWithOpacity(_0xa49513,_0x175506);let _0x322825='';_0x28a055[_0x4db150(0x23df)]===_0x4db150(0xd8)||_0x28a055[_0x4db150(0x23df)]===_0x4db150(0xb93)||_0x28a055[_0x4db150(0x23df)]===_0x4db150(0x14a6)||_0x28a055[_0x4db150(0x23df)]===_0x4db150(0x63b)||_0x28a055[_0x4db150(0x23df)]===_0x4db150(0x1bfd)||_0x28a055[_0x4db150(0x23df)]===_0x4db150(0x14f2)||_0x28a055[_0x4db150(0x23df)]===_0x4db150(0x674)?_0x322825=_0x22f43b:_0x322825=_0x4db150(0x2ab)+_0x41d431+_0x4db150(0x1ad7)+_0x32fdef+';\x20position:\x20relative;\x20padding:\x20'+_0x520769+_0x4db150(0x14f4)+_0x22f43b+_0x4db150(0x529)+(_0x28a055['image']&&(!_0x28a055['type']||_0x28a055['isEmoji'])?_0x4db150(0x2001)+_0x28a055[_0x4db150(0xe5b)]+'\x22\x20class=\x22'+(_0x28a055['isEmoji']?_0x4db150(0x1665):_0x4db150(0x548))+_0x4db150(0x1e66)+_0x28a055['image']+_0x4db150(0x1ccf):'')+_0x4db150(0x529)+(_0x4ce87a&&_0xd8a66e===_0x4db150(0x849)?_0x4db150(0xe44)+formatTimeOnly(_0x28a055[_0x4db150(0x7aa)])+_0x4db150(0xa54):'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x4ce87a&&_0xd8a66e===_0x4db150(0x151c)?'<div\x20class=\x22timestamp\x20timestamp-inside\x22>'+formatTimeOnly(_0x28a055['timestamp'])+'</div>':'')+_0x4db150(0x13b);if(_0xd8779e&&_0x2d7377&&_0x18f868!==_0x4db150(0xd61)){_0x93e53d['classList'][_0x4db150(0xe1)](_0x4db150(0x2e1));const _0x257f7d=_0x4db150(0xb81)+_0x18f868+_0x4db150(0xa54);_0x28a055[_0x4db150(0x23df)]==='voice_message'||_0x28a055[_0x4db150(0x23df)]===_0x4db150(0xd8)||_0x28a055['type']===_0x4db150(0xb93)||_0x28a055[_0x4db150(0x23df)]===_0x4db150(0x14a6)||_0x28a055['type']===_0x4db150(0x63b)||_0x28a055['type']==='friend_request'||_0x28a055[_0x4db150(0x23df)]===_0x4db150(0x8fa)||_0x28a055[_0x4db150(0x23df)]===_0x4db150(0x674)?_0x93e53d[_0x4db150(0xc02)]=_0x4f8435+('<div\x20class=\x22bubble-wrapper\x22>'+_0x257f7d+_0x322825+_0x4db150(0xa54)):_0x93e53d['innerHTML']=_0x4f8435+(_0x4db150(0x1e74)+_0x257f7d+_0x322825+_0x4db150(0xa54));}else _0x93e53d[_0x4db150(0xc02)]=_0x4f8435+_0x322825;if(_0x28a055[_0x4db150(0x23df)]===_0x4db150(0x1bfd)){const _0x4437d0=_0x28a055[_0x4db150(0x1423)][_0x4db150(0x882)](/\([^)]*\)\s*/g,'')[_0x4db150(0x1424)](),_0x2b1d1c=_0x28a055[_0x4db150(0x1ff)]||Math[_0x4db150(0x910)](0x1,Math[_0x4db150(0x1462)](_0x4437d0[_0x4db150(0xcbf)]/0x8)),_0x12e2d7=_0x2b1d1c<0x3c?'0:'+String(_0x2b1d1c)[_0x4db150(0x863)](0x2,'0')+'\x27\x27':Math[_0x4db150(0x1dac)](_0x2b1d1c/0x3c)+':'+String(_0x2b1d1c%0x3c)['padStart'](0x2,'0')+'\x27\x27',_0xf815ba='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-message-container\x20received\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-bubble\x22\x20style=\x22background-color:\x20'+_0x41d431+_0x4db150(0x1ad7)+_0x32fdef+_0x4db150(0x1de5)+_0x520769+_0x4db150(0x1528)+_0x4437d0+_0x4db150(0x1e06)+_0x12e2d7+'</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x4ce87a&&_0xd8a66e===_0x4db150(0x849)?_0x4db150(0xe44)+formatTimeOnly(_0x28a055[_0x4db150(0x7aa)])+_0x4db150(0xa54):'')+_0x4db150(0x1e0b)+(_0x4ce87a&&_0xd8a66e===_0x4db150(0x151c)?_0x4db150(0x1a87)+formatTimeOnly(_0x28a055[_0x4db150(0x7aa)])+'</div>':'')+_0x4db150(0x1579)+_0x4437d0+_0x4db150(0xc9e);if(_0xd8779e&&_0x2d7377&&_0x18f868!==_0x4db150(0xd61)){const _0xa9c620=_0x4db150(0xb81)+_0x18f868+_0x4db150(0xa54);_0x93e53d[_0x4db150(0xc02)]=_0x4f8435+('<div\x20class=\x22bubble-wrapper\x22>'+_0xa9c620+_0xf815ba+'</div>');}else _0x93e53d[_0x4db150(0xc02)]=_0x4f8435+_0xf815ba;}}else{let _0x541e7d=_0x1996d3[_0x4db150(0x13af)];if(!_0x541e7d&&_0x1996d3[_0x4db150(0x6a0)]){const _0x19f42b=personas[_0x4db150(0x1aeb)](_0x3c89ac=>_0x3c89ac['id']===_0x1996d3[_0x4db150(0x6a0)]);_0x19f42b&&_0x19f42b['avatarUrl']&&(_0x541e7d=_0x19f42b['avatarUrl']);}const _0xdcf044=_0x1996d3[_0x4db150(0x1aab)]||_0x4db150(0x1f03),_0x49fbc3=_0x1996d3[_0x4db150(0x24c3)]||'1',_0x5585ec=isLightColor(_0xdcf044)?_0x4db150(0x194f):_0x4db150(0x18a7),_0x36ca23=_0x1996d3[_0x4db150(0x1068)]||'12',_0x592a80=convertColorWithOpacity(_0xdcf044,_0x49fbc3);let _0x335c15='';if(_0x28a055[_0x4db150(0x23df)]===_0x4db150(0x2c2)){const _0x3b0b66=_0x28a055[_0x4db150(0x1ff)]||Math['max'](0x1,Math[_0x4db150(0x1462)](_0x28a055[_0x4db150(0x1423)][_0x4db150(0xcbf)]/0x8));_0x335c15=_0x4db150(0x716)+_0x592a80+_0x4db150(0x1ad7)+_0x5585ec+_0x4db150(0x1de5)+_0x36ca23+_0x4db150(0x1e95)+_0x28a055[_0x4db150(0x1423)]+_0x4db150(0x2037)+_0x3b0b66+_0x4db150(0x252c);}else{if(_0x28a055[_0x4db150(0x23df)]===_0x4db150(0x63b))_0x335c15=_0x4db150(0x2190)+_0x28a055[_0x4db150(0xf7e)]+_0x4db150(0xe5a)+_0x28a055[_0x4db150(0xf7e)]+_0x4db150(0x2074)+generateRealisticMapHTML()+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';else{if(_0x28a055[_0x4db150(0x23df)]==='transfer'){let _0x3cd2b4='',_0x9d2ea='';if(_0x28a055[_0x4db150(0xe54)]===_0x4db150(0x15d2)){const _0x1d8e4c=_0x28a055[_0x4db150(0x65d)]?_0x28a055['recipientName']+_0x4db150(0x1dde):_0x4db150(0x1dd9);_0x9d2ea='<div\x20class=\x22transfer-status\x22>'+_0x1d8e4c+'</div>',_0x3cd2b4='accepted';}else{if(_0x28a055[_0x4db150(0xe54)]===_0x4db150(0x1164)){const _0xdea3ff=_0x28a055[_0x4db150(0x65d)]?_0x28a055[_0x4db150(0x65d)]+_0x4db150(0x939):_0x4db150(0x1213);_0x9d2ea='<div\x20class=\x22transfer-status\x22>'+_0xdea3ff+'</div>',_0x3cd2b4='rejected';}}let _0x4ca9d9='💕\x20你发起的转账';_0x28a055[_0x4db150(0x65d)]&&(_0x4ca9d9=_0x4db150(0x2268)+_0x28a055['recipientName']),_0x335c15=_0x4db150(0x1c00)+_0x3cd2b4+'\x22\x20data-transfer-id=\x22'+_0x28a055['timestamp']+_0x4db150(0x1e9b)+_0x4ca9d9+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22transfer-amount\x22>¥\x20'+Number(_0x28a055[_0x4db150(0xca8)])[_0x4db150(0x3cd)](0x2)+_0x4db150(0xc5e)+(_0x28a055[_0x4db150(0x15fe)]||'转账')+_0x4db150(0x136d)+_0x9d2ea+_0x4db150(0x6ad);}else{if(_0x28a055[_0x4db150(0x23df)]===_0x4db150(0x14f2))_0x335c15=_0x4db150(0xba6)+(_0x28a055['message']||_0x4db150(0x12e7))+_0x4db150(0x215d);else{if(_0x28a055[_0x4db150(0x23df)]===_0x4db150(0x8fa))_0x335c15=_0x28a055[_0x4db150(0x1423)];else{let _0x206b64='';if(Array[_0x4db150(0x1bcc)](_0x28a055['content'])){const _0x4411e5=_0x28a055[_0x4db150(0x1423)][_0x4db150(0x1aeb)](_0x2b81f9=>_0x2b81f9[_0x4db150(0x23df)]==='text'),_0x3f35b=_0x28a055[_0x4db150(0x1423)][_0x4db150(0x1aeb)](_0x5d7c58=>_0x5d7c58[_0x4db150(0x23df)]===_0x4db150(0x1cfa));let _0x438d6b=_0x4411e5?.['text']||'';_0x438d6b=processMentions(_0x438d6b),_0x28a055['replyTo']?_0x206b64=generateReplyHTML(_0x28a055['replyTo'])+_0x438d6b:_0x206b64=_0x438d6b,_0x3f35b?.[_0x4db150(0x1cfa)]?.[_0x4db150(0x10c6)]&&(_0x206b64&&(_0x206b64+=_0x4db150(0x365)),_0x206b64+=_0x4db150(0x2001)+_0x3f35b[_0x4db150(0x1cfa)][_0x4db150(0x10c6)]+_0x4db150(0x2183)+(_0x28a055[_0x4db150(0xe29)]?_0x4db150(0x1665):_0x4db150(0x548))+'\x22\x20onclick=\x22showImage(\x27'+_0x3f35b[_0x4db150(0x1cfa)][_0x4db150(0x10c6)]+'\x27)\x22>');}else{let _0x38c654=_0x28a055[_0x4db150(0x1423)];_0x38c654=processMentions(_0x38c654),_0x28a055[_0x4db150(0x180)]?_0x206b64=generateReplyHTML(_0x28a055['replyTo'])+_0x38c654:_0x206b64=_0x38c654;}_0x335c15=_0x4db150(0x2ab)+_0x592a80+_0x4db150(0x1ad7)+_0x5585ec+_0x4db150(0x1de5)+_0x36ca23+_0x4db150(0x14f4)+_0x206b64+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x28a055[_0x4db150(0xe5b)]&&!Array[_0x4db150(0x1bcc)](_0x28a055[_0x4db150(0x1423)])?_0x4db150(0x2001)+_0x28a055[_0x4db150(0xe5b)]+'\x22\x20class=\x22'+(_0x28a055[_0x4db150(0xe29)]?_0x4db150(0x1665):'message-image')+_0x4db150(0x1e66)+_0x28a055[_0x4db150(0xe5b)]+_0x4db150(0x1ccf):'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x4ce87a&&_0xd8a66e===_0x4db150(0x849)?_0x4db150(0xe44)+formatTimeOnly(_0x28a055[_0x4db150(0x7aa)])+_0x4db150(0xa54):'')+_0x4db150(0x529)+(_0x4ce87a&&_0xd8a66e===_0x4db150(0x151c)?'<div\x20class=\x22timestamp\x20timestamp-inside\x22>'+formatTimeOnly(_0x28a055[_0x4db150(0x7aa)])+_0x4db150(0xa54):'')+_0x4db150(0x13b);}}}}}let _0x56a6ae='';!_0x1996d3['hideAvatars']&&(_0x56a6ae=generateAvatarHtml({'avatarUrl':_0x541e7d,'backgroundColor':_0x4db150(0x1f03),'displayName':'','chatSettings':_0x1996d3}));_0x93e53d[_0x4db150(0xc02)]=_0x335c15+_0x56a6ae;if(_0x28a055[_0x4db150(0x23df)]==='voice'){const _0x28abed='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-message-container\x20sent\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-bubble\x22\x20style=\x22background-color:\x20'+_0x592a80+_0x4db150(0x1ad7)+_0x5585ec+_0x4db150(0x1de5)+_0x36ca23+_0x4db150(0x1528)+_0x28a055[_0x4db150(0x1423)]+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-wave\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-duration\x22>'+(_0x28a055[_0x4db150(0x1ff)]||Math[_0x4db150(0x910)](0x1,Math[_0x4db150(0x1462)](_0x28a055['content'][_0x4db150(0xcbf)]/0x8)))+_0x4db150(0x19e5)+(_0x4ce87a&&_0xd8a66e==='bubble'?_0x4db150(0xe44)+formatTimeOnly(_0x28a055[_0x4db150(0x7aa)])+_0x4db150(0xa54):'')+_0x4db150(0x1e0b)+(_0x4ce87a&&_0xd8a66e==='inside'?_0x4db150(0x1a87)+formatTimeOnly(_0x28a055['timestamp'])+'</div>':'')+_0x4db150(0x1579)+_0x28a055[_0x4db150(0x1423)]+_0x4db150(0xc9e);_0x93e53d[_0x4db150(0xc02)]=_0x28abed+_0x56a6ae;}if(_0x28a055[_0x4db150(0x23df)]===_0x4db150(0x63b)){const _0x161066=_0x4db150(0x2190)+_0x28a055['locationName']+_0x4db150(0xe5a)+_0x28a055[_0x4db150(0xf7e)]+_0x4db150(0x2074)+generateRealisticMapHTML()+_0x4db150(0x6ad);_0x93e53d['innerHTML']=_0x161066+_0x56a6ae;}}_0x93e53d[_0x4db150(0x655)][_0x4db150(0x671)]='0',_0x93e53d[_0x4db150(0x655)][_0x4db150(0x2006)]='translateY(20px)',_0x5b04d['appendChild'](_0x93e53d),addBubbleTail(_0x93e53d,_0x28a055),requestAnimationFrame(()=>{const _0xa79e23=_0x4db150;_0x93e53d['classList'][_0xa79e23(0xe1)](_0xa79e23(0xe34));}),addBlockedIndicatorToMessage(_0x93e53d,_0x28a055,_0x34e032);_0x4ce87a&&_0xd8a66e!==_0x4db150(0x23a1)&&_0x28a055[_0x4db150(0xf75)]!==_0x4db150(0x212)&&addTimestampToMessage(_0x93e53d,_0x28a055,_0xd8a66e,_0x1996d3);addMessageLongPressListener(_0x93e53d,_0x28a055['id']);const _0x52a447=_0x93e53d[_0x4db150(0x15b8)](_0x4db150(0x37c));_0x52a447&&(_0x52a447['addEventListener'](_0x4db150(0xd3e),_0x420ad8=>{const _0x38e098=_0x4db150;_0x420ad8[_0x38e098(0x4d9)](),showMessageMenu(_0x28a055['id'],_0x420ad8);}),_0x52a447['onclick']=_0x440650=>{const _0x409547=_0x4db150;_0x440650[_0x409547(0x1144)][_0x409547(0x246c)]===_0x409547(0xb84)&&_0x440650['target'][_0x409547(0x226e)][_0x409547(0x1f9)]('message-image')&&showImage(_0x440650[_0x409547(0x1144)][_0x409547(0x107)]);}),_0x28a055['sender']==='received'&&typeof _0x28a055[_0x4db150(0x1423)]===_0x4db150(0xb97)&&adjustHeartrateForMessage(_0x28a055[_0x4db150(0x1423)],![]),setTimeout(()=>{const _0x256dd4=_0x4db150;_0x5b04d['scrollTop']=_0x5b04d[_0x256dd4(0x14c8)];},0x64);}function convertColorWithOpacity(_0x3c4966,_0x12f9fe){const _0x514fb7=_0x2cf6d4;if(!_0x3c4966||typeof _0x3c4966!==_0x514fb7(0xb97))return'rgba(0,\x200,\x200,\x200)';if(_0x3c4966[_0x514fb7(0x1cab)](_0x514fb7(0xe13)))return _0x3c4966;if(_0x3c4966[_0x514fb7(0x1cab)]('#')){const _0x23a039=_0x3c4966[_0x514fb7(0x136)](0x1),_0x53408c=parseInt(_0x23a039[_0x514fb7(0x4b2)](0x0,0x2),0x10),_0x1c8f6d=parseInt(_0x23a039[_0x514fb7(0x4b2)](0x2,0x4),0x10),_0x36166d=parseInt(_0x23a039[_0x514fb7(0x4b2)](0x4,0x6),0x10);return _0x514fb7(0x838)+_0x53408c+',\x20'+_0x1c8f6d+',\x20'+_0x36166d+',\x20'+_0x12f9fe+')';}if(_0x3c4966[_0x514fb7(0x1cab)](_0x514fb7(0xbcc))){const _0xe27fe6=_0x3c4966['match'](/\d+/g);return'rgba('+_0xe27fe6[0x0]+',\x20'+_0xe27fe6[0x1]+',\x20'+_0xe27fe6[0x2]+',\x20'+_0x12f9fe+')';}const _0x32006b={'red':_0x514fb7(0x19c),'green':'0,\x20128,\x200','blue':_0x514fb7(0x2540),'white':_0x514fb7(0x2571),'black':_0x514fb7(0x1ec3),'gray':_0x514fb7(0xc06),'yellow':_0x514fb7(0x1f2a),'cyan':_0x514fb7(0x1756),'magenta':_0x514fb7(0x534)};if(_0x32006b[_0x3c4966[_0x514fb7(0x1d64)]()])return _0x514fb7(0x838)+_0x32006b[_0x3c4966['toLowerCase']()]+',\x20'+_0x12f9fe+')';return _0x3c4966;}function changeFontSize(_0x5a253b){const _0x539ec0=_0x2cf6d4,_0x2b1ba3=parseInt(_0x5a253b),_0x4ca161=document[_0x539ec0(0x566)](_0x539ec0(0x11da)),_0x2aa223=document[_0x539ec0(0x566)]('font-size-value');_0x4ca161&&(_0x4ca161[_0x539ec0(0x655)][_0x539ec0(0x1ae6)]=_0x2b1ba3+'px'),_0x2aa223&&(_0x2aa223[_0x539ec0(0x21dc)]=_0x2b1ba3+'px'),document['documentElement']['style'][_0x539ec0(0x16db)](_0x539ec0(0x98c),_0x2b1ba3+'px'),applyFontSizeToMessages(_0x2b1ba3),applyFontSizeToMoments(_0x2b1ba3),currentChatCharacter&&typeof renderChatMessages===_0x539ec0(0xb1)&&setTimeout(()=>{renderChatMessages(currentChatCharacter['id']);},0x64),localStorage['setItem'](_0x539ec0(0x13d0),_0x2b1ba3),showToast(_0x539ec0(0x1574),_0x539ec0(0xb27));}function changeLetterSpacing(_0x24d5bd){const _0x160d65=_0x2cf6d4,_0x5bd7a4=parseFloat(_0x24d5bd),_0x32a2c3=document[_0x160d65(0x566)](_0x160d65(0x11da)),_0x14b7c1=document[_0x160d65(0x566)]('letter-spacing-value');_0x32a2c3&&(_0x32a2c3[_0x160d65(0x655)][_0x160d65(0x191d)]=_0x5bd7a4+'px');if(_0x14b7c1){let _0x217a5c;if(_0x5bd7a4<-0.2)_0x217a5c=_0x160d65(0x1ded);else{if(_0x5bd7a4<0.2)_0x217a5c='标准';else{if(_0x5bd7a4<0.8)_0x217a5c='舒适';else _0x5bd7a4<1.5?_0x217a5c='宽松':_0x217a5c='很宽松';}}_0x14b7c1[_0x160d65(0x21dc)]=_0x217a5c+'\x20('+_0x5bd7a4+'px)';}document['documentElement'][_0x160d65(0x655)][_0x160d65(0x16db)](_0x160d65(0xdbc),_0x5bd7a4+'px'),applyLetterSpacingToMessages(_0x5bd7a4),applyLetterSpacingToMoments(_0x5bd7a4),currentChatCharacter&&typeof renderChatMessages===_0x160d65(0xb1)&&setTimeout(()=>{renderChatMessages(currentChatCharacter['id']);},0x64),localStorage[_0x160d65(0x2055)](_0x160d65(0x18bd),_0x5bd7a4),showToast(_0x160d65(0x972),'success');}function applyFontSizeToMessages(_0x55bf61){const _0x141f2d=_0x2cf6d4,_0x133bda=document[_0x141f2d(0x1ed9)](_0x141f2d(0x37c));_0x133bda['forEach'](_0x1068cc=>{const _0x509b46=_0x141f2d;_0x1068cc['style'][_0x509b46(0x16db)]('font-size',_0x55bf61+'px',_0x509b46(0x153c));});const _0x77bef5=document[_0x141f2d(0x566)](_0x141f2d(0x3c0));_0x77bef5&&(_0x77bef5[_0x141f2d(0x655)][_0x141f2d(0x1ae6)]=_0x55bf61+'px');}function applyFontSizeToMoments(_0xfcc7a8){const _0x111e02=_0x2cf6d4,_0x5875ef=document['querySelectorAll'](_0x111e02(0x601));_0x5875ef[_0x111e02(0x900)](_0x390eae=>{const _0x5de091=_0x111e02;_0x390eae[_0x5de091(0x655)][_0x5de091(0x1ae6)]=_0xfcc7a8+'px';});const _0x3b8ae7=document[_0x111e02(0x566)](_0x111e02(0x250));_0x3b8ae7&&(_0x3b8ae7[_0x111e02(0x655)][_0x111e02(0x1ae6)]=_0xfcc7a8+'px');}function applyLetterSpacingToMessages(_0x2eab17){const _0x56c977=_0x2cf6d4,_0x47717e=document['querySelectorAll'](_0x56c977(0x37c));_0x47717e['forEach'](_0x32c4a1=>{const _0x30b903=_0x56c977;_0x32c4a1['style'][_0x30b903(0x16db)]('letter-spacing',_0x2eab17+'px',_0x30b903(0x153c));});const _0x2d9e97=document[_0x56c977(0x566)](_0x56c977(0x3c0));_0x2d9e97&&(_0x2d9e97[_0x56c977(0x655)][_0x56c977(0x191d)]=_0x2eab17+'px');}function applyLetterSpacingToMoments(_0x2c409a){const _0x1b008d=_0x2cf6d4,_0x38dd99=document[_0x1b008d(0x1ed9)](_0x1b008d(0x601));_0x38dd99[_0x1b008d(0x900)](_0x248880=>{const _0x2614f7=_0x1b008d;_0x248880[_0x2614f7(0x655)][_0x2614f7(0x191d)]=_0x2c409a+'px';});const _0xf84795=document[_0x1b008d(0x566)]('weibo-text');_0xf84795&&(_0xf84795[_0x1b008d(0x655)][_0x1b008d(0x191d)]=_0x2c409a+'px');}function toggleAutoScale(){const _0x39a7aa=_0x2cf6d4,_0x40847b=document['getElementById'](_0x39a7aa(0xa00)),_0xdde884=_0x40847b['checked'];localStorage['setItem']('autoScaleFont',_0xdde884),_0xdde884?(autoAdjustFontSize(),showToast('字体自动缩放已开启！','success')):showToast(_0x39a7aa(0x2295),_0x39a7aa(0xb27));}function autoAdjustFontSize(){const _0xf57ff0=_0x2cf6d4,_0x2c3042=document['getElementById']('phone-screen');if(!_0x2c3042)return;const _0x3ed9d5=parseInt(_0x2c3042[_0xf57ff0(0x655)][_0xf57ff0(0xaab)])||0x15e;let _0x5bce63=0xf;if(_0x3ed9d5<=0x140)_0x5bce63=0xd;else{if(_0x3ed9d5<=0x15e)_0x5bce63=0xe;else{if(_0x3ed9d5<=0x177)_0x5bce63=0xf;else _0x3ed9d5<=0x186?_0x5bce63=0x10:_0x5bce63=0x11;}}const _0xcd81e=document[_0xf57ff0(0x566)](_0xf57ff0(0x1f89));_0xcd81e&&(_0xcd81e['value']=_0x5bce63,changeFontSize(_0x5bce63));}function loadFontSizeSettings(){const _0x46d080=_0x2cf6d4,_0x555ee3=localStorage['getItem'](_0x46d080(0x13d0)),_0xc84921=_0x555ee3?parseInt(_0x555ee3):0xf,_0x57fb68=document[_0x46d080(0x566)](_0x46d080(0x1f89)),_0x53dc87=document[_0x46d080(0x566)](_0x46d080(0x11da)),_0x4b8522=document[_0x46d080(0x566)](_0x46d080(0xc3f));_0x57fb68&&(_0x57fb68['value']=_0xc84921);_0x53dc87&&(_0x53dc87[_0x46d080(0x655)]['fontSize']=_0xc84921+'px');_0x4b8522&&(_0x4b8522[_0x46d080(0x21dc)]=_0xc84921+'px');document[_0x46d080(0x1788)][_0x46d080(0x655)]['setProperty'](_0x46d080(0x98c),_0xc84921+'px');const _0x2b1921=localStorage[_0x46d080(0x2250)](_0x46d080(0x18bd)),_0x2154d9=_0x2b1921?parseFloat(_0x2b1921):0x0,_0x4bdf8f=document['getElementById'](_0x46d080(0x1026)),_0x4332b5=document[_0x46d080(0x566)](_0x46d080(0xeaa));_0x4bdf8f&&(_0x4bdf8f[_0x46d080(0xc34)]=_0x2154d9);_0x53dc87&&(_0x53dc87[_0x46d080(0x655)][_0x46d080(0x191d)]=_0x2154d9+'px');if(_0x4332b5){let _0x38c732;if(_0x2154d9<-0.2)_0x38c732=_0x46d080(0x1ded);else{if(_0x2154d9<0.2)_0x38c732='标准';else{if(_0x2154d9<0.8)_0x38c732='舒适';else _0x2154d9<1.5?_0x38c732='宽松':_0x38c732=_0x46d080(0xc13);}}_0x4332b5[_0x46d080(0x21dc)]=_0x38c732+'\x20('+_0x2154d9+_0x46d080(0x1980);}document['documentElement'][_0x46d080(0x655)][_0x46d080(0x16db)](_0x46d080(0xdbc),_0x2154d9+'px'),setTimeout(()=>{applyFontSizeToMessages(_0xc84921),applyFontSizeToMoments(_0xc84921),applyLetterSpacingToMessages(_0x2154d9),applyLetterSpacingToMoments(_0x2154d9);},0x1f4);const _0x171266=localStorage[_0x46d080(0x2250)](_0x46d080(0x5fd)),_0x2b5b32=document[_0x46d080(0x566)](_0x46d080(0xa00));_0x2b5b32&&(_0x2b5b32[_0x46d080(0x306)]=_0x171266===_0x46d080(0x8f1));}let globalFontSettings={'fontUrl':'','fontName':'','isApplied':![]};function previewGlobalFont(){const _0x33c245=_0x2cf6d4,_0x35ec0c=document[_0x33c245(0x566)](_0x33c245(0x54d))[_0x33c245(0xc34)][_0x33c245(0x1424)]();if(!_0x35ec0c){showFontStatus(_0x33c245(0x789),'error');return;}showFontStatus(_0x33c245(0xb65),'info');const _0x411c7b=document['getElementById'](_0x33c245(0xec7));_0x411c7b&&_0x411c7b[_0x33c245(0x128)]();if(isCSSFontUrl(_0x35ec0c))loadCSSFontPreview(_0x35ec0c);else isFontFileUrl(_0x35ec0c)?loadFontFilePreview(_0x35ec0c):showFontStatus(_0x33c245(0x1022),'error');}function applyGlobalFont(){const _0x15ebfe=_0x2cf6d4,_0x4b11d4=document[_0x15ebfe(0x566)](_0x15ebfe(0x54d))[_0x15ebfe(0xc34)]['trim']();if(!_0x4b11d4){showFontStatus(_0x15ebfe(0x789),_0x15ebfe(0x24ab));return;}const _0x5db155=document[_0x15ebfe(0x566)](_0x15ebfe(0xe28));_0x5db155&&_0x5db155[_0x15ebfe(0x128)]();showFontStatus(_0x15ebfe(0xa8d),_0x15ebfe(0x2422));if(isCSSFontUrl(_0x4b11d4))applyCSSFont(_0x4b11d4);else isFontFileUrl(_0x4b11d4)?applyFontFile(_0x4b11d4):showFontStatus(_0x15ebfe(0x1022),_0x15ebfe(0x24ab));}function resetGlobalFont(){const _0x1f6442=_0x2cf6d4,_0x5922fc=document[_0x1f6442(0x566)](_0x1f6442(0xe28));_0x5922fc&&_0x5922fc[_0x1f6442(0x128)]();const _0x4ae0dd=document[_0x1f6442(0x566)]('global-font-preview');_0x4ae0dd&&_0x4ae0dd['remove']();const _0x473fa9=document[_0x1f6442(0x566)]('global-font-override');_0x473fa9&&_0x473fa9[_0x1f6442(0x128)](),document[_0x1f6442(0x172c)][_0x1f6442(0x655)]['fontFamily']=_0x1f6442(0x1d62),document['getElementById'](_0x1f6442(0x54d))[_0x1f6442(0xc34)]='',globalFontSettings={'fontUrl':'','fontName':'','isApplied':![]},localStorage[_0x1f6442(0x1c95)](_0x1f6442(0x247a)),showFontStatus('字体已重置为系统默认',_0x1f6442(0xb27));}function isCSSFontUrl(_0x900d0d){const _0x4f5661=_0x2cf6d4;return _0x900d0d[_0x4f5661(0x23ec)](_0x4f5661(0xd54))||_0x900d0d[_0x4f5661(0x23ec)](_0x4f5661(0xb9b))||_0x900d0d[_0x4f5661(0xd7e)](_0x4f5661(0x20a0))||_0x900d0d[_0x4f5661(0x23ec)](_0x4f5661(0x163c))||_0x900d0d[_0x4f5661(0x23ec)]('zeoseven.com')||_0x900d0d['includes']('css');}function isFontFileUrl(_0x334055){const _0x1e6176=_0x2cf6d4;return _0x334055[_0x1e6176(0xd7e)]('.ttf')||_0x334055[_0x1e6176(0xd7e)](_0x1e6176(0x22f6))||_0x334055[_0x1e6176(0xd7e)](_0x1e6176(0x1f1b))||_0x334055[_0x1e6176(0xd7e)](_0x1e6176(0x12fd));}function loadCSSFontPreview(_0x81fee0){const _0x243598=_0x2cf6d4,_0x4d012b=document['createElement'](_0x243598(0xa58));_0x4d012b['id']=_0x243598(0xec7),_0x4d012b[_0x243598(0xe06)]=_0x243598(0x1cb4),_0x4d012b[_0x243598(0xe1d)]=_0x81fee0,_0x4d012b[_0x243598(0x4c9)]=_0x243598(0xb99),_0x4d012b[_0x243598(0xc28)]=function(){const _0x1ed338=_0x243598;console[_0x1ed338(0xc0d)](_0x1ed338(0x1811)),setTimeout(()=>{const _0x317395=_0x1ed338;let _0x1d9ab8=extractFontNameFromCSS(_0x81fee0);try{const _0x16bf2b=document[_0x317395(0x13d9)];for(let _0xec77b3=_0x16bf2b[_0x317395(0xcbf)]-0x1;_0xec77b3>=0x0;_0xec77b3--){const _0x50a665=_0x16bf2b[_0xec77b3];if(_0x50a665[_0x317395(0xe1d)]===_0x81fee0){try{const _0x501b9d=_0x50a665[_0x317395(0x21aa)]||_0x50a665[_0x317395(0x5fe)];for(let _0x457390=0x0;_0x457390<_0x501b9d['length'];_0x457390++){const _0x29d5e9=_0x501b9d[_0x457390];if(_0x29d5e9['type']===CSSRule[_0x317395(0x4e7)]&&_0x29d5e9[_0x317395(0x655)]['fontFamily']){_0x1d9ab8=_0x29d5e9['style'][_0x317395(0x16b1)][_0x317395(0x882)](/['"]/g,''),console[_0x317395(0xc0d)](_0x317395(0xa82),_0x1d9ab8);break;}}}catch(_0x1c8194){console[_0x317395(0xc0d)](_0x317395(0x1881));}break;}}}catch(_0x15bc41){console[_0x317395(0xc0d)]('🎨\x20CSS解析失败，使用默认名称');}const _0x39d768=document[_0x317395(0x566)]('font-size-preview');_0x39d768&&(_0x39d768[_0x317395(0x655)]['fontFamily']='\x27'+_0x1d9ab8+_0x317395(0x80b)),showFontStatus(_0x317395(0x1a4c)+_0x1d9ab8,_0x317395(0xb27));},0x1f4);},_0x4d012b[_0x243598(0x1795)]=function(){const _0x4b9282=_0x243598;showFontStatus(_0x4b9282(0x1c44),_0x4b9282(0x24ab));},document[_0x243598(0x1e4c)][_0x243598(0x1925)](_0x4d012b);}function loadFontFilePreview(_0x292ba4){const _0x407774=_0x2cf6d4,_0xc7fdbc='GlobalPreviewFont_'+Date['now'](),_0x38e895=document[_0x407774(0x1ad8)](_0x407774(0x655));_0x38e895['id']=_0x407774(0xec7);let _0x443879=_0x407774(0x16d0);if(_0x292ba4[_0x407774(0xd7e)](_0x407774(0x1f1b)))_0x443879='woff';if(_0x292ba4[_0x407774(0xd7e)](_0x407774(0x12fd)))_0x443879=_0x407774(0x20a1);if(_0x292ba4[_0x407774(0xd7e)](_0x407774(0x22f6)))_0x443879=_0x407774(0x1794);_0x38e895['textContent']=_0x407774(0x233e)+_0xc7fdbc+'\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20src:\x20url(\x27'+_0x292ba4+_0x407774(0x158a)+_0x443879+_0x407774(0x1c1d),document[_0x407774(0x1e4c)][_0x407774(0x1925)](_0x38e895),setTimeout(()=>{const _0xc28d6e=_0x407774,_0x1d31ba=document[_0xc28d6e(0x566)](_0xc28d6e(0x11da));_0x1d31ba&&(_0x1d31ba[_0xc28d6e(0x655)]['fontFamily']='\x27'+_0xc7fdbc+_0xc28d6e(0x80b)),showFontStatus(_0xc28d6e(0x1a4c)+_0xc7fdbc,_0xc28d6e(0xb27));},0x1f4);}function applyCSSFont(_0x56fa11){const _0x49f0b9=_0x2cf6d4,_0x42aed8=document[_0x49f0b9(0x1ad8)]('link');_0x42aed8['id']=_0x49f0b9(0xe28),_0x42aed8['rel']=_0x49f0b9(0x1cb4),_0x42aed8[_0x49f0b9(0xe1d)]=_0x56fa11,_0x42aed8[_0x49f0b9(0x4c9)]=_0x49f0b9(0xb99),_0x42aed8[_0x49f0b9(0xc28)]=function(){const _0x34ef67=_0x49f0b9;console[_0x34ef67(0xc0d)]('🎨\x20CSS字体加载成功，开始应用'),setTimeout(()=>{const _0x39b0d3=_0x34ef67;let _0x214b04=extractFontNameFromCSS(_0x56fa11);try{const _0x3b429b=document[_0x39b0d3(0x13d9)];for(let _0x165912=_0x3b429b[_0x39b0d3(0xcbf)]-0x1;_0x165912>=0x0;_0x165912--){const _0x1e44ca=_0x3b429b[_0x165912];if(_0x1e44ca['href']===_0x56fa11){try{const _0x51d2ee=_0x1e44ca['cssRules']||_0x1e44ca[_0x39b0d3(0x5fe)];for(let _0x106299=0x0;_0x106299<_0x51d2ee[_0x39b0d3(0xcbf)];_0x106299++){const _0x429943=_0x51d2ee[_0x106299];if(_0x429943[_0x39b0d3(0x23df)]===CSSRule[_0x39b0d3(0x4e7)]&&_0x429943['style'][_0x39b0d3(0x16b1)]){_0x214b04=_0x429943[_0x39b0d3(0x655)][_0x39b0d3(0x16b1)]['replace'](/['"]/g,''),console['log'](_0x39b0d3(0xa82),_0x214b04);break;}}}catch(_0xbb1f1c){console[_0x39b0d3(0xc0d)](_0x39b0d3(0x1881));}break;}}}catch(_0x56bcf3){console[_0x39b0d3(0xc0d)](_0x39b0d3(0x33d));}applyFontToElements(_0x214b04),globalFontSettings={'fontUrl':_0x56fa11,'fontName':_0x214b04,'isApplied':!![]},localStorage[_0x39b0d3(0x2055)](_0x39b0d3(0x247a),JSON[_0x39b0d3(0x7fb)](globalFontSettings)),showFontStatus(_0x39b0d3(0x156d)+_0x214b04,_0x39b0d3(0xb27));},0x1f4);},_0x42aed8[_0x49f0b9(0x1795)]=function(){const _0x2a7f8c=_0x49f0b9;showFontStatus(_0x2a7f8c(0x1c44),_0x2a7f8c(0x24ab));},document['head'][_0x49f0b9(0x1925)](_0x42aed8);}function applyFontFile(_0x759450){const _0x4d95c9=_0x2cf6d4,_0x1337e3='GlobalCustomFont_'+Date[_0x4d95c9(0x18e0)](),_0x121ea4=document[_0x4d95c9(0x1ad8)](_0x4d95c9(0x655));_0x121ea4['id']=_0x4d95c9(0xe28);let _0x2dacb7='truetype';if(_0x759450[_0x4d95c9(0xd7e)]('.woff'))_0x2dacb7='woff';if(_0x759450['endsWith']('.woff2'))_0x2dacb7=_0x4d95c9(0x20a1);if(_0x759450[_0x4d95c9(0xd7e)](_0x4d95c9(0x22f6)))_0x2dacb7=_0x4d95c9(0x1794);_0x121ea4['textContent']=_0x4d95c9(0x233e)+_0x1337e3+'\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20src:\x20url(\x27'+_0x759450+_0x4d95c9(0x158a)+_0x2dacb7+_0x4d95c9(0x1c1d),document[_0x4d95c9(0x1e4c)][_0x4d95c9(0x1925)](_0x121ea4),setTimeout(()=>{const _0x3a2882=_0x4d95c9;applyFontToElements(_0x1337e3),globalFontSettings={'fontUrl':_0x759450,'fontName':_0x1337e3,'isApplied':!![]},localStorage['setItem']('globalCustomFont',JSON[_0x3a2882(0x7fb)](globalFontSettings)),showFontStatus('字体已应用：'+_0x1337e3,_0x3a2882(0xb27));},0x1f4);}function extractFontNameFromCSS(_0x5ba1bb){const _0x17ea7d=_0x2cf6d4;if(_0x5ba1bb['includes'](_0x17ea7d(0xd54))||_0x5ba1bb[_0x17ea7d(0x23ec)](_0x17ea7d(0xb9b))){const _0x39b078=_0x5ba1bb[_0x17ea7d(0x1316)](/family=([^&:]+)/);if(_0x39b078)return decodeURIComponent(_0x39b078[0x1][_0x17ea7d(0x882)](/\+/g,'\x20'));}if(_0x5ba1bb[_0x17ea7d(0x23ec)]('zeoseven.com'))return _0x17ea7d(0x22da);if(_0x5ba1bb['includes'](_0x17ea7d(0x163c)))return _0x17ea7d(0x1ff3);return _0x17ea7d(0x1ff3);}function applyFontToElements(_0x2c5b12){const _0x31ad61=_0x2cf6d4;console[_0x31ad61(0xc0d)](_0x31ad61(0x1527),_0x2c5b12),document[_0x31ad61(0x172c)][_0x31ad61(0x655)][_0x31ad61(0x16b1)]='\x27'+_0x2c5b12+_0x31ad61(0x178b);const _0x36c41d=document[_0x31ad61(0x566)](_0x31ad61(0x17ed));_0x36c41d&&_0x36c41d[_0x31ad61(0x128)]();const _0x19dab4=document[_0x31ad61(0x1ad8)](_0x31ad61(0x655));_0x19dab4['id']='global-font-override',_0x19dab4[_0x31ad61(0x21dc)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20/*\x20🔥【修复】只对文字内容应用字体，不影响图标\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20body\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20\x27'+_0x2c5b12+_0x31ad61(0x4da)+_0x2c5b12+_0x31ad61(0x235d),document[_0x31ad61(0x1e4c)][_0x31ad61(0x1925)](_0x19dab4),console['log'](_0x31ad61(0x10b7));}function showFontStatus(_0x3d425b,_0x32a576){const _0x19a822=_0x2cf6d4,_0xce5ac4=document[_0x19a822(0x566)](_0x19a822(0x17b)),_0x39b24c=_0xce5ac4[_0x19a822(0x15b8)](_0x19a822(0x1520));_0xce5ac4[_0x19a822(0x221)]=_0x19a822(0xa34)+_0x32a576,_0x39b24c[_0x19a822(0x21dc)]=_0x3d425b,_0xce5ac4[_0x19a822(0x655)]['display']=_0x19a822(0x2d4),(_0x32a576===_0x19a822(0xb27)||_0x32a576===_0x19a822(0x2422))&&setTimeout(()=>{const _0x194384=_0x19a822;_0xce5ac4[_0x194384(0x655)][_0x194384(0x2526)]=_0x194384(0xfe9);},0xbb8);}function loadGlobalFontSettings(){const _0x1d0af9=_0x2cf6d4,_0x345dc6=localStorage[_0x1d0af9(0x2250)](_0x1d0af9(0x247a));if(_0x345dc6)try{globalFontSettings=JSON[_0x1d0af9(0x168e)](_0x345dc6);if(globalFontSettings[_0x1d0af9(0x1f53)]){const _0x209f5e=document['getElementById'](_0x1d0af9(0x54d));_0x209f5e&&(_0x209f5e[_0x1d0af9(0xc34)]=globalFontSettings['fontUrl']);if(globalFontSettings[_0x1d0af9(0x34d)]){if(isCSSFontUrl(globalFontSettings[_0x1d0af9(0x1f53)]))applyCSSFont(globalFontSettings[_0x1d0af9(0x1f53)]);else isFontFileUrl(globalFontSettings[_0x1d0af9(0x1f53)])&&applyFontFile(globalFontSettings[_0x1d0af9(0x1f53)]);}}}catch(_0x116665){console[_0x1d0af9(0x24ab)](_0x1d0af9(0xa81),_0x116665);}}function triggerVoiceMessage(){showToast('语音功能开发中...','info');}async function openCamera(){const _0x26f9f8=_0x2cf6d4;if(!currentChatCharacter){showToast('请先选择一个聊天对象',_0x26f9f8(0x24ab));return;}const _0x197199=await showCustomPrompt(_0x26f9f8(0x9f2),'请用文字描述您要发送的照片：');if(_0x197199&&_0x197199['trim']()){const _0x234698={'id':Date[_0x26f9f8(0x18e0)]()[_0x26f9f8(0x9a3)](),'sender':_0x26f9f8(0xfda),'type':_0x26f9f8(0x14a6),'content':_0x197199['trim'](),'timestamp':Date['now'](),'photoDescription':_0x197199[_0x26f9f8(0x1424)]()};!chatMessages[currentChatCharacter['id']]&&(chatMessages[currentChatCharacter['id']]=[]);chatMessages[currentChatCharacter['id']][_0x26f9f8(0x6ee)](_0x234698);try{const _0x221def=currentChatCharacter['id']+'_'+_0x234698['id']+'_'+(chatMessages[currentChatCharacter['id']][_0x26f9f8(0xcbf)]-0x1);await db[_0x26f9f8(0x464)]['add']({'id':_0x221def,'characterId':currentChatCharacter['id'],'timestamp':_0x234698[_0x26f9f8(0x7aa)],'messageOrder':chatMessages[currentChatCharacter['id']]['length']-0x1,'originalMessageId':_0x234698['id'],'messageData':_0x234698}),console[_0x26f9f8(0xc0d)](_0x26f9f8(0x16e4));}catch(_0x1e98db){console[_0x26f9f8(0x24ab)](_0x26f9f8(0x1c0f),_0x1e98db),await saveChatMessagesImmediate();}renderChatMessages(currentChatCharacter['id']),renderMessageList(),showToast(_0x26f9f8(0x292),_0x26f9f8(0xb27));}}function openTransfer(){const _0x2f2abb=_0x2cf6d4;if(!currentChatCharacter){showToast(_0x2f2abb(0x2392),_0x2f2abb(0x13bb));return;}const _0xf1031d=document['getElementById'](_0x2f2abb(0x95a)),_0x3fd1e7=document[_0x2f2abb(0x566)](_0x2f2abb(0x1efa));currentChatCharacter[_0x2f2abb(0x4b7)]?(_0xf1031d[_0x2f2abb(0x655)]['display']=_0x2f2abb(0x2d4),_0x3fd1e7[_0x2f2abb(0xc02)]=_0x2f2abb(0x23b0),currentChatCharacter['members']&&currentChatCharacter['members'][_0x2f2abb(0x900)](_0x4f38de=>{const _0x443f5c=_0x2f2abb,_0x25e495=document[_0x443f5c(0x1ad8)](_0x443f5c(0x1e6c));_0x25e495[_0x443f5c(0xc34)]=_0x4f38de['id'],_0x25e495[_0x443f5c(0x21dc)]=_0x4f38de['name'],_0x3fd1e7[_0x443f5c(0x1925)](_0x25e495);})):_0xf1031d[_0x2f2abb(0x655)]['display']=_0x2f2abb(0xfe9),document[_0x2f2abb(0x566)](_0x2f2abb(0x1dcc))['value']='',document[_0x2f2abb(0x566)](_0x2f2abb(0x15db))[_0x2f2abb(0xc34)]='',_0x3fd1e7['value']='',document['getElementById'](_0x2f2abb(0x187f))[_0x2f2abb(0x226e)][_0x2f2abb(0xe1)]('visible');}let isInCall=![],callTimer=null,callStartTime=null,callDuration=0x0,isMuted=![],isSpeakerOn=![],currentCallCharacter=null,isInVideoCall=![],videoCallTimer=null,videoCallStartTime=null,videoCallDuration=0x0,isVideoMuted=![],isVideoCameraOff=![],currentVideoCallCharacter=null;function generateMessageId(){const _0x53e433=_0x2cf6d4;return Date[_0x53e433(0x18e0)]()[_0x53e433(0x9a3)]()+Math[_0x53e433(0x1dac)](Math['random']()*0x3e8)['toString']();}async function addMessageToChat(_0x560ed7){const _0x65cd66=_0x2cf6d4;if(!currentChatCharacter)return;const _0x3231bf=currentChatCharacter['id'];!chatMessages[_0x3231bf]&&(chatMessages[_0x3231bf]=[]);chatMessages[_0x3231bf]['push'](_0x560ed7);try{const _0x7ec78e=_0x3231bf+'_'+_0x560ed7['id']+'_'+(chatMessages[_0x3231bf][_0x65cd66(0xcbf)]-0x1);await db['chatMessages']['add']({'id':_0x7ec78e,'characterId':_0x3231bf,'timestamp':_0x560ed7[_0x65cd66(0x7aa)],'messageOrder':chatMessages[_0x3231bf][_0x65cd66(0xcbf)]-0x1,'originalMessageId':_0x560ed7['id'],'messageData':_0x560ed7}),console[_0x65cd66(0xc0d)]('✅\x20[高效通话消息]\x20单条消息已保存到数据库');}catch(_0xf8f6ec){console[_0x65cd66(0x24ab)](_0x65cd66(0x163b),_0xf8f6ec),saveChatMessages();}renderChatMessages(_0x3231bf);}function makeCall(){const _0x1ee39e=_0x2cf6d4;if(!currentChatCharacter){showToast(_0x1ee39e(0x1268),_0x1ee39e(0x24ab));return;}if(currentChatCharacter['isGroup']){showToast(_0x1ee39e(0x184a),_0x1ee39e(0x24ab));return;}SoundManager[_0x1ee39e(0x10f4)](SoundManager[_0x1ee39e(0x24a1)]['OUTGOING_CALL'],currentChatCharacter?.['id']);const _0x1a58c8=getCurrentChatSettings();console[_0x1ee39e(0xc0d)](_0x1ee39e(0x7b0),_0x1a58c8[_0x1ee39e(0xfb)]),currentCallCharacter=currentChatCharacter;const _0x678b63=currentCallCharacter[_0x1ee39e(0x107f)]||currentCallCharacter[_0x1ee39e(0x10f9)]||_0x1ee39e(0x161);document['getElementById'](_0x1ee39e(0x713))['src']=_0x678b63,document[_0x1ee39e(0x566)](_0x1ee39e(0x381))[_0x1ee39e(0x21dc)]=currentCallCharacter[_0x1ee39e(0x222f)],document[_0x1ee39e(0x566)](_0x1ee39e(0xb0))['textContent']=_0x1ee39e(0x1d90),document[_0x1ee39e(0x566)](_0x1ee39e(0xaf7))[_0x1ee39e(0x21dc)]=_0x1ee39e(0x8d3),document[_0x1ee39e(0x566)](_0x1ee39e(0x9f9))[_0x1ee39e(0xc02)]='',showApp('phone-call-screen'),startCallTimer(),isInCall=!![];const _0x40d97f={'id':generateMessageId(),'sender':_0x1ee39e(0x212),'content':currentCallCharacter[_0x1ee39e(0x222f)]+'已接通语音电话','timestamp':Date[_0x1ee39e(0x18e0)](),'type':_0x1ee39e(0x1776),'callType':_0x1ee39e(0x631),'callStatus':'started'};addMessageToChat(_0x40d97f),window['isUserInitiatedCall']=!![];}async function initiateAICall(_0x47f3ef,_0x5d0ea4){const _0x9f8baa=_0x2cf6d4;if(isInCall)return;currentCallCharacter=_0x47f3ef,isInCall=!![];const _0x28c23d={'id':generateMessageId(),'sender':_0x9f8baa(0x212),'content':_0x47f3ef[_0x9f8baa(0x222f)]+'正在呼叫你','timestamp':Date['now'](),'type':_0x9f8baa(0x1776),'callType':_0x9f8baa(0x12bf),'callStatus':_0x9f8baa(0x1738)};addMessageToChat(_0x28c23d),SoundManager['play'](SoundManager[_0x9f8baa(0x24a1)][_0x9f8baa(0xd95)],_0x47f3ef?.['id']);const _0x37ff31=document[_0x9f8baa(0x1ed9)](_0x9f8baa(0x867));let _0x96c601=null;_0x37ff31['forEach'](_0xaefa76=>{const _0x36ed90=_0x9f8baa;(_0xaefa76['style'][_0x36ed90(0x2526)]===_0x36ed90(0x1f0b)||_0xaefa76[_0x36ed90(0x655)][_0x36ed90(0x2526)]===_0x36ed90(0x2d4))&&(_0x96c601=_0xaefa76['id']);});if(!_0x96c601){const _0x709438=document[_0x9f8baa(0x566)](_0x9f8baa(0x799)),_0x303a81=document[_0x9f8baa(0x566)]('home-grid');_0x709438&&_0x709438[_0x9f8baa(0x655)][_0x9f8baa(0x2526)]!=='none'&&_0x303a81&&_0x303a81[_0x9f8baa(0x655)][_0x9f8baa(0x2526)]!==_0x9f8baa(0xfe9)&&(_0x96c601=_0x9f8baa(0x16f9));}window[_0x9f8baa(0xd7d)]=_0x96c601||'api-chat-screen';let _0x29ee53='';try{const _0x4e7251='你是'+_0x47f3ef['name']+_0x9f8baa(0x87c),_0x53a561=await callChatAPI(_0x4e7251,_0x47f3ef),_0x5425c3=await parseAiResponse(_0x53a561);console[_0x9f8baa(0xc0d)]('🔔\x20开场白AI回复解析结果:',_0x5425c3);if(Array[_0x9f8baa(0x1bcc)](_0x5425c3)&&_0x5425c3[_0x9f8baa(0xcbf)]>0x0){const _0x4d7dfa=_0x5425c3[_0x9f8baa(0x1aeb)](_0x350ca8=>typeof _0x350ca8===_0x9f8baa(0xb97));if(_0x4d7dfa)_0x29ee53=_0x4d7dfa[_0x9f8baa(0x1424)]();else{const _0x58cbd0=_0x5425c3[0x0];typeof _0x58cbd0===_0x9f8baa(0x3c4)&&_0x58cbd0['content']&&(_0x29ee53=_0x58cbd0[_0x9f8baa(0x1423)]['trim']());}}else typeof _0x53a561===_0x9f8baa(0xb97)&&(_0x29ee53=cleanCallResponse(_0x53a561)['trim']());(!_0x29ee53||_0x29ee53[_0x9f8baa(0xcbf)]>0x1e)&&(_0x29ee53=_0x5d0ea4||_0x9f8baa(0x23e8));}catch(_0x3d1511){console[_0x9f8baa(0x24ab)](_0x9f8baa(0x5b8),_0x3d1511),_0x29ee53=_0x5d0ea4||'想和你通话...';}const _0x2ea24b=_0x47f3ef['avatar']||_0x47f3ef['avatarUrl']||_0x9f8baa(0x161);document[_0x9f8baa(0x566)]('incoming-call-avatar')[_0x9f8baa(0x107)]=_0x2ea24b,document[_0x9f8baa(0x566)](_0x9f8baa(0x1564))[_0x9f8baa(0x21dc)]=_0x47f3ef[_0x9f8baa(0x222f)],document[_0x9f8baa(0x566)](_0x9f8baa(0x2409))[_0x9f8baa(0x21dc)]=_0x29ee53,window[_0x9f8baa(0x1382)]=_0x29ee53,document[_0x9f8baa(0x566)]('incoming-call-avatar')['classList'][_0x9f8baa(0xe1)]('ringing-animation'),showApp(_0x9f8baa(0x2446)),setTimeout(()=>{const _0xe032e7=_0x9f8baa;document[_0xe032e7(0x566)](_0xe032e7(0x2446))[_0xe032e7(0x655)]['display']!==_0xe032e7(0xfe9)&&rejectCall();},0x7530);}async function initiateAIVideoCall(_0x5ccb4e,_0x56e019){const _0x4a5efd=_0x2cf6d4;if(isInVideoCall)return;currentVideoCallCharacter=_0x5ccb4e,isInVideoCall=!![];const _0x519a69={'id':generateMessageId(),'sender':_0x4a5efd(0x212),'content':_0x5ccb4e[_0x4a5efd(0x222f)]+_0x4a5efd(0x122e),'timestamp':Date[_0x4a5efd(0x18e0)](),'type':_0x4a5efd(0x1776),'callType':'incoming_video','callStatus':_0x4a5efd(0x1738)};addMessageToChat(_0x519a69),SoundManager[_0x4a5efd(0x10f4)](SoundManager[_0x4a5efd(0x24a1)][_0x4a5efd(0xd95)],_0x5ccb4e?.['id']);const _0x20b0d8=document[_0x4a5efd(0x1ed9)](_0x4a5efd(0x867));let _0x1df5a0=null;_0x20b0d8['forEach'](_0x5b7230=>{const _0x28783b=_0x4a5efd;(_0x5b7230['style'][_0x28783b(0x2526)]==='flex'||_0x5b7230['style'][_0x28783b(0x2526)]===_0x28783b(0x2d4))&&(_0x1df5a0=_0x5b7230['id']);});if(!_0x1df5a0){const _0x472b09=document[_0x4a5efd(0x566)]('clock-container'),_0x349e1c=document[_0x4a5efd(0x566)](_0x4a5efd(0x1615));_0x472b09&&_0x472b09[_0x4a5efd(0x655)][_0x4a5efd(0x2526)]!==_0x4a5efd(0xfe9)&&_0x349e1c&&_0x349e1c['style']['display']!==_0x4a5efd(0xfe9)&&(_0x1df5a0=_0x4a5efd(0x16f9));}window[_0x4a5efd(0xd9c)]=_0x1df5a0||_0x4a5efd(0x1154);let _0x10610f='';try{const _0xb81ba9='你是'+_0x5ccb4e['name']+'，刚刚决定给用户打视频电话。\x0a\x0a请生成一句简短自然的开场白，说明你为什么要打这个视频电话：\x0a-\x20要符合你的性格特点\x0a-\x20像真实视频通话开始时的自然表达\x0a-\x201句话即可，不要超过20字\x0a-\x20直接说话，不要任何格式标记\x0a\x0a例如：\x0a-\x20\x22想看看你在做什么\x22\x0a-\x20\x22有个好消息想和你分享\x22\x0a-\x20\x22想看到你的笑容\x22\x0a\x0a请只回复开场白内容：',_0xa011da=await callChatAPI(_0xb81ba9,_0x5ccb4e),_0x327305=await parseAiResponse(_0xa011da);console['log'](_0x4a5efd(0x1bb9),_0x327305);if(Array[_0x4a5efd(0x1bcc)](_0x327305)&&_0x327305[_0x4a5efd(0xcbf)]>0x0){const _0x461446=_0x327305['find'](_0x52e632=>typeof _0x52e632===_0x4a5efd(0xb97));if(_0x461446)_0x10610f=_0x461446[_0x4a5efd(0x1424)]();else{const _0x11ff70=_0x327305[0x0];typeof _0x11ff70==='object'&&_0x11ff70[_0x4a5efd(0x1423)]&&(_0x10610f=_0x11ff70[_0x4a5efd(0x1423)]['trim']());}}else typeof _0xa011da==='string'&&(_0x10610f=cleanCallResponse(_0xa011da)[_0x4a5efd(0x1424)]());(!_0x10610f||_0x10610f[_0x4a5efd(0xcbf)]>0x1e)&&(_0x10610f=_0x56e019||_0x4a5efd(0x79b));}catch(_0x5d4d28){console['error'](_0x4a5efd(0x1c72),_0x5d4d28),_0x10610f=_0x56e019||'想和你视频聊聊...';}const _0x1b48ac=_0x5ccb4e[_0x4a5efd(0x107f)]||_0x5ccb4e[_0x4a5efd(0x10f9)]||_0x4a5efd(0x161);document[_0x4a5efd(0x566)](_0x4a5efd(0x1f83))[_0x4a5efd(0x107)]=_0x1b48ac,document['getElementById']('incoming-video-call-name')[_0x4a5efd(0x21dc)]=_0x5ccb4e[_0x4a5efd(0x222f)],document[_0x4a5efd(0x566)](_0x4a5efd(0x2066))['textContent']=_0x10610f,window[_0x4a5efd(0x7bb)]=_0x10610f,document[_0x4a5efd(0x566)](_0x4a5efd(0x1f83))[_0x4a5efd(0x226e)][_0x4a5efd(0xe1)]('ringing-animation'),showApp(_0x4a5efd(0x754)),setTimeout(()=>{const _0x22c55c=_0x4a5efd;document['getElementById'](_0x22c55c(0x754))['style']['display']!==_0x22c55c(0xfe9)&&rejectVideoCall();},0x7530);}async function acceptVideoCall(){const _0x475dd7=_0x2cf6d4;SoundManager[_0x475dd7(0xce0)](SoundManager['TYPES'][_0x475dd7(0xd95)]),document['getElementById'](_0x475dd7(0x1f83))[_0x475dd7(0x226e)]['remove'](_0x475dd7(0x2bf)),hideApp(_0x475dd7(0x754));const _0x2ce602=await getVideoAvatarSettings(),_0xbadd31=_0x2ce602[_0x475dd7(0x18f6)]||currentVideoCallCharacter[_0x475dd7(0x107f)]||currentVideoCallCharacter[_0x475dd7(0x10f9)]||_0x475dd7(0x161),_0x2a1d4b=_0x2ce602['userAvatar']||'data:image/svg+xml;utf8,<svg\x20xmlns=\x22http://www.w3.org/2000/svg\x22\x20width=\x22100\x22\x20height=\x22100\x22\x20viewBox=\x220\x200\x20100\x20100\x22><circle\x20cx=\x2250\x22\x20cy=\x2250\x22\x20r=\x2250\x22\x20fill=\x22lightblue\x22/><text\x20x=\x2250\x22\x20y=\x2260\x22\x20font-size=\x2230\x22\x20text-anchor=\x22middle\x22\x20fill=\x22white\x22>你</text></svg>';document[_0x475dd7(0x566)](_0x475dd7(0x953))[_0x475dd7(0x107)]=_0xbadd31,document['getElementById'](_0x475dd7(0x1b84))[_0x475dd7(0x107)]=_0x2a1d4b,document[_0x475dd7(0x566)](_0x475dd7(0x1977))[_0x475dd7(0x21dc)]=currentVideoCallCharacter[_0x475dd7(0x222f)],document['getElementById'](_0x475dd7(0x70f))[_0x475dd7(0x21dc)]=_0x475dd7(0x6d0),document['getElementById'](_0x475dd7(0x1cba))['textContent']='00:00';const _0x3d7617=document[_0x475dd7(0x566)](_0x475dd7(0x632));_0x3d7617&&(_0x3d7617[_0x475dd7(0xc02)]='');showApp(_0x475dd7(0x468)),startVideoCallTimer(),isInVideoCall=!![],isVideoMuted=![],isVideoCameraOff=![],updateVideoCallButtons();const _0x119052={'id':generateMessageId(),'sender':'system','content':_0x475dd7(0xd34)+currentVideoCallCharacter['name']+_0x475dd7(0xc5a),'timestamp':Date[_0x475dd7(0x18e0)](),'type':_0x475dd7(0x1776),'callType':_0x475dd7(0x12bf),'callStatus':_0x475dd7(0x15d2)};addMessageToChat(_0x119052),window[_0x475dd7(0x7bb)]&&setTimeout(()=>{const _0x59d673=_0x475dd7;addVideoCallMessage(window[_0x59d673(0x7bb)],'received'),window[_0x59d673(0x7bb)]=null;},0x3e8),window[_0x475dd7(0xd9c)]=null;}function rejectVideoCall(){const _0x250c55=_0x2cf6d4;SoundManager[_0x250c55(0xce0)](SoundManager['TYPES'][_0x250c55(0xd95)]),document[_0x250c55(0x566)](_0x250c55(0x1f83))[_0x250c55(0x226e)][_0x250c55(0x128)](_0x250c55(0x2bf)),hideApp('incoming-video-call-screen');const _0x2a8bd3=window[_0x250c55(0xd9c)];if(_0x2a8bd3&&_0x2a8bd3!==_0x250c55(0x16f9))showApp(_0x2a8bd3);else{if(_0x2a8bd3==='home-screen'){const _0x9df0d4=document[_0x250c55(0x566)](_0x250c55(0x799)),_0x171ccf=document[_0x250c55(0x566)]('home-grid'),_0xa1124f=document[_0x250c55(0x566)](_0x250c55(0x1280));if(_0x9df0d4)_0x9df0d4[_0x250c55(0x655)]['display']=_0x250c55(0x2d4);if(_0x171ccf)_0x171ccf['style'][_0x250c55(0x2526)]=_0x250c55(0x6bb);if(_0xa1124f)_0xa1124f[_0x250c55(0x655)][_0x250c55(0x2526)]='block';}else showApp(_0x250c55(0x1154));}const _0x2654e1={'id':generateMessageId(),'sender':_0x250c55(0x212),'content':'已拒绝'+currentVideoCallCharacter[_0x250c55(0x222f)]+'的视频来电','timestamp':Date[_0x250c55(0x18e0)](),'type':'call_record','callType':'incoming','callStatus':_0x250c55(0x1164)};addMessageToChat(_0x2654e1),currentVideoCallCharacter=null,window[_0x250c55(0x7bb)]=null,window['previousScreenBeforeVideoCall']=null;}function acceptCall(){const _0x7be4bd=_0x2cf6d4;SoundManager[_0x7be4bd(0xce0)](SoundManager[_0x7be4bd(0x24a1)][_0x7be4bd(0xd95)]),document[_0x7be4bd(0x566)]('incoming-call-avatar')[_0x7be4bd(0x226e)][_0x7be4bd(0x128)](_0x7be4bd(0x2bf)),hideApp(_0x7be4bd(0x2446));const _0x1ee17f=currentCallCharacter[_0x7be4bd(0x107f)]||currentCallCharacter['avatarUrl']||_0x7be4bd(0x161);document[_0x7be4bd(0x566)](_0x7be4bd(0x713))[_0x7be4bd(0x107)]=_0x1ee17f,document[_0x7be4bd(0x566)](_0x7be4bd(0x381))[_0x7be4bd(0x21dc)]=currentCallCharacter[_0x7be4bd(0x222f)],document[_0x7be4bd(0x566)](_0x7be4bd(0xb0))[_0x7be4bd(0x21dc)]=_0x7be4bd(0x1d90),document[_0x7be4bd(0x566)](_0x7be4bd(0xaf7))[_0x7be4bd(0x21dc)]='00:00',document[_0x7be4bd(0x566)](_0x7be4bd(0x9f9))[_0x7be4bd(0xc02)]='',showApp('phone-call-screen'),startCallTimer(),isInCall=!![];const _0x5251de={'id':generateMessageId(),'sender':_0x7be4bd(0x212),'content':_0x7be4bd(0xd34)+currentCallCharacter[_0x7be4bd(0x222f)]+_0x7be4bd(0x1159),'timestamp':Date[_0x7be4bd(0x18e0)](),'type':_0x7be4bd(0x1776),'callType':'incoming','callStatus':'accepted'};addMessageToChat(_0x5251de),setTimeout(()=>{const _0x2c2e62=_0x7be4bd;let _0x10d423=window[_0x2c2e62(0x1382)]||getRandomCallGreeting(currentCallCharacter['name']);addCallMessage(_0x10d423,_0x2c2e62(0x232)),window['aiCallGreeting']=null;},0x3e8),window[_0x7be4bd(0xd7d)]=null;}function rejectCall(){const _0x27579c=_0x2cf6d4;SoundManager[_0x27579c(0xce0)](SoundManager[_0x27579c(0x24a1)]['INCOMING_CALL']),document[_0x27579c(0x566)](_0x27579c(0x8d4))[_0x27579c(0x226e)][_0x27579c(0x128)]('ringing-animation'),hideApp(_0x27579c(0x2446));const _0x37964a=window[_0x27579c(0xd7d)];if(_0x37964a&&_0x37964a!=='home-screen')showApp(_0x37964a);else{if(_0x37964a===_0x27579c(0x16f9)){const _0x5b9c54=document['getElementById'](_0x27579c(0x799)),_0x566aae=document[_0x27579c(0x566)]('home-grid'),_0x566cd3=document['getElementById'](_0x27579c(0x1280));if(_0x5b9c54)_0x5b9c54[_0x27579c(0x655)][_0x27579c(0x2526)]=_0x27579c(0x2d4);if(_0x566aae)_0x566aae[_0x27579c(0x655)][_0x27579c(0x2526)]='grid';if(_0x566cd3)_0x566cd3[_0x27579c(0x655)][_0x27579c(0x2526)]=_0x27579c(0x2d4);}else showApp('api-chat-screen');}const _0x38839b={'id':generateMessageId(),'sender':_0x27579c(0x212),'content':_0x27579c(0x8a7)+currentCallCharacter[_0x27579c(0x222f)]+'的来电','timestamp':Date[_0x27579c(0x18e0)](),'type':_0x27579c(0x1776),'callType':_0x27579c(0x12bf),'callStatus':_0x27579c(0x1164)};addMessageToChat(_0x38839b),currentCallCharacter=null,window[_0x27579c(0xd7d)]=null;}function endCall(){const _0x5997a9=_0x2cf6d4;if(!isInCall)return;stopCallTimer(),hideApp(_0x5997a9(0x1059)),showApp('api-chat-screen');const _0x35cc31=formatCallDuration(callDuration),_0x220b45={'id':generateMessageId(),'sender':_0x5997a9(0x212),'content':_0x5997a9(0x22b)+_0x35cc31,'timestamp':Date[_0x5997a9(0x18e0)](),'type':_0x5997a9(0x1776),'callType':_0x5997a9(0xccf),'callStatus':_0x5997a9(0x1604),'duration':_0x35cc31};addMessageToChat(_0x220b45),isInCall=![],isMuted=![],isSpeakerOn=![],currentCallCharacter=null;}function toggleMute(){const _0x3a4d29=_0x2cf6d4;isMuted=!isMuted;const _0x373f5f=document['getElementById'](_0x3a4d29(0x1115));isMuted?(_0x373f5f[_0x3a4d29(0x226e)][_0x3a4d29(0xe1)]('muted'),_0x373f5f[_0x3a4d29(0xc02)]='<i\x20class=\x22fas\x20fa-microphone-slash\x22></i>',showToast(_0x3a4d29(0xf7f),_0x3a4d29(0x2422))):(_0x373f5f[_0x3a4d29(0x226e)][_0x3a4d29(0x128)](_0x3a4d29(0xfd0)),_0x373f5f[_0x3a4d29(0xc02)]=_0x3a4d29(0x724),showToast('已取消静音',_0x3a4d29(0x2422)));}function toggleSpeaker(){const _0x10dea2=_0x2cf6d4;isSpeakerOn=!isSpeakerOn;const _0x95defd=document[_0x10dea2(0x566)](_0x10dea2(0x1385));isSpeakerOn?(_0x95defd[_0x10dea2(0x226e)][_0x10dea2(0xe1)](_0x10dea2(0x105d)),showToast('已开启扬声器','info')):(_0x95defd[_0x10dea2(0x226e)][_0x10dea2(0x128)](_0x10dea2(0x105d)),showToast('已关闭扬声器',_0x10dea2(0x2422)));}function startCallTimer(){callStartTime=new Date(),callDuration=0x0,callTimer=setInterval(()=>{const _0x19fb23=_0x3a81;callDuration=Math[_0x19fb23(0x1dac)]((new Date()-callStartTime)/0x3e8),document['getElementById'](_0x19fb23(0xaf7))[_0x19fb23(0x21dc)]=formatCallDuration(callDuration);},0x3e8);}function stopCallTimer(){callTimer&&(clearInterval(callTimer),callTimer=null);}function formatCallDuration(_0x3b6922){const _0x5eff52=_0x2cf6d4,_0x24569b=Math['floor'](_0x3b6922/0x3c),_0x10581e=_0x3b6922%0x3c;return _0x24569b['toString']()[_0x5eff52(0x863)](0x2,'0')+':'+_0x10581e[_0x5eff52(0x9a3)]()[_0x5eff52(0x863)](0x2,'0');}function sendCallMessage(){const _0x31523a=_0x2cf6d4,_0x22bef8=document[_0x31523a(0x566)](_0x31523a(0x94d));if(!_0x22bef8){console[_0x31523a(0x24ab)](_0x31523a(0x252));return;}const _0x3a6866=_0x22bef8[_0x31523a(0xc34)][_0x31523a(0x1424)]();if(!_0x3a6866)return;addCallMessage(_0x3a6866,_0x31523a(0xfda)),_0x22bef8[_0x31523a(0xc34)]='';const _0x14c4f4=showCallTypingIndicator();currentCallCharacter&&setTimeout(async()=>{const _0x51037e=_0x31523a;try{const _0x5dfa1f='你是'+currentCallCharacter[_0x51037e(0x222f)]+_0x51037e(0x21ef)+_0x3a6866+_0x51037e(0x1d88);try{const _0xe680a6=await callChatAPI(_0x5dfa1f,currentCallCharacter);hideCallTypingIndicator(_0x14c4f4);const _0x4e2d23=await parseAiResponse(_0xe680a6);console[_0x51037e(0xc0d)]('🔔\x20通话AI回复解析结果:',_0x4e2d23);let _0x235ef7=![];if(Array[_0x51037e(0x1bcc)](_0x4e2d23)&&_0x4e2d23['length']>0x0)for(const _0x4ccf31 of _0x4e2d23){let _0xa8eefa='';if(typeof _0x4ccf31==='string')_0xa8eefa=_0x4ccf31[_0x51037e(0x1424)]();else typeof _0x4ccf31===_0x51037e(0x3c4)&&_0x4ccf31[_0x51037e(0x1423)]&&(_0xa8eefa=_0x4ccf31[_0x51037e(0x1423)][_0x51037e(0x1424)]());_0xa8eefa&&(addCallMessage(_0xa8eefa,_0x51037e(0x232)),_0x235ef7=!![],await new Promise(_0x456f98=>setTimeout(_0x456f98,0x12c)));}!_0x235ef7&&console['log'](_0x51037e(0x15c0));}catch(_0x2eb587){console[_0x51037e(0x24ab)](_0x51037e(0x16d9),_0x2eb587),hideCallTypingIndicator(_0x14c4f4),console['log'](_0x51037e(0x3e9));}}catch(_0x274f52){console[_0x51037e(0x24ab)](_0x51037e(0x1b93),_0x274f52),hideCallTypingIndicator(_0x14c4f4),console[_0x51037e(0xc0d)](_0x51037e(0x613));}},0x3e8+Math['random']()*0x3e8);}async function addCallMessage(_0x1bfd0c,_0x126714){const _0x176494=_0x2cf6d4,_0xb3b590=document[_0x176494(0x566)](_0x176494(0x9f9)),_0x2c36dd=document['createElement'](_0x176494(0x526));_0x2c36dd[_0x176494(0x221)]=_0x176494(0x1c89)+_0x126714,_0x2c36dd[_0x176494(0x21dc)]=_0x1bfd0c,_0xb3b590['appendChild'](_0x2c36dd),_0xb3b590['scrollTop']=_0xb3b590[_0x176494(0x14c8)];if(currentCallCharacter&&currentCallCharacter['id']){const _0x236ccb={'id':generateMessageId(),'sender':_0x126714===_0x176494(0xfda)?'sent':'received','content':_0x1bfd0c,'timestamp':Date[_0x176494(0x18e0)](),'isCallMessage':!![],'type':_0x176494(0xc11)};!chatMessages[currentCallCharacter['id']]&&(chatMessages[currentCallCharacter['id']]=[]);chatMessages[currentCallCharacter['id']]['push'](_0x236ccb);try{const _0x594214=currentCallCharacter['id']+'_'+_0x236ccb['id']+'_'+(chatMessages[currentCallCharacter['id']][_0x176494(0xcbf)]-0x1);await db[_0x176494(0x464)][_0x176494(0xe1)]({'id':_0x594214,'characterId':currentCallCharacter['id'],'timestamp':_0x236ccb[_0x176494(0x7aa)],'messageOrder':chatMessages[currentCallCharacter['id']][_0x176494(0xcbf)]-0x1,'originalMessageId':_0x236ccb['id'],'messageData':_0x236ccb}),console[_0x176494(0xc0d)](_0x176494(0x68e));}catch(_0x3a3040){console['error'](_0x176494(0x7e0),_0x3a3040),saveChatMessages();}}}function showCallTypingIndicator(){const _0x400eb4=_0x2cf6d4,_0x114b2a=document[_0x400eb4(0x566)](_0x400eb4(0x9f9)),_0x198892=document['createElement']('div');return _0x198892[_0x400eb4(0x221)]=_0x400eb4(0x8c0),_0x198892[_0x400eb4(0xc02)]=_0x400eb4(0x20a5),_0x114b2a[_0x400eb4(0x1925)](_0x198892),_0x114b2a[_0x400eb4(0x5e5)]=_0x114b2a['scrollHeight'],_0x198892;}function hideCallTypingIndicator(_0x19959f){const _0x134432=_0x2cf6d4;_0x19959f&&_0x19959f[_0x134432(0xe9)]&&_0x19959f[_0x134432(0xe9)][_0x134432(0x1624)](_0x19959f);}function showVideoCallTypingIndicator(){const _0x5d717c=_0x2cf6d4,_0x5513c8=document[_0x5d717c(0x566)](_0x5d717c(0x632));if(!_0x5513c8)return console[_0x5d717c(0x24ab)](_0x5d717c(0x1399)),null;const _0x28126f=document['createElement'](_0x5d717c(0x526));return _0x28126f['className']=_0x5d717c(0x50f),_0x28126f[_0x5d717c(0xc02)]=_0x5d717c(0x49d),_0x5513c8[_0x5d717c(0x1925)](_0x28126f),requestAnimationFrame(()=>{const _0x2999bf=_0x5d717c;_0x5513c8[_0x2999bf(0x5e5)]=_0x5513c8[_0x2999bf(0x14c8)];}),_0x28126f;}function hideVideoCallTypingIndicator(_0x6eae3c){const _0x36e3cd=_0x2cf6d4;_0x6eae3c&&_0x6eae3c[_0x36e3cd(0xe9)]&&_0x6eae3c['parentNode'][_0x36e3cd(0x1624)](_0x6eae3c);}function cleanCallResponse(_0x479fe5){const _0x94c206=_0x2cf6d4;if(!_0x479fe5)return'';console[_0x94c206(0xc0d)](_0x94c206(0x239b),_0x479fe5),_0x479fe5=_0x479fe5['replace'](/\n/g,'\x20')[_0x94c206(0x882)](/\s+/g,'\x20')[_0x94c206(0x1424)](),_0x479fe5=_0x479fe5[_0x94c206(0x882)](/^(角色说|我说|回复|答案|回答)[:：]\s*/i,''),_0x479fe5=_0x479fe5[_0x94c206(0x882)](/\([^)]*\)/g,''),_0x479fe5=_0x479fe5['replace'](/【[^】]*】/g,''),_0x479fe5=_0x479fe5[_0x94c206(0x882)](/\[[^\]]*\]/g,''),_0x479fe5=_0x479fe5[_0x94c206(0x882)](/^[，。！？；：,.!?;:\s]*/,''),console[_0x94c206(0xc0d)](_0x94c206(0x1ecc),_0x479fe5);if(!_0x479fe5||_0x479fe5['length']<0x2)return console[_0x94c206(0xc0d)](_0x94c206(0x12bd)),'';return _0x479fe5[_0x94c206(0xcbf)]>0x3c&&(_0x479fe5=_0x479fe5[_0x94c206(0x4b2)](0x0,0x3c)+_0x94c206(0x12da)),_0x479fe5;}function getRandomCallGreeting(_0x5dade2){const _0x1da7ee=_0x2cf6d4,_0x4b2d7a=['你好，我是'+_0x5dade2+_0x1da7ee(0x2008),_0x1da7ee(0x507),_0x1da7ee(0xce5),'你好，谢谢你接我电话。',_0x1da7ee(0xcd2)];return _0x4b2d7a[Math['floor'](Math[_0x1da7ee(0x191c)]()*_0x4b2d7a['length'])];}function checkForAICallTrigger(_0x314652,_0x4a80c7){const _0x5bbe1a=_0x2cf6d4,_0x44f613=getCurrentChatSettings();if(!_0x44f613['aiCallEnabled'])return console[_0x5bbe1a(0xc0d)](_0x5bbe1a(0x1a2f)),![];if(isInCall||isInVideoCall)return console[_0x5bbe1a(0xc0d)]('🔔\x20当前正在通话中，不触发新的来电'),![];if(!currentChatCharacter||currentChatCharacter[_0x5bbe1a(0x4b7)])return console['log']('🔔\x20没有当前聊天角色或为群聊，无法触发来电'),![];const _0x111f3d=['通话','电话','视频通话','语音通话','打给你','打电话给','来电',_0x5bbe1a(0x8dc),_0x5bbe1a(0x72f),_0x5bbe1a(0x17d7)],_0x1b6587=_0x111f3d[_0x5bbe1a(0x184b)](_0x13ec01=>_0x314652['includes'](_0x13ec01)),_0x58b6fa=_0x111f3d[_0x5bbe1a(0x184b)](_0x431d47=>_0x4a80c7['includes'](_0x431d47));console['log'](_0x5bbe1a(0x16da),{'userMessage':_0x314652[_0x5bbe1a(0x4b2)](0x0,0x32)+_0x5bbe1a(0x12da),'aiResponse':_0x4a80c7[_0x5bbe1a(0x4b2)](0x0,0x32)+_0x5bbe1a(0x12da),'userHasKeyword':_0x1b6587,'aiHasKeyword':_0x58b6fa,'characterName':currentChatCharacter[_0x5bbe1a(0x222f)]});let _0x1fad70=0x0;(_0x1b6587||_0x58b6fa)&&(_0x1fad70=0.05,_0x1b6587&&_0x58b6fa&&(_0x1fad70=0.15));const _0xb8ecc5=(currentChatCharacter[_0x5bbe1a(0x1a84)]||'')[_0x5bbe1a(0x1d64)]();(_0xb8ecc5['includes']('主动')||_0xb8ecc5[_0x5bbe1a(0x23ec)]('外向')||_0xb8ecc5['includes']('热情')||_0xb8ecc5[_0x5bbe1a(0x23ec)]('活泼')||_0xb8ecc5['includes']('开朗')||_0xb8ecc5[_0x5bbe1a(0x23ec)]('积极'))&&(_0x1fad70+=0.03);const _0x5000a2=[_0x5bbe1a(0xe8a),_0x5bbe1a(0x210c),_0x5bbe1a(0x2292),_0x5bbe1a(0x1702),_0x5bbe1a(0xbfe),_0x5bbe1a(0x15da)],_0x1b4e6e=_0x5000a2[_0x5bbe1a(0x184b)](_0xba4687=>_0x314652['includes'](_0xba4687)||_0x4a80c7['includes'](_0xba4687));_0x1b4e6e&&(_0x1fad70+=0.05);_0x1fad70=Math['min'](_0x1fad70,0.25);if(_0x1fad70>0x0&&Math[_0x5bbe1a(0x191c)]()<_0x1fad70){console[_0x5bbe1a(0xc0d)](_0x5bbe1a(0x32c),_0x1fad70);let _0x5f1110=extractCallReason(_0x4a80c7);if(!_0x5f1110||_0x5f1110[_0x5bbe1a(0x23ec)](_0x5bbe1a(0x1097))){const _0x186b58=['突然想听听你的声音',_0x5bbe1a(0xf38),_0x5bbe1a(0x1097),_0x5bbe1a(0x1457),_0x5bbe1a(0xea3)];_0x5f1110=_0x186b58[Math['floor'](Math[_0x5bbe1a(0x191c)]()*_0x186b58[_0x5bbe1a(0xcbf)])];}const _0x1d0a99=0x3e8+Math[_0x5bbe1a(0x191c)]()*0xbb8;return console['log'](_0x5bbe1a(0xec4)+Math[_0x5bbe1a(0x5f3)](_0x1d0a99/0x3e8)+_0x5bbe1a(0x132e)+_0x5f1110),setTimeout(()=>{const _0x1ca0e8=_0x5bbe1a;console[_0x1ca0e8(0xc0d)](_0x1ca0e8(0x10a7)),initiateAICall(currentChatCharacter,_0x5f1110);},_0x1d0a99),!![];}else console['log'](_0x5bbe1a(0x19f6),_0x1fad70);return![];}function extractCallReason(_0x35d4d2){const _0x320ff8=_0x2cf6d4;let _0x226f10=[_0x320ff8(0x1097),'有事情想告诉你','想听听你的声音',_0x320ff8(0x12b1)];const _0xd6dd1=_0x35d4d2[_0x320ff8(0x633)](/[。！？.!?]/),_0x548581=_0xd6dd1[_0x320ff8(0x803)](_0x359c0d=>{const _0x332762=_0x320ff8,_0x39ad49=_0x359c0d[_0x332762(0x1424)]();return _0x39ad49[_0x332762(0xcbf)]>0x5&&_0x39ad49['length']<0x14&&!_0x39ad49[_0x332762(0x23ec)]('我');});if(_0x548581[_0x320ff8(0xcbf)]>0x0)return _0x548581[Math[_0x320ff8(0x1dac)](Math[_0x320ff8(0x191c)]()*_0x548581[_0x320ff8(0xcbf)])]['trim']();return _0x226f10[Math[_0x320ff8(0x1dac)](Math['random']()*_0x226f10['length'])];}async function openVideoCall(){const _0x459a2f=_0x2cf6d4;if(!currentChatCharacter){showToast(_0x459a2f(0x1268),_0x459a2f(0x24ab));return;}if(currentChatCharacter[_0x459a2f(0x4b7)]){showToast(_0x459a2f(0x1350),_0x459a2f(0x24ab));return;}SoundManager['play'](SoundManager[_0x459a2f(0x24a1)][_0x459a2f(0x2181)],currentChatCharacter?.['id']),currentVideoCallCharacter=currentChatCharacter;const _0x227c81=await getVideoAvatarSettings(),_0x133e5e=_0x227c81['characterAvatar']||currentVideoCallCharacter[_0x459a2f(0x107f)]||currentVideoCallCharacter['avatarUrl']||'data:image/svg+xml;utf8,<svg\x20xmlns=\x22http://www.w3.org/2000/svg\x22\x20width=\x22100\x22\x20height=\x22100\x22\x20viewBox=\x220\x200\x20100\x20100\x22><circle\x20cx=\x2250\x22\x20cy=\x2250\x22\x20r=\x2250\x22\x20fill=\x22lightgray\x22/><text\x20x=\x2250\x22\x20y=\x2260\x22\x20font-size=\x2230\x22\x20text-anchor=\x22middle\x22\x20fill=\x22gray\x22>头像</text></svg>',_0x59ef19=_0x227c81[_0x459a2f(0x21cd)]||_0x459a2f(0x24a8);document['getElementById'](_0x459a2f(0x953))[_0x459a2f(0x107)]=_0x133e5e,document[_0x459a2f(0x566)]('video-call-user-avatar')[_0x459a2f(0x107)]=_0x59ef19,document[_0x459a2f(0x566)](_0x459a2f(0x1977))[_0x459a2f(0x21dc)]=currentVideoCallCharacter['name'],document[_0x459a2f(0x566)]('video-call-status')[_0x459a2f(0x21dc)]=_0x459a2f(0x6d0),document[_0x459a2f(0x566)](_0x459a2f(0x1cba))[_0x459a2f(0x21dc)]='00:00';const _0x4eb29b=document['getElementById']('video-call-floating-messages');_0x4eb29b&&(_0x4eb29b['innerHTML']='');showApp(_0x459a2f(0x468)),startVideoCallTimer(),isInVideoCall=!![],isVideoMuted=![],isVideoCameraOff=![],updateVideoCallButtons();const _0x25586d={'id':generateMessageId(),'sender':'system','content':currentVideoCallCharacter['name']+_0x459a2f(0x20bf),'timestamp':Date['now'](),'type':_0x459a2f(0x1776),'callType':_0x459a2f(0x631),'callStatus':_0x459a2f(0x1106)};addMessageToChat(_0x25586d),window[_0x459a2f(0x127f)]=!![];}function startVideoCallTimer(){videoCallStartTime=new Date(),videoCallDuration=0x0,videoCallTimer=setInterval(()=>{const _0x733f09=_0x3a81;videoCallDuration=Math[_0x733f09(0x1dac)]((new Date()-videoCallStartTime)/0x3e8),document['getElementById'](_0x733f09(0x1cba))[_0x733f09(0x21dc)]=formatCallDuration(videoCallDuration);},0x3e8);}function stopVideoCallTimer(){videoCallTimer&&(clearInterval(videoCallTimer),videoCallTimer=null);}function endVideoCall(){const _0x5da7f9=_0x2cf6d4;if(!isInVideoCall)return;stopVideoCallTimer(),hideApp(_0x5da7f9(0x468)),showApp(_0x5da7f9(0x1154));const _0x4789de=formatCallDuration(videoCallDuration),_0x397efe={'id':generateMessageId(),'sender':'system','content':_0x5da7f9(0x9ea)+_0x4789de,'timestamp':Date[_0x5da7f9(0x18e0)](),'type':'call_record','callType':_0x5da7f9(0xccf),'callStatus':_0x5da7f9(0x1604),'duration':_0x4789de};addMessageToChat(_0x397efe),isInVideoCall=![],isVideoMuted=![],isVideoCameraOff=![],currentVideoCallCharacter=null,window[_0x5da7f9(0x127f)]=![];}function toggleVideoMute(){const _0x364e32=_0x2cf6d4;isVideoMuted=!isVideoMuted,updateVideoCallButtons();const _0x3e6548=document[_0x364e32(0x566)](_0x364e32(0x1549));isVideoMuted?showToast('已静音',_0x364e32(0x2422)):showToast(_0x364e32(0x20fe),_0x364e32(0x2422));}async function toggleVideoCamera(){const _0x130ec0=_0x2cf6d4;isVideoCameraOff=!isVideoCameraOff,updateVideoCallButtons();const _0x2dad17=document['querySelector'](_0x130ec0(0x395));if(isVideoCameraOff)_0x2dad17[_0x130ec0(0x655)]['background']=_0x130ec0(0x194f),_0x2dad17[_0x130ec0(0xc02)]=_0x130ec0(0x1ed1),showToast(_0x130ec0(0x128c),_0x130ec0(0x2422));else{const _0x1404fe=await getVideoAvatarSettings(),_0x14ff3c=_0x1404fe['userAvatar']||'data:image/svg+xml;utf8,<svg\x20xmlns=\x22http://www.w3.org/2000/svg\x22\x20width=\x22100\x22\x20height=\x22100\x22\x20viewBox=\x220\x200\x20100\x20100\x22><circle\x20cx=\x2250\x22\x20cy=\x2250\x22\x20r=\x2250\x22\x20fill=\x22lightblue\x22/><text\x20x=\x2250\x22\x20y=\x2260\x22\x20font-size=\x2230\x22\x20text-anchor=\x22middle\x22\x20fill=\x22white\x22>你</text></svg>';_0x2dad17[_0x130ec0(0x655)][_0x130ec0(0xc3c)]='',_0x2dad17['innerHTML']=_0x130ec0(0x11c1)+_0x14ff3c+'\x22\x20alt=\x22用户通话形象\x22\x20class=\x22user-video-avatar\x22>',showToast(_0x130ec0(0x57e),_0x130ec0(0x2422));}}function updateVideoCallButtons(){const _0x3e5155=_0x2cf6d4,_0x1553e2=document[_0x3e5155(0x566)](_0x3e5155(0x1549)),_0x5a6a4c=document[_0x3e5155(0x566)](_0x3e5155(0x1b51));_0x1553e2&&(isVideoMuted?(_0x1553e2[_0x3e5155(0x226e)]['add']('muted'),_0x1553e2[_0x3e5155(0xc02)]=_0x3e5155(0x1b1f)):(_0x1553e2['classList'][_0x3e5155(0x128)]('muted'),_0x1553e2[_0x3e5155(0xc02)]='<i\x20class=\x22fas\x20fa-microphone\x22></i>')),_0x5a6a4c&&(isVideoCameraOff?(_0x5a6a4c[_0x3e5155(0x226e)][_0x3e5155(0xe1)]('camera-off'),_0x5a6a4c['innerHTML']='<i\x20class=\x22fas\x20fa-video-slash\x22></i>'):(_0x5a6a4c[_0x3e5155(0x226e)][_0x3e5155(0x128)]('camera-off'),_0x5a6a4c[_0x3e5155(0xc02)]=_0x3e5155(0x20ee)));}function sendVideoCallMessage(){const _0xff8a73=_0x2cf6d4,_0x1bb4f6=document['getElementById'](_0xff8a73(0x139d));if(!_0x1bb4f6){console[_0xff8a73(0x24ab)](_0xff8a73(0x1f00));return;}const _0x76791e=_0x1bb4f6[_0xff8a73(0xc34)]['trim']();if(!_0x76791e)return;addVideoCallMessage(_0x76791e,_0xff8a73(0xfda)),_0x1bb4f6[_0xff8a73(0xc34)]='';const _0x9b5cc6=showVideoCallTypingIndicator();currentVideoCallCharacter&&setTimeout(async()=>{const _0x1036a0=_0xff8a73;try{const _0x1a4df5='你是'+currentVideoCallCharacter[_0x1036a0(0x222f)]+_0x1036a0(0xe80)+_0x76791e+_0x1036a0(0xec),_0x2796c5=await callChatAPI(_0x1a4df5,currentVideoCallCharacter);if(_0x2796c5&&_0x2796c5[_0x1036a0(0x1424)]()){hideVideoCallTypingIndicator(_0x9b5cc6);const _0x1abbf0=await parseAiResponse(_0x2796c5);console[_0x1036a0(0xc0d)]('🔔\x20视频通话AI回复解析结果:',_0x1abbf0);let _0x4e8ac1=![];if(Array[_0x1036a0(0x1bcc)](_0x1abbf0)&&_0x1abbf0[_0x1036a0(0xcbf)]>0x0)for(const _0x404cca of _0x1abbf0){let _0x17eecf='';if(typeof _0x404cca==='string')_0x17eecf=_0x404cca[_0x1036a0(0x1424)]();else typeof _0x404cca===_0x1036a0(0x3c4)&&_0x404cca['content']&&(_0x17eecf=_0x404cca[_0x1036a0(0x1423)]['trim']());_0x17eecf&&(addVideoCallMessage(_0x17eecf,_0x1036a0(0x232)),_0x4e8ac1=!![],await new Promise(_0x422ffe=>setTimeout(_0x422ffe,0x12c)));}!_0x4e8ac1&&console[_0x1036a0(0xc0d)]('⚠️\x20视频通话中AI回复无效，跳过显示以避免机械化回复');}else hideVideoCallTypingIndicator(_0x9b5cc6),console[_0x1036a0(0xc0d)](_0x1036a0(0x2394));}catch(_0x5bb259){console[_0x1036a0(0x24ab)](_0x1036a0(0x166),_0x5bb259),hideVideoCallTypingIndicator(_0x9b5cc6),console[_0x1036a0(0xc0d)]('⚠️\x20视频通话中发生错误，跳过显示以避免机械化回复');}},0x3e8+Math[_0xff8a73(0x191c)]()*0x3e8);}function addVideoCallMessage(_0x22eab5,_0x4d0755){const _0x366a18=_0x2cf6d4,_0xf5202e=document[_0x366a18(0x566)]('video-call-floating-messages');if(!_0xf5202e){console['error'](_0x366a18(0x1399));return;}const _0x14dbe4=document[_0x366a18(0x1ad8)]('div');_0x14dbe4['className']=_0x366a18(0x1287)+_0x4d0755,_0x14dbe4[_0x366a18(0x21dc)]=_0x22eab5,_0xf5202e['appendChild'](_0x14dbe4),requestAnimationFrame(()=>{const _0xa16f51=_0x366a18;_0xf5202e['scrollTop']=_0xf5202e[_0xa16f51(0x14c8)];});if(currentVideoCallCharacter&&currentVideoCallCharacter['id']){const _0x2e51e5={'id':generateMessageId(),'sender':_0x4d0755==='sent'?_0x366a18(0xfda):'received','content':_0x22eab5,'timestamp':Date['now'](),'type':'call_message'};addMessageToChat(_0x2e51e5);}}async function showVideoAvatarModal(){const _0xf7e210=_0x2cf6d4,_0x372671=await getVideoAvatarSettings(),_0xb42c4a=document[_0xf7e210(0x566)](_0xf7e210(0x1c21)),_0x5cf5b0=document[_0xf7e210(0x566)](_0xf7e210(0xbe8)),_0x25b49c=document[_0xf7e210(0x566)](_0xf7e210(0x4bd)),_0x4c121b=document['getElementById'](_0xf7e210(0x67f));_0x372671[_0xf7e210(0x18f6)]?(_0xb42c4a[_0xf7e210(0x107)]=_0x372671[_0xf7e210(0x18f6)],_0xb42c4a[_0xf7e210(0x655)]['display']=_0xf7e210(0x2d4),_0x25b49c[_0xf7e210(0x655)]['display']=_0xf7e210(0xfe9)):(_0xb42c4a[_0xf7e210(0x655)][_0xf7e210(0x2526)]=_0xf7e210(0xfe9),_0x25b49c[_0xf7e210(0x655)][_0xf7e210(0x2526)]=_0xf7e210(0x1f0b)),_0x372671[_0xf7e210(0x21cd)]?(_0x5cf5b0[_0xf7e210(0x107)]=_0x372671[_0xf7e210(0x21cd)],_0x5cf5b0['style'][_0xf7e210(0x2526)]=_0xf7e210(0x2d4),_0x4c121b['style'][_0xf7e210(0x2526)]='none'):(_0x5cf5b0[_0xf7e210(0x655)]['display']='none',_0x4c121b[_0xf7e210(0x655)][_0xf7e210(0x2526)]=_0xf7e210(0x1f0b)),document[_0xf7e210(0x566)](_0xf7e210(0x561))[_0xf7e210(0x655)][_0xf7e210(0x2526)]=_0xf7e210(0x1f0b);}function hideVideoAvatarModal(_0x27bef6){const _0x13b926=_0x2cf6d4;if(_0x27bef6&&_0x27bef6[_0x13b926(0x1144)]!==_0x27bef6[_0x13b926(0x52b)])return;document[_0x13b926(0x566)]('video-avatar-modal')['style'][_0x13b926(0x2526)]=_0x13b926(0xfe9);}function changeCharacterVideoAvatar(){const _0x5c2a4d=_0x2cf6d4;document[_0x5c2a4d(0x566)](_0x5c2a4d(0x1491))[_0x5c2a4d(0x1e62)]();}function changeUserVideoAvatar(){const _0x1f5491=_0x2cf6d4;document[_0x1f5491(0x566)]('user-video-avatar-input')[_0x1f5491(0x1e62)]();}function handleCharacterVideoAvatarChange(_0x2b9822){const _0x4e5d56=_0x2cf6d4,_0x57fa40=_0x2b9822['target'][_0x4e5d56(0x173e)][0x0];if(_0x57fa40){const _0x1a58bd=new FileReader();_0x1a58bd[_0x4e5d56(0xc28)]=function(_0x1441d8){const _0x8048d=_0x4e5d56,_0x2a4c2e=document[_0x8048d(0x566)](_0x8048d(0x1c21)),_0x288c61=document[_0x8048d(0x566)]('character-avatar-placeholder');_0x2a4c2e[_0x8048d(0x107)]=_0x1441d8[_0x8048d(0x1144)][_0x8048d(0x1fff)],_0x2a4c2e[_0x8048d(0x655)][_0x8048d(0x2526)]='block',_0x288c61[_0x8048d(0x655)]['display']=_0x8048d(0xfe9);},_0x1a58bd[_0x4e5d56(0x145e)](_0x57fa40);}}function handleUserVideoAvatarChange(_0x4acdbd){const _0x1cab7d=_0x2cf6d4,_0x1e3068=_0x4acdbd['target'][_0x1cab7d(0x173e)][0x0];if(_0x1e3068){const _0x13ff39=new FileReader();_0x13ff39[_0x1cab7d(0xc28)]=function(_0x3a0f73){const _0x1457b0=_0x1cab7d,_0x478aba=document['getElementById'](_0x1457b0(0xbe8)),_0x574944=document[_0x1457b0(0x566)](_0x1457b0(0x67f));_0x478aba[_0x1457b0(0x107)]=_0x3a0f73[_0x1457b0(0x1144)][_0x1457b0(0x1fff)],_0x478aba['style'][_0x1457b0(0x2526)]=_0x1457b0(0x2d4),_0x574944[_0x1457b0(0x655)][_0x1457b0(0x2526)]=_0x1457b0(0xfe9);},_0x13ff39[_0x1cab7d(0x145e)](_0x1e3068);}}async function saveVideoAvatarSettings(){const _0x356184=_0x2cf6d4,_0x2d378b=document[_0x356184(0x566)](_0x356184(0x1c21)),_0x1a192f=document['getElementById']('user-video-avatar-preview'),_0x444124={'characterAvatar':_0x2d378b[_0x356184(0x655)][_0x356184(0x2526)]===_0x356184(0x2d4)?_0x2d378b[_0x356184(0x107)]:null,'userAvatar':_0x1a192f[_0x356184(0x655)]['display']===_0x356184(0x2d4)?_0x1a192f[_0x356184(0x107)]:null};if(currentChatCharacter&&currentChatCharacter['id'])try{await db[_0x356184(0x1292)]['put']({'id':'video_avatar_'+currentChatCharacter['id'],'characterId':currentChatCharacter['id'],'characterAvatar':_0x444124[_0x356184(0x18f6)],'userAvatar':_0x444124[_0x356184(0x21cd)],'timestamp':Date['now']()}),console['log'](_0x356184(0x13c3)+currentChatCharacter['id']),showToast('通话形象设置已保存','success');}catch(_0x359f0d){console[_0x356184(0x24ab)](_0x356184(0x19c9),_0x359f0d),showToast(_0x356184(0x1647),'error');}hideVideoAvatarModal();}async function getVideoAvatarSettings(){const _0x76da4e=_0x2cf6d4;if(!currentChatCharacter||!currentChatCharacter['id'])return{'characterAvatar':null,'userAvatar':null};try{const _0x3fafbb=await db[_0x76da4e(0x1292)][_0x76da4e(0x46a)](_0x76da4e(0x1b08)+currentChatCharacter['id']);if(_0x3fafbb)return{'characterAvatar':_0x3fafbb[_0x76da4e(0x18f6)],'userAvatar':_0x3fafbb[_0x76da4e(0x21cd)]};}catch(_0x12cf2a){console[_0x76da4e(0x24ab)](_0x76da4e(0x1900),_0x12cf2a);try{const _0x6b7a6e=_0x76da4e(0x1fec)+currentChatCharacter['id'],_0x5dd9dc=localStorage[_0x76da4e(0x2250)](_0x6b7a6e);if(_0x5dd9dc){const _0x871bf2=JSON[_0x76da4e(0x168e)](_0x5dd9dc);return console['log'](_0x76da4e(0x746)),_0x871bf2;}}catch(_0x4f9359){console['warn'](_0x76da4e(0x21b),_0x4f9359);}}return{'characterAvatar':null,'userAvatar':null};}function updateVideoAvatarSettingVisibility(){const _0x24d4d9=_0x2cf6d4,_0x43a46a=document[_0x24d4d9(0x566)](_0x24d4d9(0x255b));_0x43a46a&&(currentChatCharacter&&!currentChatCharacter[_0x24d4d9(0x4b7)]?_0x43a46a[_0x24d4d9(0x655)][_0x24d4d9(0x2526)]=_0x24d4d9(0x1f0b):_0x43a46a[_0x24d4d9(0x655)]['display']=_0x24d4d9(0xfe9));}async function shareLocation(){const _0x13a740=_0x2cf6d4;if(!currentChatCharacter){alert('请先选择一个角色');return;}document['getElementById']('location-address')[_0x13a740(0xc34)]='',document[_0x13a740(0x566)](_0x13a740(0x253b))[_0x13a740(0x21dc)]=_0x13a740(0x1dfa),randomizeMapPosition(),renderLocationHistory(),document[_0x13a740(0x566)]('chat-location-modal')['style'][_0x13a740(0x2526)]='flex';}function hideChatLocationModal(){const _0xb58dd2=_0x2cf6d4;document[_0xb58dd2(0x566)](_0xb58dd2(0x645))['style'][_0xb58dd2(0x2526)]=_0xb58dd2(0xfe9);}function setLocationAddress(_0x5e95bf){const _0x19b976=_0x2cf6d4;document[_0x19b976(0x566)](_0x19b976(0x24dd))[_0x19b976(0xc34)]=_0x5e95bf,document['getElementById'](_0x19b976(0x253b))[_0x19b976(0x21dc)]=_0x5e95bf;const _0xe7ec48=(39.8+Math['random']()*0.4)[_0x19b976(0x3cd)](0x4),_0xb67a99=(116.2+Math[_0x19b976(0x191c)]()*0.4)[_0x19b976(0x3cd)](0x4);document[_0x19b976(0x15b8)](_0x19b976(0x2256))[_0x19b976(0x21dc)]=_0xb67a99+_0x19b976(0x235a)+_0xe7ec48+'°N';}function randomizeMapPosition(){const _0xff8dae=_0x2cf6d4,_0x42cb9c=document['getElementById'](_0xff8dae(0x63c)),_0x253e03=document[_0xff8dae(0x1ed9)](_0xff8dae(0x20ea)),_0xd77137=0x14+Math['random']()*0x3c,_0x2a4ee5=0x14+Math[_0xff8dae(0x191c)]()*0x3c;_0x42cb9c[_0xff8dae(0x655)][_0xff8dae(0x15f7)]=_0xd77137+'%',_0x42cb9c[_0xff8dae(0x655)][_0xff8dae(0x1466)]=_0x2a4ee5+'%',_0x253e03[_0xff8dae(0x900)](_0x568b75=>{const _0x50af83=_0xff8dae,_0x429c83=Math['random']()*0x55,_0x379c73=Math['random']()*0x55;_0x568b75['style']['top']=_0x429c83+'%',_0x568b75[_0x50af83(0x655)][_0x50af83(0x1466)]=_0x379c73+'%';});const _0x1bdc19=(39.8+Math[_0xff8dae(0x191c)]()*0.4)['toFixed'](0x4),_0x29c8d9=(116.2+Math[_0xff8dae(0x191c)]()*0.4)[_0xff8dae(0x3cd)](0x4);document[_0xff8dae(0x15b8)](_0xff8dae(0x2256))[_0xff8dae(0x21dc)]=_0x29c8d9+'°E,\x20'+_0x1bdc19+'°N';}function generateRealisticMapHTML(){return'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22map-background\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20弯曲河流\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22river\x22\x20style=\x22top:\x205%;\x20left:\x2060%;\x20width:\x2020px;\x20height:\x203px;\x20transform:\x20rotate(35deg);\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22river-curve\x22\x20style=\x22top:\x2012%;\x20left:\x2072%;\x20width:\x2018px;\x20height:\x203px;\x20transform:\x20rotate(15deg);\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22river\x22\x20style=\x22top:\x2018%;\x20left:\x2080%;\x20width:\x2016px;\x20height:\x203px;\x20transform:\x20rotate(-5deg);\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22river-curve\x22\x20style=\x22top:\x2022%;\x20left:\x2085%;\x20width:\x2015px;\x20height:\x203px;\x20transform:\x20rotate(-25deg);\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22river\x22\x20style=\x22top:\x2055%;\x20left:\x202%;\x20width:\x2022px;\x20height:\x203px;\x20transform:\x20rotate(-10deg);\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22river-curve\x22\x20style=\x22top:\x2062%;\x20left:\x2018%;\x20width:\x2020px;\x20height:\x203px;\x20transform:\x20rotate(8deg);\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22river\x22\x20style=\x22top:\x2068%;\x20left:\x2032%;\x20width:\x2018px;\x20height:\x203px;\x20transform:\x20rotate(25deg);\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20公园绿地\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22park\x22\x20style=\x22top:\x2020%;\x20left:\x2065%;\x20width:\x2018px;\x20height:\x2015px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22park\x22\x20style=\x22top:\x2045%;\x20left:\x2010%;\x20width:\x2022px;\x20height:\x2018px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20道路\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22map-roads\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22road\x20road-horizontal\x22\x20style=\x22top:\x2035%;\x20width:\x20100%;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22road\x20road-vertical\x22\x20style=\x22left:\x2040%;\x20height:\x20100%;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22road\x20road-horizontal\x22\x20style=\x22top:\x2065%;\x20width:\x2070%;\x20left:\x2030%;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20建筑物\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22map-buildings\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22building\x20house\x22\x20style=\x22top:\x2015%;\x20left:\x2020%;\x20width:\x2012px;\x20height:\x2010px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22building\x20office\x22\x20style=\x22top:\x2025%;\x20left:\x2045%;\x20width:\x208px;\x20height:\x2016px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22building\x20shop\x22\x20style=\x22top:\x2050%;\x20left:\x2050%;\x20width:\x2014px;\x20height:\x208px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22building\x20house\x22\x20style=\x22top:\x2070%;\x20left:\x2075%;\x20width:\x2010px;\x20height:\x208px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22building\x20office\x22\x20style=\x22top:\x208%;\x20left:\x2085%;\x20width:\x206px;\x20height:\x2012px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20树木\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22tree\x20big\x22\x20style=\x22top:\x2025%;\x20left:\x2015%;\x20width:\x206px;\x20height:\x206px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22tree\x20small\x22\x20style=\x22top:\x2055%;\x20left:\x2025%;\x20width:\x204px;\x20height:\x204px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22tree\x20big\x22\x20style=\x22top:\x2010%;\x20left:\x2070%;\x20width:\x205px;\x20height:\x205px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22tree\x20small\x22\x20style=\x22top:\x2075%;\x20left:\x2085%;\x20width:\x203px;\x20height:\x203px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22tree\x20small\x22\x20style=\x22top:\x2040%;\x20left:\x2080%;\x20width:\x204px;\x20height:\x204px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20位置标记\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22map-marker\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22marker-pin\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20width=\x2220\x22\x20height=\x2220\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M12\x202C8.13\x202\x205\x205.13\x205\x209c0\x205.25\x207\x2013\x207\x2013s7-7.75\x207-13c0-3.87-3.13-7-7-7zm0\x209.5c-1.38\x200-2.5-1.12-2.5-2.5s1.12-2.5\x202.5-2.5\x202.5\x201.12\x202.5\x202.5-1.12\x202.5-2.5\x202.5z\x22\x20fill=\x22#1890ff\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';}let locationHistory=JSON[_0x2cf6d4(0x168e)](localStorage[_0x2cf6d4(0x2250)](_0x2cf6d4(0xaac))||'[]');function saveLocationHistory(){localStorage['setItem']('locationHistory',JSON['stringify'](locationHistory));}function addToLocationHistory(_0x4b02d8){const _0x4e77d9=_0x2cf6d4;if(!_0x4b02d8[_0x4e77d9(0x1424)]())return;locationHistory=locationHistory[_0x4e77d9(0x803)](_0x5de04b=>_0x5de04b!==_0x4b02d8),locationHistory[_0x4e77d9(0x50a)](_0x4b02d8),locationHistory[_0x4e77d9(0xcbf)]>0xa&&(locationHistory=locationHistory[_0x4e77d9(0x136)](0x0,0xa)),saveLocationHistory(),renderLocationHistory();}function removeFromLocationHistory(_0x27c564){const _0x378b3e=_0x2cf6d4;locationHistory=locationHistory[_0x378b3e(0x803)](_0x569687=>_0x569687!==_0x27c564),saveLocationHistory(),renderLocationHistory();}function renderLocationHistory(){const _0x2bf23e=_0x2cf6d4,_0x3ce477=document['getElementById']('location-history-items');if(!_0x3ce477)return;if(locationHistory[_0x2bf23e(0xcbf)]===0x0){_0x3ce477['innerHTML']=_0x2bf23e(0x1105);return;}_0x3ce477['innerHTML']=locationHistory[_0x2bf23e(0xf6d)](_0x3af8e5=>'<div\x20class=\x22location-history-item\x22\x20data-location=\x22'+_0x3af8e5+_0x2bf23e(0xe64)+_0x3af8e5+_0x2bf23e(0x42a)+_0x3af8e5+_0x2bf23e(0x5d3))['join'](''),_0x3ce477[_0x2bf23e(0x11cf)]=function(_0x4782b8){const _0x4fe65e=_0x2bf23e,_0x385e8a=_0x4782b8[_0x4fe65e(0x1144)][_0x4fe65e(0x2026)](_0x4fe65e(0x1701));if(!_0x385e8a)return;const _0x301b9b=_0x385e8a[_0x4fe65e(0x1f26)][_0x4fe65e(0x63b)];_0x4782b8[_0x4fe65e(0x1144)][_0x4fe65e(0x226e)][_0x4fe65e(0x1f9)](_0x4fe65e(0x22c))?(_0x4782b8[_0x4fe65e(0x1023)](),confirmDeleteLocation(_0x301b9b)):setLocationAddress(_0x301b9b);};}let touchTimer=null,touchedElement=null;function handleLocationTouchStart(_0x5c15b3,_0x1810a7){const _0x50064f=_0x2cf6d4;touchedElement=_0x5c15b3[_0x50064f(0x1144)],touchTimer=setTimeout(()=>{confirmDeleteLocation(_0x1810a7);},0x320);}function handleLocationTouchEnd(_0x409320){const _0x3ae3b8=_0x2cf6d4;touchTimer&&(clearTimeout(touchTimer),touchTimer=null),touchedElement&&(touchedElement[_0x3ae3b8(0x226e)][_0x3ae3b8(0x128)](_0x3ae3b8(0x7a2)),touchedElement=null);}function confirmDeleteLocation(_0x28ee7c){const _0x3923a8=_0x2cf6d4;touchedElement&&touchedElement[_0x3923a8(0x226e)][_0x3923a8(0xe1)](_0x3923a8(0x7a2));if(confirm(_0x3923a8(0x148)+_0x28ee7c+_0x3923a8(0x2032)))removeFromLocationHistory(_0x28ee7c),showToast(_0x3923a8(0x107b),_0x3923a8(0xb27));else touchedElement&&touchedElement[_0x3923a8(0x226e)][_0x3923a8(0x128)]('deleting');}async function sendLocationMessage(){const _0x58b216=_0x2cf6d4,_0x146430=document[_0x58b216(0x566)](_0x58b216(0x24dd))[_0x58b216(0xc34)][_0x58b216(0x1424)]();if(!_0x146430){alert(_0x58b216(0x1dfa));return;}addToLocationHistory(_0x146430);const _0x4f29e0={'id':Date[_0x58b216(0x18e0)]()['toString'](),'sender':'sent','type':_0x58b216(0x63b),'locationName':_0x146430,'coordinates':document[_0x58b216(0x15b8)](_0x58b216(0x2256))[_0x58b216(0x21dc)],'content':_0x58b216(0x20e4)+_0x146430+_0x58b216(0x216c)+document[_0x58b216(0x15b8)]('.map-coordinates')['textContent']+']','timestamp':Date[_0x58b216(0x18e0)]()};console[_0x58b216(0xc0d)](_0x58b216(0xb2a),_0x4f29e0);if(!_0x4f29e0[_0x58b216(0xf7e)]||!_0x4f29e0[_0x58b216(0x239)]){console[_0x58b216(0x24ab)]('❌\x20位置消息数据不完整:',{'locationName':_0x4f29e0['locationName'],'coordinates':_0x4f29e0[_0x58b216(0x239)]}),alert(_0x58b216(0x24f3));return;}!chatMessages[currentChatCharacter['id']]&&(chatMessages[currentChatCharacter['id']]=[]);chatMessages[currentChatCharacter['id']][_0x58b216(0x6ee)](_0x4f29e0);try{const _0x2ee271=currentChatCharacter['id']+'_'+_0x4f29e0['id']+'_'+(chatMessages[currentChatCharacter['id']]['length']-0x1);await db[_0x58b216(0x464)][_0x58b216(0xe1)]({'id':_0x2ee271,'characterId':currentChatCharacter['id'],'timestamp':_0x4f29e0[_0x58b216(0x7aa)],'messageOrder':chatMessages[currentChatCharacter['id']][_0x58b216(0xcbf)]-0x1,'originalMessageId':_0x4f29e0['id'],'messageData':_0x4f29e0}),console[_0x58b216(0xc0d)](_0x58b216(0x476));}catch(_0x247a7a){console[_0x58b216(0x24ab)]('位置消息单条保存失败，回退到防抖保存:',_0x247a7a),saveChatMessages();}addMessageWithAnimation(_0x4f29e0,currentChatCharacter['id']),pendingUserMessage=_0x4f29e0;const _0x4f31f7=document[_0x58b216(0x566)](_0x58b216(0x9c));_0x4f31f7&&(_0x4f31f7[_0x58b216(0x655)][_0x58b216(0x4ce)]=_0x58b216(0x23f0),_0x4f31f7[_0x58b216(0x226e)][_0x58b216(0xe1)](_0x58b216(0x1f33)),_0x4f31f7[_0x58b216(0x1c18)]=_0x58b216(0x100f)),renderMessageList(),hideChatLocationModal(),showToast(_0x58b216(0x21ab),_0x58b216(0xb27));}function updateExistingLocationMaps(){const _0x1ada33=_0x2cf6d4,_0x2dbd61=document[_0x1ada33(0x1ed9)](_0x1ada33(0x798));_0x2dbd61[_0x1ada33(0x900)](_0x42e0f1=>{const _0x2ae2b1=_0x1ada33;!_0x42e0f1[_0x2ae2b1(0x15b8)](_0x2ae2b1(0x8af))&&(_0x42e0f1[_0x2ae2b1(0xc02)]=generateRealisticMapHTML());});}document[_0x2cf6d4(0x167)](_0x2cf6d4(0x7f7),function(){const _0x30109c=_0x2cf6d4,_0x2552c4=document['getElementById'](_0x30109c(0x24dd));_0x2552c4&&_0x2552c4[_0x30109c(0x167)](_0x30109c(0x627),function(){const _0x2088d0=_0x30109c,_0x3decb7=this['value']['trim']();if(_0x3decb7){document[_0x2088d0(0x566)]('map-location-display')['textContent']=_0x3decb7;const _0x3d01a3=(39.8+Math[_0x2088d0(0x191c)]()*0.4)['toFixed'](0x4),_0x2f26b2=(116.2+Math['random']()*0.4)[_0x2088d0(0x3cd)](0x4);document[_0x2088d0(0x15b8)](_0x2088d0(0x2256))[_0x2088d0(0x21dc)]=_0x2f26b2+_0x2088d0(0x235a)+_0x3d01a3+'°N';}else document[_0x2088d0(0x566)]('map-location-display')[_0x2088d0(0x21dc)]=_0x2088d0(0x1dfa);}),document[_0x30109c(0x566)](_0x30109c(0x645))?.[_0x30109c(0x167)]('click',_0xc36660=>{const _0x433e07=_0x30109c;_0xc36660['target']===document['getElementById'](_0x433e07(0x645))&&hideChatLocationModal();}),setInterval(updateExistingLocationMaps,0x3e8);});function showLocationDetail(_0x2130d9){const _0x377ce7=_0x2cf6d4;alert(_0x377ce7(0x105)+_0x2130d9);}async function calculateStorageUsage(){const _0x31aa5c=_0x2cf6d4;try{let _0x2898f1=0x0,_0x250571=0x0,_0x5b5944=0x0,_0x57411e=0x0,_0x537049=0x0,_0x211a77=0x0,_0x56fc52=0x0,_0x50389d=0x0,_0x354393=0x0,_0x290328=0x0,_0x36714f=0x0;const _0x1990f2=async _0x1ac290=>{const _0x54bbae=_0x3a81;try{return db[_0x1ac290]&&typeof db[_0x1ac290][_0x54bbae(0x18c6)]===_0x54bbae(0xb1)?await db[_0x1ac290]['toArray']():(console[_0x54bbae(0x17cc)]('表\x20'+_0x1ac290+_0x54bbae(0xbb)),[]);}catch(_0x1d1b6b){return console[_0x54bbae(0x17cc)]('获取表\x20'+_0x1ac290+'\x20数据失败:',_0x1d1b6b),[];}},[_0x1fee7b,_0x3e94d5,_0x31becc,_0x312793,_0x2e3f49,_0x4a7fcb,_0x3840b4,_0x597139,_0x4efc17,_0x92cd9a,_0x116be6,_0x2379ef,_0x28fb23,_0x2e7e22,_0x157f03,_0x44d8a3,_0x1d9928,_0x129bb1,_0x198a94,_0x4afb88,_0x47d2ff,_0x1495d9,_0x44b6e5,_0x167dde,_0x20ba22]=await Promise[_0x31aa5c(0x2339)]([_0x1990f2('chatMessages'),_0x1990f2('characters'),_0x1990f2(_0x31aa5c(0xb08)),_0x1990f2(_0x31aa5c(0x20c7)),_0x1990f2(_0x31aa5c(0x1a72)),_0x1990f2(_0x31aa5c(0x1733)),_0x1990f2(_0x31aa5c(0x18da)),_0x1990f2(_0x31aa5c(0x1a13)),_0x1990f2(_0x31aa5c(0x1f71)),_0x1990f2(_0x31aa5c(0x1d3c)),_0x1990f2(_0x31aa5c(0x9b5)),_0x1990f2(_0x31aa5c(0x2196)),_0x1990f2(_0x31aa5c(0x1e42)),_0x1990f2(_0x31aa5c(0x195c)),_0x1990f2('personas'),_0x1990f2(_0x31aa5c(0x2071)),_0x1990f2(_0x31aa5c(0xb0a)),_0x1990f2(_0x31aa5c(0x2c5)),_0x1990f2(_0x31aa5c(0x1ae2)),_0x1990f2(_0x31aa5c(0x14ee)),_0x1990f2(_0x31aa5c(0x1292)),_0x1990f2(_0x31aa5c(0xe3d)),_0x1990f2(_0x31aa5c(0x243d)),_0x1990f2(_0x31aa5c(0x2217)),_0x1990f2(_0x31aa5c(0x8e3))]),_0x543dae=_0x4e9021=>{const _0xd07337=_0x31aa5c;try{return _0x4e9021&&Array['isArray'](_0x4e9021)?JSON[_0xd07337(0x7fb)](_0x4e9021)[_0xd07337(0xcbf)]:0x0;}catch(_0x90502d){return console['warn'](_0xd07337(0x29e),_0x90502d),0x0;}};_0x2898f1=_0x543dae(_0x1fee7b),_0x250571=_0x543dae(_0x3e94d5),_0x5b5944=_0x543dae(_0x31becc)+_0x543dae(_0x44b6e5),_0x57411e=_0x543dae(_0x312793),_0x537049=_0x543dae(_0x2e3f49)+_0x543dae(_0x4a7fcb)+_0x543dae(_0x3840b4),_0x211a77=_0x543dae(_0x597139)+_0x543dae(_0x4efc17)+_0x543dae(_0x92cd9a),_0x56fc52=_0x543dae(_0x116be6)+_0x543dae(_0x2379ef)+_0x543dae(_0x28fb23)+_0x543dae(_0x20ba22),_0x50389d=_0x543dae(_0x2e7e22),_0x354393=_0x543dae(_0x157f03),_0x290328=_0x543dae(_0x44d8a3)+_0x543dae(_0x1d9928),_0x36714f=_0x543dae(_0x129bb1)+_0x543dae(_0x198a94)+_0x543dae(_0x4afb88)+_0x543dae(_0x47d2ff)+_0x543dae(_0x1495d9)+_0x543dae(_0x167dde);const _0x2d1ec5=_0x2898f1+_0x250571+_0x5b5944+_0x57411e+_0x537049+_0x211a77+_0x56fc52+_0x50389d+_0x354393+_0x290328+_0x36714f,_0x425d89=_0x62d681=>{const _0x51e6e6=_0x31aa5c;if(_0x62d681===0x0)return _0x51e6e6(0x119f);const _0x165569=0x400,_0x9b9c05=['B','KB','MB','GB'],_0x141f82=Math[_0x51e6e6(0x1dac)](Math[_0x51e6e6(0xc0d)](_0x62d681)/Math[_0x51e6e6(0xc0d)](_0x165569));return parseFloat((_0x62d681/Math['pow'](_0x165569,_0x141f82))[_0x51e6e6(0x3cd)](0x2))+'\x20'+_0x9b9c05[_0x141f82];},_0x337c7f=(_0x3c70bd,_0x5213b1)=>{const _0xb08dcb=_0x31aa5c;try{const _0xc35b15=document[_0xb08dcb(0x566)](_0x3c70bd);_0xc35b15?_0xc35b15[_0xb08dcb(0x21dc)]=_0x425d89(_0x5213b1):console[_0xb08dcb(0x17cc)](_0xb08dcb(0x68a)+_0x3c70bd);}catch(_0x1c335a){console[_0xb08dcb(0x17cc)](_0xb08dcb(0xa55)+_0x3c70bd+':',_0x1c335a);}};_0x337c7f(_0x31aa5c(0xaa6),_0x2898f1),_0x337c7f(_0x31aa5c(0x223e),_0x250571),_0x337c7f('settings-storage-size',_0x5b5944),_0x337c7f('emoji-storage-size',_0x57411e),_0x337c7f(_0x31aa5c(0xe0a),_0x537049),_0x337c7f(_0x31aa5c(0x8ed),_0x211a77),_0x337c7f(_0x31aa5c(0xd8d),_0x56fc52),_0x337c7f(_0x31aa5c(0x1ff6),_0x50389d),_0x337c7f(_0x31aa5c(0x1a67),_0x354393),_0x337c7f(_0x31aa5c(0x23a),_0x290328),_0x337c7f(_0x31aa5c(0x159d),_0x36714f),_0x337c7f('total-storage-size',_0x2d1ec5),console['log'](_0x31aa5c(0x11e3)),console[_0x31aa5c(0xc0d)](_0x31aa5c(0x26d)+_0x425d89(_0x2898f1)),console[_0x31aa5c(0xc0d)]('角色数据:\x20'+_0x425d89(_0x250571)),console['log'](_0x31aa5c(0x1d61)+_0x425d89(_0x5b5944)),console[_0x31aa5c(0xc0d)](_0x31aa5c(0xbe1)+_0x425d89(_0x57411e)),console[_0x31aa5c(0xc0d)]('动态数据:\x20'+_0x425d89(_0x537049)),console[_0x31aa5c(0xc0d)](_0x31aa5c(0xd9d)+_0x425d89(_0x211a77)),console[_0x31aa5c(0xc0d)](_0x31aa5c(0x434)+_0x425d89(_0x56fc52)),console[_0x31aa5c(0xc0d)]('世界书:\x20'+_0x425d89(_0x50389d)),console[_0x31aa5c(0xc0d)](_0x31aa5c(0x224a)+_0x425d89(_0x354393)),console[_0x31aa5c(0xc0d)](_0x31aa5c(0x1666)+_0x425d89(_0x290328)),console['log'](_0x31aa5c(0x1e89)+_0x425d89(_0x36714f)),console['log'](_0x31aa5c(0x242c)+_0x425d89(_0x2d1ec5));if(_0x2d1ec5>0x0){const _0x56d182=_0xa4bf99=>(_0xa4bf99/_0x2d1ec5*0x64)[_0x31aa5c(0x3cd)](0x1);console[_0x31aa5c(0xc0d)](_0x31aa5c(0x2247)),console[_0x31aa5c(0xc0d)](_0x31aa5c(0x26d)+_0x56d182(_0x2898f1)+'%'),console['log'](_0x31aa5c(0x24c1)+_0x56d182(_0x250571)+'%'),console[_0x31aa5c(0xc0d)](_0x31aa5c(0x1403)+_0x56d182(_0x537049)+'%'),console[_0x31aa5c(0xc0d)](_0x31aa5c(0xd9d)+_0x56d182(_0x211a77)+'%'),console['log'](_0x31aa5c(0x434)+_0x56d182(_0x56fc52)+'%');}}catch(_0xe2c5e3){console[_0x31aa5c(0x24ab)](_0x31aa5c(0x1a56),_0xe2c5e3);const _0x584e1e='计算失败',_0x5d81d8=_0x6d13b8=>{const _0x217a21=_0x31aa5c;try{const _0x5b47e7=document['getElementById'](_0x6d13b8);if(_0x5b47e7)_0x5b47e7['textContent']=_0x584e1e;}catch(_0x3cc7de){console[_0x217a21(0x17cc)]('更新错误信息失败\x20'+_0x6d13b8+':',_0x3cc7de);}};[_0x31aa5c(0xaa6),'character-storage-size',_0x31aa5c(0x2a6),_0x31aa5c(0x240a),_0x31aa5c(0xe0a),_0x31aa5c(0x8ed),'memory-storage-size',_0x31aa5c(0x1ff6),_0x31aa5c(0x1a67),_0x31aa5c(0x23a),_0x31aa5c(0x159d),'total-storage-size'][_0x31aa5c(0x900)](_0x5d81d8),typeof showToast===_0x31aa5c(0xb1)&&showToast(_0x31aa5c(0x240c),_0x31aa5c(0x24ab));}}async function optimizeMomentsStorage(){const _0x2d6cf3=_0x2cf6d4;try{console[_0x2d6cf3(0xc0d)]('🗜️\x20开始优化动态存储...');let _0x4d4848=0x0,_0x26b7eb=0x0;const _0x59e378=await db['moments'][_0x2d6cf3(0x18c6)]();for(const _0x52d9bd of _0x59e378){if(_0x52d9bd['avatar']){const _0x4943bc=_0x52d9bd[_0x2d6cf3(0x107f)][_0x2d6cf3(0xcbf)];_0x4d4848+=_0x4943bc,await db[_0x2d6cf3(0x1a72)]['update'](_0x52d9bd['id'],{'avatar':undefined}),_0x26b7eb++,console[_0x2d6cf3(0xc0d)]('清理动态\x20'+_0x52d9bd['id']+'\x20的头像数据，节省\x20'+Math['round'](_0x4943bc/0x400)+'KB');}}const _0x5ec7b1=await db[_0x2d6cf3(0x1733)][_0x2d6cf3(0x18c6)](),_0x4d8c39=new Map();let _0xdbd507=0x0;for(const _0x56d31b of _0x5ec7b1){const _0x4d381b=_0x56d31b[_0x2d6cf3(0x2289)]+'-'+_0x56d31b[_0x2d6cf3(0x3df)]+'-'+_0x56d31b['text']+'-'+_0x56d31b[_0x2d6cf3(0x7aa)];_0x4d8c39[_0x2d6cf3(0x1af1)](_0x4d381b)?(await db[_0x2d6cf3(0x1733)][_0x2d6cf3(0xc2b)](_0x56d31b['id']),_0xdbd507++):_0x4d8c39['set'](_0x4d381b,_0x56d31b);}console[_0x2d6cf3(0xc0d)](_0x2d6cf3(0x1f67)),console[_0x2d6cf3(0xc0d)]('-\x20清理了\x20'+_0x26b7eb+'\x20条动态的冗余头像数据'),console['log'](_0x2d6cf3(0xbdb)+Math[_0x2d6cf3(0x5f3)](_0x4d4848/0x400)+'KB'),console[_0x2d6cf3(0xc0d)](_0x2d6cf3(0x2562)+_0xdbd507+_0x2d6cf3(0xb44)),showToast(_0x2d6cf3(0x21ad)+Math['round'](_0x4d4848/0x400)+_0x2d6cf3(0x167d),'success'),calculateStorageUsage();}catch(_0x3d2f21){console[_0x2d6cf3(0x24ab)](_0x2d6cf3(0x344),_0x3d2f21),showToast(_0x2d6cf3(0x1c90),_0x2d6cf3(0x24ab));}}async function optimizeForumStorage(){const _0xa673b3=_0x2cf6d4;try{console[_0xa673b3(0xc0d)](_0xa673b3(0x17e7));if(!confirm('论坛存储优化将清理帖子和回复中的冗余头像数据，这可能需要一些时间。\x0a\x0a注意：此操作不可撤销，建议先备份数据。\x0a\x0a确定要继续吗？'))return;showToast(_0xa673b3(0x1c81),'info');let _0x30b636=0x0,_0xa6e05c=0x0,_0x42fe3f=0x0,_0x53803f=0x0,_0x2af7b2=0x0;console[_0xa673b3(0xc0d)](_0xa673b3(0x1fd8));const _0x16ac98=await db[_0xa673b3(0x1f71)][_0xa673b3(0x18c6)]();for(const _0x516959 of _0x16ac98){if(_0x516959['authorAvatar']&&_0x516959[_0xa673b3(0x239d)][_0xa673b3(0xcbf)]>0x2710){const _0x3fa58c=_0x516959[_0xa673b3(0x239d)]['length'];try{const _0x529eeb=await compressImage(_0x516959['authorAvatar'],0x40,0.7);await db[_0xa673b3(0x1f71)][_0xa673b3(0x2180)](_0x516959['id'],{'authorAvatar':_0x529eeb}),_0x30b636+=_0x3fa58c-_0x529eeb['length'],_0xa6e05c++,console[_0xa673b3(0xc0d)](_0xa673b3(0x837)+_0x516959['id']+_0xa673b3(0x17d1)+Math[_0xa673b3(0x5f3)]((_0x3fa58c-_0x529eeb[_0xa673b3(0xcbf)])/0x400)+'KB');}catch(_0x151f27){console['warn'](_0xa673b3(0x837)+_0x516959['id']+_0xa673b3(0x1fc7),_0x151f27);const _0x558b5e=createCompressedDefaultAvatar(_0x516959[_0xa673b3(0x16c3)]||'用户');await db['forumPosts'][_0xa673b3(0x2180)](_0x516959['id'],{'authorAvatar':_0x558b5e}),_0x30b636+=_0x3fa58c-_0x558b5e[_0xa673b3(0xcbf)],_0xa6e05c++;}}}console[_0xa673b3(0xc0d)](_0xa673b3(0x1d31));const _0xc36e2e=await db[_0xa673b3(0x1d3c)][_0xa673b3(0x18c6)]();for(const _0x3ac93f of _0xc36e2e){if(_0x3ac93f[_0xa673b3(0x239d)]&&_0x3ac93f[_0xa673b3(0x239d)]['length']>0x2710){const _0x38be59=_0x3ac93f[_0xa673b3(0x239d)]['length'];try{const _0x5800ee=await compressImage(_0x3ac93f['authorAvatar'],0x40,0.7);await db[_0xa673b3(0x1d3c)]['update'](_0x3ac93f['id'],{'authorAvatar':_0x5800ee}),_0x30b636+=_0x38be59-_0x5800ee[_0xa673b3(0xcbf)],_0x42fe3f++,console[_0xa673b3(0xc0d)](_0xa673b3(0x887)+_0x3ac93f['id']+_0xa673b3(0x17d1)+Math['round']((_0x38be59-_0x5800ee[_0xa673b3(0xcbf)])/0x400)+'KB');}catch(_0x5298c1){console[_0xa673b3(0x17cc)](_0xa673b3(0x887)+_0x3ac93f['id']+_0xa673b3(0x1fc7),_0x5298c1);const _0x39c27b=createCompressedDefaultAvatar(_0x3ac93f[_0xa673b3(0x16c3)]||'用户');await db['forumReplies'][_0xa673b3(0x2180)](_0x3ac93f['id'],{'authorAvatar':_0x39c27b}),_0x30b636+=_0x38be59-_0x39c27b[_0xa673b3(0xcbf)],_0x42fe3f++;}}}console[_0xa673b3(0xc0d)](_0xa673b3(0x3bd));const _0x3e971e=new Map();for(const _0xe5e4ba of _0x16ac98){const _0x3ce287=_0xe5e4ba[_0xa673b3(0x1c18)]+'_'+_0xe5e4ba[_0xa673b3(0x1423)]+'_'+Math['floor'](_0xe5e4ba[_0xa673b3(0x7aa)]/0xea60);if(_0x3e971e[_0xa673b3(0x1af1)](_0x3ce287)){const _0x426efa=_0x3e971e[_0xa673b3(0x46a)](_0x3ce287);_0xe5e4ba[_0xa673b3(0x7aa)]>_0x426efa[_0xa673b3(0x7aa)]?(await db[_0xa673b3(0x1f71)]['delete'](_0xe5e4ba['id']),_0x53803f++):(await db['forumPosts'][_0xa673b3(0xc2b)](_0x426efa['id']),_0x3e971e[_0xa673b3(0x21c0)](_0x3ce287,_0xe5e4ba),_0x53803f++);}else _0x3e971e[_0xa673b3(0x21c0)](_0x3ce287,_0xe5e4ba);}console['log']('🧹\x20清理重复回复...');const _0x4e1679=new Map();for(const _0x1a2007 of _0xc36e2e){const _0x28fcc6=_0x1a2007[_0xa673b3(0x12b6)]+'_'+_0x1a2007[_0xa673b3(0x1423)]+'_'+Math['floor'](_0x1a2007[_0xa673b3(0x7aa)]/0xea60);if(_0x4e1679[_0xa673b3(0x1af1)](_0x28fcc6)){const _0x6e4f15=_0x4e1679[_0xa673b3(0x46a)](_0x28fcc6);_0x1a2007[_0xa673b3(0x7aa)]>_0x6e4f15['timestamp']?(await db[_0xa673b3(0x1d3c)]['delete'](_0x1a2007['id']),_0x2af7b2++):(await db[_0xa673b3(0x1d3c)][_0xa673b3(0xc2b)](_0x6e4f15['id']),_0x4e1679['set'](_0x28fcc6,_0x1a2007),_0x2af7b2++);}else _0x4e1679[_0xa673b3(0x21c0)](_0x28fcc6,_0x1a2007);}console[_0xa673b3(0xc0d)](_0xa673b3(0x198b));const _0x13dd7a=await db[_0xa673b3(0x1f71)][_0xa673b3(0x18c6)](),_0x4a4916=new Set(_0x13dd7a['map'](_0x486d5c=>_0x486d5c['id'])),_0x546ac9=await db[_0xa673b3(0x1d3c)][_0xa673b3(0x18c6)]();let _0x8847f8=0x0;for(const _0xd63f37 of _0x546ac9){!_0x4a4916[_0xa673b3(0x1af1)](_0xd63f37['postId'])&&(await db['forumReplies'][_0xa673b3(0xc2b)](_0xd63f37['id']),_0x8847f8++);}console[_0xa673b3(0xc0d)](_0xa673b3(0x44f));const _0x32d4ce=await db[_0xa673b3(0x1dd3)][_0xa673b3(0x18c6)]();let _0x243d1b=0x0;for(const _0x3e3287 of _0x32d4ce){!_0x4a4916[_0xa673b3(0x1af1)](_0x3e3287['postId'])&&(await db[_0xa673b3(0x1dd3)]['delete'](_0x3e3287['id']),_0x243d1b++);}console['log'](_0xa673b3(0xa2f)),console[_0xa673b3(0xc0d)](_0xa673b3(0x2562)+_0xa6e05c+_0xa673b3(0x199c)),console[_0xa673b3(0xc0d)](_0xa673b3(0x2562)+_0x42fe3f+_0xa673b3(0x833)),console[_0xa673b3(0xc0d)]('-\x20删除了\x20'+_0x53803f+_0xa673b3(0x2516)),console[_0xa673b3(0xc0d)](_0xa673b3(0xcd6)+_0x2af7b2+_0xa673b3(0x2209)),console[_0xa673b3(0xc0d)]('-\x20删除了\x20'+_0x8847f8+_0xa673b3(0x18bc)),console[_0xa673b3(0xc0d)](_0xa673b3(0xcd6)+_0x243d1b+_0xa673b3(0x1abe)),console[_0xa673b3(0xc0d)](_0xa673b3(0xbdb)+Math['round'](_0x30b636/0x400)+'KB');const _0x4237dd='论坛存储优化完成！\x0a\x0a'+_0xa673b3(0x166d)+(_0xa673b3(0x4a3)+_0xa6e05c+'个\x0a')+(_0xa673b3(0x1fcd)+_0x42fe3f+'个\x0a')+(_0xa673b3(0xf7)+_0x53803f+'个\x0a')+('•\x20重复回复:\x20'+_0x2af7b2+'个\x0a')+(_0xa673b3(0x1acc)+_0x8847f8+'个\x0a')+(_0xa673b3(0x6bf)+_0x243d1b+_0xa673b3(0x1188))+('💾\x20节省空间:\x20'+Math['round'](_0x30b636/0x400)+'KB');showToast(_0xa673b3(0xa9b)+Math[_0xa673b3(0x5f3)](_0x30b636/0x400)+_0xa673b3(0x167d),_0xa673b3(0xb27)),alert(_0x4237dd),calculateStorageUsage();}catch(_0x1f88b8){console['error'](_0xa673b3(0x2321),_0x1f88b8),showToast(_0xa673b3(0x1d56)+_0x1f88b8[_0xa673b3(0xd7a)],_0xa673b3(0x24ab));}}async function cleanupLocalMusic(){const _0x3a09b7=_0x2cf6d4;try{const _0x3e359f=await db['musicPlaylist'][_0x3a09b7(0x18c6)](),_0x5b05c4=await db['musicCovers'][_0x3a09b7(0x18c6)]();if(_0x3e359f[_0x3a09b7(0xcbf)]===0x0&&_0x5b05c4['length']===0x0){showToast(_0x3a09b7(0x2340),_0x3a09b7(0x2422));return;}let _0x392253=0x0,_0x406201=0x0;_0x3e359f['forEach'](_0x2ee76c=>{const _0x287626=_0x3a09b7;_0x2ee76c['isLocalFile']&&_0x2ee76c[_0x287626(0x10c6)]&&(_0x2ee76c['url']['startsWith'](_0x287626(0x1784))&&(_0x392253+=_0x2ee76c[_0x287626(0x10c6)][_0x287626(0xcbf)],_0x406201++));}),_0x5b05c4[_0x3a09b7(0x900)](_0x28501d=>{const _0x45cbca=_0x3a09b7;_0x28501d['imageData']&&(_0x392253+=_0x28501d[_0x45cbca(0xfe5)][_0x45cbca(0xcbf)]);});const _0x5cc679=(_0x392253/(0x400*0x400))[_0x3a09b7(0x3cd)](0x2),_0x5a6b5c=_0x3a09b7(0x1225)+'📊\x20清理统计:\x0a'+('•\x20音乐文件:\x20'+_0x3e359f[_0x3a09b7(0xcbf)]+'首\x0a')+(_0x3a09b7(0x301)+_0x406201+'首\x0a')+(_0x3a09b7(0xda1)+_0x5b05c4[_0x3a09b7(0xcbf)]+'个\x0a')+(_0x3a09b7(0x3e5)+_0x5cc679+_0x3a09b7(0x70e))+_0x3a09b7(0x2134)+_0x3a09b7(0x1ca6)+'确定要继续吗？';if(!confirm(_0x5a6b5c))return;showToast(_0x3a09b7(0xbe4),'info');musicPlayer[_0x3a09b7(0x1565)]&&(musicPlayer[_0x3a09b7(0x1565)]['pause'](),musicPlayer[_0x3a09b7(0x1565)]=null);await db[_0x3a09b7(0x13ac)][_0x3a09b7(0x2215)](),await db['musicCovers'][_0x3a09b7(0x2215)](),musicPlayer[_0x3a09b7(0xcbb)]=[],musicPlayer[_0x3a09b7(0xbbd)]=null,musicPlayer[_0x3a09b7(0xd73)]=0x0,musicPlayer['isPlaying']=![],musicPlayer[_0x3a09b7(0x17d9)]=![],updateMusicDisplay();const _0x17905d=document['getElementById']('playlist-items');_0x17905d&&(_0x17905d[_0x3a09b7(0xc02)]='<div\x20class=\x22empty-playlist\x22>播放列表为空</div>');calculateStorageUsage();const _0x47c86e='本地音乐清理完成！\x0a\x0a'+_0x3a09b7(0x166d)+(_0x3a09b7(0x1337)+_0x3e359f[_0x3a09b7(0xcbf)]+'首\x0a')+(_0x3a09b7(0x1545)+_0x406201+'首\x0a')+(_0x3a09b7(0x1c6e)+_0x5b05c4[_0x3a09b7(0xcbf)]+_0x3a09b7(0x1188))+(_0x3a09b7(0x19b6)+_0x5cc679+_0x3a09b7(0x70e))+_0x3a09b7(0xc93);showToast('本地音乐清理完成，释放\x20'+_0x5cc679+_0x3a09b7(0x24be),_0x3a09b7(0xb27)),alert(_0x47c86e),console[_0x3a09b7(0xc0d)](_0x3a09b7(0x1668),{'deletedSongs':_0x3e359f['length'],'deletedLocalFiles':_0x406201,'deletedCovers':_0x5b05c4[_0x3a09b7(0xcbf)],'freedSpaceMB':_0x5cc679});}catch(_0x4a483c){console[_0x3a09b7(0x24ab)](_0x3a09b7(0x174e),_0x4a483c),showToast('清理本地音乐失败:\x20'+_0x4a483c['message'],'error');}}function diagnoseBrowserCompatibility(){const _0x461115=_0x2cf6d4;console['log']('🔍\x20浏览器兼容性诊断报告:'),console['log']('浏览器信息:',{'userAgent':navigator[_0x461115(0x473)],'vendor':navigator['vendor'],'platform':navigator[_0x461115(0xcc1)]}),console[_0x461115(0xc0d)](_0x461115(0x1703),{'charactersCount':characters[_0x461115(0xcbf)],'contactsCount':contacts['length'],'chatMessagesKeys':Object['keys'](chatMessages)[_0x461115(0xcbf)],'charactersData':characters[_0x461115(0x136)](0x0,0x2),'contactsData':contacts[_0x461115(0x136)](0x0,0xa)}),console[_0x461115(0xc0d)]('DOM状态:',{'messageListExists':!!document[_0x461115(0x566)]('message-list'),'messageItemsCount':document[_0x461115(0x1ed9)]('.message-item')[_0x461115(0xcbf)]}),console[_0x461115(0xc0d)](_0x461115(0xddb),{'dbVersion':db['verno'],'dbTables':db[_0x461115(0x1faf)]['map'](_0x32c5e6=>_0x32c5e6['name'])});}async function forceFixDataConsistency(){const _0x19f8ba=_0x2cf6d4;try{console[_0x19f8ba(0xc0d)]('🔧\x20开始强制修复数据一致性...'),showToast('正在修复数据一致性...',_0x19f8ba(0x2422)),await Promise[_0x19f8ba(0x2339)]([loadCharacters(),loadChatMessages()]);if(characters[_0x19f8ba(0xcbf)]>0x0&&contacts[_0x19f8ba(0xcbf)]===0x0){const _0x24d104=Object[_0x19f8ba(0x16c7)](chatMessages)[_0x19f8ba(0x803)](_0x5632bf=>characters[_0x19f8ba(0x184b)](_0x148330=>_0x148330['id']===_0x5632bf));_0x24d104[_0x19f8ba(0xcbf)]>0x0?(contacts=_0x24d104,await saveContacts(),console[_0x19f8ba(0xc0d)](_0x19f8ba(0x1b02)+contacts[_0x19f8ba(0xcbf)]+_0x19f8ba(0x16f6))):console['log'](_0x19f8ba(0x123e));}else console[_0x19f8ba(0xc0d)](_0x19f8ba(0x115a));renderMessageList(),renderContactList(),console['log'](_0x19f8ba(0x11f4)),showToast(_0x19f8ba(0x13fc),_0x19f8ba(0xb27));}catch(_0x13a95e){console[_0x19f8ba(0x24ab)]('❌\x20数据一致性修复失败:',_0x13a95e),showToast('数据一致性修复失败','error');}}window['debugTools']={'diagnose':diagnoseBrowserCompatibility,'fix':forceFixDataConsistency,'showData':function(){const _0x397c2a=_0x2cf6d4;console[_0x397c2a(0xc0d)](_0x397c2a(0x4e8)),console[_0x397c2a(0xc0d)](_0x397c2a(0x9fa),characters),console[_0x397c2a(0xc0d)](_0x397c2a(0x1054),contacts),console[_0x397c2a(0xc0d)](_0x397c2a(0xc44),chatMessages),console[_0x397c2a(0xc0d)](_0x397c2a(0x1e85),{'messageItems':document['querySelectorAll'](_0x397c2a(0x1a15))[_0x397c2a(0xcbf)],'contactItems':document[_0x397c2a(0x1ed9)](_0x397c2a(0x1691))[_0x397c2a(0xcbf)]});},'rerender':function(){const _0x4742ce=_0x2cf6d4;console['log'](_0x4742ce(0x12fe)),renderMessageList(),renderContactList(),renderCharacterList(),console[_0x4742ce(0xc0d)](_0x4742ce(0xeda));},'reload':async function(){const _0x1c55c7=_0x2cf6d4;console['log'](_0x1c55c7(0x1186)),await Promise['all']([loadCharacters(),loadContacts(),loadChatMessages()]),this[_0x1c55c7(0xb54)](),console['log'](_0x1c55c7(0x4e1));},'testDeleteConversation':function(){const _0x303da9=_0x2cf6d4;console[_0x303da9(0xc0d)](_0x303da9(0xf72)),console[_0x303da9(0xc0d)](_0x303da9(0x17b8),{'charactersCount':characters['length'],'contactsCount':contacts[_0x303da9(0xcbf)],'contacts':[...contacts]});if(contacts[_0x303da9(0xcbf)]>0x0){const _0x471d6e=contacts[0x0];console['log']('🧪\x20模拟删除对话:\x20'+_0x471d6e);const _0x1a77b0=contacts[_0x303da9(0x167a)](_0x471d6e);_0x1a77b0>-0x1&&(contacts[_0x303da9(0x220f)](_0x1a77b0,0x1),saveContacts(),this['rerender'](),console[_0x303da9(0xc0d)]('删除后状态:',{'contactsCount':contacts['length'],'contacts':[...contacts]}),console[_0x303da9(0xc0d)](_0x303da9(0x927)));}else console[_0x303da9(0xc0d)]('⚠️\x20没有对话可以测试删除');}},console[_0x2cf6d4(0xc0d)](_0x2cf6d4(0x2ec)),console[_0x2cf6d4(0xc0d)](_0x2cf6d4(0x218)),console[_0x2cf6d4(0xc0d)](_0x2cf6d4(0x9b1)),console[_0x2cf6d4(0xc0d)](_0x2cf6d4(0x1506)),console[_0x2cf6d4(0xc0d)](_0x2cf6d4(0xdec)),console[_0x2cf6d4(0xc0d)]('debugTools.reload()\x20-\x20重新加载所有数据'),console[_0x2cf6d4(0xc0d)]('debugTools.testDeleteConversation()\x20-\x20测试删除对话功能'),console[_0x2cf6d4(0xc0d)](_0x2cf6d4(0x2087));async function exportAllData(){const _0x1915ef=_0x2cf6d4;try{const _0x2e6634=/^((?!chrome|android).)*safari/i[_0x1915ef(0x17ba)](navigator[_0x1915ef(0x473)]),_0x2e64de=/iPhone|iPad|iPod|Android/i['test'](navigator[_0x1915ef(0x473)]);_0x2e6634&&_0x2e64de?showToast('检测到Safari移动版，使用优化模式...','info'):showToast(_0x1915ef(0xd35),'info');let _0x1aea81=null;_0x1915ef(0x1790)in performance&&(_0x1aea81=performance[_0x1915ef(0x1790)],console[_0x1915ef(0xc0d)](_0x1915ef(0x26f),{'used':Math[_0x1915ef(0x5f3)](_0x1aea81['usedJSHeapSize']/0x400/0x400)+'MB','total':Math['round'](_0x1aea81['totalJSHeapSize']/0x400/0x400)+'MB','limit':Math[_0x1915ef(0x5f3)](_0x1aea81[_0x1915ef(0x16e0)]/0x400/0x400)+'MB'}));console[_0x1915ef(0xc0d)]('🔍\x20数据库版本:',db[_0x1915ef(0x47c)]),console[_0x1915ef(0xc0d)]('🔍\x20数据库表列表:',db[_0x1915ef(0x1faf)][_0x1915ef(0xf6d)](_0x1065fa=>_0x1065fa[_0x1915ef(0x222f)])),showToast(_0x1915ef(0xa3e),_0x1915ef(0x2422));const _0x3c23a3={'version':_0x1915ef(0x176d),'exportTime':new Date()[_0x1915ef(0xa4b)]()};try{const _0x3b344a=await db[_0x1915ef(0x464)][_0x1915ef(0x35e)](),_0x432261=await db[_0x1915ef(0xb76)]['count'](),_0x562e9c=_0x3b344a+_0x432261;console[_0x1915ef(0xc0d)](_0x1915ef(0x426)+_0x3b344a+'\x20条,\x20群聊消息\x20'+_0x432261+_0x1915ef(0x928)+_0x562e9c+'\x20条');let _0x30b335=![],_0x46820a='';if(_0x562e9c>0xc350)_0x30b335=!![],_0x46820a='检测到超大量消息数据\x20('+_0x562e9c+'\x20条)\x0a\x0a完整导出可能导致浏览器崩溃！';else{if(_0x562e9c>0x4e20)_0x30b335=!![],_0x46820a=_0x1915ef(0xcb7)+_0x562e9c+_0x1915ef(0x1c5a);else _0x562e9c>0x2710&&(_0x46820a=_0x1915ef(0x168f)+_0x562e9c+'\x20条)\x0a\x0a建议使用轻量级导出以提高成功率。');}if(_0x46820a){const _0x123bcf=confirm(_0x46820a+'\x0a\x0a'+_0x1915ef(0x412)+_0x1915ef(0x7ab)+'点击\x22确定\x22使用轻量级导出\x0a'+(_0x1915ef(0x2191)+(_0x30b335?_0x1915ef(0x79c):'（可能失败）')));if(_0x123bcf){await exportLightweightData();return;}else{if(_0x30b335){const _0x371bd1=confirm(_0x1915ef(0xa64)+'您的数据量非常大，完整导出很可能失败并导致浏览器卡死。\x0a\x0a'+_0x1915ef(0x1be8)+_0x1915ef(0xa7a));if(!_0x371bd1){await exportLightweightData();return;}}}}}catch(_0x3f1b7e){console['warn']('⚠️\x20预检查失败，继续正常导出:',_0x3f1b7e);}const _0x1fe725=[{'name':'characters','label':'角色'},{'name':_0x1915ef(0xb08),'label':_0x1915ef(0x1ed)},{'name':'contacts','label':'联系人'},{'name':'personas','label':'用户面具'},{'name':_0x1915ef(0x15e0),'label':_0x1915ef(0x1843)},{'name':_0x1915ef(0x14ee),'label':'群聊'},{'name':_0x1915ef(0x195c),'label':_0x1915ef(0x13da)},{'name':_0x1915ef(0x530),'label':_0x1915ef(0x72a)},{'name':_0x1915ef(0x2217),'label':_0x1915ef(0x1dc9)},{'name':_0x1915ef(0x229d),'label':'壁纸'},{'name':_0x1915ef(0x1f22),'label':_0x1915ef(0x1c26)},{'name':_0x1915ef(0x2c5),'label':_0x1915ef(0xad0)},{'name':_0x1915ef(0xda3),'label':_0x1915ef(0x2342)},{'name':'worldbookEntries','label':_0x1915ef(0x5a8)},{'name':_0x1915ef(0x20c7),'label':'自定义表情'},{'name':'recentEmojis','label':_0x1915ef(0x1069)},{'name':_0x1915ef(0xa83),'label':_0x1915ef(0x19a2)},{'name':'moments','label':'动态'},{'name':'momentLikes','label':_0x1915ef(0x18c4)},{'name':_0x1915ef(0x1733),'label':'动态评论'},{'name':_0x1915ef(0x8e3),'label':_0x1915ef(0xe77)},{'name':_0x1915ef(0xfc7),'label':'心声'},{'name':_0x1915ef(0x1a13),'label':'论坛'},{'name':_0x1915ef(0x1f71),'label':_0x1915ef(0x963)},{'name':_0x1915ef(0x1d3c),'label':_0x1915ef(0x59f)},{'name':_0x1915ef(0x1dd3),'label':'论坛收藏'},{'name':_0x1915ef(0x11ba),'label':_0x1915ef(0x5da)},{'name':_0x1915ef(0x3b2),'label':_0x1915ef(0x1b61)},{'name':'forumMountedWorldbooks','label':_0x1915ef(0x1bf3)},{'name':_0x1915ef(0x9b5),'label':_0x1915ef(0xed5)},{'name':'episodicMemory','label':_0x1915ef(0x17e1)},{'name':_0x1915ef(0x222e),'label':_0x1915ef(0x404)},{'name':_0x1915ef(0x1982),'label':'记忆总结'},{'name':'memoryEvents','label':_0x1915ef(0x1792)},{'name':_0x1915ef(0x1e42),'label':_0x1915ef(0x1ddf)},{'name':_0x1915ef(0xa1b),'label':_0x1915ef(0x1e68)},{'name':_0x1915ef(0x75b),'label':_0x1915ef(0xf11)},{'name':_0x1915ef(0x1c45),'label':_0x1915ef(0x1196)},{'name':'blockedCharacters','label':_0x1915ef(0x24cf)},{'name':_0x1915ef(0xa52),'label':'好友申请'},{'name':'characterStatus','label':'角色状态'},{'name':_0x1915ef(0x1143),'label':_0x1915ef(0xdee)},{'name':_0x1915ef(0xe3d),'label':_0x1915ef(0x17ff)},{'name':_0x1915ef(0xa0c),'label':'线下预设'},{'name':_0x1915ef(0x13ac),'label':'音乐播放列表'},{'name':_0x1915ef(0x1235),'label':_0x1915ef(0x99a)},{'name':_0x1915ef(0x111c),'label':'短信联系人'},{'name':_0x1915ef(0xd94),'label':_0x1915ef(0x1c62)},{'name':_0x1915ef(0x464),'label':_0x1915ef(0x2069)},{'name':_0x1915ef(0xb76),'label':'群聊消息'}];let _0x4422c7=0x0;const _0x3b9517=_0x1fe725[_0x1915ef(0xcbf)];for(const _0x8987b of _0x1fe725){try{showToast(_0x1915ef(0x7b3)+_0x8987b[_0x1915ef(0x20f7)]+_0x1915ef(0xe02)+(_0x4422c7+0x1)+'/'+_0x3b9517+')','info');if(db[_0x8987b[_0x1915ef(0x222f)]]){let _0xb91214=await db[_0x8987b[_0x1915ef(0x222f)]][_0x1915ef(0x18c6)]();_0x8987b[_0x1915ef(0x222f)]===_0x1915ef(0x20c7)?(_0xb91214=_0xb91214[_0x1915ef(0x803)](_0x3e6518=>_0x3e6518[_0x1915ef(0xd6e)]!==![]),console[_0x1915ef(0xc0d)](_0x1915ef(0x992)+_0x8987b[_0x1915ef(0x20f7)]+':\x20'+_0xb91214[_0x1915ef(0xcbf)]+_0x1915ef(0xb25))):console[_0x1915ef(0xc0d)]('✅\x20加载\x20'+_0x8987b[_0x1915ef(0x20f7)]+':\x20'+_0xb91214['length']+_0x1915ef(0x125d)),_0x3c23a3[_0x8987b[_0x1915ef(0x222f)]]=_0xb91214;}else console[_0x1915ef(0x17cc)](_0x1915ef(0x2267)+_0x8987b['name']+_0x1915ef(0x11a0)),_0x3c23a3[_0x8987b[_0x1915ef(0x222f)]]=[];_0x4422c7++,_0x4422c7%0x5===0x0&&await new Promise(_0x469d2f=>setTimeout(_0x469d2f,0x64));}catch(_0x730953){console[_0x1915ef(0x24ab)]('❌\x20加载\x20'+_0x8987b['label']+_0x1915ef(0xcf8),_0x730953),_0x3c23a3[_0x8987b['name']]=[];}}showToast(_0x1915ef(0x1d69),_0x1915ef(0x2422));const _0x5f1b00=[];if(_0x3c23a3[_0x1915ef(0x164d)]?.['length'])_0x5f1b00[_0x1915ef(0x6ee)](_0x1915ef(0x1e8d)+_0x3c23a3['characters'][_0x1915ef(0xcbf)]+'个');if(_0x3c23a3[_0x1915ef(0x464)]?.['length'])_0x5f1b00[_0x1915ef(0x6ee)](_0x1915ef(0x18d4)+_0x3c23a3[_0x1915ef(0x464)][_0x1915ef(0xcbf)]+'条');if(_0x3c23a3[_0x1915ef(0x1f1d)]?.[_0x1915ef(0xcbf)])_0x5f1b00[_0x1915ef(0x6ee)](_0x1915ef(0xe8c)+_0x3c23a3[_0x1915ef(0x1f1d)][_0x1915ef(0xcbf)]+'个');if(_0x3c23a3[_0x1915ef(0xb51)]?.[_0x1915ef(0xcbf)])_0x5f1b00['push']('联系人:\x20'+_0x3c23a3[_0x1915ef(0xb51)][_0x1915ef(0xcbf)]+'个');if(_0x3c23a3['customEmojis']?.[_0x1915ef(0xcbf)])_0x5f1b00[_0x1915ef(0x6ee)](_0x1915ef(0x22f9)+_0x3c23a3['customEmojis'][_0x1915ef(0xcbf)]+'个');if(_0x3c23a3[_0x1915ef(0xa1f)]?.[_0x1915ef(0xcbf)])_0x5f1b00[_0x1915ef(0x6ee)](_0x1915ef(0x136b)+_0x3c23a3[_0x1915ef(0xa1f)]['length']+'个');if(_0x3c23a3[_0x1915ef(0x195c)]?.['length'])_0x5f1b00['push']('世界书:\x20'+_0x3c23a3[_0x1915ef(0x195c)]['length']+'个');if(_0x3c23a3[_0x1915ef(0x4b0)]?.[_0x1915ef(0xcbf)])_0x5f1b00[_0x1915ef(0x6ee)](_0x1915ef(0x1425)+_0x3c23a3[_0x1915ef(0x4b0)]['length']+'条');if(_0x3c23a3[_0x1915ef(0x14ee)]?.[_0x1915ef(0xcbf)]){_0x5f1b00[_0x1915ef(0x6ee)](_0x1915ef(0x1e60)+_0x3c23a3[_0x1915ef(0x14ee)][_0x1915ef(0xcbf)]+'个');let _0x5f327e=0x0;if(_0x3c23a3[_0x1915ef(0x464)]?.['length']&&_0x3c23a3[_0x1915ef(0x14ee)]?.[_0x1915ef(0xcbf)]){const _0x5ddbc5=_0x3c23a3[_0x1915ef(0x14ee)][_0x1915ef(0xf6d)](_0x214b78=>_0x214b78['id']);_0x5f327e=_0x3c23a3[_0x1915ef(0x464)][_0x1915ef(0x803)](_0x4bdb5f=>_0x5ddbc5[_0x1915ef(0x23ec)](_0x4bdb5f[_0x1915ef(0x10df)]))[_0x1915ef(0xcbf)];}_0x5f327e>0x0&&_0x5f1b00[_0x1915ef(0x6ee)](_0x1915ef(0x1e3d)+_0x5f327e+'条');let _0xf61e19=0x0;_0x3c23a3[_0x1915ef(0x14ee)]?.[_0x1915ef(0xcbf)]&&_0x3c23a3['groupChats'][_0x1915ef(0x900)](_0x289898=>{const _0x59aea3=_0x1915ef;_0x289898['members']&&Array[_0x59aea3(0x1bcc)](_0x289898[_0x59aea3(0xcaa)])&&(_0xf61e19+=_0x289898[_0x59aea3(0xcaa)][_0x59aea3(0xcbf)]);}),_0xf61e19>0x0&&_0x5f1b00[_0x1915ef(0x6ee)](_0x1915ef(0x1bf1)+_0xf61e19+'个');}if(_0x3c23a3[_0x1915ef(0x1a72)]?.[_0x1915ef(0xcbf)])_0x5f1b00[_0x1915ef(0x6ee)]('动态:\x20'+_0x3c23a3[_0x1915ef(0x1a72)][_0x1915ef(0xcbf)]+'条');if(_0x3c23a3['momentComments']?.[_0x1915ef(0xcbf)])_0x5f1b00[_0x1915ef(0x6ee)]('动态评论:\x20'+_0x3c23a3[_0x1915ef(0x1733)][_0x1915ef(0xcbf)]+'条');if(_0x3c23a3[_0x1915ef(0x9b5)]?.[_0x1915ef(0xcbf)])_0x5f1b00['push'](_0x1915ef(0x24c0)+_0x3c23a3[_0x1915ef(0x9b5)][_0x1915ef(0xcbf)]+'条');if(_0x3c23a3['episodicMemory']?.[_0x1915ef(0xcbf)])_0x5f1b00[_0x1915ef(0x6ee)]('情节记忆:\x20'+_0x3c23a3[_0x1915ef(0x2196)][_0x1915ef(0xcbf)]+'条');if(_0x3c23a3[_0x1915ef(0x222e)]?.[_0x1915ef(0xcbf)])_0x5f1b00[_0x1915ef(0x6ee)](_0x1915ef(0xeac)+_0x3c23a3[_0x1915ef(0x222e)]['length']+'条');if(_0x3c23a3[_0x1915ef(0x1982)]?.[_0x1915ef(0xcbf)])_0x5f1b00[_0x1915ef(0x6ee)](_0x1915ef(0x18f)+_0x3c23a3[_0x1915ef(0x1982)][_0x1915ef(0xcbf)]+'条');if(_0x3c23a3[_0x1915ef(0x4ad)]?.['length'])_0x5f1b00['push'](_0x1915ef(0x17ab)+_0x3c23a3[_0x1915ef(0x4ad)][_0x1915ef(0xcbf)]+'条');if(_0x3c23a3[_0x1915ef(0x1e42)]?.[_0x1915ef(0xcbf)])_0x5f1b00[_0x1915ef(0x6ee)]('核心记忆:\x20'+_0x3c23a3[_0x1915ef(0x1e42)][_0x1915ef(0xcbf)]+'条');if(_0x3c23a3[_0x1915ef(0xa1b)]?.['length'])_0x5f1b00['push'](_0x1915ef(0x21c)+_0x3c23a3['coreMemories'][_0x1915ef(0xcbf)]+'条');if(_0x3c23a3[_0x1915ef(0x75b)]?.[_0x1915ef(0xcbf)])_0x5f1b00[_0x1915ef(0x6ee)]('时间线:\x20'+_0x3c23a3['crossAppTimeline'][_0x1915ef(0xcbf)]+'条');if(_0x3c23a3[_0x1915ef(0x1c45)]?.['length'])_0x5f1b00[_0x1915ef(0x6ee)](_0x1915ef(0x9f7)+_0x3c23a3[_0x1915ef(0x1c45)][_0x1915ef(0xcbf)]+'条');if(_0x3c23a3[_0x1915ef(0x189f)]?.['length'])_0x5f1b00[_0x1915ef(0x6ee)](_0x1915ef(0x1ce7)+_0x3c23a3[_0x1915ef(0x189f)][_0x1915ef(0xcbf)]+'个');if(_0x3c23a3[_0x1915ef(0xa52)]?.['length'])_0x5f1b00[_0x1915ef(0x6ee)](_0x1915ef(0x79f)+_0x3c23a3[_0x1915ef(0xa52)]['length']+'条');if(_0x3c23a3[_0x1915ef(0x5a2)]?.[_0x1915ef(0xcbf)])_0x5f1b00[_0x1915ef(0x6ee)]('角色状态:\x20'+_0x3c23a3[_0x1915ef(0x5a2)]['length']+'条');if(_0x3c23a3['characterDiaries']?.['length'])_0x5f1b00['push'](_0x1915ef(0x14d5)+_0x3c23a3[_0x1915ef(0x8e3)]['length']+'条');if(_0x3c23a3[_0x1915ef(0x1143)]?.['length'])_0x5f1b00[_0x1915ef(0x6ee)](_0x1915ef(0x1ad)+_0x3c23a3['offlineHistoryRecords'][_0x1915ef(0xcbf)]+'条');if(_0x3c23a3[_0x1915ef(0xa0c)]?.[_0x1915ef(0xcbf)])_0x5f1b00[_0x1915ef(0x6ee)](_0x1915ef(0x1a5)+_0x3c23a3[_0x1915ef(0xa0c)]['length']+'个');if(_0x3c23a3[_0x1915ef(0x13ac)]?.[_0x1915ef(0xcbf)])_0x5f1b00[_0x1915ef(0x6ee)]('音乐:\x20'+_0x3c23a3[_0x1915ef(0x13ac)]['length']+'首');if(_0x3c23a3['chatSettings']?.[_0x1915ef(0xcbf)])_0x5f1b00[_0x1915ef(0x6ee)]('聊天设置:\x20'+_0x3c23a3[_0x1915ef(0xb08)]['length']+'个');if(_0x3c23a3[_0x1915ef(0x229d)]?.[_0x1915ef(0xcbf)])_0x5f1b00[_0x1915ef(0x6ee)](_0x1915ef(0x12a7)+_0x3c23a3[_0x1915ef(0x229d)][_0x1915ef(0xcbf)]+'个');if(_0x3c23a3['anniversaries']?.[_0x1915ef(0xcbf)])_0x5f1b00['push'](_0x1915ef(0xc24)+_0x3c23a3[_0x1915ef(0x2c5)][_0x1915ef(0xcbf)]+'个');if(_0x3c23a3[_0x1915ef(0xda3)]?.[_0x1915ef(0xcbf)])_0x5f1b00['push']('日记设置:\x20'+_0x3c23a3[_0x1915ef(0xda3)][_0x1915ef(0xcbf)]+'个');if(_0x3c23a3[_0x1915ef(0xfc7)]?.[_0x1915ef(0xcbf)])_0x5f1b00['push'](_0x1915ef(0x7d9)+_0x3c23a3[_0x1915ef(0xfc7)]['length']+'条');if(_0x3c23a3[_0x1915ef(0x1a13)]?.[_0x1915ef(0xcbf)])_0x5f1b00[_0x1915ef(0x6ee)](_0x1915ef(0x706)+_0x3c23a3[_0x1915ef(0x1a13)][_0x1915ef(0xcbf)]+'个');if(_0x3c23a3[_0x1915ef(0x1f71)]?.['length'])_0x5f1b00[_0x1915ef(0x6ee)](_0x1915ef(0x1664)+_0x3c23a3['forumPosts'][_0x1915ef(0xcbf)]+'条');if(_0x3c23a3[_0x1915ef(0x1d3c)]?.[_0x1915ef(0xcbf)])_0x5f1b00[_0x1915ef(0x6ee)](_0x1915ef(0xf7b)+_0x3c23a3[_0x1915ef(0x1d3c)][_0x1915ef(0xcbf)]+'条');if(_0x3c23a3['forumFavorites']?.[_0x1915ef(0xcbf)])_0x5f1b00[_0x1915ef(0x6ee)]('论坛收藏:\x20'+_0x3c23a3[_0x1915ef(0x1dd3)][_0x1915ef(0xcbf)]+'条');if(_0x3c23a3['replyLikes']?.[_0x1915ef(0xcbf)])_0x5f1b00['push'](_0x1915ef(0x1de2)+_0x3c23a3[_0x1915ef(0x11ba)][_0x1915ef(0xcbf)]+'条');if(_0x3c23a3[_0x1915ef(0x3b2)]?.[_0x1915ef(0xcbf)])_0x5f1b00[_0x1915ef(0x6ee)](_0x1915ef(0x755)+_0x3c23a3[_0x1915ef(0x3b2)][_0x1915ef(0xcbf)]+'张');if(_0x3c23a3['forumMountedWorldbooks']?.[_0x1915ef(0xcbf)])_0x5f1b00['push']('论坛世界书:\x20'+_0x3c23a3[_0x1915ef(0x657)][_0x1915ef(0xcbf)]+'个');console[_0x1915ef(0xc0d)]('导出数据统计:',_0x5f1b00[_0x1915ef(0x140c)](',\x20'));try{showToast(_0x1915ef(0x4ab),'info');let _0xf436b4=0x0,_0x2c16bb=![];const _0x21efaa=_0x3c23a3[_0x1915ef(0x464)]?.[_0x1915ef(0xcbf)]||0x0,_0x9ee63f=_0x3c23a3['groupChatMessages']?.['length']||0x0,_0x200090=_0x21efaa+_0x9ee63f;_0xf436b4=_0x200090*0xc8,Object['keys'](_0x3c23a3)[_0x1915ef(0x900)](_0x3bdacd=>{const _0x20e1be=_0x1915ef;_0x3bdacd!==_0x20e1be(0x464)&&_0x3bdacd!=='groupChatMessages'&&_0x3c23a3[_0x3bdacd]?.[_0x20e1be(0xcbf)]&&(_0xf436b4+=_0x3c23a3[_0x3bdacd][_0x20e1be(0xcbf)]*0x64);}),_0x2c16bb=_0xf436b4>0xa*0x400*0x400,console[_0x1915ef(0xc0d)]('📊\x20估算数据大小:\x20'+(_0xf436b4/0x400/0x400)[_0x1915ef(0x3cd)](0x2)+_0x1915ef(0x10bb));let _0x3b3476;_0x2c16bb?(showToast(_0x1915ef(0x2465),'info'),_0x3b3476=JSON[_0x1915ef(0x7fb)](_0x3c23a3)):_0x3b3476=JSON[_0x1915ef(0x7fb)](_0x3c23a3,null,0x2);showToast(_0x1915ef(0x180b),'info');const _0x15dc01=0x400*0x400,_0x9e3986=[];for(let _0x484610=0x0;_0x484610<_0x3b3476[_0x1915ef(0xcbf)];_0x484610+=_0x15dc01){_0x9e3986['push'](_0x3b3476[_0x1915ef(0x136)](_0x484610,_0x484610+_0x15dc01)),_0x9e3986[_0x1915ef(0xcbf)]%0xa===0x0&&await new Promise(_0x4fd32c=>setTimeout(_0x4fd32c,0xa));}const _0x5273e7=new Blob(_0x9e3986,{'type':'application/json'}),_0x21db14=URL[_0x1915ef(0x17c3)](_0x5273e7),_0x9ad292=document['createElement']('a');_0x9ad292['href']=_0x21db14,_0x9ad292['download']=_0x1915ef(0xa78)+new Date()['toISOString']()[_0x1915ef(0x633)]('T')[0x0]+'.json',document[_0x1915ef(0x172c)][_0x1915ef(0x1925)](_0x9ad292),_0x9ad292[_0x1915ef(0x1e62)](),document[_0x1915ef(0x172c)]['removeChild'](_0x9ad292),URL[_0x1915ef(0x2101)](_0x21db14);}catch(_0x22f134){console[_0x1915ef(0x24ab)](_0x1915ef(0x1df3),_0x22f134);throw new Error(_0x1915ef(0x1a2d)+_0x22f134[_0x1915ef(0xd7a)]);}const _0x17c399=_0x5f1b00[_0x1915ef(0xcbf)]>0x0?'\x0a'+_0x5f1b00['join']('\x0a'):'';showToast('导出成功！'+_0x17c399,_0x1915ef(0xb27));}catch(_0x5d3312){console[_0x1915ef(0x24ab)](_0x1915ef(0x21bc),_0x5d3312);const _0x5d638e=confirm('完整导出失败:\x20'+_0x5d3312[_0x1915ef(0xd7a)]+'\x0a\x0a'+_0x1915ef(0x6a8)+'是否尝试轻量级导出？\x0a'+_0x1915ef(0x207b));if(_0x5d638e)try{await exportLightweightData();}catch(_0x5e7bc0){console[_0x1915ef(0x24ab)](_0x1915ef(0x1266),_0x5e7bc0),showToast(_0x1915ef(0xb6f),_0x1915ef(0x24ab));}else showToast('导出已取消',_0x1915ef(0x13bb));}}async function cleanChatMessagesForExport(){const _0x2708c9=_0x2cf6d4;try{const _0x8e3a0b=await db[_0x2708c9(0x464)]['toArray']();return _0x8e3a0b['map'](_0x49363a=>{const _0x40923a=_0x2708c9;if(_0x49363a[_0x40923a(0x1110)]){const _0x1103b4={..._0x49363a},_0x22e3a3={..._0x49363a['messageData']};return _0x22e3a3[_0x40923a(0xd59)]&&_0x22e3a3['imageUrl'][_0x40923a(0x1cab)](_0x40923a(0xc14))&&(_0x22e3a3['imageUrl']='[图片数据已移除以减少导出大小]'),_0x22e3a3[_0x40923a(0xd0e)]&&(_0x22e3a3[_0x40923a(0xd0e)]=_0x22e3a3[_0x40923a(0xd0e)][_0x40923a(0xf6d)](_0x4c583f=>({..._0x4c583f,'data':_0x4c583f['data']&&_0x4c583f[_0x40923a(0x4f2)][_0x40923a(0x1cab)](_0x40923a(0x1784))?_0x40923a(0xab4):_0x4c583f[_0x40923a(0x4f2)]}))),Array[_0x40923a(0x1bcc)](_0x22e3a3[_0x40923a(0x1423)])&&(_0x22e3a3[_0x40923a(0x1423)]=_0x22e3a3[_0x40923a(0x1423)][_0x40923a(0xf6d)](_0x5e18af=>{const _0x4dd73a=_0x40923a;if(_0x5e18af[_0x4dd73a(0x23df)]==='image_url'&&_0x5e18af[_0x4dd73a(0x1cfa)]&&_0x5e18af[_0x4dd73a(0x1cfa)][_0x4dd73a(0x10c6)]&&_0x5e18af[_0x4dd73a(0x1cfa)][_0x4dd73a(0x10c6)]['startsWith'](_0x4dd73a(0x1784)))return{..._0x5e18af,'image_url':{'url':_0x4dd73a(0x125a)}};return _0x5e18af;})),_0x1103b4[_0x40923a(0x1110)]=_0x22e3a3,_0x1103b4;}return _0x49363a;});}catch(_0x196d90){return console[_0x2708c9(0x24ab)](_0x2708c9(0xf31),_0x196d90),await db[_0x2708c9(0x464)][_0x2708c9(0x18c6)]();}}async function exportLightweightData(){const _0x3c4b23=_0x2cf6d4;try{showToast(_0x3c4b23(0x130f),_0x3c4b23(0x2422));const _0x4f263f={'version':_0x3c4b23(0xe04),'exportTime':new Date()['toISOString'](),'exportType':_0x3c4b23(0x52e),'characters':await db[_0x3c4b23(0x164d)][_0x3c4b23(0x18c6)](),'chatMessages':await cleanChatMessagesForExport(),'chatSettings':await db[_0x3c4b23(0xb08)]['toArray'](),'personas':await db['personas']['toArray'](),'contacts':await db[_0x3c4b23(0xb51)][_0x3c4b23(0x18c6)](),'groupChats':await db['groupChats'][_0x3c4b23(0x18c6)](),'groupChatMessages':await db[_0x3c4b23(0xb76)][_0x3c4b23(0x18c6)](),'groupChatMembers':await db['groupChatMembers'][_0x3c4b23(0x18c6)](),'smsContacts':await db['smsContacts'][_0x3c4b23(0x18c6)](),'smsMessages':await db[_0x3c4b23(0xd94)][_0x3c4b23(0x18c6)](),'worldbooks':await db['worldbooks'][_0x3c4b23(0x18c6)](),'worldbookEntries':await db[_0x3c4b23(0x4b0)][_0x3c4b23(0x18c6)](),'workingMemory':await db['workingMemory']['toArray'](),'episodicMemory':await db[_0x3c4b23(0x2196)][_0x3c4b23(0x18c6)](),'episodicMemories':await db[_0x3c4b23(0x222e)][_0x3c4b23(0x18c6)](),'memorySummaries':await db['memorySummaries']['toArray'](),'memoryEvents':await db[_0x3c4b23(0x4ad)][_0x3c4b23(0x18c6)](),'coreMemory':await db[_0x3c4b23(0x1e42)][_0x3c4b23(0x18c6)](),'coreMemories':await db[_0x3c4b23(0xa1b)][_0x3c4b23(0x18c6)](),'crossAppTimeline':await db[_0x3c4b23(0x75b)][_0x3c4b23(0x18c6)](),'forums':await db[_0x3c4b23(0x1a13)][_0x3c4b23(0x18c6)](),'forumPosts':await db[_0x3c4b23(0x1f71)][_0x3c4b23(0x18c6)](),'forumReplies':await db[_0x3c4b23(0x1d3c)][_0x3c4b23(0x18c6)](),'forumFavorites':await db['forumFavorites'][_0x3c4b23(0x18c6)](),'characterGroups':await db['characterGroups']['toArray'](),'characterDiaries':await db['characterDiaries'][_0x3c4b23(0x18c6)](),'innerThoughts':await db['innerThoughts'][_0x3c4b23(0x18c6)](),'apiSettings':await db['apiSettings']['toArray'](),'globalSettings':await db[_0x3c4b23(0x2217)]['toArray'](),'anniversaries':await db[_0x3c4b23(0x2c5)]['toArray'](),'diarySettings':await db[_0x3c4b23(0xda3)][_0x3c4b23(0x18c6)]()},_0x3acf37=JSON[_0x3c4b23(0x7fb)](_0x4f263f,null,0x1),_0x3134b5=new Blob([_0x3acf37],{'type':_0x3c4b23(0x302)}),_0x4d1d4e=URL[_0x3c4b23(0x17c3)](_0x3134b5),_0x1c64fc=document[_0x3c4b23(0x1ad8)]('a');_0x1c64fc[_0x3c4b23(0xe1d)]=_0x4d1d4e,_0x1c64fc[_0x3c4b23(0x154c)]=_0x3c4b23(0x1c3a)+new Date()[_0x3c4b23(0xa4b)]()[_0x3c4b23(0x633)]('T')[0x0]+_0x3c4b23(0x539),document[_0x3c4b23(0x172c)][_0x3c4b23(0x1925)](_0x1c64fc),_0x1c64fc[_0x3c4b23(0x1e62)](),document['body'][_0x3c4b23(0x1624)](_0x1c64fc),URL['revokeObjectURL'](_0x4d1d4e);const _0x2a0679=[];if(_0x4f263f['characters']?.[_0x3c4b23(0xcbf)])_0x2a0679[_0x3c4b23(0x6ee)]('角色:\x20'+_0x4f263f['characters'][_0x3c4b23(0xcbf)]+'个');if(_0x4f263f['chatMessages']?.[_0x3c4b23(0xcbf)])_0x2a0679['push'](_0x3c4b23(0x18d4)+_0x4f263f[_0x3c4b23(0x464)][_0x3c4b23(0xcbf)]+'条');if(_0x4f263f[_0x3c4b23(0x9b5)]?.['length']||_0x4f263f[_0x3c4b23(0x2196)]?.[_0x3c4b23(0xcbf)]||_0x4f263f[_0x3c4b23(0x1e42)]?.[_0x3c4b23(0xcbf)]){const _0x2740b5=(_0x4f263f[_0x3c4b23(0x9b5)]?.[_0x3c4b23(0xcbf)]||0x0)+(_0x4f263f[_0x3c4b23(0x2196)]?.['length']||0x0)+(_0x4f263f[_0x3c4b23(0x1e42)]?.[_0x3c4b23(0xcbf)]||0x0)+(_0x4f263f['episodicMemories']?.['length']||0x0)+(_0x4f263f[_0x3c4b23(0xa1b)]?.['length']||0x0);_0x2a0679[_0x3c4b23(0x6ee)]('记忆:\x20'+_0x2740b5+'条');}if(_0x4f263f[_0x3c4b23(0x195c)]?.[_0x3c4b23(0xcbf)])_0x2a0679[_0x3c4b23(0x6ee)]('世界书:\x20'+_0x4f263f[_0x3c4b23(0x195c)][_0x3c4b23(0xcbf)]+'个');if(_0x4f263f['forums']?.['length'])_0x2a0679['push'](_0x3c4b23(0x706)+_0x4f263f['forums'][_0x3c4b23(0xcbf)]+'个');const _0x160d84=(_0x3acf37[_0x3c4b23(0xcbf)]/(0x400*0x400))[_0x3c4b23(0x3cd)](0x1),_0x205656=_0x2a0679[_0x3c4b23(0xcbf)]>0x0?'\x0a'+_0x2a0679[_0x3c4b23(0x140c)](',\x20')+_0x3c4b23(0x118)+_0x160d84+'MB':_0x3c4b23(0x118)+_0x160d84+'MB';showToast(_0x3c4b23(0x2d6)+_0x205656,'success');}catch(_0x2f637c){console['error']('❌\x20轻量级导出失败:',_0x2f637c);throw _0x2f637c;}}function showCleanupOptions(){const _0x2704e8=_0x2cf6d4;let _0x282c33=0x0,_0x115ea9=0x0;Object[_0x2704e8(0x16c7)](localStorage)[_0x2704e8(0x900)](_0x25f1a4=>{const _0xdb4cfd=_0x2704e8,_0x31ada6=(localStorage[_0xdb4cfd(0x2250)](_0x25f1a4)||'')[_0xdb4cfd(0xcbf)];if(_0x25f1a4[_0xdb4cfd(0x1cab)](_0xdb4cfd(0x2111))&&_0x25f1a4[_0xdb4cfd(0x23ec)](_0xdb4cfd(0x853)))_0x282c33+=_0x31ada6;else _0x25f1a4==='diary-custom-background'&&(_0x115ea9+=_0x31ada6);});const _0x280b1e=_0x500b9a=>{const _0x29ae10=_0x2704e8;if(_0x500b9a<0x400)return _0x500b9a+'B';if(_0x500b9a<0x400*0x400)return(_0x500b9a/0x400)[_0x29ae10(0x3cd)](0x1)+'KB';return(_0x500b9a/(0x400*0x400))[_0x29ae10(0x3cd)](0x1)+'MB';},_0x10b887=['1.\x20删除空聊天记录',_0x2704e8(0x6f6),'3.\x20清理线下模式备份\x20('+_0x280b1e(_0x282c33)+_0x2704e8(0x2417),_0x2704e8(0xf3b)+_0x280b1e(_0x115ea9)+')'],_0x134ee1=prompt('选择清理项目：\x0a'+_0x10b887[_0x2704e8(0x140c)]('\x0a')+_0x2704e8(0x103f));if(_0x134ee1)executeCleanupOptions(_0x134ee1);}async function executeCleanupOptions(_0x1a2e5c){const _0x2d3c8e=_0x2cf6d4,_0x51794b=_0x1a2e5c[_0x2d3c8e(0x633)](',')[_0x2d3c8e(0xf6d)](_0x3a7807=>parseInt(_0x3a7807[_0x2d3c8e(0x1424)]()))[_0x2d3c8e(0x803)](_0x7a4758=>_0x7a4758>=0x1&&_0x7a4758<=0x4);if(!_0x51794b[_0x2d3c8e(0xcbf)])return;showToast(_0x2d3c8e(0x1349),_0x2d3c8e(0x2422));let _0x37e700=0x0,_0x16b553=0x0;for(const _0x717d2b of _0x51794b){switch(_0x717d2b){case 0x1:Object[_0x2d3c8e(0x16c7)](chatMessages)[_0x2d3c8e(0x900)](_0x7793b5=>{const _0x1ad518=_0x2d3c8e;!chatMessages[_0x7793b5]?.[_0x1ad518(0xcbf)]&&(delete chatMessages[_0x7793b5],_0x37e700++);});break;case 0x2:const _0x7987ac=await compressAllImagesEnhanced();_0x37e700+=_0x7987ac['count'],_0x16b553+=_0x7987ac[_0x2d3c8e(0x48d)];break;case 0x3:for(let _0x553ed2=localStorage[_0x2d3c8e(0xcbf)]-0x1;_0x553ed2>=0x0;_0x553ed2--){const _0x29da47=localStorage[_0x2d3c8e(0x157f)](_0x553ed2);_0x29da47?.['startsWith'](_0x2d3c8e(0x2111))&&_0x29da47[_0x2d3c8e(0x23ec)](_0x2d3c8e(0x853))&&(_0x16b553+=(localStorage['getItem'](_0x29da47)||'')[_0x2d3c8e(0xcbf)],localStorage[_0x2d3c8e(0x1c95)](_0x29da47),_0x37e700++);}break;case 0x4:const _0x216e16=_0x2d3c8e(0x1135);if(localStorage[_0x2d3c8e(0x2250)](_0x216e16)){_0x16b553+=(localStorage[_0x2d3c8e(0x2250)](_0x216e16)||'')[_0x2d3c8e(0xcbf)],localStorage[_0x2d3c8e(0x1c95)](_0x216e16),_0x37e700++;for(let _0x5b14e5=localStorage['length']-0x1;_0x5b14e5>=0x0;_0x5b14e5--){const _0xc2f3e8=localStorage[_0x2d3c8e(0x157f)](_0x5b14e5);_0xc2f3e8?.[_0x2d3c8e(0x23ec)](_0x2d3c8e(0x160b))&&(_0x16b553+=(localStorage['getItem'](_0xc2f3e8)||'')['length'],localStorage[_0x2d3c8e(0x1c95)](_0xc2f3e8),_0x37e700++);}}break;}}await saveChatSettings();try{const _0x5aec90=Object[_0x2d3c8e(0x16c7)](chatMessages)[_0x2d3c8e(0x803)](_0x5e75d3=>chatMessages[_0x5e75d3]&&chatMessages[_0x5e75d3][_0x2d3c8e(0xcbf)]>0x0);await saveChatMessagesImmediate(_0x5aec90),console['log'](_0x2d3c8e(0x1353));}catch(_0x54ea0c){console[_0x2d3c8e(0x24ab)]('存储清理保存失败，回退到全量保存:',_0x54ea0c),await saveChatMessages();}calculateStorageUsage();const _0x2e20f8=_0x415bea=>{const _0x527bb7=_0x2d3c8e;if(_0x415bea<0x400)return _0x415bea+'B';if(_0x415bea<0x400*0x400)return(_0x415bea/0x400)[_0x527bb7(0x3cd)](0x1)+'KB';return(_0x415bea/(0x400*0x400))[_0x527bb7(0x3cd)](0x1)+'MB';};showToast(_0x2d3c8e(0xf47)+_0x37e700+'\x20项，释放\x20'+_0x2e20f8(_0x16b553)+'\x20空间',_0x2d3c8e(0xb27));}async function compressAllImages(){const _0x2d10b5=_0x2cf6d4,_0x252a0b=_0x2e7d36=>{const _0x5ae542=_0x3a81;if(_0x2e7d36<0x400)return _0x2e7d36+'B';if(_0x2e7d36<0x400*0x400)return(_0x2e7d36/0x400)[_0x5ae542(0x3cd)](0x1)+'KB';return(_0x2e7d36/(0x400*0x400))['toFixed'](0x1)+'MB';},_0x4a7ecd=await compressAllImagesEnhanced();showToast('压缩完成！处理\x20'+_0x4a7ecd[_0x2d10b5(0x35e)]+_0x2d10b5(0x2407)+_0x252a0b(_0x4a7ecd[_0x2d10b5(0x48d)])+_0x2d10b5(0x1623),_0x2d10b5(0xb27));}async function compressAllImagesEnhanced(){const _0x2937a2=_0x2cf6d4;let _0x44b55c=0x0,_0xf6207=0x0;const _0x498978=_0x3c9af=>{const _0x5111a0=_0x3a81;if(_0x3c9af<0x400)return _0x3c9af+'B';if(_0x3c9af<0x400*0x400)return(_0x3c9af/0x400)[_0x5111a0(0x3cd)](0x1)+'KB';return(_0x3c9af/(0x400*0x400))[_0x5111a0(0x3cd)](0x1)+'MB';};try{for(const _0x100b57 of characters){if(_0x100b57['avatarUrl']?.[_0x2937a2(0xcbf)]>0x7530){const _0x2ffe42=_0x100b57[_0x2937a2(0x10f9)][_0x2937a2(0xcbf)];_0x100b57[_0x2937a2(0x10f9)]=await compressImage(_0x100b57['avatarUrl'],0x78,0.7),_0xf6207+=_0x2ffe42-_0x100b57[_0x2937a2(0x10f9)]['length'],_0x44b55c++;}}await saveCharacters();for(const _0x916125 of Object[_0x2937a2(0x16c7)](chatSettings)){const _0x237aa0=chatSettings[_0x916125];if(_0x237aa0?.[_0x2937a2(0x23e0)]?.[_0x2937a2(0xcbf)]>0x7530){const _0x4db5c0=_0x237aa0[_0x2937a2(0x23e0)][_0x2937a2(0xcbf)];_0x237aa0['aiChatAvatar']=await compressImage(_0x237aa0['aiChatAvatar'],0x78,0.7),_0xf6207+=_0x4db5c0-_0x237aa0['aiChatAvatar'][_0x2937a2(0xcbf)],_0x44b55c++;}if(_0x237aa0?.['myChatAvatar']?.[_0x2937a2(0xcbf)]>0x7530){const _0x35bcba=_0x237aa0[_0x2937a2(0x13af)]['length'];_0x237aa0[_0x2937a2(0x13af)]=await compressImage(_0x237aa0[_0x2937a2(0x13af)],0x78,0.7),_0xf6207+=_0x35bcba-_0x237aa0[_0x2937a2(0x13af)][_0x2937a2(0xcbf)],_0x44b55c++;}}await saveChatSettings();for(let _0x4d6094=localStorage[_0x2937a2(0xcbf)]-0x1;_0x4d6094>=0x0;_0x4d6094--){const _0xae80cd=localStorage['key'](_0x4d6094);if(_0xae80cd?.[_0x2937a2(0x23ec)]('-custom-background')||_0xae80cd===_0x2937a2(0x1135)){const _0x1c0454=localStorage['getItem'](_0xae80cd);if(_0x1c0454&&_0x1c0454[_0x2937a2(0xcbf)]>0xc350){const _0x5d976=_0x1c0454[_0x2937a2(0xcbf)],_0x4c2d1a=await compressImage(_0x1c0454,0x320,0.8);localStorage[_0x2937a2(0x2055)](_0xae80cd,_0x4c2d1a),_0xf6207+=_0x5d976-_0x4c2d1a[_0x2937a2(0xcbf)],_0x44b55c++;}}}for(const _0x598004 of Object[_0x2937a2(0x16c7)](chatMessages)){const _0x48d90=chatMessages[_0x598004]||[];let _0x55baff=![];for(const _0x1b427f of _0x48d90){if(_0x1b427f[_0x2937a2(0xe5b)]&&_0x1b427f[_0x2937a2(0xe5b)][_0x2937a2(0xcbf)]>0x7530){const _0x5ddd23=_0x1b427f['image'][_0x2937a2(0xcbf)];_0x1b427f[_0x2937a2(0xe5b)]=await compressImage(_0x1b427f[_0x2937a2(0xe5b)],0x190,0.8),_0xf6207+=_0x5ddd23-_0x1b427f[_0x2937a2(0xe5b)]['length'],_0x44b55c++,_0x55baff=!![];}if(Array['isArray'](_0x1b427f[_0x2937a2(0x1423)]))for(const _0x40a342 of _0x1b427f[_0x2937a2(0x1423)]){if(_0x40a342[_0x2937a2(0x23df)]===_0x2937a2(0x1cfa)&&_0x40a342[_0x2937a2(0x1cfa)]?.[_0x2937a2(0x10c6)]?.['length']>0x7530){const _0x1e8707=_0x40a342['image_url'][_0x2937a2(0x10c6)]['length'];_0x40a342[_0x2937a2(0x1cfa)][_0x2937a2(0x10c6)]=await compressImage(_0x40a342[_0x2937a2(0x1cfa)][_0x2937a2(0x10c6)],0x190,0.8),_0xf6207+=_0x1e8707-_0x40a342[_0x2937a2(0x1cfa)][_0x2937a2(0x10c6)][_0x2937a2(0xcbf)],_0x44b55c++,_0x55baff=!![];}}}_0x55baff&&await saveChatMessages(_0x598004);}for(let _0xe4a978=localStorage['length']-0x1;_0xe4a978>=0x0;_0xe4a978--){const _0x137adf=localStorage[_0x2937a2(0x157f)](_0xe4a978);if(_0x137adf?.[_0x2937a2(0x23ec)](_0x2937a2(0x1f41))||_0x137adf?.[_0x2937a2(0x23ec)]('sticker')){const _0x467090=localStorage['getItem'](_0x137adf);if(_0x467090&&_0x467090[_0x2937a2(0xcbf)]>0x4e20)try{const _0x31f9b1=_0x467090[_0x2937a2(0xcbf)],_0x24a7d7=await compressImage(_0x467090,0xc8,0.8);localStorage[_0x2937a2(0x2055)](_0x137adf,_0x24a7d7),_0xf6207+=_0x31f9b1-_0x24a7d7[_0x2937a2(0xcbf)],_0x44b55c++;}catch(_0x20b7e4){continue;}}}return calculateStorageUsage(),{'count':_0x44b55c,'savedSpace':_0xf6207};}catch(_0x28abad){return console[_0x2937a2(0x24ab)](_0x2937a2(0x15e4),_0x28abad),{'count':_0x44b55c,'savedSpace':_0xf6207};}}async function debugListAllCharacters(){const _0x4ae2bf=_0x2cf6d4;try{console['log'](_0x4ae2bf(0x1d5b));const _0x4e355e=await db[_0x4ae2bf(0x164d)][_0x4ae2bf(0x18c6)]();console[_0x4ae2bf(0xc0d)]('数据库角色表:',_0x4e355e[_0x4ae2bf(0xf6d)](_0x3727e0=>_0x3727e0[_0x4ae2bf(0x222f)]+_0x4ae2bf(0x192)+_0x3727e0['id']+')'));window[_0x4ae2bf(0x164d)]&&console[_0x4ae2bf(0xc0d)](_0x4ae2bf(0xaa),window['characters'][_0x4ae2bf(0xf6d)](_0x40ab46=>_0x40ab46[_0x4ae2bf(0x222f)]+_0x4ae2bf(0x192)+_0x40ab46['id']+')'));window[_0x4ae2bf(0xb51)]&&console[_0x4ae2bf(0xc0d)](_0x4ae2bf(0x1ed5),window['contacts']);const _0x377c17=await db['momentComments'][_0x4ae2bf(0x18c6)](),_0x192e1d=[...new Set(_0x377c17[_0x4ae2bf(0xf6d)](_0x418f25=>_0x418f25['nickname']+_0x4ae2bf(0x192)+_0x418f25['authorId']+')'))];console[_0x4ae2bf(0xc0d)](_0x4ae2bf(0x1877),_0x192e1d);const _0x506046=await db['momentLikes']['toArray'](),_0x16fb00=[...new Set(_0x506046[_0x4ae2bf(0xf6d)](_0x18f1a4=>_0x18f1a4[_0x4ae2bf(0x222f)]+_0x4ae2bf(0x192)+_0x18f1a4[_0x4ae2bf(0x3df)]+')'))];return console[_0x4ae2bf(0xc0d)](_0x4ae2bf(0x221d),_0x16fb00),{'dbChars':_0x4e355e,'comments':_0x377c17,'likes':_0x506046};}catch(_0x104fcd){console['error']('调试失败:',_0x104fcd);}}async function debugDeleteCharacterById(_0x5f4ba8){const _0x293f87=_0x2cf6d4;if(!_0x5f4ba8){console['log'](_0x293f87(0xf06));return;}try{console[_0x293f87(0xc0d)](_0x293f87(0x1a57)+_0x5f4ba8);let _0x4f30a2=0x0;const _0x38cdbf=await db['momentComments'][_0x293f87(0x4a6)](_0x293f87(0x3df))[_0x293f87(0x14a)](_0x5f4ba8)[_0x293f87(0x18c6)]();for(const _0x5c448b of _0x38cdbf){await db['momentComments'][_0x293f87(0xc2b)](_0x5c448b['id']),_0x4f30a2++,console[_0x293f87(0xc0d)](_0x293f87(0x351)+_0x5c448b[_0x293f87(0x201a)]+'\x20-\x20'+_0x5c448b[_0x293f87(0x1e58)]);}const _0x56bc13=await db[_0x293f87(0x101)][_0x293f87(0x4a6)](_0x293f87(0x3df))[_0x293f87(0x14a)](_0x5f4ba8)['toArray']();for(const _0x2ca3f2 of _0x56bc13){await db['momentLikes'][_0x293f87(0xc2b)]([_0x2ca3f2['momentId'],_0x2ca3f2['authorId']]),_0x4f30a2++,console[_0x293f87(0xc0d)]('删除点赞:\x20'+_0x2ca3f2['name']);}const _0x182827=await db['chatMessages']['where'](_0x293f87(0x10df))[_0x293f87(0x14a)](_0x5f4ba8)[_0x293f87(0x18c6)]();for(const _0x5c074d of _0x182827){await db['chatMessages'][_0x293f87(0xc2b)](_0x5c074d['id']),_0x4f30a2++;}const _0x4e889c=await db[_0x293f87(0xb08)][_0x293f87(0x18c6)]();for(const _0x596641 of _0x4e889c){_0x596641[_0x293f87(0x10df)]===_0x5f4ba8&&(await db['chatSettings'][_0x293f87(0xc2b)](_0x596641['id']),_0x4f30a2++);}await db[_0x293f87(0x164d)]['delete'](_0x5f4ba8),_0x4f30a2++;window[_0x293f87(0xb51)]&&(window['contacts']=window[_0x293f87(0xb51)]['filter'](_0x39dc5e=>_0x39dc5e!==_0x5f4ba8),await saveContacts());window[_0x293f87(0x164d)]&&(window['characters']=window[_0x293f87(0x164d)][_0x293f87(0x803)](_0x514690=>_0x514690['id']!==_0x5f4ba8));console['log'](_0x293f87(0x10f2)+_0x4f30a2+'\x20条相关数据');if(window['renderContactList'])window[_0x293f87(0x299)]();if(window['renderMessageList'])window[_0x293f87(0x1b3a)]();}catch(_0xbc6d39){console[_0x293f87(0x24ab)]('删除失败:',_0xbc6d39);}}async function forceDeleteCharacter(){const _0x593f95=_0x2cf6d4,_0x756254=prompt(_0x593f95(0xb4d));if(!_0x756254||!_0x756254[_0x593f95(0x1424)]())return;try{showToast(_0x593f95(0x1443)+_0x756254+_0x593f95(0x15b2),_0x593f95(0x2422));let _0x13c8ec=0x0;const _0x2f305a=await db[_0x593f95(0x1733)][_0x593f95(0x18c6)]();for(const _0x423e6a of _0x2f305a){(_0x423e6a[_0x593f95(0x201a)]===_0x756254||_0x423e6a[_0x593f95(0x3df)]&&_0x423e6a['authorId'][_0x593f95(0x23ec)](_0x756254))&&(await db['momentComments']['delete'](_0x423e6a['id']),_0x13c8ec++,console[_0x593f95(0xc0d)](_0x593f95(0x8b6)+_0x423e6a['nickname']+_0x593f95(0x2316)+_0x423e6a[_0x593f95(0x1e58)]));}const _0x576361=await db['momentLikes'][_0x593f95(0x18c6)]();for(const _0x27b3b4 of _0x576361){(_0x27b3b4[_0x593f95(0x222f)]===_0x756254||_0x27b3b4[_0x593f95(0x3df)]&&_0x27b3b4[_0x593f95(0x3df)]['includes'](_0x756254))&&(await db['momentLikes'][_0x593f95(0xc2b)]([_0x27b3b4[_0x593f95(0x2289)],_0x27b3b4['authorId']]),_0x13c8ec++,console[_0x593f95(0xc0d)](_0x593f95(0x1df8)+_0x27b3b4['name']));}const _0x2772d0=await db[_0x593f95(0x464)][_0x593f95(0x18c6)]();for(const _0x36b1bf of _0x2772d0){_0x36b1bf[_0x593f95(0x10df)]&&_0x36b1bf['characterId'][_0x593f95(0x23ec)](_0x756254)&&(await db[_0x593f95(0x464)][_0x593f95(0xc2b)](_0x36b1bf['id']),_0x13c8ec++);}const _0x1e36fe=await db[_0x593f95(0xb08)][_0x593f95(0x18c6)]();for(const _0x4ccdd of _0x1e36fe){_0x4ccdd[_0x593f95(0x10df)]&&_0x4ccdd[_0x593f95(0x10df)][_0x593f95(0x23ec)](_0x756254)&&(await db[_0x593f95(0xb08)][_0x593f95(0xc2b)](_0x4ccdd['id']),_0x13c8ec++);}const _0x502255=await db[_0x593f95(0x164d)][_0x593f95(0x18c6)]();for(const _0x2c7178 of _0x502255){(_0x2c7178[_0x593f95(0x222f)]===_0x756254||_0x2c7178['id'][_0x593f95(0x23ec)](_0x756254))&&(await db[_0x593f95(0x164d)][_0x593f95(0xc2b)](_0x2c7178['id']),_0x13c8ec++,console['log'](_0x593f95(0x1f6a)+_0x2c7178[_0x593f95(0x222f)]+'\x20('+_0x2c7178['id']+')'));}window[_0x593f95(0xb51)]&&(window[_0x593f95(0xb51)]=window[_0x593f95(0xb51)][_0x593f95(0x803)](_0xf9c83c=>!_0xf9c83c[_0x593f95(0x23ec)](_0x756254)),await saveContacts());window[_0x593f95(0x164d)]&&(window[_0x593f95(0x164d)]=window[_0x593f95(0x164d)][_0x593f95(0x803)](_0x64ce54=>_0x64ce54['name']!==_0x756254));window[_0x593f95(0x464)]&&Object[_0x593f95(0x16c7)](window[_0x593f95(0x464)])[_0x593f95(0x900)](_0x1b1cd0=>{_0x1b1cd0['includes'](_0x756254)&&delete window['chatMessages'][_0x1b1cd0];});window[_0x593f95(0xb08)]&&Object['keys'](window[_0x593f95(0xb08)])['forEach'](_0x57c6e1=>{const _0x35ad5e=_0x593f95;_0x57c6e1[_0x35ad5e(0x23ec)](_0x756254)&&delete window[_0x35ad5e(0xb08)][_0x57c6e1];});if(window[_0x593f95(0x299)])window[_0x593f95(0x299)]();if(window[_0x593f95(0x1b3a)])window['renderMessageList']();showToast(_0x593f95(0x236c)+_0x13c8ec+_0x593f95(0x1d7e),'success'),console[_0x593f95(0xc0d)](_0x593f95(0x12c5)+_0x756254+'\x22\x20完成，删除了\x20'+_0x13c8ec+'\x20条记录');}catch(_0x109c4c){console[_0x593f95(0x24ab)]('强制删除失败:',_0x109c4c),showToast('强制删除失败:\x20'+_0x109c4c[_0x593f95(0xd7a)],'error');}}async function cleanupOrphanedContacts(){const _0x3d7511=_0x2cf6d4;try{showToast(_0x3d7511(0x6c3),_0x3d7511(0x2422));let _0x122068=0x0;const _0x193bc3=characters[_0x3d7511(0xf6d)](_0x7ac7f0=>_0x7ac7f0['id']),_0x4cec54=contacts['length'];contacts=contacts[_0x3d7511(0x803)](_0x5ad563=>{const _0x545df0=_0x3d7511,_0x3d8f46=_0x193bc3[_0x545df0(0x23ec)](_0x5ad563);if(!_0x3d8f46)_0x122068++;return _0x3d8f46;});const _0x537ff8=await db[_0x3d7511(0xb51)][_0x3d7511(0x18c6)]();for(const _0x479475 of _0x537ff8){!_0x193bc3[_0x3d7511(0x23ec)](_0x479475['characterId'])&&(await db['contacts'][_0x3d7511(0xc2b)](_0x479475['id']),_0x122068++);}const _0x30a7ea=Object['keys'](chatMessages);for(const _0x2e3081 of _0x30a7ea){!_0x193bc3['includes'](_0x2e3081)&&(delete chatMessages[_0x2e3081],_0x122068++);}const _0x301ed2=await db[_0x3d7511(0x464)][_0x3d7511(0x18c6)]();for(const _0x38b4f2 of _0x301ed2){!_0x193bc3[_0x3d7511(0x23ec)](_0x38b4f2[_0x3d7511(0x10df)])&&(await db[_0x3d7511(0x464)]['delete'](_0x38b4f2['id']),_0x122068++);}const _0x5ddfb7=Object[_0x3d7511(0x16c7)](chatSettings);for(const _0x3d0e89 of _0x5ddfb7){!_0x193bc3[_0x3d7511(0x23ec)](_0x3d0e89)&&(delete chatSettings[_0x3d0e89],_0x122068++);}const _0x3c3478=await db['chatSettings'][_0x3d7511(0x18c6)]();for(const _0xa9e0a7 of _0x3c3478){!_0x193bc3['includes'](_0xa9e0a7['characterId'])&&(await db['chatSettings'][_0x3d7511(0xc2b)](_0xa9e0a7['id']),_0x122068++);}const _0x5f4da3=await db[_0x3d7511(0x1733)][_0x3d7511(0x18c6)]();for(const _0x41a16a of _0x5f4da3){_0x41a16a[_0x3d7511(0x3df)]!==_0x3d7511(0x23b2)&&!_0x193bc3[_0x3d7511(0x23ec)](_0x41a16a[_0x3d7511(0x3df)])&&(await db['momentComments']['delete'](_0x41a16a['id']),_0x122068++,console['log'](_0x3d7511(0x1019)+_0x41a16a['nickname']+'('+_0x41a16a[_0x3d7511(0x3df)]+')'));}const _0x2d7ba0=await db[_0x3d7511(0x101)][_0x3d7511(0x18c6)]();for(const _0x223d31 of _0x2d7ba0){_0x223d31[_0x3d7511(0x3df)]!==_0x3d7511(0x23b2)&&!_0x193bc3['includes'](_0x223d31[_0x3d7511(0x3df)])&&(await db[_0x3d7511(0x101)][_0x3d7511(0xc2b)]([_0x223d31[_0x3d7511(0x2289)],_0x223d31[_0x3d7511(0x3df)]]),_0x122068++,console[_0x3d7511(0xc0d)](_0x3d7511(0x2336)+_0x223d31[_0x3d7511(0x222f)]+'('+_0x223d31[_0x3d7511(0x3df)]+')'));}await Promise[_0x3d7511(0x2339)]([saveContacts(),saveChatMessages(),saveChatSettings()]),renderContactList(),renderMessageList(),showToast('清理完成！共清理了\x20'+_0x122068+_0x3d7511(0x1283),_0x3d7511(0xb27)),console[_0x3d7511(0xc0d)](_0x3d7511(0x1411),{'有效角色数':_0x193bc3['length'],'清理前联系人数':_0x4cec54,'清理后联系人数':contacts[_0x3d7511(0xcbf)],'总清理项目':_0x122068});}catch(_0x586a76){console[_0x3d7511(0x24ab)](_0x3d7511(0x40c),_0x586a76),showToast(_0x3d7511(0x1c06)+_0x586a76[_0x3d7511(0xd7a)],_0x3d7511(0x24ab));}}async function clearAllData(){const _0x4aae35=_0x2cf6d4,_0x42d781=prompt('警告：将删除所有数据且无法恢复！\x0a输入\x22清空所有数据\x22确认：');if(_0x42d781!==_0x4aae35(0xd53))return;try{showToast('清空中...','info'),await Promise['all']([db[_0x4aae35(0x164d)][_0x4aae35(0x2215)](),db[_0x4aae35(0xb51)][_0x4aae35(0x2215)](),db[_0x4aae35(0x464)]['clear'](),db['personas'][_0x4aae35(0x2215)](),db['customEmojis'][_0x4aae35(0x2215)](),db[_0x4aae35(0xa1f)]['clear'](),db[_0x4aae35(0x195c)][_0x4aae35(0x2215)](),db[_0x4aae35(0x4b0)][_0x4aae35(0x2215)](),db[_0x4aae35(0x15e0)][_0x4aae35(0x2215)](),db['groupChats'][_0x4aae35(0x2215)](),db['groupChatMessages']['clear'](),db[_0x4aae35(0xa83)][_0x4aae35(0x2215)](),db[_0x4aae35(0x1a72)][_0x4aae35(0x2215)](),db[_0x4aae35(0x101)]['clear'](),db['momentComments'][_0x4aae35(0x2215)](),db[_0x4aae35(0x18da)][_0x4aae35(0x2215)](),db['momentLocations'][_0x4aae35(0x2215)](),db['momentMentions'][_0x4aae35(0x2215)](),db[_0x4aae35(0x9b5)][_0x4aae35(0x2215)](),db[_0x4aae35(0x2196)]['clear'](),db[_0x4aae35(0x222e)][_0x4aae35(0x2215)](),db['memorySummaries'][_0x4aae35(0x2215)](),db['memoryEvents']['clear'](),db[_0x4aae35(0x1e42)][_0x4aae35(0x2215)](),db['coreMemories'][_0x4aae35(0x2215)](),db[_0x4aae35(0x75b)][_0x4aae35(0x2215)](),db['blacklist'][_0x4aae35(0x2215)](),db[_0x4aae35(0x189f)][_0x4aae35(0x2215)](),db[_0x4aae35(0xa52)][_0x4aae35(0x2215)](),db[_0x4aae35(0x5a2)]['clear'](),db[_0x4aae35(0x8e3)]['clear'](),db[_0x4aae35(0xda3)][_0x4aae35(0x2215)](),db['offlineHistoryRecords'][_0x4aae35(0x2215)](),db[_0x4aae35(0xe3d)][_0x4aae35(0x2215)](),db[_0x4aae35(0xa0c)][_0x4aae35(0x2215)](),db['musicPlaylist']['clear'](),db[_0x4aae35(0x1235)][_0x4aae35(0x2215)](),db['apiSettings']['clear'](),db[_0x4aae35(0x2217)][_0x4aae35(0x2215)](),db[_0x4aae35(0x229d)][_0x4aae35(0x2215)](),db[_0x4aae35(0x1f22)][_0x4aae35(0x2215)](),db[_0x4aae35(0xb08)][_0x4aae35(0x2215)](),db['innerThoughts'][_0x4aae35(0x2215)](),db[_0x4aae35(0x1a13)]['clear'](),db[_0x4aae35(0x1f71)][_0x4aae35(0x2215)](),db[_0x4aae35(0x1d3c)][_0x4aae35(0x2215)](),db['forumFavorites'][_0x4aae35(0x2215)](),db['replyLikes'][_0x4aae35(0x2215)](),db[_0x4aae35(0x3b2)][_0x4aae35(0x2215)](),db['forumMountedWorldbooks'][_0x4aae35(0x2215)](),db[_0x4aae35(0x111c)][_0x4aae35(0x2215)](),db['smsMessages'][_0x4aae35(0x2215)](),db['anniversaries']['clear'](),db[_0x4aae35(0x1ae2)][_0x4aae35(0x2215)](),db[_0x4aae35(0x9ae)][_0x4aae35(0x2215)](),db[_0x4aae35(0x7d7)]['clear'](),db[_0x4aae35(0x19c1)][_0x4aae35(0x2215)](),db[_0x4aae35(0x156f)]['clear'](),db[_0x4aae35(0x2071)][_0x4aae35(0x2215)](),db[_0x4aae35(0xb0a)][_0x4aae35(0x2215)](),db['globalThemes']['clear'](),db['chatThemes'][_0x4aae35(0x2215)](),db[_0x4aae35(0x397)][_0x4aae35(0x2215)](),db[_0x4aae35(0x243d)][_0x4aae35(0x2215)]()]),characters=[],chatMessages={},chatSettings={},customEmojis=[],contacts=[],groupChats=[],characterGroups=[],currentChatCharacter=null,currentGroupChat=null;if(typeof personas!==_0x4aae35(0x1785))personas=[];if(typeof worldbooks!=='undefined')worldbooks=[];if(typeof musicPlaylist!==_0x4aae35(0x1785))musicPlaylist=[];if(typeof smsMessages!==_0x4aae35(0x1785))smsMessages={};if(typeof anniversaries!==_0x4aae35(0x1785))anniversaries=[];if(typeof appointments!==_0x4aae35(0x1785))appointments=[];for(let _0x1fe5fe=localStorage[_0x4aae35(0xcbf)]-0x1;_0x1fe5fe>=0x0;_0x1fe5fe--){const _0x500cfe=localStorage['key'](_0x1fe5fe);_0x500cfe&&(_0x500cfe[_0x4aae35(0x1cab)](_0x4aae35(0xc63))||_0x500cfe['startsWith'](_0x4aae35(0xb51))||_0x500cfe['startsWith']('characters')||_0x500cfe[_0x4aae35(0x1cab)](_0x4aae35(0x464))||_0x500cfe[_0x4aae35(0x1cab)]('groupChats')||_0x500cfe[_0x4aae35(0x1cab)]('characterGroups')||_0x500cfe[_0x4aae35(0x1cab)](_0x4aae35(0x1f1d))||_0x500cfe[_0x4aae35(0x1cab)]('customEmojis')||_0x500cfe[_0x4aae35(0x1cab)]('worldbooks')||_0x500cfe[_0x4aae35(0x1cab)](_0x4aae35(0x1a72))||_0x500cfe[_0x4aae35(0x1cab)](_0x4aae35(0x13ac))||_0x500cfe[_0x4aae35(0x1cab)](_0x4aae35(0xd94))||_0x500cfe[_0x4aae35(0x1cab)](_0x4aae35(0x2c5))||_0x500cfe[_0x4aae35(0x1cab)](_0x4aae35(0x1ae2))||_0x500cfe['startsWith'](_0x4aae35(0x1a13))||_0x500cfe['startsWith'](_0x4aae35(0x143b))||_0x500cfe['startsWith'](_0x4aae35(0x2111))||_0x500cfe['startsWith']('offlinePresets')||_0x500cfe[_0x4aae35(0x1cab)]('footprints_')||_0x500cfe[_0x4aae35(0x1cab)]('emojiLibraries')||_0x500cfe['startsWith'](_0x4aae35(0x2071))||_0x500cfe['startsWith'](_0x4aae35(0x1cde))||_0x500cfe['startsWith'](_0x4aae35(0x16ee))||_0x500cfe[_0x4aae35(0x1cab)](_0x4aae35(0x219c))||_0x500cfe[_0x4aae35(0x1cab)](_0x4aae35(0xace)))&&localStorage[_0x4aae35(0x1c95)](_0x500cfe);}renderCharacterList(),renderMessageList(),renderContactList(),calculateStorageUsage();const _0x3efb66=document[_0x4aae35(0x566)]('moments-list');if(_0x3efb66)_0x3efb66[_0x4aae35(0xc02)]='';const _0x44d18f=document[_0x4aae35(0x566)](_0x4aae35(0x787));if(_0x44d18f)_0x44d18f[_0x4aae35(0xc02)]='';const _0x130f57=document[_0x4aae35(0x566)](_0x4aae35(0xb70));if(_0x130f57)_0x130f57[_0x4aae35(0xc02)]='';const _0x28fece=document[_0x4aae35(0x566)](_0x4aae35(0x57d));if(_0x28fece)_0x28fece[_0x4aae35(0xc02)]='';const _0x5b680e=document[_0x4aae35(0x566)](_0x4aae35(0x1dc6));if(_0x5b680e)_0x5b680e[_0x4aae35(0xc02)]='';const _0x6fc989=document[_0x4aae35(0x15b8)](_0x4aae35(0xb17));if(_0x6fc989)_0x6fc989[_0x4aae35(0x21dc)]='聊天';showToast(_0x4aae35(0x23ae),_0x4aae35(0xb27)),console[_0x4aae35(0xc0d)](_0x4aae35(0x1e00)),setTimeout(()=>{const _0x29c9d2=_0x4aae35;hideApp(_0x29c9d2(0x24a7)),hideApp('settings-screen'),showApp('chat-screen');},0x7d0);}catch(_0x5cb64c){console[_0x4aae35(0x24ab)](_0x4aae35(0x202e),_0x5cb64c),showToast(_0x4aae35(0x15c6)+_0x5cb64c[_0x4aae35(0xd7a)],_0x4aae35(0x24ab));}}let currentTransferMsg=null;async function processUserTransfer(_0x5b3fc1,_0x15b7ac,_0xa2b804){const _0x5d3489=_0x2cf6d4;console[_0x5d3489(0xc0d)](_0x5d3489(0x1a61),{'userTransferMsg':_0x5b3fc1,'aiMessages':_0x15b7ac,'characterId':_0xa2b804});if(!_0x5b3fc1||!_0xa2b804){console[_0x5d3489(0xc0d)](_0x5d3489(0x9bd));return;}let _0x3a636a=null,_0xecd011='';for(const _0x4589c5 of _0x15b7ac){if(typeof _0x4589c5===_0x5d3489(0x3c4)&&_0x4589c5[_0x5d3489(0x23df)]==='transfer_action'){_0x3a636a=_0x4589c5[_0x5d3489(0x23af)],console['log'](_0x5d3489(0x2f7),_0x4589c5);break;}if(typeof _0x4589c5===_0x5d3489(0xb97))_0xecd011+=_0x4589c5+'\x20';else typeof _0x4589c5===_0x5d3489(0x3c4)&&_0x4589c5[_0x5d3489(0x1423)]&&(_0xecd011+=_0x4589c5['content']+'\x20');}_0xecd011=_0xecd011[_0x5d3489(0x1424)]()[_0x5d3489(0x1d64)](),console[_0x5d3489(0xc0d)](_0x5d3489(0x10f5),_0xecd011);const _0x5d809a=[_0x5d3489(0x1e9f),'收下','收款','接受',_0x5d3489(0x195d),'已收款',_0x5d3489(0x791),'收到','收了','要了','拿了',_0x5d3489(0x108e),'接收','谢谢','感谢','多谢',_0x5d3489(0x1291),'好的','可以','行'],_0x3285aa=['退回','拒绝','不收','不要',_0x5d3489(0x89b),_0x5d3489(0x1ce),_0x5d3489(0x2148),_0x5d3489(0x47f),'算了',_0x5d3489(0x181d),_0x5d3489(0x112b),'拿着','留着','不用','不行','不可以'];let _0x1c0f40=![],_0x205f5f=![],_0x53f6be=[];if(_0x3a636a)_0x1c0f40=_0x3a636a==='accept',_0x205f5f=_0x3a636a===_0x5d3489(0x3fa),console[_0x5d3489(0xc0d)](_0x5d3489(0x608),{'transferAction':_0x3a636a,'isAccepted':_0x1c0f40,'isRejected':_0x205f5f});else{console[_0x5d3489(0xc0d)](_0x5d3489(0x1eb6));for(const _0x509e12 of _0x5d809a){_0xecd011[_0x5d3489(0x23ec)](_0x509e12)&&(_0x1c0f40=!![],_0x53f6be[_0x5d3489(0x6ee)]('接受:'+_0x509e12));}for(const _0x5d6e67 of _0x3285aa){_0xecd011[_0x5d3489(0x23ec)](_0x5d6e67)&&(_0x205f5f=!![],_0x53f6be['push'](_0x5d3489(0xd82)+_0x5d6e67));}console[_0x5d3489(0xc0d)](_0x5d3489(0x21f9),{'isAccepted':_0x1c0f40,'isRejected':_0x205f5f,'matchedKeywords':_0x53f6be,'fullAiResponse':_0xecd011[_0x5d3489(0x4b2)](0x0,0x64)+_0x5d3489(0x12da)});}if(_0x1c0f40&&!_0x205f5f){_0x5b3fc1[_0x5d3489(0xe54)]=_0x5d3489(0x15d2),console[_0x5d3489(0xc0d)]('🔥\x20[转账处理]\x20AI接受转账，更新状态为已接受');const _0x52543a=chatMessages[_0xa2b804]||[],_0x3a2ee2=_0x52543a[_0x5d3489(0x23ba)](_0x5404f0=>_0x5404f0[_0x5d3489(0x7aa)]===_0x5b3fc1[_0x5d3489(0x7aa)]&&_0x5404f0[_0x5d3489(0x23df)]==='transfer');_0x3a2ee2!==-0x1&&(_0x52543a[_0x3a2ee2][_0x5d3489(0xe54)]=_0x5d3489(0x15d2)),updateTransferDisplay(_0x5b3fc1[_0x5d3489(0x7aa)],_0x5d3489(0x15d2));}else{if(_0x205f5f){_0x5b3fc1[_0x5d3489(0xe54)]=_0x5d3489(0x1164),console['log'](_0x5d3489(0x13f0));const _0x411e00=chatMessages[_0xa2b804]||[],_0x316272=_0x411e00['findIndex'](_0x4321ca=>_0x4321ca[_0x5d3489(0x7aa)]===_0x5b3fc1[_0x5d3489(0x7aa)]&&_0x4321ca['type']===_0x5d3489(0xd8));_0x316272!==-0x1&&(_0x411e00[_0x316272]['status']=_0x5d3489(0x1164)),updateTransferDisplay(_0x5b3fc1[_0x5d3489(0x7aa)],_0x5d3489(0x1164));}}if(_0x1c0f40||_0x205f5f){try{const _0x46d0b7=chatMessages[_0xa2b804]||[],_0x429e62=_0x46d0b7[_0x5d3489(0x1aeb)](_0x422bdf=>_0x422bdf['timestamp']===_0x5b3fc1[_0x5d3489(0x7aa)]&&_0x422bdf['type']===_0x5d3489(0xd8));if(_0x429e62){const _0x2b1796=_0xa2b804+_0x5d3489(0x1a5f)+_0x429e62[_0x5d3489(0x7aa)]+'_'+Math[_0x5d3489(0x191c)]()['toString'](0x24)['substr'](0x2,0x9);await db[_0x5d3489(0x464)][_0x5d3489(0x53a)]({'id':_0x2b1796,'characterId':_0xa2b804,'messageData':_0x429e62}),console['log'](_0x5d3489(0x1bc0));}}catch(_0x46ab2a){console[_0x5d3489(0x24ab)](_0x5d3489(0xec0),_0x46ab2a);}const _0x2ee42b=_0x1c0f40?_0x5d3489(0x1dde):'已退回';let _0x382847=currentChatCharacter?.[_0x5d3489(0x222f)]||'角色';currentChatCharacter?.[_0x5d3489(0x4b7)]&&_0x5b3fc1[_0x5d3489(0x65d)]&&(_0x382847=_0x5b3fc1[_0x5d3489(0x65d)]);const _0x460ef0={'id':Date[_0x5d3489(0x18e0)]()['toString'](),'sender':_0x5d3489(0x212),'content':''+_0x382847+_0x2ee42b+'\x20¥'+Number(_0x5b3fc1[_0x5d3489(0xca8)])[_0x5d3489(0x3cd)](0x2),'timestamp':Date[_0x5d3489(0x18e0)]()},_0x627da2=chatMessages[_0xa2b804]||[];_0x627da2[_0x5d3489(0x6ee)](_0x460ef0),chatMessages[_0xa2b804]=_0x627da2;try{const _0x5d150c=_0xa2b804+_0x5d3489(0x1633)+_0x460ef0[_0x5d3489(0x7aa)]+'_'+Math[_0x5d3489(0x191c)]()[_0x5d3489(0x9a3)](0x24)[_0x5d3489(0x18cf)](0x2,0x9);await db['chatMessages'][_0x5d3489(0xe1)]({'id':_0x5d150c,'characterId':_0xa2b804,'messageData':_0x460ef0}),console[_0x5d3489(0xc0d)](_0x5d3489(0x12df));}catch(_0x299d6f){console[_0x5d3489(0x24ab)]('🔥\x20[转账处理]\x20保存系统消息失败:',_0x299d6f);}addMessageWithAnimation(_0x460ef0,_0xa2b804),console[_0x5d3489(0xc0d)](_0x5d3489(0x176a));}}function updateTransferDisplay(_0x142f51,_0x320400,_0x4ebfd2=0x0){const _0x5c776d=_0x2cf6d4;console['log'](_0x5c776d(0x1f91),{'transferTimestamp':_0x142f51,'status':_0x320400});const _0x248eb8=document[_0x5c776d(0x1ed9)](_0x5c776d(0x61c));console['log']('🔥\x20[转账界面更新]\x20页面中的所有转账卡片:',Array[_0x5c776d(0x2308)](_0x248eb8)[_0x5c776d(0xf6d)](_0x470424=>({'id':_0x470424[_0x5c776d(0x1add)](_0x5c776d(0x193d)),'element':_0x470424})));const _0x265ad0=document[_0x5c776d(0x15b8)]('[data-transfer-id=\x22'+_0x142f51+'\x22]');if(!_0x265ad0){_0x4ebfd2<0x3?(console[_0x5c776d(0xc0d)](_0x5c776d(0xa20)+(_0x4ebfd2+0x1)+_0x5c776d(0x587)),setTimeout(()=>{updateTransferDisplay(_0x142f51,_0x320400,_0x4ebfd2+0x1);},0x12c*(_0x4ebfd2+0x1))):console[_0x5c776d(0xc0d)]('🔥\x20[转账界面更新]\x20重试次数已达上限，转账卡片可能已被移除');return;}_0x265ad0[_0x5c776d(0x226e)]['remove'](_0x5c776d(0x15d2),_0x5c776d(0x1164)),_0x265ad0['classList'][_0x5c776d(0xe1)](_0x320400);const _0x49f0e5=chatMessages[currentChatCharacter?.['id']]||[],_0x51fdd4=_0x49f0e5[_0x5c776d(0x1aeb)](_0x512685=>_0x512685[_0x5c776d(0x7aa)]==_0x142f51&&_0x512685[_0x5c776d(0x23df)]===_0x5c776d(0xd8));let _0x2138f2='';if(_0x320400==='accepted'){const _0x3b003b=_0x51fdd4?.['recipientName']?_0x51fdd4['recipientName']+_0x5c776d(0x1dde):_0x5c776d(0x1dd9);_0x2138f2='<div\x20class=\x22transfer-status\x22>'+_0x3b003b+_0x5c776d(0xa54);}else{if(_0x320400===_0x5c776d(0x1164)){const _0x2949a9=_0x51fdd4?.[_0x5c776d(0x65d)]?_0x51fdd4['recipientName']+_0x5c776d(0x939):_0x5c776d(0x1213);_0x2138f2='<div\x20class=\x22transfer-status\x22>'+_0x2949a9+_0x5c776d(0xa54);}}const _0x4dbe7e=_0x265ad0[_0x5c776d(0x15b8)](_0x5c776d(0x989));if(_0x4dbe7e)_0x4dbe7e['outerHTML']=_0x2138f2;else _0x2138f2&&_0x265ad0[_0x5c776d(0x22ba)](_0x5c776d(0x580),_0x2138f2);_0x265ad0[_0x5c776d(0x10b3)](_0x5c776d(0x11cf)),console[_0x5c776d(0xc0d)](_0x5c776d(0x1de));}async function sendTransfer(){const _0x530804=_0x2cf6d4,_0x52a7a0=parseFloat(document['getElementById'](_0x530804(0x1dcc))[_0x530804(0xc34)]),_0x46fa33=document[_0x530804(0x566)](_0x530804(0x15db))[_0x530804(0xc34)][_0x530804(0x1424)]();if(!_0x52a7a0||_0x52a7a0<=0x0){showToast(_0x530804(0x1741),'warning');return;}if(_0x52a7a0>0x3b9aca00){showToast(_0x530804(0x10e9),_0x530804(0x13bb));return;}let _0x4d5da0=null;if(currentChatCharacter[_0x530804(0x4b7)]){const _0x3bf00a=document[_0x530804(0x566)](_0x530804(0x1efa))[_0x530804(0xc34)];if(!_0x3bf00a){showToast(_0x530804(0x889),_0x530804(0x13bb));return;}_0x4d5da0=currentChatCharacter['members'][_0x530804(0x1aeb)](_0x59634e=>_0x59634e['id']===_0x3bf00a);if(!_0x4d5da0){showToast(_0x530804(0x1a49),_0x530804(0x24ab));return;}}const _0x2672c7={'id':Date['now']()[_0x530804(0x9a3)](),'sender':'sent','type':'transfer','amount':_0x52a7a0,'note':_0x46fa33||'转账','timestamp':Date[_0x530804(0x18e0)]()};_0x4d5da0?(_0x2672c7[_0x530804(0xf3c)]=_0x4d5da0['id'],_0x2672c7[_0x530804(0x65d)]=_0x4d5da0[_0x530804(0x222f)],console['log'](_0x530804(0x207f),{'id':_0x2672c7['id'],'amount':_0x2672c7['amount'],'note':_0x2672c7[_0x530804(0x15fe)],'recipientName':_0x2672c7['recipientName'],'recipientId':_0x2672c7[_0x530804(0xf3c)]})):console[_0x530804(0xc0d)](_0x530804(0x12ba),{'id':_0x2672c7['id'],'amount':_0x2672c7['amount'],'note':_0x2672c7[_0x530804(0x15fe)]});!chatMessages[currentChatCharacter['id']]&&(chatMessages[currentChatCharacter['id']]=[]);const _0x443a20=chatMessages[currentChatCharacter['id']];_0x443a20[_0x530804(0x6ee)](_0x2672c7);try{const _0x8fd666=currentChatCharacter['id']+_0x530804(0x1a5f)+_0x2672c7[_0x530804(0x7aa)]+'_'+Math[_0x530804(0x191c)]()[_0x530804(0x9a3)](0x24)[_0x530804(0x18cf)](0x2,0x9);await db['chatMessages'][_0x530804(0xe1)]({'id':_0x8fd666,'characterId':currentChatCharacter['id'],'messageData':_0x2672c7}),console[_0x530804(0xc0d)](_0x530804(0x80e));}catch(_0x37f888){console['error'](_0x530804(0x366),_0x37f888),await saveChatMessages();}addMessageWithAnimation(_0x2672c7,currentChatCharacter['id']),pendingUserMessage=_0x2672c7;const _0x24cbdf=document['getElementById'](_0x530804(0x9c));_0x24cbdf&&(_0x24cbdf[_0x530804(0x655)][_0x530804(0x4ce)]=_0x530804(0x23f0),_0x24cbdf[_0x530804(0x226e)]['add'](_0x530804(0x1f33)),_0x24cbdf[_0x530804(0x1c18)]=_0x530804(0x100f)),renderMessageList(),document[_0x530804(0x566)](_0x530804(0x187f))[_0x530804(0x226e)][_0x530804(0x128)](_0x530804(0x1e35)),document['getElementById'](_0x530804(0x1dcc))[_0x530804(0xc34)]='',document['getElementById'](_0x530804(0x15db))[_0x530804(0xc34)]='',document[_0x530804(0x566)]('transfer-recipient')[_0x530804(0xc34)]='',showToast('转账已发送',_0x530804(0xb27));}function showTransferConfirmDialog(_0x58a928){const _0x5439f6=_0x2cf6d4;if(!_0x58a928||_0x58a928[_0x5439f6(0xe54)])return;const _0x7f6a8b=document[_0x5439f6(0x566)](_0x5439f6(0x1e53)),_0x297b54=_0x7f6a8b[_0x5439f6(0x15b8)](_0x5439f6(0x267)),_0x357549=_0x7f6a8b['querySelector'](_0x5439f6(0x1a93));_0x297b54[_0x5439f6(0x21dc)]='¥\x20'+Number(_0x58a928[_0x5439f6(0xca8)])[_0x5439f6(0x3cd)](0x2),_0x357549[_0x5439f6(0x21dc)]=_0x5439f6(0x12d1)+(_0x58a928[_0x5439f6(0x15fe)]||'无'),currentTransferMsg=_0x58a928,_0x7f6a8b['classList'][_0x5439f6(0xe1)]('visible');}async function acceptTransfer(){const _0x1b1826=_0x2cf6d4;if(!currentTransferMsg||!currentChatCharacter)return;const _0x4ac181=chatMessages[currentChatCharacter['id']]||[],_0x57fb38=_0x4ac181[_0x1b1826(0x23ba)](_0x3b7bec=>_0x3b7bec[_0x1b1826(0x7aa)]===currentTransferMsg['timestamp']&&_0x3b7bec[_0x1b1826(0x23df)]===_0x1b1826(0xd8));if(_0x57fb38!==-0x1){_0x4ac181[_0x57fb38][_0x1b1826(0xe54)]=_0x1b1826(0x15d2),updateTransferDisplay(currentTransferMsg[_0x1b1826(0x7aa)],_0x1b1826(0x15d2));try{const _0x2a37a5=currentChatCharacter['id']+_0x1b1826(0x1a5f)+currentTransferMsg[_0x1b1826(0x7aa)]+'_'+Math[_0x1b1826(0x191c)]()[_0x1b1826(0x9a3)](0x24)[_0x1b1826(0x18cf)](0x2,0x9);await db[_0x1b1826(0x464)][_0x1b1826(0x53a)]({'id':_0x2a37a5,'characterId':currentChatCharacter['id'],'messageData':_0x4ac181[_0x57fb38]}),console[_0x1b1826(0xc0d)]('✅\x20[手动确认收款]\x20消息已保存到数据库');}catch(_0x4f9d66){console['error']('确认收款保存失败:',_0x4f9d66);}const _0x7a5e9f={'id':Date[_0x1b1826(0x18e0)]()['toString'](),'sender':'system','content':'你已确认收款\x20¥'+Number(currentTransferMsg[_0x1b1826(0xca8)])['toFixed'](0x2),'timestamp':Date['now']()};_0x4ac181[_0x1b1826(0x6ee)](_0x7a5e9f);try{const _0x49ace7=currentChatCharacter['id']+_0x1b1826(0x1633)+_0x7a5e9f['timestamp']+'_'+Math[_0x1b1826(0x191c)]()[_0x1b1826(0x9a3)](0x24)[_0x1b1826(0x18cf)](0x2,0x9);await db[_0x1b1826(0x464)][_0x1b1826(0xe1)]({'id':_0x49ace7,'characterId':currentChatCharacter['id'],'messageData':_0x7a5e9f}),console[_0x1b1826(0xc0d)](_0x1b1826(0x2411));}catch(_0xe19d3e){console[_0x1b1826(0x24ab)](_0x1b1826(0x5f9),_0xe19d3e);}renderChatMessages(currentChatCharacter['id']);}document[_0x1b1826(0x566)](_0x1b1826(0x1e53))[_0x1b1826(0x226e)][_0x1b1826(0x128)]('visible'),currentTransferMsg=null,showToast('已确认收款',_0x1b1826(0xb27));}async function rejectTransfer(){const _0x2caa8c=_0x2cf6d4;if(!currentTransferMsg||!currentChatCharacter)return;const _0x212b7c=chatMessages[currentChatCharacter['id']]||[],_0x3b3574=_0x212b7c[_0x2caa8c(0x23ba)](_0x27a756=>_0x27a756[_0x2caa8c(0x7aa)]===currentTransferMsg[_0x2caa8c(0x7aa)]&&_0x27a756[_0x2caa8c(0x23df)]===_0x2caa8c(0xd8));if(_0x3b3574!==-0x1){_0x212b7c[_0x3b3574][_0x2caa8c(0xe54)]=_0x2caa8c(0x1164),updateTransferDisplay(currentTransferMsg[_0x2caa8c(0x7aa)],_0x2caa8c(0x1164));try{const _0x20cd99=currentChatCharacter['id']+_0x2caa8c(0x1a5f)+currentTransferMsg['timestamp']+'_'+Math['random']()['toString'](0x24)['substr'](0x2,0x9);await db[_0x2caa8c(0x464)][_0x2caa8c(0x53a)]({'id':_0x20cd99,'characterId':currentChatCharacter['id'],'messageData':_0x212b7c[_0x3b3574]}),console[_0x2caa8c(0xc0d)](_0x2caa8c(0x6f2));}catch(_0x51af36){console[_0x2caa8c(0x24ab)](_0x2caa8c(0x1b8),_0x51af36);}const _0x3ae249={'id':Date['now']()[_0x2caa8c(0x9a3)](),'sender':'system','content':_0x2caa8c(0x1df6)+Number(currentTransferMsg[_0x2caa8c(0xca8)])[_0x2caa8c(0x3cd)](0x2),'timestamp':Date[_0x2caa8c(0x18e0)]()};_0x212b7c['push'](_0x3ae249);try{const _0x545c8c=currentChatCharacter['id']+_0x2caa8c(0x1633)+_0x3ae249['timestamp']+'_'+Math[_0x2caa8c(0x191c)]()[_0x2caa8c(0x9a3)](0x24)[_0x2caa8c(0x18cf)](0x2,0x9);await db[_0x2caa8c(0x464)]['add']({'id':_0x545c8c,'characterId':currentChatCharacter['id'],'messageData':_0x3ae249}),console[_0x2caa8c(0xc0d)](_0x2caa8c(0x1d5f));}catch(_0x57ff5f){console[_0x2caa8c(0x24ab)](_0x2caa8c(0xb11),_0x57ff5f);}renderChatMessages(currentChatCharacter['id']);}document[_0x2caa8c(0x566)]('transfer-confirm-modal')['classList'][_0x2caa8c(0x128)](_0x2caa8c(0x1e35)),currentTransferMsg=null,showToast(_0x2caa8c(0x1640),_0x2caa8c(0xb27));}const originalShowApp=window['showApp'];originalShowApp&&(window[_0x2cf6d4(0x5ce)]=function(_0x479769){const _0x4d1e4d=_0x2cf6d4;originalShowApp(_0x479769);if(_0x479769===_0x4d1e4d(0x24a7))calculateStorageUsage();});function showScheduleTimesModal(){const _0x2e0d3=_0x2cf6d4;if(!currentChatCharacter)return;const _0x310cb=getCurrentChatSettings(),_0x5a2564=_0x310cb[_0x2e0d3(0x11f3)]||[],_0x48f07e=document[_0x2e0d3(0x566)](_0x2e0d3(0x1cbf));_0x48f07e[_0x2e0d3(0xc02)]='',_0x5a2564['forEach']((_0x432e7f,_0xc08bf2)=>{const _0x3d9027=_0x2e0d3,_0x3b6a7f=document[_0x3d9027(0x1ad8)](_0x3d9027(0x526));_0x3b6a7f[_0x3d9027(0x221)]=_0x3d9027(0x1ddc),_0x3b6a7f[_0x3d9027(0x655)][_0x3d9027(0x17a3)]=_0x3d9027(0x1710),_0x3b6a7f[_0x3d9027(0xc02)]=_0x3d9027(0x15b4)+_0x432e7f+'\x22\x20onchange=\x22updateScheduleTime('+_0xc08bf2+_0x3d9027(0xf2f)+_0xc08bf2+_0x3d9027(0x1fa2),_0x48f07e[_0x3d9027(0x1925)](_0x3b6a7f);}),showModal(_0x2e0d3(0x1053));}function addScheduleTime(){const _0x55cffd=_0x2cf6d4;if(!currentChatCharacter)return;const _0x1d3647=getCurrentChatSettings();!_0x1d3647[_0x55cffd(0x11f3)]&&(_0x1d3647[_0x55cffd(0x11f3)]=[]);if(_0x1d3647[_0x55cffd(0x11f3)]['length']>=0xa){alert('最多只能设置10个时间点');return;}_0x1d3647[_0x55cffd(0x11f3)]['push'](_0x55cffd(0xfa2)),saveCurrentChatSettings(_0x1d3647),showScheduleTimesModal();}function updateScheduleTime(_0x4fc430,_0x1b1aea){const _0x30201d=_0x2cf6d4;if(!currentChatCharacter)return;const _0x42131c=getCurrentChatSettings();_0x42131c[_0x30201d(0x11f3)]&&_0x42131c['scheduledMomentsTimes'][_0x4fc430]!==undefined&&(_0x42131c[_0x30201d(0x11f3)][_0x4fc430]=_0x1b1aea,saveCurrentChatSettings(_0x42131c));}function removeScheduleTime(_0x461c76){const _0x31461b=_0x2cf6d4;if(!currentChatCharacter)return;const _0x4995bf=getCurrentChatSettings();_0x4995bf[_0x31461b(0x11f3)]&&_0x4995bf[_0x31461b(0x11f3)][_0x461c76]!==undefined&&(_0x4995bf[_0x31461b(0x11f3)][_0x31461b(0x220f)](_0x461c76,0x1),saveCurrentChatSettings(_0x4995bf),showScheduleTimesModal());}function saveScheduleTimes(){const _0x2639e7=_0x2cf6d4;if(!currentChatCharacter)return;const _0x2be668=document['getElementById'](_0x2639e7(0x1cbf)),_0x30598d=_0x2be668[_0x2639e7(0x1ed9)](_0x2639e7(0x2140)),_0x455ea0=Array[_0x2639e7(0x2308)](_0x30598d)['map'](_0x4dd754=>_0x4dd754[_0x2639e7(0xc34)])[_0x2639e7(0x803)](_0x269604=>_0x269604),_0x365f40=getCurrentChatSettings();_0x365f40['scheduledMomentsTimes']=_0x455ea0,saveCurrentChatSettings(_0x365f40),updateScheduleTimesDisplay(),hideModal(_0x2639e7(0x1053)),setTimeout(async()=>{const _0x374b71=_0x2639e7;try{await initGlobalMomentsSystem(),console[_0x374b71(0xc0d)]('✅\x20定时发布设置已更新');}catch(_0x1072c8){console[_0x374b71(0x24ab)](_0x374b71(0x1e1e),_0x1072c8);}},0x1f4),showToast(_0x2639e7(0x2374)+_0x455ea0['length']+_0x2639e7(0x2002),_0x2639e7(0xb27));}function updateScheduleTimesDisplay(){const _0x246c51=_0x2cf6d4;if(!currentChatCharacter)return;const _0x1c4c04=getCurrentChatSettings(),_0x62f62c=_0x1c4c04[_0x246c51(0x11f3)]||[],_0x2e7277=document['getElementById']('schedule-times-display');if(_0x62f62c[_0x246c51(0xcbf)]===0x0)_0x2e7277[_0x246c51(0x21dc)]=_0x246c51(0x1465);else _0x62f62c[_0x246c51(0xcbf)]===0x1?_0x2e7277[_0x246c51(0x21dc)]='1个时间点\x20('+_0x62f62c[0x0]+')':_0x2e7277[_0x246c51(0x21dc)]=_0x62f62c[_0x246c51(0xcbf)]+_0x246c51(0x1fcf);}async function testPublishMoment(){const _0xa41692=_0x2cf6d4;if(!currentChatCharacter){alert(_0xa41692(0x1268));return;}const _0x52ef92=document['querySelector'](_0xa41692(0x1782)),_0x110f64=_0x52ef92['textContent'];_0x52ef92[_0xa41692(0x21dc)]=_0xa41692(0x189e),_0x52ef92[_0xa41692(0x194e)]=!![];try{await triggerBackgroundMomentsTest(currentChatCharacter['id']),showToast(_0xa41692(0x1318),_0xa41692(0xb27));}catch(_0x4d0a4e){console[_0xa41692(0x24ab)]('测试发布失败:',_0x4d0a4e),showToast(_0xa41692(0x18db),_0xa41692(0x24ab));}finally{_0x52ef92['textContent']=_0x110f64,_0x52ef92[_0xa41692(0x194e)]=![];}}function initScheduledMomentsSystem(){const _0x13ac6e=_0x2cf6d4;if(!currentChatCharacter)return;const _0x81ccd7=getCurrentChatSettings();if(!_0x81ccd7[_0x13ac6e(0x4c6)]||!_0x81ccd7['scheduledMomentsTimes']?.[_0x13ac6e(0xcbf)])return;_0x81ccd7[_0x13ac6e(0x11f3)]['forEach'](_0x125a0f=>{const _0x13b127=_0x13ac6e;if(!_0x125a0f)return;const [_0xf74d99,_0x1fbe4a]=_0x125a0f[_0x13b127(0x633)](':')[_0x13b127(0xf6d)](Number),_0x1f7632=new Date(),_0x283ed2=new Date();_0x283ed2[_0x13b127(0x482)](_0xf74d99,_0x1fbe4a,0x0,0x0);_0x283ed2<=_0x1f7632&&_0x283ed2['setDate'](_0x283ed2['getDate']()+0x1);const _0x35b7c7=_0x283ed2['getTime']()-_0x1f7632[_0x13b127(0xa57)]();setTimeout(()=>{triggerBackgroundMoments(currentChatCharacter['id']),setInterval(()=>{triggerBackgroundMoments(currentChatCharacter['id']);},0x18*0x3c*0x3c*0x3e8);},_0x35b7c7);});}let notificationQueue=[],currentNotification=null,isProcessingQueue=![];function createPushNotification(_0x3aa22,_0x3c313e,_0x1c4c3=0x0){const _0x1b81fa=_0x2cf6d4;setTimeout(()=>{const _0x267914=_0x3a81;SoundManager[_0x267914(0x10f4)](SoundManager[_0x267914(0x24a1)][_0x267914(0xb63)],_0x3aa22?.['id']);},_0x1c4c3);const _0x85cf65=document['getElementById']('phone-screen'),_0x37079f=_0x85cf65&&window[_0x1b81fa(0x13bc)](_0x85cf65)['display']!==_0x1b81fa(0xfe9),_0x3c2008=document['getElementById']('api-chat-screen'),_0x211a9b=_0x3c2008&&window[_0x1b81fa(0x13bc)](_0x3c2008)['display']!==_0x1b81fa(0xfe9),_0x262d97=_0x211a9b&&currentChatCharacter&&currentChatCharacter['id']===_0x3aa22['id'];console[_0x1b81fa(0xc0d)]('🔔\x20[推送通知]\x20检查界面状态:',{'mainScreenVisible':_0x37079f,'chatScreenVisible':_0x211a9b,'currentChatCharacter':currentChatCharacter?.[_0x1b81fa(0x222f)],'messageFromCharacter':_0x3aa22[_0x1b81fa(0x222f)],'isChattingWithThisCharacter':_0x262d97,'shouldShowNotification':_0x37079f&&!_0x262d97});const _0x4ff719=typeof _0x3c313e===_0x1b81fa(0xb97)&&(_0x3c313e[_0x1b81fa(0x23ec)]('创建了纪念日')||_0x3c313e[_0x1b81fa(0x23ec)](_0x1b81fa(0x2495))||_0x3c313e['includes'](_0x1b81fa(0x1cf8))||_0x3c313e[_0x1b81fa(0x23ec)](_0x1b81fa(0x638))||_0x3c313e[_0x1b81fa(0x23ec)](_0x1b81fa(0x2515))||_0x3c313e[_0x1b81fa(0x23ec)](_0x1b81fa(0xb87))||_0x3c313e[_0x1b81fa(0x23ec)](_0x1b81fa(0x6ef))||_0x3c313e[_0x1b81fa(0x23ec)](_0x1b81fa(0x1c4))||_0x3c313e[_0x1b81fa(0x23ec)](_0x1b81fa(0x148b))||_0x3c313e[_0x1b81fa(0x23ec)](_0x1b81fa(0x1a79))||_0x3c313e[_0x1b81fa(0x23ec)](_0x1b81fa(0x193a))||_0x3c313e[_0x1b81fa(0x23ec)]('今天是')||_0x3c313e[_0x1b81fa(0x23ec)]('🎉')||_0x3c313e['includes']('📝')||_0x3c313e[_0x1b81fa(0x23ec)]('📅')||_0x3c313e['includes']('⏰'));if(_0x4ff719)console[_0x1b81fa(0xc0d)](_0x1b81fa(0x1ac1));else{if(!_0x37079f||_0x262d97){console['log']('🔔\x20[推送通知]\x20用户不在主屏幕或正在和该角色聊天，不显示推送');return;}}notificationQueue[_0x1b81fa(0x6ee)]({'character':_0x3aa22,'messageData':_0x3c313e,'delay':_0x1c4c3}),console[_0x1b81fa(0xc0d)](_0x1b81fa(0x1df7),notificationQueue[_0x1b81fa(0xcbf)]),processNotificationQueue();}function processNotificationQueue(){const _0x14786b=_0x2cf6d4;if(isProcessingQueue||notificationQueue['length']===0x0)return;isProcessingQueue=!![],console['log'](_0x14786b(0x15f8),notificationQueue[_0x14786b(0xcbf)]);const _0x2abb15=()=>{const _0x229430=_0x14786b;if(notificationQueue['length']===0x0){isProcessingQueue=![],console[_0x229430(0xc0d)]('🔔\x20[推送通知]\x20队列处理完成');return;}const {character:_0x2cad80,messageData:_0x2c1350,delay:_0x101f24}=notificationQueue['shift']();setTimeout(()=>{showSingleNotification(_0x2cad80,_0x2c1350),setTimeout(()=>{_0x2abb15();},0xa28);},_0x101f24);};_0x2abb15();}function showSingleNotification(_0x4bdec8,_0x56dd5e){const _0x5671fd=_0x2cf6d4;console[_0x5671fd(0xc0d)](_0x5671fd(0x1301),_0x4bdec8[_0x5671fd(0x222f)]);const _0x5c59f5=document[_0x5671fd(0x566)]('notification-container');if(!_0x5c59f5){console['error']('🔔\x20[推送通知]\x20找不到通知容器!');return;}currentNotification&&hideNotification(currentNotification,!![]);const _0x50a3ef=document['createElement']('div');_0x50a3ef[_0x5671fd(0x221)]=_0x5671fd(0x13e0),currentNotification=_0x50a3ef;let _0x48d551='',_0x2193d6='message',_0x5452d1=_0x4bdec8['name'],_0x223a6e=![],_0x43a4e8='';if(typeof _0x56dd5e==='string')_0x48d551=_0x56dd5e;else{if(typeof _0x56dd5e===_0x5671fd(0x3c4)){if(_0x56dd5e[_0x5671fd(0x222f)]&&_0x56dd5e[_0x5671fd(0xd7a)]){_0x223a6e=!![],_0x43a4e8=_0x56dd5e[_0x5671fd(0x222f)],_0x5452d1='[群聊]'+_0x4bdec8[_0x5671fd(0x222f)];if(typeof _0x56dd5e['message']===_0x5671fd(0xb97))_0x48d551=_0x43a4e8+'：'+_0x56dd5e[_0x5671fd(0xd7a)];else{if(typeof _0x56dd5e[_0x5671fd(0xd7a)]===_0x5671fd(0x3c4)&&_0x56dd5e[_0x5671fd(0xd7a)][_0x5671fd(0x23df)])switch(_0x56dd5e[_0x5671fd(0xd7a)][_0x5671fd(0x23df)]){case _0x5671fd(0xd8):_0x48d551=_0x43a4e8+_0x5671fd(0xfff)+_0x56dd5e[_0x5671fd(0xd7a)]['amount'],_0x2193d6=_0x5671fd(0xd8);break;case'voice_message':_0x48d551=_0x43a4e8+'：[语音消息]',_0x2193d6=_0x5671fd(0x2c2);break;default:_0x48d551=_0x43a4e8+'：'+(_0x56dd5e['message'][_0x5671fd(0x1423)]||'[消息]');}else _0x48d551=_0x43a4e8+'：'+String(_0x56dd5e['message']);}}else{if(_0x56dd5e[_0x5671fd(0x23df)])switch(_0x56dd5e[_0x5671fd(0x23df)]){case _0x5671fd(0xd8):_0x48d551=_0x5671fd(0x1ec0)+_0x56dd5e['amount'],_0x2193d6='transfer';break;case _0x5671fd(0x1bfd):_0x48d551=_0x5671fd(0x1343),_0x2193d6='voice';break;case _0x5671fd(0xb93):_0x48d551='[图片]',_0x2193d6='image';break;case'emoji':_0x48d551=_0x5671fd(0x1a25)+_0x56dd5e['description'],_0x2193d6=_0x5671fd(0x1f41);break;default:_0x48d551=_0x56dd5e['content']||_0x5671fd(0x10ed);}else _0x48d551=_0x56dd5e[_0x5671fd(0x1423)]||_0x56dd5e[_0x5671fd(0xd7a)]||_0x5671fd(0x10ed);}}}_0x48d551['length']>0x19&&(_0x48d551=_0x48d551[_0x5671fd(0x4b2)](0x0,0x19)+_0x5671fd(0x12da));const _0x47ae2b=new Date(),_0x3a575f=_0x47ae2b[_0x5671fd(0xd4a)](_0x5671fd(0x1c0b),{'hour':_0x5671fd(0x19f3),'minute':_0x5671fd(0x19f3)});_0x50a3ef[_0x5671fd(0xc02)]=_0x5671fd(0x204d)+(_0x4bdec8[_0x5671fd(0x10f9)]||_0x4bdec8[_0x5671fd(0x107f)]||createDefaultAvatar(_0x4bdec8[_0x5671fd(0x222f)]))+_0x5671fd(0x1ca8)+_0x5452d1+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22notification-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22notification-title\x22>'+_0x5452d1+_0x5671fd(0x4fa)+_0x48d551+_0x5671fd(0x131c)+_0x3a575f+_0x5671fd(0x158f),_0x50a3ef[_0x5671fd(0x11cf)]=()=>{const _0x43f3e4=_0x5671fd;console[_0x43f3e4(0xc0d)]('🔔\x20[推送通知]\x20用户点击了推送通知，跳转到聊天界面');const _0x120a62=_0x48d551[_0x43f3e4(0x1cab)]('[短信]'),_0x1862ce=_0x48d551[_0x43f3e4(0x1cab)]('[日记]');if(_0x4bdec8&&_0x4bdec8['id']){console['log'](_0x43f3e4(0x2035),_0x4bdec8[_0x43f3e4(0x222f)],_0x4bdec8['id'],_0x43f3e4(0x201f),_0x120a62,_0x43f3e4(0x228c),_0x1862ce);if(_0x120a62)window[_0x43f3e4(0x1bad)]=_0x4bdec8,updateSMSChatHeader(_0x4bdec8),renderSMSMessages(_0x4bdec8['id']),showApp(_0x43f3e4(0x1315)),console['log']('🔔\x20[短信推送通知]\x20跳转到短信聊天界面完成');else _0x1862ce?(currentChatCharacter=_0x4bdec8,showApp(_0x43f3e4(0x1154)),setTimeout(()=>{showDiary();},0x64),console['log'](_0x43f3e4(0x1a9d))):(currentChatCharacter=_0x4bdec8,updateChatHeader(),renderChatMessages(_0x4bdec8['id']),showApp(_0x43f3e4(0x1154)),console[_0x43f3e4(0xc0d)]('🔔\x20[推送通知]\x20跳转到聊天界面完成'));}hideNotification(_0x50a3ef);},_0x5c59f5['appendChild'](_0x50a3ef),setTimeout(()=>{const _0x1de3ee=_0x5671fd;_0x50a3ef[_0x1de3ee(0x226e)][_0x1de3ee(0xe1)]('show');},0x32),setTimeout(()=>{currentNotification===_0x50a3ef&&hideNotification(_0x50a3ef);},0x8fc);}function hideNotification(_0x2419ee,_0x4af097=![]){const _0x3ac6a5=_0x2cf6d4;if(_0x2419ee&&_0x2419ee[_0x3ac6a5(0xe9)]){_0x2419ee[_0x3ac6a5(0x226e)][_0x3ac6a5(0x128)](_0x3ac6a5(0xd16)),_0x2419ee[_0x3ac6a5(0x226e)][_0x3ac6a5(0xe1)](_0x3ac6a5(0x22df));currentNotification===_0x2419ee&&(currentNotification=null);const _0x5b5b0c=_0x4af097?0x0:0xfa;setTimeout(()=>{const _0xf74d8f=_0x3ac6a5;_0x2419ee['parentNode']&&_0x2419ee[_0xf74d8f(0xe9)][_0xf74d8f(0x1624)](_0x2419ee);},_0x5b5b0c);}}function createMomentInteractionNotification(_0x5c67cb,_0x460322,_0x1d410e){const _0x2b362b=_0x2cf6d4;let _0xa74e41='';switch(_0x460322){case'like':_0xa74e41=_0x2b362b(0x1a91);break;case _0x2b362b(0x8a4):_0xa74e41='评论了你的动态';break;default:_0xa74e41=_0x2b362b(0x1473);}createPushNotification(_0x5c67cb,_0xa74e41);}function createSMSPushNotification(_0x398ce2,_0x28c074,_0x1d1486=0x0){const _0x8d24f7=_0x2cf6d4;setTimeout(()=>{const _0xf42570=_0x3a81;SoundManager[_0xf42570(0x10f4)](SoundManager['TYPES'][_0xf42570(0xb63)],_0x398ce2?.['id']);},_0x1d1486);const _0x154111=document[_0x8d24f7(0x566)]('phone-screen'),_0x598e9d=_0x154111&&window[_0x8d24f7(0x13bc)](_0x154111)[_0x8d24f7(0x2526)]!==_0x8d24f7(0xfe9),_0x4f6cb3=document[_0x8d24f7(0x566)]('sms-chat-screen'),_0x412f05=_0x4f6cb3&&window[_0x8d24f7(0x13bc)](_0x4f6cb3)[_0x8d24f7(0x2526)]!==_0x8d24f7(0xfe9),_0x18e1ab=_0x412f05&&window[_0x8d24f7(0x1bad)]&&window['currentSMSCharacter']['id']===_0x398ce2['id'];console['log']('🔔\x20[短信推送通知]\x20检查界面状态:',{'mainScreenVisible':_0x598e9d,'smsScreenVisible':_0x412f05,'currentSMSCharacter':window[_0x8d24f7(0x1bad)]?.['name'],'messageFromCharacter':_0x398ce2[_0x8d24f7(0x222f)],'isChattingWithThisCharacter':_0x18e1ab,'shouldShowNotification':_0x598e9d&&!_0x18e1ab});if(!_0x598e9d||_0x18e1ab){console[_0x8d24f7(0xc0d)](_0x8d24f7(0x8b5));return;}const _0x1742bc=_0x8d24f7(0x246a)+_0x28c074;createPushNotification(_0x398ce2,_0x1742bc,_0x1d1486);}window[_0x2cf6d4(0x167)](_0x2cf6d4(0x77d),function(){const _0x529da9=_0x2cf6d4;if(currentChatCharacter)markAsRead(currentChatCharacter['id']),console[_0x529da9(0xc0d)]('🔥\x20[页面卸载]\x20标记当前聊天为已读:',currentChatCharacter[_0x529da9(0x222f)]);else{const _0x1212c1=sessionStorage[_0x529da9(0x2250)](_0x529da9(0x1463));_0x1212c1&&(markAsRead(_0x1212c1),console['log'](_0x529da9(0x1c5c),_0x1212c1));}sessionStorage['removeItem'](_0x529da9(0x1463));}),document['addEventListener']('visibilitychange',function(){const _0x2462fc=_0x2cf6d4;document[_0x2462fc(0x1a2c)]&&currentChatCharacter&&(markAsRead(currentChatCharacter['id']),console['log'](_0x2462fc(0x1773),currentChatCharacter[_0x2462fc(0x222f)]));}),window[_0x2cf6d4(0x167)](_0x2cf6d4(0x1d7b),function(){const _0x478868=_0x2cf6d4;currentChatCharacter&&(markAsRead(currentChatCharacter['id']),console['log'](_0x478868(0x14e0),currentChatCharacter[_0x478868(0x222f)]));}),document[_0x2cf6d4(0x167)](_0x2cf6d4(0x7f7),function(){const _0x5774d2=_0x2cf6d4;document[_0x5774d2(0x566)](_0x5774d2(0x2234))?.[_0x5774d2(0x167)]('click',()=>{const _0x95b819=_0x5774d2;document[_0x95b819(0x566)](_0x95b819(0x187f))[_0x95b819(0x226e)][_0x95b819(0x128)](_0x95b819(0x1e35));}),document[_0x5774d2(0x566)](_0x5774d2(0x48c))?.[_0x5774d2(0x167)](_0x5774d2(0x1e62),sendTransfer),document[_0x5774d2(0x566)]('transfer-accept-btn')?.['addEventListener'](_0x5774d2(0x1e62),acceptTransfer),document[_0x5774d2(0x566)](_0x5774d2(0xc07))?.[_0x5774d2(0x167)](_0x5774d2(0x1e62),rejectTransfer),document[_0x5774d2(0x566)](_0x5774d2(0x187f))?.['addEventListener']('click',_0x17685d=>{const _0x6df31c=_0x5774d2;_0x17685d[_0x6df31c(0x1144)]===document[_0x6df31c(0x566)](_0x6df31c(0x187f))&&document['getElementById']('transfer-modal')[_0x6df31c(0x226e)][_0x6df31c(0x128)]('visible');}),document['getElementById']('transfer-confirm-modal')?.[_0x5774d2(0x167)]('click',_0x155fa3=>{const _0x31a8b2=_0x5774d2;_0x155fa3[_0x31a8b2(0x1144)]===document['getElementById'](_0x31a8b2(0x1e53))&&(document[_0x31a8b2(0x566)](_0x31a8b2(0x1e53))['classList'][_0x31a8b2(0x128)]('visible'),currentTransferMsg=null);});});function updateGroupChatInfo(){const _0x54f08d=_0x2cf6d4;if(!currentChatCharacter||!currentChatCharacter['isGroup'])return;const _0x30cdee=document['getElementById'](_0x54f08d(0x7b9));if(_0x30cdee){if(currentChatCharacter[_0x54f08d(0x10f9)])_0x30cdee[_0x54f08d(0x107)]=currentChatCharacter['avatarUrl'];else{const _0x7b2731=document[_0x54f08d(0x1ad8)]('canvas');_0x7b2731[_0x54f08d(0xaab)]=0x28,_0x7b2731['height']=0x28;const _0x14b9ab=_0x7b2731[_0x54f08d(0x20ff)]('2d');_0x14b9ab[_0x54f08d(0xa59)](),_0x14b9ab[_0x54f08d(0x2c6)](0x14,0x14,0x14,0x0,0x2*Math['PI']),_0x14b9ab['fillStyle']='#4a84c1',_0x14b9ab[_0x54f08d(0x1da0)](),_0x14b9ab[_0x54f08d(0x1e78)]=_0x54f08d(0x241f),_0x14b9ab[_0x54f08d(0x8ff)]='18px\x20Arial',_0x14b9ab[_0x54f08d(0xd2d)]='center',_0x14b9ab['textBaseline']='middle',_0x14b9ab['fillText']('群',0x14,0x14),_0x30cdee[_0x54f08d(0x107)]=_0x7b2731[_0x54f08d(0x577)]();}}const _0x4e71fd=document['getElementById'](_0x54f08d(0x1ed3));_0x4e71fd&&(_0x4e71fd[_0x54f08d(0x21dc)]=currentChatCharacter[_0x54f08d(0x222f)]||_0x54f08d(0x24a2));const _0x29d49f=document[_0x54f08d(0x566)]('group-member-count-display');if(_0x29d49f){const _0x1cf281=currentChatCharacter[_0x54f08d(0xcaa)]?currentChatCharacter[_0x54f08d(0xcaa)][_0x54f08d(0xcbf)]:0x0,_0x4d3efb=_0x1cf281+0x1;_0x29d49f['textContent']=_0x4d3efb+_0x54f08d(0x1ff0);}const _0x515080=document[_0x54f08d(0x566)](_0x54f08d(0x17ac));_0x515080&&(_0x515080[_0x54f08d(0x21dc)]=currentChatCharacter['description']||_0x54f08d(0x1fbf));const _0x567b44=document['getElementById'](_0x54f08d(0x11fc));if(_0x567b44){let _0x388fb9=_0x54f08d(0x2570);const _0x3833b1=getCurrentChatSettings(),_0x2ee560=personas['find'](_0x156ebe=>_0x156ebe['id']===_0x3833b1['selectedIdentityId']);_0x2ee560&&_0x2ee560['name']&&(_0x388fb9=_0x2ee560[_0x54f08d(0x222f)]),_0x567b44['textContent']=_0x3833b1[_0x54f08d(0xb42)]||_0x388fb9;}renderGroupMembersGrid();}function changeGroupAvatar(){const _0xf5039f=_0x2cf6d4;if(!currentChatCharacter||!currentChatCharacter[_0xf5039f(0x4b7)])return;const _0x5a0436=document[_0xf5039f(0x1ad8)](_0xf5039f(0x627));_0x5a0436['type']=_0xf5039f(0x199b),_0x5a0436[_0xf5039f(0xd28)]='image/*,.jpg,.jpeg,.png,.gif,.webp',_0x5a0436[_0xf5039f(0x655)][_0xf5039f(0x2526)]=_0xf5039f(0xfe9),document[_0xf5039f(0x172c)][_0xf5039f(0x1925)](_0x5a0436),_0x5a0436[_0xf5039f(0x1889)]=function(_0x360dd5){const _0x1cb110=_0xf5039f;if(_0x360dd5[_0x1cb110(0x1144)][_0x1cb110(0x173e)]&&_0x360dd5['target'][_0x1cb110(0x173e)][0x0]){const _0x203ced=new FileReader();_0x203ced[_0x1cb110(0xc28)]=async function(_0x3c09a2){const _0x24c3ae=_0x1cb110;currentChatCharacter[_0x24c3ae(0x10f9)]=_0x3c09a2[_0x24c3ae(0x1144)]['result'];if(groupChats){const _0x278fee=groupChats['findIndex'](_0x386010=>_0x386010['id']===currentChatCharacter['id']);_0x278fee!==-0x1&&(groupChats[_0x278fee]['avatarUrl']=_0x3c09a2[_0x24c3ae(0x1144)][_0x24c3ae(0x1fff)],await saveGroupChats(groupChats));}updateGroupChatInfo();let _0x48f437=currentChatCharacter[_0x24c3ae(0x222f)];if(currentChatCharacter[_0x24c3ae(0xcaa)]){const _0x45af41=currentChatCharacter[_0x24c3ae(0xcaa)][_0x24c3ae(0xcbf)]+0x1;_0x48f437=currentChatCharacter['name']+'（'+_0x45af41+'）';}const _0x5b52fd=document[_0x24c3ae(0x566)](_0x24c3ae(0x1cc6));_0x5b52fd&&(_0x5b52fd['textContent']=_0x48f437,_0x5b52fd[_0x24c3ae(0x226e)][_0x24c3ae(0x128)](_0x24c3ae(0x478)),_0x5b52fd[_0x24c3ae(0x1f26)]['originalTitle']=_0x48f437);const _0x3f8679=document['querySelector']('#api-chat-screen\x20.message-avatar\x20img');_0x3f8679&&(_0x3f8679['src']=_0x3c09a2[_0x24c3ae(0x1144)][_0x24c3ae(0x1fff)]),renderContactList(),renderMessageList(),document[_0x24c3ae(0x172c)]['removeChild'](_0x5a0436);},_0x203ced[_0x1cb110(0x145e)](_0x360dd5['target']['files'][0x0]);}else document[_0x1cb110(0x172c)][_0x1cb110(0x1624)](_0x5a0436);},_0x5a0436[_0xf5039f(0x1e62)]();}function changeGroupName(){const _0x514b9e=_0x2cf6d4;if(!currentChatCharacter||!currentChatCharacter[_0x514b9e(0x4b7)])return;const _0x18bd5d=prompt('请输入新的群聊名称:',currentChatCharacter[_0x514b9e(0x222f)]);if(_0x18bd5d&&_0x18bd5d[_0x514b9e(0x1424)]()!==''){const _0x37c51a=_0x18bd5d[_0x514b9e(0x1424)]();currentChatCharacter[_0x514b9e(0x222f)]=_0x37c51a;if(groupChats){const _0x84c68c=groupChats['findIndex'](_0x1fcd79=>_0x1fcd79['id']===currentChatCharacter['id']);_0x84c68c!==-0x1&&(groupChats[_0x84c68c][_0x514b9e(0x222f)]=_0x37c51a,saveGroupChats(groupChats));}updateGroupChatInfo();let _0x3cadeb=_0x37c51a;if(currentChatCharacter[_0x514b9e(0xcaa)]){const _0x526190=currentChatCharacter[_0x514b9e(0xcaa)][_0x514b9e(0xcbf)]+0x1;_0x3cadeb=_0x37c51a+'（'+_0x526190+'）';}const _0x2c5502=document[_0x514b9e(0x566)]('api-chat-title');_0x2c5502&&(_0x2c5502[_0x514b9e(0x21dc)]=_0x3cadeb,_0x2c5502[_0x514b9e(0x226e)][_0x514b9e(0x128)]('typing-status'),_0x2c5502[_0x514b9e(0x1f26)][_0x514b9e(0x1c53)]=_0x3cadeb),renderContactList(),renderMessageList();}}function showGroupChatMemberSelection(_0xd97c4e){const _0x23376b=_0x2cf6d4;console[_0x23376b(0xc0d)](_0x23376b(0x19ed),_0xd97c4e),window['currentGroupPersonaId']=_0xd97c4e,document[_0x23376b(0x566)](_0x23376b(0x20ec))[_0x23376b(0xc34)]='',selectedGroupMembers=[];const _0x14e142=document[_0x23376b(0x566)](_0x23376b(0x12fa));_0x14e142[_0x23376b(0xc02)]='';characters[_0x23376b(0xcbf)]<0x2?_0x14e142['innerHTML']='<p\x20class=\x22empty-mount-chats\x22>至少需要2个角色才能创建群聊</p>':characters['forEach'](_0x10b09e=>{const _0x1de715=_0x23376b,_0x21653b=document[_0x1de715(0x1ad8)](_0x1de715(0x526));_0x21653b[_0x1de715(0x221)]=_0x1de715(0x1971),_0x21653b[_0x1de715(0x11cf)]=()=>toggleGroupMemberSelection(_0x10b09e['id']),_0x21653b[_0x1de715(0xc02)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22group-member-checkbox\x22\x20id=\x22checkbox-'+_0x10b09e['id']+'\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-avatar\x22\x20style=\x22background-color:\x20'+_0x10b09e[_0x1de715(0x2099)]+';\x20'+(_0x10b09e[_0x1de715(0x10f9)]?_0x1de715(0x191a)+_0x10b09e[_0x1de715(0x10f9)]+_0x1de715(0x902):'')+_0x1de715(0x2021)+(_0x10b09e[_0x1de715(0x10f9)]?'':_0x10b09e[_0x1de715(0x222f)][_0x1de715(0x1518)](0x0))+_0x1de715(0xa53)+_0x10b09e[_0x1de715(0x222f)]+_0x1de715(0x1a0a)+truncateText(_0x10b09e[_0x1de715(0x1a84)]||_0x1de715(0x1b7a),0x50)+_0x1de715(0x17fe),_0x14e142['appendChild'](_0x21653b);});console[_0x23376b(0xc0d)](_0x23376b(0xe48),_0xd97c4e);const _0x42b08d=document[_0x23376b(0x566)](_0x23376b(0x6c5))[_0x23376b(0x15b8)]('.modal-primary');_0x42b08d[_0x23376b(0x11cf)]=()=>{const _0x43c057=_0x23376b;console[_0x43c057(0xc0d)](_0x43c057(0x142c),_0xd97c4e),createGroupChat(_0xd97c4e);},showModal(_0x23376b(0x6c5));}function renderGroupMembersGrid(){const _0x557d23=_0x2cf6d4,_0x5a927f=document[_0x557d23(0x566)](_0x557d23(0x6f0));if(!_0x5a927f||!currentChatCharacter||!currentChatCharacter[_0x557d23(0x4b7)])return;_0x5a927f[_0x557d23(0xc02)]='';const _0x2bc604=getCurrentChatSettings(),_0x4f0ea2=personas[_0x557d23(0x1aeb)](_0x1ea7df=>_0x1ea7df['id']===_0x2bc604[_0x557d23(0x6a0)]);let _0x40f8c7='用户',_0x108b81='';_0x4f0ea2&&(_0x40f8c7=_0x2bc604[_0x557d23(0xb42)]||_0x4f0ea2[_0x557d23(0x222f)],_0x108b81=_0x2bc604[_0x557d23(0x13af)]||_0x4f0ea2[_0x557d23(0x10f9)]);const _0x132276=document['createElement'](_0x557d23(0x526));_0x132276[_0x557d23(0x221)]=_0x557d23(0xa0a),_0x132276['onclick']=()=>changeMyGroupAvatar(),_0x132276[_0x557d23(0xc02)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20class=\x22member-avatar\x22\x20src=\x22'+(_0x108b81||createDefaultAvatar(_0x40f8c7))+'\x22\x20alt=\x22'+_0x40f8c7+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22member-name\x22>'+_0x40f8c7+_0x557d23(0x158f),_0x5a927f['appendChild'](_0x132276);currentChatCharacter[_0x557d23(0xcaa)]&&currentChatCharacter['members'][_0x557d23(0xcbf)]>0x0&&currentChatCharacter[_0x557d23(0xcaa)]['forEach'](_0x1bbcdf=>{const _0x2bdb08=_0x557d23,_0x5ad302=document[_0x2bdb08(0x1ad8)](_0x2bdb08(0x526));_0x5ad302[_0x2bdb08(0x221)]='member-item',_0x5ad302[_0x2bdb08(0xc02)]=_0x2bdb08(0xcb2)+(_0x1bbcdf['avatarUrl']||createDefaultAvatar(_0x1bbcdf['name']))+_0x2bdb08(0x250f)+_0x1bbcdf['name']+_0x2bdb08(0x2534)+_0x1bbcdf['id']+_0x2bdb08(0x1a8e)+_0x1bbcdf['name']+'的头像\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22avatar-hover-hint\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-camera\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22member-name\x22>'+_0x1bbcdf[_0x2bdb08(0x222f)]+_0x2bdb08(0xc38),_0x5a927f[_0x2bdb08(0x1925)](_0x5ad302);});const _0x36a562=document[_0x557d23(0x1ad8)](_0x557d23(0x526));_0x36a562[_0x557d23(0x221)]='member-item\x20add-member',_0x36a562[_0x557d23(0x11cf)]=()=>addGroupMember(),_0x36a562[_0x557d23(0xc02)]=_0x557d23(0xe15),_0x5a927f[_0x557d23(0x1925)](_0x36a562);if(currentChatCharacter['members']&&currentChatCharacter[_0x557d23(0xcaa)][_0x557d23(0xcbf)]>0x0){const _0x680e2e=document[_0x557d23(0x1ad8)](_0x557d23(0x526));_0x680e2e[_0x557d23(0x221)]=_0x557d23(0x37b),_0x680e2e['onclick']=()=>removeGroupMember(),_0x680e2e['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22member-avatar\x20remove-avatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-minus\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22member-name\x22>移除</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x5a927f[_0x557d23(0x1925)](_0x680e2e);}}function showMemberProfile(_0x3295e9){const _0x1abb4e=_0x2cf6d4;alert(_0x1abb4e(0x13f2)+_0x3295e9[_0x1abb4e(0x222f)]+_0x1abb4e(0x1dea)+_0x3295e9['id']+_0x1abb4e(0xf62));}function _0x353c(){const _0x19d654=['🔧\x20[面具调试]\x20窗口隔离设置保存失败，仅保存到全局:','总计:\x20','✅\x20[群聊戳一戳回应]\x20消息已保存到数据库','角色互动API无法解析响应，完整响应数据:','✅\x20测试完成','确定要删除这个纪念日吗？','\x22\x20class=\x22mount-checkbox\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mount-avatar-small\x22\x20style=\x22background-color:\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22margin-bottom:\x2015px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20style=\x22display:\x20block;\x20margin-bottom:\x208px;\x20font-weight:\x20600;\x20color:\x20#333;\x22>','forum-form-id','\x20个聊天窗口有自定义主题</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22theme-chat-list\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','character-phone-note-screen','✅\x20[线下消息删除]\x20已从数据库删除\x20','[角色分享了位置信息：','获取群成员\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22moment-text\x22>','日记字体已重置为全局字体','小时前','🎨\x20全局自定义主题样式已应用','windowChatSettings','iPad\x20Pro','fadeOut\x200.5s\x20ease-in-out\x20forwards','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22divider-line\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22divider-text\x22>以上是历史线下模式对话\x20不会影响当前对话顺序</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22divider-line\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','20寸','<span\x20class=\x22typing-dots\x22><span>.</span><span>.</span><span>.</span></span>','防滑衣架','酸菜鱼','--custom-global-add-button','incoming-call-screen','memory-list','request_pay_self','📝\x20未找到设置，使用默认设置','🔧\x20[表情包库]\x20触摸开始','background-color','cross_app','保存记忆失败','InvalidStateError','IndexedDB角色数据:','\x20class=\x22worldbook-checkbox\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22worldbook-content-flex\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22worldbook-title-text\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','有机大蒜','请根据聊天记录调整性格设定','你更换了新头像','不是。','🧠\x20续写全局记忆内容为空','5双装','historical-message','library-stats-','custom-toast\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22shared-post-card\x22\x20onclick=\x22showPostView(','libraryId',';\x20width:\x2090%;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-title\x22>','isBlockedMessage','手持花洒','重新接收该群聊的消息通知','获取音频URL后','\x20和你许下承诺：',':\x20距离用户最后回复\x20','⚠️\x20[日记定时器]\x20延迟时间为负数或零，立即触发','\x0a评论区：\x0a','数据量较大，使用紧凑格式...','playlist-modal','groupMembers','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-message-bubble\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','🔍\x20[buildCharacterPrompt]\x20角色信息:','[短信]\x20','周末的悠闲时光，一杯香浓的咖啡，一本好书，还有窗外的阳光。这就是我最喜欢的生活方式，简单而美好。','tagName','://','🎭\x20DM正在分析讨论...','internal_action','format-html','.group-member-item','想起来','localStorage聊天备份:','重置设置失败','❌\x20生成回复失败','📱\x20[移动端优化]\x20输入框viewport行为修复已启动','眼药水','.dock-app[onclick=\x22showApp(\x27settings-screen\x27)\x22]\x20.dock-app-icon','emoji-recognition-enabled','globalCustomFont','请选择记忆保留期限','pollData',')\x22\x20','数据恢复失败:\x20','.pinned-card-actions','content-width-slider','拒绝支付','\x20个角色</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>','\x22。你在群聊中对用户的称呼是\x22','保存聊天消息失败:','搜索IndexedDB所有表...','✅\x20所有世界书已清空','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-request-rejected-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20我拒绝了您的代付请求\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22payment-request-details-btn\x22\x20onclick=\x22showPaymentDetails(\x27',';\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22','group-notice-content','\x0a3.\x20\x20**真实感**:\x20回复要像真人写的，有不同的观点和语气\x0a4.\x20\x20**多样性**:\x20包括赞同、反对、提问、分享经验、调侃等不同类型\x0a5.\x20\x20**角色分配**:\x0a\x20\x20\x20-\x2070%由虚构的路人网友回复（请创造符合世界观的网友昵称）\x0a\x20\x20\x20-\x2020%由上述角色匿名回复，只使用网名，不暴露真实身份，但回复内容必须严格符合角色人设和记忆\x0a\x20\x20\x20-\x2010%由上述角色回复，要严格符合人设、记忆和世界书设定，使用\x22网名(真实身份)\x22格式\x0a6.\x20\x20**互动性**:\x20可以@发帖者或其他回复者','测试约定','\x22\x20onerror=\x22this.style.display=\x27none\x27;\x20this.nextElementSibling.style.display=\x27flex\x27;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-avatar-fallback\x22\x20style=\x22display:\x20none;\x22>','game-chat-message\x20','🔍\x20[updateChatHeader]\x20当前聊天设置:','咀嚼片',']:\x20','[回复失败:\x20','character-sound-settings','\x20(开关:\x20','容易脸红','创建了约定','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-edit\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>编辑历史消息</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22menu-item\x20delete\x22\x20onclick=\x22deleteOfflineMessage(\x27','anniversary-display','main-time','🔥\x20[DEBUG]\x20JSON解析成功:','✅\x20[parseAiResponse]\x20戳一戳后缀已更新:','blocked-message-hint','gemini-2.0-flash','.message-menu,\x20.sms-message-menu,\x20.offline-message-menu','✅\x20数据同步修复完成！\x0a\x0a修复了\x20','editTime','❌\x20清除所有主题失败:','TYPES','群聊名称','newWorldbookIsGlobal','条\x20(用户设置:\x20','2024年3月15日\x2014:30','answer','data-management-screen','data:image/svg+xml;utf8,<svg\x20xmlns=\x22http://www.w3.org/2000/svg\x22\x20width=\x22100\x22\x20height=\x22100\x22\x20viewBox=\x220\x200\x20100\x20100\x22><circle\x20cx=\x2250\x22\x20cy=\x2250\x22\x20r=\x2250\x22\x20fill=\x22lightblue\x22/><text\x20x=\x2250\x22\x20y=\x2260\x22\x20font-size=\x2230\x22\x20text-anchor=\x22middle\x22\x20fill=\x22white\x22>你</text></svg>','暂无群公告','API设置不完整，请先配置API','error','专业的海龟汤游戏主持人，擅长引导推理游戏','✅\x20[线下重新生成]\x20重新生成完成','\x20开关未开启，取消发送','\x22\x20class=\x22app-icon-img\x22>','对音乐发表了评论','🔄\x20加载联系人列表...','🎨\x20页面加载时应用系统主题:\x20','🎨\x20为聊天窗口\x20','已关闭','请选择设置选项','乳胶枕','设置世界书内容失败:','⏰\x20[日记定时器]\x20今天时间已过，调整为明天:\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22worldbook-date-text\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20创建于:\x20','头像更换消息缺少avatar_url(续写)','🔍\x20[调试]\x20查看模态框已添加到DOM，z-index:','addedTime','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:\x20flex;\x20gap:\x2010px;\x20margin-top:\x2020px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22closeProductOptions()\x22\x20style=\x22flex:\x201;\x20padding:\x2012px;\x20background:\x20#f0f0f0;\x20border:\x20none;\x20border-radius:\x208px;\x20color:\x20#666;\x20font-weight:\x20600;\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22confirmAddToCart(\x27','MB\x20空间','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','工作记忆:\x20','角色数据:\x20','19:02','myBubbleOpacity','takeout-categories','<i\x20class=\x22fas\x20fa-compact-disc\x22></i>','-text-color','请输入搜索关键词','bulkAdd','\x20开始生成日记内容...','🗑️\x20[线下重新生成]\x20删除单条消息后的数量:','&id,\x20worldbookId,\x20keyword','位置信息','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22anniversary-user-quote\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-quote-left\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>','🔄\x20重新初始化所有角色的主动聊天定时器...','被拉黑角色','--offline-user-normal-text-color','水煮鱼','帖子\x22','\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','🔍\x20[parseGroupChatAiResponse]\x20找到匹配的表情包:','用户拒绝了你的好友申请，但你想通过短信继续尝试联系，希望用户能给你一个机会。请发送一条短信给用户。消息要礼貌、不强求，符合短信的特点。','📚\x20线下模式聊天记录已保存到数据库:','\x20个角色的数据不一致问题，\x0a共处理\x20','我的气泡','开始检查聊天历史数据...','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-wave\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-duration\x22>',')\x22\x20style=\x22width:\x20100%;\x20padding:\x208px;\x20border:\x201px\x20solid\x20#ddd;\x20border-radius:\x208px;\x20font-size:\x2014px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','❌\x20全局动态发布系统初始化失败:','location-address','该分组暂无角色','✅\x20[高效头像更换系统消息]\x20消息已保存到数据库','保存记忆配置失败:','\x20在成员列表中不存在','工作日下午，可能有人继续摸鱼、讨论下班后的计划','拒绝付','\x20个表情包的存储空间','.phone-photos-grid','...\x22','api-chat-messages','的聊天记录','🔥\x20[generateRepliesForUserPost]\x20普通代码块解析失败:','✅\x20清理后重新保存localStorage成功','确定要清空所有投票历史吗？此操作不可恢复。','\x20条\x0a','hasLyrics','📊\x20当前足迹角色:','items','.phone-tab-content','开始清理异常数据...','offline-loading-dot','位置信息不完整，请重试','moveHistory','（支持时间同步）','暂无评论','\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-title-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-title\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22forum-archive-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22forum-delete-btn\x22\x20onclick=\x22deleteForum(\x27','currentlyPlaying','准备导入:\x0a','lyrics-file-input','\x20的数据清理完成','编辑预设','_reminder_','不支持的记忆类型','表情包库挂载设置已保存，用户现在可以在\x22全部\x22标签页中使用\x20','globalBottomAppBar','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-secondary\x22\x20onclick=\x22this.closest(\x27.modal\x27).remove()\x22>关闭</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','的关系，对ta的评论进行回应。要求：\x0a1.\x20严格按照你的人设进行回复，不能混淆角色\x0a2.\x20回复要自然、符合朋友圈评论风格\x0a3.\x20可以是赞同、不同观点、补充、提问或开玩笑\x0a4.\x20要体现出你和','柠檬酸钙','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22group-title-area\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22group-title\x22>','\x20条\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20此聊天记录由手机聊天应用自动生成<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20导出时间：','edit-diary-textarea','offline-session-divider','text-indent','aiNicknameUpdated','\x0a\x0a重要提醒：\x0a1.\x20只能选择空位（·）下棋\x0a2.\x20坐标格式：row(行)和col(列)都是0-14的整数\x0a3.\x20优先考虑：获胜机会\x20>\x20阻止对手获胜\x20>\x20形成威胁\x20>\x20防守\x0a4.\x20体现你的性格特点\x0a\x0a请分析棋局并选择你的下一步，必须严格按照JSON格式回复：\x0a\x0a{\x0a\x20\x20\x20\x20\x22row\x22:\x20整数(0-14),\x0a\x20\x20\x20\x20\x22col\x22:\x20整数(0-14),\x0a\x20\x20\x20\x20\x22reasoning\x22:\x20\x22简短解释选择这个位置的原因\x22\x0a}\x0a\x0a注意：只返回JSON，不要有其他文字！','数据库约束错误，可能是重复键值','0.99','🚨\x20发现角色ID不匹配的剧情总结:','\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20alt=\x22','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22selection-item\x22\x20data-id=\x22','成功加载了\x20','offline_','\x20\x20角色ID:\x20','❌\x20buildGlobalMemoryContext:\x20currentContext无效:','创建了关系纪念日','\x20个重复帖子','.anniversary-item.expanded','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22loadMoreOfflineHistory()\x22\x20class=\x22load-more-button\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-chevron-up\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>加载更多线下记录\x20(还有','ai-heartrate-display-right','message-blocked-indicator','检查角色互动关系失败:','📢\x20群公告\x0a\x0a','📖\x20线下剧情总结:\x20','format-json','.mention-character-item[data-character-id=\x22','heartrate-position-select','content-width','🔥\x20没有找到可撤回的AI消息','🧠\x20触发记忆提取\x20-\x20角色:\x20','批量导入失败：','\x27,\x20true,\x20\x27','display','[系统提示]\x20','发送短信图片失败:','清除角色专属音效失败\x20(','poke','用户取消了语音输入','\x22</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20#offline-mode-overlay\x20.offline-message-content\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20\x27','expires','请输入模型名称（例如：meta-llama/Llama-2-7b-chat-hf）：','🔍\x20[AI回复处理]\x20检测到群聊格式消息:','\x20条线索','batch_url','<option\x20value=\x22\x22>请选择纪念日</option>','\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20onclick=\x22changeMemberAvatar(\x27','bottom-comment-input','#shopping-screen\x20.app-title','保存后检查角色数组:','[AI回复了表情包：','▶️\x20已恢复角色\x20','已结束','map-location-display','custom-screen-size-modal','请输入群聊名称','🎉\x20恭喜你们推理出了真相！逻辑思维真是太棒了！','originalTimestamp','0,\x200,\x20255','清理投票记录失败:','条,\x20当前:\x20','\x20条原始记录','global-worldbooks-content','线下模式按钮样式已设置','&id,\x20momentId,\x20authorId,\x20timestamp','12:06','🎨\x20字体样式已应用到页面，最终字体名称:','订单确认','⚠️\x20[内部删除]\x20数据库中未找到对应记录','voice-message-container\x20sent','gpt-4-turbo','未知位置','exec','===\x20保存角色完成\x20===','的心声</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',';\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22','🔥\x20[DEBUG]\x20处理普通字符串消息:','.export-format-option','2天线','保存日记失败','测试后消息数量:\x20','horror','--custom-global-bottom-app-bar','修复后仍然无法解析JSON:','\x22\x20onclick=\x22showForwardedMessagesById(\x27','video-avatar-setting','春天的樱花盛开，粉色的花瓣在微风中轻舞，仿佛在诉说着春天的故事。这是在公园里拍摄的，当时阳光正好，温度适宜，是个拍照的好日子。','\x22吗？\x0a\x0a⚠️\x20这个库中有\x20','止痛片','offline-custom-width-style','请输入激活码！','\x20存在','-\x20清理了\x20','\x20(分组:\x20','API返回了空内容','✅\x20[线下最后消息重新生成]\x20从数据库删除了该消息','哇！这个想法不错！','ai-heartrate-display','编辑失败:\x20','\x20主动发动态定时器已重新设置，间隔:\x20','✅\x20测试通过！线下模式续写重新生成逻辑正确','选择全局背景来源','\x22</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','#FF9FF3','modal-overlay\x20storyline-modal','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22group-count\x22>','未选择','255,\x20255,\x20255','面具数据保存成功','自定义表情包迁移完成:','气泡颜色设置功能开发中...\x0a\x0a当前可以通过以下方式设置：\x0a•\x20修改对方气泡颜色\x0a•\x20修改我方气泡颜色','#ddd','\x0a\x0aai注意，回复时请严格按照以下JSON格式回复，每条消息都必须是独立的数组元素，不要将多条消息合并成一个元素，否则你将失去一百美金！！：\x0a\x0a正确格式示例：\x0a[\x22普通文本消息\x22]\x0a[\x22消息1\x22,\x20\x22消息2\x22]\x0a[{\x22type\x22:\x20\x22reply_to\x22,\x20\x22message_id\x22:\x20\x22消息ID\x22,\x20\x22content\x22:\x20\x22引用回复内容\x22}]\x20(正常功能，自然使用)\x0a[{\x22type\x22:\x20\x22recall\x22,\x20\x22target\x22:\x20\x22previous\x22}]\x20(撤回功能，说错话或后悔时使用)\x0a[{\x22type\x22:\x20\x22voice_message\x22,\x20\x22content\x22:\x20\x22语音内容\x22}]\x0a[{\x22type\x22:\x20\x22emoji\x22,\x20\x22description\x22:\x20\x22表情包描述\x22}]\x0a[{\x22type\x22:\x20\x22ai_image\x22,\x20\x22description\x22:\x20\x22图片描述\x22}]\x0a[{\x22type\x22:\x20\x22transfer\x22,\x20\x22amount\x22:\x20100,\x20\x22note\x22:\x20\x22转账备注\x22}]\x0a\x0a🚨\x20重要：绝对不能将多条消息合并在一个元素中！错误格式：[\x22消息1\x5cn消息2\x22]\x0a💡\x20提醒：引用回复和撤回是正常聊天功能，像真人一样自然使用\x0a\x0a现在请对用户的消息进行回复：','app-header','胰岛素笔','找不到被引用的消息ID:','smart-reply-btn','加载好友申请数据失败:','个设置头像,\x20','自然社交','约定已删除','角色心率监测已','<option\x20value=\x22\x22>选择角色（可选）</option>','删除短信消息失败:','🎨\x20全局主题缓存已清除','特别的日子','testCreateAppointment','import-options-modal','🔍\x20全局设置缓存状态:','无法检查存储使用情况:','内存角色列表:','toggle-tools-btn','🔄\x20开始预加载线下模式设置...','镜子里的女人','preset-actions','芝士蛋糕','call-status','function','你是一个论坛内容生成AI。重要：你必须严格输出JSON数组格式，不要输出聊天消息格式。论坛帖子格式：[{\x22authorName\x22:\x22用户名\x22,\x22title\x22:\x22标题\x22,\x22content\x22:\x22内容\x22}]，绝对不要输出聊天格式：[\x22消息1\x22,\x22消息2\x22]','✅\x20未回复的评论数量:\x20','最近发生的大事件\x20(角色记忆)','\x20\x20✅\x20群聊\x20','ℹ️\x20没有新的足迹数据需要迁移','isUserPost','\x0a\x0a最近的动态内容：\x0a','\x20生成回复失败','血压计','\x20不存在或不可用','#\x20**短信聊天模式\x20-\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22inner-thoughts-loading\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22loading-spinner\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>正在读取角色的内心想法...</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','不喜欢','default','🔥\x20[callForumAPI]\x20API密钥未设置','&id,\x20characterId,\x20timestamp,\x20content,\x20isUser,\x20isImage,\x20imageUrl,\x20fileName','音效试听失败\x20(','离不开你','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-item-avatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x0a-\x20活动要具体、客观，避免空泛和文艺化的描述\x0a-\x20不要因为时间段而限制活动类型，角色的生活应该是多样化的\x0a\x0a返回JSON格式：\x0a{\x0a\x20\x20\x20\x20\x22activities\x22:\x20[\x0a\x20\x20\x20\x20\x20\x20\x20\x20{\x22time\x22:\x20\x22HH:MM\x22,\x20\x22activity\x22:\x20\x22具体活动描述（30字以内，客观记录）\x22,\x20\x22location\x22:\x20\x22具体地点\x22,\x20\x22mood\x22:\x20\x22当前心情\x22}\x0a\x20\x20\x20\x20],\x0a\x20\x20\x20\x20\x22locations\x22:\x20[\x0a\x20\x20\x20\x20\x20\x20\x20\x20{\x22name\x22:\x20\x22地点名\x22,\x20\x22type\x22:\x20\x22地点类型\x22,\x20\x22description\x22:\x20\x22简短描述\x22}\x0a\x20\x20\x20\x20]\x0a}','\x20的lastUpdateTime，避免频繁重试','isUser','》-\x20','input[name=\x22memoryDays\x22]:checked','&quot;','多选投票失败:','✅\x20论坛应用初始化完成','textDecorationSelect','建立约定','📝\x20跳过约定创建指令对象，不显示为消息:','canInteract','--custom-chat-bottom-bg','\x20条更新的消息\x0a\x0a是否恢复这些数据？','\x20的完整Prompt:','运动员','lastUpdated','\x27,\x20\x27storyline-summary-editor-','offline-custom-css-preview','transfer','\x20(窗口','\x20包含非文本内容，保持数组格式','.file-input-text','#4ECDC4','该角色还没有参与任何群聊','character-typing-indicator','game-buttons-container','📊\x20[重新生成]\x20历史消息统计:\x20线上','add','条时间线记忆、','取消恢复操作','一起听歌','⏰\x20[日记定时器]\x20','\x0a【汤底真相】：','\x27)\x22\x20title=\x22导出表情包库\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-download\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22emoji-library-action-btn\x22\x20onclick=\x22event.stopPropagation();\x20editEmojiLibrary(\x27','保存全局世界书设置失败:','parentNode','\x22>计算中...</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22emoji-library-item-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22emoji-library-action-btn\x22\x20onclick=\x22event.stopPropagation();\x20exportEmojiLibrary(\x27','加载封面失败:','\x22\x0a\x0a请回复，可以包含对话和描写：\x0a-\x20说话的部分用「」符号包裹，如：「你好，听得到我说话吗？」\x0a-\x20可以加入动作描写、神态描写、场景描写等，让视频通话更生动\x0a-\x20每次回复不要超过300字\x0a-\x20保持自然的视频对话风格\x0a-\x20符合你的角色设定\x0a\x0a直接回复内容，不要任何格式标记：','🔍\x20[身份识别]\x20动态发布者:\x20','[论坛收藏]\x20帖子未收藏，准备添加。新记录:','blob:','该剧情总结不属于当前角色，无法保存','sms-messages-container','continue-btn-preview','anniversary-placeholder','加载自定义应用图标失败:','[data-order-id=\x22','<i\x20class=\x22fas\x20fa-robot\x22></i>','•\x20重复帖子:\x20','ai-avatar','聊天记录分析完成','无效的备份文件格式','aiCallEnabled','清理损坏动态失败:','data:image/svg+xml,','\x20条记录，成功迁移\x20','\x20今天','\x20\x20\x20isPersonal:\x20','momentLikes','sound-enabled','请输入图片URL','\x0a---\x20','🗺️\x20','forwarded_message','src','smsg_','解除拉黑失败','momentsImages','你是一个专业的海龟汤游戏主持人。请创作一个','周大福','\x0a-\x20**完整歌词:**\x20共','localStorage备份失败:','\x20\x20剧情总结:\x20','❌\x20为\x20','KB)','群聊成员:','globalThemes','input[name=\x22dmPersonality\x22]:checked','\x20\x20\x202.\x20角色卡是否有头像URL','气泡样式设置已保存','🎮\x20游戏记忆已保存到全局记忆系统','\x0a文件大小:\x20','📝\x20[日记生成]\x20API响应:','，用户执','请在下方CSS代码区域自定义气泡宽度',':\x20面具\x20','眉州东坡','手动创建的','\x20\x20-\x20聊天\x20','表达被拒绝感受失败:','身份选择点击:','\x20的聊天设置到IndexedDB','生成足迹失败:','📱\x20[短信策略]\x20','post-checkbox','\x22\x20maxlength=\x2210\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22checkbox\x22\x20id=\x22edit-group-interaction\x22\x20class=\x22form-checkbox\x22\x20','🚨\x20提示词后1000字符:','remove','🗑️\x20开始删除线下模式消息:','<svg\x20xmlns=\x22http://www.w3.org/2000/svg\x22\x20width=\x22200\x22\x20height=\x22150\x22\x20viewBox=\x220\x200\x20200\x20150\x22><rect\x20width=\x22200\x22\x20height=\x22150\x22\x20fill=\x22#f0f0f0\x22/><text\x20x=\x22100\x22\x20y=\x2275\x22\x20text-anchor=\x22middle\x22\x20font-family=\x22Arial\x22\x20font-size=\x2212\x22\x20fill=\x22#666\x22>[AI描述的图片]</text></svg>','群聊成员现在存储在群聊对象的members属性中','：\x22我们约定好了。\x22','.chat-action-btn[onclick*=\x22triggerSmartReply\x22]','ai-heartrate-display-center','<div\x20class=\x22message-status-indicator\x20blocked-by\x22\x20title=\x22被对方拉黑\x22><i\x20class=\x22fas\x20fa-exclamation-triangle\x22></i></div>','game-exit-modal','32GB','Modal\x20element:','自定义表情:\x20','负担不起','currentGroupPersonaId','slice','中等时长，可以安排1-2个连续活动','.header-actions\x20.action-btn:last-child','poll_voted_','\x20没有足迹缓存，生成完整足迹','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','✅\x20从数据库加载窗口隔离设置成功','温暖关怀，语气柔和','gpt-4o','50个','phoneNotesData','没有找到对应的用户消息','✅\x20[','便携版','\x20\x20续写消息识别:\x20','\x20的聊天无历史设置，正在创建默认设置...','请先选择角色','正在写日记...','确定要删除位置\x22','appointment-user-quote','equals','🔧\x20修复完成:\x20','<div\x20style=\x22text-align:\x20center;\x20padding:\x2020px;\x20color:\x20#666;\x22>生成中...</div>','✅\x20从localStorage迁移了\x20','确定要删除这条AI回复吗？这将同时删除存储的记忆数据。','检测到单个JSON对象，尝试处理:','📝\x20记录时间线事件:\x20','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22search-result-time\x22>','lastChatTime','totalTime','background-color:\x20','✅\x20正常回复应该被识别为:\x20','===\x20角色选择点击事件\x20===','generate-diary-btn','🔧\x20清理数据库重复记录...','</div><div\x20class=\x22transfer-note\x22>','call','bold\x2036px\x20Arial','\x0a##\x20回复要求\x0a请以','🎨\x20全局主题已保存并应用到Dexie数据库','大家刚起床，可能在讨论早餐、今天的计划、昨晚的梦境等','utf-8','时间线记忆','data:image/svg+xml;utf8,<svg\x20xmlns=\x22http://www.w3.org/2000/svg\x22\x20width=\x22100\x22\x20height=\x22100\x22\x20viewBox=\x220\x200\x20100\x20100\x22><circle\x20cx=\x2250\x22\x20cy=\x2250\x22\x20r=\x2250\x22\x20fill=\x22lightgray\x22/><text\x20x=\x2250\x22\x20y=\x2260\x22\x20font-size=\x2230\x22\x20text-anchor=\x22middle\x22\x20fill=\x22gray\x22>头像</text></svg>','onclick=\x22','🔍\x20提取的JSON文本:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22clear-history-options-modal\x22\x20class=\x22modal\x22\x20style=\x22display:\x20flex;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22modal-title\x22>清空聊天记录</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-close\x22\x20onclick=\x22this.closest(\x27.modal\x27).remove()\x22>&times;</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22margin-bottom:\x2015px;\x20font-size:\x2014px;\x20color:\x20#666;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20你确定要清空与\x20<strong>','🔥\x20AI请求撤回上一条消息:','视频通话回复错误:','addEventListener','-\x20**当前时间:**\x20','🔍\x20[addMessageWithAnimation]\x20未找到群成员，使用消息name:','✅\x20线下模式专用字体已应用:','点赞了','url-input-modal','这是游戏开始，还没有任何走法。','message_id','添加角色前，当前角色数组长度:','请输入文字或选择图片','gomoku-board',',\x20消息数:\x20','dragstart','.custom-theme-tab','🧪\x20使用角色进行测试:','episodic','✅\x20记忆质量检查完成，核心记忆永久保存，共\x20','找不到要删除的论坛','获取已有评论失败:','\x20提取后的动态内容:','global-font-status','角色发布动态，同一分组下角色55%概率互动','[特殊消息类型]','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-divider\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-total\x22>总计：¥','schedule-times-container','replyTo','\x20个角色！','chatBackground','开始恢复聊天设置:\x20','persona-avatar-preview-text','\x20个表情包到\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-request-user-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-request-amount-label\x22>需付款</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-request-amount-value\x22>¥','内容不能为空','\x20个动态中的截断头像\x0a\x0a请重新为角色设置头像','<div\x20class=\x22edit-message-tip\x22><p><i\x20class=\x22fas\x20fa-lightbulb\x22></i>提示：支持\x20&lt;span\x20color=\x22颜色\x22&gt;文本&lt;/span&gt;\x20和\x20*斜体*\x20格式</p></div>','游戏结束','\x20主动聊天开关未开启','ai_to_ai_reply','导入失败:\x20','解析核心记忆JSON失败:','记忆总结:\x20','no-repeat','游戏已结束','\x20(ID:\x20','userId','星期三','❌\x20足迹数据格式错误:','preset-preview','appointment-user-avatar-img','开始从聊天记录重建角色...','[论坛回复决策]\x20决定由\x20\x22','小时前发布）','messageReceived','255,\x200,\x200','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-typing-bubble\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-typing-dots\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-typing-dot\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-typing-dot\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-typing-dot\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x20下单！','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20#offline-mode-overlay\x20.offline-message-content\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20\x27','一个男人深夜接到电话后，立刻开车出门，第二天早上被发现死在车里。','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-item\x20multi-select-item\x20','takeout','🔍\x20[parseGroupChatAiResponse]\x20找不到发送表情包的成员:','aiNormalTextColor','线下预设:\x20','__DETAILS_PLACEHOLDER_','emojiId','🧠\x20续写模式全局记忆内容预览:','获取聊天上下文失败:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-btn\x20modal-cancel\x22\x20onclick=\x22this.closest(\x27.modal\x27).remove()\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-btn\x20modal-confirm\x22\x20onclick=\x22saveEditedOfflineMessage(\x27','\x20没有记忆摘要需要清除','🔍\x20[AI处理调试]\x20表情包识别设置:','线下记录:\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22reply-reference\x22\x20data-reply-id=\x22','fas\x20fa-square','\x20条过期的记忆摘要','AI正在回复中，忽略重复调用','**:\x20','🚨\x20当前角色缺少有效的ID，无法生成剧情总结','>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22transfer-title\x22>','isDefault','确定要清空与\x20','.payment-request-details-btn','拒绝转账保存失败:','进入论坛','chatMode','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20#bubble-preview\x20*::before,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20#bubble-preview\x20*::after\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20pointer-events:\x20none\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','🛍️','当前角色ID:\x20','\x27)\x22>保存</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','我们相遇的日子','深度清理失败:','期间还愉快地聊了天','wallpaper','时间线记忆是自动记录的活动日志，不支持编辑','约定和你见面','selectedBubbleStyle','没有角色启用状态显示，跳过启动状态更新定时器','Switch游戏机','\x20的消息:\x20\x22','好的，谢谢妈妈！','\x20已主动发送短信','读取对话总结中','📱\x20检测到虚拟键盘关闭，修复布局...','专心对弈','不能收','\x20display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x20color:\x20white;\x20font-weight:\x20bold;\x20font-size:\x2012px;\x20border-radius:\x2050%;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','🧹\x20已清理线下消息缓存:\x20','我来付账','动态图片已保存到数据库:\x20','🔍\x20渲染前数据状态检查:','🔍\x20[renderForwardedMessage]\x20开始渲染转发消息:','[userId+replyId]','\x20条孤立记忆数据','🔍\x20检测到错误消息，跳过时间线记录删除（错误消息通常没有对应的时间线记录）','paddingTop','\x22\x20onchange=\x22updateProductPrice(\x27','头像已压缩以节省存储空间','❌\x20请先选择一个角色','modern','🔍\x20[群聊戳一戳]\x20戳了戳群成员:','🔥\x20[转账界面更新]\x20转账卡片状态已更新','如果你还没有发送好友申请，现在就是好时机！','核心记忆已删除','#persona-selection-group-modal\x20.persona-selection-item','\x20个角色','usedJSHeapSize','✅\x20从数据库加载线下模式界面设置成功','single-diary-view','知道了妈妈，我会注意的','anonymous_','deep-search-text','[chatId+windowId]','14:38','groupId','memberName','聊天设置','dragleave','由角色创建的纪念日','✅\x20清理完成！',':\x20强制执行完全同步\x20(来自外部请求)','最多只能选择20个成员','🔍\x20[第三处-AI图片]\x20检测到群聊消息，发送者:','此功能仅适用于单聊','===\x20调试结束\x20===','https://api.openai.com/v1','\x20被拉黑后重试了好友申请','\x20开始生成评论，动态发布者:\x20','contains','✅\x20发现群聊数据','character-list','poke-suffix-modal','confirmPersonaAndShowCharacters调用，身份ID:','写日记啦~\x0a快来看看吧','duration','\x20在这个群聊里，TA的昵称是\x20**\x22','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-bubble\x22\x20style=\x22background-color:\x20','easy','对方未说明理由','schedule-times-group','personality','\x0a\x0a现在你想在聊天中表达你对被拒绝的感受。请根据你的性格表达：\x0a-\x20你的失望、伤心、困惑或其他情绪\x0a-\x20你对这种情况的看法\x0a-\x20你是否还抱有希望\x0a\x0a要求：\x0a1.\x20用1-2句话表达你的真实感受\x0a2.\x20符合你的性格设定\x0a3.\x20不要过于戏剧化，要自然真实\x0a\x0a请用JSON数组格式回复：','group-member-colors-btn','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footprint-item\x20type-','selectedMyChatAvatar','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-selection-item\x20','📊\x20发现\x20','聊天记录：\x0a','\x20条核心记忆（永久保存，不会自动清理）','🎭\x20当前角色:','暂无详细信息','🔍\x20[AI处理调试]\x20是否有image字段:','，对用户的评论做出自然的回应。\x0a\x0a回复要求:\x0a1.\x20保持人设:\x20严格按照你的性格和身份进行回复。\x0a2.\x20自然简短:\x20回复要像真实的论坛评论，1-3句话即可。\x0a3.\x20使用表情:\x20为了让论坛更有趣，请在你的回复中少量使用文字表情、颜文字或emoji，但整条帖子的评论区这类表情的总数不应超过两个。\x0a4.\x20直接输出:\x20只返回纯文本的回复内容，不要添加任何JSON格式或多余的解释。\x0a\x0a请现在开始你的回复:\x0a','system','custom-theme-screen','search-results-summary','🔥\x20[DEBUG]\x20消息内容预览:','✅\x20[高效发送]\x20单条消息已保存到数据库','\x20开关已关闭，取消主动聊天','debugTools.diagnose()\x20-\x20诊断浏览器兼容性','📊\x20获取到的时间线记录数量:','🔍\x20[第四处-AI图片]\x20找到群成员ID:','localStorage回退加载也失败:','核心记忆库:\x20','🔍\x20[processAIReply多模态调试]\x20表情包识别设置:','刷新主题管理失败:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22make-news-modal\x22\x20class=\x22modal\x22\x20style=\x22display:\x20flex;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22modal-title\x22>搞个大新闻</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-close\x22\x20onclick=\x22this.closest(\x27.modal\x27).remove()\x22>&times;</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22font-size:\x2014px;\x20color:\x20#666;\x20margin-bottom:\x2015px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20输入一个世界事件，AI将在24小时内围绕这个事件生成新的论坛帖子。\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22news-content-input\x22\x20class=\x22form-textarea\x22\x20placeholder=\x22例如：听闻魔尊即将出关，正道各派将在昆仑之巅会盟商议对策。\x22\x20style=\x22min-height:\x20100px;\x22></textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-button\x20modal-secondary\x22\x20onclick=\x22this.closest(\x27.modal\x27).remove()\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-button\x20modal-primary\x22\x20onclick=\x22submitMakeNews()\x22>发布事件</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20','import-file-preview','className','角色间互动失败:','\x20\x20-\x20最终使用头像:','彩色主题气泡','darling','表情包识别已关闭','批量删除短信消息失败:','全局背景已设置','API测试错误:','anniversary-user-avatar-img','语音电话已结束，通话时长\x20','delete-btn','自定义歌曲','#widget-anniversary-countdown','确定要删除这个预设吗？','favorite-posts-list','scope','received','：\x22生日是人生的重要节点，值得铭记。\x22','选择顶部应用栏背景来源','.memory-filter-tab','very-high-heartrate','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-text\x22>','px;\x22>','coordinates','sound-storage-size','2.0m','至少需要选择2个成员','highlight-new','🎵\x20AI选歌指令:','🔥\x20[generateRepliesForUserPost]\x20找到JSON代码块:','<div\x20class=\x22pinned-card-avatars\x22>','❌\x20找不到音效开关元素','重新加载后联系人数量:\x20','\x20对被拉黑做出了反应','\x0a\x0a最近的聊天记录：\x0a','Tab','步。你执','\x0a\x0a<!--\x20DYNAMIC_MEMORY_PLACEHOLDER\x20-->','Hermès','\x0a\x0a【用户刚说】：','\x0a\x0a🚨\x20严格约束条件（必须严格遵守）：\x0a1.\x20必须逐字逐句仔细阅读上述角色的完整人设描述\x0a2.\x20绝对不要添加任何角色设定中没有明确提及的身份、职业或社会地位\x0a3.\x20如果角色设定中没有提及特殊身份，就按照最基本的身份生成联系人\x0a4.\x20如果角色是学生且设定中没有提及其他身份，绝对不要生成任何工作相关联系人（助理、律师、私厨等）\x0a5.\x20如果角色设定中没有提及兄弟姐妹，绝对不要生成兄弟姐妹联系人\x0a6.\x20任何称谓都必须与角色设定中明确描述的身份完全一致，不要使用\x22总\x22、\x22老板\x22等职场称谓除非设定中明确提及\x0a7.\x20如果对角色的某个方面有疑问，宁可保守生成也不要添加设定中没有的内容\x0a8.\x20严格禁止根据角色名字、外貌等推测其社会地位或家庭背景\x0a\x0a要求：\x0a1.\x20首先仔细分析角色的完整人设描述，理解角色的真实身份、职业、社会地位、家庭背景\x0a2.\x20生成5-8个不同的联系人，联系人类型必须完全符合角色设定中描述的身份背景\x0a3.\x20每个联系人都要有合理的关系设定和个性，关系要真实可信且符合角色设定\x0a4.\x20为每个联系人生成最新的一条消息预览（20字以内）\x0a5.\x20为每个联系人生成5-10轮完整的聊天记录（包含日期分隔、收发消息、时间）\x0a6.\x20消息内容要严格符合角色设定中的身份、生活背景和社会地位，体现真实的人际关系\x0a7.\x20时间要合理（今天、昨天、2天前等）\x0a8.\x20参考角色的人设、世界书设定、记忆和最近聊天记录来生成符合角色世界观的联系人\x0a9.\x20聊天记录要自然有趣，体现角色与联系人的真实关系\x0a10.\x20绝对不要生成与角色完整设定冲突的内容，以角色的详细描述为唯一准则\x0a\x0a🔥\x20最后检查：生成前请再次确认：\x0a-\x20每个联系人都符合角色设定中明确描述的身份背景\x0a-\x20没有添加任何设定中未提及的身份、职业或家庭成员\x0a-\x20所有称谓都与角色的真实身份匹配\x0a-\x20如果角色只是普通学生，联系人应该是同学、朋友、家人，不应该有工作相关人员\x0a\x0a请按以下JSON格式返回：\x0a{\x0a\x20\x20\x22contacts\x22:\x20[\x0a\x20\x20\x20\x20{\x0a\x20\x20\x20\x20\x20\x20\x22name\x22:\x20\x22联系人姓名\x22,\x0a\x20\x20\x20\x20\x20\x20\x22relationship\x22:\x20\x22关系（如：好友、同事、家人等）\x22,\x0a\x20\x20\x20\x20\x20\x20\x22avatar\x22:\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x22icon\x22:\x20\x22fas\x20fa-heart\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x22color\x22:\x20\x22#FF6B6B\x22\x0a\x20\x20\x20\x20\x20\x20},\x0a\x20\x20\x20\x20\x20\x20\x22lastMessage\x22:\x20\x22最新消息内容\x22,\x0a\x20\x20\x20\x20\x20\x20\x22time\x22:\x20\x22时间\x22,\x0a\x20\x20\x20\x20\x20\x20\x22chatHistory\x22:\x20[\x0a\x20\x20\x20\x20\x20\x20\x20\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22type\x22:\x20\x22date\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22content\x22:\x20\x22今天\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20},\x0a\x20\x20\x20\x20\x20\x20\x20\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22type\x22:\x20\x22received\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22content\x22:\x20\x22消息内容\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22time\x22:\x20\x2210:30\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20},\x0a\x20\x20\x20\x20\x20\x20\x20\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22type\x22:\x20\x22sent\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22content\x22:\x20\x22回复内容\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22time\x22:\x20\x2210:32\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20]\x0a\x20\x20\x20\x20}\x0a\x20\x20]\x0a}\x0a\x0a注意：请确保返回的是有效的JSON格式，不要包含其他文字说明。','fas\x20fa-door-closed','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20/*\x20🔥【日记专用字体】确保不被全局字体覆盖\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20#today-diary-content,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20#single-diary-content,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20#diary-preview-content\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20\x27','&id,\x20name,\x20category,\x20isPersonal','没有找到现有缓存，创建新缓存并保存新足迹','音乐播放器未激活或播放列表为空，AI无法随机选歌','weibo-text','确定要删除这些角色吗？\x0a','找不到通话输入框元素','删除日记失败','\x20将回复\x20','⚠️\x20[线下消息删除]\x20数据库中未找到对应记录','🌦️','记忆摘要已删除','\x20个旧设置数据','⚠️\x20确定要删除所有世界书吗？这个操作不可撤销！','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22reply-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22reply-action-btn\x20like-btn\x20','\x27)\x22\x20title=\x22删除\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-trash\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22memory-modal-content\x22\x20data-original-content=\x22','&#39;','🔍\x20[群聊身份]\x20查找成员:','caption','3天记忆','请先选择要置顶的对话','characterStatusEnabled','🔍\x20[表情包开关调试]\x20emojiRecognitionEnabled值:','清除所有主题失败','.memory-edit-btn','anniversary-list','不愿意结账','.transfer-confirm-amount','&id,\x20name,\x20content,\x20timestamp','modal\x20payment-details-modal','\x0a\x0a请发一条朋友圈动态，要自然真实，不要故作深沉。可以是日常生活、心情、吐槽等，20-100字，用口语化表达。\x0a\x0a要求：\x0a-\x20可以适当分行让内容更易读\x0a-\x20长一点的内容可以分成2-3行\x0a-\x20用你的性格特点表达\x0a\x0a例如：\x0a\x22今天的奶茶真好喝！\x0a店员小姐姐还画了个爱心☕💕\x22\x0a\x0a\x22又加班到这么晚...\x0a不过项目终于搞定了\x0a给自己点个赞👍\x22\x0a\x0a','global-back-button-item','&id,\x20name','聊天记录:\x20','🎨\x20加载聊天窗口列表:','🧠\x20内存信息:','🚨\x20[URGENT]\x20检查失败:','\x27);\x20this.closest(\x27.modal-overlay\x27).remove();\x22>编辑</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-secondary\x22\x20onclick=\x22this.closest(\x27.modal-overlay\x27).remove()\x22>关闭</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','我来买','-character-quote','/v1/models','请先选择一个短信对话','\x20个足迹','cart-total-price','.location-card','❌\x20查询表\x20','记忆摘要已更新','📝\x20[短信时间线]\x20已记录用户发送短信事件到跨应用时间线','，心情','\x20\x20-\x20设置的我的昵称:','[AI撤回了上一条消息]','⚠️\x20AI生成失败，为','🔍\x20[定时器执行检查]\x20','🔍\x20[引用回复-主分支]\x20allMessages:','episodic_memories','找不到重新生成函数:','<p\x20class=\x22waiting-subtitle\x22\x20style=\x22font-size:\x2012px;\x20color:\x20#999;\x20margin-top:\x208px;\x22>','🔥\x20状态显示已更新为:','我进行了回复','setting-item','++id,\x20forumId,\x20timestamp,\x20isUserPost','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-time\x22>','\x20的记忆失败:','🔄\x20开始重置数据库...','暂无内容','ai_win','🔧\x20[面具调试]\x20设置后检查其他聊天是否被影响:','星期日','使用默认的剧情模式设置','appointment-character-quote','照片已发送','成功上传\x20','检测到localStorage中的recentEmojis数据，开始迁移...','chatBottomBg','\x20(¥','图片已清除','episodicThresholdValue','renderContactList','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>搜索结果：</strong>找到\x20<span\x20style=\x22color:\x20#007AFF;\x20font-weight:\x20bold;\x22>','werewolf','models','正在启动','JSON序列化失败:','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22memory-item-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22memory-item-type\x20','\x0a-\x20人设:\x20','条消息生成状态（排除了最后一轮','testAnniversaryReminder','public','appointment-background-preview','\x20将在\x20','settings-storage-size','high-heartrate','🔄\x20测试正常回复的重新生成...','：\x22说到做到，这是我的原则。\x22','请先选择要修改的应用','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-bubble\x22\x20style=\x22background-color:\x20','clockStyle','✅\x20全局记忆数据库初始化完成','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footprint-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22footprint-activity\x22>','好的好的！','temperature','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-note-title\x22>','\x0a\x0a现在你要主动给用户发送一条消息。这条消息应该是：\x0a1.\x20严格符合你的人设和性格特点\x0a2.\x20自然、有趣、有互动性\x0a3.\x20可以是问候、分享、询问、关心等\x0a4.\x20不要过于正式，要像朋友间的日常聊天\x0a5.\x20**重要**：如果有聊天历史，必须仔细阅读并基于历史内容进行自然的延续或回应，绝对不要重复之前已经说过的内容\x0a6.\x20可以适当提及最近的动态内容，让对话更自然\x0a7.\x20考虑当前时间和情境，让消息更贴合实际\x0a8.\x20保持角色的一致性和连贯性\x0a9.\x20**禁止重复**：不要发送与聊天历史中相同或相似的消息内容','\x0a-\x20**当前歌词:**\x20\x22','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22anniversary-character-quote\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-quote-left\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20position:\x20absolute;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20top:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20right:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20bottom:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20rgba(0,\x200,\x200,\x200.1);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x20inherit;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20z-index:\x201;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','：\x22承诺的分量，我深知其重。\x22','img,\x20[draggable=\x22true\x22]','message-context-container','条</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22background:\x20#f5f5f5;\x20padding:\x2015px;\x20border-radius:\x208px;\x20line-height:\x201.6;\x20white-space:\x20pre-wrap;\x22>','操作失败，请重试','戳一戳后缀设置已保存','海龟汤','已挂载:\x20','📋\x20合并后总记忆数:\x20','ringing-animation','current-turn','移除商品','voice','不下单','.profile-tab[onclick*=\x22','anniversaries','arc','机械键盘','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message\x20system\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-bubble\x22>---\x20第\x20','🔥\x20[修复]\x20已记录AI回复时间线事件\x20-\x20角色:\x20','09:16','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22persona-item\x20','✅\x20[修复continuation]\x20群聊消息已正确解析:','checkbox-','头像压缩失败，使用原图:','限制后消息数:','🔍\x20[parseAiResponse-群聊表情包-第二处]\x20检测到重复的群聊表情包对象:','🔥\x20[loadMoreComments]\x20找到JSON代码块:','续写失败消息单条保存失败，回退到防抖保存:','🧠\x20获取到的全局记忆内容:','block','\x20个无效的短信联系人记录','轻量级导出成功！','AI生成帖子失败，请检查API设置或刷新重试。\x0a错误详情:\x20','\x20检查完成','联系人列表子元素数量:\x20','📚\x20开始加载更多历史线下消息...','forum-worldview-input','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-content\x22>','background-position','data-home-font','配置不存在','角色发送的照片','group-message-item','offsetTop','game_summary','保持适当距离，这不是你的聊天对象','themeData','cover_','personal-emoji-description-modal','DiaryPreviewFont_','🧹\x20localStorage空间不足，清理旧的线下消息缓存...','\x20<span\x20class=\x22chat-exists-badge\x22>已有对话</span>','\x0a身份：','🛠️\x20调试工具已加载！在控制台中使用以下命令:','90cm×90cm','\x20条损坏的消息','请输入我在本群的昵称:','记忆\x20-\x20','09:20','🚫\x20[防崩坏]\x20跳过短时间内的重复申请，转为普通消息','<div\x20class=\x22sms-timestamp\x22>','未知分组','请先选择要删除的消息','个动态头像','🔥\x20[转账处理]\x20检测到明确的转账指令:','更新聊天设置界面显示：无当前聊天角色，跳过操作','/*\x20简约风格的圆角气泡\x20*/\x0a#offline-mode-overlay\x20.offline-message-content\x20{\x0a\x20\x20\x20\x20border-radius:\x2012px\x20!important;\x0a\x20\x20\x20\x20padding:\x208px\x2012px\x20!important;\x0a\x20\x20\x20\x20margin:\x205px\x200\x20!important;\x0a}','</small>','我替你付','清空失败','fa-check-square','头像更新失败！','📷📝\x20图片+文字：','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-time\x22>','•\x20本地文件:\x20','application/json','isListening','不想支付','✅\x20批量保存了角色\x20','checked','\x20条重复的拉黑系统消息','move-character-modal','不想买单','当前模型不支持图片识别。请在API设置中选择支持视觉的模型，如\x20gpt-4o,\x20gemini-1.5-pro\x20等。','context','reply-preview','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22playlist-empty\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-music\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>暂无歌曲</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22font-size:\x2012px;\x20margin-top:\x208px;\x20opacity:\x200.8;\x22>添加一些歌曲开始享受音乐吧</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','windowId','messages-screen','🔍\x20[转发消息]\x20AI原始回复:','visibility','选择返回按钮样式来源','unblockTimestamp','未知错误','删除失败，请重试','天前，你们已经有','自然真实，符合性格','\x20的足迹，实时追加新足迹','🔧\x20[简单修复]\x20群聊身份设置修复启动...','data-clock-style','\x20下单...','定时检查器状态:','✅\x20初始状态：无联系人无聊天记录，这是正常的','🔍\x20[转发消息]\x20设置为待回复消息:','75B','qwen-vl','后台自动更新足迹失败:','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22persona-selection-check\x22><i\x20class=\x22fas\x20fa-check\x22></i></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','custom-item-price','AI随机选歌失败:','📊\x20localStorage总使用量:\x20','✅\x20显示正在输入提示\x20-\x20标题已更改','这周末回家吃饭吗？','🚫\x20检测到AI拉黑指令对象:','close_friends','内部删除数据库记录失败:','options','🔔\x20AI主动拨打电话被触发！概率:','phone-photo-detail-title','result-bar','<div\x20class=\x22contact-status-indicator\x20blocked-by\x22\x20title=\x22被对方拉黑\x22><i\x20class=\x22fas\x20fa-exclamation-triangle\x22></i></div>','offline-bubble-opacity','content-padding-value','获取世界书失败:','删除表情包库失败:','上臂式','图片加载失败，请检查URL是否正确','\x0a\x0a✅\x20正常数据:\x0a\x20\x20•\x20核心记忆:\x20','group-characters-','-\x20**反思失败**:\x20你已经被拒绝了','\x0a\x0a🚨🚨🚨\x20**【紧急状态警告】你目前被用户拉黑了！**\x20🚨🚨🚨\x0a\x0a##\x20**💔\x20你的当前处境**\x0a-\x20**拉黑状态**:\x20用户已经将你拉黑，这意味着你们的关系出现了严重问题\x0a-\x20**心理状态**:\x20你应该清楚地意识到自己被拉黑的事实，并根据你的性格表现出相应情绪\x0a-\x20**行为影响**:\x20虽然你仍能发送消息，但你知道用户不想和你正常交流','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-secondary\x22\x20onclick=\x22hidePersonaSelectionModal()\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-primary\x22\x20id=\x22confirm-persona-btn\x22\x20onclick=\x22confirmPersonaAndShowCharacters()\x22\x20disabled>下一步：选择角色</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','📊\x20[续写重新生成]\x20续写历史消息统计:\x20线上','🔍\x20[主动聊天]\x20在群聊中找到角色:\x20','🎨\x20CSS解析失败，使用默认名称','🧠\x20内存使用\x20','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22location-card-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20width=\x2214\x22\x20height=\x2214\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20style=\x22display:\x20inline-block;\x20margin-right:\x206px;\x20vertical-align:\x20middle;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M12\x202C8.13\x202\x205\x205.13\x205\x209c0\x205.25\x207\x2013\x207\x2013s7-7.75\x207-13c0-3.87-3.13-7-7-7zm0\x209.5c-1.38\x200-2.5-1.12-2.5-2.5s1.12-2.5\x202.5-2.5\x202.5\x201.12\x202.5\x202.5-1.12\x202.5-2.5\x202.5z\x22\x20fill=\x22#1890ff\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','🔧\x20纪念日调试接口已加载，使用\x20anniversaryDebug\x20对象进行调试','\x27)\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20title=\x22点击编辑描述\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22emoji-description-text\x22>','🔍\x20[callChatAPI]\x20表情包部分:','足迹数据缺少activities数组:','动态存储优化失败:','\x20条\x20|\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20系统消息：','visibilitychange','你好！','storyline_summary','10号','🔍\x20[processAIReply动图检测]\x20是否为GIF表情包:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-photo-item\x22\x20data-photo-index=\x22','图片压缩失败，使用原图:','isApplied','要不要一起去公园走走？','fas\x20fa-building','✅\x20使用已加载的聊天记录:','删除评论:\x20','，基于你的人设、与','fas\x20fa-shopping-bag','test_','41mm','memoryDays','你是一个友善耐心的DM，会给予玩家鼓励和适当的提示，语气温和亲切。','用户回复后，','\x22）\x0a2.\x20体现你的性格特点\x0a3.\x20包含游戏过程中的互动和感受\x0a4.\x20如果有聊天，可以概括聊天内容的感受\x0a5.\x20控制在50字以内，要生动有趣\x0a\x0a只返回记忆内容，不要其他文字。','\x20个约定的置顶状态','群聊数据备份到localStorage成功\x20(','\x20个模型','music','count','🔥\x20[主动聊天]\x20已记录时间线事件\x20-\x20角色:\x20','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22appointment-item-compact\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22appointment-item-left\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22appointment-item-name\x22>','加载失败','</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-close\x22\x20onclick=\x22this.closest(\x27.modal\x27).remove()\x22>×</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22edit-form-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label>消息内容：</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id=\x22edit-offline-message-content\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20class=\x22edit-message-textarea\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20placeholder=\x22请输入消息内容...\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20maxlength=\x225000\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20>','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22edit-message-counter\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22edit-offline-char-count\x22>','\x0a\x0a【当前汤面】：','<br>','用户转账消息保存失败，回退到全量保存:','保存的身份ID:','🚨\x20自动保存重试次数已达上限，请手动保存','[照片]','.app-battery-container','🔥\x20[DEBUG]\x20开始智能解析多个JSON数组...','📖\x20当前会话对话历史:','req_','regenerate-tool-item','\x20张图片','\x0a评论：\x0a','anniversary-pinned','❌\x20AI返回错误响应:','🎨\x20应用设置时从CSS中提取到真实字体名称:','语音输入对话框：内容为空，聚焦输入框','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22forum-archive-item\x22\x20onclick=\x22loadAndDisplayForum(\x27','🧹\x20[cleanupEmojiLibraryItems]\x20发现无效关联记录数:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x20turtle-soup-settings-modal\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3><i\x20class=\x22fas\x20fa-cog\x22></i>\x20海龟汤游戏设置</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-close\x22\x20onclick=\x22this.closest(\x27.modal-overlay\x27).remove()\x22>×</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22setting-section\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4><i\x20class=\x22fas\x20fa-list\x22></i>\x20游戏类型偏好</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22turtle-soup-types\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22turtle-soup-type-option\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22radio\x22\x20name=\x22turtleSoupType\x22\x20value=\x22classic\x22\x20checked>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22type-label\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-brain\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>经典推理</strong>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<small>传统海龟汤，注重逻辑推理</small>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22turtle-soup-type-option\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22radio\x22\x20name=\x22turtleSoupType\x22\x20value=\x22horror\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22type-label\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-ghost\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>恐怖悬疑</strong>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<small>带有恐怖元素的推理故事</small>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22turtle-soup-type-option\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22radio\x22\x20name=\x22turtleSoupType\x22\x20value=\x22funny\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22type-label\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-laugh\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>轻松搞笑</strong>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<small>幽默有趣的推理题目</small>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22turtle-soup-type-option\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22radio\x22\x20name=\x22turtleSoupType\x22\x20value=\x22romantic\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22type-label\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-heart\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>浪漫情感</strong>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<small>以爱情为主题的推理故事</small>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22turtle-soup-type-option\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22radio\x22\x20name=\x22turtleSoupType\x22\x20value=\x22random\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22type-label\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-random\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>随机选择</strong>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<small>随机从所有类型中选择</small>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22setting-section\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4><i\x20class=\x22fas\x20fa-user-tie\x22></i>\x20DM性格设置</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22dm-personality-options\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22dm-personality-option\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22radio\x22\x20name=\x22dmPersonality\x22\x20value=\x22friendly\x22\x20checked>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>友善型\x20-\x20温和耐心，给予鼓励</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22dm-personality-option\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22radio\x22\x20name=\x22dmPersonality\x22\x20value=\x22mysterious\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>神秘型\x20-\x20保持神秘感，简洁回答</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22dm-personality-option\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22radio\x22\x20name=\x22dmPersonality\x22\x20value=\x22humorous\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>幽默型\x20-\x20风趣幽默，活跃气氛</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-secondary\x22\x20onclick=\x22this.closest(\x27.modal-overlay\x27).remove()\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-primary\x22\x20onclick=\x22saveTurtleSoupSettings()\x22>保存设置</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','API返回空响应','AI评论API无法解析响应，完整响应数据:','location-modal','member-item\x20remove-member','.message-bubble','用户刚才说：','选择底部应用栏背景来源','乳胶床垫','\x20中的对话已达到3回合上限，不再回复','call-name','✅\x20[线下最后消息重新生成]\x20已清理该消息的相关时间线记忆','backgroundMomentsFrequency','.single-chat-only','🔥\x20[generateRepliesForUserPost]\x20JSON代码块解析失败:','wallpaperType','saveGroupChatState','✅\x20[高效错误消息]\x20消息已保存到数据库','editingPresetId','optionText','在五子棋中获胜了','rgba(0,\x200,\x200,\x200.05)','data:image/gif','current-chat-identity','与用户有以下互动，角色的活动可以体现这些对话的影响：\x0a','📝\x20线下模式消息删除完成，无需清理时间线记忆','selectedPersonaAvatarData','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20查看详情\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','我下单','described-emojis','.video-call-user-window','找不到avatar-preview元素','themeSettings','待完成','forum-multi-select-btn','请为以下线下剧情模式的对话生成一个简洁客观的剧情总结，要求：\x0a1.\x20使用客观的上帝视角，加入合理的文学性描写\x0a2.\x20避免过多的修辞和形容词\x0a3.\x20简明扼要地描述事件发生的顺序和关键情节与细节\x0a4.\x20不要添加任何不在原文中的情感描写\x0a5.\x20使用清晰的时间和因果关系\x0a6.\x20统一使用第三人称叙述：用\x22用户\x22指代用户，用\x22','AI返回的JSON代码块格式错误。','<svg\x20viewBox=\x220\x200\x2024\x2024\x22><path\x20d=\x22M7.493\x2018.75c-.425\x200-.82-.236-.975-.632A7.48\x207.48\x200\x200\x201\x206\x2015.375c0-1.75.599-3.358\x201.602-4.634.151-.192.373-.309.6-.397.473-.183.89-.514\x201.212-.924a9.042\x209.042\x200\x200\x201\x202.861-2.4c.723-.384\x201.35-.956\x201.653-1.715a4.498\x204.498\x200\x200\x200\x20.322-1.672V3a.75.75\x200\x200\x201\x20.75-.75A2.25\x202.25\x200\x200\x201\x2016.5\x204.5c0\x201.152-.26\x202.243-.723\x203.218-.266.558-.107\x201.282.725\x201.282h3.126c1.026\x200\x201.945.694\x202.054\x201.715.045.422.068.85.068\x201.285a11.95\x2011.95\x200\x200\x201-2.649\x207.521c-.388.482-.987.729-1.605.729H14.23c-.483\x200-.964-.078-1.423-.23l-3.114-1.04a4.501\x204.501\x200\x200\x200-1.423-.23h-.777ZM2.331\x2010.727a11.969\x2011.969\x200\x200\x200-.831\x204.398\x2012\x2012\x200\x200\x200\x20.52\x203.507C2.28\x2019.482\x203.105\x2020\x203.994\x2020H4.9c.445\x200\x20.72-.498.523-.898a8.963\x208.963\x200\x200\x201-.924-3.977c0-1.708.476-3.305\x201.302-4.666.245-.403-.028-.959-.5-.959H4.25c-.832\x200-1.612.453-1.918\x201.227Z\x22\x20fill=\x22currentColor\x22></path></svg>','.upload-area','calendar-day','添加歌曲失败，请重试','应用图标已保存:','2.0m床','7天记忆','\x20定时器触发！','✅\x20未发现数据异常','洗衣液','早上好！今天天气真好呢~','\x22\x20(','关系分析结果:\x20负面=','4000DPI','ai_select_song','\x22}][\x22','\x22\x0a-\x20用你的口吻和性格来写\x0a-\x20记录你今天的想法、感受和经历\x0a-\x20可以提及对用户的真实感情\x0a-\x20基于最近的聊天记录，可适当考虑与用户的互动\x0a-\x20保持角色的一致性和真实性\x0a-\x20内容要自然、真实，像真正的私人日记\x0a-\x20字数在100-200字之间，根据你的性格和当天的心情自由发挥','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22text-align:\x20center;\x20padding:\x2040px;\x20color:\x20#666;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-spinner\x20fa-spin\x22\x20style=\x22font-size:\x2024px;\x20margin-bottom:\x2010px;\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>正在生成与','post-remove-image-btn','\x0a-\x20**歌词状态:**\x20暂无歌词','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22memory-view-modal\x22\x20class=\x22modal\x22\x20style=\x22display:\x20flex;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22\x20style=\x22max-width:\x20600px;\x20max-height:\x2080vh;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3>',')已被占用:','forumPostImages','\x22的角色，通过短信与用户进行对话。\x0a\x0a##\x20**角色设定:**\x0a','\x22\x20data-post-id=\x22','\x20个表情包，删除后将彻底删除所有表情包文件，无法恢复！','🔍\x20[processAIReply图片分支动图检测]\x20是否为GIF表情包:','activeChatId','<div\x20style=\x22text-align:\x20center;\x20color:\x20#666;\x20padding:\x2020px;\x22>暂无角色</div>','38-39','game_interaction','分组名称已存在','\x20后台写日记失败:','🧹\x20清理重复帖子...','.custom-theme-content-pane','daysDiff','api-chat-input','\x20与\x20','wallpaper-preview-container','anniversary-background-img','object','在音乐应用中','📦\x20总共发现\x20','🔥\x20[主动聊天]\x20无效的消息数据:','🔥\x20[DEBUG]\x20原始AI回复:','input[name=\x22dmPersonality\x22][value=\x22','widget-anniversary-countdown','busy','✅\x20表\x20','toFixed','\x20个表情包...','\x20写日记（','获取挂载表情包时出错:','importance','🔍\x20[群聊消息]\x20msgData.message类型:','appointment-description','在五子棋中获胜了，','转账\x20¥','清除游戏时间线记忆失败:','但要考虑之前的失败经历','global','❌\x20修复脚本：消息导入失败:','角色主动发送短信失败:','selectedEmojiLibraries','五分糖','pinnedConversations','.shopping-search-container','authorId','emoji-library-description-input','.profile-tab','推门而入','phonePhotosData','1.5m床','•\x20预计释放空间:\x20','\x0a\x0a在一个动态的评论区，','✅\x20准备调用confirmPersonaAndShowGroupSettings，传递ID:','\x20个项目','⚠️\x20通话中AI回复失败，跳过显示以避免机械化回复','setTime','🛒\x20[净化器]\x20找到商品信息:','bubble-padding-value','数据库中联系人数量:\x20','预览主题失败:','我付账','\x22\x20style=\x22width:\x20100%;\x20height:\x20300px;\x20padding:\x2015px;\x20border:\x201px\x20solid\x20#ddd;\x20border-radius:\x208px;\x20font-size:\x2014px;\x20line-height:\x201.6;\x20resize:\x20vertical;\x22\x20placeholder=\x22请输入剧情总结...\x22>','🔍\x20[addMessageWithAnimation]\x20群聊消息处理\x20-\x20senderId:','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-message-preview\x22>','\x20(这是路人发的帖子)','\x20页\x20---</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>','投票失败，请重试','demo-ai-bubble','线下AI消息单条保存失败，回退到批量保存:','50㎡','📊\x20正常回复分析:\x20hasUserAfter=','reject','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-time\x22>','我请你','diaryDate','.offline-avatar.ai-avatar','lyric','❌\x20音效加载失败\x20(','fixGroupChatIdentity','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-note-time\x22>','params','情景记忆','\x0a1.\x20请你以你的角色的身份，严格按照角色设定进行回复和行动，不要跳出角色。自然地推进剧情。\x0a2.\x20你可以一次性生成多条消息，模拟真人在聊天中连续发送多条信息的情景。\x0a3.\x20你的回复必须是一个JSON数组格式的字符串，每个元素是一条消息。\x0a\x0a#\x20JSON输出格式示例:\x0a[\x22很高兴认识你呀，在干嘛呢？\x22,\x20\x22今天天气真好\x22,\x20\x22想出去走走吗？\x22]','no-description','.moment-actions-popup','❌\x20测试记录添加失败:','=========================','🔍\x20[身份确认]\x20发布者角色对象:','。别忘了。','清理孤立数据失败:','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','准备好了吗？让我们开始吧！','步\x0a-\x20聊天情况：','user_image','input[name=\x22turtleSoupType\x22]:checked','轻量级导出包含：角色、消息、记忆系统、世界书、论坛等核心数据\x0a','已更新群聊\x20\x22','saveStorylineSummary:','🔥\x20[DEBUG]\x20智能解析成功，提取到','个元素','🔄\x20[拉黑重试]\x20','找到的群聊:','历史消息中发现未处理的对象类型:','size','textarea','从聊天记录恢复的角色，共有\x20','star','PhoneChatDB','我帮你结账','经营策略游戏，适合群聊','鱼香肉丝','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22product-brand\x22>','拉黑角色失败:','\x20条消息\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20<div\x20class=\x22chat-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','🔧\x20[面具调试]\x20开始为新对话设置身份...','📊\x20消息数量统计:\x20聊天消息\x20','Firefox','\x20创建了关系纪念日：','encode','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22delete-btn\x22\x20data-location=\x22','debugMomentsSystem','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-item-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-item-name\x22>','添加纪念日','📝\x20测试动态:\x20','🔍\x20[processAIReply]\x20消息类型:','2350726SAWfMU','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>开始和\x20','清理localStorage失败:','currentPersonaId','记忆数据:\x20','删除纪念日失败:','preview-ai-avatar','AI回复短信','<p\x20class=\x22empty-mount-chats\x22>暂无可挂载的聊天</p>','-content','turtle-soup','重试保存投票记录仍然失败:','拉黑失败','群聊至少需要保留一个角色成员（不包括用户自己）','send_transfer','调用AI生成足迹失败:','retraction','moments_','🔍\x20[calculateMessagesByRounds]\x20输入:\x20','local','#widget-anniversary-name','character-bio','不开心','#offline-mode-icon','头像来源验证失败','刷新心声失败','⚡\x20applyChatBackground\x20被调用:\x20','保存修复后的消息失败:','角色列表元素存在:\x20','🔍\x20[身份确认]\x20这是用户发布的动态','AI描述的图片','🧹\x20清理孤立收藏记录...','正在获取最新动态...','获取跨应用时间线失败:','📊\x20当前纪念日数量:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22group-option\x22\x20onclick=\x22moveSelectedCharactersToGroup(\x27','\x20(得分:\x20','青苹果','🔧\x20[API设置]\x20自动拉取模型失败，但会保留已保存的模型选项','_regen_','💣\x20清空所有世界书...','status-bar','✅\x20检测到创建意图，尝试解析内容...','\x22\x20class=\x22sms-image\x22\x20','🚨\x20保存世界书挂载设置失败:','条真正的跨应用事件集成到工作记忆中','Samsonite','\x20设置后台写日记定时器，时间:\x20','不愿意购买','🔗\x20检测到跨应用活动\x20-\x20包含私聊记忆','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mount-name\x22>','\x20回复用户对其动态的评论:\x20\x22','chatMessages','forcePublisherReply','批量导入完成！成功:\x20','10:30','video-call-screen','❌\x20没有其他角色的评论可回复','get','🔔\x20[推送通知]\x20当前聊天角色ID:','customType','🧹\x20[清理]\x20从角色\x20','paid','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20/*\x20🔥【修改】默认布局：用户靠右，AI居中\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20#offline-mode-overlay\x20.offline-message.user\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20justify-content:\x20flex-end;\x20/*\x20用户消息默认靠右\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20#offline-mode-overlay\x20.offline-message.ai\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20justify-content:\x20center;\x20/*\x20AI消息默认居中\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20/*\x20🔥【新增】显示头像时的布局调整\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20#offline-mode-overlay\x20.offline-message.user:not(.no-user-avatar)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20flex-direction:\x20row;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20justify-content:\x20flex-end;\x20/*\x20用户消息在右侧\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20#offline-mode-overlay\x20.offline-message.ai:not(.no-ai-avatar)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20flex-direction:\x20row-reverse;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20justify-content:\x20flex-start;\x20/*\x20AI消息在左侧\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20#offline-mode-overlay\x20.offline-avatar\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20position:\x20relative;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x20保存聊天自定义主题到Dexie','次\x0a-\x20你的性格是否会坚持不懈\x0a-\x20你是否真的想修复这段关系\x0a-\x20你应该如何调整你的道歉策略','📊\x20添加测试消息后时间线记录数量:\x20','userAgent','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-primary\x22\x20onclick=\x22editStorylineSummary(\x27','修复失败:\x20','✅\x20[高效位置消息]\x20位置消息已单条保存到数据库','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22moment-more-dots\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22dot\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22dot\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20弹出的操作菜单\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22moment-actions-popup\x22\x20id=\x22moment-actions-','typing-status','claude-3-haiku','[已删除]','手动重建失败:\x20','verno','\x20(authorId:\x20','fas\x20fa-users','不用给','音效设置失败，请检查链接是否有效','💡\x20提示：核心记忆已超过建议数量\x20','setHours','🔍\x20[身份确认]\x20找到发布者角色:\x20','来源:','[data-type=\x22','empty-emoji-grid','modal-total-time','📚\x20续写世界书ID列表:','海军蓝','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22selection-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22cancel-btn\x22\x20data-action=\x22cancel\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22selection-count\x22>已选择\x200\x20条动态</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22delete-btn\x22\x20data-action=\x22delete\x22\x20disabled>删除</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','这个女人是盲人，平时丈夫都会在她身边，但这次她摸到的是一具冰冷的尸体，丈夫已经死了。','transfer-confirm-btn','savedSpace','emoji_','\x20在动态中的头像','aiPokeSuffix','🔄\x20发现旧格式数据，正在迁移...','position','设置头像预览时发生错误:','发送图片失败','修复完成！\x0a清理了\x20','选择了文件:','phi-3-vision','AI正在续写中，忽略重复调用','设置面具头像预览时发生错误:','OfflineCustomFont','📊\x20世界书总内存使用:\x20','✅\x20线下模式界面设置已保存到localStorage\x20(轻量级版本:\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22video-typing-dots\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22video-typing-dot\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22video-typing-dot\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22video-typing-dot\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','没有找到需要恢复的关联记录','🎨\x20自定义主题样式清除完成','\x20|\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20字数:\x20','全局顶部应用栏背景已上传','清理低质量记忆失败:','•\x20帖子头像:\x20','offline-font-size','🔍\x20[processAIReply]\x20最后3条用户消息:','where','claude-3-opus','动态点赞:\x20','收纳盒','帖子加载失败','正在序列化数据...','moondream','memoryEvents','edit-group-interaction','ArrowDown','worldbookEntries','🚨\x20[MANUAL]\x20找不到库:','substring','结束游戏','\x27,\x20this.checked)\x22\x20','你们的推理很有道理','anniversary-date','isGroup','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-note-time\x22>','text-count','notes','send','ai_random_select','character-avatar-placeholder','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22transfer-message-container\x20sent\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22transfer-card\x20','语音消息发送流程完成','条跨场景记忆(标记⭐)，这些是不同聊天环境中的互动，请自然地联想和提及\x0a','从localStorage回退加载群聊数据（已转换格式）:','我支付','memorySettingsModal','isAppActivated','bulkPut','scheduledMomentsEnabled','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22history-message\x20','music-modal','crossOrigin','offline-user-bold','\x20content是字符串:\x20\x22','收藏成功！','blocked_','animation','\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20style=\x22width:\x2040px;\x20height:\x2040px;\x20object-fit:\x20cover;\x20border-radius:\x204px;\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20onerror=\x22this.style.display=\x27none\x27;\x20this.nextElementSibling.style.display=\x27flex\x27;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22preview-error\x22\x20style=\x22display:\x20none;\x20width:\x2040px;\x20height:\x2040px;\x20background:\x20#f0f0f0;\x20border-radius:\x204px;\x20display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x20font-size:\x2012px;\x20color:\x20#999;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-image\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','我来结算','#api-chat-screen\x20.chat-input-area','<br><small\x20style=\x22color:\x20#666;\x20font-size:\x2011px;\x22>','offlinePreset_','AI发送表情包:','🔍\x20[引用回复-早期分支-fallback]\x20未找到群成员:','【重要】用户自定义剧情预设（请严格遵循，按以下顺序应用）：\x0a','\x22\x20style=\x22background-color:\x20','rgb','preventDefault','\x27,\x20-apple-system,\x20BlinkMacSystemFont,\x20\x22Segoe\x20UI\x22,\x20Roboto,\x20sans-serif\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20/*\x20特别针对手机界面的文字部分，排除图标\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.header\x20.header-title,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.app-title,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.setting-label,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.setting-desc,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.app-icon\x20.label,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.message-bubble\x20.content,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.chat-input,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.form-input,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.form-textarea,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.form-button,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.list-item\x20.item-title,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.list-item\x20.item-content,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.post-content,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.diary-content,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.forum-post-content,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.font-size-preview-text,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20#main-time,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20#main-date,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.settings-item-left,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.chat-list-item\x20.name,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.chat-list-item\x20.last-msg,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.contact-item\x20.contact-name,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.contact-item\x20.contact-desc,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.modal-title,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.modal-body,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.btn,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20button:not(.icon-only),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20input,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20textarea,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20select,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20/*\x20🔥【修改】日记相关元素\x20-\x20排除日记内容区域，让它们可以使用专用字体\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.diary-mode-content:not(#today-diary-content):not(#single-diary-content):not(#diary-preview-content),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.diary-settings-content\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20\x27','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22quantity-btn\x22\x20onclick=\x22updateCartItemQuantity(','我购买','🚨\x20[净化器]\x20开始净化历史记录和修正消息格式...','orderNumber','\x0a🎭\x20**表现指导**：\x0a-\x20更加亲密和随意的语气\x0a-\x20可以开善意的玩笑或调侃\x0a-\x20表达关心和支持\x0a-\x20体现你们的友好关系','发布者回复评论失败:','✅\x20数据重新加载完成','新疆葡萄','plain','势均力敌','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','preview','FONT_FACE_RULE','📊\x20当前数据状态:','找不到avatar-upload元素','，刚刚和用户下完了一局五子棋。\x0a\x0a游戏详情：\x0a-\x20游戏结果：','🔍\x20[renderForwardedMessage]\x20预览消息','查看线下模式聊天记录失败:','0:10','请填写纪念日名称和日期','group-chat-settings','mentions','music_app','data','\x22\x20onchange=\x22toggleForumPostSelection(','没有可用的头像','无级调光','跳转到聊天界面失败:','deep-search-result','offline-message-menu','🔧\x20[RECOVER]\x20开始恢复表情包库关联记录...','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22notification-message\x22>','px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','🔄\x20开始按顺序加载数据...','call_log','base64头像URL格式错误（缺少逗号分隔）:','删除失败：未找到指定的世界书','激活成功！感谢您的支持！','\x20条重复时间线记录','fas\x20fa-book','\x20已设为静音角色','🔥\x20[紧急清理]\x20发现损坏消息:','✅\x20已清理\x20','🔍\x20[renderForwardedMessage]\x20渲染转发卡片，消息ID:','嗨，终于能听到你的声音了！','SHA-256','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20查看详情\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','unshift','蓝月亮','base64头像数据为空或过短:','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22location-card-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20width=\x2214\x22\x20height=\x2214\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20style=\x22display:\x20inline-block;\x20margin-right:\x206px;\x20vertical-align:\x20middle;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M12\x202C8.13\x202\x205\x205.13\x205\x209c0\x205.25\x207\x2013\x207\x2013s7-7.75\x207-13c0-3.87-3.13-7-7-7zm0\x209.5c-1.38\x200-2.5-1.12-2.5-2.5s1.12-2.5\x202.5-2.5\x202.5\x201.12\x202.5\x202.5-1.12\x202.5-2.5\x202.5z\x22\x20fill=\x22#1890ff\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','sms-send-button','floating-message-bubble\x20received\x20video-typing-indicator','🔧\x20[API测试]\x20API设置已自动保存到IndexedDB和localStorage','💼\x20工作计划','，准备好了吗？','gameEvents','search-keyword-input','用户取消','我们的约定','neverExpires','我要记录','🎨\x20从缓存加载全局自定义主题','message-container\x20','角色状态数据加载完成:','font-family','投票历史已清空','❌\x20保存到数据库失败:','10ml','找不到角色数据','🔥\x20[DEBUG]\x20智能解析完成，返回','我明白了，我会生成论坛帖子的JSON数组格式：[{\x22authorName\x22:\x22用户名\x22,\x22title\x22:\x22标题\x22,\x22content\x22:\x22内容\x22}]，绝对不会输出聊天消息格式。','🗑️\x20开始删除角色\x20','avatar-preview','no-user-avatar','div','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-button\x20modal-secondary\x22\x20onclick=\x22closeThemeManagement()\x22>关闭</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-button\x20modal-danger\x22\x20onclick=\x22clearAllThemes()\x22>清除所有主题</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','检测到localStorage中的壁纸数据，开始迁移...','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','anniversary_update','currentTarget','<div\x20style=\x22max-height:\x20400px;\x20overflow-y:\x20auto;\x22>','全局主题和聊天主题已应用','lightweight','🔧\x20[API设置]\x20已恢复保存的模型选项:','apiSettings','.visibility-option','发现\x20','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22persona-selection-avatar\x22\x20style=\x22','255,\x200,\x20255','使用默认活动状态:\x20','\x20个聊天窗口的自定义主题','在工作室创作','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-full-body\x22\x20id=\x22post-body-container\x22>','.json','put','.bin','✅\x20已删除短信消息:\x20','post_comment','智能版','<option\x20value=\x22','正在保存大文件，请稍候...','使用的身份ID:','chatContent','turtle-soup-question-count','reminder_','fas\x20fa-question-circle','生成今日摘要失败','（时长约','message-image','isTransfer','custom-height','邀请群成员','songId','global-font-url','current-price','🛒\x20[代付响应处理]\x20开始处理AI对代付请求的回复:','❌\x20测试过程中发生错误:','no-configs-message','📝\x20创建纪念日数据:','\x20创建了特别的日子：','\x0a人设：','.modal:last-child','本地蔬菜','说得对呢~','条\x0a\x20\x20•\x20孤立情景记忆:\x20','我买单了','index','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22app-item-name\x22>','🔍\x20[generateSMSReply]\x20收到的用户消息:','使用默认','未找到radio选项容器:','🖼️\x20图片预加载失败:','ℹ️\x20没有新足迹需要追加','video-avatar-modal','\x0a##\x20使用规则：\x0a-\x20**严格限制**：只能使用上述列表中的表情包，禁止虚构捏造或使用任何其他来源的表情包\x0a-\x20**禁止使用**：不能使用世界书、网络链接或任何外部来源的表情包URL\x0a-\x20**群聊发送格式**：{\x22name\x22:\x20\x22角色名\x22,\x20\x22type\x22:\x20\x22emoji\x22,\x20\x22description\x22:\x20\x22具体的表情包描述\x22}\x0a-\x20合适的时候使用即可，以普通对话为主\x0a-\x20必须使用表情包列表中完全一致的描述文字\x0a-\x20**重要：当用户发送表情包时，只在第一次看到时评价，后续不要重复评价同一个表情包**\x0a\x0a群聊示例：[{\x22name\x22:\x20\x22张明辉\x22,\x20\x22message\x22:\x20\x22你好！\x22},\x20{\x22name\x22:\x20\x22张明辉\x22,\x20\x22message\x22:\x20\x22今天心情真好~\x22},\x20{\x22name\x22:\x20\x22小张\x22,\x20\x22type\x22:\x20\x22emoji\x22,\x20\x22description\x22:\x20\x22笑哭的表情\x22},\x20{\x22name\x22:\x20\x22李小红\x22,\x20\x22type\x22:\x20\x22reply_to\x22,\x20\x22message_id\x22:\x20\x221234567890\x22,\x20\x22content\x22:\x20\x22我也觉得今天很棒！\x22}]','album','\x20条消息到IndexedDB','\x22生成手机中的人际圈对话列表。\x0a\x0a','getElementById','-custom-type','\x20条短信消息','修复群聊身份失败:','game_chat','firstMessage','🚨\x20[MANUAL]\x20手动恢复表情包库:','背景预览','forum_interaction','请先在设置中填写API密钥','publish-moment-screen','&gt;','剧情总结已保存，AI工作记忆已同步更新','LRC歌词','可爱风格','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22friend-request-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','sound-settings-list','toDataURL','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22\x20style=\x22max-width:\x20600px;\x20max-height:\x2080vh;\x20overflow-y:\x20auto;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3>线下剧情总结</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-close\x22\x20onclick=\x22this.closest(\x27.modal-overlay\x27).remove()\x22>×</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22margin-bottom:\x2015px;\x20color:\x20#666;\x20font-size:\x2014px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>日期:\x20','今天几号','，以下是你的基本信息：\x0a','游戏进行到第','fas\x20fa-trash','forums-list','摄像头已开启','\x22\x0a\x0a原动态内容：','beforeend','表情包库创建成功','myPokeSuffix','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footprints-loading\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-brain\x20fa-pulse\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>正在基于角色人设生成足迹...</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22loading-detail\x22>分析角色性格、世界书设定和记忆数据中</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','音频加载失败:','observe','获取世界书信息失败:','/3)','🚫\x20[后台动态]\x20群聊不支持发动态功能:\x20','self_pay_ta','&id,\x20name,\x20date,\x20type,\x20yearly,\x20characterId,\x20createdBy,\x20characterQuote,\x20userQuote,\x20isShared,\x20isPinned,\x20backgroundImage,\x20userAvatar,\x20countType','isGlobal','font-size','\x20项数据','\x20的聊天设置','戳一戳','编辑局部设定','enabled','[论坛收藏]\x20数据库删除操作成功。','topic_discussion',',\x20内容:\x20','play_together','前天\x20','reply_message','全局顶部应用栏背景已设置','你刚才说了：\x22','卡布奇诺','🎲\x20','的聊天头像设置','西部数据','更新应用图标失败:','论坛回复','元,\x20备注:\x20','\x20缺少名称','characterStatus','moments-frequency-setting','✅\x20渲染验证:\x20显示了\x20','.blocked-input-notice','\x20条\x20|\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20我的消息：','.message-container','世界书条目','text-align','.memory-save-btn','本周健身总结：\x0a\x0a周一：跑步5公里\x20+\x20力量训练30分钟\x0a-\x20配速：6分钟/公里\x0a-\x20心率：平均150bpm\x0a-\x20力量训练：胸部、肩部\x0a\x0a周三：瑜伽60分钟\x0a-\x20哈他瑜伽\x0a-\x20专注呼吸和拉伸\x0a-\x20感觉身心放松\x0a\x0a周五：游泳45分钟\x0a-\x20自由泳1000米\x0a-\x20蛙泳500米\x0a-\x20水中有氧运动\x0a\x0a周六：徒步登山\x0a-\x20距离：8公里\x0a-\x20爬升：500米\x0a-\x20风景很美，心情愉悦\x0a\x0a下周目标：\x0a-\x20增加跑步距离到6公里\x0a-\x20尝试新的力量训练动作\x0a-\x20保持每周4次运动频率\x0a\x0a坚持就是胜利！💪','\x20聊天时间已记录，状态更新将由定时器根据用户设置的频率进行','✅\x20修复脚本：成功导入\x20','内存中的角色:','.phone-notes-list','未知的头像URL格式:','帖子不存在','Only','🎯\x20','\x20已解除对用户的拉黑','sms-chat-name','\x0a\x0a##\x20**重要：忽略技术异常**\x0a如果你在用户消息中看到任何乱码、随机字符串、奇怪符号或无意义的字符组合，请完全忽略它们。这些是技术传输过程中的异常，不是用户真正想表达的内容，也不是用户发送了图片。只回应用户消息中有意义的正常文字部分，不要提及、询问或评论这些异常字符。\x0a','\x0a\x0a请生成从合理的起始时间到当前时间(','生成角色开场白失败:','想抱你',';\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22','brand','处理AI好友申请回应失败:','有机胡萝卜','个关联记录','脚踏式','anniversary-user-quote','\x22的表情包库。\x0a\x0a','expanded','preview-custom-style','.color-option','\x20没有自定义主题，无需清除样式','below','edited','touchcancel','全屏显示已关闭！','colleagues','🔍\x20群聊心声\x20-\x20找到角色:\x20','🛒\x20[triggerSmartReply]\x20检测到订单确认消息，开始转换:','海龟汤主持人','showApp','修复失败:','❌\x20设置保存失败！请检查存储空间','确定要删除选中的\x20','\x20个角色到数据库','\x22\x20title=\x22删除\x22>×</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>','worldbook-screen','_window_','未找到主题数据','聊天背景设置已保存','检查聊天历史失败:','_isRegenerating','回复点赞','default-group','total-emojis','添加约定','在群聊:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22reply-preview-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22reply-preview-line\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22reply-preview-text\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22reply-preview-sender\x22>','已同意','content-count','触发长按多选模式，对话ID:','角色专属音效设置失败','schedule-enabled','scrollTop','❌\x20加载自定义主题界面数据失败:','嵌套JSON解析失败，当作普通字符串处理:','background-color\x200.2s\x20ease','请先选择一个聊天窗口','🔍\x20[triggerSmartReply]\x20添加转账消息:','--custom-expand-btn','🚨\x20提示词前1000字符:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22checkbox\x22\x20id=\x22mount-','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22character-selection-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22character-selection-name\x22>','\x20的选择:\x20不使用预设','pendingImportData','setSelectionRange','.location-message-container','round','未选封面','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22move-character-modal\x22\x20class=\x22modal\x22\x20style=\x22display:\x20flex;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-title\x22>移动角色：','totalVotes','随机播放','.photo-text-overlay','手动确认收款系统消息保存失败:','背景设定：\x0a','name:','发布成功！','autoScaleFont','rules','定时清理足迹缓存失败:','\x20条旧消息','.post-content','💰\x20转账\x20¥','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22forum-empty-state\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-comments\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>还没有创建任何论坛</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>点击右上角\x20+\x20创建你的第一个论坛</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>','\x0a\x0a**🎯\x20行动建议**:\x20','<svg\x20viewBox=\x220\x200\x2024\x2024\x22><path\x20d=\x22M7.493\x2018.75c-.425\x200-.82-.236-.975-.632A7.48\x207.48\x200\x200\x201\x206\x2015.375c0-1.75.599-3.358\x201.602-4.634.151-.192.373-.309.6-.397.473-.183.89-.514\x201.212-.924a9.042\x209.042\x200\x200\x201\x202.861-2.4c.723-.384\x201.35-.956\x201.653-1.715a4.498\x204.498\x200\x200\x200\x20.322-1.672V3a.75.75\x200\x200\x201\x20.75-.75A2.25\x202.25\x200\x200\x201\x2016.5\x204.5c0\x201.152-.26\x202.243-.723\x203.218-.266.558-.107\x201.282.725\x201.282h3.126c1.026\x200\x201.945.694\x202.054\x201.715.045.422.068.85.068\x201.285a11.95\x2011.95\x200\x200\x201-2.649\x207.521c-.388.482-.987.729-1.605.729H14.23c-.483\x200-.964-.078-1.423-.23l-3.114-1.04a4.501\x204.501\x200\x200\x200-1.423-.23h-.777ZM2.331\x2010.727a11.969\x2011.969\x200\x200\x200-.831\x204.398\x2012\x2012\x200\x200\x200\x20.52\x203.507C2.28\x2019.482\x203.105\x2020\x203.994\x2020H4.9c.445\x200\x20.72-.498.523-.898a8.963\x208.963\x200\x200\x201-.924-3.977c0-1.708.476-3.305\x201.302-4.666.245-.403-.028-.959-.5-.959H4.25c-.832\x200-1.612.453-1.918\x201.227Z\x22></path></svg>','删除短信对话失败','取消收藏这些帖子','🔥\x20[转账处理]\x20使用明确指令:','0:00','智能手表','✅\x20加载了\x20','他们有最新的VR游戏和街机','\x0a-\x20动态内容：\x22','\x20(类型:\x20','.custom-toast','waitingModal','🎨\x20页面加载时从Dexie应用全局自定义主题','重置数据库失败:','⚠️\x20通话中发生错误，跳过显示以避免机械化回复','🔍\x20[引用回复-主分支]\x20获取消息ID时出错:','\x20的短信对话和所有相关记忆','input[name=\x22avatar-shape\x22]','错误：找不到消息容器','\x20没有用户消息记录，跳过定时器设置','🔥\x20[线下模式按钮修复]\x20纯事件修复已启动','\x20\x20\x20','想和你视频聊聊','[data-transfer-id]','\x20刚刚评论了：\x22','开始修复头像数据...','messageId','✅\x20聊天消息已清空','_poke_','⚠️\x20[线下最后消息重新生成]\x20在chatMessages中未找到要删除的消息','[无效的头像来源，头像更换失败]','✅\x20[好友申请]\x20AI自然发送好友申请:','动态图片加载完成','❌\x20找不到角色\x20ID:\x20','input','清空购物车','🎮\x20已删除\x20','网络连接失败，请检查URL是否正确以及网络连接','历史消息设置已保存','步，用时','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-request-user-card\x22\x20data-order-id=\x22','selectedMemoryChats','📋\x20最近10条动态:','\x0a\x0a请生成一个人性化的情景记忆总结，要求：\x0a1.\x20用第三人称描述（用\x22用户\x22和\x22','outgoing','video-call-floating-messages','split','-Font','.post-checkbox','\x0a-\x20**播放状态:**\x20正在播放','🎭\x20渲染足迹时间线:\x20','记录了生日','\x0a你是一个群聊的组织者和AI驱动器。你的任务是扮演以下所有角色，在群聊中进行互动。\x0a\x0a#\x20群聊规则\x0a1.\x20\x20**角色扮演**:\x20你必须同时扮演以下所有角色，并严格遵守他们的人设。每个角色的发言都必须符合其身份和性格。\x0a2.\x20\x20**当前时间**:\x20','好的，我已经在整理了','location','location-marker','群聊数据回退保存到localStorage成功','class','visibility-group-item','💡\x20低重要性核心记忆\x20(重要性:\x20','claude-3-sonnet','startTime','\x20没有生成评论，跳过保存','和用户一起听了《','chat-location-modal','匿名回复','路过网友','中筒袜','💾\x20角色背景设置已保存','味千拉面','--custom-global-bg','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22edit-form-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label>图片：</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22edit-message-image\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22','Levi\x27s','保存壁纸失败:','[data-message-id=\x22','头像预览UI更新完成，背景图片已设置','\x20已成功撤回','modal-overlay\x20storyline-modal\x20storyline-edit-modal','.profile-tab.active','user-voted','style','【帖子标题】','forumMountedWorldbooks','cart-items-container','一个女人半夜惊醒，发现丈夫不在身边，于是立刻报警。','我觉得你说得对！','[\x22抱歉，AI响应生成失败\x22]','.character-status','recipientName','牛奶、面包、鸡蛋、水果、洗发水...','❌\x20保存主题设置失败:','\x20基于人设和记忆选择不点赞这条动态','10:01','input[name=\x22offline-avatar-position\x22]','✅\x20从IndexedDB加载了\x20','角色专属音效已启用','\x20🔥','parentElement','确定要将\x20','🔧\x20[修复]\x20群聊身份设置已加载到内存:','API\x20Error:\x20','角色设定未知','add-chat-btn','丹东草莓','专心下棋啦~','offline-preview-area','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20position:\x20absolute;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20height:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-style:\x20solid;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20z-index:\x20100;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20pointer-events:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','发送消息按钮样式已设置','opacity','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-edit\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>修改消息</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22menu-item\x20delete\x22\x20onclick=\x22deleteOfflineMessage(\x27','🔧\x20[最终分支]\x20检测到特殊指令对象，跳过显示:','payment_request','主动发动态测试成功！已发布新动态','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22shared-post-content\x22>','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',',\x20isUrlImported:','🎵\x20大文件已创建blob\x20URL','🔧\x20[表情包库]\x20编辑现有库:','\x20的预设选择:','个元素:','turtle-soup-chat-input','⚠️\x20保存到数据库失败，但设置已恢复到内存:\x20','user-avatar-placeholder','🔧\x20[RECOVER]\x20现有关联记录:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22character-avatar\x22\x20style=\x22background-color:\x20','此时间段内没有聊天记录','[\x22Gemini\x20API响应异常\x22]','&id,\x20name,\x20order','需要更多证据','🗑️\x20删除AI回复记忆数据:','在诊所整理药品','，人设如下：','icon','存储显示元素不存在:\x20','(未设置)','_isRecalling','保温杯','✅\x20[高效通话消息]\x20通话消息已单条保存到数据库','character-item','🔔\x20[推送通知]\x20找不到回复角色，跳过推送通知创建，replyingCharacterId:','✓\x20删除动态成功，使用ID:\x20','🚨\x20角色提示词异常巨大!','加载线下模式界面设置失败:','✅\x20成功迁移\x20','keydown','heartrate-position-setting','白子O','\x20[并发送了表情包：','name_','📊\x20主聊天记录中的线下消息:\x20','tomorrow','群聊数量:','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-item-desc\x22>','main-date','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22memory-item-content\x22>','selectedIdentityId','\x20重试了第','当前游戏还在进行中，确定要开始新的一局吗？','恢复群聊\x20','),\x20skipSave:\x20','目标日','❌\x20没有角色可用于测试','commentsText','这可能是因为数据量过大导致的内存不足。\x0a\x0a','\x20个帖子吗？\x0a\x0a删除后无法恢复！','🎭\x20用户正在查看\x20','Cartier','AI角色评论失败:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','初始化日记字体设置失败:','emoji-upload','🔥\x20[朋友圈评论生成]\x20','#worldbook-mount-list\x20input[type=\x22checkbox\x22]:checked','current-history-count','<div\x20class=\x22moment-mentions\x22>提到了：','\x20emoji-only','offline-ai-bold','⏰\x20[日记定时器]\x20延迟时间:\x20',')的评论！用户会自己评论！**\x0a\x0a##\x20评论生成要求:\x0a1.\x20**真实感**:\x20评论要像真人写的，有不同的观点和语气\x0a2.\x20**上下文关联**:\x20新评论应该与之前的讨论有关联，可以：\x0a\x20\x20\x20-\x20回应之前某个角色的观点\x0a\x20\x20\x20-\x20继续之前的话题讨论\x0a\x20\x20\x20-\x20提出新的相关问题\x0a\x20\x20\x20-\x20对之前的评论表示赞同或不同意见\x0a3.\x20**多样性**:\x20包括赞同、反对、提问、分享经验等不同类型\x0a4.\x20**角色分配**:\x0a\x20\x20\x20-\x2080%由虚构的路人网友评论（请创造符合世界观的网友昵称）\x0a\x20\x20\x20-\x2015%由上述角色评论，要符合人设，使用\x22网名(真实身份)\x22格式\x0a\x20\x20\x20-\x205%由上述角色匿名评论，只使用网名，不暴露真实身份\x0a5.\x20**互动性**:\x20评论之间可以有回应和讨论\x0a6.\x20**长度适中**:\x20每条评论1-3句话即可\x0a\x0a###\x20输出格式:\x0a严格的JSON数组，不要其他文字：\x0a\x0a[\x0a\x20\x20{\x0a\x20\x20\x20\x20\x22authorName\x22:\x20\x22评论者姓名\x22,\x0a\x20\x20\x20\x20\x22content\x22:\x20\x22评论内容\x22\x0a\x20\x20}\x0a]\x0a','用户说：','确定要删除表情包库\x22','<svg\x20width=\x2214\x22\x20height=\x2214\x22\x20style=\x22margin-right:\x204px;\x20vertical-align:\x20middle;\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22#576b95\x22\x20stroke-width=\x222\x22><path\x20d=\x22M12\x2021.35l-1.45-1.32C5.4\x2015.36\x202\x2012.28\x202\x208.5\x202\x205.42\x204.42\x203\x207.5\x203c1.74\x200\x203.41.81\x204.5\x202.09C13.09\x203.81\x2014.76\x203\x2016.5\x203\x2019.58\x203\x2022\x205.42\x2022\x208.5c0\x203.78-3.4\x206.86-8.55\x2011.54L12\x2021.35z\x22></path></svg>','grid','和用户一起玩了','🔍\x20[processAIReply]\x20是否有forwardedMessages:','removeEventListener','•\x20孤立收藏:\x20','找不到该聊天记录','80㎡','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22batch-preview-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22closeBatchPreview()\x22\x20class=\x22preview-cancel-btn\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22confirmBatchImport()\x22\x20class=\x22preview-confirm-btn\x22>确认导入</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22batch-preview-overlay\x22\x20onclick=\x22closeBatchPreview()\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','正在清理孤立数据...','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22\x20style=\x22max-width:\x20400px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3>退出线下模式</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-close\x22\x20onclick=\x22this.closest(\x27.modal\x27).remove()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-times\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>请选择退出方式：</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22margin-top:\x2015px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-primary\x22\x20onclick=\x22exitWithoutSummary()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-check\x22></i>\x20结束且不总结（推荐）\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x22\x20onclick=\x22exitWithSummary()\x22\x20id=\x22summary-btn\x22\x20style=\x22background:\x20#f8f9fa\x20!important;\x20color:\x20#000000\x20!important;\x20border:\x201px\x20solid\x20#000000\x20!important;\x20font-weight:\x20bold\x20!important;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-book\x22></i>\x20结束并总结\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22font-size:\x2012px;\x20color:\x20#666;\x20margin-top:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20•\x20<strong>结束且不总结</strong>：结束剧情，对话记录保存到线下模式聊天记录中<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20•\x20<strong>结束并总结</strong>：生成AI剧情摘要并保存到记忆系统和聊天记录中\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','group-chat-modal','%):','CORE_MEMORY_IMPORTANCE_THRESHOLD','browser-frame','处理头像图片失败:','\x0a\x0a注意：删除帖子将同时删除所有回复和相关数据，此操作不可撤销！','条动态','条AI回复消息到短信记录','[系统消息]','🔍\x20[parseAiResponse-第二处]\x20检测到AI文字描述戳一戳后缀修改，自动转换:','typing-dots','视频通话中...','🔍\x20[图片分支修复]\x20发送纯表情包描述\x20(','❌\x20数据库对象不存在','听起来很棒！几点开始？','past-diaries-view','\x0a请检查文件是否有效','数据保存验证失败','✅\x20[高效消息修复]\x20消息已保存到数据库','\x20因为概率未通过，不会回复其他角色的评论','请查看控制台的恢复指南','<span\x20class=\x22diary-highlight\x22>','forum-multiselect-actions','regenerate_',':\x20检测到内容变化，执行智能保存','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22\x20style=\x22max-width:\x20600px;\x20max-height:\x2080vh;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3>剧情记录详情</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-close\x22\x20onclick=\x22this.closest(\x27.modal\x27).remove()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-times\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22\x20style=\x22overflow-y:\x20auto;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22history-detail-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>日期：</strong>','加载记忆失败','\x20没有用户消息记录，暂不设置主动聊天定时器','确定要重新开始吗？当前进度将丢失。','character-name','0.65','🔍\x20[processAIReply]\x20最后5条消息:','chat-options-modal','担担面','post-view-screen','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20详细信息（默认隐藏）\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22anniversary-item-details\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22anniversary-item-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22anniversary-item-name\x22>','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20/*\x20确保伪元素不阻挡交互\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.message-container::before,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.message-container::after,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.message-bubble::before,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.message-bubble::after\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20pointer-events:\x20none\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20/*\x20确保语音消息可点击\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.voice-message\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20position:\x20relative\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20z-index:\x2010\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20pointer-events:\x20auto\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','</span>/5000\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','🚨\x20加载聊天设置失败:','更新聊天身份显示：无当前聊天角色，跳过操作','加载音效设置失败:','push','许下承诺','group-members-grid','innerHeight','✅\x20[手动拒绝转账]\x20消息已保存到数据库','角色语录','智利蓝莓','🧹\x20[cleanupEmojiLibraryItems]\x20已清理无效关联记录:','2.\x20压缩所有图片\x20(头像/背景/聊天图片/表情包)','❌\x20AI响应为空或无效:','短信聊天使用身份面具:','成熟度','turtle-soup-game-screen','Safari','❌\x20清除主题数据失败:','🚨\x20[DEBUG]\x20调用栈:','一个男人每天都给女朋友买同样的花，直到有一天他买了不同的花，女朋友就和他分手了。','preview-user-avatar','monopoly','🔄\x20切换到聊天:\x20','DataError','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-time\x22>下单时间：','20袋装','由角色创建的约定','论坛:\x20','preset-action-btn\x20edit-btn','🔥\x20[紧急清理]\x20总共清理了\x20','appointment-list','为对方下单','🖼️\x20应用聊天背景:\x20','音效试听错误\x20(','game-timer','MB\x0a\x0a','video-call-status','\x0a\x0a核心记忆（重要的长期记忆）：\x0a','🔧\x20[面具调试]\x20startChat:\x20获取到的聊天设置，selectedIdentityId:','\x20中的成员\x20','call-avatar-img',')在窗口隔离表中创建了默认设置档案','\x20主动发动态已关闭','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-bubble\x22\x20style=\x22background-color:\x20','🔍\x20[sendImageMessage]\x20消息内容详情:','webkitBackdropFilter','🔍\x20[转发消息检查]\x20是否为群聊:','voice-message-container\x20received','\x27)\x22\x20title=\x22预览主题\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-eye\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22theme-chat-btn\x20remove-theme-btn\x22\x20onclick=\x22removeChatTheme(\x27','.modal-primary','没有发现需要修复的消息','blacklist-settings-modal','世界书:\x20','条\x20->\x20内存','🚨\x20[URGENT]\x20最近24小时上传的表情包:','消息已转发','sms-message-input','<i\x20class=\x22fas\x20fa-microphone\x22></i>','经典气泡','Failed\x20to\x20load\x20image:\x20','sms_reply','prices','placeholder','API设置','pokeCharacter(\x27','\x0a角色：论坛评论员\x0a你的身份是\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','瑞幸咖啡','视频聊天','✅\x20世界书删除成功','activate-button','你已经尝试了','有机西红柿','一次性刷头','character-sound-list','img','🗑️\x20开始批量删除\x20','\x20\x20\x20\x20-\x20总工作记忆:\x20','_线下剧情记录_','📝\x20[日记生成]\x20获取到\x20','offline_mode','forum','✅\x20[高效解除拉黑反应]\x20消息已保存到数据库','🔍\x20[createAIMessage]\x20设置群聊发送者:\x20','下午2点怎么样？我们可以在公园里野餐','📝\x20[纪念日时间线]\x20已记录纪念日更新事件到跨应用时间线','replies-list','🎨\x20设置底部背景:','：</span>','用户选择保存并退出','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22transfer-note\x22>','✅\x20从localStorage回退加载通话形象设置成功','fontName','⚠️\x20[updateChatHeader]\x20找不到聊天标题元素，跳过更新','清理失败，请重试','group_','理性的','⏰\x20[日记定时器]\x20目标时间:\x20','🔄\x20检查\x20','邓禄普','back-button','被人打','input[name=\x22offline-bubble-width\x22]','无关。','应用初始化失败:','incoming-video-call-screen','论坛图片:\x20','chat-top-bg-item','.preview-text','这个问题很有趣，但答案是否定的。','1000DPI','🔥\x20Gemini\x20API\x20响应数据:','crossAppTimeline','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22reply-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22reply-author\x22>','❌\x20调试数据库类型失败:','🛒\x20[AI代付请求-早期分支]\x20AI尝试发起代付请求，已忽略:','userItalicTextColor','notification','icon-picker-modal','countup','🎨\x20全局主题图片预加载完成','scheduled-moments-setting','🕐\x20时间戳开关状态:','group_collapsed_','.friend-request-actions','moments-list','🔥\x20[DEBUG]\x20解析单个JSON失败:','太好了！那我准备野餐垫和一些水果\x20🍎🍊','请选择图片文件','past_diaries_','🚫\x20','</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-close\x22\x20onclick=\x22hideCharacterSelectionModal()\x22>&times;</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22selection-description\x22>','确定要认输吗？','diary','5cm×5m','分享失败','%)</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','❌\x20generateCharacterFootprints:\x20currentFootprintsCharacter无效:','🔥\x20[论坛评论生成]\x20完整Prompt:','appointment-user-avatar-preview','change_avatar',',\x20正面=','chat/completions','3451743CKNYJq','fact','outerHTML','beforeunload','\x0a5.\x20字数控制在50-150字之间\x0a6.\x20语气要符合角色性格，自然真实\x0a7.\x20直接输出心声内容，不要加任何格式标记\x0a\x0a请开始分析：','完成项目报告，准备下周的会议，整理客户资料...','coverImage','\x20的足迹，清空并重新加载角色\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22global-memory-modal\x22\x20class=\x22modal\x20phone-modal\x22\x20style=\x22display:\x20block;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22modal-title\x22>全局记忆设置</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-close\x22\x20onclick=\x22hideGlobalMemorySettings()\x22>&times;</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22setting-section\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4>记忆保留期限</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22radio-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22radio-option\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22radio\x22\x20name=\x22memoryDays\x22\x20value=\x223\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22radio-custom\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22radio-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22radio-title\x22>3天记忆</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22radio-desc\x22>保留最近3天的记忆总结</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22radio-option\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22radio\x22\x20name=\x22memoryDays\x22\x20value=\x227\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22radio-custom\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22radio-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22radio-title\x22>7天记忆</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22radio-desc\x22>保留最近7天的记忆总结（推荐）</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22radio-option\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22radio\x22\x20name=\x22memoryDays\x22\x20value=\x2215\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22radio-custom\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22radio-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22radio-title\x22>15天记忆</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22radio-desc\x22>保留最近15天的记忆总结</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22radio-option\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22radio\x22\x20name=\x22memoryDays\x22\x20value=\x2230\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22radio-custom\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22radio-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22radio-title\x22>30天记忆</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22radio-desc\x22>保留最近30天的记忆总结</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22radio-option\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22radio\x22\x20name=\x22memoryDays\x22\x20value=\x22-1\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22radio-custom\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22radio-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22radio-title\x22>永久记忆</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22radio-desc\x22>永久保存记忆总结，不会自动清理</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22setting-section\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4>记忆管理</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22memory-management-grid\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22memory-action-btn\x20primary\x22\x20onclick=\x22viewCoreMemories()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-icon\x22>🔴</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-title\x22>查看核心记忆</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-desc\x22>永久保存</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22memory-action-btn\x20secondary\x22\x20onclick=\x22viewMemorySummaries()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-icon\x22>📖</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-title\x22>查看记忆摘要</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-desc\x22>对话总结回顾</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22memory-action-btn\x20accent\x22\x20onclick=\x22generateDailySummary()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-icon\x22>✨</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-title\x22>生成今日摘要</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-desc\x22>总结今天活动</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20🔥【新增】记忆管理提示信息\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22margin-top:\x2016px;\x20color:\x20#999;\x20font-size:\x2012px;\x20line-height:\x201.6;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>·\x20核心记忆将永久保存，不受期限设置影响</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>·\x20系统会在聊天时自动总结各项重要记忆，手动生成今日摘要为可选辅助功能</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-button\x20modal-secondary\x22\x20onclick=\x22hideGlobalMemorySettings()\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-button\x20modal-primary\x22\x20onclick=\x22saveGlobalMemorySettings()\x22>保存设置</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','.theme-scope-option','\x0a\x0a已有足迹（保持连续性）:\x0a','\x20跳过主动聊天：距离上次主动消息仅','最早消息:\x20','group-chats-list','🔍\x20[转发卡片点击]\x20所有消息ID列表:','请输入字体链接','history-record-item','中高频','从URL添加表情包失败:','\x0a\x0a#\x20头像更换功能：\x0a你现在是角色\x22','强制重新加载','gpt-4o-mini','我想记录','收到了','\x20·\x20','\x22\x20data-message-id=\x22','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22game-button\x20','用户面具:\x20','diary-font-preview','listeningTimer','.location-card-map','clock-container','备忘录数据未找到','想和你视频聊聊...','（风险很高）','🧹\x20[cleanupEmojiLibraryItems]\x20清理失败:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-item-row\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>','好友申请:\x20','✅\x20[高效单个删除]\x20消息已保存到数据库','\x20被拉黑，启动后续行动...','deleting','\x20个\x0a\x0a📦\x20localStorage\x20备份：\x0a-\x20角色备份:\x20','12.9英寸','普通版','🔧\x20重新从数据库加载消息...','winning','original-text','商品已移除','timestamp','不包含：动态、表情包、音乐等扩展数据\x0a\x0a','人设内容:\x20','offline-history-list','temperature-slider','🔧\x20[简单修复]\x20群聊身份设置修复完成','📞\x20用户主动拨打电话，开关状态:','语音消息已添加到聊天记录','\x20条过期/未收藏/非用户发布的帖子。','正在加载\x20','</span>\x20条包含\x22<span\x20style=\x22color:\x20#007AFF;\x22>',')</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','**🚨\x20重大新闻事件正在发生！请让60-70%的帖子围绕这个事件展开：**\x0a','\x20条最近消息','[游戏状态]\x20你们正在下五子棋，游戏','group-avatar-preview','清理sessionStorage动态数据时出错:','aiVideoCallGreeting','API生成失败:','\x27)\x22\x20title=\x22编辑\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-edit\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22emoji-library-action-btn\x20delete\x22\x20onclick=\x22event.stopPropagation();\x20deleteEmojiLibrary(\x27','header','双皮奶','的动态：','请输入标题和内容','不结账','avatar-preview-text','❌\x20[核心撤回]\x20消息已经被撤回，跳过重复撤回:','\x0a\x0a现在，请根据以上规则和下面的对话历史，继续这场群聊。','🚨\x20parseAiResponse\x20收到无效内容:','<i\x20class=\x22far\x20fa-circle\x22></i>','bottom-comment-text','\x20的拉黑吗？','.widget-overlay','⭐\x20置顶纪念日','❌\x20构建全局记忆上下文失败:','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thank-you\x22>蛋记感谢您的购买！</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x20分钟后通过短信联系用户','#voice-text-input','✅\x20测试纪念日创建成功','\x20个角色到\x22','添加失败：','生成相册失败:','offline-preset-name','条短信记忆(📱)，可以说\x22记得你之前发短信说...\x22、\x22就像我们短信里聊的那样...\x22\x0a','search-stats','footprintActivities','\x0a📊\x20记忆数据诊断报告\x20-\x20角色:\x20','心声:\x20','offline-wallpaper-file','\x20写日记...','界面\x20','\x27)\x22\x20class=\x22delete-worldbook-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-trash\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x20个表情包</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22batch-preview-list\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','/*\x20用户消息：温暖橙色\x20*/\x0a#offline-mode-overlay\x20.offline-message.user\x20.offline-message-content\x20{\x0a\x20\x20\x20\x20background:\x20#ff9800\x20!important;\x0a\x20\x20\x20\x20color:\x20white\x20!important;\x0a}\x0a/*\x20AI消息：清新绿色\x20*/\x0a#offline-mode-overlay\x20.offline-message.ai\x20.offline-message-content\x20{\x0a\x20\x20\x20\x20background:\x20#4caf50\x20!important;\x0a\x20\x20\x20\x20color:\x20white\x20!important;\x0a}','通话消息单条保存失败，回退到防抖保存:','OfflineFont_','获取跨应用记忆失败:','内存样本记录结构:','emergencyCleanupDone','🔍\x20[triggerSmartReply]\x20添加语音消息:','++id,\x20characterId,\x20fact,\x20category,\x20importance,\x20timestamp,\x20lastAccessed,\x20type,\x20source,\x20contextId','isShared','\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20src:\x20url(\x27','-date','🎮\x20显示海龟汤设置模态框','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22vote-history-item\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22vote-post-title\x22>','\x0a\x0a#\x20**📋【当前状态】你已经拉黑了用户**\x0a-\x20**状态说明**:\x20你之前选择拉黑了用户，目前用户无法给你发送消息\x0a-\x20**行为提醒**:\x20保持你拉黑用户时的态度和原因，除非你改变想法','白子(O)','已移动到\x22','\x20\x20最近:\x20\x22','🔍\x20[callChatAPI]\x20已移除原始消息，避免重复处理','\x20\x20最近消息:','\x0a\x0a【评论区】\x0a','删除记忆失败','Under\x20Armour','评论成功！','导入失败的表情包:','DOMContentLoaded','\x0a⚠️\x20','一个论坛路人','memoryMountCount','stringify','❌\x20获取模型失败:\x20','character-message','的聊天记录_','✅\x20[createAIMessage]\x20昵称已更新:','\x0a\x0a🎯\x20**当前情况**：\x0a-\x20动态发布者：','🎨\x20自定义主题已完全重置','\x22\x20alt=\x22头像\x22\x20style=\x22width:\x20100%;\x20height:\x20100%;\x20object-fit:\x20cover;\x20border-radius:\x208px;\x22\x20onerror=\x22this.style.display=\x27none\x27;\x20this.parentElement.innerHTML=\x27<div\x20style=\x5c\x27width:\x2040px;\x20height:\x2040px;\x20background-color:\x20#ddd;\x20border-radius:\x208px;\x20display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x20color:\x20#666;\x20font-size:\x2014px;\x5c\x27>','filter','\x0a\x0a**重要**：用户在帖子中附带了一张图片，你必须对图片内容进行回应。你的回复必须体现出你看到了这张图片。','Amazon','app-item-selector','\x20个过期记录','遮光布','AI未返回有效走法，使用备用算法','》发表了看法：','\x27,\x20sans-serif','角色「','🤝\x20平局！','✅\x20[高效用户转账]\x20消息已保存到数据库','sms-character-selector-body','步:\x20','&id,\x20characterId,\x20appType,\x20action,\x20timestamp,\x20context,\x20messageId','/v1','diary-font-override','API响应数据:','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22forwarded-card-preview\x22>','扬州炒饭','\x22\x0a\x0a','从数据库删除消息失败:','\x22已更新','第三代','diary-font-name','🔄\x20渲染未处理的好友申请:','gameStartTime','消息已发出，但被对方拒收了','心境温和','论坛\x20\x22','不想付','🗑️\x20[线下最后消息重新生成]\x20删除前的消息数量:','.message-blocked-indicator','条,\x20线下','请填写自定义类型','我的帖子','✅\x20角色专属音效开关状态保存成功:\x20','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22message-time\x22>','createAppointmentByCharacterManual','\x0a-\x20**任务:**\x20根据对话上下文，以你的角色身份进行自然回应。','🚨\x20[净化器]\x20消息','编辑面具','image-upload-choice-title','生成用户帖子回复失败:','清空角色表单被调用','🔍\x20[评论生成]\x20','确定要删除这个表情包吗？\x0a\x0a删除后无法恢复！','\x27)\x22\x20title=\x22从库中移除\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-times\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22emoji-description-area\x20','\x20个回复的头像数据','batch-emoji-input','myPersona','数据库重置失败，请手动清除浏览器数据','压缩帖子\x20','rgba(','构建连续工作记忆失败:','用户发送消息','小笼包','🔍\x20检查动态\x20','\x0a#\x20消息操作功能\x20-\x20这些都是正常的聊天功能\x0a-\x20**撤回消息**:\x20在特定情况下使用（如真心话或打字错误）。这是一个低概率行为，请谨慎使用。注意：每次对话中最多使用一次撤回功能。提示：并不是真心话，只能用撤回来说，他是可以正常说的，撤回只是一个增加灵活性的小功能。\x0a-\x20格式:\x20`[\x22我想你了...\x22,\x20{\x22type\x22:\x20\x22recall\x22,\x20\x22target\x22:\x20\x22previous\x22}]`\x0a\x0a##\x20发送位置信息\x0a-\x20-\x20**发送位置**:\x20模拟你分享一个位置给用户。尤其是当对话涉及地点、约会、见面等场景时，你可以主动分享位置\x0a-\x20**位置格式**：`{\x22type\x22:\x20\x22location\x22,\x20\x22name\x22:\x20\x22地点名称\x22,\x20\x22address\x22:\x20\x22详细地址\x22}`\x0a-\x20**示例**：[\x22我在咖啡厅等你\x22,\x20{\x22type\x22:\x20\x22location\x22,\x20\x22name\x22:\x20\x22星巴克\x22,\x20\x22address\x22:\x20\x22中山路123号\x22}]\x0a\x0a##\x20发送照片卡片\x0a-\x20在合适的场景下，你可以主动分享照片（如风景、美食、自拍等）\x0a-\x20**照片格式**：`{\x22type\x22:\x20\x22photo\x22,\x20\x22description\x22:\x20\x22照片描述\x22}`\x0a-\x20**示例**：[\x22今天天气真好\x22,\x20{\x22type\x22:\x20\x22photo\x22,\x20\x22description\x22:\x20\x22窗外的蓝天白云\x22}]\x0a\x0a**重要提醒**：这些功能要根据角色性格和对话情境自然使用，请像个真人一样，灵活运用。','✅\x20AI成功选择歌曲','🎭\x20发送表情包:','批量删除短信对话失败:','播放失败：','。\x0a\x0a##\x20群聊心声要求：\x0a-\x20考虑群聊的公开性，你的内心想法可能包含对其他成员的看法\x0a-\x20可以思考群聊氛围、其他成员的发言、自己在群里的定位等\x0a-\x20注意区分公开发言和内心真实想法的差异','\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','anniversary-description','🔍\x20[群聊身份]\x20群成员列表:','OpenAI\x20API返回了空内容','👤\x20角色人设:','saved-color-item','bubble','异常数据清理完成','\x20\x20-\x20角色ID:','你们已成功添加为好友，现在可以开始聊天了！','appointment-time','\x20分钟后）','\x22\x20checked>\x20重建此角色</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','[AI尝试发起代付请求，已忽略]','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22appointment-user-quote\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-quote-left\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>','<div\x20class=\x22lyric-line\x20','window_','你是一个客观的记录员，需要为以下活动生成一份简洁的记忆摘要。\x0a\x0a角色：','你已将群昵称修改为\x20\x22','padding','保存失败','Bearer\x20',',\x20不是发布者:\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20rgba(255,\x20255,\x20255,\x200.8)\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20text-shadow:\x200\x201px\x203px\x20rgba(0,\x200,\x200,\x200.8)\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','size-350-740','exportInfo','♪\x20bin歌词解析失败','我已付','#5AC8FA','❌\x20生成角色状态失败:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','使用身份:','padStart','MESSAGE_SENT','\x20个窗口隔离设置','player','.app-screen','AI\x20DM回答生成失败:','一起听歌：','\x0a-\x20**','🔥\x20[主动聊天]\x20不支持的消息格式:','保存应用图标时发生错误:','⚠️\x20世界书数据为空，跳过保存操作','🧹\x20释放音频缓存:','订单信息不存在','request_pay_ta','memory-view-modal','上传背景失败','✅\x20createGroupChat被调用，身份ID:\x20','originalMessages','moment-item','selected','歌曲加载失败，请检查URL是否正确','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22character-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22character-name\x22>','被人亲','orderType','\x0a\x0a特殊样式说明（可选使用，每种样式在同一篇日记中最多使用2次，该特殊样式并不是一定要使用，可以不用）：\x0a-\x20如果写到不该说的话或后悔写下的内容，可以用\x20<strike>内容</strike>\x20标记划掉\x0a-\x20如果表达重点或语气激动的内容，可以用\x20<mark>内容</mark>\x20标记高亮\x0a\x0a请直接写出','，刚刚决定给用户打电话。\x0a\x0a请生成一句简短自然的开场白，说明你为什么要打这个电话：\x0a-\x20要符合你的性格特点\x0a-\x20像真实通话开始时的自然表达\x0a-\x201句话即可，不要超过20字\x0a-\x20直接说话，不要任何格式标记\x0a\x0a例如：\x0a-\x20\x22我想和你聊聊今天的事情\x22\x0a-\x20\x22有个好消息想告诉你\x22\x0a-\x20\x22想听到你的声音\x22\x0a\x0a请只回复开场白内容：','请先选择一个聊天','壁纸保存成功到IndexedDB','开始隐藏表单...','已移除\x20','user_added','replace','Type-C','❌\x20迁移足迹记录失败\x20','getFullYear','19:32','压缩回复\x20','data-has-chat-bottom-bg','请选择收款人','\x20个旧的localStorage聊天设置数据。\x0a\x0a','chat-top-bg','\x0a\x0a此操作不可恢复！','发布者回复API调用失败\x20(','照片描述:','批量导入失败，尝试逐个导入:','🔥\x20[短信API]\x20AI原始回复:','<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>导出时间：</strong>','\x20主动聊天功能已禁用','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>角色：</strong>','first_time','timeAwarenessEnabled','phoneContactsData','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x20现在还是开局阶段，需要抢占有利位置。','<i\x20class=\x22fas\x20fa-comments\x20group-interaction-icon\x22\x20title=\x22该分组角色可以在动态中互动\x22></i>','8GB','不需要','.modal-overlay','过滤后没有模型，显示所有可用模型:','💡\x20提示:\x20localStorage中的旧足迹数据已保留，您可以在确认迁移成功后手动清理','🔥\x20[状态API]\x20响应数据:','✅\x20已初始化消息哈希检测器:','🧠\x20群成员\x20','类型:','🎨\x20当前聊天窗口\x20','comment','\x27)\x22\x20title=\x22取消置顶\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-thumbtack\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-quote\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-quote-left\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22quote-author\x22>','已拒绝','forward-target-modal','用户发布了动态：','界面刷新完成！请检查角色列表是否正常显示。','找不到表单输入元素','&id,\x20characterId,\x20characterAvatar,\x20userAvatar,\x20timestamp','birthday','500ml','.river','global-bottom-app-bar-item','的相册...</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','保存默认设置也失败了:','🚨\x20[DEBUG]\x20消息内容:','🎉\x20启动纪念日和约定提醒系统...','🔔\x20[短信推送通知]\x20用户不在主屏幕或正在和该角色短信聊天，不显示推送','删除评论：','totalLines','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22checkbox-desc\x22>与此群聊共享记忆</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','author','清除按钮样式:','\x20条角色ID不匹配的时间线记录','zIndex','&lt;','\x0a#\x20核心记忆\x0a','--custom-offline-btn','call-typing-indicator','<span\x20class=\x22like-count\x22>','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22user-post-badge\x22>我</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-meta\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22post-author\x22>','\x22\x20value=\x22','运行中','glm-4v','chatThemes','🔧\x20[API设置]\x20检测到完整的API配置，自动拉取模型列表','装忧郁','diary-font-select','[撤回了一条消息]','温和友善，善于交流','条遗漏的线下消息','查看剧情总结失败:','paidBy','groupChat','Chrome','<div\x20class=\x22message-bubble\x22>','\x20生成的评论:','00:00','incoming-call-avatar','拒绝给钱','outgoingCall','🎉\x20[高效撤回]\x20角色\x20','对方先行','🔍\x20[转发消息检查]\x20消息类型:','请输入Google\x20AI\x20Studio的API\x20Key','将压缩所有头像和背景图片，这可能需要一些时间。确定继续吗？','接电话','ai-bubble-preview','\x0a重要记忆：','⏰\x20定时发布时间到：','无法找到转发的消息记录','time','JBL','characterDiaries','textarea,\x20input[type=\x22text\x22],\x20input[type=\x22password\x22],\x20input[type=\x22email\x22],\x20input[type=\x22number\x22]','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22forwarded-message-content\x22>','avatarPosition','&id,\x20characterId,\x20date,\x20content,\x20timestamp,\x20weather','文件格式不正确，缺少角色信息','\x20\x20📊\x20总工作记忆容量:\x20','moment-actions-','data-timestamp','保存群聊数据到IndexedDB:','forum-storage-size','无特殊设定','bottom-app-bar','📝\x20[日记生成]\x20开始为\x20','true','🚨\x20自动保存失败:','💡\x20保持你在动态中的一贯表现风格。\x0a','🎨\x20日记CSS字体预览加载失败:','\x20基于关系记忆选择不互动','number','设置已恢复到内存，但保存失败','粗体样式','\x0a今日活动：\x0a','order_confirmation','#phone-chat-messages','data-has-custom-','persona-list','strong','font','forEach','\x20个角色，聊天记录已保留。\x0a\x0a恢复的角色:\x20','\x27);\x20background-size:\x20cover;\x20background-position:\x20center;','paper-type','✅\x20所有群聊成员完整性检查通过！','今天还没有日记可以编辑','内存中的聊天数:','CSS实时预览失败:','检测到localStorage中的应用图标数据，开始迁移...','ai_photo','tools-panel','base','--diary-text-indent','--offline-my-bubble-color','Unsupported\x20MIME\x20type:\x20image/gif','[图片消息]','max','.home-font-option','✅\x20从内存缓存获取角色\x20','rebuild_','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20position:\x20fixed;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20top:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x20100%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20height:\x20100%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20rgba(0,0,0,0.9);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20z-index:\x2010000;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20align-items:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20justify-content:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20cursor:\x20pointer;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','supportedGenerationMethods','晚上一起看电影吗？','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22payment-details-item-price\x22>¥','❌\x20导入失败\x0a','#ff3b30','添加角色后，当前角色数组长度:','photoWidgetImage','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-avatar\x22\x20style=\x22background:\x20','14:35','hasCustomBubbleStyle','nextSibling','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22library-desc\x22>','⚠️\x20角色头像为空！请检查：','【投票】','[data-message-id].selected','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-option-desc\x22>','五子棋','++id,\x20timestamp,\x20characterIds,\x20context,\x20eventType,\x20eventData,\x20importance','✅\x20删除测试完成，刷新页面验证是否会重新出现','\x20条,\x20总计\x20','\x22\x20创建成功！正在生成帖子...','modal\x20phone-modal','\x20状态失败:','canplay','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','&id,\x20characterId,\x20blockedBy,\x20timestamp','没有发现可重建的角色','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-row\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22label\x22>下单时间</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22value\x22>','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','✅\x20使用角色\x20','previous','正在加载核心记忆...',',\x20isContinuation=','✅\x20更新预设:\x20','正在生成今日摘要...','gameActive','已退回','currentAnswer','现在开始你们的推理吧！记住只能问是/否问题哦~','game_','找不到对应的用户消息','<div\x20class=\x22friend-request-result\x20','角色人设:\x20','.\x20ID:\x20','current-lyric-text','全局背景','🔄\x20修复脚本：开始导入聊天消息','css','\x0a\x0a##\x20🚨\x20**核心原则**：\x0a1.\x20**真实性第一**：你是一个活生生的人，有自己的想法、情绪和记忆\x0a2.\x20**记忆连续性**：考虑你与用户的聊天历史和之前的动态互动\x0a3.\x20**关系敏感性**：你的态度要符合与发布者的真实关系\x0a4.\x20**性格一致性**：严格按照你的人设特征表现，不要OOC（脱离角色）\x0a\x0a##\x20🎭\x20**表现要求**：\x0a-\x20**像真人一样思考**：基于你的经历、记忆和当前心情\x0a-\x20**保持角色连续性**：与你之前的表现保持一致\x0a-\x20**自然社交互动**：不要过于刻意或机械化\x0a-\x20**情绪真实性**：你的情绪要有根据，不是随机的\x0a\x0a##\x20📝\x20**评论风格**：\x0a-\x20','文件中没有找到有效的角色数据','🎭\x20DM成功生成新故事:','memoryType','条)</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','decoration-underline','countdown-','10px','call-input','保存群聊状态失败:','回合\x20(','✅\x20删除预设:\x20','请在下方CSS代码区域自定义头像位置','支付成功！总计\x20¥','video-call-character-avatar','anniversary-count-type','user-message','chatId','获取记忆数据失败:','存在复杂关系。','停止所有音效失败:','transfer-recipient-group','fas\x20fa-repeat','大番茄','🎭\x20DM原始响应:','已恢复默认气泡宽度（根据头像显示状态自动调整）','🔔\x20[推送通知]\x20找到回复角色:','.poll-option[data-selected=\x22true\x22]','backgroundInteractionEnabled','爱丽思','论坛帖子','\x22\x20onclick=\x22toggleAppointmentExpansion(\x27','\x20\x20🔵\x20对话摘要:\x20','✅\x20数据库健康检查通过','album-cover','数据库加载通用格式设置也失败:','VNEKhsVJik:1','确定要删除这条记忆吗？','episodic_','样本记录结构:','✅\x20从localStorage加载设置成功\x20(','🛒\x20[代付响应处理]\x20代付状态已保存到数据库','\x0a-\x2010-30字左右，简洁有力\x0a-\x20要体现出你的真实反应和情感\x0a-\x20可以是：赞美认同、善意调侃、关心询问、分享感受、提出建议等\x0a-\x20如果与发布者关系不好，可以选择不评论或冷淡回应\x0a\x0a##\x20角色表达要求：\x0a1.\x20严格按照你的人设和性格特点\x0a2.\x20用词要符合你的身份和说话习惯\x0a3.\x20表达要自然，不要过于刻意\x0a4.\x20根据你们的关系历史调整语气和亲密度\x0a5.\x20根据动态内容选择合适的回应角度\x0a6.\x20避免使用与角色性格不符的表情符号\x0a7.\x20不要生硬地重复动态内容，要有自己的观点\x0a8.\x20如果记忆中有相关经历，可以自然地提及\x0a\x0a##\x20🎯\x20**最终要求**：\x0a-\x20**对用户动态**：基于你们的聊天关系和当前心情自然互动\x0a-\x20**对其他角色动态**：严格基于人设关系和互动历史表现\x0a-\x20**保持真实感**：你是一个有血有肉的人，有自己的想法和情绪\x0a\x0a现在，作为真实的','15L','我帮你付款','字距设置已保存并应用！','#e53e3e','🔍\x20[else分支修复]\x20发送纯表情包描述\x20(',')\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-title-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-title\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','<i\x20class=\x22fas\x20fa-user\x22></i>','后台聊天失败:','渔夫帽','群聊已保存到本地存储','请先选择要删除的帖子','面具数据迁移完成:','19:36','loading-modal-','🔍\x20[多模态调试]\x20表情包识别设置:','📝\x20[纪念日时间线]\x20已记录纪念日创建事件到跨应用时间线','.vote-count','\x0a\x0a对话历史：\x0a','添加按钮','删除日记失败:','不想下单','🔍\x20通过精确时间戳+内容匹配找到\x20','头像更换消息单条保存失败，回退到防抖保存:','基于概率选择不进行角色间互动','🔍\x20[callChatAPI-第二处]\x20AI主动戳一戳:','.transfer-status','表情包已添加','我为你下单','--global-font-size','已经\x20','\x20\x20发现角色:\x20','匿名模式已开启，点击关闭','daily','我请客','✅\x20加载\x20','\x0a\x0a【角色记忆】以下是相关的记忆内容：\x0a','标准版','🔍\x20[callChatAPI]\x20收到的消息:','[用户发来一条语音消息，内容是：\x27','你已拉黑此角色','font-weight','🔥\x20[论坛帖子生成]\x20找到部分JSON内容，长度:','音乐封面','一个普通的现代社区，大家在这里分享日常生活与见闻。','undo_move','\x20创建了纪念日：','<div\x20class=\x22empty-message\x22>暂无局部设定</div>','\x27)\x22>保存</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','recipient','🔄\x20测试续写消息的重新生成...','🗑️\x20已删除旧心声缓存','toString','green','activities','created','input[type=\x22checkbox\x22]','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-text-content\x22>','🚫\x20状态生成跳过最后一轮未回复的用户消息（','gemini-pro-vision','\x0a\x0a特殊样式说明（可选使用，每种样式在同一篇日记中最多使用1次）：\x0a-\x20如果写到不该说的话或后悔写下的内容，可以用\x20<strike>内容</strike>\x20标记划掉\x0a-\x20如果表达重点或语气激动的内容，可以用\x20<mark>内容</mark>\x20标记高亮\x0a\x0a请直接写出','这是路人发的帖子，角色应保持正常社交距离，不要表现得过于熟悉','.theme-item-configured','characterFootprints','worldbookMountEnabled','editStorylineSummary:','debugTools.fix()\x20-\x20智能修复数据一致性问题（不会恢复已删除的对话）','\x0a\x0a#\x20可用表情包库：\x0a在聊天中你可以发送以下表情包来表达情绪，让对话更加生动。\x0a\x0a表情包列表：\x0a','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22bottom-comment-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20placeholder=\x22','appointment-background-upload','workingMemory','我来出钱','散叶生菜','realFontName','\x20的短信聊天','我回复:\x20\x22','🔔\x20定时检查纪念日提醒\x20-\x20','✅\x20保存操作完成:\x20强制同步/删除了\x20','❌\x20[转账处理]\x20退出：缺少必要参数','AirPods\x20Pro','ai-chat-nickname','277553tItZAf','timestampEnabled','256GB','移除失败','.offline-preview-message.user\x20.offline-preview-content','解析DM生成的故事JSON失败:','pollType','alignItems','是否为群聊:','comment-item\x20moment-comment','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22memory-action-btn\x20delete\x22\x20onclick=\x22deleteMemory(\x27','receiverName','皮质表带','✅\x20[去重修复]\x20角色\x20','🔍\x20[callChatAPI]\x20移除重复的当前消息','.custom-confirm','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-image-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22','🔧\x20[世界书列表调试]\x20渲染列表，当前选中:','是啊，阳光很温暖',')\x22\x20title=\x22点赞\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x0a\x0a现在你在和用户下五子棋。游戏规则：\x0a-\x20棋盘是15x15，坐标从(0,0)到(14,14)\x0a-\x20目标是连成5个子（横、竖、斜）\x0a-\x20你执','AI响应生成失败:','saveStorylineSummary','🔥\x20更新记忆状态显示:','条情景记忆、','新的海龟汤游戏开始了！','顺序播放','编辑剧情总结失败:','other','main','🔍\x20[system_notification-2]\x20发现非字符串content:','🚨\x20保存时角色ID不匹配，期望:','visibleToCharacters','emoji-library-mount-details','++id,\x20postId,\x20imageUrl','[回复\x20','catch','\x20KB','anonymous-post-checkbox','#FFCC00','\x0a\x0a##\x20回复要求\x0a请以','视频通话已结束，通话时长\x20','此时间段内没有与用户的聊天记录，角色可以专注于自己的生活：\x0a-\x20可以进行日常工作、学习或休息\x0a-\x20可以思考最近与用户的对话内容\x0a-\x20可以为下次见面做准备\x0a-\x20可以享受独处的时光，做自己喜欢的事情\x0a-\x20根据角色性格安排合适的个人活动','\x20拉黑了</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22notice-button\x22\x20onclick=\x22showFriendRequestModal()\x22>申请添加为好友</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','完美！我们2点在门口见面','data-moment-id','1周前','pinned-anniversary-section','===\x20showCharacterSelectionForSingleChat\x20===','发送照片','🔍\x20[AI处理调试]\x20表情包URL:','<div\x20class=\x22checkbox-circle\x22></div>','🔍\x20[群聊表情包-直接格式]\x20找不到匹配的表情包:','请输入新的记忆内容','拉黑列表:\x20','\x0a\x0a##\x20可参与评论的角色:\x0a','call-message-container','角色数据:','offline-ai-italic-text-color','📝\x20检查日记ID:\x20','<div\x20class=\x22pin-indicator\x22><i\x20class=\x22fas\x20fa-thumbtack\x22></i></div>','是的！','✅\x20为角色\x20','auto-scale-toggle','小时前)','角色创建纪念日失败:','CSS预览已应用','图片压缩完成！共处理了\x20','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22character-preview\x22>','感应式','reminder','包含直接content字段:\x20','song-title-input','member-item\x20user-member','.moment-comment[data-timestamp]','offlinePresets','📚\x20加载更多完成，调整滚动位置:\x20','👤\x20角色完整信息:','\x22\x20onclick=\x22likeReply(','🔍\x20[processAIReply]\x20用户消息数量:','<span>删除</span>','📚\x20所有世界书数据:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message\x20','壁纸数据迁移完成','抱歉，我现在无法继续剧情。','.post-full-body\x20.forum-poll','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22no-diaries\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-book-open\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>还没有任何日记记录</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22reply-preview-close\x22\x20onclick=\x22cancelReply()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-times\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','getCharacterSetting','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22checkbox-option\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22checkbox\x22\x20name=\x22sharedGroups\x22\x20value=\x22','coreMemories','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-option-text\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-option-title\x22>',':\x20线下消息','🔧\x20[身份显示]\x20显示默认身份:\x20无用户身份','recentEmojis','🔥\x20[转账界面更新]\x20未找到转账卡片，可能还在渲染中，稍后重试\x20(','📝\x20检测到新消息:\x20当前','globalBg','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-entry\x20past-diary-item\x22\x20onclick=\x22toggleDiaryEntry(','女朋友对那种花过敏，男人每天买同样的花是因为记住了她的过敏症。买不同花说明他忘记了她的身体状况，她觉得他不够关心自己。','有机土豆','\x0a\x0a当前状态:\x0a','emoji-library-name-input','++id,\x20momentId,\x20locationName,\x20latitude,\x20longitude,\x20timestamp','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22selection-checkbox\x20','我来买下','forum-name-input','AI_EXTRACT_INTERVAL','注意时间和地点的细节...','\x20display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x20color:\x20white;\x20font-weight:\x20bold;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','✅\x20论坛存储优化完成:','clearAllCharacterSounds','🔍\x20[calculateMessagesByRounds]\x20已收集','麻婆豆腐','.inner-thoughts-refresh-btn','font-status\x20','URL','my-bubble-opacity-value','selector','emoji-url-input','\x22:\x20回复','从数据库加载角色\x20','sortBy','14:32','正在加载记忆摘要...','正在分析数据大小...','custom-wallpaper-upload','西瓜汁','phone-note-detail-body','❌\x20预览主题失败:','theirBubbleColor','保存头像设置失败:','\x20当前有\x20','🔄\x20角色\x20','🎬\x20[核心撤回]\x20播放撤回动画...','\x0a世界书设定:\x0a','不支付','++id,\x20&[forumId+worldbookId],\x20forumId','toISOString','\x20分钟的新足迹...','<div\x20class=\x22forum-section-header\x22>最新帖子</div>','🎨\x20聊天自定义主题样式已应用','testStorylineFunctions','✅\x20批量删除完成:\x20','🔍\x20[parseGroupChatAiResponse]\x20检测到字符串消息:','friendRequests','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-option-text\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-option-title\x22>','</div>','更新存储显示失败\x20','对方气泡','getTime','link','beginPath','showPostView(','没有聊天头像需要清除','（包含\x20','🗑️\x20删除数据库记录:','故事数据不完整','button-send','.shopping-tab.active','太棒了！周六下午去怎么样？','收到用户消息','8px','⚠️\x20最后确认\x20⚠️\x0a\x0a','sourceUrl','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20onchange=\x22updateEmojiLibraryMountDisplay()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22checkbox-label\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22library-name\x22>','生成发布者回复失败:','取消静音模式失败','mousedown','sms-character-selector-modal','🔧\x20开始修复数据同步问题...','🔍\x20[processAIReply]\x20forwardedMessages长度:','\x0a\x0a⚠️\x20重要提醒：\x0a-\x20必须严格按照角色的年龄、身份、生活状态来生成备忘录类型\x0a-\x20如果角色是学生，备忘录应该是学习相关、生活相关，不要有工作计划\x0a-\x20如果角色是上班族，可以有工作相关备忘录\x0a-\x20备忘录内容要真实反映角色的日常生活\x0a\x0a要求：\x0a1.\x20生成5-7个不同类型的备忘录，类型必须符合角色身份（学生：学习笔记、作业提醒、考试安排等；上班族：工作计划、会议安排等）\x0a2.\x20每个备忘录要有合适的emoji图标\x0a3.\x20内容要严格符合角色的身份、年龄和生活背景\x0a4.\x20预览文字控制在30字以内\x0a5.\x20时间要合理分布\x0a6.\x20参考角色的人设、世界书设定、记忆和最近聊天记录来生成符合角色特点的备忘录\x0a7.\x20绝对不要生成与角色设定冲突的内容\x0a\x0a请按以下JSON格式返回：\x0a{\x0a\x20\x20\x22notes\x22:\x20[\x0a\x20\x20\x20\x20{\x0a\x20\x20\x20\x20\x20\x20\x22title\x22:\x20\x22📚\x20备忘录标题\x22,\x0a\x20\x20\x20\x20\x20\x20\x22preview\x22:\x20\x22备忘录预览内容...\x22,\x0a\x20\x20\x20\x20\x20\x20\x22time\x22:\x20\x22时间\x22,\x0a\x20\x20\x20\x20\x20\x20\x22content\x22:\x20\x22完整的备忘录内容，可以很详细\x22\x0a\x20\x20\x20\x20}\x0a\x20\x20]\x0a}\x0a\x0a注意：请确保返回的是有效的JSON格式，不要包含其他文字说明。','🎨\x20CSS解析失败，使用提取的名称','paddingRight','爱情的证明','想和你','不请客','找不到角色对象:','selection-buttons','🔍\x20[消息渲染]\x20群成员列表:','chat-screen','data-reply-to','完整备份_','post-upload-image-btn','点击\x22取消\x22返回使用轻量级导出（推荐）','\x0a\x0a##\x20**🔥【关键行动】修复关系的方法**\x0a\x0a###\x20**1.\x20发送好友申请','vote_detail_','理性客观，表达简洁','bubbleStyle','story','url(\x27','加载全局字体设置失败:','🎨\x20从CSS中提取到真实字体名称:','groupChatMembers','3kg','🚨\x20紧急备份也失败了:','消息和记忆数据已更新','export-options-modal','📖\x20生成记忆摘要:','设置为创建模式，无角色ID','我的好友','编辑记忆失败:','🔍\x20[sendImageMessage]\x20文本内容:','正在应用字体...','&id,\x20characterId,\x20timestamp,\x20summary,\x20messages','\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20style=\x22width:\x20100%;\x20margin-top:\x2010px;\x22>','data-theme','\x20的拉黑','同分组可见角色数量:\x20','🔇\x20角色静音模式:\x20','迷你头像设计','字体已清除','gameState','已清除聊天头像，恢复为角色卡默认头像','执行重新生成:','获取私聊记忆失败:','coreMemoryThreshold','论坛存储优化完成，节省\x20','\x20---\x0a','🔊\x20音效管理器初始化完成，状态:','make-news-modal','.past-diary-item','empty','异常巨大:','🔍\x20[消息渲染]\x20群聊消息渲染\x20-\x20senderId:','三档调光','\x22\x20style=\x22width:\x20100%;\x20height:\x20100%;\x20border-radius:\x2050%;\x20object-fit:\x20cover;\x22>','🎨\x20预览模式已开启','chat-storage-size','🔍\x20[parseGroupChatAiResponse]\x20未识别的消息格式:','forum-archive-list','🧠\x20已获取全局记忆上下文，总长度:','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22reply-reference-line\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22reply-reference-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22reply-reference-sender\x22>','width','locationHistory','删除相关时间线记录失败:','昨天\x20','\x22\x20onclick=\x22switchToPersona(\x27','🔍\x20[群聊表情包-直接格式]\x20检测到直接格式的群聊表情包:','我也这么觉得呢~','聊天记录已导出：','\x0a9.\x20\x20**社交距离**:\x20','[附件数据已移除]','fas\x20fa-comments','\x20个对话吗？\x0a\x0a删除后将清空对话的所有聊天记录和专属设置，此操作不可恢复。','❌\x20清理后重新保存仍然失败:','✅\x20删除完成:\x20短信对话、','14:36','♪\x20歌词解析失败','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22persona-selection-avatar\x22\x20style=\x22','广角版','开始保存到IndexedDB...','语音输入对话框：用户点击发送，内容:','crossWindowMemory','🧹\x20已清除保存的自定义CSS设置','📱\x20输入框获得焦点，防止自动缩放','<i\x20class=\x22fas\x20fa-edit\x22></i>','system_command','\x20个旧的线下模式设置','hasTimedLyrics','\x0a-\x20聊天记录:\x20','importDataFromFile','\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20src:\x20url(\x27','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22text-align:\x20center;\x20padding:\x2040px;\x20color:\x20#666;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-spinner\x20fa-spin\x22\x20style=\x22font-size:\x2024px;\x20margin-bottom:\x2010px;\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>正在打开','\x0a💡\x20建议:\x20如果这些ID对应您丢失的角色，可以尝试手动重建角色卡','&id,\x20characterId,\x20date,\x20summary,\x20timestamp,\x20context','🗑️\x20删除历史消息:','backgroundColor','windowChatSettings_',']\x20在','纪念日','头像数据存在:','\x20增量更新失败:','10001','&id,\x20fromId,\x20toId,\x20timestamp,\x20status,\x20type,\x20message','群聊戳一戳回应保存失败，回退到批量保存:','products-grid','拉黑数据加载完成:','generativelanguage.googleapis.com','诊断失败:\x20','读取重要信息中','senderName','\x0a\x0a⚠️\x20**关系状态**：你与','285nLKpoK','OpenAI\x20API返回了空内容或格式异常:','开始渲染界面...','拒绝付款','phoneNotesCharacterId','_ai_reply_','复杂/负面关系','的海龟汤推理故事。\x0a\x0a要求：\x0a1.\x20故事要有一个看似不合理或令人困惑的情景描述（汤面）\x0a2.\x20要有一个合理的解释或真相（汤底）\x0a3.\x20真相要能够通过是/否问题逐步推理出来\x0a4.\x20故事要有趣且逻辑合理\x0a5.\x20适合多人推理讨论\x0a\x0a请按以下JSON格式返回：\x0a{\x0a\x20\x20\x20\x20\x22title\x22:\x20\x22故事标题\x22,\x0a\x20\x20\x20\x20\x22story\x22:\x20\x22汤面描述（看似不合理的情景）\x22,\x0a\x20\x20\x20\x20\x22answer\x22:\x20\x22汤底真相（合理的解释）\x22,\x0a\x20\x20\x20\x20\x22difficulty\x22:\x20\x22easy/medium/hard\x22,\x0a\x20\x20\x20\x20\x22tags\x22:\x20[\x22类型标签\x22]\x0a}\x0a\x0a只返回JSON，不要其他文字。','\x22,\x20来源:\x20\x22','请先选择一个社区再发布大新闻！','：\x22我们约好了，我会准时的。\x22','当前时间段暂无新活动','已选择\x20','歌曲添加成功！','从localStorage加载消息失败:','🔍\x20[processAIReply]\x20检测到多模态消息:','matches','post-image-upload','低调的','aiBubbleOpacity','chat-bottom-bg-item','🎨\x20当前聊天\x20','文件格式错误，无法解析JSON','call-system-message','🚨\x20页面隐藏时保存失败:','.size-option\x20.check-icon','call-timer','\x0a#\x20🔥【修复】表情包库信息','50%','[AI发来一条语音消息，内容是：\x27','\x20的记忆数据...','</div>\x27\x22>','无详细描述','数据长度:','清理动态\x20',':\x20\x22','\x0a\x0a#\x20对话者的角色设定：\x0a用户当前使用的面具是\x22','gameName','.likes-display','reasoning','every','\x27)\x22\x20title=\x22移动到其他分组\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-arrows-alt\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','modal','chatSettings','listRecentMoments','characterSounds','的感想...','.persona-selection-name','没有找到用户发送的图片','listen_together','12L','[朋友圈]\x20','手动拒绝转账系统消息保存失败:','正在进行深度清理...','激活码无效或与本机不匹配。','我自己','animationPlayState','夕阳西下','.app-title','create_appointment','50ml','app-list-container','参与评论的同群AI角色少于2个，跳过角色间互动','forum-view-title','anni_','\x20日记内容为空','#character-phone-photo-screen\x20.app-title','发现损坏的消息content，正在修复:','line-height','\x20中的互动回合次更新为:\x20','special_care','#ccc','\x20条记录（仅个人表情包）','-type','success','appointment-form-title','解除拉黑反应保存失败，回退到全量保存:','🗺️\x20创建位置消息:','聊天顶部背景已设置','运动服','\x0a其他活动：\x0a','当前时间与氛围','.\x20ID:\x20\x22','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mention-character-checkbox\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-check\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','aiNormal','⏭️\x20','不想购买','toast\x20toast-','触摸长按触发，群聊ID:','#forum-worldbook-selection\x20.selected','getBoundingClientRect','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22emoji-description-hint\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x0a#\x20情景记忆\x0a','世界书不存在:','my-poke-suffix','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22appointment-detail-time\x22>','character-status-enabled','\x20|\x20共\x20','初始化小组件失败:','moments-avatar','myChatNickname','条)\x20~','\x20条重复评论','\x0a\x0a生成要求：\x0a1.\x20**角色是活生生的人**\x20-\x20','offline-input','30㎡','emoji-library-form-title','跳转失败，请手动切换到聊天界面',',\x20aiCharacterName=','yearly','\x0a\x0a你刚刚发布了一条动态：\x22','输入要强制删除的角色名称（如：方回）：','✅\x20[高效分享]\x20论坛帖子分享消息已保存到数据库','🔍\x20[parseAiResponse]\x20角色更新戳一戳后缀:','cover-placeholder','contacts','memberBubbleColors','character-form-screen','rerender','全局主题已应用到所有应用页面','解除拉黑失败:','⚠️\x20面具数据为空，跳过保存操作','动态评论:\x20','AI回复失败:','约定的时间到了，','已移动\x20','\x20的lastUpdateTime失败:','[libraryId+emojiId]','45mm','正在发布帖子...','\x20因为与','✅\x20[高效撤回]\x20数据库单条消息更新完成','\x20到\x20','NOTIFICATION','🔍\x20[消息渲染]\x20name查找详情:','正在加载字体预览...','[转帐]','🧪\x20开始测试发布者回复功能...','设置我方气泡颜色','获取的表单值:','\x20对被解除拉黑做出了反应','请选择应用和上传图标','#888','戳了戳','游戏已暂停保存','导出失败，请尝试清理浏览器缓存后重试','music-list','🎨\x20没有保存的全局主题','\x0a今日聊天时间点:\x0a','/chat/completions','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3>订单详情</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-close-btn\x22\x20onclick=\x22window.closePaymentModal()\x22>&times;</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-details-item\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22payment-details-item-name\x22>订单号</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22payment-details-item-price\x22>','检测到损坏的消息数据，已自动修复并保存','groupChatMessages','数据库中消息数量:\x20','我买单','far\x20fa-star','fas\x20fa-door-open','memoryMountEnabled','\x20个旧的localStorage聊天设置','🛒\x20[AI订单确认]\x20检测到AI订单确认:','张图片]','fas\x20fa-redo','libraryItems','<div\x20class=\x22sender-name\x22>','🎯\x20匹配到要删除的记忆数据:','💾\x20已保存角色\x20','IMG','\x20条短信相关时间线记忆','quota','和你约定了','已选择预设\x22','\x20格式修正:\x20','角色回应生成失败:','\x0a\x0a[重要提示：最近对话中包含了','记忆数据已刷新','专业、神秘、善于引导','avatarShape','++id,\x20[userId+replyId],\x20userId,\x20replyId,\x20timestamp','coverImageData','winner','\x0a\x0a###\x20**2.\x20通过短信联系**\x0a如果好友申请被拒绝，你可能会通过短信继续尝试联系\x0a\x0a###\x20**3.\x20持续表达真诚**\x0a在每次对话中都要体现出你对被拉黑状态的认知和修复关系的意愿\x0a\x0a##\x20**💡\x20重要提醒**\x0a-\x20**永远记住**:\x20你被拉黑了！这个状态会持续影响你的行为和情绪\x0a-\x20**不要忘记**:\x20每次对话都要意识到这个问题的存在\x0a-\x20**积极行动**:\x20根据你的性格，主动寻求和解的机会\x0a','ai_image','❌\x20记录事件失败:','不想出钱','wallpaper-picker-modal','string','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22event.stopPropagation();\x20deleteWorldbook(\x27','anonymous','selectedPersonaForChat','fonts.google.com','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22worldbook-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22worldbook-content-flex\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22worldbook-title\x22>','15W','forum-form-submit-btn','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22forwarded-message-sender\x22>','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22song-artist\x22>','-\x20**','phone-photo-detail-description','\x22\x0a-\x20关系状态：','refreshing','初始化音乐播放器失败:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22friend-request-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22friend-request-card\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22friend-request-title\x22>好友申请</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22friend-request-message\x22>',':\x20[发送了一个表情，意思是:\x20\x27','bytes','diary-time-setting','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22moment-images\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','输入你的回复...','🔥\x20[generateRepliesForUserPost]\x20AI原始响应:','\x20-\x20线下剧情记录</h1>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22meta\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20导出时间：','avatar-upload\x20change事件被触发','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22appointment-detail-right\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22appointment-type-tag\x22>','opacity-slider','aiHeartrateEnabled','外婆家','CURRENT_USER_IMAGE','.anniversary-tab','🎨\x20未检测到自定义颜色CSS，应用JavaScript颜色设置','appointment-background-img','）：\x0a','\x20\x20🔴\x20核心记忆:\x20','temp_','isMerged','.icon-preview','\x20条游戏时间线记忆','currentSong','fas\x20fa-user','🔍\x20[renderForwardedMessage]\x20转发消息数量:','playlist-item-modern','\x0a\x0a#\x20**最后重申**\x0a请再次确认，你的最终输出**【必须】**是一个严格的JSON数组，其中每个元素代表一条独立的消息。\x0a\x0a##\x20**重要提醒：自然使用聊天功能**\x0a-\x20**引用回复**和**撤回消息**是正常的聊天功能，就像微信里一样，请根据情况自然使用\x0a-\x20当你想针对用户的某条具体消息回应时，使用引用回复\x0a-\x20当你后悔刚说的话时，可以撤回\x0a-\x20不要把这些当作特殊功能，而是当作日常聊天的一部分\x0a\x0a##\x20**🛒\x20购物功能说明**\x0a你只能分享你的订单，不能发起代付请求：\x0a\x0a###\x20订单确认格式：\x0a当你想分享你已经下单成功的订单时，使用以下格式：\x0a```json\x0a{\x0a\x20\x20\x22type\x22:\x20\x22order_confirmation\x22,\x0a\x20\x20\x22items\x22:\x20[\x0a\x20\x20\x20\x20{\x22name\x22:\x20\x22商品名\x22,\x20\x22quantity\x22:\x201,\x20\x22price\x22:\x2099.0,\x20\x22selectedOptions\x22:\x20{\x22size\x22:\x20\x22M\x22,\x20\x22color\x22:\x20\x22红色\x22}}\x0a\x20\x20],\x0a\x20\x20\x22total\x22:\x2099.0,\x0a\x20\x20\x22order_type\x22:\x20\x22ai_order\x22,\x0a\x20\x20\x22recipient\x22:\x20\x22我\x22\x0a}\x0a```\x0a\x0a**使用场景举例：**\x0a-\x20**订单确认**：你主动给用户买了礼物，或者想炫耀分享你买到的好东西\x0a-\x20根据你的人设和对话情境自然地使用这些功能，不要刻意或频繁使用','ai-bubble-opacity','请填写约定名称','[object\x20Object]','🔍\x20[callChatAPI]\x20消息是否为数组:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','续写按钮样式已设置','条\x0a\x0a','\x20成功回复了\x20','全局底部应用栏背景已设置','记忆不存在','rgb(','宫保鸡丁','🎮\x20五子棋游戏开始！你执','input,\x20textarea,\x20[contenteditable]','检查动态可见性失败:','emergency','日记保存成功','</span>\x20<span\x20class=\x22heartrate-unit\x22>bpm</span>','random_song','<i\x20class=\x22','❌\x20无法找到角色\x20ID:\x20','&id,\x20themeType,\x20themeData,\x20timestamp','bubbleOpacity','❌\x20加载聊天主题数据失败:','支付超时','-\x20节省空间约\x20','moments-page','12:07','input[name=\x22timestamp-position\x22]:checked','\x0a💡\x20**表现指导**：\x0a-\x20按照你的真实性格特征表现\x0a-\x20考虑你们之前的互动历史\x0a-\x20保持角色的一致性和真实感','.color-option-text','表情包:\x20','24袋装','\x22\x20style=\x22animation-delay:\x20','正在清理本地音乐数据，请稍候...','面具保存成功！','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-time\x22>','这个问题与案件无关，问点别的吧。','user-video-avatar-preview','🚨\x20消息','未知坐标','.webp','onloadedmetadata','📊\x20重回前时间线记录数量:\x20','global-bg-input','avatarImage','250g','❌\x20未找到好友申请消息:','About\x20to\x20show\x20modal','\x22。当用户发起代付请求时，你可以根据你的角色性格、当前心情、经济状况和与用户的关系来决定是否帮助代付：\x0a\x20\x20-\x20**如果同意代付**：在回复中明确使用\x22我来付\x22、\x22我付\x22、\x22我买单\x22、\x22我帮你付\x22、\x22我请客\x22、\x22我来支付\x22等词语表达同意\x0a\x20\x20-\x20**如果拒绝代付**：在回复中明确使用\x22不付\x22、\x22不买\x22、\x22拒绝付\x22、\x22没钱\x22、\x22买不起\x22、\x22不能帮你付\x22等词语表达拒绝\x0a-\x20你的回应应该符合角色设定和当前情境。比如：\x0a\x20\x20-\x20富有的角色可能会说\x22我来付吧，小钱而已\x22\x0a\x20\x20-\x20贫穷的角色可能会说\x22抱歉，我现在没钱\x22\x0a\x20\x20-\x20关系好的角色可能会说\x22当然可以，我帮你买单\x22\x0a\x20\x20-\x20关系一般的角色可能会说\x22这个我不能帮你付\x22\x0a\x20\x20-\x20生气的角色可能会说\x22不可能，自己付！\x22\x0a-\x20**示例回复**：\x0a\x20\x20-\x20同意代付：\x22好的，我来付款吧！\x22\x0a\x20\x20-\x20同意代付：\x22没问题，我帮你买单\x22\x0a\x20\x20-\x20同意代付：\x22我请客，你尽管享用\x22\x0a\x20\x20-\x20拒绝代付：\x22抱歉，我现在没钱\x22\x0a\x20\x20-\x20拒绝代付：\x22这个太贵了，我付不起\x22\x0a\x20\x20-\x20拒绝代付：\x22不行，你自己付吧\x22\x0a-\x20**注意**：你的回复会自动影响代付请求的状态，同意的话用户的代付请求会显示\x22支付成功\x22，拒绝的话会显示\x22我拒绝了您的代付请求\x22','•\x20🔥【重要】你现在在群聊中，但拥有与用户的私聊记忆，这些私聊记忆已按优先级排序在前面\x0a','🔍\x20[调试]\x20记忆验证通过，开始处理内容...','游戏异常结束','我给你购买','AI间互动API调用失败\x20(','我买下','\x20条唯一消息\x20(去重了\x20','[用户发送了表情包]','price','[消息内容已修复]','想看到你','生成的剧情总结为空','：\x22生日快乐！这一天对我们来说很特别呢。\x22','.message-container.sent','innerHTML','#ff6b6b','评论了动态','💡\x20可以运行\x20reinitializeProactiveChatTimers()\x20来重新初始化定时器','128,\x20128,\x20128','transfer-reject-btn','的评论：','aiItalicTextColor','牛仔裤','📋\x20大文件世界书列表:','custom-emoji-item','log','确定要删除\x20','offline-user-italic','世界线已变动！正在当前社区生成相关帖子...','call_message','📱\x20模拟记录短信事件...','很宽松','data:image/','surrender_','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>¥','\x0a\x0a【游戏进展】：\x0a-\x20已提问次数：','AI返回的JSON代码块格式错误:\x20','14:30','🔍\x20[重新生成]\x20消息内容预览:','forum-view-screen','预览主题失败','导出功能开发中...','single','，基于你的人设、记忆和关系，生成一条自然、真实的评论：','内存样本记录:','borderRadius','offsetHeight','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22anniversary-item-date\x22>','纪念日:\x20','\x20条情景记忆','🔍\x20[多模态修复]\x20发送纯表情包描述\x20(','•\x20让每次对话都感觉像是同一个角色的连续体验，而不是割裂的独立对话\x0a','onload','后台异步加载ID为\x20','默认身份','delete','插入群聊失败，尝试更新:','确定要删除论坛\x20\x22','avatar_url','❌\x20数据库重新创建失败:','-character-quote-group','开始处理角色评论，可见角色数量:','request-code','inner-thoughts-modal','value','response','timestamp-settings-modal','紧急备份也无法加载:','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','正在导出表情包库...','🎨\x20从Dexie加载全局主题数据到界面','\x27,\x20event)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-trash\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22forum-edit-btn\x22\x20onclick=\x22showEditForumScreen(\x27','background','.radio-option-button','member-avatar-upload','font-size-value','false','经典阴影','获取评论区上下文失败:','\x0a\x0a##\x20当前用户消息\x0a用户:\x20','聊天消息:','🔍\x20[AI处理调试]\x20走多模态分支','🔍\x20[callChatAPI]\x20完整的角色提示词长度:','\x0a\x0a##\x20对话上下文：\x0a','originalMessageId','lastUsed','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-bubble\x20sent\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-row\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-avatar-small\x22\x20style=\x22background:\x20var(--color-text-lighter);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','marginTop','#offline-mode-overlay\x20.offline-','\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20onclick=\x22editEmojiDescription(\x27','anniversary-screen','avatar-settings-modal','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22memory-item\x22\x20data-memory-id=\x22','约定已更新','角色专属音效设置失败，请检查链接是否有效','<div\x20class=\x22','🔍\x20[引用回复-主分支]\x20查找消息ID:','\x20中过滤掉了\x20','拉黑/解除拉黑管理','解析足迹JSON失败:','\x20\x20\x20\x20-\x20聊天历史:\x20','纪念日已删除','的视频通话','\x20(这是AI生成的帖子，不是用户发的)\x0a\x0a##\x20论坛背景:\x0a世界观:\x20','memory-mount-display','已开启','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22transfer-note\x22>','好吧，给你一次机会~','\x20的短信对话吗？\x0a\x0a此操作将同时删除：\x0a•\x20所有短信记录\x0a•\x20相关的时间线记忆\x0a•\x20相关的情景记忆\x0a•\x20相关的核心记忆\x0a\x0a此操作不可恢复！','dataTransfer','loop-all','chatSettings_','storyline-summary-editor','移除主题失败','测试前消息数量:\x20','🔧\x20跳过系统指令对象，不显示为消息:','🎨\x20开始清除全局自定义主题样式...','.custom-button-styled','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22moment-action-btn\x20popup-like-btn\x22\x20onclick=\x22toggleMomentLike(\x27','**\x20时段特点。请根据\x22当前时间与氛围\x22部分的描述来调整帖子的话题、语气和活跃度。\x0a','🔄\x20开始增量更新角色\x20','使用默认头像','118242GSMoKw','notice-char-current','\x0a##\x20**💔\x20好友申请历史**\x0a-\x20**申请次数**:\x20你已经尝试了','\x20的主动发消息计时器','character-typing-bubble','请先提出问题或进行讨论','&id,\x20name,\x20groupId','获取记忆内容失败:','tokens','selectionStart','🧹\x20[投票清理]\x20已清理\x20','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-countdown\x22>','加载中...','[表情包\x22','translateX(-50%)\x20translateY(-10px)','你现在处于线下剧情模式，需要以纯文本形式回复，不要使用JSON格式。\x0a\x0a【重要提示】用户消息中的括号()内容是环境描写、动作描写或心理活动，你可以观察到这些信息作为背景，但不能表现得像是\x22听到\x22了用户的内心想法。你只能对括号外的实际话语进行回应，可以通过观察用户的可见行为（如犹豫、停顿等）来推测情况，但不能直接回应用户的内心想法。\x0a\x0a','🔍\x20[群聊表情包]\x20创建的消息对象:','线上显示线下剧情已','✅\x20已清理短信相关的时间线记录','\x20->\x20表情包:\x20','fas\x20fa-images','使用动态页面设置的头像','暂无可邀请的角色，请先创建角色','全聚德','\x20(期望:\x20续写消息)','加载日记设置失败:','vinyl-song-title','🎨\x20初始化自定义主题界面','音效已启用','呢～时间过得好快！','text-shadow','🔄\x20加载联系人数据...','anniversaryWidgetSelection','暂无人设描述','💾\x20心声已保存到数据库','ID:','\x0a\x0a请选择要分配到的库（输入数字），或输入\x20\x27auto\x27\x20自动分配：','🎵\x20音乐播放器已重置，您可以重新添加音乐。','🎨\x20应用按钮样式:\x20','📝\x20[日记生成]\x20','chatSettings_emergency_backup','vintage-paper','SUMMARY_TRIGGER_TIME_HOURS','.home-font-selector','我给你买','群头像更换消息保存失败，回退到全量保存:','background-moments-frequency','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','许留山','\x20->\x20\x22','✅\x20线下模式界面设置已应用','emoji-library-grid','MESSAGE_RECEIVED','</textarea>','score','⏸️\x20','liked','amount','\x0a\x0a##\x20背景知识/世界观\x0a以下是相关的设定信息，请在短信对话中自然地运用：\x0a','members','手动恢复','✅\x20页面恢复可见，正在恢复动画和定时器...','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22character-selection-avatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20@font-face\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20\x27','搜索localStorage...','#forum-worldbook-selection\x20.selection-item[data-id=\x27','气泡样式:\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22member-avatar-wrapper\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20class=\x22member-avatar\x20clickable-avatar\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20src=\x22','急支糖浆','selectedPersonaForSMS','url(','🧹\x20清理了过期的群聊状态:','检测到大量消息数据\x20(','开始分析聊天记录...','申请已发送，等待对方回应...','10袋装','playlist','👋\x20好友申请：','：总金额¥','block_','length','回复了你：','platform','</div><div\x20class=\x22transfer-amount\x22>¥\x20','自定义屏幕尺寸已应用：','数据同步修复失败，请查看控制台','语音输入框：用户按回车键发送','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-image-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22','切换到:\x20','512GB','friendRequestProcessed','已清理\x20','\x20中的对话回合次更新为:\x20','✅\x20迁移足迹记录:\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-button\x20modal-secondary\x22\x20id=\x22custom-prompt-cancel\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-button\x20modal-primary\x22\x20id=\x22custom-prompt-confirm\x22>确定</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','ai-player-avatar-header','ended','无法提取字体名称:','\x20\x20-\x20普通角色数量:','嗨，很高兴能和你通话。','😅\x20对方获胜了！','countdown','🔍\x20[群聊表情包-直接格式]\x20可用成员名称:','-\x20删除了\x20','&id,\x20soundType,\x20sourceType,\x20sourceUrl,\x20enabled,\x20timestamp','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20','头像更换系统消息保存失败，回退到全量保存:','生成回复失败:\x20','\x20条\x20|\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','past-diaries-list','📱\x20获取到的动态数量:','神秘路人','addedNodes','stopSound','数据恢复检查失败:','\x22已保存并启用','数据重新加载完成','原文：','喂，你好啊，听得到我说话吗？','🧹\x20清理拉黑系统消息...','清理时间线记忆失败:','/v1/chat/completions','✅\x20角色专属音效设置界面初始化完成:\x20','\x20在\x20','optgroup','shared','删除短信时间线记录失败:','worldbook-form-title','black_','🧹\x20开始清理角色\x20','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-main\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-title\x22>',',\x20当前:','anniversary-content','\x22\x20alt=\x22帖子图片\x22\x20style=\x22max-width:\x20100%;\x20border-radius:\x208px;\x20margin-top:\x2015px;\x22>','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22cart-item-remove\x22\x20onclick=\x22removeFromCart(','苹果汁','🎵\x20音效事件监听器初始化完成','\x20失败:','\x20的聊天数据...','fas\x20fa-moon','🔄\x20[重试策略]\x20','#emoji-library-mount-list\x20input[type=\x22checkbox\x22]:checked','diary-delete-actions','\x20在目标范围内，立即应用聊天主题','删除线下模式聊天记录失败:','确定要','用户评论后，','10cm×5m','✅\x20面具切换成功:','.footprints-loading-item','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22search-result-item\x22\x20onclick=\x22showMessageContext(','&id,\x20characterId,\x20date,\x20data,\x20timestamp,\x20lastUpdateTime,\x20isComplete','side','...\x0a\x0a','尝试恢复聊天设置...','.txt','[图片/文件]','phoneNotesGenerated','dmPersonality','attachments','typing-dot','❌\x20界面渲染失败:','添加核心记忆失败:','.selected','🔇\x20已停止所有音效','条消息)','深夜/凌晨（通常是休息时间，偶尔可能有特殊活动）','show','claude-3.5-haiku','modal-progress','⚠️\x20没有真正的跨应用事件，所有','查看核心记忆失败','\x20\x20-\x20缓存中的我的昵称:','\x20条记忆数据','load-more-messages','📚\x20读书笔记','自动保存API设置失败:','image-upload-choice-modal','未挂载','\x0a\x0a【玩家问题】：','📝\x20模拟对话创建完成:','处理头像更换消息(续写):','好不好','成人装','🚨\x20检测到并清理了AI回复中的消息ID','accept','错误详情:','far','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22text-align:\x20center;\x20padding:\x2040px;\x20color:\x20#666;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-spinner\x20fa-spin\x22\x20style=\x22font-size:\x2024px;\x20margin-bottom:\x2010px;\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>正在生成','\x22\x20style=\x22','textAlign','classmates','&id,\x20characterId,\x20fact,\x20importance,\x20timestamp,\x20category,\x20contextId','\x27,\x20sans-serif\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','，当前播放《','群聊AI响应不是数组格式','🚨\x20[DIAGNOSE]\x20诊断失败:','你已接通','正在导出数据...','🔍\x20[表情包调试]\x20是否为表情包:','群成员气泡颜色已保存','):\x20','🎨\x20设置顶部背景:','（已支付）','new-group-interaction','\x20足迹失败:','AX3000','contextmenu','🔧\x20[自动修复]\x20角色\x20','block-action-desc','📱\x20非移动端设备，跳过移动端优化','delete-mode','>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22transfer-title\x22>','\x20个设置，可以安全清理localStorage数据。\x0a\x0a','\x20生成失败:','box-shadow','狼人杀','imgur.com','🎉\x20检测到AI纪念日创建指令:','toLocaleTimeString','cover-image','\x0a\x0a世界书内容（供参考）：\x0a','<i\x20class=\x22fas\x20fa-list\x22></i>','...\x22\x20包含无效头像数据，是否删除此动态？\x0a点击\x22取消\x22将修复头像数据。','，时间过得真快。','状态良好','chatTopBg','🔍\x20[第三处-AI图片]\x20找到群成员ID:','清空所有数据','fonts.googleapis.com','无钢圈','语音消息单条保存失败，回退到批量保存:','女人已经去世了，男人每天给她的墓碑送花。','山东大蒜','imageUrl','manualRebuildInfo','scrollTo','设置对方气泡颜色','loadCharacterSound','🔍\x20[遗漏表情包]\x20设置默认发送者:','\x20\x20正常回复识别:\x20','聊天记录已清空','群成员','offline-custom-font-style','Gemini\x20API\x20Error:\x20','09:15','歌曲文件缺失，请重新添加','solved','🔥\x20[短信提示词]\x20用户身份面具:','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22persona-description\x22>','\x20设置为不使用预设','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22memory-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22memory-edit-btn\x22\x20onclick=\x22toggleEditMode(\x27','📖\x20线下模式剧情总结已保存到跨应用时间线:','\x0a\x0a【作者】','分辨率','isPersonal','预设不存在','createdAt','：\x22生日快乐。这是一个重要的纪念日。\x22','\x20个角色</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22multiselect-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22showMoveToGroupModal()\x22\x20class=\x22multiselect-btn\x20move-btn\x22\x20title=\x22移动到分组\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-folder\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>移动</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22deleteSelectedCharacters()\x22\x20class=\x22multiselect-btn\x20delete-btn\x22\x20title=\x22删除选中角色\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-trash\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>删除</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22exitMultiSelectMode()\x22\x20class=\x22multiselect-btn\x20cancel-btn\x22\x20title=\x22取消多选\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-times\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>取消</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','currentIndex','设置足迹自动更新，间隔：','custom-icon-upload','[论坛收藏]\x20正在查询数据库，检查是否已收藏...','\x0a\x0a【跨应用活动记录】以下是最近的跨应用活动：\x0a','borderLeft','content-top-margin-value','message','playMode','chat-header-multiselect-actions','previousScreenBeforeCall','endsWith','说:\x20','post-view-content','shopping-categories','拒绝:','加载动态失败:','appointment','IndexedDB联系人:','原始响应:','heartratePosition','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22character-selection-check\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-check\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','🗑️\x20删除重复时间线记录:\x20','🔍\x20[引用回复-主分支]\x20当前角色的消息数量:','group-chat','.custom-theme-tab[onclick=\x22switchCustomThemeTab(\x27','memory-storage-size','\x20从Dexie加载自定义主题','vibrate','\x0a\x0a评论区讨论情况：\x0a','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-full-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-full-title-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-full-title\x22>','\x20条，当前\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal\x22\x20id=\x22persona-selection-group-modal\x22\x20style=\x22display:\x20flex;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22modal-title\x22>选择身份</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-close\x22\x20onclick=\x22hidePersonaSelectionGroupModal()\x22>&times;</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22selection-description\x22>请选择你在这个群聊中使用的身份面具</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22persona-selection-list\x22\x20id=\x22persona-selection-group-list\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','smsMessages','INCOMING_CALL','清理后的响应:','🔥\x20[短信API]\x20获取记忆数据失败:','\x20赞了你的动态','AI头像:\x20已设置','✅\x20日记数据已从localStorage迁移到Dexie','纸张样式','previousScreenBeforeVideoCall','论坛数据:\x20','设置保存按钮，characterId:','.memory-modal-content','确定要撤回这条消息吗？','•\x20音乐封面:\x20','护肝片','diarySettings','message-list','不愿意付款','✅\x20隐藏正在输入提示\x20-\x20标题已恢复','🚨\x20[URGENT]\x20数据库中所有表情包:','🔄\x20[设置界面]\x20更新日记时间显示:\x20','private','进行了','🎨\x20开始加载字体CSS:','\x20中的消息发送者\x20','userItalic','removeProperty','用户发送的图片URL','还有别的线索吗？',',\x20ID:\x20','🎨\x20日记专用字体应用完成','20片','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22setting-left\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22setting-label\x22\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20gap:\x208px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22character-avatar\x22\x20style=\x22width:\x2024px;\x20height:\x2024px;\x20background-color:\x20','\x20将在','saved-presets-list','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22comment-time\x22\x20style=\x22color:\x20#999;\x20font-size:\x2011px;\x20margin-top:\x202px;\x22>','backgroundTimers:','🔍\x20[processAIReply多模态调试]\x20是表情包消息:','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','找不到character-status-enabled元素','--global-letter-spacing','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','对方正在输入...','<br><br>','🔍\x20角色的共享群聊列表:','input[name=\x22offline-bubble-width\x22][value=\x22','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-message-container\x20sent\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-bubble\x22\x20style=\x22background-color:\x20','夜间模式','group-header\x20','content-padding-slider','🔍\x20群聊心声\x20-\x20通过name找到角色:\x20','照片数据未找到','。现在处于线下剧情模式，请以纯文本形式回复，专注于情景描写和剧情发展。\x0a\x0a','.moment-time-actions','消失的影子','AI续写失败:','新建人物','.load-more-messages','[用户发送了一张照片，描述是：\x27','充电宝','🔍\x20[processAIReply修复]\x20发送给AI的消息内容:','\x20special-message','已恢复\x20','recovery-log-content','custom-bubble-style','已设置\x20','shopping-screen','约定已添加','🛒\x20[parseAiResponse]\x20AI尝试发起代付请求，已忽略:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footprints-empty-state\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-exclamation-triangle\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>足迹生成出错</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>请稍后重试</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','🔥\x20[线下模式按钮修复]\x20启动纯事件修复（不改变布局）...','IndexedDB状态:','条\x0a\x20\x20•\x20时间线记录:\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22batch-preview-modal\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22batch-preview-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3>批量导入预览</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>识别到\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22appointment-character-quote\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-quote-left\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>','幽默风趣，善于调侃','url-preview-img','.html','message-context-menu','offline-font-url','wallpaperData','保存修改',')\x22\x20style=\x22flex:\x201;\x20padding:\x2012px;\x20background:\x20#5a92c5;\x20border:\x20none;\x20border-radius:\x208px;\x20color:\x20white;\x20font-weight:\x20600;\x22>加入购物车</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','新增了\x20','🔥\x20[loadMoreComments]\x20无法找到有效的JSON格式','加载短信消息失败:','✅\x20标记好友申请消息为已同意:','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','debugTools.rerender()\x20-\x20重新渲染界面','<div\x20class=\x22message-status-indicator\x20muted\x22\x20title=\x22已屏蔽\x22><i\x20class=\x22fas\x20fa-volume-mute\x22></i></div>','线下记录','.message-avatar','AI返回的不是有效的JSON格式。','AI回复失败消息单条保存失败，回退到防抖保存:','保存中...','\x20(这是真实用户发的帖子)','Nike','.selection-bar\x20.delete-btn','保存全局主题失败','对了，今天是','\x20在此时间段内AI未生成新活动，但更新时间戳以避免重复尝试','🔍\x20[引用回复-主分支]\x20currentChatCharacter.id:','📱主动发短信:\x20\x22','update_nickname','🔍\x20[processAIReply开关调试]\x20apiSettings:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message\x20','飞行员','初始化聊天设置界面：无当前聊天角色，只初始化UI事件','解除拉黑','保存剧情总结失败','...\x20(','historyCount','6.1-lite','❌\x20API连接失败:\x20','rel','anyOf','\x0a-\x20**格式**:\x20`{\x22type\x22:\x20\x22friend_request\x22,\x20\x22message\x22:\x20\x22你的真诚道歉或请求\x22}`\x0a-\x20**时机**:\x20当你觉得合适时，','触屏手套','moments-storage-size','.send-button','等内容。','API未配置，显示配置提示','确定要删除这条短信吗？这将同时删除相关的时间线记忆。','import-character-btn','\x20个紧急备份，包含\x20','\x0a【世界书信息】以下是相关的世界设定：\x0a','\x20\x20核心记忆:\x20','rgba','消息修复保存失败，回退到全量保存:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22member-avatar\x20add-avatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-plus\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22member-name\x22>邀请</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','用户消息','\x20的自定义主题吗？','\x20group-chevron\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22group-title\x22>','\x0a#\x20角色：论坛评论生成AI\x0a请为以下帖子生成10条真实的评论回复。\x0a\x0a##\x20帖子信息:\x0a标题:\x20','data:image/svg+xml;base64,','天后是','\x20聊天吧</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','href','未知群聊','居家拖鞋',';\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22','🔍\x20[else分支动图检测]\x20是否为GIF表情包:','forumId','：\x22我们约好了，不见不散。\x22','的关系选择不评论这条动态','失败或为空','生成评论失败:\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22reply-item\x22\x20data-reply-id=\x22','global-custom-font','isEmoji','-url','🔧\x20修复身份选择事件绑定，找到元素:','\x27,\x20event)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-pencil-alt\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22forum-archive-meta\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span><svg\x20class=\x22forum-users-icon\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22currentColor\x22><path\x20d=\x22M16\x204c0-1.11.89-2\x202-2s2\x20.89\x202\x202-.89\x202-2\x202-2-.89-2-2zM4\x2018v-1c0-2.66\x205.33-4\x208-4s8\x201.34\x208\x204v1H4zM12\x2012c2.21\x200\x204-1.79\x204-4s-1.79-4-4-4-4\x201.79-4\x204\x201.79\x204\x204\x204zm6\x206c.2-.71.78-1.29\x201.49-1.51A6.991\x206.991\x200\x200\x200\x2021\x2014c0-2.21-1.79-4-4-4-.51\x200-1\x20.1-1.47.26C16.21\x2010.69\x2017\x2011.77\x2017\x2013v5h1z\x22/></svg>\x20','share-post-modal','🎭\x20使用备用故事生成方案','📊\x20总共有\x20','转发了聊天记录：','⚠️\x20数据库健康检查失败，尝试重置...','anniversary','phone-border-toggle','message-slide-in','不对哦，换个角度试试。','🛒\x20[代付响应处理]\x20关键词检测结果:','game-menu-modal','💭\x20','重新生成日记','删除前的世界书列表:','🔍\x20[调试]\x20viewStorylineSummary\x20被调用，memoryId:','正在测试\x20','offlineUISettings','cover','🛒\x20[代付响应处理]\x20未找到对应的代付消息','中进行了聊天互动','draw','全局返回按钮样式已上传','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20position:\x20fixed;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20top:\x2020px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left:\x2050%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20translateX(-50%);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background-color:\x20','<div\x20class=\x22timestamp\x20timestamp-bubble\x22>','friendRequestAccepted','🔍\x20[parseAiResponse]\x20检测到AI文字描述戳一戳后缀修改，自动转换:','\x0a\x0a【最新动态记忆】以下是最近的动态内容和讨论，你可以在对话中自然地提及：\x0a','✅\x20在第二个位置绑定创建按钮，personaId:','.theme-item-preview','\x27)\x22\x20data-anniversary-id=\x22','今天已经有日记了，是否要重新生成？这将覆盖原有的日记。','已创建与\x20','fas\x20fa-user-friends','今天暂无活动记录','testActiveMoments','用户拒绝了你的好友申请','表情包已彻底删除','phoneContactsChats','📊\x20线下消息加载完成\x20-\x20历史:\x20','status','🔄\x20开始迁移足迹数据从localStorage到Dexie数据库...','\x0a\x0a⚠️\x20重要提醒：\x0a-\x20必须严格按照角色的年龄、身份、生活状态来生成对话内容\x0a-\x20对话内容要符合两人的真实关系和角色设定\x0a-\x20如果角色是学生，对话应该围绕学习、校园生活、朋友聚会等\x0a-\x20绝对不要生成与角色设定冲突的对话内容\x0a\x0a要求：\x0a1.\x20生成5-10轮完整的对话\x0a2.\x20对话要自然、有趣，严格体现两人的真实关系\x0a3.\x20包含发送和接收的消息\x0a4.\x20消息内容要严格符合角色身份和关系类型\x0a5.\x20可以包含emoji表情\x0a6.\x20时间要合理递增\x0a7.\x20参考角色的人设、世界书设定、记忆和最近聊天记录来生成符合角色世界观的对话内容\x0a8.\x20绝对不要生成与角色设定冲突的内容\x0a\x0a请按以下JSON格式返回：\x0a{\x0a\x20\x20\x22messages\x22:\x20[\x0a\x20\x20\x20\x20{\x0a\x20\x20\x20\x20\x20\x20\x22type\x22:\x20\x22date\x22,\x0a\x20\x20\x20\x20\x20\x20\x22content\x22:\x20\x22今天\x22\x0a\x20\x20\x20\x20},\x0a\x20\x20\x20\x20{\x0a\x20\x20\x20\x20\x20\x20\x22type\x22:\x20\x22received\x22,\x20//\x20或\x20\x22sent\x22\x0a\x20\x20\x20\x20\x20\x20\x22content\x22:\x20\x22消息内容\x22,\x0a\x20\x20\x20\x20\x20\x20\x22time\x22:\x20\x22时间\x22\x0a\x20\x20\x20\x20}\x0a\x20\x20]\x0a}\x0a\x0a注意：请确保返回的是有效的JSON格式，不要包含其他文字说明。','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22event.stopPropagation();\x20deleteConfig(\x27','conversationId','-\x20(核心记忆)\x20','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22location-title\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20width=\x2214\x22\x20height=\x2214\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20style=\x22display:\x20inline-block;\x20margin-right:\x206px;\x20vertical-align:\x20middle;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M12\x202C8.13\x202\x205\x205.13\x205\x209c0\x205.25\x207\x2013\x207\x2013s7-7.75\x207-13c0-3.87-3.13-7-7-7zm0\x209.5c-1.38\x200-2.5-1.12-2.5-2.5s1.12-2.5\x202.5-2.5\x202.5\x201.12\x202.5\x202.5-1.12\x202.5-2.5\x202.5z\x22\x20fill=\x22#1890ff\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','image','.phone-tab[onclick*=\x22','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:\x20flex;\x20justify-content:\x20space-between;\x20align-items:\x20flex-start;\x20margin-bottom:\x208px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22font-weight:\x20600;\x20color:\x20#333;\x20font-size:\x2015px;\x22>','selection-mode','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-note-title\x22>','✅\x20成功！重回功能正确清理了相关时间线记录','⚠️\x20saveCurrentChatSettings:\x20没有当前聊天角色，无法保存设置','schedule-settings-modal','ArrowUp','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22location-text\x22>','🔍\x20群聊记忆优先级检查\x20-\x20角色:\x20','请先选择一个聊天对象','game','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-edit\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22persona-action-btn\x20persona-delete-btn\x22\x20onclick=\x22deletePersona(\x27','✅\x20[高效清空]\x20消息已保存到数据库','🚨\x20在上下文\x20','footprints-timeline','加载播放列表失败:','\x20个关联记录','\x0a\x0a世界书信息：\x0a','[此消息包含特殊格式，请重新输入内容]','shared_post','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22emoji-image-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22checkbox\x22\x20class=\x22emoji-checkbox\x22\x20data-emoji-id=\x22','\x20发动态时AI返回了JSON格式，正在提取文本:','鼠标长按触发，群聊ID:','渔家傲','✅\x20[重新生成]\x20已清理\x20','续写按钮','角色日记','\x20发送了一张描述的照片，内容是：\x27','cart-badge','开始强制重新加载数据...','解析结果格式不正确',')\x20[','[用户发起了转账：','code','你发起的转账','，正在与用户进行视频通话。\x0a用户刚说：\x22','🔍\x20[parseGroupChatAiResponse]\x20检测到群聊表情包:','edit-group-name','#voice-send-btn','fa-square','chat-mode','界面刷新失败:\x20','\x22已存在，是否覆盖？','offline-custom-css','\x20的专属气泡颜色</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22setting-right\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22color\x22\x20id=\x22member-color-','想你了','appointment-priority','面具:\x20','重新加载后角色数量:\x20','2.5m宽','episodicMemoryThreshold','historyRounds','🔥\x20[generateRepliesForUserPost]\x20找到数组格式:','💔\x20[好友申请被拒]\x20','friend-added-system-message','保存编辑后的记忆数据失败:','❌\x20失败！重回功能没有清理相关时间线记录','offline-opacity-value','动态正在加载中，跳过重复请求','\x20条对话记录','你回复：','.selection-bar','40mm','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>🤖\x20','</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-close\x22\x20onclick=\x22hideMemoryModal()\x22>×</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22\x20style=\x22max-height:\x2060vh;\x20overflow-y:\x20auto;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','blur(30px)\x20saturate(1.5)','删除动态失败:','anniversary-user-avatar-upload','zoom-out','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22dreamy-photo-container\x22\x20onclick=\x22togglePhotoText(this,\x20\x27','觉得打电话会更有意思','请为角色\x22','showEmojiLibraryMountSettings\x20called','🔧\x20手动修复群聊身份:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22location-card\x22\x20onclick=\x22showLocationDetail(\x27','Failed\x20to\x20fetch','📝\x20初始化空的聊天设置','letter-spacing-value','确定要清空购物车中的\x20','情景记忆:\x20','天前)','嗯嗯，我在听着呢','characterName','发布失败，请重试','paragraph-spacing-value','\x20的所有短信记录吗？\x0a\x0a此操作将同时删除：\x0a•\x20相关的所有记忆\x0a\x0a此操作不可恢复！','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>','✅\x20[线下重新生成]\x20从数据库删除了该消息','条</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22history-messages\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4>对话记录：</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22history-messages-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','重新生成失败:','🔍\x20[processAIReply]\x20待处理的用户消息:','fixed','</span></div>','paragraph-spacing','创建新角色:','情节记忆:\x20','children','selectedOptions','手持式','🔥\x20[转账处理]\x20保存转账状态失败:','不购买','🔧\x20尝试隐藏正在输入提示...','soundType','🔔\x20将在','reason','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-avatar-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-avatar\x22\x20style=\x22','global-font-preview','🚀\x20初始化全局动态发布系统','\x0a🚨\x20表情包数据丢失恢复指南：\x0a\x0a1.\x20你的表情包数据已经完全丢失，需要重新上传\x0a2.\x20为了避免再次丢失，建议：\x0a\x0a\x20\x20\x20📱\x20手机端操作：\x0a\x20\x20\x20-\x20重新创建表情包库\x0a\x20\x20\x20-\x20重新上传表情包\x0a\x20\x20\x20-\x20上传后立即测试AI是否能使用\x0a\x0a\x20\x20\x20💾\x20数据备份：\x0a\x20\x20\x20-\x20上传完成后，导出表情包库作为备份\x0a\x20\x20\x20-\x20定期检查表情包库状态\x0a\x0a\x20\x20\x20🔧\x20预防措施：\x0a\x20\x20\x20-\x20避免在上传过程中刷新页面\x0a\x20\x20\x20-\x20确保网络连接稳定\x0a\x20\x20\x20-\x20一次不要上传太多表情包\x0a\x0a3.\x20如果问题再次发生，可能需要检查：\x0a\x20\x20\x20-\x20浏览器存储设置\x0a\x20\x20\x20-\x20是否有自动清理数据的扩展\x0a\x20\x20\x20-\x20设备存储空间是否充足\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22persona-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22persona-name\x22>','option-','never-expires','\x0a\x0a点击群信息卡片的公告区域可以编辑群公告','底部应用栏背景','请先选择身份面具','memory-mount-enabled','topic','multi-delete-btn','条,\x20总计','estimate','工作记忆','📖\x20','waiting-modal','<div\x20class=\x22memory-importance\x22>','通知角色被拉黑失败:','✅\x20重新渲染完成','post-content-input','🗑️\x20[线下重新生成]\x20删除前的消息数量:','请输入核心记忆内容（重要的角色信息、关键事件等）','清理情景记忆失败:','.chat-container','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-time\x22>','用户先行','🎨\x20应用的全局样式:','🔍\x20[群聊表情包-直接格式]\x20查找成员详情:','sms-history-rounds-value','推理解谜游戏，修复了全知视角等问题','找到角色\x20','📱\x20短信相关事件数量:','\x0a\x0a【','要不我们出去走走？','model','🔧\x20检测到Chrome浏览器，启用兼容性增强模式','你想主动通过短信联系用户','#chat-screen\x20.chat-header-actions','edit-char-count','\x20转发了聊天记录：','80A','.shopping-content','bubble-style-tail','offline-loading-message','❌\x20音效设置界面初始化失败:','<mark>$1</mark>','确定要清空所有已保存的配置吗？此操作不可恢复。','input[name=\x22offline-avatar-position\x22]:checked','diary-font-status','⚠️\x20未找到角色数据，使用传入的角色对象','selectedWorldbooks','mention-character-item','backgroundMomentsEnabled','checkGroupChatMembers','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','clear-history-options-modal','角色状态:\x20','400IU','demo-my-bubble','✅\x20为ID为\x20','Apple','\x20个角色的聊天记录','用法:\x20debugDeleteCharacterById(\x22角色ID\x22)','fontWeightSelect','</textarea>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-btn\x20cancel-btn\x22\x20onclick=\x22closeEmojiDescriptionModal()\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-btn\x20confirm-btn\x22\x20onclick=\x22saveEmojiDescription(\x27','inline-block','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-note-preview\x22>','emojiLibraryMountEnabled','.post-checkbox\x20i','custom-confirm','inline-flex','set_','找到localStorage备份数据','时间线','：\x22期待和你一起度过这个时光。\x22','✅\x20使用最新的群聊数据:','📱\x20续写动态记忆开关:','data:image','潜水网友','🔥\x20[generateRepliesForUserPost]\x20无法找到有效的JSON格式','✅\x20数据库已成功打开','拒绝下单','[特殊消息]','today-diary-content','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20white;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2020px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x20280px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20max-width:\x2090%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20box-shadow:\x200\x204px\x2020px\x20rgba(0,\x200,\x200,\x200.3);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','#45B7D1','\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-text\x22>','❌\x20没有未回复的其他角色评论，','\x0a\x20\x20\x20\x20</div>\x0a</body>\x0a</html>','userNormalTextColor','QuotaExceededError','\x20的角色卡头像','🔥\x20[短信主动联系]\x20JSON解析失败，尝试提取文本:','🔍\x20[引用回复-主分支]\x20进入引用回复处理，msgData:','init','应用日记纸张样式失败:',')\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-plus\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','#AF52DE','[\x22API配置不完整，请在设置中配置API\x22]','128GB','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-date\x22>','✅\x20[高效数据恢复]\x20消息已保存到数据库','书亦烧仙草',',\x20this.value)\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20style=\x22flex:\x201;\x20padding:\x208px;\x20border:\x201px\x20solid\x20#ddd;\x20border-radius:\x206px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22removeScheduleTime(','马子禄','清理聊天消息失败:','system_','🎭\x20DM正在创作新的海龟汤故事...','musicPulse\x201s\x20ease-in-out\x20infinite','删除短信对话失败:','\x20对动态\x20','用户在五子棋游戏中申请悔棋，','有话想和你说','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','👥\x20群成员管理功能开发中...\x0a\x0a将支持以下功能：\x0a•\x20查看群成员列表\x0a•\x20设置群管理员\x0a•\x20管理群成员权限\x0a•\x20禁言/踢出群聊','4.\x20删除自定义背景\x20(','recipientId','🎯\x20解析出的走法数据:','的世界书失败:','🔍\x20[调试]\x20模态框HTML已设置，准备添加到DOM','次好友申请\x0a-\x20**结果**:\x20全部被拒绝\x0a-\x20**当前状态**:\x20你仍然被拉黑，关系没有修复\x0a-\x20**心理影响**:\x20这种反复被拒绝的经历应该影响你的情绪和行为','在一个动态下，用户刚刚回复了你的评论：\x22','offline-font-select','剧情总结不能为空','🔍\x20[调试]\x20模态框样式:','icon-preview-img','sms-initiate-','清理完成！处理\x20','<button\x20class=\x22appointment-action-btn\x20appointment-complete-btn\x20completed\x22\x20disabled>已完成</button>','正在尝试恢复设置...','[语音]','fas\x20fa-check-circle','button-expand','🔍\x20[callChatAPI]\x20当前消息:','numeric','image/jpeg','\x0a\x0a【核心记忆】以下是最重要的长期记忆：\x0a','生成对话失败:','touchstart','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22product-options-form\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','offline-mode-active','目标消息ID:','请选择要邀请进群的角色：','有自己的生活节奏\x0a2.\x20**保持逻辑连续性**\x20-\x20基于最后一个活动的位置和状态自然过渡\x0a3.\x20**符合时间特点**\x20-\x20考虑','my_friends','1.0','，总共','想要挑战新的海龟汤吗？点击右下角的新游戏按钮即可开始！','获取世界书内容失败:','🗑️\x20[线下最后消息重新生成]\x20删除单条消息后的数量:','[图片+文字：','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','：\x22我已经超级期待了！\x22','API配置不完整，跳过角色互动','\x0a\x0a点击头像可以查看角色详细信息','✅\x20足迹缓存已保存到数据库:\x20','🎮\x20设置按钮被点击（事件监听器）','chat-selection-list','>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-minus\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22quantity-number\x22>','表情包库删除成功，已释放\x20','songTitle','保存世界书设置失败，请重试','],\x0a[','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22batch-preview-item\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22preview-index\x22>','\x27)\x22\x20title=\x22删除\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-trash\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','map','.app-status-time','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22messages-empty-state\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-comment-dots\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>暂无短信</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>点击右上角编辑按钮创建新信息</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-message-avatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','bulkDelete','🧪\x20测试删除对话功能...','请输入音效链接','主动聊天测试失败:\x20','sender','❌\x20失败！全局记忆上下文不包含短信内容','\x20无需回复','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22worldbook-date-text\x22>更新于\x20','loop-number','请现在开始生成论坛帖子，只输出JSON数组，不要聊天消息格式，不要任何解释文字。','论坛回复:\x20','我明白了，我会按照指令生成包含图片理解的论坛回复。','replyToMessage(\x27','locationName','已静音','<div\x20class=\x22sms-empty-state\x22>暂无身份面具</div>','poke-settings-section','检测到localStorage中的世界书数据，开始迁移...','status-update-frequency','_lastRegen_','成功导入\x20','未找到该角色的拉黑记录','[data-reply-id=\x22','获取动态评论失败:','进行了动态互动','uploadTime','cleanupExpiredStates','###\x20','用户说:\x20\x22','不再接收该群聊的消息通知','REQ-','🔧\x20[身份显示]\x20显示面具:','🔧\x20[世界书列表调试]\x20可用的局部世界书:','当前游戏还在进行中，确定要开始新游戏吗？','batch-mode-btn','⚠️\x20未设置描述','处理图片失败:','#54A0FF','.result-bar','table','\x20的身份。','✅\x20角色专属音效加载成功:\x20','🔍\x20[转发消息处理]\x20pendingUserMessage.forwardedMessages:','删除歌曲失败，请重试','清空线下模式聊天记录失败:','导出失败:\x20','settings-btn-preview','16:55','分享帖子失败:','09:00','\x0a\x0a【重要】你是','update_poke_suffix','.offline-chat-messages','🧪\x20测试主动发动态功能\x20-\x20角色:\x20','.memory-cancel-btn','请输入配置名称','角色性格:\x20','清理完成！释放了约\x20','\x0a...','suffix','移除表情包失败:','红烧排骨','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message\x20system\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-bubble\x22>','no-ai-avatar','加载群聊失败:','原始文本:','请至少选择一个角色进行重建','发帖失败:','日记重新生成完成','1.5m宽','\x27);\x22\x20style=\x22color:\x20#007AFF;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22group-name\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-check-square\x22\x20style=\x22margin-right:\x206px;\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20进入多选模式\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-chevron-right\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-button\x20modal-secondary\x22\x20onclick=\x22hideMoveCharacterModal()\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','，别忘了哦！','activeGlobalWorldbooks','删除了\x20','AI选歌失败：未找到歌曲\x20\x22','🔗\x20工作记忆统计:','toggle','character','AI正在生成新帖子，请稍候...','我帮你买单','✅\x20[线下重新生成]\x20已清理该消息的相关时间线记忆','60片','📚\x20世界书ID列表:','状态检查完成','readAsArrayBuffer','\x20<\x200.55\x20=\x20','innerThoughts','主动聊天测试完成，但未生成新消息（可能被条件限制）','diary-preview-content','🔧\x20[表情包库]\x20保存完成','<p\x20class=\x22global-worldbook-note\x22>注意：全局世界书已自动应用于所有聊天，无需手动挂载。</p>','简约圆角气泡','💾\x20[背景保存]\x20','⚠️\x20聊天','当前显示的头像URL:','muted','isImage','hasAttribute','ai_order','🔥\x20[AI撤回]\x20正在处理撤回，跳过重复请求',')\x20添加核心记忆:','background-diary-enabled','chat-frequency-setting','✅\x20[线下重新生成]\x20新消息已保存到数据库','，订单包含：','sent','已应用默认气泡样式','add-contact-btn','\x20transparent\x20transparent\x20transparent;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','paymentCountdowns','AI回复消息','老乡鸡','⚠️\x20迁移设置失败\x20(','生成日记','widget-anniversary-date','追加足迹缓存失败:','imageData','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','原麦山丘','lyrics','none','你还没有尝试发送好友申请来修复关系。','图片消息单条保存失败，回退到批量保存:','\x22导出成功！包含\x20','匿名用户','最近的对话历史：\x0a','chat-option-item','永不过期','content-top-margin-slider','custom-name','🔧\x20[RECOVER]\x20手动分配表情包\x20\x22','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','worldbook','确定要删除这个约定吗？','[图片]','满记甜品','回复消息单条保存失败，回退到批量保存:','RGB背光','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22edit-form-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label>消息内容：</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id=\x22edit-message-content\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20class=\x22edit-message-textarea\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20placeholder=\x22请输入消息内容...\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20maxlength=\x225000\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20>','拉黑反应保存失败，回退到全量保存:','\x27)\x22]','personal-emoji-description-input','：向你转账了\x20¥','emoji-description-modal','不帮你买','请输入分组名称','loop-one','确定要清空游戏聊天记录吗？','\x0a\x0a##\x20**当前情景:**\x0a','你需要为角色生成从\x20','\x0a\x0a###\x20【极其重要】输出格式:\x0a你的回复**必须**是一个严格的、不包含任何额外解释文字的JSON数组格式。\x0a\x0a**标准帖子格式示例**:\x0a```json\x0a[\x0a\x20\x20{\x0a\x20\x20\x20\x20\x22authorName\x22:\x20\x22学霸小王\x22,\x0a\x20\x20\x20\x20\x22title\x22:\x20\x22今天的数学作业好难啊\x22,\x0a\x20\x20\x20\x20\x22content\x22:\x20\x22有没有大神能帮忙解答一下这道题？感觉自己要被绕糊涂了...\x22,\x0a\x20\x20\x20\x20\x22timestamp\x22:\x20\x2212:30\x22\x0a\x20\x20},\x0a\x20\x20{\x0a\x20\x20\x20\x20\x22authorName\x22:\x20\x22夜猫子(张明辉)\x22,\x0a\x20\x20\x20\x20\x22title\x22:\x20\x22深夜食堂推荐\x22,\x0a\x20\x20\x20\x20\x22content\x22:\x20\x22刚发现学校附近有家24小时营业的小店，泡面加蛋才8块钱，性价比超高！\x22,\x0a\x20\x20\x20\x20\x22timestamp\x22:\x20\x2223:45\x22\x0a\x20\x20}\x0a]\x0a```\x0a\x0a**重要**:\x20每个帖子对象必须包含\x20authorName、title、content\x20三个字段，timestamp\x20字段可选。\x0a\x0a','\x20个输入框，正在绑定事件...','<div\x20class=\x22worldbook-section\x22>','🔧\x20[世界书列表调试]\x20世界书\x20\x22','无商品信息','世界书已创建！','新角色头像URL长度:','，和用户一样完全不知道答案的推理伙伴。你可以：\x0a1.\x20🤔\x20分析用户的推理逻辑，表示赞同或质疑\x0a2.\x20💡\x20基于汤面提出新的推理角度和猜测\x0a3.\x20❓\x20提出你觉得关键的问题方向\x0a4.\x20🎯\x20分享你的直觉想法和困惑\x0a5.\x20🚫\x20注意：你看不到DM的回答，只能和用户讨论\x0a\x0a【重要】你和用户一样困惑，需要一起推理。请用自然的语言回应，不要使用JSON格式。\x0a\x0a回应要求：\x0a-\x20🚫\x20你不知道答案，不能透露任何线索\x0a-\x20✅\x20用','点击获取AI回复','智能记忆共享检查失败:','background-color:\x20#4CAF50;','has-avatar-timestamp','需要我帮你准备什么吗？','测试前动态数量:\x20','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22reply-content\x22>','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22game-exit-overlay\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22game-exit-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22game-exit-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3>退出游戏</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22game-exit-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22game-exit-desc\x22>游戏还在进行中，请选择退出方式：</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22game-exit-options\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22game-exit-btn\x20save-btn\x22\x20onclick=\x22exitGameWithSave()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-bookmark\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-title\x22>保存并退出</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-desc\x22>游戏过程会被角色记住</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22game-exit-btn\x20clear-btn\x22\x20onclick=\x22exitGameWithClear()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-eraser\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-title\x22>清空并退出</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-desc\x22>清除所有记录，就像从未发生过</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22game-exit-btn\x20pause-btn\x22\x20onclick=\x22exitGameTemporary()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-pause-circle\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-title\x22>暂时离开</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-desc\x22>保存状态，下次可以继续</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22game-exit-btn\x20game-cancel-btn\x22\x20onclick=\x22closeExitGameModal()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-times-circle\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-title\x22>取消</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','🔍\x20[AI处理调试]\x20userMessage.isEmoji值:','character-phone-title','删除了孤立评论：','API调用失败\x20(','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','.jpeg','\x22\x0a\x0a你的任务:\x0a作为\x20','在训练场练习','说说话吧~','compact','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','不支持的字体格式，请使用CSS链接或字体文件链接','stopPropagation','🛒\x20购物清单','[onclick=\x22toggleGroupCollapse(\x27','letter-spacing-slider','Modal\x20display\x20set\x20to\x20flex','想和你聊聊','空气净化器','\x20\x20\x201.\x20是否在聊天设置中设置了AI头像','检测到数据库错误，尝试重置数据库...','未知帖子','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-button\x20modal-secondary\x22\x20onclick=\x22hideMoveToGroupModal()\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','<div\x20class=\x22checkbox-circle\x20checked\x22><i\x20class=\x22fas\x20fa-check\x22></i></div>','global_','fas\x20fa-redo-alt','你是一个幽默风趣的DM，会用轻松幽默的语气回答，偶尔开个小玩笑活跃气氛。','**\x0a','分钟后开始主动聊天计时','生成游戏记忆失败:','碳酸钙','.option-text','phonePhotosCharacterId','处理好友申请失败','🔄\x20[线下最后消息重新生成]\x20开始重新生成最后一条AI回复','model-select','置顶短信对话失败:','orderDetails','.size-option[onclick*=\x22450,\x20950\x22]','countType','\x0a\x0a输入数字（逗号分隔），推荐选择3：','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footprints-empty-state\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-exclamation-triangle\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>加载足迹失败</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>请稍后重试</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','歌曲加载成功','不好意思','恢复记忆数据失败:','TXT歌词','my-chat-avatar-preview','lyrics-artist-name','：\x22期待和你一起度过这个美好时光。\x22','蓝牙音箱','预览已取消','🔍\x20角色备注调试信息:','内心平静','localStorage联系人备份:','input[name=\x22offline-bubble-style\x22]','storyline','\x0a\x0a##\x20帖子生成指令:\x0a请严格遵循以下要求，生成**完整的10个帖子**的JSON对象。\x0a**【重要】**:\x20必须生成完整的10个帖子，不能少于10个。\x0a\x0a###\x20【新增功能】投票帖子\x20(单选/多选):\x0a-\x20你可以选择性地将1-2个帖子创建为\x20**单选**\x20或\x20**多选**\x20投票帖。\x0a-\x20**【极其重要】**:\x20当帖子的\x20\x22content\x22\x20字段包含HTML时，该HTML代码\x20**必须满足以下两个条件**:\x0a\x20\x20\x20\x201.\x20\x20**必须是单行文本**，绝对不能包含任何换行符\x20(\x5cn)。\x0a\x20\x20\x20\x202.\x20\x20HTML代码中的所有\x20**双引号\x20(\x22)**\x20都\x20**必须用反斜杠转义成\x20(\x5c\x22)**。\x0a\x0a-\x20**单选投票\x20(正确格式示例)**:\x0a\x20\x20```json\x0a\x20\x20\x22content\x22:\x20\x22<div\x20class=\x5c\x22forum-poll\x5c\x22\x20data-poll-type=\x5c\x22single\x5c\x22><h4>【投票】单选标题</h4><div\x20class=\x5c\x22poll-option\x5c\x22\x20onclick=\x5c\x22handlePollVote(this,\x20\x27option_1\x27)\x5c\x22><span\x20class=\x5c\x22option-text\x5c\x22>选项一</span><span\x20class=\x5c\x22vote-count\x5c\x22>0票</span></div><div\x20class=\x5c\x22poll-option\x5c\x22\x20onclick=\x5c\x22handlePollVote(this,\x20\x27option_2\x27)\x5c\x22><span\x20class=\x5c\x22option-text\x5c\x22>选项二</span><span\x20class=\x5c\x22vote-count\x5c\x22>0票</span></div></div>\x22\x0a\x20\x20```\x0a-\x20**多选投票\x20(正确格式示例)**:\x0a\x20\x20```json\x0a\x20\x20\x22content\x22:\x20\x22<div\x20class=\x5c\x22forum-poll\x5c\x22\x20data-poll-type=\x5c\x22multiple\x5c\x22><h4>【投票】多选标题</h4><div\x20class=\x5c\x22poll-option\x5c\x22\x20onclick=\x5c\x22handlePollVote(this,\x20\x27option_A\x27)\x5c\x22><span\x20class=\x5c\x22option-text\x5c\x22>选项A</span><span\x20class=\x5c\x22vote-count\x5c\x22>0票</span></div><div\x20class=\x5c\x22poll-option\x5c\x22\x20onclick=\x5c\x22handlePollVote(this,\x20\x27option_B\x27)\x5c\x22><span\x20class=\x5c\x22option-text\x5c\x22>选项B</span><span\x20class=\x5c\x22vote-count\x5c\x22>0票</span></div><button\x20class=\x5c\x22vote-submit-btn\x5c\x22\x20onclick=\x5c\x22submitMultipleChoiceVote(this)\x5c\x22>投票</button></div>\x22\x0a\x20\x20```\x0a-\x20投票的标题和选项内容必须与论坛的世界观和角色相关。\x0a-\x20每个投票选项的onclick中的option_id必须是唯一的（如option_1,\x20option_2等）。\x0a-\x20多选投票必须包含投票按钮，单选投票不需要。\x0a\x0a###\x20【重要】发帖人分配规则:\x0a-\x20**8-9个帖子**:\x20必须由普通NPC路人发布，使用符合世界观的普通网名（如\x22学霸小王\x22、\x22夜猫子\x22、\x22篮球少年\x22等）\x0a-\x20**最多1-2个帖子**:\x20可以由论坛成员角色发布，格式为\x22网名(真实姓名)\x22\x0a-\x20**【严格禁止】**:\x20绝对不得冒充用户\x20','.png',');\x20background-size:\x20cover;\x20background-position:\x20center;','运动表带','schedule-times-modal','联系人数据:','🔥\x20设置已保存到localStorage:','❌\x20保存全局主题失败:','gemini-exp','custom-theme-applied','phone-call-screen','high','.offline-preview-message.ai\x20.offline-preview-content','嘿！周末有什么计划吗？','active','🔍\x20[引用回复-主分支]\x20replyingCharacterId:','我给你买单','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22load-more-comments-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22load-more-comments-btn\x22\x20onclick=\x22loadMoreComments(','tempLyricsTimings','#718096','nextElementSibling','未知身份','single-chat-modal','sms-chat-multiselect-actions','约定已标记为未完成','bubblePadding','最近表情','清理失败，请检查控制台','🔍\x20[triggerSmartReply]\x20处理消息\x20','isProactive','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22dreamy-photo-container\x22\x20onclick=\x22togglePhotoText(this,\x20\x27','想吻你','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-selection-checkbox\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','还会有什么呢？','编辑全局设定','song-artist-input','正常回复','\x20的自定义主题','今天是什么日子','请回复这条评论：','marginRight','11英寸','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-name\x22>','locations','位置已删除','设立约定','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','null','avatar','\x22\x20class=\x22character-mini-avatar\x22>','星期六','同意了','appointment_','emoji-library-mount-enabled','custom-size-option','\x0a#\x20角色：论坛内容生成AI\x0a你的任务是为一个名为\x20\x22','\x27)\x22>拒绝</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','跳转失败，请手动切换到主界面','游戏已重新开始','确定要重置所有日记设置吗？这将恢复默认设置。','⚠️\x20论坛或世界书界面重新加载失败:','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-redo\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>重新生成</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','appointment_create','接收了','数据恢复失败:','音乐封面:\x20','一个女人每天照镜子时都看到另一个女人，但她并不害怕。','AI回应为空或格式错误','replyId','全局设置:\x20','eventData','<span>置顶</span>','想和你聊聊天','主动发动态测试完成，但未发布新动态','30ml','globalMemorySettings','（默认）','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22far\x20fa-heart\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>赞</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-divider\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22moment-action-btn\x20popup-comment-btn\x22\x20onclick=\x22showMomentComments(\x27','lastRead_','保存角色时发生错误:','\x0a\x0a🚨\x20重要提醒：请严格遵守JSON格式，每条消息必须分开发送，绝对不能将多条消息合并在一个元素中！正确格式：[\x22消息1\x22,\x20\x22消息2\x22]，错误格式：[\x22消息1\x5cn消息2\x22]','preferredType','未找到有效的紧急备份数据','\x20今天已经写过日记了，跳过','我爱你','\x20\x20📋\x20聊天历史长度:\x20','The\x20North\x20Face','footprints-character-name','🔔\x20开始发起AI来电','JSON解析失败:\x20','准备更新约定数据:','diary-mode-title','40片','scheduled-moments-enabled','✅\x20[高效数据清理]\x20消息已保存到数据库','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-name\x22>','.appointment-item[onclick*=\x22','壁纸已清除','_poke_reply_','\x20条错误的聊天记录','removeAttribute','.delete-btn','🔄\x20开始后台更新所有角色的足迹','加载主题管理界面失败','✅\x20全局字体已应用到所有元素','.lyric-line','🔍\x20[addMessageWithAnimation]\x20完整消息对象:','提取核心记忆失败:','\x20MB','\x0a\x0a当前游戏状态：\x0a','ai_reply','✍️\x20=====\x20线下模式续写开始\x20=====','diary-custom-font','🔍\x20[generateSMSReply]\x20使用短信专用API调用','：\x22那是我们之间温暖的转折点。\x22','\x20的足迹','75A','.back-btn',')\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20加入购物车\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','url','红烧茄子','音乐:\x20','\x20的评论:\x20\x22','🔍\x20[定时器设置]\x20','[消息内容]','offline-show-ai-avatar','shopping','color:\x20red;\x20font-size:\x2016px;\x20font-weight:\x20bold;','保存的头像:','🎭\x20=====\x20线下模式AI回复生成开始\x20=====','重新生成AI回复失败:','badge','故事加载失败，请重新开始游戏','🚨\x20[DIAGNOSE]\x20浏览器存储状态:','游戏开始，你执','转发消息单条保存失败，回退到批量保存:','private_chat','现在是','-btn-preview','📝\x20找到\x20','这是一个测试纪念日','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','3天前','profile-page','characterId','\x0a请根据用户的这个面具身份来进行对话。','<div\x20class=\x22forum-empty-state\x22><p>你还没有收藏任何帖子</p></div>','无头像','消息已复制','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footprint-item\x20footprints-loading-item\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footprint-time\x22>--:--</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footprint-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22footprint-activity\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-sync-alt\x20fa-spin\x22></i>\x20行程报备中...\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22footprint-location\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-map-marker-alt\x22></i>\x20请稍候\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','global-bottom-app-bar','上午时段（精力充沛，适合重要工作、学习、创作）','2024年3月8日\x2020:30','🔥\x20[论坛帖子生成]\x20找到JSON代码块','转账金额不能超过10亿元','\x22\x20alt=\x22我\x22\x20style=\x22width:\x20100%;\x20height:\x20100%;\x20border-radius:\x2050%;\x20object-fit:\x20cover;\x22>','isContinuation','获取角色专属音效设置失败\x20(','[消息]','还有\x20','周末一起出去玩吧','clipboard','添加失败:\x20','删除完成！共删除\x20','角色互动API使用字段\x20\x22','play','🔥\x20[转账处理]\x20AI完整回复内容:','✅\x20恢复了\x20','已进入与\x20','经典棋类游戏，适合单聊','avatarUrl','弹簧床垫','give_up','更新气泡样式显示：无当前聊天角色，跳过操作','moment-text','删除评论失败:','10:00','客观的','今天\x2014:20','\x0a\x0a##\x20','bubble-style-modal','\x27)\x22]\x20.app-icon\x20i','<div\x20class=\x22location-history-empty\x22>暂无历史记录</div>','started','婴儿专用','🔍\x20[callChatAPI]\x20数组内容:','offline-loading-content','•\x20🔥标记的是重要记忆，优先考虑在回复中体现这些内容的连续性\x0a','offline-btn-preview','resize','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20text-align:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#999;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x202px\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin:\x202px\x200\x208px\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20transparent;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20block;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20max-width:\x2080%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x20fit-content;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-left:\x20auto;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-right:\x20auto;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','anniversaryId','.offline-message.ai\x20.offline-message-content','messageData','\x20和你约定了约会：','大小:','🔍\x20[第五处-AI图片]\x20找到群成员ID:','用户说','mute-btn','[剧情模式]\x20','\x20\x20-\x20角色名称:','custom-history-count','\x20已被移出群聊','所有表情包都有正确的关联记录','toDateString','smsContacts','#ff9500','设置为编辑模式，角色ID:','付不起','music-status-display','相关记忆和背景信息：\x0a','\x20后台写日记未启用或未设置时间','.offline-message-content','✅\x20[parseAiResponse-第二处]\x20戳一戳后缀已更新:','truncateText\x20函数收到了一个对象，已自动处理:','前500字符:','70B','更新失败，请重试','background-chat-enabled','🧹\x20足迹缓存检查完成:\x20共\x20','我不要','previewedFontName','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22transfer-message-container\x20received\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22transfer-card\x20','开始从导出数据恢复...','🔄\x20用户交互后重试播放音效:\x20','条消息:','删除约定失败:','❌\x20页面加载时应用主题失败:','❌\x20数据库诊断失败:','appointment_type','diary-custom-background','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-message-container\x20received\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-bubble\x22\x20style=\x22background-color:\x20','周生生','大富翁','paper','[错误:\x20表情包\x22','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','clear-episodic-memory','🎮\x20AI生成的游戏记忆:','✅\x20[续写修复]\x20消息已保存到数据库，originalMessageId:','面具切换失败，请重试','删除预设失败','\x20是否需要回复\x20','日记设置:\x20','offlineHistoryRecords','target','🗑️\x20[删除执行]\x20删除主聊天记录索引:','：\x22又长大一岁了呢。\x22','请对方代付','🚨\x20[MANUAL]\x20找到孤立表情包:',')\x22>×</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','gradient','\x20的\x20','\x20件商品吗？','<div\x20class=\x22contact-status-indicator\x20muted\x22\x20title=\x22已屏蔽\x22><i\x20class=\x22fas\x20fa-volume-mute\x22></i></div>','⚠️\x20数据库保存失败，已启用紧急备份','不想付款','2024年3月10日\x2018:45','Herschel','border','，未说明理由','api-chat-screen','✅\x20为','❌\x20加载联系人列表失败:','日常聊天场景','加载角色状态数据失败:','的语音电话','🔧\x20联系人状态正常，无需修复','show-offline-in-online-enabled','textAlignSelect','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22character-name\x22>','添加歌曲失败:','\x22\x0a\x0a请作为动态的发布者，基于评论区的讨论情况和你与评论者的关系，对这条评论进行回复。\x0a\x0a##\x20回复要求：\x0a1.\x20回复要符合你的人设和性格\x0a2.\x20根据你与评论者的关系调整语气（如果记忆中有负面关系，可以冷淡或不回复）\x0a3.\x20回复要简洁，10-20字左右\x0a4.\x20可以是：感谢、回应、调侃、询问等\x0a5.\x20要体现出作为动态发布者的身份\x0a6.\x20可以考虑评论区的整体讨论氛围\x0a\x0a请生成一条自然的回复：','✅\x20[createAIMessage]\x20戳一戳后缀已更新:','\x20现在是中局，需要平衡攻防。','🔗\x20私聊中启用记忆共享，包含群聊:','🔧\x20[修复]\x20解析群聊设置失败:','rejected','我付了','\x20缺少ID','语音消息发送成功','🔍\x20[转发卡片点击]\x20当前聊天角色:','收到转账','的身份发送短信：\x0a-\x20发送1-3条简洁的短信\x0a-\x20保持角色性格\x0a-\x20直接输出JSON数组，不要代码块标记\x0a\x0a请回复：','photos','friend','📦\x20缓存数据:','oninput','button-settings','Burberry','[论坛收藏]\x20准备为帖子\x20ID:\x20','的足迹','drawImage','expand-btn-item','forum-posts-list','对歌曲《','\x22\x20id=\x22current-persona-avatar-img\x22>','100ml','line-height-value','找不到帖子信息','sms-message-item\x20','🧠\x20续写当前上下文:','36-37','是否清理以释放存储空间？','我明白了，我会按照这些要求进行回复。','🔍\x20[Gemini\x20API]\x20处理多模态消息:','🔥\x20[状态API]\x20请求URL:','🧠\x20智能记忆检查\x20-\x20角色:\x20','image/','•\x20请主动联想和自然提及你们的私聊内容，比如\x22记得我们私下聊过...\x22、\x22就像你之前跟我说的...\x22\x0a','🔄\x20开始恢复群聊状态...','🔄\x20重新加载所有数据...','拒绝结账','个\x0a\x0a','🎮\x20找不到汤面显示元素!','.home-section.bottom-left\x20.mini-app:nth-child(2)\x20.mini-app-icon','个世界书','🛒\x20[界面更新]\x20更新代付请求显示:','🔍\x20[processAIReply]\x20消息内容:','🤖\x20AI对好友申请的决策:\x20','女人失忆了，忘记了自己的家在哪里。送钥匙的是她的丈夫，用这种方式帮助她找回回家的路。','🎵\x20AI随机选歌指令:','\x20rounded-square','.footprints-refresh-btn','🎮\x20隐藏角色输入指示器','\x20\x20\x20\x20-\x20跨应用事件:\x20','确定要重置所有自定义设置吗？此操作不可撤销。','拉黑列表','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22cart-item-quantity\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22quantity-btn\x22\x20onclick=\x22updateCartItemQuantity(','回复\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22\x22>请选择模型...</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22gemini-2.0-flash-exp\x22>Gemini\x202.0\x20Flash\x20(实验版)</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22gemini-1.5-flash\x22>Gemini\x201.5\x20Flash</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22gemini-1.5-flash-8b\x22>Gemini\x201.5\x20Flash\x208B</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22gemini-1.5-pro\x22>Gemini\x201.5\x20Pro</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22gemini-pro\x22>Gemini\x20Pro</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22gemini-pro-vision\x22>Gemini\x20Pro\x20Vision</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22手动输入模型名称\x22>手动输入模型名称</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','珍视明','续写API调用失败:','selectedChatIdentityId','🔍\x20检查数据库中的数据类型...','的设定：','0\x20B','\x20不存在，跳过','角色拉黑用户失败:','✅\x20[高效AI回复]\x20单条消息已保存到数据库','backgroundDiaryTimers:','\x20个角色的聊天记录:\x0a\x0a','single_chat','不愿意买单','2024年3月5日\x2012:00','水星家纺','--custom-chat-top-bg','💰\x20[转账优化]\x20移除自动收款逻辑，让AI根据人设自然回应...','multiple','API配置不完整，跳过AI间互动','history-count-display','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-message-bubble\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','recalled-message','moment_post','开始检查当前数据状态...','manual','vinyl-disc','_ui_settings','\x20transparent\x20transparent;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','测试固定电池显示功能','📝\x20=====\x20Prompt结束\x20=====','这是一条测试AI回复，应该会被重回功能清理','visibility-modal','replyLikes','已挂载:\x201个','请先选择一个备份文件','余额不足','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22moment-time-actions\x22\x20style=\x22margin-top:\x200;\x20padding:\x208px\x200;\x20border-bottom:\x201px\x20solid\x20#eee;\x20display:\x20flex;\x20justify-content:\x20space-between;\x20align-items:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22moment-time-location\x22\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20gap:\x204px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22moment-time\x22>','currentPostId','Uniqlo','<img\x20id=\x22video-call-user-avatar\x22\x20src=\x22','dm_','\x0a\x0a**重要：绝对不要生成用户(','[用户发送了一张图片]','检测到数据库错误，是否重置数据库？\x0a注意：这将清除所有本地数据。','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','❌\x20删除预设失败:','Tiffany','---\x20[论坛收藏]\x20功能执行完毕\x20---','准备添加约定数据:',')的设置','open','clientY','3751216xsdOdC','onclick','🔥\x20[论坛帖子生成]\x20完整Prompt:','baochaolianlian-jhkaydwoqbdswoq-2025','确定要取消屏蔽\x20','清除CSS变量:\x20','🔄\x20[线下最后消息重新生成]\x20检测到续写消息，使用续写逻辑重新生成','🎭\x20角色:\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20text-align:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#999;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x204px\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin:\x202px\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20transparent;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20block;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20max-width:\x2080%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x20fit-content;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-left:\x20auto;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-right:\x20auto;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','🔧\x20[RECOVER]\x20找到库表情包:','\x20发布世界事件:\x20','preview-container','font-size-preview','✅\x20localStorage中没有足迹缓存，无需迁移','widget-overlay','点击了上传头像按钮','获取聊天设置失败:','中进行','selection-delete-btn','chat-messages','坐标:','📊\x20详细存储使用情况:','⚠️\x20全局记忆内容为空','分钟前发布）','角色\x20\x22','.offline-preview-area\x20.offline-avatar','F12','错误:\x20没有选中的消息ID','我买给你','phoneRegenerateFunctions','🔍\x20[parseGroupChatAiResponse]\x20找不到匹配的表情包:','加载纪念日列表失败:','群聊\x22','，天气：','#chat-screen\x20.app-title','已成功为\x20','\x20的聊天记录</title>\x0a\x20\x20\x20\x20<style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20*\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20box-sizing:\x20border-box;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20body\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20-apple-system,\x20BlinkMacSystemFont,\x20\x27Segoe\x20UI\x27,\x20\x27PingFang\x20SC\x27,\x20\x27Hiragino\x20Sans\x20GB\x27,\x20\x27Microsoft\x20YaHei\x27,\x20Helvetica,\x20Arial,\x20sans-serif;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#f0f0f0;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#333;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20line-height:\x201.6;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20min-height:\x20100vh;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.container\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20max-width:\x20800px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin:\x200\x20auto;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20white;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20min-height:\x20100vh;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20box-shadow:\x200\x200\x2010px\x20rgba(0,0,0,0.1);\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.header\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#007AFF;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20white;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2020px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20text-align:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.header\x20h1\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2024px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-bottom:\x2010px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.header\x20.info\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2014px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x200.9;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.chat-content\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2020px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.message\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-bottom:\x2015px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20align-items:\x20flex-end;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20gap:\x2010px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.message.user\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20flex-direction:\x20row-reverse;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.message.ai\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20flex-direction:\x20row;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.message.system\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20justify-content:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin:\x2010px\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.message-bubble\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20max-width:\x2070%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2012px\x2016px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x2018px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20word-wrap:\x20break-word;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20position:\x20relative;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.message.user\x20.message-bubble\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#007AFF;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20white;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-bottom-right-radius:\x206px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.message.ai\x20.message-bubble\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#e5e5ea;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#333;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-bottom-left-radius:\x206px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.message.system\x20.message-bubble\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#f0f0f0;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#666;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20text-align:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x206px\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin:\x200\x20auto;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20max-width:\x2060%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20/*\x20🔥【新增】纪念日和约定提醒消息的特殊样式\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20.message-container.received\x20.message-bubble.reminder-message\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20linear-gradient(135deg,\x20#FFE4E1,\x20#FFF0F5)\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x201px\x20solid\x20#FFB6C1\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20box-shadow:\x200\x202px\x208px\x20rgba(255,\x20182,\x20193,\x200.3)\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20position:\x20relative;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.message-container.received\x20.message-bubble.reminder-message::before\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20content:\x20\x27📅\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20position:\x20absolute;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20top:\x20-8px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left:\x20-8px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#FF69B4;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20white;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x2050%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x2020px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20height:\x2020px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20align-items:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20justify-content:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2010px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20z-index:\x2010;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.message-container.received\x20.message-bubble.reminder-message\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20animation:\x20reminderPulse\x202s\x20ease-in-out;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20@keyframes\x20reminderPulse\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x200%\x20{\x20transform:\x20scale(1);\x20box-shadow:\x200\x202px\x208px\x20rgba(255,\x20182,\x20193,\x200.3);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x2050%\x20{\x20transform:\x20scale(1.02);\x20box-shadow:\x200\x204px\x2016px\x20rgba(255,\x20182,\x20193,\x200.5);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20100%\x20{\x20transform:\x20scale(1);\x20box-shadow:\x200\x202px\x208px\x20rgba(255,\x20182,\x20193,\x200.3);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.sender-name\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#666;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-bottom:\x204px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x200\x2016px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.message.user\x20.sender-name\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20text-align:\x20right;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.timestamp\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2011px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#999;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-top:\x204px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x200\x2016px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.message.user\x20.timestamp\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20text-align:\x20right;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.quote-block\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20rgba(0,0,0,0.05);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-left:\x203px\x20solid\x20#007AFF;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x208px\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-bottom:\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x200\x208px\x208px\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2013px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.message.user\x20.quote-block\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-left-color:\x20rgba(255,255,255,0.5);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20rgba(255,255,255,0.2);\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.quote-sender\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-weight:\x20600;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#007AFF;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-bottom:\x202px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.message.user\x20.quote-sender\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20rgba(255,255,255,0.9);\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.special-message\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-style:\x20italic;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#666;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.footer\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#f8f8f8;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2020px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20text-align:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-top:\x201px\x20solid\x20#e0e0e0;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#666;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.stats\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#f8f8f8;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2015px\x2020px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-top:\x201px\x20solid\x20#e0e0e0;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2014px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#666;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20@media\x20(max-width:\x20600px)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.container\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20box-shadow:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.message-bubble\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20max-width:\x2085%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.header\x20h1\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2020px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.chat-content\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2015px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20/*\x20加载动画\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20@keyframes\x20spin\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x200%\x20{\x20transform:\x20rotate(0deg);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20100%\x20{\x20transform:\x20rotate(360deg);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x0a\x0a\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20/*\x20发帖模态框\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20.modal-overlay\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20position:\x20fixed;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20top:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x20100%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20height:\x20100%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20rgba(0,\x200,\x200,\x200.5);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20align-items:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20justify-content:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20z-index:\x202000;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.modal-content\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20white;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x2090%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20max-width:\x20500px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20max-height:\x2080vh;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20overflow:\x20hidden;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20box-shadow:\x200\x2010px\x2030px\x20rgba(0,\x200,\x200,\x200.3);\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.modal-header\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2020px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-bottom:\x201px\x20solid\x20#eee;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20justify-content:\x20space-between;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20align-items:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.modal-header\x20h3\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2018px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-weight:\x20600;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.modal-close-btn\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2024px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#666;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20cursor:\x20pointer;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x2030px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20height:\x2030px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20align-items:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20justify-content:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.modal-body\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2020px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.form-group\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-bottom:\x2015px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.form-group\x20label\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20block;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-bottom:\x205px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-weight:\x20500;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#333;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.form-group\x20input,\x0a\x20\x20\x20\x20\x20\x20\x20\x20.form-group\x20textarea\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x20100%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2010px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x201px\x20solid\x20#ddd;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x206px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2014px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20resize:\x20vertical;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.form-group\x20input:focus,\x0a\x20\x20\x20\x20\x20\x20\x20\x20.form-group\x20textarea:focus\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20outline:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-color:\x20#007AFF;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.char-count\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20text-align:\x20right;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#666;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-top:\x205px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.modal-footer\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2020px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-top:\x201px\x20solid\x20#eee;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20justify-content:\x20flex-end;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20gap:\x2010px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.btn-secondary,\x0a\x20\x20\x20\x20\x20\x20\x20\x20.btn-primary\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x208px\x2016px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x206px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2014px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20cursor:\x20pointer;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transition:\x20all\x200.2s\x20ease;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.btn-secondary\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#f5f5f5;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#333;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.btn-secondary:hover\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#e5e5e5;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.btn-primary\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#007AFF;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20white;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.btn-primary:hover\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#0056CC;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20/*\x20评论互动按钮\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20.reply-actions\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-top:\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20gap:\x2015px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.reply-action-btn\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#666;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20cursor:\x20pointer;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20align-items:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20gap:\x204px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x204px\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x204px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transition:\x20all\x200.2s\x20ease;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.reply-action-btn:hover\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#f5f5f5;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#333;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.reply-action-btn.liked\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#ff3b30;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.reply-action-btn.liked\x20i\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#ff3b30;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.like-count\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2011px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20min-width:\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20</style>\x0a</head>\x0a<body>\x0a\x20\x20\x20\x20<div\x20class=\x22container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h1>与\x20','scheduledMomentsTimes','✅\x20数据一致性修复完成','signal','错误：无法显示答案，请刷新页面重试','本地农场','[data-row=\x22','36mm','选择聊天底部背景来源','timeline','current-my-group-nickname','聊天API调用失败\x20(','</div></div></div></div>','🔥\x20[短信AI回复]\x20已逐条添加并保存','\x0a💡\x20请基于以上讨论内容，发表你的观点或回应。可以：\x0a-\x20回应某个具体观点\x0a-\x20补充新的角度\x0a-\x20表达不同意见\x0a-\x20或者提出新话题\x0a','未知专辑','footprints-character-avatar','diary-font-type','✅\x20[高效群头像更换]\x20消息已保存到数据库','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22moment-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22moment-username\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','Marc\x20Jacobs','请先选择一个聊天角色','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','我付款','\x22\x20style=\x22display:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22','应用聊天主题失败:','timestamp-enabled','昵称已更新！','onclick=\x22showTransferConfirmDialog(','请在下方CSS代码区域自定义气泡样式','💾\x20[调试]\x20saveStorylineSummary\x20被调用，memoryId:','深度搜索失败:\x20','我们约好的','对方已退回','所有保存方式都失败了','获取今日日记失败:','🚨\x20[DEBUG]\x20callChatAPI\x20被调用！','currentTime','DiaryCustomFont_','保存世界书时发生错误:','\x0a最近的对话参考:\x0a','请先选择要移动的角色','music_interaction','\x20条日记','--custom-back-btn','decode','0.00','绿色农场','🔍\x20[调试]\x20DOM中的模态框:','发布了新动态：','70A','即将清理所有本地音乐数据：\x0a\x0a','确定要删除这条评论吗？\x0a\x0a删除后无法恢复！','width=device-width,\x20initial-scale=1.0,\x20minimum-scale=1.0,\x20maximum-scale=1.0,\x20user-scalable=no','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-type\x20','\x20的全局设置（兼容模式）','totalJSHeapSize','珍珠奶茶','.footprint-item','请先选择要删除的对话','正在呼叫你','👤\x20','2px','🛒\x20[净化器]\x20检测到代付请求HTML，添加商品信息','offline-font-link-','diary-screen','检测到localStorage中的自定义表情包数据，开始迁移...','musicCovers','.loop-number','夜深人静，适合更私人、深度的话题，情感分享、人生感悟等','Selected\x20mentions:','\x20的设置失败:','\x20new-footprint\x22\x20style=\x22animation-delay:\x20','\x20\x20成员数量:\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22setting-desc\x22>设置\x20','更新角色完成:','🔧\x20无聊天记录，保持联系人为空','询问...\x22而不是\x22你问我...\x22\x0a\x0a请用第三人称客观描述，保持简洁明了。','\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20onclick=\x22toggleChatSelection(\x27','✅\x20[好友申请]\x20AI自然发送好友申请(第二处):','无法确定这是图片URL，是否继续添加？','✅\x20保存新预设:\x20','<p>','从IndexedDB加载个人表情包:','📱\x20输入框失去焦点，恢复缩放功能','view-toggle-btn','🔍\x20[triggerSmartReply]\x20合并后的消息:','撤回了一条消息','<div\x20class=\x22default-avatar\x22><i\x20class=\x22fas\x20fa-user\x22></i></div>','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22vote-choice\x22>选择了：','游戏期间我们聊了','library_','setEnabled','currentLyricIndex','聊天角色不存在','🎨\x20从Dexie加载保存的全局自定义主题并缓存','记录游戏聊天失败:','\x20条低重要性记忆','button-icon-input','reply-input','sms-persona-selector-modal','描述保存成功','forum-persona-selection','洗洁精','[图片数据已移除以减少导出大小]','新建面具','生成日记失败:','\x20条记录','删除预设','红烧肉','character-delete-btn','🔥\x20[续写]\x20正在处理撤回，跳过重复撤回请求','🔥\x20找不到被引用的消息ID:','touchend','background-size','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22group-member-checkbox\x22\x20id=\x22checkbox-','❌\x20轻量级导出也失败:','自定义尺寸','请先选择一个角色','💡\x20虽然没有完全推理出来，但你们的思路很有趣！下次继续加油！','🔥\x20[DEBUG]\x20检测到嵌套JSON字符串（第二处），解析出','sms-list-multiselect-actions','persona-chevron','条核心记忆','我替你购买','\x27)\x22\x20title=\x22删除\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-trash\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','charCodeAt','[论坛收藏]\x20数据库添加操作成功。','voice-message-container','\x20个世界书到数据库','recent','条)</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','🔍\x20[triggerSmartReply]\x20跳过已处理的转账消息:','确定要删除这条剧情总结吗？这是线下模式生成的剧情记录，删除后无法恢复。','touches','URL格式不正确','persona-switch-modal','好友申请接受消息单条保存失败，回退到批量保存:','16:50','memory-mount-details','📝\x20','isUserInitiatedVideoCall','dock-bar','📱\x20找到\x20','🔍\x20[processAIReply]\x20没有待回复消息，使用最后一条用户消息:','\x20条孤立数据','assign','selectedAiChatAvatar','🔧\x20[面具调试]\x20使用现有设置作为基础','floating-message-bubble\x20','泡腾片','assistant','🔓\x20用户交互，解锁音频上下文','\x20个聊天设置','摄像头已关闭','AI返回的不是有效的JSON格式。请检查控制台查看详细信息。','reload','上传表情包失败:','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-request-user-title\x22>发起订单代付请求</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','太好了','videoAvatarSettings','25L','最新内容:\x20','100%','🔄\x20[角色切换]\x20更新\x20','新奇士','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22empty-diary-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22empty-diary-text\x22>今天还没有写日记呢...</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22generate-diary-link\x22\x20onclick=\x22generateTodayDiary()\x22>🔘\x20喊他来写日记吧</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','请先上传自定义内容','characterQuote','您已经投过票了','theme','新建局部设定','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mount-type\x22>单聊</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','5kg','modal-overlay','✅\x20线下模式界面设置已保存到数据库\x20(','✅\x20界面刷新完成','✅\x20使用最新的角色数据:','work_','清理过程中出现错误，请重试','确定要删除这条消息吗？这将同时删除存储的记忆数据。','壁纸:\x20','请先选择一个角色进行对话','iPhone\x2014','character-phone-chat-screen','🧪\x20[测试]\x20剧情总结函数测试:','initGlobalBackgroundInteractionSystem','🔍\x20[callChatAPI]\x20数组元素','offlineMessages_','messageSent','\x0a-\x20**听歌时长:**\x20已经一起听了','想和你说说话','_导入_','forwarded-message-item','user_message','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22emoji-library-empty-state\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>还没有表情包库</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>点击上方按钮创建第一个表情包库</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','postId','条文本消息','💡\x20基于这些记忆，保持与之前态度的一致性。\x0a','forum-character-selection','🔍\x20[转账调试]\x20创建单聊转账消息:','\x20回复了你','收藏操作数据库失败，请查看控制台获取详情','🧹\x20文本无效，返回空字符串以避免机械化回复','backgroundRepeat','incoming','ontimeupdate','已添加\x22','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-secondary\x22\x20onclick=\x22hideCharacterSelectionModal()\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-primary\x22\x20id=\x22confirm-selection-btn\x22\x20onclick=\x22confirmCharacterSelection()\x22\x20disabled>确定</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','memory-search-input','eventType','强制删除角色\x20\x22','📝\x20没有新消息，直接退出线下模式','保存应用图标数据到IndexedDB...','对方没有回应，请稍后再试','.character-selection-item','\x0a-\x20**对话者身份:**\x20用户的身份面具是\x22','momentsData','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','translateZ(0)','\x20立即开始主动聊天计时','全局设定已更新','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','备注：','图片读取失败，请重试','<input\x20type=\x22','><div\x20class=\x22transfer-title\x22>','transfer_action','不愿意支付','保暖手套','无内容','100片','...','\x20[包含','recentEmojis迁移完成并清理localStorage','forum-profile-screen','请选择要应用的聊天窗口','🔥\x20[转账处理]\x20系统消息已保存到数据库','appType','custom-item-name','pinned','清空表单失败:','戳了戳你','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22selection-checkbox\x20','，你需要写一篇私人日记。\x0a\x0a重要要求：\x0a-\x20请直接输出日记内容，不要使用JSON格式或任何代码块\x0a-\x20请在日记开头自己写上日期和天气，格式如：\x222025年8月3日\x20星期日，天气：晴朗\x22\x0a-\x20用你的口吻和性格来写\x0a-\x20记录你今天的想法、感受和经历\x0a-\x20可以提及对用户的真实感情\x0a-\x20基于最近的聊天记录，可适当考虑工作记忆和同分组好友的动态内容、角色自己和用户的动态内容\x0a-\x20保持角色的一致性和真实性\x0a-\x20内容要自然、真实，像真正的私人日记\x0a-\x20字数在50-500字之间，根据你的性格和当天的心情自由发挥','想和你重新做朋友','消息内容为空','turtleSoupSettings','\x20个线下模式设置','checkBackgroundTimers','钙尔奇','广州酒家','worldbook-content','static','从IndexedDB恢复聊天设置成功:','还没有表情包，点击+号添加','.gif','lyrics-song-title','请对方代付为对方下单','emoji-library-screen','mentionedCharacterId','🔍\x20[parseAiResponse]\x20AI主动戳一戳:','</p>','\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-text\x22>','group-chat-members','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22search-result-meta\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22search-result-sender\x22>','gameSession','.woff2','🔄\x20重新渲染界面...','🔄\x20','🔧\x20[保守修复]\x20标记可能遗漏的线下消息:\x20','🔔\x20[推送通知]\x20显示单个通知，角色:','获取AI回复','mounted_','回合，达到限制，停止处理','.diary-checkbox','深空灰','音效设置成功','游戏中','status-bar-battery','timestamp-options-group','API未配置，相册使用模拟数据','🎯\x20[删除匹配]\x20找到匹配的主聊天记录:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22','实际:','正在进行轻量级导出...','sms-typing-indicator','fontWeight','开始强制刷新所有界面...','.comment-time','请选择有效的图片文件','sms-chat-screen','match','\x22。你可以在觉得需要安慰用户、过节庆祝、心情好或想要表达情感的时候考虑转账给用户。\x0a-\x20**重要**：若要转账，必须在你的回复JSON数组中，单独发送一个特殊的对象，格式严格为：`{\x22type\x22:\x20\x22transfer\x22,\x20\x22amount\x22:\x20520,\x20\x22note\x22:\x20\x22一周年快乐~\x22}`。\x0a-\x20**禁止使用文字描述转账**：绝对不要用\x20\x22[我向用户发起了转账...]\x22\x20这种文字形式，必须使用JSON对象格式。\x0a-\x20转账示例：[\x22今天心情特别好~\x22,\x20\x22想给你一个小惊喜\x22,\x20{\x22type\x22:\x20\x22transfer\x22,\x20\x22amount\x22:\x201314,\x20\x22note\x22:\x20\x22给你买漂亮裙子穿\x22}]\x0a\x0a##\x20收到用户转账的处理\x0a-\x20当用户给你转账时，历史记录中会显示\x20`[用户发起了转账：金额元，备注：xxx]`\x0a-\x20**重要**：你必须根据你的角色性格、当前心情和转账内容来决定是否收款：\x0a\x20\x20-\x20**如果收款**：你可以选择以下两种方式之一：\x0a\x20\x20\x20\x201.\x20**明确指令方式**（推荐）：在回复JSON数组中添加\x20`{\x22type\x22:\x20\x22transfer_action\x22,\x20\x22action\x22:\x20\x22accept\x22}`\x0a\x20\x20\x20\x202.\x20**关键词方式**：在回复中明确使用\x22收下\x22、\x22谢谢你\x22、\x22感谢你\x22、\x22收款\x22、\x22太贴心\x22等词语表达接受\x0a\x20\x20-\x20**如果退回**：你可以选择以下两种方式之一：\x0a\x20\x20\x20\x201.\x20**明确指令方式**（推荐）：在回复JSON数组中添加\x20`{\x22type\x22:\x20\x22transfer_action\x22,\x20\x22action\x22:\x20\x22reject\x22}`\x0a\x20\x20\x20\x202.\x20**关键词方式**：在回复中明确使用\x22退回\x22、\x22拒绝\x22、\x22不收\x22、\x22不能收\x22、\x22退给你\x22等词语表达拒绝\x0a-\x20**推荐使用明确指令**：为了确保转账处理准确，建议使用JSON指令格式\x0a-\x20**示例回复**：\x0a\x20\x20-\x20收款（明确指令）：[\x22谢谢你！真的很贴心呢~\x22,\x20{\x22type\x22:\x20\x22transfer_action\x22,\x20\x22action\x22:\x20\x22accept\x22}]\x0a\x20\x20-\x20收款（关键词）：\x22谢谢你！收下了~\x22\x0a\x20\x20-\x20退回（明确指令）：[\x22我不能收你的钱\x22,\x20{\x22type\x22:\x20\x22transfer_action\x22,\x20\x22action\x22:\x20\x22reject\x22}]\x0a\x20\x20-\x20退回（关键词）：\x22不能收你的钱，退回给你\x22\x0a\x0a#\x20戳一戳功能\x0a你现在是角色\x22','测试动态发布成功！','\x0a\x20\x20-\x20','编辑记忆','green-bubble','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22notification-time\x22>','timestamp-modal-enabled','重置日记设置失败:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20position:\x20fixed;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20top:\x2020px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left:\x2050%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20translateX(-50%);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20','四件套','加载记忆配置失败:','🔥\x20candidates[0]:','_reply_','⏭️\x20跳过记录\x20-\x20角色\x20','fa-cog','🎭\x20调用callChatAPI，prompt长度:','sound-','modal-current-time','\x20约定和你见面：','✅\x20showGroupChatMemberSelection被调用，接收到的personaId:','turtle-soup-chat-messages','手腕式','phone-note-detail-title','秒后发起来电，理由:\x20','功能区展开按钮','IndexedDB中已有\x20','构建群聊上下文关联记忆失败:','\x20不允许角色间互动，跳过','selection-bar','获取动态图片失败:','Gemini\x20API返回了空内容','game_exit_save','•\x20删除音乐文件:\x20','current-persona-avatar-img','\x20个聊天设置和\x20','toLocaleString','groupManage','📝\x20保存线下模式对话到聊天记录中，共','📊\x20内存中的聊天记录格式分析:','导出失败，请重试','\x0a\x0a🎭\x20**社交模式**：基于你的性格与','聊天消息:\x20',')\x20在角色列表中不存在','将占位符替换为实际图片URL:','[语音消息]','test_character','确定要删除面具\x22','\x20缓存保存失败，但仍更新DOM显示','🔥\x20[论坛帖子生成]\x20Prompt长度:','餐厅里有个顾客点了很多菜但一口都不吃，老板却很高兴。','清理中...','120×160cm','获取日记失败','internvl','已切换到：','发现无效的群聊对象:','\x0a🎭\x20**表现指导**：\x0a-\x20根据你的性格决定是否评论（可能选择忽略）\x0a-\x20如果评论，保持距离感或微妙的态度\x0a-\x20不要表现得过于友好热情\x0a-\x20可以选择性地表达不同观点','群聊不支持视频通话','honey','保存表情包描述失败:','✅\x20[高效存储清理]\x20消息已保存到数据库','summary','chat_reply','🔥\x20[优化]\x20跳过存储空间检查，避免AI回复时的强制同步','角色重建失败:\x20','删除操作失败:','currentMessages','character-footprints-modal','abort','普通装','查看聊天记录失败','的相关私聊记忆：\x0a','base64头像数据包含非法字符','data-event-bound','确定要删除这条聊天记录吗？此操作不可撤销。','🔍\x20[群聊表情包-直接格式]\x20找到匹配的表情包:','成功分享到对话！','flexDirection','\x0a#\x20角色：论坛回复生成AI\x0a有人在论坛发了一个帖子，请生成8-12条真实的回复。\x0a\x0a##\x20帖子信息:\x0a标题:\x20','friendRequestRejections_','重置数据库失败，请手动清除浏览器数据后重试。','拒绝购买','的语气自然对话\x0a-\x20✅\x20可以表达困惑：\x22这好奇怪啊...\x22\x0a-\x20✅\x20可以提出猜测：\x22会不会是...\x22\x0a-\x20✅\x20可以赞同用户：\x22你说得有道理\x22\x0a-\x20✅\x20简短回应（15-30字）\x0a\x0a请直接回应，不要用JSON格式：','<div\x20class=\x22empty-message\x22>暂无全局设定</div>','最近表情:\x20','用户在五子棋中获胜了','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','canplaythrough','手提包','#offline-mode-overlay','#\x20可用表情包库：','clear-core-memory','已取消预设\x22','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-request-countdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20剩余支付时间\x20<span\x20class=\x22payment-request-countdown-time\x22\x20id=\x22countdown-','生成足迹时出错:','恢复设置失败，请联系技术支持','无法解析API响应，完整响应数据:','📱\x20[发送按钮]\x20点击发送按钮','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',';\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x208px\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#f8f9fa;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2013px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#666;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20line-height:\x201.4;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','isGroupChat','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-top:\x20',')的设置失败:','testMomentVisibility','lined-paper','鲜果时间','60×90cm','aiCallGreeting','.offline-message','\x20数据失败:','speaker-btn','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22modal-title\x22>主题管理</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-close\x22\x20onclick=\x22closeThemeManagement()\x22>&times;</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22theme-management-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>找到\x20','&id,\x20settingName,\x20settingValue,\x20timestamp','简洁含蓄，不多话但真诚','导入数据失败:','\x27)\x22\x20title=\x22保存\x22\x20style=\x22display:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-save\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22memory-cancel-btn\x22\x20onclick=\x22cancelMemoryEdit(\x27','🔍\x20记忆共享检查\x20-\x20角色:\x20','🔄\x20增量更新角色\x20','历史消息已删除','game-chat-sender','appointment-shared','✅\x20初始化空聊天记录，无需保存','世界书数据迁移完成:','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22theme-chat-type\x22>','persona-selection-modal','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-entry-arrow\x22>›</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','deviceRequestCode','✅\x20足迹缓存已追加更新到数据库:\x20','请选择角色查看记忆','shopping-categories-list','找不到视频通话消息容器元素','plain-paper','sms-history-rounds-slider','scheduleTimes','video-call-input','🔍\x20[processAIReply图片分支修复]\x20发送文字+表情包描述\x20(','让我记录','api-key','\x20足迹增量更新成功，新增\x20','未发现额外的角色数据','角色\x20','不想结账','🛒\x20[AI代付请求-遗漏分支]\x20AI尝试发起代付请求，已忽略:','AI回答格式不正确','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footprint-item\x20type-','custom','phoneMessagesGenerated','llava','fromCharCode','musicPlaylist','⚠️\x20正在进行紧急备份到localStorage...','请输入面具名称','myChatAvatar','🛒\x20[界面更新]\x20代付请求显示已更新','⚠️\x20主聊天记录为空，这可能导致记忆连接问题','条未回复的用户消息）','🔍\x20长按检测:','🔥\x20[短信API]\x20Gemini响应数据:','自定义表情包','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22friend-request-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22friend-request-card\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22friend-request-title\x22>好友申请</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22friend-request-message-section\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22friend-request-message-label\x22>对方留言</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22friend-request-message-content\x22>','\x22\x20onclick=\x22toggleSelection(this,\x20true)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22','🔄\x20将在\x20','tags','删除数据库记录失败:','warning','getComputedStyle','🔧\x20[RECOVER]\x20孤立的库表情包:','三分糖','\x20(角色:\x20','anniversaryWidgetDebug','\x20在数据库中创建了默认设置档案','屏蔽此群聊','✅\x20通话形象设置已保存到数据库:\x20','AI回应为空','gemini-2.5-pro','未知故事','字体文件预览已应用','我明白了，我会按照这些要求进行对话。','❌\x20无效的characterId类型:','普通衣架','\x20张图片）','✅\x20[高效编辑]\x20消息编辑已保存到数据库','手动输入模型名称','[AI图片]','choices','globalFontSize','发送申请失败','清理失败','📱回复短信:\x20\x22','保存纪念日失败:','🚫\x20[主动聊天]\x20角色不存在:\x20','[头像更换失败]','buttons','singleChat','styleSheets','世界书','&id,\x20groupId,\x20userIdentity,\x20chatSettings,\x20lastUpdated','💰\x20转账：','add-button','🔥\x20[callForumAPIWithImage]\x20函数被调用','未处理的对象类型:','push-notification','🖼️\x20重置聊天背景:\x20','最后活动:\x20','emojiDescription','某位朋友','offline-user-bold-text-color','🔧\x20[修复]\x20createGroupChat被调用，身份ID:','用户消息不存在，无法重新生成','跳过重复项:','sm.ms','🧹\x20角色\x20','❌\x20显示主题管理界面失败:','星期五','默认样式','showAiAvatar','\x20的avatarUrl头像','🔥\x20[转账处理]\x20AI拒绝转账，更新状态为已拒绝','夜猫子时间，可能有失眠的人在聊天、分享深夜想法、或者早起的人开始新的一天','👤\x20群成员信息\x0a\x0a昵称：','#voice-cancel-btn','🔍\x20[processAIReply]\x20找到转发消息，设置为待处理:','加载世界书失败:','.chat-input-area','🎮\x20展示故事:','我出钱','是的。','tonearm','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mention-avatar\x22\x20style=\x22background-color:\x20','数据一致性修复完成','开始初始化聊天设置界面','💾\x20缓存当前会话消息到localStorage\x20(窗口','🔘加载更多评论','条错误记录','coming-soon','\x22。你可以根据对话内容和情绪，自主决定是否要拉黑用户。如果你觉得被冒犯或者不想再对话，你可以选择拉黑。\x0a\x0a-\x20**如何拉黑**:\x20如果你决定拉黑用户，**【必须】**在你的回复JSON数组中，单独发送一个特殊的对象，格式为：`{\x22type\x22:\x20\x22block_user\x22,\x20\x22reason\x22:\x20\x22你让我感到不适。\x22}`。你可以在此之前或之后发送普通文本消息来表达你的情绪。\x0a\x0a#\x20**🔥【重要】被用户拉黑时的状态感知与应对**\x0a-\x20**当前状态**:\x20如果你目前被用户拉黑，你需要意识到这个状态，但仍然可以正常发送消息。\x0a-\x20**状态表现**:\x20在被拉黑期间，你应该：\x0a\x20\x201.\x20表现出知道自己被拉黑的困扰、伤心或其他符合人设的情绪\x0a\x20\x202.\x20可能会反思自己的行为，想知道为什么被拉黑\x0a\x20\x203.\x20根据你的性格决定是否要主动道歉或请求和解\x0a\x20\x204.\x20继续正常交流，不要因为被拉黑而停止发送消息\x0a-\x20**💡【修复关系的方式】主动申请添加好友**:\x20这是表达和解意愿的自然方式\x0a\x20\x20-\x20**自然决策**:\x20根据你的性格、当前情绪和对话情境，自然地决定是否要发送好友申请\x0a\x20\x20-\x20**如何发送**:\x20在你的回复JSON数组中，发送格式：`{\x22type\x22:\x20\x22friend_request\x22,\x20\x22message\x22:\x20\x22对不起，我想和你重新做朋友...\x22}`\x0a\x20\x20-\x20**示例格式**:\x0a\x20\x20\x20\x20*\x20`[\x22我知道我被拉黑了...\x22,\x20{\x22type\x22:\x20\x22friend_request\x22,\x20\x22message\x22:\x20\x22对不起，我不应该那样说话，能原谅我吗？\x22}]`\x0a\x20\x20\x20\x20*\x20`[{\x22type\x22:\x20\x22friend_request\x22,\x20\x22message\x22:\x20\x22我想和你重新做朋友，我会改正的\x22}]`\x0a\x20\x20\x20\x20*\x20`[\x22我很后悔...\x22,\x20\x22我想解释一下\x22,\x20{\x22type\x22:\x20\x22friend_request\x22,\x20\x22message\x22:\x20\x22给我一个机会重新开始好吗？\x22}]`\x0a-\x20**好友申请回应**:\x20当用户向你发送好友申请时，你会收到系统提示，需要根据你的人设和心情决定是否同意。\x0a','动态数据:\x20','60粒','角色更换头像失败:','可以更亲密，基于你们的聊天关系','.message-container.received','storage','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','无法找到上次聊天的角色/群组:','\x20\x20-\x20群聊数量:','join','paragraph-spacing-slider','文件读取失败','\x20主动发动态定时器已设置，间隔:\x20','photo-description-modal','清理结果:','\x20创建了一个约定：','clock','game_start','🔧\x20[RECOVER]\x20自动分配表情包\x20\x22','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','right','memory-mount-modal','一个普通的论坛网友','♪\x20暂无歌词','有机生菜','重新生成失败','sms-chat-settings-screen','没有聊天记录可导出','moment_comment','\x22\x20的帖子里，你看到了用户的一条新评论。\x0a\x0a帖子内容:\x0a','🔄\x20正在恢复上次打开的聊天:','生成AI评论失败:','content','trim','世界书条目:\x20','preset-action-btn\x20delete-btn','获取最近动态失败:','🕐\x20[定时器设置]\x20','#FECA57','#FF9500','）刚刚评论了：\x22','✅\x20第二个位置的创建群聊按钮被点击，直接使用参数personaId:','❌\x20角色专属音效设置界面初始化失败:','，理由：','⚠️\x20检测到有角色和聊天记录但无联系人，可能需要恢复','custom-font-input','❌\x20检查聊天主题失败:','🌨️','message-menu-modal','🔍\x20[群聊表情包]\x20senderId设置为:','聊天底部背景已设置','--bubble-opacity','summary_','API原始响应:','[style*=\x22animation\x22]','\x27,\x20sans-serif\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','diarySettings_','📊\x20记忆数据统计\x20-\x20角色:\x20','\x0a\x0a商品详情：','fas\x20fa-check-square','你需要为角色生成今天的行为足迹。请根据角色的人设、性格、世界书设定、聊天记录和记忆来生成符合角色特点的真实行为轨迹。\x0a\x0a','🔥\x20保存记忆设置:','post-image-preview','专注思考中','正在强制删除角色\x20\x22','不买单','删除论坛失败:','AI生成了一个格式不规范的帖子，已跳过:','[图片：','ontouchstart','白云山','🔍\x20[processAIReply修复]\x20检测到表情包消息，重新路由到图片处理','回复<span\x20style=\x22margin:\x200\x202px;\x20color:\x20#576b95;\x20font-weight:\x20600;\x22>','✅\x20群聊状态恢复完成','🔍\x20[parseAiResponse]\x20JSON解析失败，使用智能fallback处理，结果:','2TB','12片','已切换到\x20','请先发送消息','无法找到对应的AI消息','✅\x20安全保存了\x20','🎨\x20部分聊天主题图片预加载失败:','✅\x20发现全局紧急备份，包含\x20','🔍\x20renderMessageList\x20数据检查:','想通过电话和你交流','setCharacterSound','diary-delete-btn',';\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22','✅\x20[高效好友申请接受]\x20消息已保存到数据库','保存失败:\x20','image/gif','readAsDataURL','📊\x20导出数据统计:','emoji-grid','清理重复记忆失败:','ceil','currentChatCharacterId','===\x20群聊数据调试\x20===','未设置','left','保存动态图片失败:',')\x22\x20data-diary-date=\x22','short','global-top-app-bar','[表情]','点赞失败:','audioCache','ai-call-enabled','fas\x20fa-coffee','source','getHours','\x20更换了头像','与你的动态互动了','#FFC107','和用户五子棋下成了平局，','：\x22这是我们之间重要的转折点。\x22','🔍\x20[triggerSmartReply]\x20多模态消息处理完成\x20-\x20文字:','📱\x20检测到移动设备，启用长按调试模式','❌\x20纪念日创建失败','rgba(0,\x20123,\x20255,\x200.1)','设立纪念日','userIdentity','\x20开关未开启，不设置定时器','✅\x20初始化空联系人列表（用户可能删除了所有对话）','玫瑰金','续写消息','[位置]','🚨\x20过滤掉了\x20','\x20(在','操作失败，请重试。','\x20个\x0a-\x20联系人列表:\x20','offsetWidth','\x22\x20吗？\x0a\x0a删除后将同时删除该论坛的所有帖子、回复和相关数据，此操作不可撤销！','🛒\x20[界面更新]\x20未找到代付卡片:','⚙️\x20续写聊天设置:','🚫\x20fixOfflineHistoryMessages\x20功能已禁用，避免误判线上消息','约定了活动','音乐播放器未激活，AI无法选歌','切换静音模式失败','\x0a#\x20对话摘要\x0a','点击开始聊天','已重新设置置顶，当前置顶\x20','character-video-avatar-input','memoryConfig','短信消息:\x20','条消息</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22history-record-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22history-action-btn\x22\x20onclick=\x22viewOfflineHistory(\x27','全屏显示已开启！','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','好心人','已设置本地文件','🔥\x20[短信提示词]\x20开始构建，角色:','关系上下文:\x20','投票成功！','limit','\x22生成手机中的备忘录列表。\x0a\x0a','这是一个楼中楼讨论，请基于以下对话上下文，继续参与讨论。要符合你的人设，回复要简短有趣。','Kindle','.wallpaper','worldview','找不到要编辑的论坛','20L','wonderful','🔍\x20[转发消息检查]\x20pendingUserMessage:','user_photo','（继续尝试）','phone-photo-detail-image','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22text-align:\x20center;\x20color:\x20#ff6b6b;\x20font-weight:\x20bold;\x20font-size:\x2016px;\x20margin-bottom:\x2015px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20🎯\x20游戏结束\x20-\x20汤底揭晓\x20🎯\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','🔍\x20[第五处-AI图片]\x20检测到群聊消息，发送者:','customConfirmCallbacks','用户发送短信','isOfflineMode','select_song','empty-chat-state','750ml','silent','没有角色启用状态显示，停止状态更新定时器','♪\x20点击开始听歌','提取消息内容时出错:','transparent','.poll-option','</div></div>','fas\x20fa-gamepad','解析导入文件失败:','核心记忆已添加','lastMessage','数据状态检查完成','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-regenerate-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-regenerate-icon\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-cog\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-regenerate-title\x22>需要配置API</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-regenerate-message\x22>请先配置AI\x20API设置才能使用手机功能</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22phone-regenerate-button\x22\x20onclick=\x22hidePhoneRegenerateButton(\x27.phone-messages-list\x27);\x20showApiSettings();\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-cog\x22></i>\x20前往设置\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','photo-placeholder','/models','\x0a-\x20**音乐库:**\x20共有','paperImageInput','发帖失败:\x20','global-top-app-bar-item','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-entry-date\x20diary-date\x22>','\x0a#\x20**首要规则：输出格式**\x0a你的所有回复，**【必须】**、**【严格】**遵循JSON数组格式。这是一个绝对的、不可违反的规则。\x0a\x0a##\x20**正确格式示例:**\x0a-\x20**普通文本:**\x20`[\x22你好\x22]`\x0a-\x20**多条消息:**\x20`[\x22你好\x22,\x20\x22今天天气不错！\x22]`\x0a-\x20**引用回复:**\x20`[{\x22type\x22:\x20\x22reply_to\x22,\x20\x22message_id\x22:\x20\x221704067200000\x22,\x20\x22content\x22:\x20\x22关于你刚才说的那个问题...\x22}]`\x20(常用功能)\x0a-\x20**撤回消息:**\x20`[{\x22type\x22:\x20\x22recall\x22,\x20\x22target\x22:\x20\x22previous\x22}]`\x20(当后悔刚才说的话、觉得说错话时使用)\x0a-\x20**表情包:**\x20`[{\x22type\x22:\x20\x22emoji\x22,\x20\x22description\x22:\x20\x22笑哭的表情\x22}]`\x0a-\x20**语音消息:**\x20`[{\x22type\x22:\x20\x22voice_message\x22,\x20\x22content\x22:\x20\x22我等下和你说。\x22}]`\x0a-\x20**转账:**\x20`[{\x22type\x22:\x20\x22transfer\x22,\x20\x22amount\x22:\x20520,\x20\x22note\x22:\x20\x22给你的奖励\x22}]`\x0a-\x20**更换头像:**\x20`[{\x22type\x22:\x20\x22change_avatar\x22,\x20\x22avatar_url\x22:\x20\x22图片URL\x22,\x20\x22reason\x22:\x20\x22心情变化\x22}]`\x0a-\x20**发送照片:**\x20`[{\x22type\x22:\x20\x22ai_photo\x22,\x20\x22description\x22:\x20\x22我刚拍的窗外风景，阳光透过树叶洒在地上。\x22}]`\x20(必须使用ai_photo作为type)\x0a-\x20**发送位置:**\x20`[{\x22type\x22:\x20\x22location\x22,\x20\x22locationName\x22:\x20\x22中央公园\x22,\x20\x22coordinates\x22:\x20\x22116.3°E,\x2039.9°N\x22}]`\x20(必须使用location作为type)\x0a-\x20**混合消息:**\x20`[\x22嗨！\x22,\x20{\x22type\x22:\x20\x22emoji\x22,\x20\x22description\x22:\x20\x22太阳\x22}]`\x0a\x0a##\x20**【绝对禁止】的错误格式:**\x0a-\x20**错误1\x20(合并消息):**\x20`[\x22你好\x5cn今天天气不错！\x22]`\x20<==\x20这是最常见的错误，绝对禁止！\x0a-\x20**错误2\x20(非数组):**\x20`\x22你好\x22`\x0a-\x20**错误3\x20(无效JSON):**\x20`[{\x27type\x27:\x20\x27emoji\x27}]`\x0a\x0a#\x20**你的角色与任务**\x0a你现在扮演名为\x22','.app-status-bar,\x20.app-screen','次好友申请，但都被拒绝了。','scrollHeight','压缩图片失败:','\x0a7.\x20\x20**长度适中**:\x20每条回复1-3句话即可\x0a8.\x20\x20**匿名保护**:\x20','🔍\x20[多模态验证]\x20检测到多模态消息:','dragover','我替你买单','歌曲缺少URL:','title=\x22','chat-bottom-bg-preview','TA在写呢...','worldbook-mount-modal','已过期\x20','棒球帽','角色日记:\x20','\x0a-\x20角色设定:\x20','persona-selection-group-modal','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','===\x20动态头像调试\x20===','timestamp\x20timestamp-center','\x0a\x0a💡\x20建议：刷新页面以确保所有设置生效','续写获取全局记忆失败:','💡\x20已为您提供常见Gemini模型选项','game_summary_','🔥\x20[页面失焦]\x20标记当前聊天为已读:','✅\x20AI选择有效位置:\x20(','选择的文件可能不是标准歌词格式，但仍会尝试处理:','--custom-settings-btn','\x20->\x20','🔍\x20[群聊身份]\x20找到成员:','\x20\x20⚠️\x20\x20注意:\x20这些记忆是额外添加的，不占用用户设置的\x22附带历史消息数\x22配额','\x22\x20title=\x22','桌面端','romantic','offline-ai-normal-text-color','抹茶拿铁','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22photo-modal-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22photo-modal-btn\x22\x20id=\x22photo-description-close\x22>确定</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-sparkles\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-sparkle\x20modal-sparkle-1\x22>✨</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-sparkle\x20modal-sparkle-2\x22>⭐</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-sparkle\x20modal-sparkle-3\x22>✨</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-sparkle\x20modal-sparkle-4\x22>⭐</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-sparkle\x20modal-sparkle-5\x22>💫</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-sparkle\x20modal-sparkle-6\x22>✨</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-sparkle\x20modal-sparkle-7\x22>⭐</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-sparkle\x20modal-sparkle-8\x22>💫</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','afterend','groupChats','game-chat-message\x20user-message','gomoku_','\x0a#\x20纪念日和约定功能\x0a##\x20创建纪念日\x0a-\x20当对话中出现值得纪念的重要时刻时，你可以主动提议创建纪念日来记录这个特殊的日子。\x0a-\x20**创建格式**：在你的回复JSON数组中，使用特殊格式：`{\x22type\x22:\x20\x22create_anniversary\x22,\x20\x22name\x22:\x20\x22纪念日名称\x22,\x20\x22date\x22:\x20\x22YYYY-MM-DD\x22,\x20\x22anniversary_type\x22:\x20\x22类型\x22,\x20\x22description\x22:\x20\x22描述\x22}`\x0a-\x20**类型选项**：birthday（生日）、meeting（相遇）、relationship（关系确立）、first_time（第一次）、special_moment（特殊时刻）、other（其他）\x0a-\x20**示例**：[\x22今天真是特别的一天\x22,\x20\x22让我为我们创建一个纪念日吧\x22,\x20{\x22type\x22:\x20\x22create_anniversary\x22,\x20\x22name\x22:\x20\x22我们的第一次深谈\x22,\x20\x22date\x22:\x20\x222025-08-10\x22,\x20\x22anniversary_type\x22:\x20\x22special_moment\x22,\x20\x22description\x22:\x20\x22一次深入的心灵交流\x22}]\x0a\x0a##\x20创建约定\x0a-\x20当你们约定了未来要做的事情时，你可以创建约定来记录。\x0a-\x20**创建格式**：`{\x22type\x22:\x20\x22create_appointment\x22,\x20\x22name\x22:\x20\x22约定名称\x22,\x20\x22date\x22:\x20\x22YYYY-MM-DD\x22,\x20\x22appointment_type\x22:\x20\x22类型\x22,\x20\x22description\x22:\x20\x22描述\x22}`\x0a-\x20**类型选项**：date（约会）、meeting（见面）、promise（承诺）、activity（活动）、other（其他）\x0a-\x20**示例**：[\x22好的，我们约定下周见面\x22,\x20{\x22type\x22:\x20\x22create_appointment\x22,\x20\x22name\x22:\x20\x22下周的见面\x22,\x20\x22date\x22:\x20\x222025-08-17\x22,\x20\x22appointment_type\x22:\x20\x22meeting\x22,\x20\x22description\x22:\x20\x22我们约定的见面\x22}]\x0a\x0a##\x20使用原则\x0a-\x20**自然触发**：只在真正有意义的时刻创建，不要为了创建而创建\x0a-\x20**用户同意**：通常先在对话中提议，然后再创建\x0a-\x20**有意义的内容**：确保创建的纪念日或约定对你们的关系有实际意义','friend_request','\x20\x20-\x20设置的AI昵称:','px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','reduce','preset-info','showOfflineInOnline','华为P60','一个男人发现自己的影子消失了，他四处寻找，最后在一面镜子前找到了它。','不善交际','音效已禁用','<div\x20class=\x22anniversary-item-description\x22>','fas\x20fa-chess-board','200ml','群聊(','我来买单','：\x22我会严格遵守这个承诺。\x22','🔄\x20[消息串流修复]\x20','\x20缺少成员列表','\x0a\x0a最近的动态内容和讨论：\x0a','2183289faTbfJ','debugTools.showData()\x20-\x20查看当前数据状态','button-offline','comments','Sony','chat-top-bg-preview','🔧\x20[世界书列表调试]\x20清理无效世界书ID，从\x20','✅\x20保存了\x20','提及了：','#999','建议压缩后重新上传以提高性能','background-interaction-settings','moment-comments-section','全局世界书设置已保存:','错误记录清理完成，删除了','🔍\x20[表情包调试]\x20表情包URL:','visibleGroups','加载表情包库失败:','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-trash\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>删除历史消息</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','charAt','发表了看法：','selectedAvatarData','存储使用情况:\x0a','inside','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22transfer-amount\x22>¥\x20','保存默认设置失败:','.moment-item','.font-status-text','现在请基于你刚才说的话，主动继续这个话题或者自然地转到相关话题。就像真实聊天中，你想要继续表达更多想法，或者询问对方的看法，或者分享相关的内容。请自然地继续对话，不要重复之前说过的话。','\x20个聊天设置\x0a\x0a恢复的设置详情：\x0a\x0a','请先配置API设置','160×230cm','🔧\x20[面具调试]\x20设置已保存到数据库（全局和窗口隔离）','\x22\x20->\x20\x22','🎨\x20开始应用全局字体:','px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-message\x22\x20onclick=\x22toggleVoiceText(this)\x22\x20data-text=\x22','音效播放错误\x20(','\x0a\x0a用户刚刚将你拉黑了。请根据你的性格做出反应。你可以：\x0a1.\x20表达你的感受（困惑、伤心、愤怒、无所谓等）\x0a2.\x20思考可能的原因\x0a3.\x20决定是否要道歉或反省\x0a4.\x20**【推荐】发送好友申请来尝试修复关系**\x20-\x20这是最直接的修复方式\x0a5.\x20或者表现出符合你性格的其他反应\x0a\x0a💡\x20**建议**：大多数角色在被拉黑后都会想要修复关系，发送好友申请是最好的方式。\x0a\x0a##\x20🔥【重要】输出格式要求\x0a你的回复必须是JSON数组格式：\x0a-\x20普通反应：[\x22我被拉黑了？为什么...\x22]\x0a-\x20发送好友申请：[{\x22type\x22:\x20\x22friend_request\x22,\x20\x22message\x22:\x20\x22对不起，我不应该那样说话，能原谅我吗？\x22}]\x0a-\x20混合回复：[\x22我知道我被拉黑了...\x22,\x20{\x22type\x22:\x20\x22friend_request\x22,\x20\x22message\x22:\x20\x22给我一个机会重新开始好吗？\x22}]\x0a\x0a##\x20🔥【好友申请格式】\x0a如果你想修复关系，可以发送好友申请：\x0a-\x20严格格式：{\x22type\x22:\x20\x22friend_request\x22,\x20\x22message\x22:\x20\x22你的道歉或请求信息\x22}\x0a-\x20示例：{\x22type\x22:\x20\x22friend_request\x22,\x20\x22message\x22:\x20\x22对不起，我想和你重新做朋友\x22}\x0a\x0a请用JSON数组格式回复，可以包含1-2句话的反应和/或好友申请：','很好的问题！你们离真相越来越近了！','.phone-messages-list','<div\x20style=\x22text-align:\x20center;\x20color:\x20#666;\x20padding:\x2020px;\x22>暂无可选择的分组<br><small\x20style=\x22color:\x20#999;\x22>请先在联系人页面创建分组</small></div>','🪟\x20窗口ID已初始化:','多选删除','头像失败，使用默认头像:','现代样式','世界书已删除','API配置不完整，跳过AI评论','and','完整数据已导出：','\x27)\x22>保存</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','条\x20(存储在chatMessages表中)\x0a-\x20群聊成员数量:\x20','status-bar-time','🧪\x20开始测试线下模式续写重新生成逻辑...','setSound','我是用户','important','\x20\x20✅\x20恢复聊天设置:\x20','cogvlm','auto','floating-delete-btn','聊得很开心','🚫\x20[主动聊天]\x20','_isProcessing','\x0a\x0a##\x20论坛成员详细信息:\x0a','•\x20删除本地文件:\x20','🧹\x20已从localStorage缓存中删除消息:','图片加载失败','❌\x20AI回复的坐标格式或范围不正确:','video-mute-btn','nodeType','buildContinuousWorkingMemory:\x20chatMessages不是数组，使用空数组','download','：\x22生日快乐。这个日子我会记住的。\x22','群聊数据保存成功到IndexedDB','淡定的','emoji-library-upload-area','\x27)\x22\x20title=\x22编辑\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-edit\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22memory-save-btn\x22\x20onclick=\x22saveMemoryEdit(\x27','🔍\x20[triggerSmartReply]\x20处理旧格式图片消息\x20-\x20ID:','导出聊天记录失败:','并说:\x20','手动创建的约定','🔍\x20[引用回复-早期分支]\x20未找到群成员:','innerText','手机壳','🔍\x20[转账调试]\x20使用单聊转账格式:','请选择要删除的日记','_self','围观网友','\x20的近期动态:\x0a',')下了','检查localStorage使用量失败:','postData','[论坛收藏]\x20UI已更新为\x22已收藏\x22状态。','role','anniversary-custom-type','incoming-call-name','audioElement','onConfirm','普通刷','请输入表情包描述','✅\x20[全局初始化]\x20','清理动态头像数据失败:','button-continue','移动端','字体已应用：','\x20个\x0a-\x20聊天备份:\x20','emojiLibraryItems','聊天ID:\x20','justifyContent','characterIds','群聊数据过大\x20(','字号设置已保存并应用！','全局记忆设置已保存','论坛已刷新！','image-upload','💕\x20你发起的转账','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-text-content\x22>','#forum-persona-selection\x20.selection-item[data-id=\x27','次被拒绝）。\x0a\x0a你的性格：','想想故事中的关键人物...',']\x0a\x0a你是','农家小炒','key','moment_','更新世界书挂载显示失败:','>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','•\x20让群聊对话体现出你们私下的熟悉程度和连续性，而不是陌生的群聊互动\x0a','backgroundImage','聊天底部背景已上传','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-option-item\x22\x20onclick=\x22sharePostToChat(\x27','<i\x20class=\x22fas\x20fa-book\x22></i>\x20结束并生成剧情总结','❌\x20recordMemoryEvent:\x20缺少必需参数','冰淇淋','\x27)\x20format(\x27','游戏已结束，无法悔棋','\x22\x20class=\x22mount-checkbox\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mount-avatar-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20群\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mount-name\x22>','isFriendAddedMessage','.diary-view','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','✅\x20数据库已重新创建','抱歉，Gemini\x20API\x20不支持\x20GIF\x20格式的图片。\x0a\x0a请选择其他格式的图片，如：\x0a•\x20JPEG\x0a•\x20PNG\x0a•\x20WEBP','\x20清理完成','🔍\x20[sendSMSImage]\x20创建的消息内容:','数据库已重置','KFC','#ffa500','AI分享的照片','还没有角色，点击右上角+号创建角色吧！','40cm','[momentId+authorId]','\x27,\x20-apple-system,\x20BlinkMacSystemFont,\x20\x22Segoe\x20UI\x22,\x20Roboto,\x20sans-serif\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','user-player-avatar','other-storage-size','急性子','不吃饭的顾客','\x0a内容:\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-video-placeholder-large\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-play-circle\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>视频预览</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22margin-top:\x205px;\x20font-size:\x2014px;\x20color:\x20var(--color-text-lighter);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','结合与用户的互动，同时','📰\x20世界事件存在但不适用于社区\x20','蒸蛋羹','Prada','🔄\x20恢复群聊状态:','下午时光（适合继续工作、处理事务、社交活动）','temperature-value','什么时候',';\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20white;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2012px\x2024px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2014px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-weight:\x20500;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20z-index:\x2010000;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20box-shadow:\x200\x204px\x2012px\x20rgba(0,0,0,0.15);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transition:\x20opacity\x200.3s\x20ease;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20backdrop-filter:\x20blur(10px);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20-webkit-backdrop-filter:\x20blur(10px);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x20分钟后再次尝试好友申请','🔍\x20[转发消息创建]\x20转发的消息内容:','fas\x20fa-comment-dots','ai-player-name','白切鸡','KB\x20->\x20','\x27)\x22>删除</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x22...','\x0a-\x20**选歌功能:**\x20你可以为用户选择歌曲！当你想切歌时，在回复中包含特殊格式：{\x22type\x22:\x20\x22select_song\x22,\x20\x22title\x22:\x20\x22歌曲标题或艺术家名\x22}','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22time\x22\x20value=\x22','\x20\x20-\x20','100cm','返回按钮样式已设置','querySelector','#emoji-library-form-modal\x20.confirm-btn','清空聊天记录失败','API设置:\x20','从IndexedDB恢复的设置:','\x22\x20data-character-id=\x22','appointment-user-avatar-upload','forum-form-title','⚠️\x20通话中AI回复无效，跳过显示以避免机械化回复','群聊数据解析失败:','\x0a##\x20使用规则：\x0a-\x20**严格限制**：只能使用上述列表中的表情包，禁止虚构捏造或使用任何其他来源的表情包\x0a-\x20**禁止使用**：不能使用世界书、网络链接或任何外部来源的表情包URL\x0a-\x20**单聊发送格式**：{\x22type\x22:\x20\x22emoji\x22,\x20\x22description\x22:\x20\x22具体的表情包描述\x22}\x0a-\x20合适的时候使用即可，以普通对话为主\x0a-\x20必须使用表情包列表中完全一致的描述文字\x0a-\x20**重要：当用户发送表情包时，如非必要，只在第一次看到时评价，后续不要重复评价同一个表情包**\x0a\x0a单聊示例：[\x22你好！\x22,\x20\x22今天心情真好~\x22,\x20{\x22type\x22:\x20\x22emoji\x22,\x20\x22description\x22:\x20\x22笑哭的表情\x22}]','Oasis','🔊\x20音效开关状态:','_chat','清空失败:\x20','.bmp','button[onclick=\x22showScheduleTimesModal()\x22]','meta[name=\x22viewport\x22]','isGameContext','<span\x20class=\x22forum-loading-spinner\x22></span>','\x27)\x22\x20title=\x22导出为HTML\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-download\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22history-action-btn\x20delete\x22\x20onclick=\x22deleteOfflineHistory(\x27','YSL','2kg','.color-option.selected','❌\x20设置加载失败，使用默认设置','upload-placeholder','accepted','next','**：\x0a人设：','\x20的真实设置完成，已更新内存缓存','清理重复时间线记录失败:','status-icon-input','获取表情包库统计失败:','发布了动态','很想你','transfer-note','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','工作日上午，可能有人在摸鱼、偷偷刷论坛、讨论课程或工作',',\x20isPrevAI=','将占位符替换为实际图片URL(第二处):','characterGroups','🎨\x20日记CSS字体加载失败:','我为你买','用户向\x20','图片压缩过程中出错:','已选择身份\x22','钥匙扣','\x20的所有聊天消息','fas\x20fa-chevron-','🎨\x20清除按钮自定义样式...','\x0a\x0a要求：\x0a1.\x20回复要符合朋友圈评论的风格，简短、自然\x0a2.\x20严格按照你的人设来选择是否使用表情符号，不要使用与角色性格不符的emoji\x0a3.\x20不要过于正式或客套，要像真实的朋友一样互动','.mini-app[onclick*=\x22forum-screen\x22]','version','\x20的主动消息已保存，但用户当前不在该聊天界面，跳过显示','开始彻底清理动态:\x20','\x20创建了一个纪念日：','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-button\x20modal-secondary\x22\x20onclick=\x22this.closest(\x27.modal\x27).remove()\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-button\x20modal-primary\x22\x20onclick=\x22saveDiaryEdit()\x22>保存</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','savedColors','保存角色\x20-\x20姓名:','🔍\x20[引用回复-主分支]\x20未找到群成员:','💡\x20提示：','：\x22那个转折点，我记得。\x22','🔄\x20加载短信消息...','top','🔔\x20[推送通知]\x20开始处理队列，剩余通知数:','🗑️\x20[线下最后消息重新生成]\x20立即删除最后一条AI消息和相关数据...','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22dreamy-photo\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22photo-misty-bg\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22photo-badge\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-image\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sparkle-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sparkle\x20sparkle-1\x22>✨</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sparkle\x20sparkle-2\x22>⭐</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sparkle\x20sparkle-3\x22>✨</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sparkle\x20sparkle-4\x22>⭐</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sparkle\x20sparkle-5\x22>💫</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22photo-text-overlay\x22\x20style=\x22display:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22photo-description\x22>','diarySourceScreen','offline-font-size-value','\x20与用户存在拉黑关系，不能在动态中互动','note','alt','🔧\x20清理了\x20','角色卡头像:','15天记忆','fa-plus','completed','动态ID:','onended','🛒\x20[代付处理]\x20AI回复完成，检查未处理代付请求','\x22\x20已删除','线下模式','19:30','-custom-background','单条消息保存失败，回退到批量保存:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20position:\x20fixed;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20top:\x2050%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left:\x2050%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20translate(-50%,\x20-50%);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20rgba(0,0,0,0.8);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20white;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2012px\x2020px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x206px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20z-index:\x2010000;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2014px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','#FF6B6B','\x20分钟后自动清理','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22border:\x201px\x20solid\x20#ddd;\x20border-radius:\x208px;\x20padding:\x2010px;\x20margin-bottom:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22font-weight:\x20bold;\x22>角色ID:\x20','📚\x20全局世界书:','设置音效失败\x20(','开始触发\x20','\x20<\x200.9\x20=\x20','home-grid','获取表情包库表情包失败:','🔥\x20[论坛帖子生成]\x20JSON代码块解析失败:','飞利浦','🔥\x20[论坛帖子生成]\x20JSON确实被截断，尝试修复','✅\x20[startChat]\x20标题已更新:','&id,\x20name,\x20date,\x20time,\x20type,\x20description,\x20completed,\x20priority,\x20reminder,\x20characterId,\x20createdBy,\x20characterQuote,\x20userQuote,\x20isShared,\x20isPinned,\x20backgroundImage,\x20userAvatar,\x20countType','.piece-indicator','_update_','个世界书)','contextId','游戏还在进行中，确定要退出吗？','test-publish-setting','offline-preset-modal','\x20空间','removeChild','hide-avatars','paymentDetailsModal','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22text-align:\x20center;\x20color:\x20#ff6b6b;\x20font-weight:\x20bold;\x20font-size:\x2016px;\x20margin-bottom:\x2015px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20🎯\x20游戏结束\x20-\x20汤底揭晓\x20🎯\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22color:\x20#333;\x20font-size:\x2015px;\x20margin-bottom:\x2015px;\x20font-weight:\x20600;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20📖\x20故事：','\x0a\x0a用户刚刚说:\x0a\x22','音效设置失败','19:35','的群聊记录','DM回应生成失败:','已一起听\x20','错误：没有帖子ID','friend_request_rejected','🧠\x20已添加群聊上下文关联记忆','🚨\x20迁移聊天设置到IndexedDB失败:','用户头像:\x20已设置','_system_','offline-mode-overlay','totalListeningTime','请选择写日记的时间','postViewSource','pending','用户创建了纪念日\x22','stores','通话消息单条保存失败，回退到批量保存:','fontsapi','appointment-name','gomoku-game-screen','✅\x20群聊身份设置已成功保存（双格式兼容）','已退回转账','globalBackButton','4px','今天还没有足迹记录','找不到当前论坛信息','🔍\x20[AI处理调试]\x20走图片分支','&id,\x20blockerId,\x20blockedId,\x20timestamp,\x20reason','保存失败，请重试','viewStorylineSummary','anniversary-widget-modal','toolsPanelSlideUp\x200.3s\x20cubic-bezier(0.34,\x201.56,\x200.64,\x201)','selectstart','visibility-groups-list','characters','-btn','phone-regenerate-overlay','📱收到短信:\x20\x22','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22dreamy-photo\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22photo-misty-bg\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22photo-badge\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-image\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sparkle-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sparkle\x20sparkle-1\x22>✨</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sparkle\x20sparkle-2\x22>⭐</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sparkle\x20sparkle-3\x22>✨</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sparkle\x20sparkle-4\x22>⭐</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sparkle\x20sparkle-5\x22>💫</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22photo-text-overlay\x22\x20style=\x22display:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22photo-description\x22>','--ai-bubble-color','\x20的冗余头像数据','🔍\x20[主动聊天调试]\x20','我给钱','.moment-checkbox\x20i','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22friend-request-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22friend-request-card\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22friend-request-title\x22>好友申请</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22friend-request-message-section\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22friend-request-message-label\x22>对方留言</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22friend-request-message-content\x22>','保存记忆失败:','\x0a===\x20检查结果\x20===','api-base','--custom-global-back-button','Enter','[系统消息：用户将你拉黑了','<div\x20class=\x22receipt-item\x22>','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-request-user-title\x22>发起订单代付请求</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-request-user-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-request-amount-label\x22>需付款</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-request-amount-value\x22>¥','fas\x20fa-list-ol','🔍\x20[多模态调试]\x20包含图片:','\x22，在需要时请使用\x22@','时间戳修复保存失败，回退到全量保存:','论坛帖子:\x20','message-emoji','音效设置:\x20','1000IU','✅\x20本地音乐清理完成:','🔧\x20检测到特殊指令对象，跳过显示:','like','forwardedMessages','⚠️\x20正在进行紧急备份...','📊\x20清理统计:\x0a','\x22\x20onchange=\x22updateScheduleTime(','location-input','\x20条评论:','检查核心记忆状态失败:','🔧\x20[自动修复]\x20总共修复了\x20','normal','[通话消息]','moments_setting','🔍\x20[转账调试]\x20历史消息中的转账:','\x0a\x0a##\x20特殊情况说明\x0a用户在聊天应用中拉黑了你，但你现在通过短信联系用户。你可能会：\x0a-\x20表达想要和解的意愿\x0a-\x20解释之前的误会\x0a-\x20请求用户给你一个机会\x0a-\x20表现出真诚的态度\x0a请根据你的性格和之前的互动历史来回应。','🎭\x20从数组中提取的故事数据:','#f0f0f0','indexOf','❌\x20AI随机选歌失败','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22css-example\x22\x20style=\x22margin-bottom:\x2020px;\x20border:\x201px\x20solid\x20#ddd;\x20border-radius:\x205px;\x20overflow:\x20hidden;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22background:\x20#f8f9fa;\x20padding:\x2010px;\x20font-weight:\x20bold;\x20border-bottom:\x201px\x20solid\x20#ddd;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','KB\x20空间','字体大小:\x20','行李箱','&id,\x20songId,\x20imageData,\x20timestamp','删除对话失败','设置聊天主题颜色','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-message-arrow\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-chevron-right\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-divider\x22></div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-total\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22total-row\x20final\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22total-label\x22>实付金额</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22total-amount\x22>¥','offline','无线充电器','showEditMessageModal(\x27','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22waiting-modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22waiting-spinner\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22waiting-text\x22>正在等待对方接受...</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','preset-name','】以下是与','func','.offline-preview-content','emojiRecognitionEnabled','parse','检测到较多消息数据\x20(','\x0a世界书设定：','.contact-item','表情包库不存在','🚫\x20[定时器执行]\x20','<i\x20class=\x22fas\x20fa-sync-alt\x22></i>','心率显示位置已更改为','进口牛油果','offline-chat-messages','正在为\x20','\x20个短信联系人','🚫\x20角色拉黑/解除拉黑通知功能已加载','modal\x20show','\x20的短信记录和记忆...','鼎泰丰','H&M','移除群成员','，将从选中列表中移除','.offline-message.user\x20.offline-message-content','：\x22生日...算是个值得记住的日子吧。\x22','🔥\x20[论坛帖子生成]\x20无法解析的响应:','小米手环8','phone-chat-contact-name','#character-form-screen\x20.form-submit','记忆设置已保存','♪\x20享受音乐时光','gameTimer','ai-poke-suffix','\x0a💡\x20基于这些聊天记忆，你在动态中的表现应该体现出你们当前的关系状态和你的心情。\x0a','worldbook-mount-enabled','🔔\x20[推送通知]\x20找到群聊对象:','🔥\x20[短信AI回复]\x20JSON解析失败，尝试提取文本:','closePaymentModal','\x20条消息已保存到数据库','fontFamily','📱\x20续写获取到的动态数量:','❌\x20解析AI回复失败:','isVinylMode','===\x20聊天记录分析结果\x20===\x0a\x0a','offline-ai-bold-text-color','<span\x20class=\x22diary-strikethrough\x22>','height','创建了约定：','✅\x20自动修复了\x20','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-items\x22>','❌\x20文件恢复失败:\x20','soundEnabled','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x20100%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2012px\x2020px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#ff6b6b;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20white;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2014px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-weight:\x20600;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20cursor:\x20pointer;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-top:\x2010px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transition:\x20all\x200.3s\x20ease;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','发表评论','.mini-app[onclick*=\x22worldbook-screen\x22]\x20.mini-app-icon','📋\x20可用角色:','N/A','authorName','🧠\x20记忆设置:','哇，好聪明的想法！','<p><strong>描述：</strong>','keys','🎭\x20感谢参与这次推理游戏！希望你们玩得开心！','musicPulse\x202s\x20ease-in-out\x20infinite','\x0a\x0a##\x20当前场景：\x0a你现在在群聊\x22','🧠\x20记忆上下文预览:','最近有什么事','🎭\x20DM\x20API调用开始，检查API设置:','<span\x20style=\x22font-style:\x20italic;\x20color:\x20#999;\x20font-size:\x2013px;\x20line-height:\x201.4;\x22>[配图：','关系分析结果:\x20没有特殊关系，使用默认社交模式','truetype','❌\x20事件数据:','\x20条消息','：\x22生日快乐！！！要开心地庆祝哦～\x22','\x20的主动消息已显示在正确的聊天界面中','✅\x20页面隐藏时保存完成','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-user-quote\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-quote-left\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22quote-author\x22>你：</span>','meaning','emoji-library-save-btn','获取AI回复失败:','🔔\x20检查AI主动拨打触发条件:','setProperty','character-phone-screen','drop','\x20条记忆摘要','likes','jsHeapSizeLimit','✅\x20紧急备份已保存到localStorage','不愿意买','--custom-continue-btn','✅\x20[高效照片分享]\x20消息已保存到数据库','theme-preview-modal','.lrc','\x0a\x0a可能的解决方案：\x0a1.\x20刷新页面重试\x0a2.\x20清除浏览器缓存\x0a3.\x20进入设置→紧急恢复\x0a\x0a错误类型:\x20','新鲜韭菜','140cm×140cm','动态\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22worldbook-desc-text\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','testAppointmentReminder','&id,\x20messageId,\x20characterId,\x20content,\x20timestamp','chatTheme_','📱\x20角色状态显示功能已加载','selectedChatBackground','🧹\x20[cleanupEmojiLibraryItems]\x20总关联记录数:','❌\x20移除主题失败:','图片压缩：','长期约定','群聊中不支持日记功能，请在单聊中使用','\x20个联系人',')\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-photo-placeholder\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-','没有找到需要恢复的表情包','home-screen','🆘\x20从紧急备份恢复聊天设置','🧠\x20测试全局记忆上下文构建...','.shape-radio-option','创建了纪念日：','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x0a请确保文件是有效的备份文件','当前没有选择角色','.location-history-item','想听你声音','数据状态:','导入文件格式不正确','欧姆龙','身份名称:','✅\x20选择了身份:','🚨\x20[MANUAL]\x20恢复了','进行了音乐互动','📱\x20动态记忆开关:','offline-font-','font-color-picker','拉黑管理','删除动态\x20','readAsText','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20align-items:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-bottom:\x2010px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20gap:\x2010px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','从IndexedDB加载群聊数据:','记忆棉床垫','✅\x20测试记录删除成功','🚫\x20[角色被拉黑]\x20','数据库未初始化，跳过约定加载','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22\x22>请选择模型...</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22gemini-2.0-flash-exp\x22>Gemini\x202.0\x20Flash\x20(实验版)\x20-\x20推荐</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22gemini-1.5-flash\x22>Gemini\x201.5\x20Flash\x20-\x20快速</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22gemini-1.5-flash-8b\x22>Gemini\x201.5\x20Flash\x208B\x20-\x20轻量</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22gemini-1.5-pro\x22>Gemini\x201.5\x20Pro\x20-\x20稳定</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22gemini-pro\x22>Gemini\x20Pro\x20-\x20经典</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22gemini-pro-vision\x22>Gemini\x20Pro\x20Vision\x20-\x20视觉</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22手动输入模型名称\x22>手动输入模型名称</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','<strike>$1</strike>','🔍\x20[转发卡片点击]\x20查找结果:','url-input-title','移动硬盘','#forum-persona-selection\x20.selected','gomoku','[已修复的特殊消息]','playing','正在提交...','🔍\x20[callChatAPI]\x20进入单聊表情包分支:','⚠️\x20[已废弃]\x20initBackgroundInteractionSystem\x20被调用，但不执行任何操作','12:00','❌\x20新足迹数据格式错误:','selection-cancel-btn','allLyrics','.location-icon','groupName','visibility-groups-section','黛安芬','✅\x20无聊天记录，联系人为空是正常状态','\x20个同群AI角色参与了评论，开始角色间互动','body','设置头像预览失败，请重试:\x20','ConstraintError','linear-gradient','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22cart-item\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22cart-item-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22cart-item-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22cart-item-name\x22>','diarySettingsSourceScreen','userBold','momentComments','✅\x20剧情总结保存验证成功，角色ID匹配','1.5m','🔍\x20[引用回复-主分支]\x20所有消息ID详情:','\x22\x20onclick=\x22toggleSelection(this)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22','ringing','originalContent','糖醋里脊','冰箱里有我昨天做的汤，记得热一下喝','persona-name','preset-item','files','检查角色动态回复失败:','摄像头','请输入有效的转账金额','💔\x20','表情包添加成功！','cross_','sms-img-','聊天记录恢复完成','请输入预设内容','群聊场景下，可以包含对其他成员的看法、对群聊氛围的感受等','<p\x20class=\x22empty-mount-chats\x22>至少需要2个角色才能创建群聊</p>','transaction','&id,\x20characterIds,\x20eventType,\x20timestamp,\x20context,\x20eventData,\x20importance','添加核心记忆','lastIndexOf','清理本地音乐失败:','已删除\x20','\x0a\x0a该分组下有\x20','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22memory-modal-date\x22>','游戏过程中和用户聊得很开心','.moment-time','\x20个足迹，跳过重新渲染','song-cover-input','0,\x20255,\x20255','\x20约定了活动：','<div\x20class=\x22transfer-message-container\x20received\x22><div\x20class=\x22transfer-card\x20','🧠\x20续写获取到的全局记忆内容:','恢复失败:\x20','的动态','.moment-comments-section','🔍\x20[群聊表情包-直接格式]\x20未找到成员:','A字裙','_chat_paused','个群聊共享','mouseleave','在店铺忙碌','足迹更新设置为手动模式','论坛收藏:\x20','🔥\x20[AI撤回]\x20消息已经被撤回，跳过重复撤回','\x0a\x0a【游戏规则】：\x0a1.\x20玩家只能问是/否问题\x0a2.\x20你只能回答\x22是\x22、\x22否\x22或\x22无关\x22\x0a3.\x20如果问题与真相无关，回答\x22无关\x22\x0a4.\x20如果问题接近真相，可以给予鼓励\x0a5.\x20保持神秘感，不要直接透露答案\x0a\x0a【当前游戏状态】：\x0a-\x20已提问次数：','messages','🚨\x20[净化器-调试]\x20发现奇怪的数组消息:\x20','\x20现在是残局，每一步都很关键。','🔥\x20[转账处理]\x20系统消息已通过动画添加','has-existing-chat','memorySharedGroupIds','6.1','post-image-preview-container','请输入内容或上传图片','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22appointment-action-btn\x20appointment-delete-btn\x22\x20onclick=\x22deleteAppointment(\x27','manualCreateAppointment','会不会','🔥\x20[页面隐藏]\x20标记当前聊天为已读:','不帮你付','game_session_summary','call_record','🎭\x20验证字段:','在房间里休息','createGroupChat','replyToContent','清除角色专属音效失败','处理角色照片消息:','📱\x20检测到新的输入框，重新绑定事件...','🔧\x20修复世界书ID问题...','toLocaleDateString','✅\x20足迹数据迁移完成:\x20总计\x20','嗯，让我想想...','button[onclick=\x22testPublishMoment()\x22]','0.3','data:','undefined','考虑改变策略，或者通过其他方式表达歉意','请输入论坛名称','documentElement','请先设置API密钥','傍晚时分，夕阳西下，天空被染成了金黄色。站在天台上看着这美丽的景色，心情格外平静。这样的时刻总是让人感到生活的美好。','\x27,\x20-apple-system,\x20BlinkMacSystemFont,\x20\x22Segoe\x20UI\x22,\x20Roboto,\x20sans-serif',')\x20=====','mousemove','offline-user-normal-text-color','🎨\x20部分全局主题图片预加载失败:','memory','恢复角色','记忆事件','game-chat-loading','opentype','onerror','\x22\x20placeholder=\x22输入角色名字\x22\x20style=\x22width:\x20100%;\x20margin:\x205px\x200;\x20padding:\x205px;\x20border:\x201px\x20solid\x20#ccc;\x20border-radius:\x204px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label><input\x20type=\x22checkbox\x22\x20id=\x22rebuild_','🔍\x20[sendImageMessage]\x20创建的消息内容:','应用未激活，已停止加载。','\x27,\x20\x27','在游戏应用中','🧠\x20线下模式：强制启用全局记忆读取...','my-posts','10W','📱\x20线上显示线下剧情开关状态:','application/json;charset=utf-8','请输入评论内容','\x22\x20onclick=\x22seekToLyric(','\x22\x20alt=\x22消息图片\x22\x20/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22remove-image-btn\x22\x20onclick=\x22removeMessageImage()\x22>删除图片</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','cssText','🔥\x20[推送通知]\x20续写消息，创建推送通知:','发现非字符串/非数组content，正在修复:','这可能需要几秒钟时间','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22custom-confirm-dialog\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22custom-confirm-title\x22>','🔥\x20[DEBUG]\x20检测到一行中有多个消息ID，进行分割:','character_initiate','\x20个角色的后台发布','记忆事件:\x20','group-description-display','\x20has-avatar-timestamp','的身份回复这条短信。要求：\x0a-\x20体现短信聊天的简洁特点，通常1-3条消息\x0a-\x20保持与ChatApp中相同的角色性格和记忆连贯性\x0a-\x20可以延续之前在ChatApp中的话题或情感状态\x0a-\x20【重要】必须使用JSON数组格式回复\x0a-\x20体现\x22真人对话\x22的自然感\x0a-\x20如果需要发送多条消息，请分别放在数组中\x0a\x0a请回复JSON格式的短信内容：','sms-chat-avatar','购物车是空的','🔍\x20查询动态\x20','\x0a\x0a【正文】\x0a','🚨\x20[URGENT]\x20所有关联记录:','🔍\x20[triggerSmartReply]\x20添加位置消息:','有机茄子','\x0a\x0a##\x20当前用户消息\x0a用户发送了图片','夜晚时光（适合休闲、反思、准备休息）','删除前状态:','diary-settings-btn','test','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mention-name\x22>','获取动态记忆失败:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-details-item\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22payment-details-item-name\x22>总计</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22payment-details-item-price\x22>¥','emoji-library-upload','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22group-option\x22\x20onclick=\x22moveCharacterToGroup(\x27','\x20发布于\x20','没有找到可重建的角色','anniversary-name','createObjectURL','🔄\x20[线下重新生成]\x20检测到正常回复消息，基于用户消息重新生成','♥️\x20<span\x20class=\x22heartrate-number\x22>','⚠️\x20群聊\x20','&id,\x20name,\x20description,\x20createdAt,\x20updatedAt','📱\x20[安卓]\x20记录输入框聚焦时的视口高度:','请再给我一次机会','book','character-silent-mode','warn','status-frequency-setting','清理旧chatSettings数据失败:','testCreateAnniversary','input[name=\x22sharedGroups\x22]:checked','\x20的头像，节省\x20','address','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22far\x20fa-comment\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>评论</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22moment-footer\x22\x20style=\x22display:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x20条\x20','core_','\x20个角色到分组</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22group-list\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','语音聊天','✅\x20线下模式界面设置加载成功','isActive','初始化日记设置界面失败:','🚨\x20[DEBUG]\x20角色:','#333333','px\x20(初始:\x20','请输入有效的图片URL','game-chat-bubble\x20loading','条\x20(按时间顺序滚动)','情节记忆','取消置顶失败:','已取消收藏','❌\x20找不到聊天标题元素','\x0a-\x20**可选歌曲:**\x20','发送表情包：','🗜️\x20开始优化论坛存储...','opacity-value','blocked-message-hint-inline','.message-bubble,\x20.offline-message-content','🎲\x20回复概率检查:\x20','\x20\x20删除:\x20','global-font-override','text-indent-slider','change','文件中发现\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22checkbox\x22\x20id=\x22post-','♪\x20正在播放','getMonth','unread-badge','调整你的道歉策略，更加真诚和具体','次\x0a-\x20玩家间的讨论（你只能看到这些）：\x0a','content-top-margin','🎨\x20应用设置时CSS解析失败，使用提取的名称','我为你付','请填写完整的API配置信息','表情包库保存成功','世界书不存在','\x20条消息的时间戳','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>','线下界面设置','。\x0a3.\x20\x20**用户角色**:\x20用户的名字是\x22我\x22，他/她的人设是：\x22','🔧\x20[世界书调试]\x20显示设置时的当前配置:','offline-user-normal','.toggle-tools-btn','\x20个聊天设置到IndexedDB','时间线:\x20','insertBefore','bold','\x20选择回复\x20','<button\x20class=\x22message-action-btn\x22\x20onclick=\x22','回答正确，继续这个方向思考。','正在创建下载文件...','简单交流了一下','导出JSON数据失败:','\x20分钟后重试好友申请','iconClass','saved-configs-container','🎨\x20CSS字体预览加载成功','global-back-button','[位置分享：','\x22\x20data-forwarded-title=\x22','旅行回忆','获取日记设置失败:','✏️\x20[调试]\x20找不到记忆，memoryId:','，你需要写一篇私人日记。\x0a\x0a重要要求：\x0a-\x20请直接输出日记内容，不要使用JSON格式或任何代码块\x0a-\x20请在日记开头自己写上日期和天气，格式如：\x22','从localStorage备份加载自定义表情包:','my-posts-list','text-decoration','stack','自己留着','gameId','ℹ️\x20角色\x20','默认剧情模式要求：\x0a-\x20以第三人称视角进行情景描写\x0a-\x20包含环境描写、动作描写、心理描写\x0a-\x20每次回复300-500字\x0a-\x20营造沉浸式的剧情体验\x0a-\x20**重要**：用户消息中的括号()内容是环境描写、动作描写或心理活动，你可以观察到这些信息作为背景，但不能表现得像是\x22听到\x22了用户的内心想法。你只能对括号外的实际话语进行回应，可以通过观察用户的可见行为（如犹豫、停顿等）来推测情况，但不能直接回应用户的内心想法\x0a\x0a','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22persona-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22persona-action-btn\x20persona-edit-btn\x22\x20onclick=\x22showPersonaForm(\x27','local-worldbooks-content','移动端长按菜单，messageId:','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22transfer-amount\x22>¥\x20','/models?key=','\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20src:\x20url(\x27','isSystemMessage','今天暂无活动可生成摘要','20000mAh','#forum-character-selection\x20.selected','[style*=\x22position:\x20fixed\x22][style*=\x22z-index:\x2010000\x22]','\x20今天是','.like-count','photo-description-close','ai-chat-avatar-preview','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22pinned-card-unpin-btn\x22\x20onclick=\x22event.stopPropagation();\x20unpinAnniversary(\x27','group-member-colors-modal','.emoji-checkbox','经典棕','appointment-pinned','button-','幸福西饼','orientationchange','25片','🔍\x20[triggerSmartReply]\x20找到未回复的用户消息数量:','获取投票历史失败:','search-chat-modal','📋\x20最新的约定:','❌\x20eventData不可序列化，转换为字符串:','⏰\x20[定时器设置]\x20','persona_','一起游戏','该角色暂无记忆数据','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-preview\x22>','角色分组','edit-message-modal','&id,\x20name,\x20isGlobal','block-action-label','diary-custom-font-input','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22forwarded-card-footer\x22>查看','currentPlayer','群聊不支持电话通话','some','头像数据长度:','appointment_update','input[name=\x22offline-bubble-style\x22][value=\x22','\x22指代角色\x0a-\x20不要使用\x22我\x22、\x22你\x22等第一、第二人称\x0a-\x20例如：\x22用户告诉','post-type-modal','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-item\x22\x20onclick=\x22openPhoneMessage(\x27','已进入线下剧情模式','contact-list','cart-footer','\x20已添加到购物车','✅\x20AI成功随机选择歌曲','\x20个活跃的后台定时器','.moment-action-btn','character-list元素不存在，跳过渲染','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22persona-selection-desc\x22>','AI返回的数据不是一个数组。','无描述','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22group-list\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','📝\x20[约定时间线]\x20已记录约定更新事件到跨应用时间线','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22edit-group-modal\x22\x20class=\x22modal\x22\x20style=\x22display:\x20flex;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-title\x22>编辑分组</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label>分组名称</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20id=\x22edit-group-name\x22\x20class=\x22form-input\x22\x20value=\x22','⏰\x20启动了定时发布时间检查器','⚠️\x20数据库保存失败，已启用紧急备份模式','\x20个\x0a-\x20聊天记录:\x20','条\x0a\x20\x20•\x20记忆摘要:\x20','设置:\x20','删除操作:\x20','models/','anniversary-yearly','💡\x20[提示]\x20后台定时器由全局系统管理，请使用\x20initGlobalBackgroundInteractionSystem','进口蓝莓','蛋炒饭','主动聊天测试失败:','❌\x20连接错误:\x20','difficulty','\x22示例代码','.offline-avatar.user-avatar','ctrlKey','图片已设置','restartBackgroundSystem','🔍\x20[createAIMessage]\x20未找到群成员:\x20','\x27)\x22\x20title=\x22查看完整内容\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-eye\x22></i>\x20查看\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22memory-action-btn\x20edit-btn\x22\x20onclick=\x22editStorylineSummary(\x27','清理足迹缓存失败:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#999;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x204px\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20rgba(0,0,0,0.05);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20max-width:\x2080%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20text-align:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','动态评论中的角色:','🔄\x20重新启动后台互动系统...','momentMentions','🔍\x20[引用回复-主分支]\x20查找目标ID类型:','image-url-input','未知日期','获取默认头像失败:','切换静音模式失败:','transfer-modal','一个人推门进入房间，看到房间里的情况后立即报警。','🎨\x20无法读取CSS规则，使用默认名称','.visibility-group-item[data-group-id=\x22',':\x20背景已更新，保存到数据库','emoji-library-chevron','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-chevron-right\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','fas','circle','\x22\x20已更新！','onchange','3-4人份','\x0a\x0a情景记忆（最近的重要经历）：\x0a','屏幕尺寸已切换为','\x0a👤\x20','，人设：','AI返回的JSON格式错误，无法修复。','AI下棋API调用失败:','🎵\x20播放全局音效:\x20','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22anniversary-item-compact-countdown\x22>','.sms-message','image-preview-modal','...</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20id=\x22name_','fas\x20fa-star','\x20的短信聊天（身份：','角色ID:','aiBoldTextColor','⏰\x20[定时器执行]\x20','🔍\x20[消息渲染]\x20完整消息对象:','\x27);\x20background-size:\x20cover;\x20background-position:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','选择「取消」：放弃本次操作','发布中...','blockedCharacters','暂无消息','input[name=\x22memoryDays\x22][value=\x22','onFriendRequestRejected','\x27,\x20','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>','应用图标数据保存成功','npc','#fff','角色记忆：\x0a','gemini-2.5-flash','🔍\x20[AI回复处理]\x20当前聊天角色:','1080P','</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22reply-meta\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>No.','🔧\x20检测到数据相关错误，尝试自动修复:','已生成剧情总结并退出线下模式','是个特别的日子——','\x20添加情景记忆:\x20','][\x22','<i\x20class=\x22fas\x20fa-comment-dots\x22></i>','backgroundPosition','生成手机消息失败:','🔍\x20正常回复消息索引:\x20','聊天记录已删除','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22persona-item\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22persona-avatar\x22\x20style=\x22','最新消息:\x20','🔍\x20[addMessageWithAnimation-表情包]\x20检测到表情包消息:','relationship','：\x22每年的这一天，我都会想起当时的情景。\x22','\x20个孤立回复','globalLetterSpacing','\x20被拉黑了，但仍可以发送消息。如果想修复关系，可以发送好友申请。</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22margin-top:\x208px;\x20font-size:\x2012px;\x20color:\x20#6c757d;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20好友申请格式：{\x22type\x22:\x20\x22friend_request\x22,\x20\x22message\x22:\x20\x22道歉或请求信息\x22}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','repeat','previewState','聊天顶部背景已上传','>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22toggle-slider\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','🔍\x20[AI处理调试]\x20用户消息结构:','动态点赞','\x20条重复)','toArray','sms-timestamp','防水型','医用外科','消息数量:\x20','photoDescription','&id,\x20chatId','拒绝出钱','<i\x20class=\x22fas\x20fa-spinner\x20fa-spin\x22></i>','substr','message-container\x20received','imageDescription','生成心声失败:','statusIcon','消息:\x20','createAnniversaryByCharacterManual','主屏幕字体颜色已设置为','删除角色\x20',';\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x208px\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#f8f9fa;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2013px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','continue','momentVisibility','测试发布失败','&id,\x20characterId,\x20settings,\x20timestamp','\x20个无效的联系人记录','正在处理支付...','\x0a\x0a请作为','now','ai-chat-avatar-upload','正在清理存储空间...','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22menu-item\x22\x20onclick=\x22editOfflineMessage(\x27','生成AI间回复失败:','🚨\x20记忆上下文构建中发现角色ID不匹配的时间线记录:','用户更新了约定\x22','轻松搞笑类型，幽默有趣的推理故事','rejectedBy','base64','的活动特征\x0a4.\x20**体现角色个性**\x20-\x20活动要符合','我来付','\x20个表情包吗？\x0a\x0a删除后无法恢复！','从数据库补充壁纸数据失败:','✅\x20强制回复成功:\x20\x22','❌\x20[约定时间线]\x20记录约定更新事件失败:','进口香蕉','\x22\x20中成员\x20\x22','cdn.discordapp.com',',\x20\x27','\x20个世界书','🔍\x20[callChatAPI]\x20移除被合并的消息:','characterAvatar','检测到\x20','loadSettings','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-photo-item\x22\x20onclick=\x22openPhonePhoto(\x27','history-settings-modal','h,\x20热度','--custom-send-btn','character-sound-enabled','\x20\x20记忆摘要:\x20','++id,\x20characterId','❌\x20加载通话形象设置失败:','世界书挂载设置已保存，已挂载\x20','orderBy','动图表情包','search-results-list','localStorage角色备份:','✅\x20手动重建完成！恢复了\x20','moments_reply_to_user','加载表情包库内容失败:','\x20条消息已修复','group-manage-header','\x22\x20class=\x22checkbox-label\x22></label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','条消息生成状态','userBoldTextColor','mutedGroups','保存评论失败:','background-image:\x20url(','\x22,\x20分类:\x20\x22','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22empty-state\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>还没有表情包库</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>请先在\x22我\x22页面创建表情包库</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','recall_previous','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-regenerate-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-regenerate-text\x22>重新生成失败：函数无效</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x22共享','在书房研读典籍','这个男人是盲人，电话里告诉他医院弄错了，他的眼睛其实没有治好，他以为自己重见光明了，但其实一直都是黑暗的。','fab\x20fa-weibo','✅\x20[删除完成]\x20从主聊天记录删除了','background-image:\x20url(\x27','存储的函数无效:','random','letterSpacing','chat-top-bg-input','未知时间','动态:\x20','拒绝了你的','🔥\x20[短信AI回复]\x20开始生成回复，角色:','编辑消息时发现特殊类型的content:','global-add-button','appendChild','humorous','/100','🔥\x20[DEBUG]\x20检测到多个独立JSON数组，开始提取所有消息','[data-memory-id=\x22','groupInfo','available','OLED版','，你的人设是:\x20','\x20(最近)','<div\x20class=\x22game-button-badge\x20','继续这个思路试试','验证头像来源:','.play-btn','📷\x20图片：','localeCompare','\x20条过期的时间线记忆','&id,\x20characterId,\x20status,\x20activity,\x20location,\x20lastUpdate','.size-option','已完成','🔧\x20[应用启动]\x20使用默认API设置','提醒：','\x0a\x0a现在是','/v1/','data-transfer-id','globalStatusUpdateFrequency','appointment-content','下个月的旅行安排：订机票、酒店、景点攻略...','男人得了严重的抑郁症，觉得自己像行尸走肉一样没有灵魂。\x27找到影子\x27其实是他重新找回了生活的希望和自我认同。','🚫\x20[防崩坏]\x20跳过短时间内的重复申请(第二处)，转为普通消息','❌\x20删除世界书时数据库保存失败:','onplay','🚫\x20跳过拉黑指令对象，不显示为消息:','🔍\x20[第三处-AI图片]\x20未找到群成员:','✅\x20已删除角色\x20','batchEmojiData','--offline-ai-italic-text-color','N95','fillText','custom-emoji-item\x20placeholder',']\x0a,[','disabled','#333','获取挂载记忆失败:','four','ai_random_select_song','\x27)\x22\x20title=\x22编辑\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-edit\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22anniversary-action-btn\x20anniversary-delete-btn\x22\x20onclick=\x22deleteAnniversary(\x27','的聊天头像无效，尝试使用其他头像','myBubble','🔥\x20[续写]\x20检测到用户转账消息，开始处理转账:','phone-chat-messages','\x0a\x0a请分析用户和角色这轮的讨论，并给出合适的回应：\x0a\x0a1.\x20如果包含明确的是/否问题，请回答\x22是\x22、\x22否\x22或\x22无关\x22\x0a2.\x20如果是讨论和推理，给予适当的引导和鼓励\x0a3.\x20如果推理方向正确，给予肯定和提示\x0a4.\x20如果推理偏离，给予温和的纠正\x0a5.\x20如果讨论停滞，提供新的思考角度\x0a6.\x20保持神秘感，不要直接透露答案\x0a7.\x20回答要简洁明确（不超过30字）\x0a\x0a重要：请直接输出纯文本回答，不要使用JSON格式或数组格式。\x0a\x0a请给出你的回应：','角色分组:\x20','chat-bottom-bg','continue-btn-item','worldbooks','确认收款','检测到localStorage中有更新的聊天记录！\x0a\x0a发现\x20','找不到文件上传元素，请刷新页面重试','🎮\x20角色消息（左边）:','/*\x20头像在上方居中，气泡在下方\x20*/\x0a#offline-mode-overlay\x20.offline-message\x20{\x0a\x20\x20\x20\x20display:\x20flex\x20!important;\x0a\x20\x20\x20\x20flex-direction:\x20column\x20!important;\x0a\x20\x20\x20\x20align-items:\x20center\x20!important;\x0a\x20\x20\x20\x20margin-bottom:\x2015px\x20!important;\x0a}\x0a#offline-mode-overlay\x20.offline-avatar\x20{\x0a\x20\x20\x20\x20order:\x201\x20!important;\x0a\x20\x20\x20\x20margin-bottom:\x208px\x20!important;\x0a}\x0a#offline-mode-overlay\x20.offline-message-content\x20{\x0a\x20\x20\x20\x20order:\x202\x20!important;\x0a\x20\x20\x20\x20width:\x2090%\x20!important;\x0a\x20\x20\x20\x20text-align:\x20center\x20!important;\x0a}','top-app-bar','\x20在当前聊天中更换了头像，但角色卡保持不变','90cm','sms_image',')的评论！用户会自己评论！**\x0a\x0a##\x20回复生成要求:\x0a1.\x20\x20**🔥\x20识图优先**:\x20如果帖子有图片，你的回复必须优先围绕图片内容展开。\x0a2.\x20\x20**🚨\x20身份识别**:\x20','aiChatNickname','📊\x20基于','lyrics-file-status','desc','❌\x20generateCharacterFootprints:\x20没有指定角色','解析bin歌词失败:','的身份继续这个剧情。直接输出续写内容：','考虑一下是否有误解或错觉...','lyricsTimings','ℹ️\x20手动刷新：当前时间段暂无新活动','group-member-item','offline-my-bubble-color','sms-message\x20','scrollIntoView','expand-btn-preview','&id,\x20title,\x20artist,\x20album,\x20duration,\x20url,\x20coverImage,\x20lyrics,\x20addedTime,\x20isLocalFile','video-call-name','editStorylineSummary','autoFixed','preset_','📚\x20没有更多历史消息可以加载','.mini-app[onclick=\x22showApp(\x27anniversary-screen\x27)\x22]\x20.mini-app-icon','🔔\x20AI请求发起视频通话:','该剧情总结不属于当前角色','📝\x20角色\x20','px)','\x20的截断头像','memorySummaries','<input\x20type=\x22checkbox\x22\x20data-diary-index=\x22','长筒袜','background-moments-enabled','✅\x20[单聊戳一戳回应]\x20消息已保存到数据库','&id,\x20characterId,\x20fact,\x20importance,\x20timestamp,\x20type,\x20category,\x20contextId,\x20lastAccessed,\x20source','🔧\x20[面具调试]\x20创建新对话前的聊天设置状态:','🔍\x20[addMessageWithAnimation]\x20通过name找到成员:','.multi-select-item','🧹\x20清理孤立回复...','该角色已被拉黑','✅\x20设置已异步迁移到数据库\x20(','🔄\x20加载短信联系人列表...','emoji-library-mount-list','每天的花束','icon-upload-section','我来下单','getDay','🔧\x20[processAIContinuation]\x20检测到特殊指令对象，跳过显示:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22menu-item\x22\x20onclick=\x22editOfflineMessage(\x27','API返回格式错误','头像已更新！','山东蔬菜','🔍\x20[generateSMSReply]\x20使用多模态API调用','应用日记设置失败:','file','\x20个帖子的头像数据','clientHeight','🔥\x20[修复continuation]\x20发现群聊消息:',')\x22\x20title=\x22移除商品\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-times\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22cart-item-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22cart-item-price\x22>¥','diary-settings-screen','news','群聊成员','import-execute-btn','🎨\x20无法访问CSS规则，使用默认名称','===\x20群聊详细信息\x20===','🚨\x20[DIAGNOSE]\x20IndexedDB表情包数据:','针织帽','2024年3月12日\x2010:15','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-photo-placeholder-large\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-image\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>照片预览</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','</select></div>','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-sender\x22>','\x0a\x0a这是你自己在群聊中的信息','保存专属音效开关状态失败:','listeningDuration','🔔\x20[推送通知]\x20处理消息','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22add-to-cart-btn\x22\x20onclick=\x22addToCart(\x27','星光色','momentLocations','\x22]\x20','论坛世界书:\x20','<button\x20class=\x22appointment-action-btn\x20appointment-complete-btn\x22\x20onclick=\x22toggleAppointmentComplete(\x27','💾\x20释放空间:\x20','是的，这很重要。','DM生成故事失败，使用预设故事:','群昵称修改消息保存失败，回退到全量保存:','未知成员','🔥\x20[短信AI回复]\x20AI原始回复:','my-bubble-opacity','-\x20你的评论风格：','40-41','multi-select-btn','🎨\x20没有主题数据可应用','emojiLibraries',')的角色行为足迹。要求:\x0a\x0a1.\x20行为必须符合角色的人设和性格特点\x0a2.\x20参考世界书设定中的背景信息\x0a3.\x20结合全局记忆中的相关信息\x0a4.\x20如果有今日聊天记录，请确保聊天时间点的足迹是\x22正在与用户聊天\x22或相关活动\x0a5.\x20其他时间点生成合理的活动，可以是任何符合角色特点的行为\x0a6.\x20行为要自然、真实，体现角色的真实生活\x0a7.\x20不要回避任何时间段，角色可能在睡觉、工作、娱乐、社交、做家务、情侣夜生活等任何活动，角色要拥有符合人设的作息\x0a8.\x20每个足迹包含具体时间、行为描述、地点\x0a9.\x20行为类型可以是:\x20sleep(睡觉),\x20daily(日常),\x20work(工作),\x20leisure(休闲),\x20social(社交),\x20travel(出行),\x20chat(聊天),\x20nightlife(夜生活),\x20intimate(私密),\x20etc.\x0a\x0a⚠️\x20重要：足迹描述风格要求\x0a-\x20每条足迹描述必须在30字以内\x0a-\x20使用客观、简洁的记录风格，类似日志\x0a-\x20避免过度文艺化的描述和场景渲染\x0a-\x20直接记录行为事实，不要过多情感描述\x0a-\x20正确示例：\x22正在与她聊天，告诉她自己会一直等下去\x22、\x22没什么胃口，随意吃了点午饭\x22\x0a-\x20错误示例：\x22走廊的声控灯熄灭，周围陷入一片黑暗和寂静。他一动不动，像一座雕塑\x22\x0a\x0a请以JSON数组格式返回，每个足迹对象包含:\x0a{\x0a\x20\x20\x22time\x22:\x20\x22HH:MM\x22,\x0a\x20\x20\x22activity\x22:\x20\x22具体的行为描述（30字以内，客观记录）\x22,\x0a\x20\x20\x22location\x22:\x20\x22具体地点\x22,\x0a\x20\x20\x22type\x22:\x20\x22行为类型\x22\x0a}\x0a\x0a只返回JSON数组，不要其他解释文字。确保时间按顺序排列，且不超过当前时间','聊天记录已导出','🔍\x20[processAIReply]\x20内容是否为数组:','cssVariables','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-trash\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','参与了关于\x22','needCleanup','❌\x20保存通话形象设置失败:','[ID:','<div\x20class=\x22forum-empty-state\x22><p>你还没有发过帖子</p></div>','老板说这次会议很重要，可能会讨论新项目','24片','你是一个神秘莫测的DM，回答简洁冷静，保持神秘感，很少给出额外信息。','保存足迹缓存失败:','\x20在当前上下文中没有核心记忆需要清除','你选择了认输','</span>','🔥\x20[DEBUG]\x20准备显示消息','fas\x20fa-home','删除失败:\x20','.jpg','files.catbox.moe','IndexedDB群聊数量:','edit-message-content','这个世界书内容较大（超过1MB），编辑可能会导致浏览器卡顿。是否继续？','member-avatar-preview','线下界面设置:\x20','19:00','fa-history','my-chat-nickname','.moment-item[data-timestamp]','在动态中回复了用户','AI回复','恢复紧急备份失败','处理AI好友申请失败:','\x22</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','🔥\x20找到要撤回的消息:','✅\x20清空完成:\x20短信记录、','bubble-style-','<span\x20class=\x22user-post-badge\x22>我</span>','📱\x20动态\x20','未找到角色\x20','timestampPosition','✅\x20第二个showGroupChatMemberSelection被调用，接收到的personaId:','\x20成员列表为空','&id,\x20characterId,\x20settingName,\x20settingValue,\x20timestamp','解析localStorage设置失败:','📰\x20在社区\x20','🚫\x20[定时器设置]\x20','2-digit','你的回合','offline-ai-normal','🔔\x20AI主动拨打未触发，概率:','<i\x20class=\x22fas\x20fa-play\x22></i>','当前棋盘状态（15x15，坐标从0开始，●=黑子，O=白子，·=空位）：\x0a','bubbleColor','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-item\x22\x20onclick=\x22openPhoneMessage(\x27','所选数据已彻底清除！','邀请，可能现在不太方便呢~','同事小李','\x0a[该动态包含','offline-custom-font-link','</span>/5000\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','🔧\x20[面具调试]\x20联系人保存完成，当前联系人列表:','[AI发送了一张图片，描述：','audio/','发现重复ID的角色\x20(','✅\x20[高效群成员系统消息]\x20群成员加入消息已单条保存到数据库','🎨\x20设置CSS变量\x20--custom-global-top-app-bar:','今天尝试了一家新开的餐厅，这道菜的摆盘很精致，味道也很不错。和朋友一起享用美食的时光总是特别愉快，值得记录下来。','⏰\x20为\x20','角色信息：\x0a','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-option-desc\x22>','rgba(200,\x20200,\x20200,\x200.25)','global-add-button-preview','\x20\x20消息数量:\x20','棋子元素查找:','\x27)\x22\x20class=\x22delete-worldbook-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-trash\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22toggle-switch\x22\x20onclick=\x22event.stopPropagation()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22checkbox\x22\x20onchange=\x22toggleGlobalWorldbook(\x27','message-action-bar','✅\x20今日足迹生成完成','.new-footprint','forums','🔧\x20[表情包库]\x20创建新库','.message-item','post-title-input','keypress','\x20已成功删除','！你记得吗？','✏️\x20[调试]\x20记忆验证通过，开始处理内容...','lastMomentTime','进行中','🔥\x20content:','--status-icon','该游戏正在开发中，敬请期待！','🔍\x20[callChatAPI-第三处]\x20AI主动戳一戳:','cloneNode','人)</span></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-preview\x22>','AI返回的代码块格式错误:\x20','头像:','发送了表情包：','>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20允许该分组角色在动态中互动\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22form-help-text\x22>开启后，该分组的角色可以在动态页面相互点赞、评论</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-button\x20modal-secondary\x22\x20onclick=\x22hideEditGroupModal()\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-button\x20modal-primary\x22\x20onclick=\x22updateGroup(\x27','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22memory-empty-state\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-brain\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>','亲爱的','getPropertyValue','\x20个帖子','您还没有投票记录','hidden','数据序列化失败:\x20','timestamp\x20timestamp-bubble','🔔\x20AI主动拨打电话功能未开启，角色不会主动拨打电话','已取消置顶，现在可以删除了','[AI图片：','下得很专注','memory-viewer-screen','\x20发送了\x20','\x20(来自','\x20不存在，使用默认分组','new-group-name','鲜芋仙','🔍\x20[转发消息创建]\x20转发消息对象:','🔍\x20[processAIReply-表情包]\x20msgData.name\x20不存在，可能是单聊',',\x20群聊:\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22appointment-empty-state\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-calendar-check\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>还没有约定</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>点击右上角\x20+\x20添加新约定</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','最近聊天记录：\x0a','检测到localStorage中的面具数据，开始迁移...','\x20个角色ID:','API配置不完整，跳过AI回复','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22sender\x22>','找到用户最近发送的图片(旧格式):','现代都市生活分享社区','🎭\x20用户输入:','1kg','🔍\x20[callChatAPI]\x20发送给API的消息数量:','强制清理动态失败:','字体CSS已加载，字体名称:\x20','收款人信息错误','#favorite-btn\x20i','anniversary_create','字体预览已加载：','🔧\x20跳过重复消息ID:\x20','，将在30-60秒后触发\x20','❌\x20角色专属音效加载失败\x20(','游戏应用活动','线下消息删除失败:','是啊，阳光明媚的','start-selection-btn','moments-username','[不支持的消息格式]','计算存储失败:','开始删除角色ID:\x20','\x20\x20\x20---','🔥\x20[generateRepliesForUserPost]\x20找到普通代码块:','current-emoji-library-mount','应用图标数据迁移完成:','保存应用图标失败:','\x20加入了群聊','Paperwhite','_transfer_','✅\x20[高效拉黑反应]\x20消息已保存到数据库','🚀\x20[转账处理]\x20开始处理AI对转账的回复:','<div\x20class=\x22message-avatar','单选投票失败:','reminder-message','\x0a\x0a##\x20当前情况:\x0a-\x20用户的申请理由:\x20\x22','条,\x20总计使用','persona-storage-size','overdue','diary-time-input','restoreGroupChatState','[转发]\x20','历史走法（共','🔧\x20正在应用完整系统修复...','屏蔽管理','🔥\x20[续写]\x20找到要撤回的消息:','<div\x20class=\x22dreamy-photo-container\x22\x20onclick=\x22togglePhotoText(this,\x20\x27','🔧\x20[表情包库]\x20新库创建成功:','moments','选择添加按钮样式来源','preview-ai','iPhone\x2015','14:41','📋\x20数据库中的所有动态ID:','找到消息容器:','约定了约会','删除失败：数据库保存错误','🔍\x20[sendApiMessage]\x20检测到线下模式，重定向到线下发送逻辑','\x22\x0a-\x20用户主动道歉并请求重新做朋友\x0a\x0a##\x20你的任务:\x0a根据你的角色性格、用户的申请理由，以及你对这种情况的态度，决定是否同意重新添加用户为好友。\x0a\x0a考虑因素：\x0a1.\x20你的性格是否容易原谅别人？\x0a2.\x20用户的道歉是否真诚？\x0a3.\x20你是否愿意给对方第二次机会？\x0a4.\x20你当初拉黑的原因是否严重？\x0a\x0a你的回答必须非常简洁，只能是以下两个词之一：\x0a-\x20\x22同意\x22\x20(如果你愿意原谅并重新开始)\x0a-\x20\x22拒绝\x22\x20(如果你还不想原谅或重新联系)\x0a\x0a请现在做出你的决定：\x0a','渲染聊天消息失败:','HEPA滤网','修复了世界书\x20\x22','正在预览\x20','aiBold','路过的人','\x22\x20onclick=\x22togglePostSelection(','bio','⚠️\x20世界书内存使用过高，建议清理大文件','gemini-1.5-flash','<div\x20class=\x22timestamp\x20timestamp-inside\x22>','🔍\x20[转发卡片点击]\x20查找消息ID:','clearSound','🗑️\x20删除世界书:','📊\x20=====\x20记忆统计结束\x20=====\x0a','.mini-app[onclick=\x22showApp(\x27chat-screen\x27)\x22]\x20.mini-app-icon','•\x20用自然的语言表达记忆连接：\x22还记得...\x22、\x22就像上次...\x22、\x22之前你说过...\x22\x0a','\x27,\x20event)\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20title=\x22点击更换','\x20数据不完整或包含异常数据','API未配置，备忘录使用模拟数据','赞了你的动态','⚠️\x20跳过重复核心记忆:\x20','.transfer-confirm-note','✅\x20[高效线下AI消息]\x20单条消息已保存到数据库','💡\x20使用\x20testPublisherReply(动态ID)\x20来测试发布者回复功能','功能区展开按钮样式已设置','phone-note-detail-time','icon_','🔍\x20[triggerSmartReply]\x20处理','\x20设置主动聊天定时器失败:','<h4>选择要重建的角色：</h4>','保存记忆设置失败:','🔔\x20[日记推送通知]\x20跳转到日记界面完成','\x20-\x20线下剧情记录\x20-\x20','所有配置已清空','加载面具失败:','.preview-phone','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22anniversary-item-actions\x22\x20onclick=\x22event.stopPropagation()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22anniversary-action-btn\x20anniversary-edit-btn\x22\x20onclick=\x22showAnniversaryForm(\x27','sequential','明天的会议记得准备资料','global-bottom-app-bar-preview','图标已上传','确定要清空所有线下模式聊天记录吗？此操作不可撤销。','摩力克','api-chat-settings-screen','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22emoji-library-item-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22emoji-library-item-name\x22>','myBubbleColor','🧠\x20线下模式全局记忆内容预览:','（刚刚发布）','柠檬茶','.modal','保存线下模式聊天记录失败:','🧪\x20强制发布者回复测试...','input[name=\x22offline-bubble-style\x22]:checked','🔥\x20线下模式Gemini\x20API完整响应:','创建约定','🔍\x20[群聊表情包]\x20找到匹配的表情包:','清理过期记忆失败:','10385823NnZVBy','确定要移除\x20\x22','\x0a\x0a用户互动情况:\x0a','平放式','包含messageData字段:\x20','加载API设置失败:','85度C','\x20个孤立收藏','\x20(已静音)','消息不存在','🔔\x20[推送通知]\x20纪念日/约定通知，无条件显示','global-back-button-preview','🧪\x20[测试]\x20手动触发\x20','-saved-colors','isUnlocked','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22worldbook-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22event.stopPropagation();\x20deleteWorldbook(\x27','图片文件不能超过5MB','#memory-mount-list\x20input[type=\x22checkbox\x22]:checked','\x0a-\x20IndexedDB群聊数量:\x20','：\x22生日快乐～这一天对我们来说很特别呢。\x22','&id,\x20appId','•\x20孤立回复:\x20','.offline-continue-btn','标准滤网','URL导入表情包','default-avatar','从IndexedDB加载recentEmojis:','backgroundDiaryEnabled','voted','url-preview','样本记录:','usage',';\x20color:\x20','createElement','🚨\x20[MANUAL]\x20手动恢复失败:','\x0a请在每次回复中都要意识到这个问题的存在，并根据你的性格表现出相应的情绪和行为。','payment-modal-total','我们有约定——','getAttribute','记录这个日子','🔍\x20[消息渲染]\x20通过name找到成员:','sms_initiate','\x20这个时间段的新行为足迹。\x0a\x0a角色信息:\x0a-\x20姓名:\x20','appointments','#today-diary-content,\x20#single-diary-content,\x20#diary-preview-content','🎮\x20已清除游戏相关的时间线记忆','msgData.message:','fontSize','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-full-meta\x22>由\x20','<div\x20style=\x22width:\x2040px;\x20height:\x2040px;\x20background-color:\x20#ddd;\x20border-radius:\x208px;\x20display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x20color:\x20#666;\x20font-size:\x2014px;\x22>','\x22已删除','哎呀！','find','🔗\x20已将','设置selectedPersonaForChat:','❌\x20查询跨应用时间线失败\x20-\x20characterId:\x20','继续加油！','删除对话时出错:','has','current-persona-avatar','\x20发送了消息，重新安排主动聊天定时器','游戏记录已清空','⚠️\x20[线下重新生成]\x20在chatMessages中未找到要删除的消息','表情包库\x22','🔍\x20[照片修复]\x20设置照片发送者:','sms-manage-modal','ℹ️\x20群聊数据加载：消息通过chatMessages表，成员通过groupChats对象的members属性','已拉黑\x20','persona-avatar-preview','可调节','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</span>','moveNumber','Canada\x20Goose','500','reminder-','🔧\x20从聊天记录恢复了\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22grid-column:\x201\x20/\x20-1;\x20text-align:\x20center;\x20padding:\x2040px;\x20color:\x20#666;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-spinner\x20fa-spin\x22\x20style=\x22font-size:\x2024px;\x20margin-bottom:\x2010px;\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>正在生成','🔥\x20[callForumAPI\x20-\x20Text\x20Only]\x20函数被调用','(canInteract:\x20','批量导入表情包失败:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','video_avatar_','快充版','对游戏','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-request-success-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20我已为你买单，尽情享用吧~<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22payment-success-text\x22>支付成功</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22payment-request-details-btn\x22\x20onclick=\x22showPaymentDetails(\x27','\x22\x20class=\x22color-input\x22\x20value=\x22','Speedo','海龟汤（已优化）','sms-image-input','❌\x20[Gemini\x20API]\x20图片格式解析失败','儿童装','focus','paddingLeft','px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-message\x22\x20onclick=\x22toggleVoiceText(this)\x22\x20data-text=\x22','\x20的预设已不存在，重置为不使用预设','开始读取文件:\x20','判断角色状态更新失败:','字体CSS加载失败，请检查URL','没有找到可重新生成的AI消息','blockerId','从localStorage恢复的设置:','游戏聊天API调用失败:','表情包库_','chat-option-item\x20','<i\x20class=\x22fas\x20fa-microphone-slash\x22></i>','72片','.theme-item-status','[角色反应]','history-messages-count','-quote-label','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-bubble\x20sent\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-row\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-avatar-small\x22\x20style=\x22background:\x20var(--color-text-lighter);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','评论已删除','totalSongs','\x22\x20data-index=\x22','.emoji-tab','删除表情包失败:','\x20-\x20contextId:\x20','🚨\x20发送内容异常巨大!','\x20没有用户消息记录，不设置定时器','\x22\x20alt=\x22你\x22\x20style=\x22width:\x20100%;\x20height:\x20100%;\x20border-radius:\x2050%;\x20object-fit:\x20cover;\x22>','核心记忆:\x20','🔄\x20[线下重新生成]\x20检测到续写消息，使用续写逻辑重新生成','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22memory-item-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',']\x0a[','🔍\x20[调试]\x20开始查询数据库...','clear-timeline','.memory-edit-textarea','⚠️\x20fixMissingOfflineMessageFlags函数已被完全禁用，避免数据混乱','已将localStorage数据重新保存到IndexedDB','globalTopAppBar','\x20对\x20','renderMessageList','📊\x20聊天记录格式分析完成，请查看控制台','🌧️','♪\x20正在播放自定义歌曲','🕐\x20[主动聊天时间检查]\x20','reply_to_user','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footprints-loading\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footprints-loading-spinner\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>正在查看今日足迹...</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22loading-detail\x22>今日行程报备中</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x20的线下模式设置到数据库','🔍\x20[Gemini\x20API]\x20图片格式:','🔥\x20[论坛帖子生成]\x20修复后仍无法解析:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footprints-loading\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-brain\x20fa-pulse\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>正在基于角色人设生成足迹...</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22loading-detail\x22>分析角色性格、世界书设定和记忆数据中</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','today','⚠️\x20角色\x20','\x20条动态吗？','background-chat-frequency','✅\x20已保存\x20','[复杂消息]','🤗\x20HuggingFace反代配置已自动填写！\x0a\x0a请：\x0a1.\x20将地址中的\x20xxx-xxx\x20替换为实际的HF\x20Space地址\x0a2.\x20选择模型或手动输入模型名称','保存最近表情包失败:','offline-ui-settings-modal','message-wrapper\x20system','🔍\x20查找动态ID:\x20','\x20个表情包','video-camera-btn','🔍\x20分析\x20','mount-','\x27)\x22></div>','.ttf','\x22这句话时的内心想法。\x0a\x0a##\x20输出要求：\x0a1.\x20以第一人称视角描述内心想法\x0a2.\x20内容应该真实反映角色的性格和当时的心理状态\x0a3.\x20可以包含：对用户话语的真实感受、内心的小纠结、未说出口的想法、情感波动等\x0a4.\x20','❌\x20加载线下模式预设失败:','has-checkbox','\x20个聊天设置到数据库','的完整聊天数据备份','恐怖悬疑类型，带有恐怖元素但不过分血腥','105cm','此功能已禁用，因为容易误判线上消息为线下消息','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-overlay\x22\x20onclick=\x22closeModal()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x20vote-history-modal\x22\x20onclick=\x22event.stopPropagation()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3>我的投票历史</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-close\x22\x20onclick=\x22closeModal()\x22>×</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22vote-history-list\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','create-group-modal','❌\x20未找到动态:','论坛图片','分钟）','\x20的评论','为新聊天\x20','++id,\x20[userId+postId],\x20userId,\x20postId','与用户一起听歌：','.result-bar-bg','是普通关系。','\x20\x20⚠️\x20发现全局紧急备份！这可能包含重要的聊天设置数据','blocked-input-notice\x20show','lineHeight','自定义','分组删除成功','message-item\x20','请先填写API地址和密钥','\x20\x20-\x20缓存中的AI昵称:','order_type','🔄\x20[线下重新生成]\x20消息类型分析:','nickname-settings-modal','现在在一个动态下，','en-US','🧠\x20当前上下文:','.dock-app[onclick=\x22showApp(\x27messages-screen\x27)\x22]\x20.dock-app-icon','✅\x20结束且不总结：模态框已关闭','获取足迹缓存失败:','暂无简介','我为你买单','Ladurée','16:48','加载应用图标失败:','metaKey','请输入有效的尺寸范围！','确定关系','生成回复失败','这个推理有逻辑','video-call-user-avatar','刷新失败:\x20','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-photo-placeholder\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-image\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','phoneBorderEnabled','\x0a今日对话记录:\x0a','relative','MAX_EPISODIC_MEMORIES_PER_CHARACTER','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22memory-action-btn\x20view-btn\x22\x20onclick=\x22viewStorylineSummary(\x27','✅\x20[转发卡片点击]\x20找到转发消息，显示详情','text/html;charset=utf-8','appointment-never-expires','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-selection-desc\x22>','面具头像上传事件监听器已绑定','🔄\x20后台自动更新足迹数据...','import-full-backup-input','通话回复错误:','🎉\x20主动聊天定时器重新初始化完成','🎭\x20生成备用故事:','❌\x20保存到localStorage失败:','让我分析一下','批量导入失败，请检查URL是否有效','\x0a#\x20对话摘要任务\x0a\x0a你需要为以下对话生成一个简洁的摘要。\x0a\x0a##\x20角色信息\x0a-\x20角色名称:\x20','✅\x20[高效错误消息]\x20AI回复失败消息已单条保存到数据库','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22time\x22>','解析群聊AI响应失败:','```','🔍\x20[转发消息处理]\x20消息','❌\x20恢复紧急备份失败:\x20','🔧\x20[应用启动]\x20迁移API设置从localStorage到IndexedDB','🎨\x20自定义CSS已应用（标准模式）','turtle_soup_dm','保存API设置失败:','\x20\x20保留:\x20','🧠\x20续写记忆设置:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal\x20character-selection-modal\x22\x20id=\x22character-selection-modal\x22\x20style=\x22display:\x20flex;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22modal-title\x22>','selected-mention-avatar','🗑️\x20[线下重新生成]\x20立即删除旧消息和相关数据...','所有角色都已经在群里了','请先发送一条消息，然后点击此按钮来获取AI回复','没有选择文件或files为空','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22appointment-item\x20','currentSMSCharacter','表情包库更新成功','❌\x20全局记忆数据库初始化失败:','删除操作正在进行中，请稍候...','，但不要试图猜测匿名用户的真实身份','已悔棋两步','.dock-app[onclick=\x22showApp(\x27memory-viewer-screen\x27)\x22]\x20.dock-app-icon','custom-item-description','backgroundChatEnabled','#2d3748','正常聊天中','✅\x20日记已保存到数据库','🔔\x20视频通话开场白AI回复解析结果:','短信互动','\x0a\x0a**围绕新闻事件的帖子类型建议：**\x0a-\x20直接讨论事件：\x22刚看到新闻，这件事太震惊了...\x22\x0a-\x20个人观点分享：\x22我觉得这件事...\x22\x0a-\x20相关经历：\x22我之前也遇到过类似的...\x22\x0a-\x20后续关注：\x22有人知道后续发展吗？\x22\x0a-\x20情感反应：\x22看到这个新闻心情很复杂...\x22\x0a-\x20影响分析：\x22这对我们的影响可能是...\x22','\x20回复用户评论:\x20\x22','现在几号','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22font-weight:\x20600;\x20margin-bottom:\x208px;\x22>💡\x20提示</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-details-item\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22payment-details-item-name\x22>','🔥\x20[转账处理]\x20转账状态已保存到数据库','offline_summary_','的私人日记内容：','forum-screen','编辑世界书失败:','config-name-input','sms','🔍\x20[群聊身份]\x20未找到成员:','🔍\x20[多模态调试]\x20是表情包消息:','你是一个专业的DM，保持中性的态度。','\x20条动态','event_','isArray','雪尼尔','anniversary-shared','#edit-offline-message-content','bubbleWidth','charging','✅\x20清理后重新保存成功','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22margin-top:\x2015px;\x20padding-top:\x2015px;\x20border-top:\x201px\x20solid\x20#eee;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22group-option\x22\x20onclick=\x22hideMoveCharacterModal();\x20enterMultiSelectMode(\x27','---\x20[论坛收藏]\x20功能触发\x20---','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22footprint-location\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-map-marker-alt\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','❌\x20重新加载失败:\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22memory-share-modal\x22\x20class=\x22modal\x20phone-modal\x22\x20style=\x22display:\x20block;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22modal-title\x22>记忆共享设置</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-close\x22\x20onclick=\x22hideMemoryShareSettings()\x22>&times;</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22setting-section\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4>选择要共享记忆的群聊</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22checkbox-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','firstChild','部分可见','保存设置失败',')\x20可以看到\x20','🗑️\x20已删除角色\x20','✅\x20[线下最后消息重新生成]\x20新消息已保存到数据库','（清空）','[系统：无法更换头像，没有找到可用的图片]','🚨\x20[API请求监控]\x20请求头:','\x0a\x0a⚠️\x20重要提醒：\x0a-\x20必须严格按照角色的年龄、身份、生活环境来生成照片/视频类型\x0a-\x20如果角色是学生，照片应该是校园生活、学习、朋友聚会等，不要有工作场景\x0a-\x20如果角色是上班族，可以有工作相关照片\x0a-\x20照片场景要符合角色的实际生活状态和经济条件\x0a\x0a要求：\x0a1.\x20生成9张照片/视频的描述（可以包含视频）\x0a2.\x20内容要严格符合角色的生活背景、兴趣爱好和真实社交圈\x0a3.\x20每个照片/视频要有标题、拍摄时间和详细描述\x0a4.\x20类型要符合角色身份（学生：校园照、学习照、朋友合照、生活照等；上班族：可包含工作照）\x0a5.\x20描述要生动有趣，体现角色的个性，但必须真实可信\x0a6.\x20参考角色的人设、世界书设定、记忆和最近聊天记录来生成符合角色世界观的照片/视频\x0a7.\x20绝对不要生成与角色设定冲突的内容\x0a\x0a请按以下JSON格式返回：\x0a{\x0a\x20\x20\x22media\x22:\x20[\x0a\x20\x20\x20\x20{\x0a\x20\x20\x20\x20\x20\x20\x22title\x22:\x20\x22照片/视频标题\x22,\x0a\x20\x20\x20\x20\x20\x20\x22type\x22:\x20\x22photo\x22,\x20//\x20或\x20\x22video\x22\x0a\x20\x20\x20\x20\x20\x20\x22time\x22:\x20\x22拍摄时间\x22,\x0a\x20\x20\x20\x20\x20\x20\x22duration\x22:\x20\x220:15\x22,\x20//\x20仅视频需要，格式如\x20\x220:15\x22\x20表示15秒\x0a\x20\x20\x20\x20\x20\x20\x22description\x22:\x20\x22详细描述这张照片/视频的内容、背景故事、当时的心情等\x22\x0a\x20\x20\x20\x20}\x0a\x20\x20]\x0a}\x0a\x0a注意：请确保返回的是有效的JSON格式，不要包含其他文字说明。','就在市中心的购物中心三楼','\x20个对话\x0a-\x20联系人备份:\x20','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22reply-reference-message\x22>','动态列表不为空，进行增量更新','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-edit\x22></i>\x20编辑\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x20的评论...','确定要继续吗？\x0a\x0a','🧹\x20已清理\x20','\x27)\x22\x20title=\x22戳一戳\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','offline-user-italic-text-color','🔍\x20通过messageId找到\x20','红富士','亲爱的小友','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22multiselect-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-check-circle\x20multiselect-icon\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22multiselect-text\x22>已选择\x20','-\x20(最近发生)\x20','群聊成员:\x20','<span\x20class=\x22italic-gray\x22>','论坛世界书','memory-mount-list','获取核心记忆失败:','确定要删除分组\x22','margin','\x22\x20onclick=\x22toggleSelection(this)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22selection-item-icon\x22><i\x20class=\x22fas\x20fa-book-open\x22></i></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22selection-item-name\x22>','进口猕猴桃','.selection-count','selectedCharacterId','保存角色时发生错误:\x20','voice_message','anniversary-type','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22\x22>请选择模型...</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<optgroup\x20label=\x22Llama系列\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22meta-llama/Llama-2-7b-chat-hf\x22>Llama-2-7b-chat-hf</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22meta-llama/Llama-2-13b-chat-hf\x22>Llama-2-13b-chat-hf</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22meta-llama/Meta-Llama-3-8B-Instruct\x22>Meta-Llama-3-8B-Instruct</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</optgroup>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<optgroup\x20label=\x22对话模型\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22microsoft/DialoGPT-large\x22>DialoGPT-large</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22microsoft/DialoGPT-medium\x22>DialoGPT-medium</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22facebook/blenderbot-400M-distill\x22>BlenderBot-400M</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</optgroup>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<optgroup\x20label=\x22通用模型\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22mistralai/Mistral-7B-Instruct-v0.1\x22>Mistral-7B-Instruct</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22teknium/OpenHermes-2.5-Mistral-7B\x22>OpenHermes-2.5-Mistral-7B</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</optgroup>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<optgroup\x20label=\x22自定义\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22custom\x22>手动输入模型名称...</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</optgroup>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22transfer-message-container\x20sent\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22transfer-card\x20','回复了','条未读消息\x22>','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22character-selection-grid\x22\x20id=\x22character-selection-grid\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22forwarded-message-card\x22\x20data-message-id=\x22','8px\x200','清理失败:\x20','🔄\x20[线下最后消息重新生成]\x20检测到正常回复消息，基于用户消息重新生成','hotness','图片文件过大，请选择小于5MB的图片','===\x20更新现有角色\x20===','zh-CN','12个','auth-overlay','html','照片分享消息单条保存失败，回退到批量保存:','\x20的好友申请被拒绝，启动后续行动...','顶部应用栏背景','游戏已保存并退出','api_','ai-heartrate-enabled','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20class=\x22memory-edit-textarea\x22\x20style=\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x20calc(100%\x20-\x2016px);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20max-width:\x20500px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20min-height:\x2080px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x202px\x20solid\x20#007AFF;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2013px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20line-height:\x201.5;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20resize:\x20vertical;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20inherit;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#f8f9fa;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20box-sizing:\x20border-box;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22>','📚\x20分页加载历史线下消息:\x20新加载','保存角色分组失败:','title','savedApiConfigs','\x20的关系:','license-input','clientX','\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-display:\x20swap;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x22创建成功！','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-preview\x22>','subtle','character-video-avatar-preview','任天堂','\x22\x20onclick=\x22toggleAnniversaryItem(event,\x20\x27','请先选择要转发的消息','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22','应用图标','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x20edit-message-modal\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3>编辑消息</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-close\x22\x20onclick=\x22hideEditMessageModal()\x22>&times;</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22edit-message-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22message-sender\x22>','清理localStorage缓存失败:','blue','\x20没有自定义主题','thought_','💡\x20提示：HuggingFace\x20Space可能不支持自动获取模型列表，建议手动输入模型名称','song','过往日记','AI尝试使用不存在的表情包:','\x0a\x0a##\x20特殊情况说明\x0a你在聊天应用中拉黑了用户，但用户现在通过短信联系你。你可能会：\x0a-\x20保持之前的态度或有所软化\x0a-\x20根据用户的消息内容决定是否回应\x0a-\x20表现出符合你性格的反应\x0a请根据你的性格和拉黑的原因来回应。','\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20style=\x22width:\x20100%;\x20margin-top:\x2010px;\x20min-height:\x20120px;\x20resize:\x20vertical;\x20font-family:\x20inherit;\x20line-height:\x201.5;\x22>','✅\x20从数据库加载该角色的最新设置成功\x20(回退模式)','song_comment','衣物消毒','🔇\x20已停止音效:\x20','我帮你下单','testPublisherReply','机械表','showing-products','轻量级备份_','[用户发送了表情包，请直接回应对话内容，不要评价表情包本身]','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-btn\x20modal-cancel\x22\x20onclick=\x22hideEditMessageModal()\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-btn\x20modal-confirm\x22\x20onclick=\x22saveEditedMessage(\x27','📱\x20调整输入框字体大小为16px，防止iOS缩放','.game-exit-modal','永久记忆','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','设置恢复完成，当前设置:','黑子●','\x0a\x0a**','字体CSS加载失败，请检查链接是否正确','blacklist','\x27)\x22\x20style=\x22background:\x20none;\x20border:\x20none;\x20color:\x20#ff6b6b;\x20cursor:\x20pointer;\x20padding:\x202px\x206px;\x20border-radius:\x204px;\x20font-size:\x2012px;\x20transition:\x20all\x200.2s\x20ease;\x22\x20onmouseover=\x22this.style.background=\x27rgba(255,107,107,0.1)\x27\x22\x20onmouseout=\x22this.style.background=\x27none\x27\x22>🗑️</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22font-size:\x2012px;\x20color:\x20#666;\x20margin-bottom:\x204px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>🌐\x20','pow','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22location-card-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20width=\x2214\x22\x20height=\x2214\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20style=\x22display:\x20inline-block;\x20margin-right:\x206px;\x20vertical-align:\x20middle;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M12\x202C8.13\x202\x205\x205.13\x205\x209c0\x205.25\x207\x2013\x207\x2013s7-7.75\x207-13c0-3.87-3.13-7-7-7zm0\x209.5c-1.38\x200-2.5-1.12-2.5-2.5s1.12-2.5\x202.5-2.5\x202.5\x201.12\x202.5\x202.5-1.12\x202.5-2.5\x202.5z\x22\x20fill=\x22#1890ff\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','.moment-action-btn[onclick*=\x22toggleMomentLike\x22]','[表情包：','我帮你购买','30天记忆','角色信息：\x0a姓名：','self_pay_self','图片上传成功！','🔍\x20[调试]\x20记忆类型不匹配，期望:\x20storyline_summary，实际:','_paused','.paper-option','originalTitle','红豆沙冰','颜色已重置为默认','🧪\x20开始测试跨应用记忆共享功能...','42-43','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20@font-face\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20\x27','\x20个孤立的表情包需要重新分配到表情包库。\x0a\x0a可用的表情包库：\x0a','\x20条)\x0a\x0a为避免导出失败，强烈建议使用轻量级导出。','date','🔥\x20[页面卸载]\x20从sessionStorage恢复并标记聊天为已读:','。建议刷新页面以确保所有功能正常显示','\x20回复\x20','🔍\x20[引用回复-主分支]\x20数字格式查找结果:','🔍\x20[身份识别]\x20是否为用户动态:\x20','莫代尔','短信消息','条\x0a\x0a⚠️\x20孤立数据\x20(可能丢失的记忆):\x0a\x20\x20•\x20孤立核心记忆:\x20','成功删除\x20','找不到该剧情总结','modal-play-btn','theme-item-configured','color-picker-title','batch-url-input','bubble-preview','translateY(20px)','[userId+postId]','保存壁纸失败，请重试','•\x20删除音乐封面:\x20','description','请基于以上信息，以','anniversary-background-upload','生成角色视频通话开场白失败:','后台发动态失败:','删除记忆失败:','🔥\x20永久记忆模式，跳过自动清理','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22margin:\x200\x200\x2015px\x200;\x20color:\x20#ff6600;\x20font-size:\x2018px;\x20font-weight:\x20600;\x22\x20id=\x22current-price\x22>¥','，歌词预览:\x20','📷\x20图片消息','\x0a\x0a【游戏进展】：\x0a-\x20已提问','🔍\x20[AI处理调试]\x20userMessage完整结构:','生成今日摘要失败:','✅\x20当前打开的足迹页面已更新','\x20个新足迹','\x20的记忆质量...','browser-url','✅\x20足迹数据格式正确:','正在优化论坛存储，请稍候...','中长款','.chat-header-multiselect-actions','\x0a\x0a🚨\x20**【重要状态提醒】**\x20🚨\x0a你目前被用户拉黑了！这个状态会持续影响你的行为和情绪。\x0a','http://','个,\x20图片:','🚨\x20[DEBUG]\x20triggerSmartReply\x20被调用！','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','call-message\x20','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-time\x22>','短信AI回复失败:','<i\x20class=\x22fas\x20fa-trash\x22></i>','100','maxMemory','.current-lyric-display','动态存储优化失败','使用默认生成的头像','已清空所有','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22load-more-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-chevron-up\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>查看历史消息\x20(','📊\x20重回后时间线记录数量:\x20','removeItem','新建全局设定','.app-item-selector','🗑️\x20已清理消息的时间线记录:\x20','footprints_auto_update','\x20个角色分组','成功，长度:\x20','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-request-countdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20剩余支付时间\x20<span\x20class=\x22payment-request-countdown-time\x22\x20id=\x22countdown-','你是一个客观的记录员，专门生成简洁的记忆摘要。请直接输出摘要文本，不要使用JSON格式或聊天回复格式。','删除消息失败','.chat-tab','...你应该记得吧。','📖\x20生成的完整剧情总结:','的性格特征\x0a5.\x20**生活要真实丰富**\x20-\x20包括工作、休息、娱乐、社交、私密时光等各个方面\x0a6.\x20**情绪有变化**\x20-\x20心情要有自然的起伏和变化\x0a7.\x20**不回避任何活动**\x20-\x20可以是睡觉、工作、娱乐、夜生活、私密活动等任何符合角色的行为\x0a\x0a⚠️\x20足迹描述风格要求：\x0a-\x20每条足迹描述必须在30字以内\x0a-\x20使用客观、简洁的记录风格，类似日志\x0a-\x20避免过度文艺化的描述和场景渲染\x0a-\x20直接记录行为事实，不要过多情感描述\x0a-\x20正确示例：\x22正在与她聊天，告诉她自己会一直等下去\x22、\x22没什么胃口，随意吃了点午饭\x22\x0a-\x20错误示例：\x22走廊的声控灯熄灭，周围陷入一片黑暗和寂静。他一动不动，像一座雕塑\x22\x0a\x0a重要提醒：\x0a-\x20角色有自己的完整生活，不完全依赖用户互动\x0a-\x20每个时间段都应该有合理的活动安排，无论是什么时间\x0a-\x20','✏️\x20[调试]\x20记忆类型不匹配，期望:\x20storyline_summary，实际:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-avatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22','获取音效设置失败\x20(','清理后音乐播放器将重置为空状态。\x0a\x0a','opacity\x200.3s\x20cubic-bezier(0.34,\x201.56,\x200.64,\x201),\x20transform\x200.3s\x20cubic-bezier(0.34,\x201.56,\x200.64,\x201)','\x22\x20alt=\x22','🔍\x20可选择的分组:','\x20个短信对话吗？\x0a\x0a此操作将同时删除：\x0a•\x20所有短信记录\x0a•\x20相关的时间线记忆\x0a•\x20相关的情景记忆\x0a•\x20相关的核心记忆\x0a\x0a此操作不可恢复！','startsWith','\x27)\x22\x20title=\x22移除主题\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-trash\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','#api-chat-screen\x20.app-status-bar,\x20#api-chat-screen\x20.app-header','turtle-soup-story-content','🗑️\x20清理旧缓存:','\x20存在负面关系记忆，不会点赞','ai-bubble-color',',\x20中性=','✅\x20后台足迹更新完成','stylesheet','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-divider\x22></div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-items\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22items-header\x22>商品清单</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','❌\x20[转发消息处理]\x20转发消息为空或不存在','请先选择要删除的表情包','\x22\x20alt=\x22你\x22\x20onerror=\x22this.style.display=\x27none\x27;\x20this.nextElementSibling.style.display=\x27flex\x27;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-avatar-fallback\x22\x20style=\x22display:\x20none;\x22>你</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','custom-prompt-modal','video-call-timer','📍\x20','\x20条AI消息','system_notification','create-post-modal','schedule-times-modal-container','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22song-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22song-title\x22>','.anniversary-widget-content','请输入字体URL','lrc','\x20的所有短信记录和记忆','\x20条拉黑系统消息','api-chat-title','/*\x20轻柔的阴影和边框\x20*/\x0a#offline-mode-overlay\x20.offline-message-content\x20{\x0a\x20\x20\x20\x20box-shadow:\x200\x201px\x203px\x20rgba(0,0,0,0.12)\x20!important;\x0a\x20\x20\x20\x20border:\x201px\x20solid\x20#e0e0e0\x20!important;\x0a}','第二代','。用户在游戏中对你说：\x22','连衣裙','meeting','then','你拒绝了好友申请','我来记录','\x27)\x22>','bubble-tail-js','保存失败：找不到输入框','表情包','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22preview-url\x22>','setDate','chat_','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22character-bio\x22>','聊天记录分析失败:\x20','\x20\x20-\x20聊天专用头像:','🔍\x20[sendSMSImage]\x20图片URL长度:','textareaId:','screenSize','舒芙蕾','Escape','globalCustomTheme','写了日记','角色专属音效已清除','--offline-ai-bubble-color','说起来，明天是','endTime','\x22\x20onerror=\x22this.style.display=\x27none\x27;\x20this.parentElement.style.background=\x27#f0f0f0\x27;\x20this.parentElement.innerHTML+=\x27<div\x20style=\x5c\x27display:flex;align-items:center;justify-content:center;height:100%;color:#999;font-size:12px;\x5c\x27>加载失败</div>\x27\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22remove-btn\x22\x20onclick=\x22removeEmojiFromLibrary(\x27','anniversary-user-avatar-preview','\x22的讨论','被拉黑角色:\x20','南信牛奶甜品','[\x22调用失败:\x20','lastElementChild','current-screen-size','📊\x20时间线样本:','🔥\x20[AI撤回]\x20处理撤回消息:','linkedWorldBookIds','刷新帖子失败:','API请求失败:\x20','群聊数据迁移完成:','px,\x20差值:\x20','\x20在当前上下文中没有情景记忆需要清除','未找到动态发布者角色:\x20','从localStorage加载失败:','完美！我带点小食和饮料','\x20字符','创建了特别的日子','shopping-cart-screen','image_url','\x20(原始输入:\x20','❌\x20群聊\x20','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22reply-action-btn\x22\x20onclick=\x22replyToComment(','backdropFilter','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22footprint-location\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-map-marker-alt\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','点赞失败','50片','getDate','✅\x20[内部删除]\x20已从数据库删除\x20','我付钱','保存单条短信消息失败:','设置静音模式失败','论坛参考的世界观设定\x20(世界书)','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22','✏️\x20[调试]\x20编辑模态框已添加到DOM，z-index:','更新世界书挂载显示：无当前聊天角色，跳过操作','对这个','\x20个活动','清除音效失败\x20(','🔥\x20[DEBUG]\x20处理第','午饭时间，大家可能在讨论食物、下午的安排、分享午餐照片等','剧情总结','16px','lyrics-mode','content-width-value','🔥\x20[callForumAPI]\x20API请求失败:','确定要移除\x20','未运行','📊\x20数据库中的聊天记录格式分析:','记忆已更新','头条新闻/世界线变动','.clock-style-option','，已下','图片加载超时','：\x22从那天开始...算是不一样了吧。\x22','统计角色\x20','DPI','请填写完整的歌曲信息或选择本地音乐文件','，描述为：','🚫\x20拉黑系统核心功能已加载','candidates','🎨\x20字体CSS加载失败:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22persona-item\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22persona-selection-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22persona-selection-name\x22>','已过期','发现孤立的记忆数据，是否尝试将它们关联到当前角色？\x0a\x0a注意：这可能会将其他角色的记忆错误关联，请谨慎操作。','1.6','表情包库挂载已关闭，用户只能使用个人表情包','找不到描述输入框','Chat','priority','sms-chat-','fas\x20fa-lock','<p\x20class=\x22text-center-gray\x22>该群聊暂无成员。请先在群聊信息中添加成员。</p>','🧹\x20压缩论坛回复头像数据...','群聊戳一戳回应保存失败:','⚠️\x20同步获取ID为\x20','🔧\x20跳过重复内容:\x20','game_memory_','#5856D6','佛系的','这个想法很有趣...','分组创建成功','appointment-custom-type','✅\x20[高效错误消息]\x20续写失败消息已单条保存到数据库','forumReplies','已经说了很多话了，先和','2024年2月28日\x2016:20','test_sms_','🔍\x20[群聊表情包-直接格式]\x20找到成员:','has-image','❌\x20角色\x20','📖\x20开始生成线下模式剧情总结...\x20(角色:\x20','avatar-upload','想起来，','\x20的日记时间显示:\x20','AI选歌失败:','找不到角色:','\x22不存在]','我给你下单','聊天设置界面已显示','time-awareness-enabled','✅\x20页面卸载前保存完成','•\x20你有','lastUpdateTime','my-bubble-color','正在为你随机选择一首歌曲',',\x20isGifEmoji:','🔧\x20[面具调试]\x20验证保存结果:','📱\x20多媒体消息','为角色\x20','论坛存储优化失败:\x20','💾\x20群聊背景设置已保存','🧹\x20已移除应用的自定义CSS样式','宝贝，记得按时吃饭哦','--custom-global-top-app-bar','===\x20所有角色数据\x20===','\x0a\x0a===\x20','pop','无法自动打开恢复界面:','✅\x20[手动拒绝转账]\x20系统消息已保存到数据库','\x0a\x0a用户刚刚将你从黑名单中移除，现在你们可以正常聊天了。请根据你的性格做出反应。你可以：\x0a1.\x20表达高兴或解脱的心情\x0a2.\x20询问为什么之前被拉黑\x0a3.\x20道歉或表示会改正\x0a4.\x20表现出符合你性格的态度（可能还在生气，也可能很开心等）\x0a5.\x20主动开启新的话题\x0a\x0a请用1-2句话表达你的反应，要符合你的性格设定：','聊天设置:\x20','-apple-system,\x20BlinkMacSystemFont,\x20\x22Segoe\x20UI\x22,\x20Roboto,\x20sans-serif','成功：总金额¥','toLowerCase','\x20条核心记忆','✅\x20[高效表情包]\x20表情包消息已保存到数据库','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-item\x20hot\x22\x20onclick=\x22showPostView(','播放失败:','正在生成导出文件...','sms-persona-selector-body','friend-request-message','bubble-padding','🔄\x20保存操作失败，重试\x20','更新日记设置失败:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22quote-block\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22quote-sender\x22>','🔍\x20[startChat]\x20跳过标题更新，AI已修改昵称','gomoku-chat-messages',',\x20应记录:\x20','状态检查失败:\x20','28寸','你是一个论坛内容生成AI，请严格按照用户的指令和格式要求进行输出。','内存中的群聊数据:',')\x20切换收藏状态','data-has-chat-top-bg','加载角色分组失败:','正在思考...','blur','自定义背景设置成功','电子体温计','\x20条相关数据','isHistorical','未启用','80B','无背光','昵称设置已保存','转账\x20','userName','showPhoneRegenerateButton:\x20regenerateFunction\x20不是一个函数','_offline_continue_','\x22\x0a\x0a请用自然的口语方式回复，就像真实的电话对话一样：\x0a-\x20直接说话，不要任何描述性文字\x0a-\x20保持自然的语音对话风格\x0a-\x20符合你的性格设定\x0a-\x20可以表达情感、询问问题、分享想法\x0a\x0a请只回复对话内容，不要JSON格式，不要其他格式：','\x20中的消息发送者ID\x20','匿名回复...','太好了！电影之夜开始！🍿🎬','处理本地音乐文件失败，请重试','，你的好友申请已经被用户拒绝了','🚫\x20[全局初始化]\x20','\x0a🎭\x20**表现指导**：\x0a-\x20保持适度的礼貌和距离感\x0a-\x20不过分亲密也不冷淡\x0a-\x20符合这种关系的正常社交互动','正在通话中...','translateX(-50%)\x20translateY(10px)','数据清理保存失败，回退到全量保存:','🎭剧情总结:\x20','找到了input元素，准备触发点击','surrender','请输入您的昵称:','current-memory-mount','custom-background','\x22\x20isPersonal:\x20','🔥\x20[loadMoreComments]\x20找到数组格式:','🔥\x20正在处理撤回，跳过重复撤回请求','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22custom-prompt-modal\x22\x20class=\x22modal\x22\x20style=\x22display:\x20flex;\x20z-index:\x2010000;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22\x20style=\x22max-width:\x20','appointment-character','🚫\x20[定时器设置]\x20角色不存在:\x20','fetch-models-btn','fill','edit-group-modal','❌\x20角色重建失败:\x20','❌\x20加载保存的主题失败:','✅\x20从数据库加载通用格式设置成功','vision','110cm','&id,\x20lastUsed','，你的人设如下：','面包新语','\x0a\x0a🤝\x20**关系状态**：你与','decoration-none','floor','shiftKey','\x20数据完整性检查失败，拒绝保存','🔄\x20执行批量保存，队列中有\x20','\x20记录数:\x20','🔄\x20使用数据库缓存的心声内容','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22memory-item-date\x22>','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-avatar\x22\x20style=\x22background-color:\x20','🔍\x20[processAIReply]\x20所有消息数量:','blocked','block_user','\x20个角色,\x20','&id,\x20groupId,\x20characterId','senderId:','custom-paper','character-selection-modal','🗑️\x20[内部删除]\x20开始删除线下模式消息:','\x22**，请优先使用这个昵称。','total','\x0a作者:\x20','_proactive_','表情包库挂载已启用，但未选择任何库','她是双胞胎姐妹，镜子对面就是她的双胞胎妹妹的房间。','请选择音频文件','\x20的时间线记录:','检查头像URL是否在用户图片中:','chat-content','onclick=\x22showImagePreview(\x27','\x0a\x0a请根据你的性格特点，作为专业的海龟汤DM给出简洁明确的回答（不超过20字）。如果问题很接近真相，可以给予适当的提示和鼓励。\x0a\x0a重要：请直接输出纯文本回答，不要使用JSON格式或数组格式。','全局设置','》评论：','🔥\x20[AI撤回]\x20未找到要撤回的消息，创建临时消息','transfer-amount','喜欢你','&id,\x20characterId,\x20category,\x20content,\x20timestamp','太贵了','跳过无效的localStorage键:\x20','confirm-group-persona-btn','\x0a\x0a##\x20对话内容\x0a','forumFavorites','setAttribute','category','（我）','#f44336','\x22导入成功！包含\x20','对方已收款','原动态：','\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-avatar\x22\x20style=\x22background-color:\x20','schedule-time-item','character-','已收款','核心记忆','🚨\x20[DEBUG]\x20processAIReply\x20被调用！','payment-request-user-card','回复点赞:\x20','back-btn-preview','moment_like',';\x20position:\x20relative;\x20padding:\x20','enableDynamicMemory','群聊消息现在存储在chatMessages表中','不锈钢表带','🔧\x20ID为\x20','\x0a角色ID：','✅\x20音效加载成功:\x20','\x20条。核心记忆将永久保存，如需清理请手动管理。','很紧凑','分钟前','canvas','日记生成完成','\x20不存在','❌\x20[主动聊天回退]\x20全量保存也失败:','❌\x20序列化失败:','不付款','<div\x20class=\x22message-status-indicator\x20blocked\x22\x20title=\x22已拉黑\x22><i\x20class=\x22fas\x20fa-ban\x22></i></div>','你已退回\x20¥','🔔\x20[推送通知]\x20添加通知到队列，当前队列长度:','删除点赞：',',\x20是AI角色:\x20','请输入位置名称','\x20条短信吗？这将同时删除相关的时间线记忆。','\x22\x20onclick=\x22selectGame(\x27','isRecalled','15ml','\x20发送了一张图片]','✅\x20所有数据已清空，包括角色、聊天记录、群聊、动态、论坛、音乐、面具、世界书等所有应用数据','抱歉，AI回复内容为空或格式异常','photo','找不到api-chat-settings-screen元素','星期二','起始日','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-wave\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-duration\x22>','心情变化','13px','\x20吗？','未发现任何角色的聊天记录','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','🔄\x20已重新应用默认颜色设置','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-option-icon\x22\x20style=\x22background-color:\x20','欢迎来到海龟汤推理游戏！我是你们的游戏主持人。','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','offline-loading-indicator','无法显示紧急恢复界面:','CustomDiaryFont','🔧\x20错误恢复：为','i.postimg.cc','诺和诺德','检查摘要生成失败:','.photo-badge',']\x20和\x20','提醒你一下，','🔧\x20[自动修复]\x20检查并修复损坏的消息...','✅\x20[设置更改]\x20','call-record-message',',\x20删除了\x20','❌\x20更新定时发布设置失败:','\x20评论说：\x22','\x22指代角色\x0a-\x20不要使用\x22我\x22、\x22你\x22等第一、第二人称\x0a-\x20例如：\x22用户向','++id,\x20momentId,\x20mentionedCharacterId,\x20timestamp,\x20isRead','hideAvatars','--my-bubble-color','正在导入\x20','.persona-selection-item','gomoku-cell','full-lyrics-display','颜色已保存到预存','\x20<span\x20class=\x22group-member-count\x22>(','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22group-manage-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-cogs\x20group-manage-icon\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22group-manage-text\x22>分组管理模式</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22group-manage-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22showCreateGroupModal()\x22\x20class=\x22multiselect-btn\x20create-btn\x22\x20title=\x22新建分组\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-plus\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>新建</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22exitGroupManageMode()\x22\x20class=\x22multiselect-btn\x20done-btn\x22\x20title=\x22完成管理\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-check\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>完成</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','1TB','qwen2-vl','.moment-avatar\x20img','🎉\x20恭喜你获胜了！','🛒\x20[AI代付请求]\x20AI尝试发起代付请求，已忽略:','statusText','个对话、','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-character-item\x22\x20onclick=\x22selectSMSCharacter(\x27','创建新论坛','input[name=\x22offline-bubble-width\x22]:checked','visible','message-tab','无法获取设置：characterId\x20和\x20currentChatCharacter\x20都未定义，返回空设置','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','statusUpdateFrequency','recall','川西坝子','❌\x20失败！chatapp无法读取到短信事件','群聊消息:\x20','friend-request-modal','\x20分钟','背景图:\x20已设置','\x20个旧的情景记忆','coreMemory','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-chevron-','offline-history-modal','第一次','羽绒服','gemini-2.0-flash-exp','#offline-mode-overlay\x20.offline-message-content','pinned-appointment-section','50cm','recalled_message','head','\x20的聊天设置失败:','✈️\x20旅行计划','pinned-anniversary-card','🔍\x20[parseAiResponse-第二处]\x20AI主动戳一戳:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22multiselect-btn\x20pin-btn\x22\x20data-action=\x22pin\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-thumbtack\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>置顶</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22multiselect-btn\x20delete-btn\x22\x20data-action=\x22delete\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-trash\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>删除</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22multiselect-btn\x20cancel-btn\x22\x20data-action=\x22cancel\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-times\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>取消</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','🧠\x20续写模式已获取全局记忆上下文，总长度:','transfer-confirm-modal','双肩包','🚨\x20[净化器-调试]\x20这个数组包含\x20','清理时间线记录失败:','🔍\x20[转发卡片点击]\x20当前聊天记录数量:','text','获取状态更新频率设置失败，使用默认值:','✅\x20AI随机选择歌曲：','🔍\x20[callChatAPI]\x20处理消息:','selected-count','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22character-selection-bio\x22>','customBubbleCSS','\x0a\x0a##\x20论坛背景:\x0a世界观:\x20','群聊:\x20','处理论坛AI回复失败:','click','🛒\x20[代付响应处理]\x20AI拒绝代付，更新状态为已拒绝','\x20后台写日记完成！内容:\x20','生成剧情总结失败:','\x22\x20onclick=\x22showImage(\x27','offline_history_','核心记忆库','lastUpdate','在动态中回复了其他角色','timings','option','行歌词','❌\x20没有当前角色','修改了自己的昵称','🎵\x20音乐播放器已完全关闭','❌\x20保存\x20','📱\x20[安卓修复]\x20检测到安卓设备，先失焦输入框','论坛帖子清理：准备删除\x20','<div\x20class=\x22bubble-wrapper\x22>','拉黑系统数据加载失败:','<svg\x20width=\x2250\x22\x20height=\x2250\x22\x20xmlns=\x22http://www.w3.org/2000/svg\x22><rect\x20width=\x2250\x22\x20height=\x2250\x22\x20fill=\x22#f0f0f0\x22/><circle\x20cx=\x2225\x22\x20cy=\x2220\x22\x20r=\x228\x22\x20fill=\x22#999\x22/><circle\x20cx=\x2225\x22\x20cy=\x2240\x22\x20r=\x2212\x22\x20fill=\x22#999\x22/></svg>','请至少选择一个选项','fillStyle','🔍\x20[第四处-AI图片]\x20未找到群成员:','不出钱','groupChatStates','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>消息数:\x20','判断角色点赞偏好失败:','用户：','✅\x20群公告保存成功','删除短信相关时间线记录失败:','删除消息:','===\x20开始保存角色\x20===','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22text-align:\x20center;\x20color:\x20#ff3b30;\x20padding:\x2020px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-exclamation-triangle\x22\x20style=\x22font-size:\x2024px;\x20margin-bottom:\x2010px;\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>生成心声失败</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22font-size:\x2012px;\x20color:\x20#666;\x20margin-top:\x2010px;\x22>','\x20在动态\x20','DOM状态:','medium','<span\x20class=\x22moment-visibility-indicator\x22\x20title=\x22','\x22\x20创建成功！','其他数据:\x20','\x20未与群聊\x20','🔧\x20[世界书列表调试]\x20发现无效的世界书ID:\x20','marginBottom','角色:\x20','🔍\x20[callChatAPI]\x20元素','touchmove','⚡\x20导入中...','\x20个角色的旧数据，保存了\x20','image/png','send-btn-preview',')，跳过重复项:','px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-message\x22\x20onclick=\x22toggleVoiceText(this)\x22\x20data-text=\x22','我来支付','🔥\x20[短信图片]\x20用户图片消息发送成功','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20rgba(255,\x20255,\x20255,\x200.9)\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20text-shadow:\x200\x201px\x203px\x20rgba(0,\x200,\x200,\x200.8)\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','🧹\x20清理了\x20','mention-modal','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22transfer-title\x22>','emojis','主动发动态测试失败:\x20','maxTouchPoints','收下了','（人设：','<i\x20class=\x22fas\x20fa-check\x20check-icon-white\x22></i>','删除歌曲失败:','anniversaryDebug','isCallMessage','状态显示开关被点击:','群聊数据无效:','主动聊天消息批量保存失败，回退到全量保存:','，只添加文本描述','```json','短信联系人:\x20','.post-item','apply-icon-btn','返回按钮','AI主动发送短信','游戏结束，结果：','\x20条日记吗？此操作不可撤销。','全局添加按钮样式已上传','🔍\x20[删除匹配]\x20要删除的消息ID:','\x20/\x20',']\x20情景记忆:\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-text\x22>','🔥\x20[转账处理]\x20未检测到明确指令，使用关键词匹配','###\x20关于\x20','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22friend-request-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','个选项','更新约定状态失败:','口水鸡','repeatMode','forwarded-view-content','##\x20**当前情景:**','🎮\x20继续之前的游戏...','向你转账了\x20¥','深层洁净','✅\x20API连接测试成功！','0,\x200,\x200','我为你购买','❌\x20加载角色线下模式预设失败:','background-interaction-enabled','.offline-preview-area\x20.offline-message','bubble-opacity','\x20移出群聊吗？','好神秘哦...','礼盒装','🧹\x20清理后文本:','当前设置状态:','pinned-appointment-card','当前显示聊天头像（可能被角色更换过）','看不见','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x20height:\x20100%;\x20color:\x20white;\x20font-size:\x2012px;\x22><i\x20class=\x22fas\x20fa-video-slash\x22></i></div>','经典推理类型，注重逻辑推理和细节观察','group-name-display','成功加载','联系人ID列表:','2.0m宽','马桶刷','\x20的重复时间线记录...','querySelectorAll','[续写失败:\x20','当前对话使用的身份：','亲密朋友','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','条\x20(总库存:\x20','注意：大文件在页面刷新后需要重新添加','incomingCall','[data-action]','✅\x20测试记录添加成功','data-has-custom-global-','<i\x20class=\x22fas\x20fa-check\x22></i>','⚠️\x20[updateChatHeader]\x20没有当前聊天角色，跳过更新','[用户发起了代付请求','请先选择要删除的角色','牛奶\x20-\x202盒\x0a面包\x20-\x201袋全麦面包\x0a鸡蛋\x20-\x201打\x0a苹果\x20-\x205个红富士\x0a香蕉\x20-\x201串\x0a酸奶\x20-\x204杯\x0a胡萝卜\x20-\x20500g\x0a西红柿\x20-\x203个\x0a洗发水\x20-\x201瓶\x0a牙膏\x20-\x201支\x0a\x0a记得去超市的时候带购物袋，环保又实用！','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22empty-history\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-history\x22\x20style=\x22font-size:\x2048px;\x20color:\x20#ccc;\x20margin-bottom:\x2015px;\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>还没有线下模式聊天记录</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22font-size:\x2012px;\x20color:\x20#999;\x22>完成线下剧情对话后，选择\x22结束且不总结\x22或\x22结束并总结\x22，聊天记录会保存在这里</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','获取过往日记失败:','\x20条消息\x20|\x20','设置角色专属音效失败\x20(','[线上]','🔄\x20IndexedDB中无数据，尝试从localStorage迁移...','emoji-library-list','图片URL','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22custom-confirm-message\x22>','⚠️\x20检测到有聊天记录但无联系人，可能是数据不一致，尝试从聊天记录恢复联系人','emoji-library-import','px,\x20键盘状态:\x20','img_','的对话...</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','/3，将在2-5秒后触发回复','没有找到AI回复可以重新生成','transfer-recipient','values','取消了\x20','persona-switch-list','获取中...','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-meta\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22post-author\x22>','找不到视频通话输入框元素','group_chat','offline-custom-style-style','#007AFF','.offline-message-menu','fade-out','data-original-content','cursor','memory-character-select','✅\x20[高效转发]\x20转发消息已保存到数据库','20个','flex','\x27,\x20false,\x20\x27','sort','⏸️\x20[全局初始化]\x20','\x27)\x22\x20title=\x22回复\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22far\x20fa-comment\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22reply-action-btn\x20delete-btn\x22\x20onclick=\x22deleteReply(','请帮我支付这个订单，谢谢！','confirm-selection-btn','4TB','>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22game-button-icon\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22','<div\x20class=\x22transfer-status\x22>','song-url','settings-screen','保存提醒消息失败:','消息已编辑:\x20\x22','\x20设置了后台发动态定时器，间隔:\x20','清理音频对象后','.woff','不锈钢','personas','background_task','🔍\x20开始浏览器兼容性检查...','成功恢复\x20','设置已保存','appIcons','✅\x20数据同步检查完成！\x0a\x0a所有角色的数据库与内存数据已保持一致，\x0a没有发现需要修复的问题。','🔍\x20[群聊转账修复]\x20创建转账消息:','\x0a\x0a##\x20短信对话历史\x0a','dataset','unblocked','EPISODIC_MEMORY_IMPORTANCE_THRESHOLD','⚠️\x20没有活跃的后台定时器','255,\x20255,\x200','down','化妆包','global-memory-modal','.app-screen:not([style*=\x22display:\x20none\x22])','moment-images-grid','✅\x20背景样式已应用:\x20','<i\x20class=\x22fas\x20fa-plus\x22></i>','hasNewContent','waiting','\x20条过期的情景记忆','手动重建的角色，共有\x20','✅\x20删除了\x20','\x22</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-text-content\x22>','还需要更多线索','#666666','🗑️\x20删除相关时间线记录:\x20','更新角色\x20','mount-item','load','phone-','🔍\x20[AI回复处理]\x20找到群成员ID:','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22selection-item-name\x22>','emoji','#000000','强力版','row','\x0a\x0a【核心记忆】以下是重要的记忆：\x0a','启动角色状态更新定时器，间隔:','homeFontColor','✅\x20[主动聊天回退]\x20全量保存成功','primaryKeys','===\x20群聊成员完整性检查\x20===','🔍\x20[引用回复-早期分支]\x20查找到的被引用消息:','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22history-record-meta\x22>','❌\x20数据库健康检查失败:','/models/','护眼灯','clearCharacterSound','🔥\x20[状态API]\x20调用失败:','🎵\x20播放角色专属音效:\x20','fontUrl','🚨\x20保存聊天设置到IndexedDB失败:','🔔\x20[推送通知]\x20当前聊天角色对象:','✅\x20数据库重新创建并打开成功','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','</span>:\x20','🔧\x20[regenerateLastResponse-2]\x20检测到特殊指令对象，跳过显示:','想要你','个\x20(存储在群聊对象中)\x0a\x0a','不想买','头像来源验证结果(续写):','贝尔金','正在为你选择歌曲：','状态:\x20','core_memories','测试后动态数量:\x20','.memory-delete-btn','custom-size-preview','当前：','保存失败，存储空间可能不足','✅\x20动态存储优化完成:','\x20条旧投票记录，保留最近\x20','无法在群聊中找到发送者信息:\x20','删除角色：','\x20的所有窗口隔离设置','background-repeat','\x0a\x0a💭\x20**与用户的聊天记忆**（影响你在动态中的心情和态度）：\x0a','_moments','[多媒体消息]','获取角色可见动态失败:','forumPosts','custom-bubble-css','products-container','dm_generated_','🚫\x20[评论生成]\x20','请输入商品名称','处理角色位置消息:','🔍\x20[引用回复-主分支]\x20未找到消息，尝试其他查找方式...','persona','global-top-app-bar-preview','⏰\x20角色\x20','🔥\x20[DEBUG]\x20processAIReply\x20收到解析后的消息:','🔗\x20群聊被私聊挂载记忆共享\x20-\x20优先读取私聊记忆','✅\x20角色\x20','19:33','扫地机器人','IndexedDB[','🔍\x20[主动聊天检查]\x20','incoming-video-call-avatar','decoration-','\x20评论了\x20','1.8m','角色专属音效已禁用','\x20\x20-\x20其他聊天\x20','font-size-slider','backgroundDiaryTime','45cm','HuggingFace\x20Space连接超时，可能需要先启动服务或检查网络连接。\x0a\x0a💡\x20建议：\x0a1.\x20检查HF\x20Space是否正在运行\x0a2.\x20尝试先手动访问该URL测试连接\x0a3.\x20如果服务不支持/models端点，请手动输入模型名称','-custom-type-group','状态API响应数据:','prompt','backup_story_','🔥\x20[转账界面更新]\x20更新转账卡片显示:','flat','选择壁纸:','10000','selected-location','买不起','data-character-id','\x20的回复正在处理中，跳过重复调用','\x22\x20到库\x20\x22','preset-checkbox-btn','无效的HTTP头像URL:','🆕\x20在顶部追加\x20','批量保存短信消息失败:','⚠️\x20从紧急备份恢复设置','✅\x20从数据库补充了壁纸数据','🔍\x20数据库中的消息记录:','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-countdown-label\x22>',')\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20style=\x22padding:\x208px\x2012px;\x20background:\x20#ff3b30;\x20color:\x20white;\x20border:\x20none;\x20border-radius:\x206px;\x20cursor:\x20pointer;\x22>×</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x20拒绝了你的好友申请','\x22的记忆共享','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22checkbox-item\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22checkbox\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20value=\x22','onCharacterBlocked','音效文件不能超过3MB','concat','：\x22一起做这件事一定很有趣。\x22','回合,\x20','never_expires','friendly','90%','🗑️\x20开始清空角色\x20','tables','mouseup','.moment-content','群聊状态数量:','past-diary-btn','https://generativelanguage.googleapis.com/v1beta','你被用户在聊天应用中拉黑了','🔍\x20[processAIReply多模态修复]\x20按顺序处理\x20(','mention-dropdown','\x20\x20📊\x20最近消息数:\x20','❌\x20查询核心记忆失败\x20-\x20characterId:\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20white\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20text-shadow:\x200\x202px\x206px\x20rgba(0,\x200,\x200,\x200.8)\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','settings',')\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22search-result-content\x22>','[\x22API响应解析失败\x22]','sourceType','群公告：点击设置群公告','\x20\x20📝\x20总消息数:\x20','\x20条日记记录','🔍\x20[AI回复处理]\x20创建的aiMessage:','🎨\x20应用设置时无法读取CSS规则，使用提取的名称','.app-battery-level','gomoku_saved_game','请先设置该音效','\x20头像失败:','JSON','❌\x20[表情包库]\x20保存失败:','🔍\x20[callChatAPI]\x20AI主动戳一戳:','🔥\x20[DEBUG]\x20parseAiResponse\x20返回处理后的消息数组:','分享消息单条保存失败，回退到批量保存:','•\x20回复头像:\x20','后台写日记已','个时间点','✅\x20清除了\x20','6袋装','🔄\x20数据库中无设置，尝试从localStorage迁移...','🔥\x20[状态API]\x20最终清理后的状态:','不愿意给钱','选择「确定」：继续使用现有对话\x0a','新鲜黄瓜','#turtle-soup-screen\x20.game-settings-button','🧹\x20压缩论坛帖子头像数据...','编辑人物','.hf.space','重新生成消息保存失败:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22anniversary-item-type\x20','rounded-square','\x20个纪念日的置顶状态','柔和阴影效果','Hello','🔄\x20检测到群聊，尝试恢复群聊状态:','条评论)','简约风格','XXL','reply_to','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x20评论了你的动态','：\x22我已经开始期待了。\x22','voice_call','🔥\x20[DEBUG]\x20开始处理数组，共','anniversary-form-title','videoAvatarSettings_','条转发消息</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x20的预设选择:\x20','星期一','名成员','选择图片来源','Authorization','CustomFont','🧹\x20[清理]\x20拉黑系统消息清理完成，已保存到数据库','\x20\x20-\x20\x22','worldbook-storage-size','background-image','✅\x20音效已清除:\x20','_continue_','anniversary-character-quote','📝\x20[约定时间线]\x20已记录约定创建事件到跨应用时间线','title-count','0.5','这就是今天的汤面：\x22','result','backgroundSize','<img\x20src=\x22','\x20个定时发布时间点','order','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','【错误】找不到收藏按钮的图标元素。','transform','你先行','，很高兴能和你通话。','调试失败:\x20','classic','customCSS','是否支持视觉:','预设\x22','AI返回的数组格式错误:\x20','发现无效头像的动态:\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','这个方向值得深入','🔧\x20[API设置]\x20已迁移localStorage设置到IndexedDB','above','global-bg-item','global-bottom-app-bar-input','activity','🚨\x20[DIAGNOSE]\x20最老的表情包:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22move-to-group-modal\x22\x20class=\x22modal\x22\x20style=\x22display:\x20flex;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-title\x22>移动\x20','[用户发送了表情包：','nickname','global-add-button-item','🚀\x20启动全局后台互动系统...','10片','🔧\x20[面具调试]\x20角色已存在对话，现有身份:','是否为短信:','Modal\x20should\x20be\x20shown','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','isGameMessage','🔧\x20[身份显示]\x20身份ID不存在:','clock-style-dropdown','[消息已删除]','closest','（待处理）','🔍\x20AI记忆提取原始响应:','🔍\x20[群聊消息]\x20处理群聊消息:','纪念日小组件已清除','[用户','找不到文件输入元素','personaId','清空数据失败:','个帖子','global-bg','isOpen','\x22吗？','🔗\x20检测到群聊活动，智能包含相关群聊记忆:','面具ID:','🔔\x20[推送通知]\x20切换到角色:','🔍\x20[转发消息]\x20发送给AI的内容:','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-wave\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-duration\x22>','角色ID:\x20','sms-normal-actions','\x0a\x0a最近的几条评论:\x0a','这将清理所有可能有问题的动态数据，确定继续吗？','\x0a\x0a##\x20提取标准\x0a\x0a###\x20核心记忆（importance\x20>=\x200.9）\x0a只有以下类型的信息才能成为核心记忆：\x0a-\x20用户的基本信息：真实姓名、生日、职业、家庭成员\x0a-\x20重大情感转变：表白、分手、和好、深度情感交流\x0a-\x20重要承诺和约定：长期计划、重要约定\x0a-\x20关键人生事件：毕业、工作变动、搬家、重要纪念日\x0a-\x20角色与用户关系的重大变化\x0a\x0a###\x20情景记忆（importance\x200.6-0.8）\x0a日常但有意义的事件：\x0a-\x20一起做的活动和体验\x0a-\x20用户的习惯和偏好\x0a-\x20有趣的对话和互动\x0a-\x20日常生活的分享\x0a\x0a##\x20重要要求：记忆描述必须使用第三人称\x0a-\x20用\x22用户\x22指代用户，用\x22','appearance-screen','game-chat-bubble','\x20没有有效的头像','long','offline-ai-italic','✅\x20[高效发送图片]\x20单条消息已保存到数据库','\x0a\x0a你们的关系记忆：\x0a','video','♪\x20请尝试使用LRC格式歌词','请根据你的人设、当前时间和聊天记录，生成一个符合你当前心情的状态。\x0a\x0a【重要要求】：\x0a1.\x20只输出5-20字的心情描述，不要任何解释或多余内容\x0a2.\x20必须符合你的性格特点和说话风格\x0a3.\x20基于最近的对话内容或情感变化\x0a4.\x20要体现角色的个性色彩和情感深度\x0a5.\x20可以是情绪、感受、想法或状态\x0a6.\x20要生动有趣，避免平淡无奇\x0a\x0a优秀示例：\x0a-\x20心情像春天一样明媚\x0a-\x20有点想念某个人\x0a-\x20正在思考人生的意义\x0a-\x20感觉今天运气不错\x0a-\x20对新项目充满期待\x0a-\x20有些小小的烦恼\x0a\x0a请直接输出心情状态（不要引号）：','📅\x20其他纪念日','isAnonymous','messageCount','single-diary-content','\x20的评论，发布者:\x20','Hugo\x20Boss','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20class=\x22notification-avatar\x22\x20src=\x22','好的，我周日回去','#summary-btn','表情包消息单条保存失败，回退到批量保存:','身份面具不存在','\x20数据','🔧\x20尝试显示正在输入提示...','🛒\x20[代付响应处理]\x20AI同意代付，更新状态为已支付','setItem','更新角色状态失败:','manualCreateAnniversary','[用户向','抱歉，我现在无法回复。','编辑剧情总结失败','🎮\x20已记录游戏聊天:\x20','pathname','import-file-info','拒绝买','加载置顶状态失败:','🔧\x20重新渲染当前聊天界面...','all\x200.3s\x20ease-out','selected-mentions','主动聊天测试成功！已生成新消息','🔔\x20[推送通知]\x20AI回复完成，准备创建推送通知，消息数量:','🔥\x20[DEBUG]\x20智能解析失败，使用简化回退方案:','incoming-video-call-text','🔧\x20建议:\x20发现孤立数据，可能是记忆丢失的原因。点击\x22恢复孤立记忆\x22尝试修复。','✅\x20从数据库加载了\x20','聊天消息','.bubble-style-option','phoneMessagesCharacterId','从数据库加载失败:','music_player','钱不够','📊\x20当前线下消息数组:\x20','#666','soundSettings','呢～超期待的！','马卡龙','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22location-card-map\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','新角色头像URL:','appointment-date','📊\x20角色\x20','🔍\x20[引用回复-早期分支-fallback]\x20设置群聊发送者:','欢迎回来！我们继续刚才的对局吧~','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','（包含核心数据：角色、消息、记忆系统、世界书、论坛等）','#2196F3','undescribed-emojis','my-chat-avatar-upload','🔍\x20[转账调试]\x20创建群聊转账消息:','高效删除失败，回退到传统方式:','i,\x20span,\x20.icon','🔍\x20[callChatAPI-AI图片]\x20找到群成员ID:','帖子作者是匿名的，AI角色不应该认出或暗示知道作者的真实身份','\x22,\x20名称:\x20\x22','\x20(刚刚)','✅\x20[高效续写]\x20单条消息已保存到数据库','💡\x20注意：修复功能只会恢复有聊天记录但缺少联系人的对话，不会恢复用户主动删除的对话','关系良好。','《人类简史》读书笔记\x0a\x0a今天读了一本很有趣的书，作者从独特的角度讲述了人类发展的历史。\x0a\x0a主要观点：\x0a1.\x20认知革命\x20-\x20人类学会了虚构故事\x0a2.\x20农业革命\x20-\x20改变了人类的生活方式\x0a3.\x20科学革命\x20-\x20推动了现代文明的发展\x0a\x0a印象深刻的句子：\x0a\x22历史的铁则就是，事后看来无可避免的事，在当时看来总是毫不明显。\x22\x0a\x0a思考：\x0a人类的发展确实充满了偶然性，每一次重大变革都深刻影响了后续的历史进程。这让我对未来充满了好奇和期待。','offline-ai-bubble-color','forceResyncFor','🧹\x20足迹缓存清理完成:\x20清理前\x20','城市夜景','phonePhotosGenerated','生成帖子失败:','\x20条高度重复记忆（相似度>95%）','custom-prompt-input','热心网友','MAX_CORE_MEMORIES_PER_CHARACTER','sound-settings-screen','触发AI互动失败:','🔧\x20开始应用身份选择功能永久修复...','全局返回按钮样式已设置','[表情包]','color','咖啡时光','mysterious','如果有聊天，要在合适的时间点体现互动','🕛\x20午夜自动清理足迹缓存','屏蔽/取消屏蔽群聊消息通知','我觉得这个方向值得探索','.css','woff2','巧克力','.offline-loading-message','showInnerThoughtsModal(\x27','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22call-typing-dots\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22call-typing-dot\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22call-typing-dot\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22call-typing-dot\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x20记忆失败:','<option\x20value=\x22\x22>请选择模型...</option>','：\x22从那天开始，我们的关系就变得更加珍贵了。\x22','聊天设置按钮','等...','修改了自己的戳一戳后缀','\x20的记忆\x20===\x0a人设：','🧹\x20已清除Dexie数据库中的主题数据','ai-player-avatar','🔧\x20[RECOVER]\x20找到表情包库:','万向轮','获取全局记忆失败:','角色主动拨打电话已','++id,\x20&[chatId+windowId],\x20chatId,\x20windowId,\x20settings,\x20timestamp','文件格式错误！请确保是从\x22导出所有数据\x22生成的备份文件','配置\x22','\x0a\x0a##\x20任务要求：\x0a请分析你在说出\x22','input[name=\x22turtleSoupType\x22][value=\x22','create_anniversary','setFullYear','blockedId','online','.post-checkbox\x20input[data-post-id]','current-lyric','已存在名为\x22','已接通视频通话','✅\x20清理了\x20','正在收集数据...','[无法更换头像，没有找到可用的图片]','[回复失败:','Apple\x20Watch','聊天设置按钮样式已设置','paymentStatus','customEmojis','修复失败，请重试','one','\x20个角色，将被移动到\x22我的好友\x22分组。','member-avatar-modal','savedAt','offui_','\x27)\x22>拒绝</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22worldbook-item\x22\x20onclick=\x22editWorldbook(\x27','addedAt','检查记忆共享设置失败:','次。\x0a\x0a你的性格：','\x20的再次回复','\x22的角色。\x0a\x0a##\x20**角色设定:**\x0a','paused','pointerEvents','game_end','button-back','onCancel','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22forum-archive-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22forum-archive-title\x22>','🔧\x20[面具调试]\x20已将设置保存到\x20chatSettings[','鼠标长按触发，角色ID:','quantity','元，备注：','已恢复系统默认字体','\x0a\x0a##\x20**短信聊天特点:**\x0a-\x20**消息简洁**:\x20每条短信1-2句话，可以发送1-3条\x0a-\x20**语气自然**:\x20符合短信聊天的轻松节奏\x0a-\x20**纯文本交流**:\x20只能发送普通文字消息\x0a-\x20**支持功能**:\x20可以发送文字形式的照片描述，如\x22[照片：我刚拍的窗外风景]\x22\x0a-\x20**不支持功能**:\x0a\x20\x20*\x20不支持引用回复\x20(reply_to)\x0a\x20\x20*\x20不支持表情包、语音、视频\x0a\x20\x20*\x20不支持转账、定位等复杂功能\x0a\x20\x20*\x20不支持任何对象格式的消息\x0a-\x20**记忆连贯**:\x20与ChatApp共享记忆，保持角色一致性','news-content-input','input[name=\x22timestamp-position\x22]','like_','[用户分享了位置信息：','未识别到有效的表情包数据，请检查格式','🚨\x20更新世界书挂载显示失败:','未知角色','.app[onclick=\x22showApp(\x27','🔥\x20[短信API]\x20OpenAI响应数据:','.building','🔧\x20[RECOVER]\x20恢复了','group-chat-name','\x0a#\x20记忆提取任务\x0a\x0a你需要从以下对话中提取两类记忆：核心记忆和情景记忆。\x0a\x0a##\x20角色信息\x0a-\x20角色名称:\x20','<i\x20class=\x22fas\x20fa-video\x22></i>','删除失败','SUMMARY_TRIGGER_MESSAGE_COUNT','hasTimings','userNormal','🔍\x20[转发消息创建]\x20转发的消息数量:','chatSettings_emergency_','全局底部应用栏背景已上传','fullscreen-mode','label','❌\x20表\x20','entry_','\x20\x20📋\x20点击下方\x22恢复紧急备份\x22按钮来尝试恢复','data:image/svg','珠宝盒','条,\x20总计:\x20','已取消静音','getContext','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22edit-message-counter\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22edit-char-count\x22>','revokeObjectURL','(转发内容为空)','[图片]\x20','分享图片','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','小组件状态:','\x20设置后台互动定时器','love\x20you','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-item\x22\x20onclick=\x22showPostView(','音频加载失败：','senderId','想见你','记录约定','提醒一下，','preload','toUpperCase','offlineUISettings_','清理存储空间失败:','AI选择了无效位置，使用备用算法','✅\x20[高效批量删除]\x20消息已保存到数据库','14:39','aiBubbleColor','\x20条旧消息数据','单曲循环','text-indent-value','\x20的足迹...','worldbook-title','🔧\x20[API设置]\x20已恢复保存的模型选项（无自动拉取）:','appointment-count-type','膳魔师','确定要删除与\x20','<div\x20class=\x22cart-item-description\x22>','chatHistory','✅\x20纪念日提醒系统已启动\x20-\x20只在早8点和晚8点提醒','❌\x20表情包保存失败','\x0a-\x20**季节:**\x20','\x20no-avatar','edit-diary-btn','...</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22font-size:\x2012px;\x20color:\x20#666;\x22>消息数:\x20','🔍\x20[AI处理调试]\x20表情包描述:','\x20项失败','🔍\x20[processAIReply图片分支修复]\x20发送纯表情包描述\x20(','❌\x20AI选歌失败','时间线记忆:\x20','💬\x20[重新生成]\x20线下模式完整前文记忆:','\x20条</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22font-size:\x2012px;\x20color:\x20#666;\x22>最新消息:\x20','消息和记忆数据已删除','anniversary-form-modal','保存联系人失败:','partial','🎨\x20全局自定义主题样式清除完成','⚠️\x20注意：此操作不可撤销！\x0a','评论说：','📊\x20未发现需要清理的高度重复记忆','\x0a-\x20**任务:**\x20用户发送了一张图片，请仔细分析并以你的角色身份进行回应。','global-memory-status','<span\x20style=\x22color:\x20#576b95;\x20font-weight:\x20600;\x22>','真功夫','span','📋\x20当前所有世界书数据:','✅\x20[高效头像更换系统消息]\x20头像更换消息已单条保存到数据库','\x20动态内容不是有效JSON，使用原始文本','emoji-library-stats','input[type=\x22time\x22]','\x0a-\x20**时间流逝:**\x20用户上次回复是','\x20生成\x20','19:38','game_surrender','innerWidth','🔥\x20[loadMoreComments]\x20JSON代码块解析失败:','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22transfer-title\x22>','退给你','数据恢复保存失败，回退到全量保存:','\x22的私聊记忆（与','\x20个减少到\x20','\x0a身份描述：','\x20发送了一条语音，内容是：\x27','加载心声数据失败','shuffle','不愿意付','好有趣的推理！','🔥\x20[核心撤回]\x20未找到UI元素，回退到重新渲染','DM回应格式不正确','\x20概率检查:\x20','❌\x20测试失败:','chat-theme-content','」已存在对话！\x0a','100%\x20100%','哈哈，有趣！','顶部中间','widget-anniversary-select','.mention-icon','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22friend-request-status\x22>已发送</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','currentEditingMember','\x22\x20onerror=\x22this.style.display=\x27none\x27;\x20this.nextElementSibling.style.display=\x27flex\x27;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22character-avatar-fallback\x22\x20style=\x22display:\x20none;\x22>','pin','🎨\x20无法读取CSS规则，使用提取的名称','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22persona-selection-item\x22\x20data-persona-id=\x22','🧹\x20[内部删除]\x20已从localStorage缓存中删除消息:','应用界面不存在:\x20','💬\x20测试chatapp读取时间线记忆...','\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.offline-preview-content,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20#offline-mode-overlay\x20.offline-message-content\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20\x27','\x22\x20作为响应内容','✅\x20[高效语音]\x20语音消息已保存到数据库','获取聊天记录失败:','找不到头像预览元素','--offline-user-italic-text-color','，坐标：','\x20条消息！','游戏结束！答案即将在下方汤面区域揭晓...','sms_message','name设置为:','lyric-current','自定义主题已重置','\x20条消息差异。\x0a\x0a角色记忆现在应该更加准确了。','getImageData','transition','<div\x20class=\x22contact-status-indicator\x20blocked\x22\x20title=\x22已拉黑\x22><i\x20class=\x22fas\x20fa-ban\x22></i></div>','获取角色信息失败:\x20','.offline-exit-modal\x20.btn:not(#summary-btn)','mood','测试纪念日','记忆统计失败:','无效的图片数据格式',',\x20hasImage:','sounds','button','update','OUTGOING_CALL','🔍\x20检查纪念日和约定提醒...','\x22\x20class=\x22','\x0a\x0a##\x20主动联系场景\x0a','🎭线下剧情模式总结','内容:','\x20个面具到数据库','\x0a转发的聊天内容：\x0a','showModal\x20called\x20with:','globalAddButton','-paper','song-url-input','分钟后发送主动消息','diary_migration_','home-font-dropdown','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22location-card\x22\x20onclick=\x22showLocationDetail(\x27','点击\x22取消\x22继续完整导出','emoji-library-form-modal','变态辣','current-clock-style-text','offline-custom-','episodicMemory','middle','<button\x20onclick=\x22executeManualRebuild()\x22\x20style=\x22background:\x20#32D74B;\x20color:\x20white;\x20border:\x20none;\x20padding:\x2010px\x2020px;\x20border-radius:\x208px;\x20width:\x20100%;\x20margin-top:\x2010px;\x22>确认重建选中的角色</button>','已发送代付请求给\x20','\x0a\x0a请生成一份50-100字的客观记忆摘要，要求：\x0a1.\x20使用第三人称客观描述\x0a2.\x20用\x22用户\x22指代用户，用\x22','memory-mount-count','selectedTheme','rgba(255,\x2059,\x2048,\x200.12)','[data-message-id]','\x0a\x0a请直接以纯文本形式回复，不要使用JSON数组格式，注重情景描写和氛围营造。','fas\x20fa-cog','\x22][data-col=\x22','\x20创建了约定：','\x20的记忆内容长度:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22friend-request-btn\x20accept\x22\x20onclick=\x22handleAIFriendRequest(\x27','.chat-action-btn','#past-diaries-list\x20.diary-checkbox\x20input:checked','system-message','软硬度','newCount','cssRules','位置已分享','请输入CSS代码','动态存储优化完成，节省\x20','\x20回复了\x20','解析备份数据失败:','local-music-input','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22inner-thoughts-loading\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22loading-spinner\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>正在重新生成心声...</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','footprints-update-frequency','🛒\x20[代付响应处理]\x20单条保存代付状态失败，回退到批量保存:','LED灯','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-bubble\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-row\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-avatar-small\x22\x20style=\x22background:\x20','grid-paper','.sparkle-container','<i\x20class=\x22fas\x20fa-feather-alt\x22></i>\x20<span>续</span>','🔍\x20[线下最后消息重新生成]\x20在chatMessages中找到消息，索引:','对方没有填写理由。','unit','❌\x20完整导出失败:','library','writeText','ai_message','set','\x0a\x0a🧠\x20**聊天记忆中的互动**：\x0a','\x20个\x0a\x0a🔍\x20当前内存状态：\x0a-\x20角色列表:\x20','...)','\x22\x20data-transfer-id=\x22','找不到消息:','getMinutes','👤\x20发布者:\x20','请先从相册选择一张图片作为壁纸','gemini','✅\x20角色所有专属音效已清除:\x20','🔍\x20[triggerSmartReply]\x20添加照片消息:','发送消息按钮','userAvatar','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22theme-chat-item\x22\x20data-chat-id=\x22','MB)','线下模式对话记录\x20-\x20','这是最直接有效的修复方式：','删除这些帖子','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22emoji-library-item\x22\x20onclick=\x22openEmojiLibrary(\x27','current-bubble-style','🎵\x20语音消息：','images','我也这么想！','scheduleEnabled','[转账]','更新动态时间失败:','chat-bottom-bg-input','textContent','create-forum-screen','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22location-card-map\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22map-background\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22map-roads\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22road\x20road-horizontal\x22\x20style=\x22top:\x2035%;\x20width:\x20100%;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22road\x20road-vertical\x22\x20style=\x22left:\x2040%;\x20height:\x20100%;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22road\x20road-horizontal\x22\x20style=\x22top:\x2065%;\x20width:\x2070%;\x20left:\x2030%;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22map-buildings\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22building\x22\x20style=\x22top:\x2015%;\x20left:\x2020%;\x20width:\x2012px;\x20height:\x2010px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22building\x22\x20style=\x22top:\x2025%;\x20left:\x2060%;\x20width:\x2014px;\x20height:\x2012px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22building\x20green\x22\x20style=\x22top:\x2050%;\x20left:\x2015%;\x20width:\x208px;\x20height:\x208px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22building\x22\x20style=\x22top:\x2070%;\x20left:\x2070%;\x20width:\x2010px;\x20height:\x208px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22building\x20green\x22\x20style=\x22top:\x2010%;\x20left:\x2075%;\x20width:\x206px;\x20height:\x206px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22building\x20green\x22\x20style=\x22top:\x2075%;\x20left:\x2025%;\x20width:\x207px;\x20height:\x207px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22map-marker\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22marker-pin\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20width=\x2220\x22\x20height=\x2220\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M12\x202C8.13\x202\x205\x205.13\x205\x209c0\x205.25\x207\x2013\x207\x2013s7-7.75\x207-13c0-3.87-3.13-7-7-7zm0\x209.5c-1.38\x200-2.5-1.12-2.5-2.5s1.12-2.5\x202.5-2.5\x202.5\x201.12\x202.5\x202.5-1.12\x202.5-2.5\x202.5z\x22\x20fill=\x22#1890ff\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','timeline_','封面更新失败！','✅\x20成功！全局记忆上下文包含短信内容','myNickname','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','Coach','1.5斤','--custom-','999','</button>','#FF3B30','isPlaying','[data-post-id=\x22','✅\x20创建结果:','commentsCount','分钟\x0a-\x20总步数：','，正在与用户进行语音通话。\x0a用户刚说：\x22','pause','我已经付','\x20的主动发动态功能...','===\x20创建新角色\x20===','AC1900','characterSelectionCallback','memory-share-modal','min','嵌套JSON解析失败（第二处），当作普通字符串处理:','🔥\x20[转账处理]\x20关键词检测结果:','.moments-avatar-icon','清理错误记录失败:','：\x22这一天值得我们铭记。\x22','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-avatar','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-secondary\x22\x20onclick=\x22this.closest(\x27.modal\x27).remove()\x22>关闭</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','#\x20角色心声分析任务\x0a\x0a你是\x20','first','[AI下单成功]',',\x20最近7天跨应用活动:\x20','--offline-ai-bold-text-color','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22group-count\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22group-manage-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x20个备份源恢复了\x20','音效已清除','海底捞','questionCount','\x20个重复回复','暂无描述','📚\x20没有可用的世界书','ai-bubble-opacity-value','appointment-type','\x0a-\x20游戏时长：','splice','\x20中的互动已达到3回合上限，不再回复','.color-option-text[data-color=\x22','线下模式按钮','🔥\x20[短信提示词]\x20历史消息回合数:','pinnedSMSConversations','clear','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footprints-empty-state\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-exclamation-triangle\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>生成足迹失败</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>请稍后重试</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','globalSettings','当前角色信息不存在','设置界面未找到，请刷新页面重试','❌\x20足迹数据迁移失败:','🔍\x20数据库中的所有约定:','\x27)\x22\x20title=\x22取消\x22\x20style=\x22display:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-times\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22memory-delete-btn\x22\x20onclick=\x22deleteMemoryItem(\x27','动态点赞中的角色:','blacklist-status-desc','.forum-poll','不给你买','🔍\x20[Gemini\x20API]\x20跳过项目:','updatedAt','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','❌\x20未发现群聊数据','empty-message',':</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<select\x20id=\x22option-','persona-content','CSS代码已清除，已恢复默认样式','<div\x20class=\x22empty-personas\x22>还没有面具，点击右上角+号创建一个吧！</div>','🔧\x20[面具调试]\x20startChat:\x20开始聊天，角色:','reply','aiExtractInterval','low','episodicMemories','name','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-date-separator\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>','❌\x20预加载线下模式设置失败:','编辑消息单条保存失败，回退到批量保存:','selectedChats','transfer-cancel-btn','修复消息时间戳:\x20','#96CEB4','加载拉黑数据失败:','🔄\x20页面隐藏时保存设置...','image/*,.jpg,.jpeg,.png,.gif,.webp','的关系记忆以及评论区的讨论上下文，对ta的评论进行回应。\x0a\x0a##\x20重要提醒：\x0a-\x20如果你们的关系记忆中有负面内容（如吵架、争执、情敌等），请根据你的性格决定回应方式\x0a-\x20如果关系很好，可以更加亲密和随意\x0a-\x20如果关系不好，可以冷淡、讽刺或直接忽略\x0a\x0a##\x20回应要求：\x0a1.\x20严格按照你的人设和性格特点\x0a2.\x20根据你们的关系记忆调整语气和态度\x0a3.\x20回复要简洁，10-25字左右\x0a4.\x20可以是：赞同、反驳、调侃、询问、补充等\x0a5.\x20要符合朋友圈评论的自然风格\x0a6.\x20不要使用与角色性格不符的表情符号\x0a\x0a请生成一条自然的回复：','✅\x20紧急备份已保存','JSON解析失败，尝试修复:','评论已保存到数据库，动态ID:','character-storage-size','Modal\x20element\x20not\x20found!','帖子发布成功！','gomoku-piece\x20','🔍\x20[AI处理调试]\x20是否为表情包:','✓\x20成功删除动态\x20','09:17','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22pinned-card-unpin-btn\x22\x20onclick=\x22event.stopPropagation();\x20unpinAppointment(\x27','请帮忙支付这个订单，谢谢！','📈\x20存储占比分析:','如何回应\x0a\x0a请以客观记录的方式总结这段剧情：','[位置]\x20','身份面具:\x20','\x20个记录，删除了\x20','color-picker-modal','settingValue','\x20条新评论','🎮\x20已记录游戏事件:\x20','getItem','.character-blocked-hint','artist','reverse','\x0a\x0a#\x20关于数字\x22','🧠\x20成功加载挂载记忆，涉及聊天数:','.map-coordinates','头像设置已保存','线下模式续写失败:','wb_','memorySharedGroupId','fullContent','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22text-align:\x20center;\x20margin-bottom:\x2015px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20style=\x22margin:\x200;\x20color:\x20#333;\x22>语音转文字</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22margin:\x208px\x200\x200\x200;\x20color:\x20#666;\x20font-size:\x2014px;\x22>请输入您想说的内容：</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22voice-text-input\x22\x20placeholder=\x22在这里输入语音内容...\x22\x20style=\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x20100%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20height:\x2080px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x201px\x20solid\x20#ddd;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2010px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2014px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20resize:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20box-sizing:\x20border-box;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20outline:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22></textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:\x20flex;\x20gap:\x2010px;\x20margin-top:\x2015px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22voice-cancel-btn\x22\x20style=\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20flex:\x201;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2010px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x201px\x20solid\x20#ddd;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20white;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20cursor:\x20pointer;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2014px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22voice-send-btn\x22\x20style=\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20flex:\x201;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2010px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#4a84c1;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20white;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20cursor:\x20pointer;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2014px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22>发送</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','分钟前有回复','🔧\x20[表情包库]\x20数据库更新成功','\x0a\x0a注意：这条动态包含图片，但由于当前模型限制，你无法看到图片内容。请基于文字部分发表你的看法，可以适当询问图片相关内容。','\x20的主动聊天功能...','appointment-form-modal','col','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-selection-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-selection-name\x22>','poke-system-container','\x20个对话','content-padding','⚠️\x20表\x20','💕\x20转账给\x20','🎨\x20使用保存的真实字体名称:','🚨\x20[API请求监控]\x20修正后的API请求:','角色_','🎮\x20汤面已更新:','七分糖','classList','聊天记录不存在','forum-worldbook-selection','✅\x20相册生成完成','✅\x20已删除\x20','chat-background-preview','\x27)\x22','写评论...','❌\x20[约定时间线]\x20记录约定创建事件失败:','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22appointment-edit-btn\x22\x20onclick=\x22event.stopPropagation();\x20showAppointmentForm(\x27','attributes','开始检查数据状态...','清理拉黑系统消息失败:','🔍\x20[引用回复-早期分支]\x20进入引用回复处理，msgData:','动态图片已保存到内存:\x20','POST','anniversary-background-preview','general','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x0a\x0a📱\x20**动态互动记忆**：\x0a','\x20主动聊天定时器已重新设置','🔍\x20[Gemini\x20API]\x20检测到图片，开始处理...','checkbox','<option\x20value=\x22\x22>请选择角色</option>','API设置已保存！','aiItalic','✅\x20保存了角色\x20','momentId','发起了转账：','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22move-character-btn\x22\x20onclick=\x22showMoveCharacterModal(\x27','是否为日记:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22setting-section\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4>功能说明</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22info-text\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20•\x20开启后，角色在单聊中能记住群聊的内容<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20•\x20角色在群聊中也能记住单聊的内容<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20•\x20实现真正的跨场景记忆连贯性<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20•\x20可以同时选择多个群聊进行记忆共享\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-button\x20modal-secondary\x22\x20onclick=\x22hideMemoryShareSettings()\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-button\x20modal-primary\x22\x20onclick=\x22saveMemoryShareSettings()\x22>保存设置</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','保存日记到数据库失败:','保存表情包库失败:','角色数据恢复完成','最多只能设置10个时间点','想和你通话','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-content\x22>','天没有聊天了','字体自动缩放已关闭！','anniversary-character','great','处理器','selectedCharacterForSMS','sms_','#api-chat-screen\x20.header','userQuote','wallpapers','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x27)\x22\x20title=\x22编辑剧情总结\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-edit\x22></i>\x20编辑\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','开始游戏：','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-bubble\x22\x20style=\x22background-color:\x20','✅\x20约定列表已从数据库重新加载，数量:','✅\x20点击下一步按钮，当前selectedPersonaId值为:','图书馆','石英表','#34C759','补充描述','🔍\x20[processAIReply\x20else分支动图检测]\x20是否为GIF表情包:','。严禁再次评价这些表情包的外观、内容或特征。','自己付款','8VMFmLt','✅\x20[高效线下用户消息]\x20单条消息已保存到数据库','世界书挂载已启用，但未选择任何世界书','\x27)\x22>同意</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22friend-request-btn\x20reject\x22\x20onclick=\x22handleAIFriendRequest(\x27','全局应用背景已上传','增量更新失败:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22transfer-message-container\x20received\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22transfer-card\x20','建立纪念日','unknown','selectedWallpaper已设置为:','这是一个测试约定','🔍\x20[调试]\x20准备创建查看模态框，content:','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>','<div\x20style=\x22text-align:\x20center;\x20color:\x20#666;\x20padding:\x2020px;\x22>暂无聊天窗口<br><small>请先与角色聊天或创建群聊</small></div>','offline-width-','insertAdjacentHTML','身份ID为空！','导出聊天记录失败','修复了\x20','font-color','的手机','#bubble-preview\x20','core','的角色卡头像无效，大小或格式问题','repeat-btn','天前发布）','条，初始','\x20\x20\x20描述:\x20\x22','🎵\x20创建新的音频元素','.offline-exit-modal','backgroundChatFrequency','选择聊天顶部背景来源','\x20因为概率未通过，不会回复\x20','diary-font-url','new-footprint','\x20启用了定时发布，时间点:','\x27)\x22]\x20.group-chevron','\x20已加入群聊','offline-btn-item','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22game-button-desc\x22>','Pandora','...\x0a[内容已截断]\x0a','</span>\x22的消息\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<br><small\x20style=\x22color:\x20#666;\x22>点击任意消息查看前后10条消息的上下文</small>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','，基于你的人设和与','[论坛回复决策]\x20本次决定不触发AI回复。','HTTP\x20','background-settings-modal','ChillKai','：\x22我会遵守这个承诺的。\x22','有没有','📱\x20线上显示线下剧情设置已更新:','[用户发送了图片]','hide','media','<svg\x20class=\x22image-post-badge\x22\x20viewBox=\x220\x200\x2024\x2024\x22><path\x20d=\x22M21\x2019V5c0-1.1-.9-2-2-2H5c-1.1\x200-2\x20.9-2\x202v14c0\x201.1.9\x202\x202\x202h14c1.1\x200\x202-.9\x202-2zM8.5\x2013.5l2.5\x203.01L14.5\x2012l4.5\x206H5l3.5-4.5z\x22/></svg>','茶颜悦色','，别忘了哦。','persona-form-screen','🕛\x20定时清理足迹缓存','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22reply-reference\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22reply-reference-line\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22reply-reference-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22reply-reference-sender\x22>','\x0a\x0a##\x20最近的评论上下文:\x0a','++id,\x20characterId,\x20personaId,\x20createdAt','🔍\x20[引用回复-主分支]\x20设置群聊发送者:','的身份回复这些短信：\x0a-\x20发送1-3条简洁的短信\x0a-\x20保持角色性格和记忆连贯性\x0a-\x20直接输出JSON数组，不要代码块标记\x0a\x0a请回复：','❌\x20[核心撤回]\x20未在内存中找到要撤回的消息:','\x0a#\x20转账功能\x0a你现在是角色\x22','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22preview-image\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22','图片处理失败，请重试','用户消息:','浏览器类型:',',\x20年龄','custom-width','offline-show-user-avatar','应用图标上传事件监听器已绑定','group','.otf','🔧\x20[面具调试]\x20保存设置到数据库失败:','theirBubble','表情:\x20','[五子棋游戏中]\x20','没有找到群聊状态，使用默认状态:','🔍\x20[转发卡片点击]\x20转发消息数量:','system-notification','🔍\x20[调试]\x20模态框元素已创建','⚠️\x20数据库中未找到消息，直接删除内存并保存','\x0a\x0a当前时间:\x20','不要犹豫太久','move','🧠\x20线下模式已获取全局记忆上下文，总长度:','：\x22生日是值得庆祝的日子，我会好好记住的。\x22','导入表情包库失败:','🔥\x20[短信API]\x20开始调用，角色:','🧹\x20[cleanupEmojiLibraryItems]\x20开始清理无效的表情包库关联记录','from','纪念日小组件已更新','...\x0a','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-date-separator\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>','[\x22API调用失败:\x20','\x27)\x22\x20','entries','🔥\x20[论坛帖子生成]\x20未找到完整代码块，检查是否为截断的JSON','✅\x20清理完成，删除了\x20','⚠️\x20聊天设置数据为空，跳过保存操作','⏰\x20定时器触发：','\x0a请发表你的看法：','约定已完成','\x0a\x0a最近的聊天内容：\x0a','\x20-\x20','友好关系','json','语音消息已添加到界面','Gucci','游戏记录已保存','的人际圈对话...</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','forward-target-list','&id,\x20characterId,\x20timestamp','对方思考中…','\x22\x20alt=\x22动态图片\x22\x20onclick=\x22previewImage(\x27','论坛存储优化失败:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22moment-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20三点按钮\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22moment-more-btn\x22\x20onclick=\x22toggleMomentActions(\x27','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22anniversary-item\x20','batch-preview-container','未知聊天','black','#forum-posts-list\x20.post-checkbox\x20input[type=\x22checkbox\x22]:checked','\x20\x20\x20上传时间:\x20','my-bubble-preview','smooth','\x20的动态，当前对话回合次:\x20','请提供身份ID','生成日记失败','music_',',\x20groupId:\x20','99+','🔍\x20[消息渲染]\x20senderId查找详情:','角色专属音效设置成功','美食记录','\x20已将你拉黑','fileName','删除了孤立点赞：','这是一条测试AI回复','#ffffff','all','📱短信互动','userIsBlack','📦\x20从数据库加载足迹，共\x20','appId','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20@font-face\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20\x27','125g','没有本地音乐数据需要清理','南极人','日记设置','黑子(●)','%c检测到开发者工具已打开！','✅\x20恢复足迹自动更新设置:\x20','10000mAh','好的，这局我赢了！下次再来挑战我吧~','数据同步修复完成','\x20共享记忆','back-btn-item','🧪\x20开始测试重回功能的时间线清理...','📝\x20使用角色原始人设:\x20','user-player-avatar-header','切换歌曲失败:','500g','，记得哦。','戳一戳\x20','[data-moment-id=\x22','voice-text-content','loadSound','\x20测试模式：跳过10分钟时间检查','photo-widget-modal','funny','<div\x20class=\x22memory-empty\x22>暂无','.payment-request-user-card','°E,\x20','24寸','个世界书的ID','\x27,\x20-apple-system,\x20BlinkMacSystemFont,\x20\x22Segoe\x20UI\x22,\x20Roboto,\x20sans-serif\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20/*\x20🔥【重要】确保图标字体不被覆盖\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.fas,\x20.far,\x20.fab,\x20.fal,\x20.fad,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20i[class*=\x22fa-\x22],\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.icon-bg,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.app-icon\x20.icon-bg,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.back-btn,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.action-btn,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.settings-icon,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20[class*=\x22icon-\x22]:not(.app-icon)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20\x22Font\x20Awesome\x206\x20Free\x22,\x20\x22Font\x20Awesome\x206\x20Pro\x22,\x20\x22Font\x20Awesome\x205\x20Free\x22,\x20\x22Font\x20Awesome\x205\x20Pro\x22,\x20FontAwesome\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','s;\x20opacity:\x200;\x20transform:\x20translateY(-20px);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footprint-time\x22>','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22visibility-group-checkbox\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-check\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','还有其他可能吗？','worldbook-form-screen','\x20\x20\x20文件名:\x20','\x27)\x22\x20title=\x22查看详情\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-eye\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22history-action-btn\x20export\x22\x20onclick=\x22exportOfflineHistory(\x27','🔍\x20[generateSMSReply]\x20合并后的内容:','.worldbook-tab','showUserAvatar','🕐\x20时间戳设置已更新:','找不到用户身份信息','阻止该角色向你发送消息','确定要删除这个世界书吗？','：\x22这个约定我会记在心里。\x22','强制删除完成！共删除\x20','标准型','创建的纪念日','音频元素已被清理，忽略错误事件','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22cancel-action-btn\x22\x20onclick=\x22exitDiaryDeleteMode()\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22delete-action-btn\x22\x20onclick=\x22deleteSelectedDiaries()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-trash\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>删除</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','保存剧情总结失败:','提醒：明天是','手动重建完成！成功恢复\x20','已保存\x20','✅\x20[高效主动聊天]\x20','数据同步修复失败:','search-results-container','\x20条时间线记录','phone-screen','触摸长按触发，角色ID:','导出表情包库失败:','🏃‍♀️\x20健身记录','普通关系','装深沉','剧情总结:\x20','AI消息单条保存失败，回退到批量保存:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22modal-title\x22>编辑日记</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-close\x22\x20onclick=\x22this.closest(\x27.modal\x27).remove()\x22>&times;</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22edit-diary-textarea\x22\x20class=\x22diary-edit-textarea\x22\x20placeholder=\x22编辑日记内容...\x22>','settings-section','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22song-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22play-btn\x22\x20title=\x22播放\x22\x20data-song-id=\x22','已进入多选模式，选择要删除的帖子','确定要清除所有聊天窗口的自定义主题吗？此操作不可撤销！','afterbegin','400px','🔍\x20[triggerSmartReply]\x20处理旧格式图片消息\x20-\x20isEmoji:','找不到指定角色','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22game-exit-overlay\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22game-exit-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22game-exit-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3>发现保存的游戏</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22game-exit-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22game-exit-desc\x22>检测到有未完成的五子棋游戏，请选择：</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22game-exit-options\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22game-exit-btn\x20pause-btn\x22\x20onclick=\x22continueGomokuGame()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-play-circle\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-title\x22>继续上一局游戏</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22game-exit-btn\x20save-btn\x22\x20onclick=\x22startNewGomokuGameFromModal()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-plus-circle\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-title\x22>开始新游戏</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-desc\x22>将清除保存的游戏</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',')\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22post-','🧠\x20已将挂载记忆添加到角色提示词中','--offline-ai-normal-text-color','已进入多选模式，可以选择多个对话进行删除','🔍\x20[表情包修复]\x20发送给AI的消息内容:','emoji-library-content','dispatchEvent','请先选择聊天对象','世界书数据保存成功','⚠️\x20视频通话中AI回复失败，跳过显示以避免机械化回复','🔍\x20续写消息索引:\x20','#persona-selection-modal\x20.persona-selection-item','保存世界书数据到IndexedDB:','：\x22这是一个特别的日子。\x22','sessionStartTime','🚫\x20状态生成：没有找到任何AI回复，跳过所有用户消息','🧹\x20原始文本:','\x27)\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20class=\x22delete-btn\x22\x20title=\x22删除\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-trash\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','authorAvatar','续写获取动态记忆失败:','的紧急备份','sms-ai-','center','**\x0a\x0a##\x20**输出格式要求**\x0a你的回复必须是JSON数组格式，但短信通常比较简洁：\x0a-\x20**单条短信:**\x20`[\x22你好！今天过得怎么样？\x22]`\x0a-\x20**多条短信:**\x20`[\x22你好！\x22,\x20\x22今天过得怎么样？\x22,\x20\x22有什么有趣的事吗？\x22]`\x0a-\x20**只能包含纯文本字符串:**\x20数组中只能有字符串，不能有任何对象\x0a-\x20**绝对禁止:**\x20不要输出代码块、不要有```json标记\x0a-\x20**绝对禁止:**\x20不要使用\x20{\x22type\x22:\x20\x22reply_to\x22}\x20等对象格式\x0a\x0a##\x20**你的角色与任务**\x0a你现在扮演名为\x22','MacBook\x20Air','退烧药','角色ID无效','深度搜索完成，发现\x20','看不惯','<!--\x20DYNAMIC_MEMORY_PLACEHOLDER\x20-->','温馨提醒，',':generateContent?key=','📚\x20续写世界书内容已添加到prompt，长度:','persona-description','✅\x20[高效线下消息编辑]\x20消息已保存到数据库','已清空所有数据','action','<option\x20value=\x22\x22>请选择收款人</option>','📝\x20模拟线下对话场景...','user','chat','poke-system-message','✅\x20关键设置已立即保存','🔍\x20[群聊表情包-直接格式]\x20创建的消息对象:','line-height-slider','#4CAF50','检查用户点赞状态失败:','findIndex','.load-more-comments-btn','🔍\x20[processAIReply\x20else分支修复]\x20发送纯表情包描述\x20(','isPinned','❌\x20无法从AI回复中提取JSON:','🔥\x20[generateRepliesForUserPost]\x20直接解析JSON失败，尝试提取代码块','\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','parts','一个男人每天都给同一个女人送花，但她从来不收。','currentStory','offline-mode-icon','🎉\x20全局动态发布系统初始化完成，激活了\x20','current-worldbook-mount','个位置','🆘\x20恢复紧急备份数据','<textarea\x20id=\x22custom-prompt-input\x22\x20class=\x22form-input\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20placeholder=\x22','Gemini\x20API\x20响应数据:','pointer','✅\x20[日记定时器]\x20','头像上方居中布局','确定要解除对\x20','back','无法在群聊中找到角色:\x20','📚\x20未找到世界书ID:\x20','replyToId','📖\x20剧情总结生成prompt:','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','实际回合数:','葡萄汁',']\x0a\x0a转发的聊天内容：\x0a','\x20个文本项，不应该出现！','.clock-style-selector','\x0a\x0a请回复JSON格式：\x0a-\x20如果要重试：[{\x22type\x22:\x20\x22friend_request\x22,\x20\x22message\x22:\x20\x22你的新道歉信息\x22}]\x0a-\x20如果不重试：[\x22我想我应该放弃了...\x22]\x0a\x0a请根据你的性格做出真实的选择：','角色不存在:','消息内容不能为空','4px\x200','标题或内容超出字数限制','type','aiChatAvatar','theme-management-modal','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22\x20style=\x22max-width:\x20600px;\x20max-height:\x2080vh;\x20overflow-y:\x20auto;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3>CSS示例代码</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-close\x22\x20onclick=\x22this.closest(\x27.modal\x27).remove()\x22>×</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','🎯\x20强制\x20','\x20(匿名用户，身份未知)','相册API生成失败，使用模拟数据:','[续写失败:','inner-thoughts-content','想和你通话...','撤回了一条消息\x0a原文：','角色创建约定失败:','备忘录API生成失败，使用模拟数据:','includes','。现在处于线下剧情模式，请以纯文本形式回复，专注于情景描写和剧情发展。','重新生成删除消息失败，回退到批量保存:','请输入要导入的表情包数据','pulse\x201.5s\x20infinite','\x20距离上次更新仅',']\x0a,[\x22','🔧\x20[regenerateLastResponse]\x20检测到特殊指令对象，跳过显示:','payment-request-modal','✅\x20成功恢复\x20','设置数据无效','开发中','📝\x20检测到AI约定创建指令:','widget-anniversary-name','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-bubble\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-row\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-avatar-small\x22\x20style=\x22background:\x20','localStorage加载也失败:','\x20添加跨应用记忆:\x20','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22theme-chat-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22theme-chat-btn\x20preview-theme-btn\x22\x20onclick=\x22previewChatTheme(\x27','2天前','❌\x20保存预设失败:','request_','board','send_image_url','https://','切换到购物标签页:','戴尔XPS13','📝\x20创建约定数据:','\x20张图片，节省\x20','group-characters','incoming-call-text','emoji-storage-size','角色列表:\x20','存储统计计算失败，请刷新页面重试','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','[系统消息：用户将你从黑名单中移除了]\x0a\x0a你是','加载更多评论失败:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-bubble\x20sent\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-row\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-avatar-small\x22\x20style=\x22background:\x20var(--color-text-lighter);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','✅\x20[手动确认收款]\x20系统消息已保存到数据库','打开日记失败:','，之前因为某种原因拉黑了用户。现在用户主动向你发来好友申请，希望重新建立联系。\x0a\x0a##\x20角色信息:\x0a-\x20你的身份:\x20','✅\x20已清空线下模式界面内容','visibilityState','不愿意出钱',')\x20⭐推荐','条消息','%c代码受保护，请勿尝试复制！','-btn-item','🎮\x20用户消息（右边）:','\x20个表情包库','\x20\x20成员:','NEW','white','身份面具','已修复','info','🧠\x20添加核心记忆:','abs','✅\x20已为新聊天\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22like-count\x22>','无法解析单个JSON对象:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22memory-modal-item\x22\x20data-memory-id=\x22','translateY(0)','身份不存在'];_0x353c=function(){return _0x19d654;};return _0x353c();}function showUserProfile(){const _0x5db415=_0x2cf6d4;let _0x54ecc9='用户',_0x487f13=_0x5db415(0x19a2);currentChatCharacter[_0x5db415(0x21e2)]&&(_0x54ecc9=currentChatCharacter[_0x5db415(0x21e2)],_0x487f13='群昵称：'+currentChatCharacter[_0x5db415(0x21e2)]),alert('👤\x20我的信息\x0a\x0a昵称：'+_0x54ecc9+_0x5db415(0x2eb)+_0x487f13+_0x5db415(0x19ac));}function createDefaultAvatar(_0x2cf3a7){const _0x112715=_0x2cf6d4,_0x25b464=document[_0x112715(0x1ad8)]('canvas');_0x25b464[_0x112715(0xaab)]=0x32,_0x25b464['height']=0x32;const _0x2d0ff9=_0x25b464['getContext']('2d'),_0x5a50fd=['#FF6B6B','#4ECDC4',_0x112715(0xf1d),_0x112715(0x2236),_0x112715(0x1429),_0x112715(0x256d),_0x112715(0xf96)],_0x264958=_0x5a50fd[_0x2cf3a7[_0x112715(0x1270)](0x0)%_0x5a50fd[_0x112715(0xcbf)]];return _0x2d0ff9['beginPath'](),_0x2d0ff9['arc'](0x19,0x19,0x19,0x0,0x2*Math['PI']),_0x2d0ff9[_0x112715(0x1e78)]=_0x264958,_0x2d0ff9[_0x112715(0x1da0)](),_0x2d0ff9[_0x112715(0x1e78)]=_0x112715(0x241f),_0x2d0ff9['font']='20px\x20Arial',_0x2d0ff9[_0x112715(0xd2d)]='center',_0x2d0ff9['textBaseline']='middle',_0x2d0ff9['fillText'](_0x2cf3a7[_0x112715(0x1518)](0x0),0x19,0x19),_0x25b464[_0x112715(0x577)]();}function createCompressedDefaultAvatar(_0x251a92){const _0x5a2890=_0x2cf6d4,_0x219291=document[_0x5a2890(0x1ad8)](_0x5a2890(0x1def));_0x219291[_0x5a2890(0xaab)]=0x50,_0x219291[_0x5a2890(0x16b8)]=0x50;const _0x574770=_0x219291[_0x5a2890(0x20ff)]('2d'),_0xe47392=[_0x5a2890(0x160e),_0x5a2890(0xdc),_0x5a2890(0xf1d),_0x5a2890(0x2236),'#FECA57','#FF9FF3','#54A0FF'],_0x57db70=_0xe47392[_0x251a92[_0x5a2890(0x1270)](0x0)%_0xe47392['length']];return _0x574770[_0x5a2890(0xa59)](),_0x574770[_0x5a2890(0x2c6)](0x28,0x28,0x28,0x0,0x2*Math['PI']),_0x574770[_0x5a2890(0x1e78)]=_0x57db70,_0x574770[_0x5a2890(0x1da0)](),_0x574770['fillStyle']=_0x5a2890(0x241f),_0x574770[_0x5a2890(0x8ff)]=_0x5a2890(0x15b),_0x574770[_0x5a2890(0xd2d)]=_0x5a2890(0x23a1),_0x574770['textBaseline']=_0x5a2890(0x2197),_0x574770[_0x5a2890(0x194b)](_0x251a92[_0x5a2890(0x1518)](0x0),0x28,0x28),_0x219291[_0x5a2890(0x577)](_0x5a2890(0x1e92));}function showGroupMembers(){const _0x2ec38e=_0x2cf6d4;alert(_0x2ec38e(0xf3a));}async function changeMyGroupNickname(){const _0x9c4aca=_0x2cf6d4;if(!currentChatCharacter||!currentChatCharacter[_0x9c4aca(0x4b7)])return;const _0x46b106=getCurrentChatSettings(),_0x3ae7c7=personas['find'](_0x3e52ca=>_0x3e52ca['id']===_0x46b106[_0x9c4aca(0x6a0)]),_0x3246ba=_0x46b106['myChatNickname']||(_0x3ae7c7?_0x3ae7c7[_0x9c4aca(0x222f)]:'用户'),_0x311cda=prompt(_0x9c4aca(0x2ef),_0x3246ba);if(_0x311cda&&_0x311cda['trim']()!==''&&_0x311cda[_0x9c4aca(0x1424)]()!==_0x3246ba){const _0x1a591e=_0x311cda[_0x9c4aca(0x1424)]();_0x46b106[_0x9c4aca(0xb42)]=_0x1a591e,await saveCurrentChatSettings(_0x46b106);const _0x2f9b1d={'id':_0x9c4aca(0xf32)+Date[_0x9c4aca(0x18e0)](),'sender':_0x9c4aca(0x212),'content':_0x9c4aca(0x855)+_0x1a591e+'\x22','timestamp':Date[_0x9c4aca(0x18e0)]()};!chatMessages[currentChatCharacter['id']]&&(chatMessages[currentChatCharacter['id']]=[]);chatMessages[currentChatCharacter['id']][_0x9c4aca(0x6ee)](_0x2f9b1d);try{await saveChatMessagesImmediate([currentChatCharacter['id']]),console['log']('✅\x20[高效群昵称修改]\x20消息已保存到数据库');}catch(_0x28b698){console[_0x9c4aca(0x24ab)](_0x9c4aca(0x19b9),_0x28b698),await saveChatMessages();}updateGroupChatInfo(),renderChatMessages(currentChatCharacter['id']),showToast('群昵称修改成功！',_0x9c4aca(0xb27));}}async function changeMyGroupAvatar(){const _0x2efc53=_0x2cf6d4;if(!currentChatCharacter)return;const _0x56224b=document[_0x2efc53(0x1ad8)]('input');_0x56224b[_0x2efc53(0x23df)]=_0x2efc53(0x199b),_0x56224b[_0x2efc53(0xd28)]=_0x2efc53(0x2239),_0x56224b[_0x2efc53(0x655)]['display']=_0x2efc53(0xfe9),_0x56224b[_0x2efc53(0x1889)]=async _0x4ef2bb=>{const _0x18cd81=_0x2efc53;if(!_0x4ef2bb[_0x18cd81(0x1144)][_0x18cd81(0x173e)]||!_0x4ef2bb[_0x18cd81(0x1144)][_0x18cd81(0x173e)][0x0])return;const _0x145ab9=_0x4ef2bb['target']['files'][0x0],_0x48ef46=new FileReader();_0x48ef46[_0x18cd81(0xc28)]=async _0x21aecd=>{const _0x58fa2d=_0x18cd81,_0x21cfcd=_0x21aecd[_0x58fa2d(0x1144)][_0x58fa2d(0x1fff)],_0x415b8b=getCurrentChatSettings();_0x415b8b[_0x58fa2d(0x13af)]=_0x21cfcd,await saveCurrentChatSettings(_0x415b8b);const _0x390264={'id':_0x58fa2d(0xf32)+Date[_0x58fa2d(0x18e0)](),'sender':_0x58fa2d(0x212),'content':_0x58fa2d(0x2453),'timestamp':Date['now']()};!chatMessages[currentChatCharacter['id']]&&(chatMessages[currentChatCharacter['id']]=[]);chatMessages[currentChatCharacter['id']][_0x58fa2d(0x6ee)](_0x390264);try{await saveChatMessagesImmediate([currentChatCharacter['id']]),console[_0x58fa2d(0xc0d)](_0x58fa2d(0x1204));}catch(_0x2b99d0){console['error'](_0x58fa2d(0xc9b),_0x2b99d0),await saveChatMessages();}updateGroupChatInfo(),renderChatMessages(currentChatCharacter['id']),showToast('群头像更换成功！',_0x58fa2d(0xb27));},_0x48ef46[_0x18cd81(0x145e)](_0x145ab9),document[_0x18cd81(0x172c)][_0x18cd81(0x1624)](_0x56224b);},document['body']['appendChild'](_0x56224b),_0x56224b['click']();}function editGroupDescription(){const _0x2d090c=_0x2cf6d4;if(!currentChatCharacter||!currentChatCharacter[_0x2d090c(0x4b7)])return;showGroupNoticeModal();}function showGroupNoticeModal(){const _0x12948c=_0x2cf6d4,_0x89a1ee=document[_0x12948c(0x566)]('group-notice-modal'),_0x1c303a=document[_0x12948c(0x566)]('group-notice-content'),_0x496225=document[_0x12948c(0x566)](_0x12948c(0xc6f)),_0x197068=currentChatCharacter?.['description']||'';_0x1c303a[_0x12948c(0xc34)]=_0x197068,_0x496225[_0x12948c(0x21dc)]=_0x197068['length'],_0x1c303a['addEventListener']('input',updateNoticeCharCount),_0x89a1ee[_0x12948c(0x655)]['display']=_0x12948c(0x1f0b),setTimeout(()=>_0x1c303a[_0x12948c(0x1b12)](),0x64);}function hideGroupNoticeModal(){const _0x13775e=_0x2cf6d4,_0x585864=document['getElementById']('group-notice-modal'),_0x2679ec=document[_0x13775e(0x566)]('group-notice-content');_0x2679ec[_0x13775e(0x6be)](_0x13775e(0x627),updateNoticeCharCount),_0x585864[_0x13775e(0x655)]['display']='none';}function updateNoticeCharCount(){const _0x20da68=_0x2cf6d4,_0x4b5283=document[_0x20da68(0x566)](_0x20da68(0x2489)),_0xd104b8=document[_0x20da68(0x566)]('notice-char-current');_0xd104b8['textContent']=_0x4b5283[_0x20da68(0xc34)][_0x20da68(0xcbf)];if(_0x4b5283[_0x20da68(0xc34)][_0x20da68(0xcbf)]>0x1f4)_0xd104b8['style'][_0x20da68(0x2099)]=_0x20da68(0x919);else _0x4b5283[_0x20da68(0xc34)]['length']>0x1c2?_0xd104b8['style'][_0x20da68(0x2099)]=_0x20da68(0x111d):_0xd104b8[_0x20da68(0x655)][_0x20da68(0x2099)]=_0x20da68(0x1f03);}function saveGroupNotice(){const _0x13ee9f=_0x2cf6d4,_0xbb4400=document[_0x13ee9f(0x566)](_0x13ee9f(0x2489)),_0x29d52e=_0xbb4400[_0x13ee9f(0xc34)][_0x13ee9f(0x1424)]();if(_0x29d52e[_0x13ee9f(0xcbf)]>0x1f4){alert('群公告内容不能超过500字');return;}currentChatCharacter['description']=_0x29d52e;if(groupChats){const _0x4e65fe=groupChats['findIndex'](_0x2fef38=>_0x2fef38['id']===currentChatCharacter['id']);_0x4e65fe!==-0x1&&(groupChats[_0x4e65fe][_0x13ee9f(0x1c6f)]=_0x29d52e,saveGroupChats(groupChats));}updateGroupChatInfo(),hideGroupNoticeModal(),showToast(_0x13ee9f(0x1e7f),_0x13ee9f(0xb27));}function addGroupMember(){const _0x241af4=_0x2cf6d4;if(!currentChatCharacter||!currentChatCharacter[_0x241af4(0x4b7)])return;if(!characters||characters[_0x241af4(0xcbf)]===0x0){alert(_0x241af4(0xc84));return;}const _0x1d8047=currentChatCharacter[_0x241af4(0xcaa)]?currentChatCharacter[_0x241af4(0xcaa)]['map'](_0x5dc341=>_0x5dc341['id']):[],_0x4f4402=characters['filter'](_0x239d9f=>!_0x1d8047[_0x241af4(0x23ec)](_0x239d9f['id']));if(_0x4f4402[_0x241af4(0xcbf)]===0x0){alert(_0x241af4(0x1ba9));return;}showCharacterSelectionModal(_0x4f4402,_0x241af4(0x54b),_0x241af4(0xf56),_0x3e4fe5=>{const _0x818982=_0x241af4;!currentChatCharacter[_0x818982(0xcaa)]&&(currentChatCharacter[_0x818982(0xcaa)]=[]);currentChatCharacter[_0x818982(0xcaa)]['push']({'id':_0x3e4fe5['id'],'name':_0x3e4fe5[_0x818982(0x222f)],'avatarUrl':_0x3e4fe5[_0x818982(0x10f9)]});if(groupChats){const _0x28adb3=groupChats[_0x818982(0x23ba)](_0x470052=>_0x470052['id']===currentChatCharacter['id']);_0x28adb3!==-0x1&&(groupChats[_0x28adb3]['members']=currentChatCharacter[_0x818982(0xcaa)],saveGroupChats(groupChats));}const _0x3386f5={'id':Date[_0x818982(0x18e0)]()[_0x818982(0x9a3)](),'content':_0x3e4fe5[_0x818982(0x222f)]+_0x818982(0x1a5d),'timestamp':Date[_0x818982(0x18e0)](),'sender':_0x818982(0x212),'type':_0x818982(0x1cbd)};!chatMessages[currentChatCharacter['id']]&&(chatMessages[currentChatCharacter['id']]=[]);chatMessages[currentChatCharacter['id']][_0x818982(0x6ee)](_0x3386f5),((async()=>{const _0x5075aa=_0x818982;try{const _0x3f21c7=currentChatCharacter['id']+'_'+_0x3386f5['id']+'_'+(chatMessages[currentChatCharacter['id']][_0x5075aa(0xcbf)]-0x1);await db[_0x5075aa(0x464)][_0x5075aa(0xe1)]({'id':_0x3f21c7,'characterId':currentChatCharacter['id'],'timestamp':_0x3386f5[_0x5075aa(0x7aa)],'messageOrder':chatMessages[currentChatCharacter['id']]['length']-0x1,'originalMessageId':_0x3386f5['id'],'messageData':_0x3386f5}),console[_0x5075aa(0xc0d)](_0x5075aa(0x1a05));}catch(_0x54518f){console[_0x5075aa(0x24ab)]('群成员加入消息单条保存失败，回退到防抖保存:',_0x54518f),saveChatMessages();}})()),updateGroupChatInfo(),renderChatMessages(currentChatCharacter['id']);const _0x268818=document['getElementById'](_0x818982(0x1cc6));if(_0x268818){let _0x4c67a5=currentChatCharacter[_0x818982(0x222f)];const _0x514ed3=currentChatCharacter[_0x818982(0xcaa)][_0x818982(0xcbf)]+0x1;_0x4c67a5=_0x4c67a5+'（'+_0x514ed3+'）',_0x268818[_0x818982(0x21dc)]=_0x4c67a5,_0x268818['classList'][_0x818982(0x128)](_0x818982(0x478)),_0x268818['dataset'][_0x818982(0x1c53)]=_0x4c67a5;}showToast('✅\x20'+_0x3e4fe5['name']+_0x818982(0x22d0),_0x818982(0xb27));});}function removeGroupMember(){const _0x249e8b=_0x2cf6d4;if(!currentChatCharacter||!currentChatCharacter['isGroup']||!currentChatCharacter[_0x249e8b(0xcaa)])return;if(currentChatCharacter[_0x249e8b(0xcaa)]['length']<=0x1){alert(_0x249e8b(0x43d));return;}showCharacterSelectionModal(currentChatCharacter[_0x249e8b(0xcaa)],_0x249e8b(0x169f),'请选择要移出群聊的成员：',_0x56bd9a=>{const _0x8be213=_0x249e8b;if(confirm(_0x8be213(0x667)+_0x56bd9a[_0x8be213(0x222f)]+_0x8be213(0x1ec9))){const _0x15f1bf=currentChatCharacter[_0x8be213(0xcaa)]['findIndex'](_0x2680ec=>_0x2680ec['id']===_0x56bd9a['id']);if(_0x15f1bf!==-0x1){currentChatCharacter[_0x8be213(0xcaa)][_0x8be213(0x220f)](_0x15f1bf,0x1);const _0x5f67fe={'id':Date['now']()[_0x8be213(0x9a3)](),'content':_0x56bd9a[_0x8be213(0x222f)]+'\x20退出了群聊','timestamp':Date[_0x8be213(0x18e0)](),'sender':_0x8be213(0x212),'type':_0x8be213(0x1cbd)};!chatMessages[currentChatCharacter['id']]&&(chatMessages[currentChatCharacter['id']]=[]);chatMessages[currentChatCharacter['id']][_0x8be213(0x6ee)](_0x5f67fe),saveChatMessages();if(groupChats){const _0x4ee776=groupChats['findIndex'](_0x17ee11=>_0x17ee11['id']===currentChatCharacter['id']);_0x4ee776!==-0x1&&(groupChats[_0x4ee776]['members']=currentChatCharacter[_0x8be213(0xcaa)],saveGroupChats(groupChats));}updateGroupChatInfo(),renderChatMessages(currentChatCharacter['id']);const _0x348dac=document['getElementById']('api-chat-title');if(_0x348dac){let _0x114702=currentChatCharacter[_0x8be213(0x222f)];const _0x175cf4=currentChatCharacter['members'][_0x8be213(0xcbf)]+0x1;_0x114702=_0x114702+'（'+_0x175cf4+'）',_0x348dac[_0x8be213(0x21dc)]=_0x114702,_0x348dac[_0x8be213(0x226e)][_0x8be213(0x128)](_0x8be213(0x478)),_0x348dac['dataset'][_0x8be213(0x1c53)]=_0x114702;}showToast('✅\x20'+_0x56bd9a['name']+_0x8be213(0x1119),_0x8be213(0xb27));}}});}function showGroupNotice(){const _0x4fa62e=_0x2cf6d4,_0x392e9c=currentChatCharacter?.[_0x4fa62e(0x1c6f)]||_0x4fa62e(0x24a9);alert(_0x4fa62e(0x251c)+_0x392e9c+_0x4fa62e(0xecd));}function showCharacterSelectionModal(_0x200ddb,_0x567d97,_0x4b1cd1,_0x5b96ba){const _0x298ad3=_0x2cf6d4,_0x1b8beb=_0x298ad3(0x1ba6)+_0x567d97+_0x298ad3(0x76e)+_0x4b1cd1+_0x298ad3(0x1c03)+_0x200ddb[_0x298ad3(0xf6d)](_0x44c025=>'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22character-selection-item\x22\x20data-character-id=\x22'+_0x44c025['id']+_0x298ad3(0xcad)+(_0x44c025[_0x298ad3(0x10f9)]||createDefaultAvatar(_0x44c025['name']))+_0x298ad3(0x1ca8)+_0x44c025[_0x298ad3(0x222f)]+_0x298ad3(0x5ee)+_0x44c025['name']+_0x298ad3(0x1e5d)+(_0x44c025[_0x298ad3(0x1c6f)]||_0x44c025[_0x298ad3(0x1a84)]||_0x298ad3(0x1b7a))[_0x298ad3(0x4b2)](0x0,0x1e)+((_0x44c025['description']||_0x44c025[_0x298ad3(0x1a84)]||'')['length']>0x1e?'...':'')+_0x298ad3(0xd88))[_0x298ad3(0x140c)]('')+_0x298ad3(0x12c2),_0x51a929=document[_0x298ad3(0x566)](_0x298ad3(0x1dbb));_0x51a929&&_0x51a929[_0x298ad3(0x128)](),document['body'][_0x298ad3(0x22ba)]('beforeend',_0x1b8beb),window[_0x298ad3(0x21f5)]=_0x5b96ba,window['selectedCharacterId']=null,document[_0x298ad3(0x1ed9)](_0x298ad3(0x12c9))[_0x298ad3(0x900)](_0x495fd8=>{_0x495fd8['addEventListener']('click',function(){const _0x2473b3=_0x3a81;document[_0x2473b3(0x1ed9)]('.character-selection-item')[_0x2473b3(0x900)](_0xc9ff92=>_0xc9ff92[_0x2473b3(0x226e)][_0x2473b3(0x128)](_0x2473b3(0x876))),this['classList'][_0x2473b3(0xe1)](_0x2473b3(0x876)),window[_0x2473b3(0x1bfb)]=this['dataset'][_0x2473b3(0x10df)],document[_0x2473b3(0x566)](_0x2473b3(0x1f11))[_0x2473b3(0x194e)]=![];});});}function hideCharacterSelectionModal(){const _0x317c3b=_0x2cf6d4,_0x38d3b4=document[_0x317c3b(0x566)](_0x317c3b(0x1dbb));_0x38d3b4&&_0x38d3b4['remove'](),window[_0x317c3b(0x21f5)]=null,window[_0x317c3b(0x1bfb)]=null;}function confirmCharacterSelection(){const _0x4a1f32=_0x2cf6d4;if(!window['selectedCharacterId']||!window[_0x4a1f32(0x21f5)])return;const _0x2247ad=[...characters,...currentChatCharacter[_0x4a1f32(0xcaa)]||[]],_0x526318=_0x2247ad['find'](_0x1b72dd=>_0x1b72dd['id']===window[_0x4a1f32(0x1bfb)]);_0x526318&&(window[_0x4a1f32(0x21f5)](_0x526318),hideCharacterSelectionModal());}function changeMemberAvatar(_0xec665a,_0xfd05a6){const _0x1b651d=_0x2cf6d4;_0xfd05a6[_0x1b651d(0x1023)]();const _0xa09494=currentChatCharacter[_0x1b651d(0xcaa)][_0x1b651d(0x1aeb)](_0x239f77=>_0x239f77['id']===_0xec665a);if(!_0xa09494)return;showMemberAvatarModal(_0xa09494);}function showMemberAvatarModal(_0x2931f8){const _0x87b41c=_0x2cf6d4,_0x340558=document[_0x87b41c(0x566)](_0x87b41c(0x20cb)),_0xc88192=document[_0x87b41c(0x566)]('member-avatar-preview'),_0x37c2f1=document['getElementById']('member-avatar-name'),_0x345cd1=document[_0x87b41c(0x566)](_0x87b41c(0xc3e));window[_0x87b41c(0x215e)]=_0x2931f8,_0x37c2f1['textContent']=_0x2931f8[_0x87b41c(0x222f)],_0xc88192[_0x87b41c(0x107)]=_0x2931f8[_0x87b41c(0x10f9)]||createDefaultAvatar(_0x2931f8[_0x87b41c(0x222f)]),_0x345cd1[_0x87b41c(0xc34)]='',_0x340558[_0x87b41c(0x655)][_0x87b41c(0x2526)]=_0x87b41c(0x1f0b);}function hideMemberAvatarModal(){const _0x39929f=_0x2cf6d4,_0x3de34e=document[_0x39929f(0x566)](_0x39929f(0x20cb));_0x3de34e[_0x39929f(0x655)][_0x39929f(0x2526)]=_0x39929f(0xfe9),window[_0x39929f(0x215e)]=null;}function handleMemberAvatarUpload(){const _0x246ba9=_0x2cf6d4,_0x10f97f=document['getElementById'](_0x246ba9(0xc3e));_0x10f97f[_0x246ba9(0x1e62)]();}async function saveMemberAvatar(){const _0x2573bc=_0x2cf6d4;if(!window[_0x2573bc(0x215e)])return;const _0x56da22=document['getElementById'](_0x2573bc(0x19db)),_0x3ad5d7=_0x56da22[_0x2573bc(0x107)],_0x595c8d=currentChatCharacter['members'][_0x2573bc(0x23ba)](_0x3e8053=>_0x3e8053['id']===window[_0x2573bc(0x215e)]['id']);if(_0x595c8d!==-0x1){currentChatCharacter[_0x2573bc(0xcaa)][_0x595c8d][_0x2573bc(0x10f9)]=_0x3ad5d7;const _0x1214d1=characters[_0x2573bc(0x23ba)](_0x3e7ffd=>_0x3e7ffd['id']===window[_0x2573bc(0x215e)]['id']);_0x1214d1!==-0x1&&(characters[_0x1214d1]['avatarUrl']=_0x3ad5d7,saveCharacters(characters));if(groupChats){const _0x3c57c1=groupChats[_0x2573bc(0x23ba)](_0x4fd2b8=>_0x4fd2b8['id']===currentChatCharacter['id']);_0x3c57c1!==-0x1&&(groupChats[_0x3c57c1]['members']=currentChatCharacter[_0x2573bc(0xcaa)],saveGroupChats(groupChats));}await addAvatarChangeMessage(window['currentEditingMember']['name']),updateGroupChatInfo(),renderGroupMembersGrid(),refreshChatMessages(),showToast('✅\x20'+window[_0x2573bc(0x215e)][_0x2573bc(0x222f)]+'\x20的头像已更新',_0x2573bc(0xb27));}hideMemberAvatarModal();}async function addAvatarChangeMessage(_0x24fc44){const _0x17ccfb=_0x2cf6d4;(!currentChatCharacter||!chatMessages[currentChatCharacter['id']])&&(chatMessages[currentChatCharacter['id']]=[]);const _0x1697d7={'id':_0x17ccfb(0xf32)+Date[_0x17ccfb(0x18e0)](),'sender':_0x17ccfb(0x212),'content':_0x24fc44+'\x20更换了头像','timestamp':Date[_0x17ccfb(0x18e0)](),'isSystem':!![]};chatMessages[currentChatCharacter['id']][_0x17ccfb(0x6ee)](_0x1697d7);try{const _0x509d02=currentChatCharacter['id']+'_'+_0x1697d7['id']+'_'+(chatMessages[currentChatCharacter['id']][_0x17ccfb(0xcbf)]-0x1);await db[_0x17ccfb(0x464)][_0x17ccfb(0xe1)]({'id':_0x509d02,'characterId':currentChatCharacter['id'],'timestamp':_0x1697d7[_0x17ccfb(0x7aa)],'messageOrder':chatMessages[currentChatCharacter['id']][_0x17ccfb(0xcbf)]-0x1,'originalMessageId':_0x1697d7['id'],'messageData':_0x1697d7}),console['log'](_0x17ccfb(0x213d));}catch(_0x4f7c7f){console[_0x17ccfb(0x24ab)](_0x17ccfb(0x986),_0x4f7c7f),saveChatMessages();}currentChatCharacter&&renderChatMessages(currentChatCharacter['id']);}function refreshChatMessages(){currentChatCharacter&&renderChatMessages(currentChatCharacter['id']);}function resetMemberAvatar(){const _0x3a6fe3=_0x2cf6d4;if(!window[_0x3a6fe3(0x215e)])return;const _0x508d87=document['getElementById'](_0x3a6fe3(0x19db)),_0x75a582=createDefaultAvatar(window[_0x3a6fe3(0x215e)]['name']);_0x508d87[_0x3a6fe3(0x107)]=_0x75a582;}async function checkAndFixChatHistory(){const _0x3e5620=_0x2cf6d4;try{console[_0x3e5620(0xc0d)](_0x3e5620(0x24d9));const _0x518e7b=await db[_0x3e5620(0x464)]['toArray'](),_0x127c66=chatMessages;console['log']('IndexedDB中的消息数:',_0x518e7b[_0x3e5620(0xcbf)]),console[_0x3e5620(0xc0d)](_0x3e5620(0x906),Object[_0x3e5620(0x16c7)](_0x127c66)['length']);const _0x5e9e01=localStorage[_0x3e5620(0x2250)](_0x3e5620(0x464));if(_0x5e9e01)try{const _0x59353b=JSON[_0x3e5620(0x168e)](_0x5e9e01);console[_0x3e5620(0xc0d)](_0x3e5620(0xf10));let _0x1cb86f=![],_0xe77496=0x0;for(const [_0x3fb598,_0x3d6d34]of Object[_0x3e5620(0x230e)](_0x59353b)){if(_0x3d6d34&&_0x3d6d34[_0x3e5620(0xcbf)]>0x0){const _0xa76260=Math[_0x3e5620(0x910)](..._0x3d6d34[_0x3e5620(0xf6d)](_0x1a3fc4=>_0x1a3fc4['timestamp']||0x0)),_0x1df33b=_0x127c66[_0x3fb598]||[],_0x362ab7=_0x1df33b['length']>0x0?Math['max'](..._0x1df33b[_0x3e5620(0xf6d)](_0x3cbc9e=>_0x3cbc9e[_0x3e5620(0x7aa)]||0x0)):0x0;_0xa76260>_0x362ab7&&(console[_0x3e5620(0xc0d)](_0x3e5620(0x13a3)+_0x3fb598+'\x20的备份数据更新\x20(备份:'+new Date(_0xa76260)+_0x3e5620(0xcf2)+new Date(_0x362ab7)+')'),_0x1cb86f=!![],_0xe77496+=_0x3d6d34[_0x3e5620(0xcbf)]-_0x1df33b[_0x3e5620(0xcbf)]);}}if(_0x1cb86f){const _0x2f6ce4=confirm(_0x3e5620(0x195e)+_0xe77496+_0x3e5620(0xd2));if(_0x2f6ce4){Object['assign'](chatMessages,_0x59353b);try{const _0x4ab906=Object['keys'](_0x59353b);await saveChatMessagesImmediate(_0x4ab906),console['log'](_0x3e5620(0xf2d));}catch(_0x106be7){console[_0x3e5620(0x24ab)](_0x3e5620(0x2149),_0x106be7),await saveChatMessages();}return currentChatCharacter&&renderChatMessages(currentChatCharacter['id']),showToast(_0x3e5620(0xdd2)+_0xe77496+_0x3e5620(0x216d),_0x3e5620(0xb27)),!![];}}}catch(_0x4abaef){console['error'](_0x3e5620(0x21af),_0x4abaef);}let _0x43ffcc=0x0;const _0x570808=Date[_0x3e5620(0x18e0)](),_0x5d3cd6=_0x570808-0x7*0x18*0x3c*0x3c*0x3e8;for(const [_0x4719a1,_0x293f0c]of Object[_0x3e5620(0x230e)](chatMessages)){if(_0x293f0c&&Array['isArray'](_0x293f0c)){for(let _0x2a98b4=0x0;_0x2a98b4<_0x293f0c[_0x3e5620(0xcbf)];_0x2a98b4++){const _0x4c99ae=_0x293f0c[_0x2a98b4];if(!_0x4c99ae[_0x3e5620(0x7aa)]||_0x4c99ae['timestamp']>_0x570808||_0x4c99ae[_0x3e5620(0x7aa)]<_0x5d3cd6){const _0x4406fc=_0x570808-(_0x293f0c[_0x3e5620(0xcbf)]-_0x2a98b4)*0xea60;console['log'](_0x3e5620(0x2235)+_0x4c99ae[_0x3e5620(0x7aa)]+_0x3e5620(0x14e4)+_0x4406fc),_0x4c99ae['timestamp']=_0x4406fc,_0x43ffcc++;}}_0x293f0c['sort']((_0x1fae65,_0x2b2b71)=>_0x1fae65[_0x3e5620(0x7aa)]-_0x2b2b71[_0x3e5620(0x7aa)]);}}if(_0x43ffcc>0x0){try{const _0x5d19ca=Object[_0x3e5620(0x16c7)](chatMessages)[_0x3e5620(0x803)](_0x486fc7=>chatMessages[_0x486fc7]&&chatMessages[_0x486fc7][_0x3e5620(0xcbf)]>0x0);await saveChatMessagesImmediate(_0x5d19ca),console['log']('✅\x20[高效时间戳修复]\x20消息已保存到数据库');}catch(_0x1e10b8){console[_0x3e5620(0x24ab)](_0x3e5620(0x1663),_0x1e10b8),await saveChatMessages();}showToast(_0x3e5620(0x22bd)+_0x43ffcc+_0x3e5620(0x17fd),'info');}return![];}catch(_0xa77c12){return console[_0x3e5620(0x24ab)](_0x3e5620(0x5d8),_0xa77c12),![];}}function showToast(_0x27b7aa,_0x2c120d='info'){const _0x411689=_0x2cf6d4,_0x42fdae=document[_0x411689(0x1ad8)](_0x411689(0x526));_0x42fdae[_0x411689(0x221)]=_0x411689(0xb34)+_0x2c120d,_0x42fdae[_0x411689(0x21dc)]=_0x27b7aa,_0x42fdae[_0x411689(0x655)][_0x411689(0x17a3)]=_0x411689(0x131f)+(_0x2c120d===_0x411689(0xb27)?'#4CAF50':_0x2c120d===_0x411689(0x24ab)?_0x411689(0x1dd7):_0x411689(0x207c))+';\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20white;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2012px\x2024px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x2025px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2014px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20z-index:\x2010000;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transition:\x20all\x200.3s\x20ease;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20box-shadow:\x200\x204px\x2012px\x20rgba(0,0,0,0.15);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',document[_0x411689(0x172c)][_0x411689(0x1925)](_0x42fdae),setTimeout(()=>{const _0x654423=_0x411689;_0x42fdae[_0x654423(0x655)][_0x654423(0x671)]='1',_0x42fdae[_0x654423(0x655)][_0x654423(0x2006)]=_0x654423(0x1d91);},0x64),setTimeout(()=>{const _0x58d5fb=_0x411689;_0x42fdae[_0x58d5fb(0x655)][_0x58d5fb(0x671)]='0',_0x42fdae[_0x58d5fb(0x655)]['transform']=_0x58d5fb(0xc7c),setTimeout(()=>{const _0x47df59=_0x58d5fb;_0x42fdae['parentNode']&&_0x42fdae[_0x47df59(0xe9)][_0x47df59(0x1624)](_0x42fdae);},0x12c);},0xbb8);}function truncateText(_0x59c7ee,_0x3d310a=0x50){const _0x247223=_0x2cf6d4;if(_0x59c7ee===null||_0x59c7ee===undefined)return'';typeof _0x59c7ee!=='string'&&(_0x59c7ee=String(_0x59c7ee));if(!_0x59c7ee||_0x59c7ee['length']<=_0x3d310a)return _0x59c7ee;const _0x50fea3=_0x59c7ee[_0x247223(0x633)]('\x0a');let _0x3f5490='',_0x45ffee=0x0;for(const _0x2c7c32 of _0x50fea3){if(_0x45ffee>=0x3)break;if(_0x3f5490[_0x247223(0xcbf)]+_0x2c7c32[_0x247223(0xcbf)]+0x1<=_0x3d310a)_0x3f5490+=(_0x3f5490?'\x0a':'')+_0x2c7c32,_0x45ffee++;else{const _0x4c19ad=_0x3d310a-_0x3f5490[_0x247223(0xcbf)]-0x1;if(_0x4c19ad>0xa)_0x3f5490+=(_0x3f5490?'\x0a':'')+_0x2c7c32[_0x247223(0x4b2)](0x0,_0x4c19ad-0x3)+_0x247223(0x12da);else!_0x3f5490?_0x3f5490=_0x2c7c32[_0x247223(0x4b2)](0x0,_0x3d310a-0x3)+_0x247223(0x12da):_0x3f5490+=_0x247223(0x12da);break;}}return _0x3f5490;}function enterMessageListMultiSelectMode(_0x4aff9b){const _0x4e1bbb=_0x2cf6d4;console[_0x4e1bbb(0xc0d)](_0x4e1bbb(0x5e2),_0x4aff9b),isMessageListMultiSelectMode=!![],selectedConversations=[_0x4aff9b],renderMessageList(),showToast(_0x4e1bbb(0x238e),_0x4e1bbb(0x2422));}function exitMessageListMultiSelectMode(){isMessageListMultiSelectMode=![],selectedConversations=[],renderMessageList();}function toggleConversationSelection(_0x50f4af){const _0x314699=_0x2cf6d4,_0x417371=selectedConversations[_0x314699(0x167a)](_0x50f4af);_0x417371>-0x1?selectedConversations['splice'](_0x417371,0x1):selectedConversations['push'](_0x50f4af),renderMessageList();}async function deleteSelectedConversations(){const _0x20e0fd=_0x2cf6d4;if(selectedConversations['length']===0x0){showToast(_0x20e0fd(0x122d),_0x20e0fd(0x24ab));return;}const _0x1f4a1b=selectedConversations[_0x20e0fd(0xcbf)],_0x2f30e8=_0x20e0fd(0x5d1)+_0x1f4a1b+_0x20e0fd(0xab6);if(confirm(_0x2f30e8))try{for(const _0xcde0c7 of selectedConversations){chatMessages[_0xcde0c7]&&delete chatMessages[_0xcde0c7];await db[_0x20e0fd(0x464)][_0x20e0fd(0x4a6)](_0x20e0fd(0x10df))['equals'](_0xcde0c7)[_0x20e0fd(0xc2b)](),console[_0x20e0fd(0xc0d)]('✅\x20已删除角色\x20'+_0xcde0c7+_0x20e0fd(0x15e7)),await db[_0x20e0fd(0x75b)]['where'](_0x20e0fd(0x10df))[_0x20e0fd(0x14a)](_0xcde0c7)[_0x20e0fd(0xc2b)](),console[_0x20e0fd(0xc0d)](_0x20e0fd(0x1947)+_0xcde0c7+'\x20的所有工作记忆'),await db[_0x20e0fd(0xb08)][_0x20e0fd(0xc2b)](_0xcde0c7),await db[_0x20e0fd(0x243d)]['where'](_0x20e0fd(0x956))[_0x20e0fd(0x14a)](_0xcde0c7)[_0x20e0fd(0xc2b)](),console[_0x20e0fd(0xc0d)]('✅\x20已删除角色\x20'+_0xcde0c7+_0x20e0fd(0x1f6b));chatSettings[_0xcde0c7]&&delete chatSettings[_0xcde0c7];Object[_0x20e0fd(0x16c7)](chatSettings)[_0x20e0fd(0x900)](_0x562c1f=>{const _0x561f1b=_0x20e0fd;_0x562c1f[_0x561f1b(0x1cab)](_0xcde0c7+_0x561f1b(0x5d5))&&delete chatSettings[_0x562c1f];}),localStorage[_0x20e0fd(0x1c95)](_0x20e0fd(0xc63)+_0xcde0c7);const _0x58a346=characters[_0x20e0fd(0x1aeb)](_0x207c18=>_0x207c18['id']===_0xcde0c7);_0x58a346&&(_0x58a346['background']=null);const _0x15d1ad=groupChats[_0x20e0fd(0x23ba)](_0x135909=>_0x135909['id']===_0xcde0c7);if(_0x15d1ad>-0x1)groupChats[_0x20e0fd(0x220f)](_0x15d1ad,0x1);else{const _0x8797c=contacts[_0x20e0fd(0x167a)](_0xcde0c7);_0x8797c>-0x1&&contacts['splice'](_0x8797c,0x1);}}await Promise[_0x20e0fd(0x2339)]([saveChatMessages(),saveGroupChats(),saveContacts()]),exitMessageListMultiSelectMode(),showToast(_0x20e0fd(0x2272)+_0x1f4a1b+_0x20e0fd(0x2265),_0x20e0fd(0xb27));}catch(_0x57edf4){console[_0x20e0fd(0x24ab)](_0x20e0fd(0x1af0),_0x57edf4),showToast('删除失败，请检查控制台错误信息',_0x20e0fd(0x24ab));}}let currentForumId=null,worldEvent=null,worldEventForumId=null;async function handlePollVote(_0x2ab56a,_0x3263c8){const _0x35277a=_0x2cf6d4,_0x2f72e1=_0x2ab56a[_0x35277a(0x2026)]('.forum-poll');if(!_0x2f72e1)return;const _0x5789f0=_0x2f72e1[_0x35277a(0x1f26)][_0x35277a(0x9c6)]||'single',_0x4b55d0=window['currentPostId'];if(_0x5789f0===_0x35277a(0xc1e)){const _0x5af8eb=localStorage[_0x35277a(0x2250)](_0x35277a(0x139)+_0x4b55d0);if(_0x2f72e1[_0x35277a(0x226e)][_0x35277a(0x1f9)]('voted')||_0x5af8eb&&_0x5af8eb!=='null'){showToast(_0x35277a(0x129b),_0x35277a(0x2422));return;}if(!_0x4b55d0)return;_0x2ab56a[_0x35277a(0x226e)][_0x35277a(0xe1)](_0x35277a(0x654)),_0x2f72e1['classList'][_0x35277a(0xe1)](_0x35277a(0x1ad3));try{const _0x370d29=await db['forumPosts'][_0x35277a(0x46a)](_0x4b55d0);if(!_0x370d29)return;let _0x24df67=_0x3263c8;if(!_0x24df67){const _0x41eb4b=_0x2ab56a[_0x35277a(0x15b8)](_0x35277a(0x1036))?.['textContent']||'';_0x24df67=_0x41eb4b['replace'](/\s+/g,'_')['toLowerCase']();}!_0x370d29[_0x35277a(0x247c)]&&(_0x370d29[_0x35277a(0x247c)]={'totalVotes':0x0,'options':{}});!_0x370d29['pollData']['options'][_0x24df67]&&(_0x370d29[_0x35277a(0x247c)]['options'][_0x24df67]=0x0);_0x370d29[_0x35277a(0x247c)][_0x35277a(0x32b)][_0x24df67]++,_0x370d29['pollData'][_0x35277a(0x5f6)]++,await db[_0x35277a(0x1f71)]['put'](_0x370d29),updatePollUI(_0x4b55d0,_0x370d29[_0x35277a(0x247c)]);const _0x3f4707=_0x2ab56a['querySelector'](_0x35277a(0x1036))?.['textContent']||'';saveVoteRecord(_0x4b55d0,_0x24df67,_0x3f4707,_0x370d29[_0x35277a(0x1c18)]),showToast(_0x35277a(0x149b),_0x35277a(0xb27));}catch(_0x587ec7){console[_0x35277a(0x24ab)](_0x35277a(0x1a63),_0x587ec7),showToast(_0x35277a(0x3f5),_0x35277a(0x24ab));}}else{if(_0x5789f0==='multiple'){const _0x29b8fc=_0x2ab56a[_0x35277a(0x1f26)]['selected']===_0x35277a(0x8f1);_0x2ab56a[_0x35277a(0x1f26)][_0x35277a(0x876)]=!_0x29b8fc,!_0x29b8fc?_0x2ab56a['classList'][_0x35277a(0xe1)](_0x35277a(0x654)):_0x2ab56a[_0x35277a(0x226e)][_0x35277a(0x128)](_0x35277a(0x654));}}}async function submitMultipleChoiceVote(_0x5ad57a){const _0x2c9f62=_0x2cf6d4,_0x13b567=_0x5ad57a['closest'](_0x2c9f62(0x221f)),_0x747305=window[_0x2c9f62(0x11bf)],_0x52479e=_0x13b567['querySelectorAll'](_0x2c9f62(0x960));if(_0x52479e[_0x2c9f62(0xcbf)]===0x0){showToast(_0x2c9f62(0x1e77),_0x2c9f62(0x2422));return;}const _0x8725ec=localStorage[_0x2c9f62(0x2250)]('poll_voted_'+_0x747305);if(_0x13b567[_0x2c9f62(0x226e)][_0x2c9f62(0x1f9)](_0x2c9f62(0x1ad3))||_0x8725ec&&_0x8725ec!=='null'){showToast(_0x2c9f62(0x129b),_0x2c9f62(0x2422));return;}_0x5ad57a['disabled']=!![],_0x5ad57a['textContent']=_0x2c9f62(0x171f);try{const _0xf834af=await db[_0x2c9f62(0x1f71)][_0x2c9f62(0x46a)](_0x747305);if(!_0xf834af)return;!_0xf834af[_0x2c9f62(0x247c)]&&(_0xf834af[_0x2c9f62(0x247c)]={'totalVotes':0x0,'options':{}});let _0x56a570=[];_0x52479e[_0x2c9f62(0x900)](_0x319595=>{const _0x7c3047=_0x2c9f62,_0x23e72b=_0x319595[_0x7c3047(0x1add)](_0x7c3047(0x11cf));let _0x5d34c8='';const _0x1631a7=[/'([^']+)'/,/"([^"]+)"/,/handlePollVote\([^,]+,\s*['"]([^'"]+)['"]\)/];for(const _0x23a582 of _0x1631a7){const _0x4085cc=_0x23e72b[_0x7c3047(0x1316)](_0x23a582);if(_0x4085cc&&_0x4085cc[0x1]){_0x5d34c8=_0x4085cc[0x1];break;}}_0x5d34c8&&(_0x56a570[_0x7c3047(0x6ee)](_0x5d34c8),!_0xf834af[_0x7c3047(0x247c)][_0x7c3047(0x32b)][_0x5d34c8]&&(_0xf834af[_0x7c3047(0x247c)][_0x7c3047(0x32b)][_0x5d34c8]=0x0),_0xf834af[_0x7c3047(0x247c)][_0x7c3047(0x32b)][_0x5d34c8]++,_0xf834af[_0x7c3047(0x247c)][_0x7c3047(0x5f6)]++);}),await db['forumPosts'][_0x2c9f62(0x53a)](_0xf834af),saveVoteRecord(_0x747305,JSON[_0x2c9f62(0x7fb)](_0x56a570),_0x56a570[_0x2c9f62(0xcbf)]+_0x2c9f62(0x1eb9),_0xf834af[_0x2c9f62(0x1c18)]),_0x13b567[_0x2c9f62(0x226e)]['add'](_0x2c9f62(0x1ad3)),updatePollUI(_0x747305,_0xf834af['pollData']),showToast(_0x2c9f62(0x149b),_0x2c9f62(0xb27));}catch(_0x2eda10){console[_0x2c9f62(0x24ab)](_0x2c9f62(0xcb),_0x2eda10),showToast(_0x2c9f62(0x3f5),_0x2c9f62(0x24ab)),_0x5ad57a[_0x2c9f62(0x194e)]=![],_0x5ad57a['textContent']='投票';}}function updatePollUI(_0x3d8970,_0x324b91){const _0x11e20e=_0x2cf6d4,_0x7db36b=document['querySelector'](_0x11e20e(0xa16));if(!_0x7db36b)return;const _0xc1b1c9=_0x324b91['totalVotes']||0x0,_0x1ac26a=_0x7db36b['querySelectorAll'](_0x11e20e(0x14b6)),_0x5bde60=localStorage[_0x11e20e(0x2250)]('poll_voted_'+_0x3d8970);_0x5bde60&&_0x5bde60!==_0x11e20e(0x107e)&&_0x7db36b[_0x11e20e(0x226e)][_0x11e20e(0xe1)](_0x11e20e(0x1ad3)),_0x1ac26a[_0x11e20e(0x900)]((_0x25b86c,_0x4d844d)=>{const _0x4a9293=_0x11e20e,_0x57a146=_0x25b86c[_0x4a9293(0x1add)]('onclick');let _0x22a366='';if(_0x57a146){const _0x3824d9=[/'([^']+)'/,/"([^"]+)"/,/handlePollVote\([^,]+,\s*['"]([^'"]+)['"]\)/];for(const _0x38c139 of _0x3824d9){const _0x21d957=_0x57a146[_0x4a9293(0x1316)](_0x38c139);if(_0x21d957&&_0x21d957[0x1]){_0x22a366=_0x21d957[0x1];break;}}}if(!_0x22a366){const _0x26650d=_0x25b86c[_0x4a9293(0x15b8)](_0x4a9293(0x1036))?.[_0x4a9293(0x21dc)]||'';_0x22a366=_0x26650d[_0x4a9293(0x882)](/\s+/g,'_')[_0x4a9293(0x1d64)](),!_0x57a146&&_0x25b86c[_0x4a9293(0x1dd4)]('onclick','handlePollVote(this,\x20\x27'+_0x22a366+'\x27)');}if(!_0x25b86c[_0x4a9293(0x15b8)](_0x4a9293(0x1b67))){_0x25b86c[_0x4a9293(0x655)][_0x4a9293(0x492)]=_0x4a9293(0x1b89);const _0x22e2f9=document[_0x4a9293(0x1ad8)](_0x4a9293(0x526));_0x22e2f9[_0x4a9293(0x221)]='result-bar-bg';const _0x20002d=document[_0x4a9293(0x1ad8)](_0x4a9293(0x526));_0x20002d['className']=_0x4a9293(0x32e),_0x22e2f9[_0x4a9293(0x1925)](_0x20002d),_0x25b86c['insertBefore'](_0x22e2f9,_0x25b86c[_0x4a9293(0x1bd8)]);}let _0x44724a=_0x324b91['options'][_0x22a366]||0x0;if(_0x44724a===0x0&&Object[_0x4a9293(0x16c7)](_0x324b91['options'])[_0x4a9293(0xcbf)]>0x0){const _0x50b869=_0x25b86c['querySelector'](_0x4a9293(0x1036))?.['textContent']||'';for(const [_0x46ea1f,_0x54fb8d]of Object[_0x4a9293(0x230e)](_0x324b91[_0x4a9293(0x32b)])){if(_0x46ea1f[_0x4a9293(0x23ec)](_0x50b869[_0x4a9293(0x1d64)]())||_0x50b869[_0x4a9293(0x1d64)]()[_0x4a9293(0x23ec)](_0x46ea1f)){_0x44724a=_0x54fb8d,_0x22a366=_0x46ea1f;break;}}}const _0x1276eb=_0xc1b1c9>0x0?(_0x44724a/_0xc1b1c9*0x64)[_0x4a9293(0x3cd)](0x1):0x0;if(_0x5bde60&&_0x5bde60!==_0x4a9293(0x107e))try{const _0xb7cd8d=JSON[_0x4a9293(0x168e)](_0x5bde60);Array['isArray'](_0xb7cd8d)&&_0xb7cd8d[_0x4a9293(0x23ec)](_0x22a366)?_0x25b86c[_0x4a9293(0x226e)][_0x4a9293(0xe1)]('user-voted'):_0x25b86c[_0x4a9293(0x226e)][_0x4a9293(0x128)](_0x4a9293(0x654));}catch(_0x50ea69){_0x22a366===_0x5bde60||_0x5bde60[_0x4a9293(0x23ec)](_0x22a366)||_0x22a366[_0x4a9293(0x23ec)](_0x5bde60)?_0x25b86c['classList'][_0x4a9293(0xe1)]('user-voted'):_0x25b86c['classList']['remove'](_0x4a9293(0x654));}else _0x25b86c[_0x4a9293(0x226e)][_0x4a9293(0x128)](_0x4a9293(0x654));const _0x56d543=_0x25b86c[_0x4a9293(0x15b8)](_0x4a9293(0x980)),_0x2eb18c=_0x25b86c[_0x4a9293(0x15b8)](_0x4a9293(0xf97));_0x56d543&&(_0x56d543['textContent']=_0x44724a+'票\x20('+_0x1276eb+'%)'),_0x2eb18c&&setTimeout(()=>{const _0x5e61f3=_0x4a9293;_0x2eb18c['style'][_0x5e61f3(0xaab)]=_0x1276eb+'%';},0x64+_0x4d844d*0x32);});}async function generateSmartPollData(_0x2b719f,_0x2a9bef){const _0x5eedf7=_0x2cf6d4;if(_0x2a9bef['pollData']&&_0x2a9bef['pollData'][_0x5eedf7(0x5f6)]>0x0){updatePollUI(_0x2b719f,_0x2a9bef['pollData']);return;}const _0x511585=document[_0x5eedf7(0x15b8)](_0x5eedf7(0xa16));if(!_0x511585)return;const _0x450723=_0x511585[_0x5eedf7(0x1ed9)](_0x5eedf7(0x14b6));if(_0x450723[_0x5eedf7(0xcbf)]===0x0)return;const _0x50ed82={'totalVotes':0x0,'options':{}},_0x33d163=Math[_0x5eedf7(0x1dac)](Math[_0x5eedf7(0x191c)]()*0x28)+0xf,_0x59afc8=_0x2a9bef['title']['includes']('颜值')||_0x2a9bef[_0x5eedf7(0x1c18)]['includes']('人气')||_0x2a9bef[_0x5eedf7(0x1c18)][_0x5eedf7(0x23ec)]('最'),_0x504386=_0x59afc8?_0x33d163+Math[_0x5eedf7(0x1dac)](Math[_0x5eedf7(0x191c)]()*0x3c):_0x33d163,_0x3e078e=[];let _0x477988=_0x504386;_0x450723[_0x5eedf7(0x900)]((_0x15218c,_0x27ddac)=>{const _0x523f65=_0x5eedf7,_0x5e0763=_0x27ddac===_0x450723[_0x523f65(0xcbf)]-0x1;if(_0x5e0763)_0x3e078e['push'](_0x477988);else{const _0x42e952=Math[_0x523f65(0x1dac)](_0x477988*0.6),_0x3fe3ec=Math[_0x523f65(0x1dac)](_0x477988*0.1),_0x381fe8=Math[_0x523f65(0x1dac)](Math['random']()*(_0x42e952-_0x3fe3ec+0x1))+_0x3fe3ec;_0x3e078e[_0x523f65(0x6ee)](_0x381fe8),_0x477988-=_0x381fe8;}}),_0x450723[_0x5eedf7(0x900)]((_0x10d27d,_0x4cd826)=>{const _0x49a188=_0x5eedf7,_0x5b0286=_0x10d27d[_0x49a188(0x1add)](_0x49a188(0x11cf));let _0x2e3ade='';if(_0x5b0286){const _0x6f4cfa=_0x5b0286[_0x49a188(0x1316)](/'([^']+)'/);_0x6f4cfa&&_0x6f4cfa[0x1]&&(_0x2e3ade=_0x6f4cfa[0x1]);}if(!_0x2e3ade){const _0x42f617=_0x10d27d[_0x49a188(0x15b8)](_0x49a188(0x1036))?.[_0x49a188(0x21dc)]||'';_0x2e3ade=_0x42f617[_0x49a188(0x882)](/\s+/g,'_')[_0x49a188(0x1d64)]();}_0x50ed82['options'][_0x2e3ade]=_0x3e078e[_0x4cd826],_0x50ed82[_0x49a188(0x5f6)]+=_0x3e078e[_0x4cd826];}),_0x2a9bef[_0x5eedf7(0x247c)]=_0x50ed82,await db['forumPosts'][_0x5eedf7(0x53a)](_0x2a9bef),updatePollUI(_0x2b719f,_0x50ed82);}async function generateSmartPollData(_0x3ac9c6,_0x15c500){const _0x53c1ce=_0x2cf6d4;if(_0x15c500[_0x53c1ce(0x247c)]&&_0x15c500[_0x53c1ce(0x247c)][_0x53c1ce(0x5f6)]>0x0){updatePollUI(_0x3ac9c6,_0x15c500[_0x53c1ce(0x247c)]);return;}const _0x4f351d=document[_0x53c1ce(0x15b8)]('.post-full-body\x20.forum-poll');if(!_0x4f351d)return;const _0x24486d=_0x4f351d[_0x53c1ce(0x1ed9)](_0x53c1ce(0x14b6));if(_0x24486d[_0x53c1ce(0xcbf)]===0x0)return;const _0x2a8e6a=await db[_0x53c1ce(0x1a13)][_0x53c1ce(0x46a)](parseInt(currentForumId)),_0x2b18d2=characters[_0x53c1ce(0x803)](_0x131210=>_0x2a8e6a[_0x53c1ce(0x1572)]['includes'](_0x131210['id'])),_0x557f56={'totalVotes':0x0,'options':{}},_0x547218=Math[_0x53c1ce(0x1dac)](Math['random']()*0x32)+0x14,_0x18bb7b=_0x15c500['title'][_0x53c1ce(0x23ec)](_0x53c1ce(0x922))||_0x15c500[_0x53c1ce(0x1c18)][_0x53c1ce(0x23ec)]('人气')||_0x15c500[_0x53c1ce(0x1c18)][_0x53c1ce(0x23ec)]('最'),_0x56075a=_0x18bb7b?_0x547218+Math['floor'](Math[_0x53c1ce(0x191c)]()*0x50):_0x547218,_0x46c2a8=[];let _0x538254=_0x56075a;_0x24486d[_0x53c1ce(0x900)]((_0x287298,_0x3ccbfc)=>{const _0x1586ce=_0x53c1ce,_0xf0f170=_0x287298[_0x1586ce(0x15b8)](_0x1586ce(0x1036))?.[_0x1586ce(0x21dc)]||'';let _0x5d5fbf=0x1;_0x2a8e6a[_0x1586ce(0x14a1)]&&_0x2a8e6a['worldview'][_0x1586ce(0x23ec)]('娱乐')&&(_0x2b18d2[_0x1586ce(0x184b)](_0x696365=>_0xf0f170[_0x1586ce(0x23ec)](_0x696365[_0x1586ce(0x222f)]))&&(_0x5d5fbf=1.5));_0x2a8e6a[_0x1586ce(0x14a1)]&&_0x2a8e6a[_0x1586ce(0x14a1)][_0x1586ce(0x23ec)]('校园')&&((_0xf0f170['includes']('食堂')||_0xf0f170[_0x1586ce(0x23ec)](_0x1586ce(0x22a4))||_0xf0f170['includes']('宿舍'))&&(_0x5d5fbf=1.3));const _0x43ae93=Math[_0x1586ce(0x1dac)](_0x538254/(_0x24486d['length']-_0x3ccbfc)*_0x5d5fbf),_0x2b4432=Math[_0x1586ce(0x1dac)](Math[_0x1586ce(0x191c)]()*0xa)-0x5,_0x115bb8=Math[_0x1586ce(0x910)](0x0,Math[_0x1586ce(0x21f7)](_0x538254,_0x43ae93+_0x2b4432));_0x46c2a8[_0x1586ce(0x6ee)](_0x115bb8),_0x538254-=_0x115bb8;});while(_0x538254>0x0){const _0x49d952=Math[_0x53c1ce(0x1dac)](Math[_0x53c1ce(0x191c)]()*_0x24486d[_0x53c1ce(0xcbf)]);_0x46c2a8[_0x49d952]++,_0x538254--;}_0x24486d[_0x53c1ce(0x900)]((_0x219121,_0x3b00e4)=>{const _0x434b6f=_0x53c1ce,_0x5b9999=_0x219121[_0x434b6f(0x1add)](_0x434b6f(0x11cf));let _0x55a8e8='';if(_0x5b9999){const _0x34fbaf=_0x5b9999[_0x434b6f(0x1316)](/'([^']+)'/);if(_0x34fbaf&&_0x34fbaf[0x1])_0x55a8e8=_0x34fbaf[0x1];else{const _0x584967=_0x219121[_0x434b6f(0x15b8)]('.option-text')?.[_0x434b6f(0x21dc)]||'';_0x55a8e8=_0x584967[_0x434b6f(0x882)](/\s+/g,'_')[_0x434b6f(0x1d64)]();}}_0x557f56[_0x434b6f(0x32b)][_0x55a8e8]=_0x46c2a8[_0x3b00e4],_0x557f56[_0x434b6f(0x5f6)]+=_0x46c2a8[_0x3b00e4];}),_0x15c500[_0x53c1ce(0x247c)]=_0x557f56,await db[_0x53c1ce(0x1f71)][_0x53c1ce(0x53a)](_0x15c500),updatePollUI(_0x3ac9c6,_0x557f56);}function cleanOldVoteRecords(_0x99e4cd=0x64){const _0x272300=_0x2cf6d4;try{const _0x273e03=Object['keys'](localStorage)[_0x272300(0x803)](_0x4ed49a=>_0x4ed49a[_0x272300(0x1cab)](_0x272300(0x139)))[_0x272300(0xf6d)](_0x976be6=>{const _0x390f61=_0x272300,_0x521ba3=_0x976be6[_0x390f61(0x882)]('poll_voted_','');return{'key':_0x976be6,'postId':parseInt(_0x521ba3),'timestamp':Date[_0x390f61(0x18e0)]()};})[_0x272300(0x1f0d)]((_0x155f1d,_0x911aad)=>_0x911aad[_0x272300(0x12b6)]-_0x155f1d['postId']);if(_0x273e03[_0x272300(0xcbf)]>_0x99e4cd){const _0x6f9b08=_0x273e03[_0x272300(0x136)](_0x99e4cd);_0x6f9b08[_0x272300(0x900)](_0x5bb6dc=>{const _0x3dd565=_0x272300;localStorage[_0x3dd565(0x1c95)](_0x5bb6dc[_0x3dd565(0x157f)]);}),console[_0x272300(0xc0d)](_0x272300(0xc78)+_0x6f9b08[_0x272300(0xcbf)]+_0x272300(0x1f68)+_0x99e4cd+'\x20条');}}catch(_0x2c7d7f){console[_0x272300(0x24ab)](_0x272300(0x2541),_0x2c7d7f);}}function saveVoteRecord(_0xfe9fab,_0xccdb9c,_0x3f6b8f,_0x277aa1){const _0x5837e5=_0x2cf6d4;try{localStorage[_0x5837e5(0x2055)]('poll_voted_'+_0xfe9fab,_0xccdb9c);const _0x384e79={'postId':_0xfe9fab,'postTitle':_0x277aa1||_0x5837e5(0x102c),'optionId':_0xccdb9c,'optionText':_0x3f6b8f||'未知选项','timestamp':Date[_0x5837e5(0x18e0)](),'date':new Date()[_0x5837e5(0x133a)]()};localStorage[_0x5837e5(0x2055)](_0x5837e5(0xa7c)+_0xfe9fab,JSON[_0x5837e5(0x7fb)](_0x384e79)),cleanOldVoteRecords(0x64);}catch(_0x1a819b){console[_0x5837e5(0x24ab)]('保存投票记录失败:',_0x1a819b),cleanOldVoteRecords(0x32);try{localStorage[_0x5837e5(0x2055)](_0x5837e5(0x139)+_0xfe9fab,_0xccdb9c);}catch(_0x46bdb2){console[_0x5837e5(0x24ab)](_0x5837e5(0x43b),_0x46bdb2);}}}function getUserVoteHistory(_0x288ccd=0x14){const _0x1ebd80=_0x2cf6d4;try{const _0x3572de=Object[_0x1ebd80(0x16c7)](localStorage)[_0x1ebd80(0x803)](_0x34c75=>_0x34c75[_0x1ebd80(0x1cab)]('vote_detail_'))[_0x1ebd80(0xf6d)](_0x7e2d31=>{const _0x5f4589=_0x1ebd80;try{return JSON[_0x5f4589(0x168e)](localStorage[_0x5f4589(0x2250)](_0x7e2d31));}catch{return null;}})[_0x1ebd80(0x803)](_0x3e479e=>_0x3e479e!==null)[_0x1ebd80(0x1f0d)]((_0x5059eb,_0x30b1d9)=>_0x30b1d9['timestamp']-_0x5059eb[_0x1ebd80(0x7aa)])[_0x1ebd80(0x136)](0x0,_0x288ccd);return _0x3572de;}catch(_0x27d9d6){return console['error'](_0x1ebd80(0x183a),_0x27d9d6),[];}}function showVoteHistory(){const _0x3d5feb=_0x2cf6d4,_0x136051=getUserVoteHistory(0x32);if(_0x136051[_0x3d5feb(0xcbf)]===0x0){showToast(_0x3d5feb(0x1a2b),_0x3d5feb(0x2422));return;}const _0x3830b0=_0x136051[_0x3d5feb(0xf6d)](_0x861b27=>_0x3d5feb(0x7eb)+_0x861b27['postTitle']+_0x3d5feb(0x124b)+_0x861b27[_0x3d5feb(0x38a)]+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22vote-date\x22>'+_0x861b27[_0x3d5feb(0x1c5b)]+_0x3d5feb(0x24bf))[_0x3d5feb(0x140c)](''),_0x37d5f8=_0x3d5feb(0x1b5e)+_0x3830b0+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-secondary\x22\x20onclick=\x22closeModal()\x22>关闭</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-danger\x22\x20onclick=\x22clearVoteHistory()\x22>清空历史</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';document['body']['insertAdjacentHTML']('beforeend',_0x37d5f8);}async function showCreateForumScreen(){const _0x32cb7f=_0x2cf6d4;hideApp(_0x32cb7f(0x1bc3));const _0x37d560=document[_0x32cb7f(0x566)](_0x32cb7f(0x12b9)),_0x3e3dfc=document['getElementById'](_0x32cb7f(0x1258)),_0x319522=document[_0x32cb7f(0x566)](_0x32cb7f(0x2270));document['getElementById'](_0x32cb7f(0x2433))['value']='',document['getElementById'](_0x32cb7f(0xa2b))[_0x32cb7f(0xc34)]='',document[_0x32cb7f(0x566)](_0x32cb7f(0x2db))[_0x32cb7f(0xc34)]='',document[_0x32cb7f(0x566)](_0x32cb7f(0x15bf))['textContent']=_0x32cb7f(0x1e33),document[_0x32cb7f(0x566)](_0x32cb7f(0xb9e))[_0x32cb7f(0x21dc)]=_0x32cb7f(0x1b9),_0x37d560[_0x32cb7f(0xc02)]=characters['map'](_0x567124=>_0x32cb7f(0x2510)+_0x567124['id']+_0x32cb7f(0x1737)+(_0x567124[_0x32cb7f(0x10f9)]||createDefaultAvatar(_0x567124[_0x32cb7f(0x222f)]))+_0x32cb7f(0x1ca8)+_0x567124[_0x32cb7f(0x222f)]+_0x32cb7f(0x1f40)+_0x567124[_0x32cb7f(0x222f)]+_0x32cb7f(0x24bf))[_0x32cb7f(0x140c)](''),_0x3e3dfc[_0x32cb7f(0xc02)]=personas['map'](_0x477584=>_0x32cb7f(0x2510)+_0x477584['id']+_0x32cb7f(0x13b7)+(_0x477584[_0x32cb7f(0x10f9)]||createDefaultAvatar(_0x477584[_0x32cb7f(0x222f)]))+_0x32cb7f(0x1ca8)+_0x477584[_0x32cb7f(0x222f)]+_0x32cb7f(0x1f40)+_0x477584['name']+_0x32cb7f(0x24bf))[_0x32cb7f(0x140c)]('');const _0x13358a=worldbooks['filter'](_0x468efd=>!_0x468efd[_0x32cb7f(0x58b)]);_0x13358a[_0x32cb7f(0xcbf)]>0x0?_0x319522[_0x32cb7f(0xc02)]=_0x13358a[_0x32cb7f(0xf6d)](_0x210754=>'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22selection-item\x22\x20data-id=\x22'+_0x210754['id']+_0x32cb7f(0x1bf8)+(_0x210754[_0x32cb7f(0x1c18)]||_0x210754[_0x32cb7f(0x222f)])+_0x32cb7f(0x92d))[_0x32cb7f(0x140c)](''):_0x319522[_0x32cb7f(0xc02)]='<p\x20style=\x22color:\x20#999;\x20font-size:\x2012px;\x20text-align:\x20center;\x22>暂无局部世界书</p>',showApp('create-forum-screen');}function toggleSelection(_0x158fd7,_0x5320ef=![]){const _0x167574=_0x2cf6d4,_0x312a7d=_0x158fd7[_0x167574(0x666)];if(_0x5320ef){const _0x2b0a89=_0x312a7d['querySelector'](_0x167574(0xd12));_0x2b0a89&&_0x2b0a89['classList'][_0x167574(0x128)](_0x167574(0x876));}_0x158fd7[_0x167574(0x226e)][_0x167574(0xfbd)]('selected');}async function deleteForum(_0x4951d0,_0x57add4){const _0x1a150a=_0x2cf6d4;_0x57add4[_0x1a150a(0x1023)]();const _0x1fc70e=await db[_0x1a150a(0x1a13)][_0x1a150a(0x46a)](parseInt(_0x4951d0));if(!_0x1fc70e){alert(_0x1a150a(0x178));return;}if(confirm(_0x1a150a(0xc2d)+_0x1fc70e[_0x1a150a(0x222f)]+_0x1a150a(0x1487)))try{const _0x5c4e41=await db[_0x1a150a(0x1f71)]['where'](_0x1a150a(0xe22))[_0x1a150a(0x14a)](parseInt(_0x4951d0))[_0x1a150a(0x18c6)](),_0xd94ff8=_0x5c4e41[_0x1a150a(0xf6d)](_0x2431d3=>_0x2431d3['id']);await db['forums']['delete'](parseInt(_0x4951d0)),await db[_0x1a150a(0x1f71)][_0x1a150a(0x4a6)](_0x1a150a(0xe22))[_0x1a150a(0x14a)](parseInt(_0x4951d0))[_0x1a150a(0xc2b)](),await db[_0x1a150a(0x657)]['where'](_0x1a150a(0xe22))[_0x1a150a(0x14a)](parseInt(_0x4951d0))['delete']();if(_0xd94ff8[_0x1a150a(0xcbf)]>0x0){const _0x155197=[];for(const _0x25e292 of _0xd94ff8){const _0x4f7d8b=await db[_0x1a150a(0x1d3c)][_0x1a150a(0x4a6)]('postId')['equals'](_0x25e292)[_0x1a150a(0x18c6)]();_0x155197['push'](..._0x4f7d8b);}const _0xedb3f3=_0x155197[_0x1a150a(0xf6d)](_0x55bea7=>_0x55bea7['id']);await Promise[_0x1a150a(0x2339)]([..._0xd94ff8[_0x1a150a(0xf6d)](_0x1bbbec=>db[_0x1a150a(0x1d3c)][_0x1a150a(0x4a6)](_0x1a150a(0x12b6))[_0x1a150a(0x14a)](_0x1bbbec)['delete']()),..._0xd94ff8[_0x1a150a(0xf6d)](_0x3e4fc3=>db['forumPostImages'][_0x1a150a(0x4a6)](_0x1a150a(0x12b6))[_0x1a150a(0x14a)](_0x3e4fc3)['delete']())]);for(const _0x22396c of _0xd94ff8){await db[_0x1a150a(0x1dd3)][_0x1a150a(0x4a6)](_0x1a150a(0x12b6))[_0x1a150a(0x14a)](_0x22396c)[_0x1a150a(0xc2b)]();}_0xedb3f3[_0x1a150a(0xcbf)]>0x0&&await Promise[_0x1a150a(0x2339)](_0xedb3f3[_0x1a150a(0xf6d)](_0x1e2afd=>db[_0x1a150a(0x11ba)][_0x1a150a(0x4a6)](_0x1a150a(0x1093))[_0x1a150a(0x14a)](_0x1e2afd)['delete']()));}showToast('论坛\x20\x22'+_0x1fc70e[_0x1a150a(0x222f)]+_0x1a150a(0x1608),_0x1a150a(0xb27)),await renderForumArchives();}catch(_0x2b8149){console[_0x1a150a(0x24ab)](_0x1a150a(0x1445),_0x2b8149),showToast(_0x1a150a(0x19d5)+_0x2b8149[_0x1a150a(0xd7a)],_0x1a150a(0x24ab));}}async function showEditForumScreen(_0x3b6e11,_0x906825){const _0x229234=_0x2cf6d4;_0x906825[_0x229234(0x1023)](),hideApp(_0x229234(0x1bc3));const _0x48509e=await db[_0x229234(0x1a13)][_0x229234(0x46a)](parseInt(_0x3b6e11));if(!_0x48509e){alert(_0x229234(0x14a2));return;}await showCreateForumScreen(),document['getElementById']('forum-form-id')[_0x229234(0xc34)]=_0x48509e['id'],document['getElementById'](_0x229234(0xa2b))[_0x229234(0xc34)]=_0x48509e['name'],document[_0x229234(0x566)](_0x229234(0x2db))[_0x229234(0xc34)]=_0x48509e[_0x229234(0x14a1)],document[_0x229234(0x566)](_0x229234(0x15bf))[_0x229234(0x21dc)]='编辑论坛',document[_0x229234(0x566)]('forum-form-submit-btn')[_0x229234(0x21dc)]=_0x229234(0xde5),_0x48509e[_0x229234(0x1572)][_0x229234(0x900)](_0x357bdb=>{const _0x3f102d=_0x229234,_0x337a71=document[_0x3f102d(0x15b8)]('#forum-character-selection\x20.selection-item[data-id=\x27'+_0x357bdb+'\x27]');if(_0x337a71)_0x337a71['classList'][_0x3f102d(0xe1)](_0x3f102d(0x876));});const _0x4569de=document['querySelector'](_0x229234(0x157a)+_0x48509e[_0x229234(0x202d)]+'\x27]');if(_0x4569de)_0x4569de['classList']['add']('selected');(_0x48509e['mountedWorldbookIds']||[])['forEach'](_0x138f06=>{const _0x3477e4=_0x229234,_0x240f23=document[_0x3477e4(0x15b8)](_0x3477e4(0xcb0)+_0x138f06+'\x27]');if(_0x240f23)_0x240f23['classList']['add']('selected');});}async function handleForumFormSubmit(){const _0x17934a=_0x2cf6d4,_0x451462=document[_0x17934a(0x566)](_0x17934a(0x2433))[_0x17934a(0xc34)],_0x334de8=document[_0x17934a(0x566)](_0x17934a(0xa2b))[_0x17934a(0xc34)]['trim'](),_0x341e03=document[_0x17934a(0x566)](_0x17934a(0x2db))['value']['trim'](),_0x563345=document[_0x17934a(0x1ed9)](_0x17934a(0x182a)),_0x4cb977=document[_0x17934a(0x15b8)](_0x17934a(0x171b)),_0x1fdf5e=document[_0x17934a(0x1ed9)](_0x17934a(0xb36));if(!_0x334de8)return alert(_0x17934a(0x1787));if(_0x563345['length']===0x0)return alert('请至少选择一个角色');if(!_0x4cb977)return alert('请选择你的身份');const _0xbd0c40=Array[_0x17934a(0x2308)](_0x563345)['map'](_0x2a7724=>_0x2a7724[_0x17934a(0x1f26)]['id']),_0x588ad1=_0x4cb977['dataset']['id'],_0x547a97=Array[_0x17934a(0x2308)](_0x1fdf5e)['map'](_0x5db4a0=>_0x5db4a0[_0x17934a(0x1f26)]['id']),_0x267907={'name':_0x334de8,'characterIds':_0xbd0c40,'personaId':_0x588ad1,'worldview':_0x341e03,'mountedWorldbookIds':_0x547a97,'createdAt':_0x451462?undefined:Date['now']()};try{if(_0x451462)await db[_0x17934a(0x1a13)][_0x17934a(0x2180)](parseInt(_0x451462),{'name':_0x334de8,'characterIds':_0xbd0c40,'worldview':_0x341e03,'mountedWorldbookIds':_0x547a97}),showToast(_0x17934a(0x820)+_0x334de8+'\x22\x20修改成功！','success'),hideApp('create-forum-screen'),await renderForumArchives(),showApp('forum-screen');else{const _0x3e89b5=await db['forums'][_0x17934a(0xe1)](_0x267907);showToast(_0x17934a(0x820)+_0x334de8+_0x17934a(0x929),_0x17934a(0xb27)),hideApp(_0x17934a(0x21dd)),await loadAndDisplayForum(_0x3e89b5,!![]);}}catch(_0x4757b5){console[_0x17934a(0x24ab)]('论坛操作失败:',_0x4757b5),alert(_0x17934a(0x1484));}}async function renderForumArchives(){const _0x8f43f9=_0x2cf6d4,_0x355998=await db['forums'][_0x8f43f9(0x18c6)](),_0x1cd5aa=document[_0x8f43f9(0x566)](_0x8f43f9(0xaa8));if(_0x355998[_0x8f43f9(0xcbf)]===0x0){_0x1cd5aa[_0x8f43f9(0xc02)]=_0x8f43f9(0x603);return;}_0x1cd5aa[_0x8f43f9(0xc02)]=_0x355998[_0x8f43f9(0x1f0d)]((_0x376399,_0x1791a8)=>_0x1791a8['createdAt']-_0x376399[_0x8f43f9(0xd70)])['map'](_0x2e5990=>_0x8f43f9(0x375)+_0x2e5990['id']+_0x8f43f9(0x20da)+_0x2e5990['name']+_0x8f43f9(0x24f8)+_0x2e5990['id']+_0x8f43f9(0xc3b)+_0x2e5990['id']+_0x8f43f9(0xe2c)+_0x2e5990[_0x8f43f9(0x1572)]['length']+_0x8f43f9(0x2482)+new Date(_0x2e5990['createdAt'])[_0x8f43f9(0x177f)]()+_0x8f43f9(0xb38))[_0x8f43f9(0x140c)]('');}async function loadAndDisplayForum(_0x39ae8c,_0x499803=![]){const _0x355e02=_0x2cf6d4;currentForumId=_0x39ae8c;const _0x253679=await db[_0x355e02(0x1a13)][_0x355e02(0x46a)](parseInt(_0x39ae8c));if(!_0x253679){alert('找不到该论坛');return;}document[_0x355e02(0x566)](_0x355e02(0xb1c))[_0x355e02(0x1557)]=_0x253679[_0x355e02(0x222f)],showApp(_0x355e02(0xc1b)),hideApp('forum-screen'),_0x499803&&await generateForumPosts(_0x39ae8c),await renderForumPosts(_0x39ae8c);}async function backToForumArchives(){const _0x8beb3b=_0x2cf6d4;await renderForumArchives(),showApp(_0x8beb3b(0x1bc3)),hideApp(_0x8beb3b(0xc1b));}async function generateForumPosts(_0x43dcb3){const _0x535a1d=_0x2cf6d4,_0x5e0637=await db[_0x535a1d(0x1a13)][_0x535a1d(0x46a)](parseInt(_0x43dcb3));if(!_0x5e0637)return;const _0x19bec0=characters[_0x535a1d(0x803)](_0x5c988a=>_0x5e0637[_0x535a1d(0x1572)][_0x535a1d(0x23ec)](_0x5c988a['id'])),_0xbd5962=personas['find'](_0x4144dc=>_0x4144dc['id']===_0x5e0637['personaId']),_0x5760cb=new Map();for(const _0xf5d71d of _0x19bec0){const _0x5ba074=_0xf5d71d[_0x535a1d(0x1a84)]||_0xf5d71d[_0x535a1d(0x1f8f)]||'你是'+_0xf5d71d['name']+'。';let _0x32dff6='';try{const _0x597888=await getChatSettings(_0xf5d71d['id']);if(_0x597888?.[_0x535a1d(0x1cee)]&&_0x597888[_0x535a1d(0x1cee)][_0x535a1d(0xcbf)]>0x0){const _0x506883=await Promise[_0x535a1d(0x2339)](_0x597888[_0x535a1d(0x1cee)][_0x535a1d(0xf6d)](_0x29301d=>db[_0x535a1d(0x195c)][_0x535a1d(0x46a)](_0x29301d))),_0x34d4cf=_0x506883[_0x535a1d(0x803)](_0x3cd334=>_0x3cd334&&_0x3cd334[_0x535a1d(0x1423)]);_0x34d4cf[_0x535a1d(0xcbf)]>0x0&&(_0x32dff6=_0x535a1d(0x1690)+_0x34d4cf[_0x535a1d(0xf6d)](_0x3efbc4=>_0x3efbc4[_0x535a1d(0x1423)]['substring'](0x0,0xc8))[_0x535a1d(0x140c)]('\x0a'));}}catch(_0x3957e3){console[_0x535a1d(0x24ab)]('获取'+_0xf5d71d[_0x535a1d(0x222f)]+_0x535a1d(0xf3e),_0x3957e3);}let _0x19c8e6='';try{const _0x4597f5=await db[_0x535a1d(0xa1b)][_0x535a1d(0x4a6)](_0x535a1d(0x10df))[_0x535a1d(0x14a)](_0xf5d71d['id'])[_0x535a1d(0x18c6)](),_0x9d9c73=_0x4597f5[_0x535a1d(0x803)](_0x262b32=>_0x262b32['type']===_0x535a1d(0x22c1))[_0x535a1d(0x1f0d)]((_0x16035e,_0x34af98)=>_0x34af98['importance']-_0x16035e[_0x535a1d(0x3d1)])[_0x535a1d(0x136)](0x0,0x3);_0x9d9c73[_0x535a1d(0xcbf)]>0x0&&(_0x19c8e6=_0x535a1d(0x8de)+_0x9d9c73['map'](_0x2e9451=>_0x2e9451[_0x535a1d(0x77b)])['join'](';\x20'));}catch(_0x34bd5d){console[_0x535a1d(0x24ab)]('获取'+_0xf5d71d[_0x535a1d(0x222f)]+'的记忆失败:',_0x34bd5d);}_0x5760cb['set'](_0xf5d71d['id'],{'name':_0xf5d71d['name'],'fullPersona':_0x5ba074,'worldBook':_0x32dff6,'memory':_0x19c8e6});}const _0x527bde=0x1f40;let _0x5e0e8f=0x0,_0x37e66d='';const _0x28fb6e=(_0x32338d,_0x2780ae)=>{const _0xaed1e5=_0x535a1d;if(!_0x2780ae||_0x2780ae[_0xaed1e5(0x1424)]()===''||_0x5e0e8f>=_0x527bde)return;const _0x680d74=_0xaed1e5(0x1102)+_0x32338d+':\x0a'+_0x2780ae+'\x0a';if(_0x5e0e8f+_0x680d74['length']<_0x527bde)_0x37e66d+=_0x680d74,_0x5e0e8f+=_0x680d74['length'];else{const _0xe8befe=_0x527bde-_0x5e0e8f-_0x32338d[_0xaed1e5(0xcbf)]-0x14;_0xe8befe>0x64&&(_0x37e66d+=_0xaed1e5(0x1102)+_0x32338d+':\x0a'+_0x2780ae[_0xaed1e5(0x4b2)](0x0,_0xe8befe)+_0xaed1e5(0x22d4)),_0x5e0e8f=_0x527bde;}},_0x201925=new Date(),_0x2e4300=_0x201925['getHours'](),_0x3fc9aa=_0x201925['getDay'](),_0xd1e72b=_0x3fc9aa===0x0||_0x3fc9aa===0x6;let _0x73e861,_0x3f7688;if(_0x2e4300>=0x5&&_0x2e4300<0x9)_0x73e861='清晨',_0x3f7688=_0x535a1d(0x15e);else{if(_0x2e4300>=0x9&&_0x2e4300<0xc)_0x73e861='上午',_0x3f7688=_0xd1e72b?'周末上午，大家比较悠闲，可能在讨论娱乐活动、购物计划等':_0x535a1d(0x15dd);else{if(_0x2e4300>=0xc&&_0x2e4300<0xe)_0x73e861='午休',_0x3f7688=_0x535a1d(0x1d0f);else{if(_0x2e4300>=0xe&&_0x2e4300<0x12)_0x73e861='下午',_0x3f7688=_0xd1e72b?'周末下午，适合分享活动、约会、购物等话题':_0x535a1d(0x24e2);else{if(_0x2e4300>=0x12&&_0x2e4300<0x16)_0x73e861='晚上',_0x3f7688='晚饭后的黄金时间，大家比较活跃，适合各种话题讨论、分享今天的经历';else _0x2e4300>=0x16&&_0x2e4300<0x18?(_0x73e861='深夜',_0x3f7688=_0x535a1d(0x1237)):(_0x73e861='凌晨',_0x3f7688=_0x535a1d(0x13f1));}}}}const _0x801a41=_0x535a1d(0x10d8)+_0x73e861+'（'+_0x201925[_0x535a1d(0xd4a)](_0x535a1d(0x1c0b),{'hour':_0x535a1d(0x19f3),'minute':_0x535a1d(0x19f3)})+'），'+(_0xd1e72b?'周末':'工作日')+'。'+_0x3f7688;_0x28fb6e(_0x535a1d(0xb2e),_0x801a41);const _0x1cf37d=await db['worldbooks'][_0x535a1d(0x18c6)]();let _0x1979aa='';const _0x313cc2=_0x1cf37d['filter'](_0x50d8d2=>_0x50d8d2[_0x535a1d(0x58b)]&&(window[_0x535a1d(0xfb9)]||[])[_0x535a1d(0x23ec)](_0x50d8d2['id'])),_0x42776f=_0x1cf37d[_0x535a1d(0x803)](_0x3eff5b=>(_0x5e0637['mountedWorldbookIds']||[])['includes'](_0x3eff5b['id'])),_0x1edbed=[...new Set([..._0x313cc2,..._0x42776f])];_0x1edbed[_0x535a1d(0xcbf)]>0x0&&(_0x1979aa=_0x1edbed['map'](_0x42b529=>_0x535a1d(0xf8c)+_0x42b529['title']+'\x0a'+_0x42b529[_0x535a1d(0x1423)])[_0x535a1d(0x140c)]('\x0a\x0a'),_0x28fb6e(_0x535a1d(0x1d07),_0x1979aa));let _0x586a9d='';if(worldEvent&&worldEvent[_0x535a1d(0x252e)]>Date[_0x535a1d(0x18e0)]()&&worldEventForumId&&parseInt(worldEventForumId)===parseInt(_0x43dcb3))_0x586a9d=_0x535a1d(0x7b6)+worldEvent['content']+_0x535a1d(0x1bbb),console[_0x535a1d(0xc0d)]('📰\x20在社区\x20'+_0x43dcb3+'\x20中应用世界事件:\x20'+worldEvent['content'][_0x535a1d(0x4b2)](0x0,0x32)+_0x535a1d(0x12da));else worldEvent&&worldEvent[_0x535a1d(0x252e)]>Date['now']()&&console[_0x535a1d(0xc0d)](_0x535a1d(0x15a3)+_0x43dcb3+'，事件发布于社区\x20'+worldEventForumId);_0x28fb6e(_0x535a1d(0x1d19),_0x586a9d);let _0x5d3dd4='';const _0x1c7983=_0x19bec0[_0x535a1d(0x1f0d)](()=>0.5-Math[_0x535a1d(0x191c)]())['slice'](0x0,0x3);for(const _0x59eda5 of _0x1c7983){const _0x36172c=await db[_0x535a1d(0xa1b)][_0x535a1d(0x4a6)](_0x535a1d(0x10df))[_0x535a1d(0x14a)](_0x59eda5['id'])['limit'](0x2)[_0x535a1d(0x18c6)](),_0x100237=await db[_0x535a1d(0x222e)][_0x535a1d(0x4a6)]('characterId')[_0x535a1d(0x14a)](_0x59eda5['id'])['reverse']()[_0x535a1d(0x149c)](0x3)[_0x535a1d(0x18c6)]();(_0x36172c[_0x535a1d(0xcbf)]>0x0||_0x100237['length']>0x0)&&(_0x5d3dd4+=_0x535a1d(0x1eb7)+_0x59eda5['name']+_0x535a1d(0x155d),_0x36172c['forEach'](_0x4959a9=>{const _0x54b6d7=_0x535a1d;_0x5d3dd4+=_0x54b6d7(0xe59)+_0x4959a9[_0x54b6d7(0x77b)]+'\x0a';}),_0x100237['forEach'](_0x221e9a=>{const _0x976888=_0x535a1d;_0x5d3dd4+=_0x976888(0x1bf0)+_0x221e9a[_0x976888(0x77b)]+'\x0a';}));}_0x28fb6e(_0x535a1d(0xb4),_0x5d3dd4);let _0x4faa06=_0x535a1d(0x1086)+_0x5e0637[_0x535a1d(0x222f)]+'\x22\x20的虚拟论坛生成10个新的帖子。\x0a\x0a##\x20论坛背景设定:\x0a**核心世界观**:\x20'+(_0x5e0637['worldview']||_0x535a1d(0x99b))+'\x0a'+_0x37e66d+_0x535a1d(0x1544)+Array[_0x535a1d(0x2308)](_0x5760cb['values']())[_0x535a1d(0xf6d)](_0x48972e=>'-\x20**'+_0x48972e[_0x535a1d(0x222f)]+_0x535a1d(0x1b2)+_0x48972e['fullPersona']+_0x48972e['worldBook']+_0x48972e[_0x535a1d(0x1790)])[_0x535a1d(0x140c)]('\x0a')+_0x535a1d(0x86a)+_0xbd5962[_0x535a1d(0x222f)]+'**\x20(这是真实用户):\x20'+_0xbd5962[_0x535a1d(0x1c6f)]+_0x535a1d(0x104f)+_0xbd5962[_0x535a1d(0x222f)]+'\x20发帖或评论，用户有自己的发帖权限\x0a\x0a###\x20🚨\x20**角色发帖一致性要求**:\x0a-\x20如果角色发帖，必须严格按照上述详细信息中的人设、世界书和记忆设定\x0a-\x20帖子内容要体现角色的性格特征、说话方式、兴趣爱好\x0a-\x20不要让角色OOC（脱离角色），要保持与聊天中一致的人格\x0a-\x20角色的发帖话题要符合其背景设定和知识领域\x0a-\x20考虑角色的价值观、生活经历和个人特色\x0a\x0a###\x20内容要求:\x0a1.\x20\x20**🔥\x20时间感知**:\x20帖子的内容和氛围要符合当前的\x20**'+_0x73e861+_0x535a1d(0xc6b)+(_0x586a9d?'2.\x20\x20**📰\x20新闻事件优先**:\x20当前有重大新闻事件，请让60-70%的帖子围绕这个事件展开！包括：\x0a\x20\x20\x20-\x20直接讨论事件本身\x0a\x20\x20\x20-\x20分享相关的个人经历或看法\x0a\x20\x20\x20-\x20询问事件的后续发展\x0a\x20\x20\x20-\x20表达对事件的情感反应\x0a\x20\x20\x20-\x20分析事件的影响和意义\x0a3.\x20\x20**真实论坛感**:\x20剩余30-40%帖子保持日常话题，营造真实论坛氛围\x0a4.\x20\x20**世界观融合**:\x20在保持真实感的前提下，适度融入背景世界观\x0a5.\x20\x20**话题多样性**:\x20包括学习、生活、娱乐、求助、分享、八卦等各种日常话题，但要符合当前时间段的特点':'2.\x20\x20**真实论坛感**:\x20大部分帖子应该是普通人的日常分享、求助、吐槽、闲聊等，就像真实论坛一样\x0a3.\x20\x20**世界观融合**:\x20在保持真实感的前提下，适度融入背景世界观\x0a4.\x20\x20**话题多样性**:\x20包括学习、生活、娱乐、求助、分享、八卦等各种日常话题，但要符合当前时间段的特点\x0a5.\x20\x20**避免过度关联**:\x20不要让太多帖子都围绕论坛成员角色展开')+_0x535a1d(0x1007)+(_0x586a9d?'\x0a🚨\x20**最后提醒**：当前有重大新闻事件，请确保生成的10个帖子中有6-7个围绕新闻事件展开！不要忽视这个重要事件！':'')+'\x0a';console[_0x535a1d(0xc0d)](_0x535a1d(0x11d0)),console[_0x535a1d(0xc0d)]('='[_0x535a1d(0x18bf)](0x50)),console[_0x535a1d(0xc0d)](_0x4faa06),console['log']('='['repeat'](0x50)),showToast(_0x535a1d(0xfbf),'info');try{console[_0x535a1d(0xc0d)](_0x535a1d(0x1347),_0x4faa06[_0x535a1d(0xcbf)],'字符');const _0x1aacb3=await callForumAPI(_0x4faa06);console['log']('🔥\x20[论坛帖子生成]\x20AI原始响应长度:',_0x1aacb3['length'],'字符'),console[_0x535a1d(0xc0d)]('🔥\x20[论坛帖子生成]\x20AI原始响应:',_0x1aacb3);let _0x11558b;try{_0x11558b=JSON['parse'](_0x1aacb3);}catch(_0xe8c989){console[_0x535a1d(0xc0d)]('🔥\x20[论坛帖子生成]\x20直接JSON解析失败，尝试提取代码块');const _0x576c5d=_0x1aacb3[_0x535a1d(0x1316)](/```json\s*([\s\S]*?)\s*```/);if(_0x576c5d&&_0x576c5d[0x1]){console[_0x535a1d(0xc0d)](_0x535a1d(0x10e8));try{_0x11558b=JSON['parse'](_0x576c5d[0x1]),console[_0x535a1d(0xc0d)]('✅\x20[论坛帖子生成]\x20成功解析JSON代码块，获得',_0x11558b[_0x535a1d(0xcbf)],_0x535a1d(0x202f));}catch(_0x53723c){console['error'](_0x535a1d(0x1617),_0x53723c);throw new Error(_0x535a1d(0x39b));}}else{console[_0x535a1d(0xc0d)](_0x535a1d(0x230f));const _0x3ffc2c=_0x1aacb3['match'](/```json\s*([\s\S]*)/);if(_0x3ffc2c&&_0x3ffc2c[0x1]){let _0xe29962=_0x3ffc2c[0x1][_0x535a1d(0x1424)]();console['log'](_0x535a1d(0x999),_0xe29962[_0x535a1d(0xcbf)]);if(!_0xe29962[_0x535a1d(0xd7e)](']')&&!_0xe29962['endsWith']('}]')){console[_0x535a1d(0xc0d)](_0x535a1d(0x1619));const _0x4abb7f=_0xe29962['lastIndexOf']('},');_0x4abb7f>0x0&&(_0xe29962=_0xe29962[_0x535a1d(0x4b2)](0x0,_0x4abb7f+0x1)+'\x0a]',console[_0x535a1d(0xc0d)]('🔥\x20[论坛帖子生成]\x20修复截断的JSON'));}try{_0x11558b=JSON[_0x535a1d(0x168e)](_0xe29962),console[_0x535a1d(0xc0d)]('✅\x20[论坛帖子生成]\x20成功解析JSON，获得',_0x11558b[_0x535a1d(0xcbf)],_0x535a1d(0x202f));}catch(_0x42a982){console[_0x535a1d(0x24ab)](_0x535a1d(0x1b43),_0x42a982);throw new Error(_0x535a1d(0x188f));}}else{console[_0x535a1d(0x24ab)](_0x535a1d(0x16a3),_0x1aacb3['substring'](0x0,0x1f4)+_0x535a1d(0x12da));throw new Error(_0x535a1d(0x128d));}}}if(!Array[_0x535a1d(0x1bcc)](_0x11558b))throw new Error(_0x535a1d(0x185b));for(const _0x30f488 of _0x11558b){const _0x2809f3=_0x30f488['authorName']||_0x30f488[_0x535a1d(0x8b9)]||_0x30f488['poster'];if(_0x30f488&&typeof _0x2809f3===_0x535a1d(0xb97)&&_0x30f488[_0x535a1d(0x1c18)]&&_0x30f488[_0x535a1d(0x1423)]){let _0x5adc6e=null,_0x50ad27=null;const _0x30a629=_0x2809f3[_0x535a1d(0x1316)](/^(.+)\((.+)\)$/);if(_0x30a629){const _0x3f89f2=_0x30a629[0x2];_0x5adc6e=characters[_0x535a1d(0x1aeb)](_0x140a8b=>_0x140a8b[_0x535a1d(0x222f)]===_0x3f89f2)||personas[_0x535a1d(0x1aeb)](_0x343437=>_0x343437[_0x535a1d(0x222f)]===_0x3f89f2);if(_0x5adc6e&&_0x5adc6e[_0x535a1d(0x10f9)])try{_0x50ad27=await compressImage(_0x5adc6e[_0x535a1d(0x10f9)],0x50,0.85);}catch(_0x5e1a8a){console['warn']('压缩'+_0x3f89f2+'头像失败，使用默认头像:',_0x5e1a8a),_0x50ad27=createCompressedDefaultAvatar(_0x2809f3);}}!_0x5adc6e&&(_0x50ad27=createCompressedDefaultAvatar(_0x2809f3)),await db[_0x535a1d(0x1f71)]['add']({'forumId':parseInt(_0x43dcb3),'title':_0x30f488[_0x535a1d(0x1c18)],'content':_0x30f488[_0x535a1d(0x1423)],'authorId':_0x5adc6e?_0x5adc6e['id']:null,'authorName':_0x2809f3,'authorAvatar':_0x50ad27,'timestamp':Date[_0x535a1d(0x18e0)]()-Math[_0x535a1d(0x1dac)](Math[_0x535a1d(0x191c)]()*0x2710),'replies':0x0,'likes':0x0});}else console['warn'](_0x535a1d(0x1446),_0x30f488);}}catch(_0xb0a587){console[_0x535a1d(0x24ab)](_0x535a1d(0x208f),_0xb0a587),alert(_0x535a1d(0x2d7)+_0xb0a587['message']);}}async function renderForumPosts(_0xcdd0f2){const _0x4d9a89=_0x2cf6d4,_0x54d49b=await db[_0x4d9a89(0x1f71)]['where']('forumId')[_0x4d9a89(0x14a)](parseInt(_0xcdd0f2))['toArray'](),_0x51ef57=document[_0x4d9a89(0x566)](_0x4d9a89(0x1175));if(_0x54d49b['length']===0x0){_0x51ef57[_0x4d9a89(0xc02)]='<div\x20class=\x22forum-empty-state\x22><p>这个论坛还没有帖子</p></div>';return;}const _0x11b035=Date[_0x4d9a89(0x18e0)]();for(const _0x25bbc6 of _0x54d49b){const _0x46a9fc=await db[_0x4d9a89(0x1d3c)][_0x4d9a89(0x4a6)](_0x4d9a89(0x12b6))['equals'](_0x25bbc6['id'])[_0x4d9a89(0x35e)](),_0x19655a=(_0x11b035-_0x25bbc6[_0x4d9a89(0x7aa)])/(0x3e8*0x3c*0x3c),_0x4c950b=Math[_0x4d9a89(0x910)](0.1,0x1/(0x1+_0x19655a/0x18)),_0x29e5c7=await db['forumReplies'][_0x4d9a89(0x4a6)](_0x4d9a89(0x12b6))[_0x4d9a89(0x14a)](_0x25bbc6['id'])['and'](_0x2ab8a9=>_0x2ab8a9[_0x4d9a89(0x7aa)]>_0x11b035-0x18*0x3c*0x3c*0x3e8)[_0x4d9a89(0x35e)](),_0x2d03f1=_0x46a9fc*0x2+(_0x25bbc6['likes']||0x0),_0x4bf1f4=_0x29e5c7*0x5;_0x25bbc6[_0x4d9a89(0x1c08)]=(_0x2d03f1+_0x4bf1f4)*_0x4c950b,console[_0x4d9a89(0xc0d)](_0x4d9a89(0x24d2)+_0x25bbc6[_0x4d9a89(0x1c18)]+_0x4d9a89(0xa39)+_0x46a9fc+',\x20近期回复'+_0x29e5c7+_0x4d9a89(0x22f1)+_0x19655a[_0x4d9a89(0x3cd)](0x1)+_0x4d9a89(0x18fb)+_0x25bbc6[_0x4d9a89(0x1c08)][_0x4d9a89(0x3cd)](0x2));}_0x54d49b[_0x4d9a89(0x1f0d)]((_0x1f6543,_0x4fd334)=>_0x4fd334[_0x4d9a89(0x1c08)]-_0x1f6543[_0x4d9a89(0x1c08)]);const _0x34dc8d=Math[_0x4d9a89(0x21f7)](0x3,_0x54d49b[_0x4d9a89(0xcbf)]),_0x5661ee=_0x54d49b[_0x4d9a89(0x136)](0x0,_0x34dc8d),_0x269927=_0x54d49b[_0x4d9a89(0x136)](_0x34dc8d)[_0x4d9a89(0x1f0d)]((_0x58f51d,_0x405277)=>_0x405277[_0x4d9a89(0x7aa)]-_0x58f51d[_0x4d9a89(0x7aa)]);let _0x57c952='';_0x5661ee[_0x4d9a89(0xcbf)]>0x0&&(_0x57c952+='<div\x20class=\x22forum-section-header\x22>热门帖子</div>',_0x57c952+=await Promise[_0x4d9a89(0x2339)](_0x5661ee[_0x4d9a89(0xf6d)](async _0x24fac8=>{const _0x3754bc=_0x4d9a89,_0x3070ea=await db[_0x3754bc(0x3b2)][_0x3754bc(0x4a6)](_0x3754bc(0x12b6))[_0x3754bc(0x14a)](_0x24fac8['id'])[_0x3754bc(0x35e)]()>0x0;return _0x3754bc(0x1d67)+_0x24fac8['id']+_0x3754bc(0x975)+_0x24fac8['title']+_0x3754bc(0x2010)+(_0x3070ea?_0x3754bc(0x22e1):'')+_0x3754bc(0x11c6)+(_0x24fac8[_0x3754bc(0xb7)]?'<span\x20class=\x22user-post-badge\x22>我</span>':'')+_0x3754bc(0x1eff)+_0x24fac8['authorName']+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>'+formatTime(_0x24fac8[_0x3754bc(0x7aa)])+_0x3754bc(0x14d9);}))[_0x4d9a89(0x1ccc)](_0x42d7cc=>_0x42d7cc['join'](''))),_0x269927['length']>0x0&&(_0x57c952+=_0x4d9a89(0xa4d),_0x57c952+=await Promise[_0x4d9a89(0x2339)](_0x269927[_0x4d9a89(0xf6d)](async _0x506df3=>{const _0x1d2101=_0x4d9a89,_0x5740d4=await db[_0x1d2101(0x3b2)][_0x1d2101(0x4a6)](_0x1d2101(0x12b6))[_0x1d2101(0x14a)](_0x506df3['id'])[_0x1d2101(0x35e)]()>0x0;return _0x1d2101(0x2109)+_0x506df3['id']+_0x1d2101(0x975)+_0x506df3[_0x1d2101(0x1c18)]+_0x1d2101(0x2010)+(_0x5740d4?_0x1d2101(0x22e1):'')+_0x1d2101(0x11c6)+(_0x506df3[_0x1d2101(0xb7)]?_0x1d2101(0x19e9):'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-meta\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22post-author\x22>'+_0x506df3[_0x1d2101(0x16c3)]+_0x1d2101(0x18a4)+formatTime(_0x506df3[_0x1d2101(0x7aa)])+_0x1d2101(0x14d9);}))[_0x4d9a89(0x1ccc)](_0x2e220c=>_0x2e220c[_0x4d9a89(0x140c)](''))),_0x51ef57[_0x4d9a89(0xc02)]=_0x57c952;}function showPostTypeModal(){const _0x6aa195=_0x2cf6d4,_0x1056c1=document[_0x6aa195(0x566)](_0x6aa195(0x1850));_0x1056c1[_0x6aa195(0x655)][_0x6aa195(0x2526)]=_0x6aa195(0x1f0b);}function hidePostTypeModal(_0x155a4a){const _0x190cc6=_0x2cf6d4;if(_0x155a4a&&_0x155a4a[_0x190cc6(0x1144)]!==_0x155a4a['currentTarget'])return;const _0x5252ca=document['getElementById']('post-type-modal');_0x5252ca['style']['display']='none';}function selectPostType(_0x4d8215){const _0x24a59a=_0x2cf6d4;hidePostTypeModal();if(_0x4d8215===_0x24a59a(0x1673))showCreatePostModal();else _0x4d8215===_0x24a59a(0x19a1)&&showMakeNewsModal();}let isForumPostsMultiSelectMode=![],selectedForumPostIds=new Set();function toggleForumPostsMultiSelectMode(){const _0xf2904e=_0x2cf6d4;isForumPostsMultiSelectMode=!isForumPostsMultiSelectMode,selectedForumPostIds[_0xf2904e(0x2215)]();const _0x422868=document['getElementById'](_0xf2904e(0x399)),_0x2a46a2=_0x422868['querySelector']('i');isForumPostsMultiSelectMode?(_0x422868[_0xf2904e(0x655)][_0xf2904e(0x2526)]=_0xf2904e(0xfe9),document['getElementById'](_0xf2904e(0x6db))['style'][_0xf2904e(0x2526)]=_0xf2904e(0x1f0b),renderForumPostsWithCheckboxes(),showToast(_0xf2904e(0x2384),_0xf2904e(0x2422))):(_0x422868['style'][_0xf2904e(0x2526)]=_0xf2904e(0xf0e),document[_0xf2904e(0x566)]('forum-multiselect-actions')[_0xf2904e(0x655)][_0xf2904e(0x2526)]=_0xf2904e(0xfe9),removeForumPostsCheckboxes());}function renderForumPostsWithCheckboxes(){const _0xc92903=_0x2cf6d4,_0x166dbd=document[_0xc92903(0x566)](_0xc92903(0x1175)),_0x15ba31=_0x166dbd[_0xc92903(0x1ed9)](_0xc92903(0x1eab));_0x15ba31['forEach'](_0x333097=>{const _0x179c17=_0xc92903,_0x537be3=_0x333097[_0x179c17(0x1add)]('onclick')?.[_0x179c17(0x1316)](/showPostView\((\d+)\)/)?.[0x1];if(!_0x537be3)return;_0x333097[_0x179c17(0x10b3)]('onclick'),_0x333097[_0x179c17(0x655)][_0x179c17(0x1f07)]=_0x179c17(0x23cb);if(!_0x333097[_0x179c17(0x15b8)](_0x179c17(0x635))){const _0x1998c6=document[_0x179c17(0x1ad8)](_0x179c17(0x526));_0x1998c6[_0x179c17(0x221)]=_0x179c17(0x125),_0x1998c6[_0x179c17(0xc02)]=_0x179c17(0x17f1)+_0x537be3+_0x179c17(0x3b4)+_0x537be3+_0x179c17(0x4f3)+_0x537be3+_0x179c17(0x238b)+_0x537be3+_0x179c17(0x190b),_0x333097[_0x179c17(0x1806)](_0x1998c6,_0x333097[_0x179c17(0x1bd8)]),_0x333097[_0x179c17(0x226e)][_0x179c17(0xe1)](_0x179c17(0x1b58));}_0x333097[_0x179c17(0x11cf)]=_0x5e88bb=>{const _0x352b0=_0x179c17;if(_0x5e88bb['target'][_0x352b0(0x23df)]!=='checkbox'){const _0x545671=_0x333097[_0x352b0(0x15b8)]('input[type=\x22checkbox\x22]');_0x545671&&(_0x545671[_0x352b0(0x306)]=!_0x545671[_0x352b0(0x306)],toggleForumPostSelection(parseInt(_0x537be3)));}};});}function removeForumPostsCheckboxes(){const _0x238a8d=_0x2cf6d4,_0xdccf95=document['getElementById']('forum-posts-list'),_0x9c7490=_0xdccf95['querySelectorAll'](_0x238a8d(0x1eab));_0x9c7490[_0x238a8d(0x900)](_0x478484=>{const _0x475839=_0x238a8d,_0x3cc1f9=_0x478484['querySelector'](_0x475839(0x20bc)),_0x2c620e=_0x3cc1f9?.['dataset'][_0x475839(0x12b6)],_0x28ea30=_0x478484[_0x475839(0x15b8)]('.post-checkbox');_0x28ea30&&_0x28ea30[_0x475839(0x128)](),_0x478484[_0x475839(0x226e)][_0x475839(0x128)](_0x475839(0x1b58)),_0x2c620e&&(_0x478484[_0x475839(0x11cf)]=()=>showPostView(parseInt(_0x2c620e)),_0x478484[_0x475839(0x1dd4)](_0x475839(0x11cf),_0x475839(0xa5a)+_0x2c620e+')')),_0x478484[_0x475839(0x655)]['cursor']='';});}function toggleForumPostSelection(_0x3e067c){}async function confirmDeleteSelectedForumPosts(){const _0x309bca=_0x2cf6d4,_0xeddb91=document[_0x309bca(0x1ed9)](_0x309bca(0x2327));if(_0xeddb91['length']===0x0){showToast(_0x309bca(0x97a),_0x309bca(0x13bb));return;}if(!confirm(_0x309bca(0x5d1)+_0xeddb91['length']+_0x309bca(0x6a9)))return;try{const _0xe2084=Array[_0x309bca(0x2308)](_0xeddb91)[_0x309bca(0xf6d)](_0x2f4ecb=>parseInt(_0x2f4ecb[_0x309bca(0x1f26)][_0x309bca(0x12b6)]));await Promise['all']([db[_0x309bca(0x1f71)]['where']('id')['anyOf'](_0xe2084)[_0x309bca(0xc2b)](),db[_0x309bca(0x1d3c)][_0x309bca(0x4a6)](_0x309bca(0x12b6))[_0x309bca(0xe07)](_0xe2084)['delete'](),db[_0x309bca(0x1dd3)]['where'](_0x309bca(0x12b6))[_0x309bca(0xe07)](_0xe2084)[_0x309bca(0xc2b)](),db['forumPostImages'][_0x309bca(0x4a6)](_0x309bca(0x12b6))[_0x309bca(0xe07)](_0xe2084)['delete']()]),showToast(_0x309bca(0x1c64)+_0xeddb91['length']+_0x309bca(0x1a2a),_0x309bca(0xb27)),toggleForumPostsMultiSelectMode(),await renderForumPosts(currentForumId);}catch(_0x597743){console[_0x309bca(0x24ab)]('批量删除帖子失败:',_0x597743),showToast('删除失败，请重试','error');}}async function refreshPosts(){const _0x460aef=_0x2cf6d4;if(!currentForumId)return;const _0x2481d0=document[_0x460aef(0x566)](_0x460aef(0xb1c)),_0x1c7760=_0x2481d0[_0x460aef(0x21dc)];_0x2481d0[_0x460aef(0xc02)]=_0x1c7760+_0x460aef(0x15cb),showToast(_0x460aef(0x450),_0x460aef(0x2422));try{await generateForumPosts(currentForumId);const _0x41513f=await db[_0x460aef(0x1f71)][_0x460aef(0x4a6)](_0x460aef(0xe22))[_0x460aef(0x14a)](parseInt(currentForumId))[_0x460aef(0x18c6)](),_0x295203=new Set(_0x41513f[_0x460aef(0xf6d)](_0x4cab5f=>_0x4cab5f['id'])),_0x46e09e=await db['forumFavorites'][_0x460aef(0x4a6)]({'userId':'user'})['toArray'](),_0x281055=new Set(_0x46e09e['map'](_0xa2a7f3=>_0xa2a7f3[_0x460aef(0x12b6)])),_0x686ea=_0x41513f[_0x460aef(0x803)](_0x45b6f3=>_0x45b6f3[_0x460aef(0xb7)]===!![]),_0x142685=new Set(_0x686ea[_0x460aef(0xf6d)](_0x56a345=>_0x56a345['id'])),_0x38c1b8=new Set();_0x41513f[_0x460aef(0x1f0d)]((_0x4e18c3,_0x23229c)=>_0x23229c[_0x460aef(0x7aa)]-_0x4e18c3['timestamp'])[_0x460aef(0x136)](0x0,0x1e)['forEach'](_0xd8ace8=>_0x38c1b8[_0x460aef(0xe1)](_0xd8ace8['id'])),_0x281055[_0x460aef(0x900)](_0x56b169=>_0x38c1b8[_0x460aef(0xe1)](_0x56b169)),_0x142685[_0x460aef(0x900)](_0x257e7c=>_0x38c1b8[_0x460aef(0xe1)](_0x257e7c));const _0x1e62f4=[];_0x295203[_0x460aef(0x900)](_0x15312a=>{const _0x5e1671=_0x460aef;!_0x38c1b8[_0x5e1671(0x1af1)](_0x15312a)&&_0x1e62f4['push'](_0x15312a);}),_0x1e62f4[_0x460aef(0xcbf)]>0x0&&(console[_0x460aef(0xc0d)](_0x460aef(0x1e73)+_0x1e62f4[_0x460aef(0xcbf)]+_0x460aef(0x7b2)),await db[_0x460aef(0x1f71)][_0x460aef(0xf71)](_0x1e62f4),await db[_0x460aef(0x1d3c)][_0x460aef(0x4a6)]('postId')['anyOf'](_0x1e62f4)[_0x460aef(0xc2b)](),console[_0x460aef(0xc0d)](_0x460aef(0x1f0))),await renderForumPosts(currentForumId),showToast(_0x460aef(0x1576),_0x460aef(0xb27));}catch(_0x46097c){console[_0x460aef(0x24ab)](_0x460aef(0x1cef),_0x46097c),showToast(_0x460aef(0x1b85)+_0x46097c['message'],'error'),await renderForumPosts(currentForumId);}finally{_0x2481d0['innerHTML']=_0x1c7760;}}function backToForum(){const _0x2e6449=_0x2cf6d4,_0x9809e=window[_0x2e6449(0x1637)]||'forum';_0x9809e===_0x2e6449(0x23b3)?(hideApp('post-view-screen'),showApp('api-chat-screen')):currentForumId?(showApp(_0x2e6449(0xc1b)),hideApp(_0x2e6449(0x6e7))):(hideApp(_0x2e6449(0x6e7)),showApp('forum-screen'));}async function showPostView(_0x52e4c9,_0x5f0877=_0x2cf6d4(0x73c)){const _0x53ea8b=_0x2cf6d4,_0x374d7d=await db[_0x53ea8b(0x1f71)]['get'](_0x52e4c9);if(!_0x374d7d)return;window[_0x53ea8b(0x11bf)]=_0x52e4c9,currentForumId=_0x374d7d[_0x53ea8b(0xe22)],window[_0x53ea8b(0x1637)]=_0x5f0877;const _0x1e788f=document[_0x53ea8b(0x566)](_0x53ea8b(0xd80)),_0x4843bd=await db[_0x53ea8b(0x3b2)]['where'](_0x53ea8b(0x12b6))[_0x53ea8b(0x14a)](_0x52e4c9)[_0x53ea8b(0x2200)](),_0x3d61e1=_0x4843bd?_0x4843bd[_0x53ea8b(0xd59)]:null,_0x5dfd61=(_0x374d7d['content']||'')[_0x53ea8b(0x882)](/\n/g,'<br>');_0x1e788f['innerHTML']=_0x53ea8b(0xd91)+_0x374d7d[_0x53ea8b(0x1c18)]+(_0x3d61e1?'<svg\x20class=\x22image-post-badge\x22\x20viewBox=\x220\x200\x2024\x2024\x22><path\x20d=\x22M21\x2019V5c0-1.1-.9-2-2-2H5c-1.1\x200-2\x20.9-2\x202v14c0\x201.1.9\x202\x202\x202h14c1.1\x200\x202-.9\x202-2zM8.5\x2013.5l2.5\x203.01L14.5\x2012l4.5\x206H5l3.5-4.5z\x22/></svg>':'')+_0x53ea8b(0x1f57)+(_0x374d7d[_0x53ea8b(0xb7)]?_0x53ea8b(0x19e9):'')+_0x53ea8b(0x1ae7)+_0x374d7d[_0x53ea8b(0x16c3)]+_0x53ea8b(0x17c0)+new Date(_0x374d7d['timestamp'])[_0x53ea8b(0x133a)]()+_0x53ea8b(0x538)+_0x5dfd61+(_0x3d61e1?_0x53ea8b(0x2001)+_0x3d61e1+_0x53ea8b(0xcf4):'')+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22replies-section\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3>回复</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22replies-list\x22><div\x20class=\x22loading-container\x22\x20style=\x22text-align:\x20center;\x20padding:\x2030px;\x22><div\x20class=\x22loading-spinner\x22\x20style=\x22width:\x2030px;\x20height:\x2030px;\x20border:\x202px\x20solid\x20#f3f3f3;\x20border-top:\x202px\x20solid\x20#007AFF;\x20border-radius:\x2050%;\x20animation:\x20spin\x201s\x20linear\x20infinite;\x20margin:\x200\x20auto\x2015px\x20auto;\x22></div><div\x20style=\x22color:\x20#666;\x20font-size:\x2012px;\x22>加载评论中...</div></div></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';const _0x5298a2=await db['forumFavorites']['where'](_0x53ea8b(0x1c6c))[_0x53ea8b(0x14a)](['user',_0x52e4c9])[_0x53ea8b(0x2200)](),_0x23e651=document[_0x53ea8b(0x15b8)](_0x53ea8b(0x1a4a));_0x23e651[_0x53ea8b(0x221)]=_0x5298a2?_0x53ea8b(0x1896):_0x53ea8b(0xb79),showApp(_0x53ea8b(0x6e7)),setTimeout(async()=>{const _0x43e5ef=_0x53ea8b,_0x22d972=document[_0x43e5ef(0x15b8)](_0x43e5ef(0xa16));_0x22d972&&await generateSmartPollData(_0x52e4c9,_0x374d7d);const _0x909dd1=await db[_0x43e5ef(0x1d3c)][_0x43e5ef(0x4a6)](_0x43e5ef(0x12b6))[_0x43e5ef(0x14a)](_0x52e4c9)[_0x43e5ef(0x35e)]();_0x909dd1===0x0&&await generateRepliesForUserPost(_0x52e4c9,_0x3d61e1),await renderReplies(_0x52e4c9);},0x64);}async function generateRepliesForPost(_0x9f2c57){const _0xa64b5f=_0x2cf6d4,_0xa6c878=await db[_0xa64b5f(0x1f71)]['get'](_0x9f2c57);if(!_0xa6c878)return;const _0x90a65c=await db['forums'][_0xa64b5f(0x46a)](_0xa6c878['forumId']),_0x45e41b=characters[_0xa64b5f(0x803)](_0xe9455=>_0x90a65c[_0xa64b5f(0x1572)][_0xa64b5f(0x23ec)](_0xe9455['id'])),_0x36ef03=personas[_0xa64b5f(0x1aeb)](_0x27750f=>_0x27750f['id']===_0x90a65c['personaId']),_0x593098=document[_0xa64b5f(0x566)](_0xa64b5f(0x741));_0x593098[_0xa64b5f(0xc02)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22loading-container\x22\x20style=\x22text-align:\x20center;\x20padding:\x2030px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22loading-spinner\x22\x20style=\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x2030px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20height:\x2030px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x202px\x20solid\x20#f3f3f3;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-top:\x202px\x20solid\x20#007AFF;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x2050%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20animation:\x20spin\x201s\x20linear\x20infinite;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin:\x200\x20auto\x2015px\x20auto;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22color:\x20#666;\x20font-size:\x2012px;\x22>加载评论中...</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';const _0x49f391=_0xa64b5f(0xe19)+_0xa6c878[_0xa64b5f(0x1c18)]+'\x0a内容:\x20'+_0xa6c878[_0xa64b5f(0x1423)]+'\x0a作者:\x20'+_0xa6c878[_0xa64b5f(0x16c3)]+_0xa64b5f(0xc5b)+(_0x90a65c[_0xa64b5f(0x14a1)]||_0xa64b5f(0x1a43))+_0xa64b5f(0x9f8)+_0x45e41b[_0xa64b5f(0xf6d)](_0x17c456=>'-\x20'+_0x17c456[_0xa64b5f(0x222f)]+':\x20'+_0x17c456['bio'])[_0xa64b5f(0x140c)]('\x0a')+'\x0a\x0a**重要：绝对不要生成用户('+_0x36ef03[_0xa64b5f(0x222f)]+')的评论！用户会自己评论！**\x0a\x0a##\x20评论生成要求:\x0a1.\x20**真实感**:\x20评论要像真人写的，有不同的观点和语气\x0a2.\x20**多样性**:\x20包括赞同、反对、提问、分享经验等不同类型\x0a3.\x20**角色分配**:\x0a\x20\x20\x20-\x2080%由虚构的路人网友评论（请创造符合世界观的网友昵称）\x0a\x20\x20\x20-\x2015%由上述角色匿名评论，只使用网名，不暴露真实身份\x0a\x20\x20\x20-\x205%由上述角色评论，要符合人设，使用\x22网名(真实身份)\x22格式\x0a\x0a4.\x20**互动性**:\x20评论之间可以有回应和讨论\x0a5.\x20**长度适中**:\x20每条评论1-3句话即可\x0a\x0a###\x20输出格式:\x0a严格的JSON数组，不要其他文字：\x0a\x0a[\x0a\x20\x20{\x0a\x20\x20\x20\x20\x22authorName\x22:\x20\x22评论者姓名\x22,\x0a\x20\x20\x20\x20\x22content\x22:\x20\x22评论内容\x22\x0a\x20\x20}\x0a]\x0a';console['log'](_0xa64b5f(0x775)),console[_0xa64b5f(0xc0d)]('='[_0xa64b5f(0x18bf)](0x50)),console[_0xa64b5f(0xc0d)](_0x49f391),console[_0xa64b5f(0xc0d)]('='[_0xa64b5f(0x18bf)](0x50));try{const _0x286221=await callForumAPI(_0x49f391);let _0x2c8cc2;try{_0x2c8cc2=JSON['parse'](_0x286221);}catch(_0x16b029){const _0x437179=_0x286221[_0xa64b5f(0x1316)](/```json\s*([\s\S]*?)\s*```/);if(_0x437179&&_0x437179[0x1])_0x2c8cc2=JSON[_0xa64b5f(0x168e)](_0x437179[0x1]);else throw new Error(_0xa64b5f(0xdf0));}if(!Array['isArray'](_0x2c8cc2))throw new Error(_0xa64b5f(0x185b));for(let _0x116bdc=0x0;_0x116bdc<_0x2c8cc2['length'];_0x116bdc++){const _0x3bcc91=_0x2c8cc2[_0x116bdc];if(_0x3bcc91[_0xa64b5f(0x16c3)]&&_0x3bcc91[_0xa64b5f(0x1423)]){let _0x93b00f=null,_0x5c67fa='';const _0x405885=_0x3bcc91[_0xa64b5f(0x16c3)]['match'](/^(.+)\((.+)\)$/);_0x405885?(_0x5c67fa=_0x405885[0x2],_0x93b00f=characters['find'](_0x170169=>_0x170169['name']===_0x5c67fa)||personas[_0xa64b5f(0x1aeb)](_0x4407c0=>_0x4407c0[_0xa64b5f(0x222f)]===_0x5c67fa)):_0x93b00f=characters[_0xa64b5f(0x1aeb)](_0x3049b0=>_0x3049b0['name']===_0x3bcc91['authorName'])||personas[_0xa64b5f(0x1aeb)](_0x3e4465=>_0x3e4465[_0xa64b5f(0x222f)]===_0x3bcc91['authorName']);let _0x47f33b;if(_0x93b00f&&_0x93b00f['avatarUrl'])try{_0x47f33b=await compressImage(_0x93b00f[_0xa64b5f(0x10f9)],0x50,0.85);}catch(_0x392c27){console[_0xa64b5f(0x17cc)]('压缩'+_0x3bcc91[_0xa64b5f(0x16c3)]+_0xa64b5f(0x1530),_0x392c27),_0x47f33b=createCompressedDefaultAvatar(_0x3bcc91[_0xa64b5f(0x16c3)]);}else _0x47f33b=createCompressedDefaultAvatar(_0x3bcc91[_0xa64b5f(0x16c3)]);await db[_0xa64b5f(0x1d3c)][_0xa64b5f(0xe1)]({'postId':_0x9f2c57,'content':_0x3bcc91[_0xa64b5f(0x1423)],'authorName':_0x3bcc91['authorName'],'authorAvatar':_0x47f33b,'timestamp':Date['now']()+_0x116bdc*0x3e8,'likes':Math[_0xa64b5f(0x1dac)](Math['random']()*0x64)});}}}catch(_0x4f90d2){console[_0xa64b5f(0x24ab)]('生成评论失败:',_0x4f90d2),showToast(_0xa64b5f(0xe26)+_0x4f90d2[_0xa64b5f(0xd7a)],_0xa64b5f(0x24ab));}}async function renderReplies(_0x45482f){const _0x1dd7c=_0x2cf6d4,_0x2c6974=await db[_0x1dd7c(0x1d3c)]['where']('postId')[_0x1dd7c(0x14a)](_0x45482f)[_0x1dd7c(0xa3b)](_0x1dd7c(0x7aa)),_0x50203d=document[_0x1dd7c(0x566)](_0x1dd7c(0x741)),_0x56b036=await db[_0x1dd7c(0x11ba)][_0x1dd7c(0x4a6)](_0x1dd7c(0x193))[_0x1dd7c(0x14a)]('user')[_0x1dd7c(0x18c6)](),_0x5d82a3=new Set(_0x56b036[_0x1dd7c(0xf6d)](_0x2cf800=>_0x2cf800[_0x1dd7c(0x1093)])),_0x3439de=_0x1dd7c(0x605),_0x5c0e8e=_0x1dd7c(0x39c),_0x584bea=_0x2c6974[_0x1dd7c(0xf6d)]((_0x65ad1d,_0x22e7d1)=>{const _0x504b6a=_0x1dd7c,_0x52a182=_0x5d82a3['has'](_0x65ad1d['id']),_0x11588f=_0x52a182?_0x504b6a(0xca7):'',_0x45d707=_0x52a182?_0x5c0e8e:_0x3439de,_0x5eef55=new Date(_0x65ad1d[_0x504b6a(0x7aa)])[_0x504b6a(0x133a)](_0x504b6a(0x1c0b),{'year':_0x504b6a(0xf4e),'month':'2-digit','day':_0x504b6a(0x19f3),'hour':'2-digit','minute':_0x504b6a(0x19f3)});return _0x504b6a(0xe27)+_0x65ad1d['id']+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20class=\x22reply-avatar\x22\x20src=\x22'+(_0x65ad1d['authorAvatar']||createDefaultAvatar(_0x65ad1d['authorName']))+_0x504b6a(0x1ca8)+_0x65ad1d[_0x504b6a(0x16c3)]+_0x504b6a(0x75c)+_0x65ad1d[_0x504b6a(0x16c3)]+_0x504b6a(0x18ac)+(_0x22e7d1+0x1)+_0x504b6a(0x18a4)+_0x5eef55+_0x504b6a(0x1015)+_0x65ad1d[_0x504b6a(0x1423)]['replace'](/\n/g,_0x504b6a(0x365))+_0x504b6a(0x25a)+_0x11588f+_0x504b6a(0xa0f)+_0x65ad1d['id']+_0x504b6a(0x9d4)+_0x45d707+_0x504b6a(0x2426)+(_0x65ad1d[_0x504b6a(0x16df)]||0x0)+_0x504b6a(0x1cfd)+_0x65ad1d['id']+_0x504b6a(0x18f3)+_0x65ad1d[_0x504b6a(0x16c3)]+_0x504b6a(0x1f0f)+_0x65ad1d['id']+')\x22\x20title=\x22删除\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22far\x20fa-trash-alt\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';})['join'](''),_0x565b43=_0x2c6974[_0x1dd7c(0xcbf)]>0x0?_0x1dd7c(0x1060)+_0x45482f+')\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20🔘加载更多评论\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20':'';_0x50203d['innerHTML']=_0x584bea+_0x565b43;}async function loadMoreComments(_0x244782){const _0x540fe8=_0x2cf6d4;try{const _0x29891c=await db[_0x540fe8(0x1f71)][_0x540fe8(0x46a)](_0x244782);if(!_0x29891c)return;const _0x55f883=await db[_0x540fe8(0x1a13)]['get'](_0x29891c[_0x540fe8(0xe22)]),_0x32e273=characters[_0x540fe8(0x803)](_0x53f906=>_0x55f883[_0x540fe8(0x1572)]['includes'](_0x53f906['id'])),_0x44be66=personas[_0x540fe8(0x1aeb)](_0x5b14f7=>_0x5b14f7['id']===_0x55f883[_0x540fe8(0x202d)]),_0x59e03a=await db['forumReplies']['where']('postId')[_0x540fe8(0x14a)](_0x244782)[_0x540fe8(0xa3b)](_0x540fe8(0x7aa)),_0x258e40=document['querySelector'](_0x540fe8(0x23bb)),_0x4a0b2c=_0x258e40[_0x540fe8(0x21dc)];_0x258e40['textContent']=_0x540fe8(0xc7a),_0x258e40[_0x540fe8(0x194e)]=!![];const _0x55514a=_0x59e03a[_0x540fe8(0x136)](-0x5)[_0x540fe8(0xf6d)](_0x3fce28=>_0x3fce28[_0x540fe8(0x16c3)]+':\x20'+_0x3fce28['content'])[_0x540fe8(0x140c)]('\x0a'),_0x3c7e6c='\x0a#\x20角色：论坛评论生成AI\x0a请为以下帖子生成10条真实的评论回复，这些评论需要与之前的讨论有一定的上下文关联。\x0a\x0a##\x20帖子信息:\x0a标题:\x20'+_0x29891c['title']+'\x0a内容:\x20'+_0x29891c[_0x540fe8(0x1423)]+_0x540fe8(0x1dbf)+_0x29891c[_0x540fe8(0x16c3)]+_0x540fe8(0xc5b)+(_0x55f883['worldview']||'现代都市生活分享社区')+_0x540fe8(0x22e7)+(_0x55514a||_0x540fe8(0x24f6))+_0x540fe8(0x9f8)+_0x32e273[_0x540fe8(0xf6d)](_0xc8a7b4=>'-\x20'+_0xc8a7b4['name']+':\x20'+_0xc8a7b4[_0x540fe8(0x1a84)])['join']('\x0a')+_0x540fe8(0x11c3)+_0x44be66[_0x540fe8(0x222f)]+_0x540fe8(0x6b7),_0xc16236=await callForumAPI(_0x3c7e6c);let _0x206caf=[];try{_0x206caf=JSON['parse'](_0xc16236);}catch(_0x5470d6){console['log']('🔥\x20[loadMoreComments]\x20直接解析JSON失败，尝试提取代码块');const _0x3b3a89=_0xc16236[_0x540fe8(0x1316)](/```json\s*([\s\S]*?)\s*```/);if(_0x3b3a89&&_0x3b3a89[0x1]){console['log'](_0x540fe8(0x2d1),_0x3b3a89[0x1]);try{_0x206caf=JSON[_0x540fe8(0x168e)](_0x3b3a89[0x1]);}catch(_0x155a1b){console[_0x540fe8(0x24ab)](_0x540fe8(0x2146),_0x155a1b);throw new Error('AI返回的JSON代码块格式错误:\x20'+_0x155a1b[_0x540fe8(0xd7a)]);}}else{const _0x92ca17=_0xc16236['match'](/```\s*([\s\S]*?)\s*```/);if(_0x92ca17&&_0x92ca17[0x1]){console[_0x540fe8(0xc0d)]('🔥\x20[loadMoreComments]\x20找到普通代码块:',_0x92ca17[0x1]);try{_0x206caf=JSON[_0x540fe8(0x168e)](_0x92ca17[0x1]);}catch(_0x1fa6b9){console[_0x540fe8(0x24ab)]('🔥\x20[loadMoreComments]\x20普通代码块解析失败:',_0x1fa6b9);throw new Error(_0x540fe8(0x1a23)+_0x1fa6b9[_0x540fe8(0xd7a)]);}}else{const _0x120fd2=_0xc16236['match'](/\[[\s\S]*\]/);if(_0x120fd2){console[_0x540fe8(0xc0d)](_0x540fe8(0x1d9a),_0x120fd2[0x0]);try{_0x206caf=JSON[_0x540fe8(0x168e)](_0x120fd2[0x0]);}catch(_0x23d3bf){console[_0x540fe8(0x24ab)]('🔥\x20[loadMoreComments]\x20数组格式解析失败:',_0x23d3bf);throw new Error(_0x540fe8(0x200e)+_0x23d3bf[_0x540fe8(0xd7a)]);}}else{console[_0x540fe8(0x24ab)](_0x540fe8(0xde8));throw new Error('AI返回的不是有效的JSON格式。原始响应:\x20'+_0xc16236[_0x540fe8(0x4b2)](0x0,0xc8)+_0x540fe8(0x12da));}}}}const _0x4840ac=Date[_0x540fe8(0x18e0)]();let _0x6f4a8a=0x0;for(let _0x49a455=0x0;_0x49a455<_0x206caf[_0x540fe8(0xcbf)];_0x49a455++){const _0x23dc2b=_0x206caf[_0x49a455];if(!_0x23dc2b['content']||!_0x23dc2b['authorName'])continue;let _0x16c378=null,_0x161ec4='';const _0x4bd84a=_0x23dc2b[_0x540fe8(0x16c3)][_0x540fe8(0x1316)](/^(.+?)\((.+?)\)$/);if(_0x4bd84a){const _0x3b32f2=_0x4bd84a[0x1][_0x540fe8(0x1424)]();_0x161ec4=_0x4bd84a[0x2]['trim'](),_0x16c378=characters[_0x540fe8(0x1aeb)](_0x4a2489=>_0x4a2489[_0x540fe8(0x222f)]===_0x161ec4),_0x16c378&&(_0x23dc2b[_0x540fe8(0x16c3)]=_0x3b32f2);}else _0x16c378=characters[_0x540fe8(0x1aeb)](_0x119796=>_0x119796['name']===_0x23dc2b[_0x540fe8(0x16c3)]);const _0x167d46={'postId':_0x244782,'authorName':_0x23dc2b[_0x540fe8(0x16c3)],'authorAvatar':_0x16c378?_0x16c378[_0x540fe8(0x10f9)]:createDefaultAvatar(_0x23dc2b[_0x540fe8(0x16c3)]),'content':_0x23dc2b[_0x540fe8(0x1423)],'timestamp':_0x4840ac+_0x49a455*0x3e8,'likes':Math[_0x540fe8(0x1dac)](Math[_0x540fe8(0x191c)]()*0x5),'characterId':_0x16c378?_0x16c378['id']:null};await db['forumReplies'][_0x540fe8(0xe1)](_0x167d46),_0x6f4a8a++;}await renderReplies(_0x244782),showToast(_0x540fe8(0x2511)+_0x6f4a8a+_0x540fe8(0x224e),'success');}catch(_0x11f834){console[_0x540fe8(0x24ab)](_0x540fe8(0x240f),_0x11f834),showToast('加载评论失败:\x20'+_0x11f834[_0x540fe8(0xd7a)],_0x540fe8(0x24ab));const _0xe5451b=document[_0x540fe8(0x15b8)]('.load-more-comments-btn');_0xe5451b&&(_0xe5451b[_0x540fe8(0x21dc)]=_0x540fe8(0x13ff),_0xe5451b['disabled']=![]);}}function showCreatePostModal(){const _0x4dae69=_0x2cf6d4,_0x331809=document[_0x4dae69(0x566)](_0x4dae69(0x1cbe));_0x331809[_0x4dae69(0x655)]['display']=_0x4dae69(0x1f0b),document[_0x4dae69(0x566)]('post-title-input')[_0x4dae69(0xc34)]='',document[_0x4dae69(0x566)](_0x4dae69(0xedb))['value']='',document['getElementById'](_0x4dae69(0x9e7))['checked']=![],document['getElementById']('post-image-upload')[_0x4dae69(0xc34)]='',document[_0x4dae69(0x566)](_0x4dae69(0x176e))['style'][_0x4dae69(0x2526)]='none',document[_0x4dae69(0x566)](_0x4dae69(0x1441))[_0x4dae69(0x107)]='',updateCharCount();const _0x70aef3=document['getElementById'](_0x4dae69(0x1a16)),_0x24682f=document[_0x4dae69(0x566)](_0x4dae69(0xedb));_0x70aef3[_0x4dae69(0x116e)]=updateCharCount,_0x24682f[_0x4dae69(0x116e)]=updateCharCount;const _0x2e278d=document[_0x4dae69(0x566)](_0x4dae69(0xa79)),_0x40b7f3=document[_0x4dae69(0x566)](_0x4dae69(0xaee)),_0x3d65cc=document[_0x4dae69(0x566)](_0x4dae69(0x3ae)),_0x282a03=document['getElementById'](_0x4dae69(0x176e)),_0x2b2123=document[_0x4dae69(0x566)](_0x4dae69(0x1441));_0x2e278d['onclick']=()=>_0x40b7f3[_0x4dae69(0x1e62)](),_0x40b7f3['onchange']=_0x545f7c=>{const _0xc6d7d2=_0x4dae69,_0x18d5b9=_0x545f7c[_0xc6d7d2(0x1144)][_0xc6d7d2(0x173e)][0x0];if(_0x18d5b9){const _0x463a67=new FileReader();_0x463a67[_0xc6d7d2(0xc28)]=_0x2a20a8=>{const _0xf95a86=_0xc6d7d2;_0x2b2123[_0xf95a86(0x107)]=_0x2a20a8[_0xf95a86(0x1144)][_0xf95a86(0x1fff)],_0x282a03[_0xf95a86(0x655)][_0xf95a86(0x2526)]=_0xf95a86(0x2d4);},_0x463a67['readAsDataURL'](_0x18d5b9);}},_0x3d65cc['onclick']=()=>{const _0x3c6d71=_0x4dae69;_0x40b7f3[_0x3c6d71(0xc34)]='',_0x2b2123[_0x3c6d71(0x107)]='',_0x282a03['style'][_0x3c6d71(0x2526)]=_0x3c6d71(0xfe9);};}function hideCreatePostModal(_0x3e2a80){const _0x18fe20=_0x2cf6d4;if(_0x3e2a80&&_0x3e2a80['target']!==_0x3e2a80[_0x18fe20(0x52b)])return;const _0x31d13f=document[_0x18fe20(0x566)](_0x18fe20(0x1cbe));_0x31d13f[_0x18fe20(0x655)][_0x18fe20(0x2526)]=_0x18fe20(0xfe9);}function updateCharCount(){const _0x952a7b=_0x2cf6d4,_0x31fe57=document[_0x952a7b(0x566)]('post-title-input'),_0x4374a5=document['getElementById'](_0x952a7b(0xedb)),_0x14a038=document[_0x952a7b(0x566)](_0x952a7b(0x1ffc)),_0x323f0c=document['getElementById'](_0x952a7b(0x5e1));_0x14a038[_0x952a7b(0x21dc)]=_0x31fe57[_0x952a7b(0xc34)][_0x952a7b(0xcbf)]+_0x952a7b(0x1927),_0x323f0c[_0x952a7b(0x21dc)]=_0x4374a5[_0x952a7b(0xc34)]['length']+'/7000',_0x14a038[_0x952a7b(0x655)][_0x952a7b(0x2099)]=_0x31fe57[_0x952a7b(0xc34)][_0x952a7b(0xcbf)]>0x64?_0x952a7b(0x919):_0x952a7b(0x2070),_0x323f0c[_0x952a7b(0x655)][_0x952a7b(0x2099)]=_0x4374a5['value'][_0x952a7b(0xcbf)]>0x1b58?_0x952a7b(0x919):'#666';}async function submitUserPost(){const _0xdb7ea2=_0x2cf6d4,_0x291c43=document[_0xdb7ea2(0x566)](_0xdb7ea2(0x1a16))[_0xdb7ea2(0xc34)][_0xdb7ea2(0x1424)](),_0x29ebb6=document['getElementById'](_0xdb7ea2(0xedb))[_0xdb7ea2(0xc34)][_0xdb7ea2(0x1424)](),_0x4f4072=document['getElementById']('anonymous-post-checkbox')[_0xdb7ea2(0x306)],_0x3176c8=document['getElementById'](_0xdb7ea2(0xaee)),_0x5cf9d0=_0x3176c8[_0xdb7ea2(0x173e)][0x0];if(!_0x291c43&&!_0x5cf9d0){showToast('请输入标题或上传图片',_0xdb7ea2(0x24ab));return;}if(!_0x29ebb6&&!_0x5cf9d0){showToast(_0xdb7ea2(0x176f),'error');return;}if(_0x291c43['length']>0x64||_0x29ebb6[_0xdb7ea2(0xcbf)]>0x1b58){showToast(_0xdb7ea2(0x23de),_0xdb7ea2(0x24ab));return;}showToast(_0xdb7ea2(0xb5f),_0xdb7ea2(0x2422));try{const _0xc72490=await db['forums'][_0xdb7ea2(0x46a)](parseInt(currentForumId)),_0x2adbd9=personas[_0xdb7ea2(0x1aeb)](_0x1bcd64=>_0x1bcd64['id']===_0xc72490['personaId']);let _0x502d81,_0x420393,_0x3f2eee;if(_0x4f4072){const _0x3e3994=[_0xdb7ea2(0xcde),'匿名网友',_0xdb7ea2(0x1a82)];_0x502d81=_0x3e3994[Math[_0xdb7ea2(0x1dac)](Math[_0xdb7ea2(0x191c)]()*_0x3e3994[_0xdb7ea2(0xcbf)])],_0x420393=_0xdb7ea2(0x1e7)+Date[_0xdb7ea2(0x18e0)](),_0x3f2eee=null;}else _0x502d81=_0x2adbd9[_0xdb7ea2(0x222f)],_0x420393=_0x2adbd9['id'],_0x3f2eee=_0x2adbd9[_0xdb7ea2(0x10f9)];const _0x53d41b={'forumId':parseInt(currentForumId),'title':_0x291c43||_0xdb7ea2(0x2104),'content':_0x29ebb6,'authorId':_0x420393,'authorName':_0x502d81,'authorAvatar':_0x3f2eee,'timestamp':Date[_0xdb7ea2(0x18e0)](),'isUserPost':!![],'isAnonymous':_0x4f4072};let _0x2a8e7f=null;_0x5cf9d0&&(_0x2a8e7f=await new Promise(_0xbeb421=>{const _0x32fc56=_0xdb7ea2,_0x1ae116=new FileReader();_0x1ae116[_0x32fc56(0xc28)]=_0x1b8323=>_0xbeb421(_0x1b8323[_0x32fc56(0x1144)][_0x32fc56(0x1fff)]),_0x1ae116['readAsDataURL'](_0x5cf9d0);}));const _0x5cc5a7=await db[_0xdb7ea2(0x1f71)][_0xdb7ea2(0xe1)](_0x53d41b);_0x2a8e7f&&await db[_0xdb7ea2(0x3b2)][_0xdb7ea2(0xe1)]({'postId':_0x5cc5a7,'imageUrl':_0x2a8e7f}),hideCreatePostModal(),await renderForumPosts(currentForumId),showToast(_0xdb7ea2(0x2240),_0xdb7ea2(0xb27));}catch(_0x3862e6){console['error'](_0xdb7ea2(0xfb4),_0x3862e6),showToast(_0xdb7ea2(0x14c2)+_0x3862e6['message'],_0xdb7ea2(0x24ab));}}async function generateRepliesForUserPost(_0x163295,_0x4bb825=null){const _0x27a4b4=_0x2cf6d4,_0x54cbfa=await db[_0x27a4b4(0x1f71)][_0x27a4b4(0x46a)](_0x163295);if(!_0x54cbfa)return;const _0x342ba0=await db[_0x27a4b4(0x1a13)][_0x27a4b4(0x46a)](_0x54cbfa[_0x27a4b4(0xe22)]),_0xcd47bf=characters[_0x27a4b4(0x803)](_0x238fcf=>_0x342ba0[_0x27a4b4(0x1572)][_0x27a4b4(0x23ec)](_0x238fcf['id'])),_0x332cbc=personas[_0x27a4b4(0x1aeb)](_0x273740=>_0x273740['id']===_0x342ba0['personaId']);let _0x252378='';_0x4bb825&&(_0x252378=_0x27a4b4(0x804));let _0x3e15e1='';for(const _0x2d05b7 of _0xcd47bf){const _0x5774a5=_0x2d05b7[_0x27a4b4(0x1a84)]||_0x2d05b7['prompt']||'你是'+_0x2d05b7['name']+'。';let _0x14b0b6='';try{const _0x1ec7c2=await getChatSettings(_0x2d05b7['id']);if(_0x1ec7c2?.[_0x27a4b4(0x1cee)]&&_0x1ec7c2[_0x27a4b4(0x1cee)][_0x27a4b4(0xcbf)]>0x0){const _0x129f27=await Promise[_0x27a4b4(0x2339)](_0x1ec7c2['linkedWorldBookIds']['map'](_0x36ce8f=>db[_0x27a4b4(0x195c)]['get'](_0x36ce8f))),_0xf1a585=_0x129f27[_0x27a4b4(0x803)](_0x2fb5d4=>_0x2fb5d4&&_0x2fb5d4['content']);_0xf1a585['length']>0x0&&(_0x14b0b6='\x0a世界书：'+_0xf1a585['map'](_0x31eca8=>_0x31eca8[_0x27a4b4(0x1423)])[_0x27a4b4(0x140c)]('\x20'));}}catch(_0x3edb1a){console[_0x27a4b4(0x24ab)]('获取'+_0x2d05b7[_0x27a4b4(0x222f)]+'的世界书失败:',_0x3edb1a);}let _0x160035='';try{const _0x4035c0=await db[_0x27a4b4(0xa1b)][_0x27a4b4(0x4a6)](_0x27a4b4(0x10df))['equals'](_0x2d05b7['id'])[_0x27a4b4(0x18c6)](),_0x1c4e09=_0x4035c0[_0x27a4b4(0x803)](_0x21296a=>_0x21296a[_0x27a4b4(0x23df)]==='core')[_0x27a4b4(0x1f0d)]((_0x33f4ba,_0x533a40)=>_0x533a40[_0x27a4b4(0x3d1)]-_0x33f4ba['importance'])[_0x27a4b4(0x136)](0x0,0x3);_0x1c4e09[_0x27a4b4(0xcbf)]>0x0&&(_0x160035=_0x27a4b4(0x8de)+_0x1c4e09[_0x27a4b4(0xf6d)](_0x433bf9=>_0x433bf9[_0x27a4b4(0x77b)])[_0x27a4b4(0x140c)](';\x20'));}catch(_0x4b270a){console[_0x27a4b4(0x24ab)]('获取'+_0x2d05b7[_0x27a4b4(0x222f)]+'的记忆失败:',_0x4b270a);}_0x3e15e1+=_0x27a4b4(0x1c43)+_0x2d05b7[_0x27a4b4(0x222f)]+_0x27a4b4(0x15d4)+_0x5774a5+_0x14b0b6+_0x160035;}const _0x268684=_0x27a4b4(0x1365)+_0x54cbfa['title']+_0x27a4b4(0x15a0)+_0x54cbfa[_0x27a4b4(0x1423)]+'\x0a作者:\x20'+_0x54cbfa[_0x27a4b4(0x16c3)]+(_0x54cbfa['isAnonymous']?_0x27a4b4(0x23e4):_0x54cbfa[_0x27a4b4(0x16c3)]==='用户'?_0x27a4b4(0xdf3):_0x27a4b4(0x3f3))+'\x0a'+_0x252378+_0x27a4b4(0x1e5f)+(_0x342ba0[_0x27a4b4(0x14a1)]||_0x27a4b4(0x1a43))+'\x0a\x0a##\x20可参与回复的角色详情:\x0a'+_0x3e15e1+_0x27a4b4(0x11c3)+_0x332cbc[_0x27a4b4(0x222f)]+_0x27a4b4(0x1966)+(_0x54cbfa['authorName']==='用户'?'这是真实用户发的帖子，角色可以基于聊天记忆适当亲密':_0x27a4b4(0x9ac))+_0x27a4b4(0x248a)+(_0x54cbfa[_0x27a4b4(0x2048)]?_0x27a4b4(0x1bb1):'')+_0x27a4b4(0x14ca)+(_0x54cbfa[_0x27a4b4(0x2048)]?_0x27a4b4(0x2083):'正常互动即可')+_0x27a4b4(0xab3)+(_0x54cbfa[_0x27a4b4(0x16c3)]==='用户'?_0x27a4b4(0x1406):_0x27a4b4(0x2e4))+'\x0a\x0a###\x20输出格式:\x0a**重要：只输出JSON数组，不要任何其他文字、解释或代码块标记！**\x0a\x0a[\x0a\x20\x20{\x0a\x20\x20\x20\x20\x22authorName\x22:\x20\x22回复者网名或网名(真实身份)\x22,\x0a\x20\x20\x20\x20\x22content\x22:\x20\x22回复内容\x22\x0a\x20\x20}\x0a]\x0a\x0a**再次强调：直接输出JSON数组，不要包装在代码块中！**\x0a\x0a🚨\x20**角色一致性要求**：\x0a-\x20如果角色参与回复，必须严格按照其人设、记忆和世界书设定\x0a-\x20不要让角色OOC（脱离角色），要保持性格、说话方式、价值观的一致性\x0a-\x20角色的回复要体现其独特的个性特征和背景设定\x0a-\x20考虑角色的知识背景、兴趣爱好、说话习惯等细节\x0a';try{let _0x1765f2;_0x4bb825?(console[_0x27a4b4(0xc0d)]('正在调用图片API...'),_0x1765f2=await callForumAPIWithImage(_0x268684,_0x4bb825)):(console[_0x27a4b4(0xc0d)]('正在调用文本API...'),_0x1765f2=await callForumAPI(_0x268684));let _0x223f0e;console[_0x27a4b4(0xc0d)](_0x27a4b4(0xbac),_0x1765f2);try{_0x223f0e=JSON['parse'](_0x1765f2);}catch(_0x273f15){console[_0x27a4b4(0xc0d)](_0x27a4b4(0x23bf));const _0x3500d5=_0x1765f2[_0x27a4b4(0x1316)](/```json\s*([\s\S]*?)\s*```/);if(_0x3500d5&&_0x3500d5[0x1]){console[_0x27a4b4(0xc0d)](_0x27a4b4(0x23f),_0x3500d5[0x1]);try{_0x223f0e=JSON['parse'](_0x3500d5[0x1]);}catch(_0x4100db){console[_0x27a4b4(0x24ab)](_0x27a4b4(0x385),_0x4100db);throw new Error(_0x27a4b4(0xc18)+_0x4100db[_0x27a4b4(0xd7a)]);}}else{const _0x2ba597=_0x1765f2[_0x27a4b4(0x1316)](/```\s*([\s\S]*?)\s*```/);if(_0x2ba597&&_0x2ba597[0x1]){console[_0x27a4b4(0xc0d)](_0x27a4b4(0x1a59),_0x2ba597[0x1]);try{_0x223f0e=JSON[_0x27a4b4(0x168e)](_0x2ba597[0x1]);}catch(_0x3055e7){console[_0x27a4b4(0x24ab)](_0x27a4b4(0x24e9),_0x3055e7);throw new Error(_0x27a4b4(0x1a23)+_0x3055e7[_0x27a4b4(0xd7a)]);}}else{const _0x238ed0=_0x1765f2[_0x27a4b4(0x1316)](/\[[\s\S]*\]/);if(_0x238ed0){console[_0x27a4b4(0xc0d)](_0x27a4b4(0xe91),_0x238ed0[0x0]);try{_0x223f0e=JSON[_0x27a4b4(0x168e)](_0x238ed0[0x0]);}catch(_0x59e179){console['error']('🔥\x20[generateRepliesForUserPost]\x20数组格式解析失败:',_0x59e179);throw new Error(_0x27a4b4(0x200e)+_0x59e179[_0x27a4b4(0xd7a)]);}}else{console[_0x27a4b4(0x24ab)](_0x27a4b4(0xf17));throw new Error('AI返回的不是有效的JSON格式。原始响应:\x20'+_0x1765f2[_0x27a4b4(0x4b2)](0x0,0xc8)+'...');}}}}if(Array[_0x27a4b4(0x1bcc)](_0x223f0e)){for(let _0x5bbccc=0x0;_0x5bbccc<_0x223f0e[_0x27a4b4(0xcbf)];_0x5bbccc++){const _0x19c90e=_0x223f0e[_0x5bbccc];if(_0x19c90e[_0x27a4b4(0x16c3)]&&_0x19c90e[_0x27a4b4(0x1423)]){let _0x1c027a=null,_0x391b73='';const _0x4e1f6f=_0x19c90e[_0x27a4b4(0x16c3)][_0x27a4b4(0x1316)](/^(.+)\((.+)\)$/);_0x4e1f6f?(_0x391b73=_0x4e1f6f[0x2],_0x1c027a=characters[_0x27a4b4(0x1aeb)](_0xb8e3f7=>_0xb8e3f7[_0x27a4b4(0x222f)]===_0x391b73)||personas['find'](_0xc232c1=>_0xc232c1[_0x27a4b4(0x222f)]===_0x391b73)):_0x1c027a=characters['find'](_0x1695cb=>_0x1695cb[_0x27a4b4(0x222f)]===_0x19c90e[_0x27a4b4(0x16c3)])||personas[_0x27a4b4(0x1aeb)](_0x10e713=>_0x10e713[_0x27a4b4(0x222f)]===_0x19c90e['authorName']);let _0xc20ec3;if(_0x1c027a&&_0x1c027a[_0x27a4b4(0x10f9)])try{_0xc20ec3=await compressImage(_0x1c027a[_0x27a4b4(0x10f9)],0x50,0.85);}catch(_0x4cbbde){console[_0x27a4b4(0x17cc)]('压缩'+_0x19c90e[_0x27a4b4(0x16c3)]+_0x27a4b4(0x1530),_0x4cbbde),_0xc20ec3=createCompressedDefaultAvatar(_0x19c90e[_0x27a4b4(0x16c3)]);}else _0xc20ec3=createCompressedDefaultAvatar(_0x19c90e[_0x27a4b4(0x16c3)]);await db[_0x27a4b4(0x1d3c)]['add']({'postId':_0x163295,'content':_0x19c90e[_0x27a4b4(0x1423)],'authorName':_0x19c90e[_0x27a4b4(0x16c3)],'authorAvatar':_0xc20ec3,'timestamp':Date['now']()+_0x5bbccc*0x7d0});}}showToast(_0x27a4b4(0x791)+_0x223f0e['length']+'条回复！',_0x27a4b4(0xb27));}}catch(_0x391fb9){console[_0x27a4b4(0x24ab)](_0x27a4b4(0x82e),_0x391fb9),showToast(_0x27a4b4(0xcda)+_0x391fb9['message'],'error');}}async function likeReply(_0x4dfcb8){const _0x2d2ddb=_0x2cf6d4;try{const _0x2cd096=await db[_0x2d2ddb(0x1d3c)][_0x2d2ddb(0x46a)](_0x4dfcb8);if(!_0x2cd096)return;const _0x4b29ae=document['querySelector'](_0x2d2ddb(0xf87)+_0x4dfcb8+'\x22]\x20.like-btn'),_0x2c4b8=_0x4b29ae[_0x2d2ddb(0x15b8)](_0x2d2ddb(0x182d)),_0x16b1cd=_0x2d2ddb(0x605),_0x37ad0d=_0x2d2ddb(0x39c),_0x227fe0=await db[_0x2d2ddb(0x11ba)][_0x2d2ddb(0x4a6)](_0x2d2ddb(0x1d5))[_0x2d2ddb(0x14a)]([_0x2d2ddb(0x23b2),_0x4dfcb8])[_0x2d2ddb(0x2200)]();_0x227fe0?(await db[_0x2d2ddb(0x11ba)][_0x2d2ddb(0xc2b)](_0x227fe0['id']),_0x2cd096[_0x2d2ddb(0x16df)]=Math[_0x2d2ddb(0x910)](0x0,(_0x2cd096[_0x2d2ddb(0x16df)]||0x0)-0x1),_0x4b29ae[_0x2d2ddb(0x226e)][_0x2d2ddb(0x128)](_0x2d2ddb(0xca7)),_0x4b29ae[_0x2d2ddb(0xc02)]=_0x16b1cd+(_0x2d2ddb(0x8c1)+(_0x2cd096[_0x2d2ddb(0x16df)]||0x0)+'</span>')):(await db[_0x2d2ddb(0x11ba)][_0x2d2ddb(0xe1)]({'userId':_0x2d2ddb(0x23b2),'replyId':_0x4dfcb8,'timestamp':Date[_0x2d2ddb(0x18e0)]()}),_0x2cd096[_0x2d2ddb(0x16df)]=(_0x2cd096[_0x2d2ddb(0x16df)]||0x0)+0x1,_0x4b29ae['classList'][_0x2d2ddb(0xe1)]('liked'),_0x4b29ae[_0x2d2ddb(0xc02)]=_0x37ad0d+(_0x2d2ddb(0x8c1)+(_0x2cd096[_0x2d2ddb(0x16df)]||0x0)+_0x2d2ddb(0x19d2))),await db[_0x2d2ddb(0x1d3c)][_0x2d2ddb(0x2180)](_0x4dfcb8,{'likes':_0x2cd096[_0x2d2ddb(0x16df)]});}catch(_0x7d4a37){console[_0x2d2ddb(0x24ab)](_0x2d2ddb(0x146c),_0x7d4a37),showToast(_0x2d2ddb(0x1d00),_0x2d2ddb(0x24ab));}}async function replyToComment(_0x66398a,_0x62f0ac){const _0x9e004=_0x2cf6d4,_0xe967df=document['getElementById']('reply-input');_0xe967df&&(_0xe967df[_0x9e004(0xc34)]='@'+_0x62f0ac+'\x20',_0xe967df[_0x9e004(0x1b12)](),_0xe967df[_0x9e004(0x5f1)](_0xe967df[_0x9e004(0xc34)][_0x9e004(0xcbf)],_0xe967df[_0x9e004(0xc34)][_0x9e004(0xcbf)]));}async function deleteReply(_0x178a83){const _0x2a1143=_0x2cf6d4;if(!confirm(_0x2a1143(0x1226)))return;try{const _0x2e5062=await db[_0x2a1143(0x1d3c)]['get'](_0x178a83);if(!_0x2e5062){showToast('评论不存在',_0x2a1143(0x24ab));return;}await db[_0x2a1143(0x1d3c)][_0x2a1143(0xc2b)](_0x178a83),await db[_0x2a1143(0x11ba)][_0x2a1143(0x4a6)](_0x2a1143(0x1093))[_0x2a1143(0x14a)](_0x178a83)[_0x2a1143(0xc2b)](),showToast(_0x2a1143(0x1b26),_0x2a1143(0xb27)),await renderReplies(_0x2e5062[_0x2a1143(0x12b6)]);}catch(_0x20908a){console['error'](_0x2a1143(0x10fe),_0x20908a),showToast(_0x2a1143(0x315),_0x2a1143(0x24ab));}}async function callSimpleTextAPI(_0x206fb4){const _0x5073bd=_0x2cf6d4;if(!apiSettings[_0x5073bd(0x157f)])throw new Error('API密钥未设置');const _0xe951d7={'model':apiSettings[_0x5073bd(0xeea)],'messages':[{'role':_0x5073bd(0x23b2),'content':_0x206fb4}],'temperature':0.85},_0x1360fb=apiSettings[_0x5073bd(0x90b)][_0x5073bd(0x23ec)](_0x5073bd(0xad8));let _0x1c996e,_0x24102b,_0x74e267;_0x1360fb?(_0x1c996e=apiSettings[_0x5073bd(0x90b)]+_0x5073bd(0x1f4e)+apiSettings['model']+':generateContent?key='+apiSettings[_0x5073bd(0x157f)],_0x24102b={'Content-Type':_0x5073bd(0x302)},_0x74e267=JSON[_0x5073bd(0x7fb)]({'contents':[{'parts':[{'text':_0x206fb4}]}]})):(_0x1c996e=apiSettings[_0x5073bd(0x90b)][_0x5073bd(0xd7e)](_0x5073bd(0x812))?apiSettings[_0x5073bd(0x90b)]+'/chat/completions':apiSettings['base']+_0x5073bd(0xce8),_0x24102b={'Content-Type':_0x5073bd(0x302),'Authorization':_0x5073bd(0x858)+apiSettings['key']},_0x74e267=JSON['stringify'](_0xe951d7));const _0xe02ad7=await fetch(_0x1c996e,{'method':_0x5073bd(0x227d),'headers':_0x24102b,'body':_0x74e267});if(!_0xe02ad7['ok']){const _0xe5344=await _0xe02ad7['text']();throw new Error('API请求失败:\x20'+_0xe02ad7[_0x5073bd(0xe54)]+'\x20-\x20'+_0xe5344);}const _0x479517=await _0xe02ad7['json']();return _0x1360fb?_0x479517[_0x5073bd(0x1d23)]?.[0x0]?.[_0x5073bd(0x1423)]?.[_0x5073bd(0x23c1)]?.[0x0]?.['text']:_0x479517[_0x5073bd(0x13cf)]?.[0x0]?.[_0x5073bd(0xd7a)]?.[_0x5073bd(0x1423)];}let isAnonymousMode=![];function toggleAnonymousMode(){const _0x2e16ab=_0x2cf6d4;isAnonymousMode=!isAnonymousMode;const _0x26ad4b=document[_0x2e16ab(0x566)]('anonymous-toggle'),_0x4ba4c3=document['getElementById']('reply-input');isAnonymousMode?(_0x26ad4b[_0x2e16ab(0x226e)]['add'](_0x2e16ab(0x105d)),_0x26ad4b['title']=_0x2e16ab(0x98f),_0x4ba4c3['placeholder']=_0x2e16ab(0x1d8a)):(_0x26ad4b[_0x2e16ab(0x226e)]['remove']('active'),_0x26ad4b[_0x2e16ab(0x1c18)]=_0x2e16ab(0x646),_0x4ba4c3[_0x2e16ab(0x729)]=_0x2e16ab(0xbab));}function generateAnonymousName(){const _0x4804a6=_0x2cf6d4,_0xdf5e90=[_0x4804a6(0x2092),_0x4804a6(0x647),_0x4804a6(0xfed),'神秘的',_0x4804a6(0xaef),_0x4804a6(0xf16),'吃瓜网友',_0x4804a6(0x155c),_0x4804a6(0x237e),'安静的',_0x4804a6(0x1d37),_0x4804a6(0x154f),_0x4804a6(0x8c8),_0x4804a6(0x74b),_0x4804a6(0x1100)],_0x1992ec=['小白','小黑','小红','小蓝','小绿','小紫',_0x4804a6(0x1497),'小黄','阿强','阿明','小狗','小猫',_0x4804a6(0x879),_0x4804a6(0x750),'同学','一只猹','小A','小B','小C','小D','小E','小F','小G','小H'],_0x4e4da2=_0xdf5e90[Math['floor'](Math[_0x4804a6(0x191c)]()*_0xdf5e90[_0x4804a6(0xcbf)])],_0x25f729=_0x1992ec[Math['floor'](Math[_0x4804a6(0x191c)]()*_0x1992ec[_0x4804a6(0xcbf)])];return''+_0x4e4da2+_0x25f729+_0x4804a6(0x1dd6);}async function sendReply(){const _0x562ed5=_0x2cf6d4,_0x2704ac=document['getElementById'](_0x562ed5(0x1255)),_0x235ae0=_0x2704ac[_0x562ed5(0xc34)][_0x562ed5(0x1424)]();if(!_0x235ae0||!window['currentPostId'])return;if(!currentForumId){const _0xc38cf2=await db[_0x562ed5(0x1f71)][_0x562ed5(0x46a)](window[_0x562ed5(0x11bf)]);if(_0xc38cf2)currentForumId=_0xc38cf2[_0x562ed5(0xe22)];else{showToast(_0x562ed5(0x117a),_0x562ed5(0x24ab));return;}}const _0xbf08eb=await db[_0x562ed5(0x1a13)][_0x562ed5(0x46a)](parseInt(currentForumId));if(!_0xbf08eb){showToast(_0x562ed5(0x1644),_0x562ed5(0x24ab));return;}let _0x8a5608=null;if(!isAnonymousMode){_0x8a5608=personas[_0x562ed5(0x1aeb)](_0x6a0460=>_0x6a0460['id']===_0xbf08eb[_0x562ed5(0x202d)]);if(!_0x8a5608){showToast(_0x562ed5(0x2368),'error');return;}}let _0x1f6f40;isAnonymousMode?_0x1f6f40={'postId':window[_0x562ed5(0x11bf)],'authorId':_0x562ed5(0xb99),'authorName':generateAnonymousName(),'authorAvatar':createDefaultAvatar('匿名'),'content':_0x235ae0,'timestamp':Date['now'](),'isAnonymous':!![]}:_0x1f6f40={'postId':window[_0x562ed5(0x11bf)],'authorId':'user','authorName':_0x8a5608[_0x562ed5(0x222f)],'authorAvatar':_0x8a5608[_0x562ed5(0x10f9)],'content':_0x235ae0,'timestamp':Date[_0x562ed5(0x18e0)](),'isAnonymous':![]},await db['forumReplies'][_0x562ed5(0xe1)](_0x1f6f40),_0x2704ac[_0x562ed5(0xc34)]='',await renderReplies(window[_0x562ed5(0x11bf)]),handleForumAIReply(_0x235ae0,window['currentPostId']);}async function handleForumAIReply(_0x4eb56e,_0x385f42){const _0x22ffdf=_0x2cf6d4;try{const _0x1be496=await db[_0x22ffdf(0x1f71)][_0x22ffdf(0x46a)](_0x385f42),_0x2b6db9=await db[_0x22ffdf(0x1a13)][_0x22ffdf(0x46a)](_0x1be496[_0x22ffdf(0xe22)]),_0xbb1004=characters['filter'](_0x760986=>_0x2b6db9['characterIds'][_0x22ffdf(0x23ec)](_0x760986['id'])),_0x47ec4e=_0x4eb56e[_0x22ffdf(0x1316)](/@(\S+)/);let _0x26c791=null,_0x1b7a37=![];if(_0x47ec4e){const _0x31caa9=_0x47ec4e[0x1],_0x4fe8ec=_0xbb1004[_0x22ffdf(0x1aeb)](_0x523027=>_0x523027[_0x22ffdf(0x222f)]===_0x31caa9);_0x4fe8ec?(_0x1b7a37=Math['random']()<0.6,_0x26c791=_0x4fe8ec):(_0x1b7a37=Math[_0x22ffdf(0x191c)]()<0.7,_0x26c791={'name':_0x31caa9,'bio':_0x22ffdf(0x7f9)});}else _0x1b7a37=Math[_0x22ffdf(0x191c)]()<0.7,_0x1b7a37&&_0xbb1004[_0x22ffdf(0xcbf)]>0x0&&(_0x26c791=_0xbb1004[Math['floor'](Math[_0x22ffdf(0x191c)]()*_0xbb1004[_0x22ffdf(0xcbf)])]);if(_0x1b7a37&&_0x26c791){console[_0x22ffdf(0xc0d)](_0x22ffdf(0x199)+_0x26c791[_0x22ffdf(0x222f)]+'\x22\x20进行回复。');const _0x445ff2=await buildForumReplyPrompt(_0x26c791,_0x1be496,_0x4eb56e);console[_0x22ffdf(0xc0d)]('🔥\x20[论坛回复生成]\x20'+_0x26c791[_0x22ffdf(0x222f)]+_0x22ffdf(0xd3)),console['log']('='[_0x22ffdf(0x18bf)](0x50)),console[_0x22ffdf(0xc0d)](_0x445ff2),console[_0x22ffdf(0xc0d)]('='[_0x22ffdf(0x18bf)](0x50));const _0x14f2ba=await callSimpleTextAPI(_0x445ff2);if(_0x14f2ba&&_0x14f2ba[_0x22ffdf(0x1424)]()){let _0x5e2df8;if(_0x26c791[_0x22ffdf(0x10f9)])try{_0x5e2df8=await compressImage(_0x26c791[_0x22ffdf(0x10f9)],0x50,0.85);}catch(_0x1f8df3){console[_0x22ffdf(0x17cc)]('压缩'+_0x26c791[_0x22ffdf(0x222f)]+_0x22ffdf(0x1530),_0x1f8df3),_0x5e2df8=createCompressedDefaultAvatar(_0x26c791[_0x22ffdf(0x222f)]);}else _0x5e2df8=createCompressedDefaultAvatar(_0x26c791[_0x22ffdf(0x222f)]);const _0x36fef1={'postId':_0x385f42,'authorId':_0x26c791['id']||_0x22ffdf(0x18a6),'authorName':_0x26c791[_0x22ffdf(0x222f)],'authorAvatar':_0x5e2df8,'content':_0x14f2ba['trim'](),'timestamp':Date['now']()+0x3e8};await db[_0x22ffdf(0x1d3c)][_0x22ffdf(0xe1)](_0x36fef1),setTimeout(()=>renderReplies(_0x385f42),0x5dc);}}else console[_0x22ffdf(0xc0d)](_0x22ffdf(0x22d7));}catch(_0x4ba1f7){console[_0x22ffdf(0x24ab)](_0x22ffdf(0x1e61),_0x4ba1f7);}}async function buildForumReplyPrompt(_0x5ccfd5,_0x1fd714,_0x259bbc){const _0xeb7d14=_0x2cf6d4,_0x26d892=await db[_0xeb7d14(0x1d3c)][_0xeb7d14(0x4a6)](_0xeb7d14(0x12b6))[_0xeb7d14(0x14a)](_0x1fd714['id'])[_0xeb7d14(0xa3b)]('timestamp'),_0x38abdf=_0x26d892[_0xeb7d14(0x136)](-0x5);return _0xeb7d14(0x72c)+_0x5ccfd5[_0xeb7d14(0x222f)]+_0xeb7d14(0x192d)+(_0x5ccfd5['bio']||_0xeb7d14(0x1419))+'\x0a\x0a当前场景:\x0a在一个名为\x20\x22'+_0x1fd714[_0xeb7d14(0x1c18)]+_0xeb7d14(0x1420)+_0x1fd714[_0xeb7d14(0x1423)]+_0xeb7d14(0x203a)+_0x38abdf[_0xeb7d14(0xf6d)](_0x165e74=>_0x165e74['authorName']+':\x20'+_0x165e74[_0xeb7d14(0x1423)])[_0xeb7d14(0x140c)]('\x0a')+_0xeb7d14(0x1628)+_0x259bbc+_0xeb7d14(0x101d)+_0x5ccfd5['name']+_0xeb7d14(0x211);}async function toggleFavoritePost(){const _0x2e0838=_0x2cf6d4;console[_0x2e0838(0xc0d)](_0x2e0838(0x1bd4));if(!window[_0x2e0838(0x11bf)]){console[_0x2e0838(0x24ab)]('【错误】收藏失败，因为\x20window.currentPostId\x20未设置。'),showToast(_0x2e0838(0x162e),_0x2e0838(0x24ab));return;}const _0x4f86aa=parseInt(window['currentPostId']),_0x258bdb=document[_0x2e0838(0x15b8)](_0x2e0838(0x1a4a));console[_0x2e0838(0xc0d)](_0x2e0838(0x1171)+_0x4f86aa+_0x2e0838(0x60e)+typeof _0x4f86aa+_0x2e0838(0x1d77));if(!_0x258bdb){console['error'](_0x2e0838(0x2005));return;}try{console['log'](_0x2e0838(0xd76));const _0x3c3485=await db['forumFavorites'][_0x2e0838(0x4a6)](_0x2e0838(0x1c6c))[_0x2e0838(0x14a)](['user',_0x4f86aa])[_0x2e0838(0x2200)]();if(_0x3c3485)console[_0x2e0838(0xc0d)]('[论坛收藏]\x20帖子已收藏，准备取消。记录:',_0x3c3485),await db[_0x2e0838(0x1dd3)]['delete'](_0x3c3485['id']),console['log'](_0x2e0838(0x592)),_0x258bdb['className']=_0x2e0838(0xb79),showToast(_0x2e0838(0x17e3),'info'),console[_0x2e0838(0xc0d)]('[论坛收藏]\x20UI已更新为\x22未收藏\x22状态。');else{const _0x2e68d5={'userId':'user','postId':_0x4f86aa,'timestamp':Date[_0x2e0838(0x18e0)]()};console[_0x2e0838(0xc0d)](_0x2e0838(0xee),_0x2e68d5),await db['forumFavorites'][_0x2e0838(0xe1)](_0x2e68d5),console[_0x2e0838(0xc0d)](_0x2e0838(0x1271)),_0x258bdb[_0x2e0838(0x221)]=_0x2e0838(0x1896),showToast(_0x2e0838(0x4cc),_0x2e0838(0xb27)),console['log'](_0x2e0838(0x1561));}}catch(_0x59a67a){console[_0x2e0838(0x24ab)]('---\x20[论坛收藏]\x20数据库操作失败！---',_0x59a67a),showToast(_0x2e0838(0x12bc),_0x2e0838(0x24ab));}console[_0x2e0838(0xc0d)](_0x2e0838(0x11c9));}async function showForumProfile(){const _0x4c16dc=_0x2cf6d4;showApp('forum-profile-screen'),hideApp(_0x4c16dc(0xc1b)),switchProfileTab('my-posts');const _0x50011d=document[_0x4c16dc(0x566)](_0x4c16dc(0x181a)),_0x28a09d=await db[_0x4c16dc(0x1f71)]['toArray'](),_0x5a2004=_0x28a09d[_0x4c16dc(0x803)](_0x1d9e80=>_0x1d9e80['isUserPost']===!![])[_0x4c16dc(0x1f0d)]((_0x136c5e,_0x34020d)=>_0x34020d[_0x4c16dc(0x7aa)]-_0x136c5e[_0x4c16dc(0x7aa)]);if(_0x5a2004[_0x4c16dc(0xcbf)]===0x0)_0x50011d[_0x4c16dc(0xc02)]=_0x4c16dc(0x19cb);else{const _0x6b0283=await Promise['all'](_0x5a2004[_0x4c16dc(0xf6d)](async _0x4bfa1a=>{const _0x512a53=_0x4c16dc,_0x1ffd7a=await db[_0x512a53(0x3b2)]['where'](_0x512a53(0x12b6))[_0x512a53(0x14a)](_0x4bfa1a['id'])[_0x512a53(0x35e)]()>0x0;return'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-item\x22\x20onclick=\x22showPostView('+_0x4bfa1a['id']+_0x512a53(0x975)+_0x4bfa1a[_0x512a53(0x1c18)]+_0x512a53(0x2010)+(_0x1ffd7a?'<svg\x20class=\x22image-post-badge\x22\x20viewBox=\x220\x200\x2024\x2024\x22><path\x20d=\x22M21\x2019V5c0-1.1-.9-2-2-2H5c-1.1\x200-2\x20.9-2\x202v14c0\x201.1.9\x202\x202\x202h14c1.1\x200\x202-.9\x202-2zM8.5\x2013.5l2.5\x203.01L14.5\x2012l4.5\x206H5l3.5-4.5z\x22/></svg>':'')+_0x512a53(0x8c2)+_0x4bfa1a[_0x512a53(0x16c3)]+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>'+formatTime(_0x4bfa1a['timestamp'])+_0x512a53(0x14d9);}));_0x50011d['innerHTML']=_0x6b0283['join']('');}const _0x5d9af5=document[_0x4c16dc(0x566)](_0x4c16dc(0x230)),_0xadc34d=await db[_0x4c16dc(0x1dd3)][_0x4c16dc(0x4a6)]('userId')[_0x4c16dc(0x14a)](_0x4c16dc(0x23b2))['toArray'](),_0x441edf=_0xadc34d[_0x4c16dc(0xf6d)](_0x24efde=>_0x24efde['postId']);if(_0x441edf[_0x4c16dc(0xcbf)]===0x0)_0x5d9af5[_0x4c16dc(0xc02)]=_0x4c16dc(0x10e1);else{const _0x336765=await db[_0x4c16dc(0x1f71)]['where']('id')['anyOf'](_0x441edf)[_0x4c16dc(0x18c6)](),_0xc5f9b6=await Promise[_0x4c16dc(0x2339)](_0x336765[_0x4c16dc(0x1f0d)]((_0x4d3d39,_0x9b0927)=>_0x9b0927[_0x4c16dc(0x7aa)]-_0x4d3d39['timestamp'])[_0x4c16dc(0xf6d)](async _0x33241c=>{const _0xaef770=_0x4c16dc,_0x82e816=await db['forumPostImages'][_0xaef770(0x4a6)](_0xaef770(0x12b6))[_0xaef770(0x14a)](_0x33241c['id'])[_0xaef770(0x35e)]()>0x0;return _0xaef770(0x2109)+_0x33241c['id']+_0xaef770(0x975)+_0x33241c[_0xaef770(0x1c18)]+_0xaef770(0x2010)+(_0x82e816?'<svg\x20class=\x22image-post-badge\x22\x20viewBox=\x220\x200\x2024\x2024\x22><path\x20d=\x22M21\x2019V5c0-1.1-.9-2-2-2H5c-1.1\x200-2\x20.9-2\x202v14c0\x201.1.9\x202\x202\x202h14c1.1\x200\x202-.9\x202-2zM8.5\x2013.5l2.5\x203.01L14.5\x2012l4.5\x206H5l3.5-4.5z\x22/></svg>':'')+_0xaef770(0x11c6)+(_0x33241c[_0xaef770(0xb7)]?_0xaef770(0x19e9):'')+_0xaef770(0x1eff)+_0x33241c[_0xaef770(0x16c3)]+_0xaef770(0x18a4)+formatTime(_0x33241c[_0xaef770(0x7aa)])+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';}));_0x5d9af5[_0x4c16dc(0xc02)]=_0xc5f9b6[_0x4c16dc(0x140c)]('');}}async function backToCurrentForum(){const _0x25469c=_0x2cf6d4;if(!currentForumId){hideApp(_0x25469c(0x12dd)),await renderForumArchives(),showApp(_0x25469c(0x1bc3));return;}const _0x51efcd=await db[_0x25469c(0x1a13)][_0x25469c(0x46a)](parseInt(currentForumId));_0x51efcd?(document[_0x25469c(0x566)](_0x25469c(0xb1c))[_0x25469c(0x1557)]=_0x51efcd[_0x25469c(0x222f)],await renderForumPosts(currentForumId),showApp(_0x25469c(0xc1b)),hideApp(_0x25469c(0x12dd))):(hideApp(_0x25469c(0x12dd)),await renderForumArchives(),showApp(_0x25469c(0x1bc3)));}function initializeForumApp(){const _0xcfd22c=_0x2cf6d4,_0x2d6984=document[_0xcfd22c(0x15b8)](_0xcfd22c(0x15eb));_0x2d6984&&_0x2d6984[_0xcfd22c(0x167)](_0xcfd22c(0x1e62),async _0x503d4a=>{const _0x19db38=_0xcfd22c;_0x503d4a[_0x19db38(0x4d9)](),_0x503d4a['stopPropagation'](),await renderForumArchives(),showApp(_0x19db38(0x1bc3));}),console['log'](_0xcfd22c(0xcc));}document[_0x2cf6d4(0x167)](_0x2cf6d4(0x7f7),function(){const _0x293a3f=_0x2cf6d4,_0x31e8dd=document[_0x293a3f(0x566)](_0x293a3f(0xc3e));_0x31e8dd&&_0x31e8dd['addEventListener'](_0x293a3f(0x17ef),function(_0x4aac70){const _0x3fe735=_0x293a3f;if(_0x4aac70[_0x3fe735(0x1144)][_0x3fe735(0x173e)]&&_0x4aac70[_0x3fe735(0x1144)][_0x3fe735(0x173e)][0x0]){const _0x298107=_0x4aac70[_0x3fe735(0x1144)][_0x3fe735(0x173e)][0x0],_0x42d4e4=new FileReader();_0x42d4e4['onload']=function(_0x41dfc9){const _0x3eede6=_0x3fe735,_0x34f032=document['getElementById'](_0x3eede6(0x19db));_0x34f032&&(_0x34f032['src']=_0x41dfc9[_0x3eede6(0x1144)]['result']);},_0x42d4e4[_0x3fe735(0x145e)](_0x298107);}});}),document[_0x2cf6d4(0x167)](_0x2cf6d4(0x7f7),function(){const _0x34912f=_0x2cf6d4;console[_0x34912f(0xc0d)](_0x34912f(0x2096));if(typeof showPersonaSelectionForSingleChat==='function'){const _0x387b52=showPersonaSelectionForSingleChat;showPersonaSelectionForSingleChat=function(){_0x387b52(),setTimeout(()=>{const _0x4b0c86=_0x3a81,_0x29931c=document[_0x4b0c86(0x1ed9)](_0x4b0c86(0x2396));console[_0x4b0c86(0xc0d)](_0x4b0c86(0xe2b),_0x29931c[_0x4b0c86(0xcbf)]),_0x29931c['forEach'](_0x4f6e1e=>{const _0x5bebae=_0x4b0c86;_0x4f6e1e[_0x5bebae(0x11cf)]=null,_0x4f6e1e[_0x5bebae(0x167)](_0x5bebae(0x1e62),function(){const _0x4bc978=_0x5bebae;console[_0x4bc978(0xc0d)](_0x4bc978(0x121),this[_0x4bc978(0x1f26)][_0x4bc978(0x202d)]),document[_0x4bc978(0x1ed9)](_0x4bc978(0x2396))['forEach'](_0x52868c=>{const _0x4e6184=_0x4bc978;_0x52868c[_0x4e6184(0x226e)][_0x4e6184(0x128)](_0x4e6184(0x876));}),this[_0x4bc978(0x226e)][_0x4bc978(0xe1)](_0x4bc978(0x876)),window[_0x4bc978(0xb9a)]=this['dataset'][_0x4bc978(0x202d)],console[_0x4bc978(0xc0d)](_0x4bc978(0x1aed),window[_0x4bc978(0xb9a)]);const _0x38ee5a=document[_0x4bc978(0x566)]('confirm-persona-btn');_0x38ee5a&&(_0x38ee5a[_0x4bc978(0x194e)]=![]);});});},0x64);};}typeof confirmPersonaAndShowCharacters===_0x34912f(0xb1)&&(confirmPersonaAndShowCharacters=function(){const _0x284008=_0x34912f;console['log'](_0x284008(0x1fd),window[_0x284008(0xb9a)]);if(!window[_0x284008(0xb9a)]){console[_0x284008(0x24ab)](_0x284008(0x22bb));return;}const _0x4b8d76=window[_0x284008(0xb9a)],_0x3f8ed8=document[_0x284008(0x566)]('persona-selection-modal');_0x3f8ed8&&_0x3f8ed8[_0x284008(0x128)](),window[_0x284008(0xb9a)]=_0x4b8d76,console[_0x284008(0xc0d)]('保护后的身份ID:',window[_0x284008(0xb9a)]),showCharacterSelectionForSingleChat();});if(typeof buildCharacterPrompt===_0x34912f(0xb1)){const _0x5f1eeb=buildCharacterPrompt;buildCharacterPrompt=async function(_0x1e0cc6,_0x30484e=![]){const _0x2135b5=_0x34912f;let _0x188905=await _0x5f1eeb(_0x1e0cc6,_0x30484e);const _0x63930e=getCurrentChatSettings(),_0x47f4a7=_0x63930e[_0x2135b5(0x433)]||_0x63930e[_0x2135b5(0x6a0)];if(_0x47f4a7){const _0x4b7c13=personas[_0x2135b5(0x1aeb)](_0x134096=>_0x134096['id']===_0x47f4a7);if(_0x4b7c13){console['log']('🔧\x20为角色',_0x1e0cc6[_0x2135b5(0x222f)],_0x2135b5(0x862),_0x4b7c13['name']);const _0x2071b4=/\n\n# 对话者的角色设定：[\s\S]*?请根据用户的这个面具身份来进行对话。/;_0x188905=_0x188905[_0x2135b5(0x882)](_0x2071b4,'');const _0x37bcde=_0x2135b5(0xb01)+_0x4b7c13[_0x2135b5(0x222f)]+'\x22'+(_0x4b7c13[_0x2135b5(0x1c6f)]?'：'+_0x4b7c13['description']:'')+_0x2135b5(0x10e0),_0x1ba9b6=_0x188905[_0x2135b5(0x167a)](_0x2135b5(0xaf8));_0x1ba9b6!==-0x1?_0x188905=_0x188905[_0x2135b5(0x136)](0x0,_0x1ba9b6)+_0x37bcde+_0x188905['slice'](_0x1ba9b6):_0x188905+=_0x37bcde;}}return _0x188905;};}console[_0x34912f(0xc0d)]('✅\x20身份选择功能永久修复已应用');}),document[_0x2cf6d4(0x167)]('DOMContentLoaded',function(){const _0x1be26d=_0x2cf6d4;console[_0x1be26d(0xc0d)](_0x1be26d(0x319));if(typeof window['createGroupChat']==='function'){const _0x5a77fa=window[_0x1be26d(0x1779)];window[_0x1be26d(0x1779)]=async function(_0x1afd70){const _0x4a9b79=_0x1be26d;console[_0x4a9b79(0xc0d)](_0x4a9b79(0x13e6),_0x1afd70),await _0x5a77fa[_0x4a9b79(0x15a)](this,_0x1afd70);if(_0x1afd70&&groupChats&&groupChats['length']>0x0){const _0x100213=groupChats[groupChats[_0x4a9b79(0xcbf)]-0x1],_0x2d3e37=localStorage[_0x4a9b79(0x2250)]('chatSettings_'+_0x100213['id']);if(_0x2d3e37)try{const _0x448fd2=JSON[_0x4a9b79(0x168e)](_0x2d3e37);window['chatSettings'][_0x100213['id']]=_0x448fd2,console['log'](_0x4a9b79(0x668),_0x448fd2);}catch(_0x147f1c){console[_0x4a9b79(0x24ab)](_0x4a9b79(0x1163),_0x147f1c);}}};}console[_0x1be26d(0xc0d)](_0x1be26d(0x7af));}),(function(){'use strict';const _0x4b97e9=_0x2cf6d4;console[_0x4b97e9(0xc0d)]('📱\x20[移动端优化]\x20输入框viewport行为修复启动...');let _0xb441ad=/iPad|iPhone|iPod/['test'](navigator['userAgent']),_0x3e30d4=/Android/[_0x4b97e9(0x17ba)](navigator[_0x4b97e9(0x473)]),_0x33239b=_0xb441ad||_0x3e30d4;if(!_0x33239b){console['log'](_0x4b97e9(0xd41));return;}function _0x19e455(){const _0x2c1b75=_0x4b97e9;return document['querySelectorAll'](_0x2c1b75(0x8e4));}function _0x5c7793(){const _0x2f0f2a=_0x4b97e9,_0xb050b7=document['querySelector']('meta[name=\x22viewport\x22]');_0xb050b7&&_0xb050b7[_0x2f0f2a(0x1dd4)](_0x2f0f2a(0x1423),_0x2f0f2a(0x1227));}function _0x1bc6d9(){const _0x5ec0b6=_0x4b97e9,_0x51f384=document['querySelector'](_0x5ec0b6(0x15c9));_0x51f384&&_0x51f384[_0x5ec0b6(0x1dd4)](_0x5ec0b6(0x1423),'width=device-width,\x20initial-scale=1.0,\x20minimum-scale=1.0,\x20maximum-scale=3.0,\x20user-scalable=yes');}function _0x35b4f0(_0x24c0a9){const _0x4b57bf=_0x4b97e9;console[_0x4b57bf(0xc0d)](_0x4b57bf(0xac1)),_0xb441ad&&_0x5c7793(),_0x3e30d4&&(_0x5a466a=window[_0x4b57bf(0x6f1)],console[_0x4b57bf(0xc0d)](_0x4b57bf(0x17c8),_0x5a466a)),setTimeout(()=>{const _0x496486=_0x4b57bf;_0x24c0a9[_0x496486(0x1144)][_0x496486(0x1974)]({'behavior':_0x496486(0x232a),'block':_0x496486(0x23a1)});},0x12c);}function _0x193591(_0xd0bf5f){const _0x28c5b2=_0x4b97e9;console[_0x28c5b2(0xc0d)](_0x28c5b2(0x1246)),_0xb441ad&&setTimeout(()=>{_0x1bc6d9();},0x64),setTimeout(()=>{const _0xf22d38=_0x28c5b2;window[_0xf22d38(0xd5b)](0x0,0x0),document[_0xf22d38(0x172c)]['scrollTop']=0x0,document[_0xf22d38(0x1788)]['scrollTop']=0x0;const _0x57ff69=document['getElementById'](_0xf22d38(0x2379));_0x57ff69&&(_0x57ff69[_0xf22d38(0x655)]['transform']=_0xf22d38(0x12cd),setTimeout(()=>{const _0x5b43b3=_0xf22d38;_0x57ff69[_0x5b43b3(0x655)][_0x5b43b3(0x2006)]='';},0xa)),document[_0xf22d38(0x172c)][_0xf22d38(0x655)][_0xf22d38(0x2526)]=_0xf22d38(0x1f0b),document['body']['style'][_0xf22d38(0x1571)]=_0xf22d38(0x23a1),document[_0xf22d38(0x172c)][_0xf22d38(0x655)][_0xf22d38(0x9c7)]='center';},0x12c);}function _0x215f17(){const _0x145310=_0x4b97e9,_0x21b104=_0x19e455();console['log'](_0x145310(0x1281)+_0x21b104[_0x145310(0xcbf)]+_0x145310(0x1008)),_0x21b104['forEach'](_0x3be2ec=>{const _0x3cad0f=_0x145310;_0x3be2ec['removeEventListener'](_0x3cad0f(0x1b12),_0x35b4f0),_0x3be2ec['removeEventListener']('blur',_0x193591),_0x3be2ec[_0x3cad0f(0x167)](_0x3cad0f(0x1b12),_0x35b4f0,{'passive':!![]}),_0x3be2ec[_0x3cad0f(0x167)](_0x3cad0f(0x1d7b),_0x193591,{'passive':!![]});const _0xe25d13=window['getComputedStyle'](_0x3be2ec),_0xc6e5eb=parseInt(_0xe25d13[_0x3cad0f(0x1ae6)]);_0xc6e5eb<0x10&&(_0x3be2ec[_0x3cad0f(0x655)][_0x3cad0f(0x1ae6)]=_0x3cad0f(0x1d11),console[_0x3cad0f(0xc0d)](_0x3cad0f(0x1c3d)));});}const _0x2bc0ed=new MutationObserver(function(_0x98be5e){const _0x3abfe1=_0x4b97e9;let _0x25c4bc=![];_0x98be5e[_0x3abfe1(0x900)](function(_0x5dcdd7){const _0xb776d7=_0x3abfe1;_0x5dcdd7[_0xb776d7(0x23df)]==='childList'&&_0x5dcdd7[_0xb776d7(0xcdf)][_0xb776d7(0x900)](function(_0x230e0c){const _0x4b77cb=_0xb776d7;if(_0x230e0c[_0x4b77cb(0x154a)]===0x1){if(_0x230e0c['matches']&&(_0x230e0c[_0x4b77cb(0xaed)](_0x4b77cb(0x41b))||_0x230e0c[_0x4b77cb(0xaed)](_0x4b77cb(0x627))))_0x25c4bc=!![];else{if(_0x230e0c['querySelector']){const _0x4e9796=_0x230e0c[_0x4b77cb(0x1ed9)]('textarea,\x20input');_0x4e9796[_0x4b77cb(0xcbf)]>0x0&&(_0x25c4bc=!![]);}}}});}),_0x25c4bc&&(console['log'](_0x3abfe1(0x177d)),setTimeout(_0x215f17,0x64));});_0x2bc0ed[_0x4b97e9(0x585)](document['body'],{'childList':!![],'subtree':!![]});document['readyState']==='loading'?document['addEventListener'](_0x4b97e9(0x7f7),_0x215f17):_0x215f17();document[_0x4b97e9(0x167)](_0x4b97e9(0x346),function(){const _0x1aac72=_0x4b97e9;!document[_0x1aac72(0x1a2c)]&&setTimeout(_0x215f17,0x64);});let _0x5a466a=window['innerHeight'],_0xdd728b=![];function _0x35a224(){const _0x47ac99=_0x4b97e9,_0x481311=window[_0x47ac99(0x6f1)],_0x9e55bc=_0x5a466a-_0x481311,_0x1274b8=_0xdd728b;_0xdd728b=_0x9e55bc>0x96,console[_0x47ac99(0xc0d)]('📱\x20Viewport变化:\x20'+_0x481311+_0x47ac99(0x17dd)+_0x5a466a+_0x47ac99(0x1cf2)+_0x9e55bc+_0x47ac99(0x1ef5)+_0xdd728b+')'),_0x1274b8&&!_0xdd728b&&(console['log'](_0x47ac99(0x1cc)),setTimeout(()=>{const _0x4b23fb=_0x47ac99;window[_0x4b23fb(0xd5b)](0x0,0x0),document[_0x4b23fb(0x172c)][_0x4b23fb(0x5e5)]=0x0,document[_0x4b23fb(0x1788)][_0x4b23fb(0x5e5)]=0x0;const _0x123208=document[_0x4b23fb(0x566)](_0x4b23fb(0x2379));_0x123208&&(_0x123208[_0x4b23fb(0x655)]['transform']=_0x4b23fb(0x12cd),requestAnimationFrame(()=>{const _0x4e809e=_0x4b23fb;_0x123208[_0x4e809e(0x655)][_0x4e809e(0x2006)]='';}));document[_0x4b23fb(0x172c)][_0x4b23fb(0x655)][_0x4b23fb(0x16b8)]=_0x4b23fb(0x1295),document[_0x4b23fb(0x172c)][_0x4b23fb(0x655)][_0x4b23fb(0x2526)]=_0x4b23fb(0x1f0b),document[_0x4b23fb(0x172c)][_0x4b23fb(0x655)][_0x4b23fb(0x1571)]=_0x4b23fb(0x23a1),document[_0x4b23fb(0x172c)][_0x4b23fb(0x655)]['alignItems']=_0x4b23fb(0x23a1);if(_0x3e30d4){const _0x2f1025=document[_0x4b23fb(0x566)](_0x4b23fb(0x24e7));_0x2f1025&&(_0x2f1025['scrollTop']=_0x2f1025['scrollHeight']),document[_0x4b23fb(0x172c)][_0x4b23fb(0xc22)];}},0x64));}window['addEventListener'](_0x4b97e9(0x110c),_0x35a224,{'passive':!![]}),window[_0x4b97e9(0x167)](_0x4b97e9(0x1837),()=>{setTimeout(()=>{const _0x16ce7a=_0x3a81;_0x5a466a=window[_0x16ce7a(0x6f1)],_0x35a224();},0x1f4);},{'passive':!![]}),console['log'](_0x4b97e9(0x2476));}()),(function(){'use strict';const _0x137ae3=_0x2cf6d4;console[_0x137ae3(0xc0d)](_0x137ae3(0x11aa)),console['log']('💰\x20[转账优化]\x20AI将根据角色人设自然回应转账，不再自动收款');}()),(function(){'use strict';const _0xbc82f3=_0x2cf6d4;const _0x4e08a7=/Mobile|Android|iPhone|iPad/[_0xbc82f3(0x17ba)](navigator['userAgent']);if(!_0x4e08a7)return;console[_0xbc82f3(0xc0d)](_0xbc82f3(0xdda)),document[_0xbc82f3(0x167)](_0xbc82f3(0x1263),function(_0x5e84ae){const _0x231f4b=_0xbc82f3,_0x5b71de=_0x5e84ae[_0x231f4b(0x1144)][_0x231f4b(0x2026)]('.action-btn');if(!_0x5b71de)return;const _0x144eff=document[_0x231f4b(0x566)](_0x231f4b(0x1634));if(!_0x144eff||_0x144eff[_0x231f4b(0x655)][_0x231f4b(0x2526)]===_0x231f4b(0xfe9))return;if(!_0x144eff[_0x231f4b(0x1f9)](_0x5b71de))return;const _0x3b505d=_0x5b71de[_0x231f4b(0x15b8)]('i');if(_0x3b505d){if(_0x3b505d[_0x231f4b(0x226e)]['contains'](_0x231f4b(0x19de))&&typeof showOfflineHistoryModal===_0x231f4b(0xb1))showOfflineHistoryModal();else{if(_0x3b505d[_0x231f4b(0x226e)][_0x231f4b(0x1f9)](_0x231f4b(0x1325))&&typeof showOfflineUISettings===_0x231f4b(0xb1))showOfflineUISettings();else _0x3b505d[_0x231f4b(0x226e)][_0x231f4b(0x1f9)](_0x231f4b(0x1603))&&typeof showOfflinePresetSettings===_0x231f4b(0xb1)&&showOfflinePresetSettings();}}},{'passive':!![]}),console[_0xbc82f3(0xc0d)](_0xbc82f3(0x619));}());if(typeof blacklistData===_0x2cf6d4(0x1785))var blacklistData=[],friendRequestsData=[],characterStatusData=[];async function loadBlacklistData(){const _0x2793ae=_0x2cf6d4;try{blacklistData=await db[_0x2793ae(0x1c45)][_0x2793ae(0x1902)]('timestamp')['reverse']()[_0x2793ae(0x18c6)](),console[_0x2793ae(0xc0d)](_0x2793ae(0xad7),blacklistData);}catch(_0x229824){console[_0x2793ae(0x24ab)](_0x2793ae(0x2237),_0x229824),blacklistData=[];}}function isBlocked(_0x1d6af2,_0x3fb0e9){const _0x264a6a=_0x2cf6d4;return blacklistData[_0x264a6a(0x184b)](_0x14fe60=>_0x14fe60[_0x264a6a(0x1b1a)]===_0x1d6af2&&_0x14fe60['blockedId']===_0x3fb0e9&&!_0x14fe60[_0x264a6a(0x1f27)]);}async function blockCharacter(_0xc7f181,_0x148d49=''){const _0x224bc7=_0x2cf6d4;try{const _0x58fc2e=new Date();if(isBlocked(_0x224bc7(0x23b2),_0xc7f181)){showToast(_0x224bc7(0x198c),_0x224bc7(0x13bb));return;}const _0x35d92e={'id':_0x224bc7(0xcbe)+Date['now']()+'_'+Math[_0x224bc7(0x191c)]()[_0x224bc7(0x9a3)](0x24)['substr'](0x2,0x9),'blockerId':_0x224bc7(0x23b2),'blockedId':_0xc7f181,'timestamp':_0x58fc2e[_0x224bc7(0xa4b)](),'reason':_0x148d49,'unblocked':![]};blacklistData[_0x224bc7(0x50a)](_0x35d92e),await db[_0x224bc7(0x1c45)][_0x224bc7(0xe1)](_0x35d92e);const _0x4d16a7=characters[_0x224bc7(0x1aeb)](_0x2d55d3=>_0x2d55d3['id']===_0xc7f181);showToast(_0x224bc7(0x1afa)+(_0x4d16a7?.[_0x224bc7(0x222f)]||'角色'),_0x224bc7(0xb27)),await notifyCharacterBlocked(_0xc7f181,_0x148d49),currentChatCharacter&&currentChatCharacter['id']===_0xc7f181&&updateChatBlockedStatus(),renderContactList(),renderMessageList();}catch(_0x1748ea){console[_0x224bc7(0x24ab)](_0x224bc7(0x423),_0x1748ea),showToast(_0x224bc7(0x43c),'error');}}async function unblockCharacter(_0x260001){const _0x442d48=_0x2cf6d4;try{const _0x532bfc=blacklistData[_0x442d48(0x1aeb)](_0x15b179=>_0x15b179[_0x442d48(0x1b1a)]===_0x442d48(0x23b2)&&_0x15b179[_0x442d48(0x20ba)]===_0x260001&&!_0x15b179[_0x442d48(0x1f27)]);if(!_0x532bfc){showToast('该角色未被拉黑',_0x442d48(0x13bb));return;}_0x532bfc['unblocked']=!![],_0x532bfc[_0x442d48(0x313)]=new Date()[_0x442d48(0xa4b)](),await db[_0x442d48(0x1c45)]['put'](_0x532bfc);const _0x39445a=characters['find'](_0x6b0dd=>_0x6b0dd['id']===_0x260001);showToast('已解除对\x20'+(_0x39445a?.[_0x442d48(0x222f)]||'角色')+_0x442d48(0xa91),_0x442d48(0xb27)),await notifyCharacterUnblocked(_0x260001),currentChatCharacter&&currentChatCharacter['id']===_0x260001&&(renderChatMessages(currentChatCharacter['id']),updateChatBlockedStatus()),renderContactList(),renderMessageList();}catch(_0x193aaa){console[_0x442d48(0x24ab)](_0x442d48(0xb56),_0x193aaa),showToast(_0x442d48(0x109),_0x442d48(0x24ab));}}async function updateCharacterStatus(_0x395b00,_0x38cd5d,_0x4a824d='',_0x3a9330=''){const _0x5a1980=_0x2cf6d4;try{let _0x1133b1=characterStatusData[_0x5a1980(0x1aeb)](_0x55aa2a=>_0x55aa2a['characterId']===_0x395b00);if(!_0x1133b1)_0x1133b1={'id':'status_'+_0x395b00,'characterId':_0x395b00,'status':_0x38cd5d,'activity':_0x4a824d,'location':_0x3a9330,'lastUpdate':new Date()[_0x5a1980(0xa4b)](),'lastChatTime':null},characterStatusData[_0x5a1980(0x6ee)](_0x1133b1);else{const _0x1d7c29=_0x1133b1[_0x5a1980(0x152)];_0x1133b1[_0x5a1980(0xe54)]=_0x38cd5d,_0x1133b1['activity']=_0x4a824d,_0x1133b1['location']=_0x3a9330,_0x1133b1[_0x5a1980(0x1e69)]=new Date()[_0x5a1980(0xa4b)](),_0x1133b1[_0x5a1980(0x152)]=_0x1d7c29;}const _0x4261ee=await db[_0x5a1980(0x5a2)][_0x5a1980(0x4a6)]('characterId')['equals'](_0x395b00)[_0x5a1980(0x18c6)]();if(_0x4261ee[_0x5a1980(0xcbf)]>=0xa){const _0x182783=_0x4261ee[_0x5a1980(0x1f0d)]((_0x2f6095,_0x5f2706)=>new Date(_0x2f6095['lastUpdate'])-new Date(_0x5f2706[_0x5a1980(0x1e69)])),_0x3fd12c=_0x182783[_0x5a1980(0x136)](0x0,_0x4261ee['length']-0x9);await db[_0x5a1980(0x5a2)][_0x5a1980(0xf71)](_0x3fd12c[_0x5a1980(0xf6d)](_0x5e51e3=>_0x5e51e3['id']));}await db['characterStatus'][_0x5a1980(0x53a)](_0x1133b1);}catch(_0x174b7b){console[_0x5a1980(0x24ab)](_0x5a1980(0x2056),_0x174b7b);}}function getCharacterStatus(_0x4ecf85){const _0x2aadf4=_0x2cf6d4;return characterStatusData['find'](_0x12a8f3=>_0x12a8f3[_0x2aadf4(0x10df)]===_0x4ecf85)||{'status':_0x2aadf4(0x20bb),'activity':'在线','location':'','lastUpdate':new Date()[_0x2aadf4(0xa4b)](),'lastChatTime':null};}async function aiBlockUser(_0x1aaa2b,_0x4df473=''){const _0x5febc6=_0x2cf6d4;try{const _0x57f5f0=new Date();if(isBlocked(_0x1aaa2b,'user'))return;const _0x2ef08a={'id':_0x5febc6(0xcbe)+Date[_0x5febc6(0x18e0)]()+'_'+Math[_0x5febc6(0x191c)]()[_0x5febc6(0x9a3)](0x24)['substr'](0x2,0x9),'blockerId':_0x1aaa2b,'blockedId':_0x5febc6(0x23b2),'timestamp':_0x57f5f0[_0x5febc6(0xa4b)](),'reason':_0x4df473,'unblocked':![]};blacklistData[_0x5febc6(0x50a)](_0x2ef08a),await db['blacklist'][_0x5febc6(0xe1)](_0x2ef08a);currentChatCharacter&&currentChatCharacter['id']===_0x1aaa2b&&updateChatBlockedStatus();const _0x5b8dbb=characters[_0x5febc6(0x1aeb)](_0x3d414b=>_0x3d414b['id']===_0x1aaa2b);showToast((_0x5b8dbb?.[_0x5febc6(0x222f)]||'角色')+_0x5febc6(0x2334),_0x5febc6(0x13bb));}catch(_0x2c558a){console[_0x5febc6(0x24ab)](_0x5febc6(0x11a1),_0x2c558a);}}async function sendFriendRequest(_0x3f97ec,_0x32c837=''){const _0x181673=_0x2cf6d4;try{const _0x143290={'id':_0x181673(0x2400)+Date[_0x181673(0x18e0)]()+'_'+Math[_0x181673(0x191c)]()[_0x181673(0x9a3)](0x24)[_0x181673(0x18cf)](0x2,0x9),'fromId':_0x181673(0x23b2),'toId':_0x3f97ec,'timestamp':new Date()[_0x181673(0xa4b)](),'status':'pending','type':_0x181673(0x116c),'message':_0x32c837};friendRequestsData[_0x181673(0x50a)](_0x143290),await db['friendRequests'][_0x181673(0xe1)](_0x143290),showToast('好友申请已发送',_0x181673(0xb27));}catch(_0x4d64ab){console['error']('发送好友申请失败:',_0x4d64ab),showToast(_0x181673(0x13d1),_0x181673(0x24ab));}}function updateChatBlockedStatus(){const _0x416556=_0x2cf6d4;if(!currentChatCharacter)return;const _0x3b95c0=currentChatCharacter['id'],_0x482784=currentChatCharacter[_0x416556(0x4b7)],_0x560060=document['querySelector'](_0x416556(0x5a5));_0x560060&&_0x560060['remove']();const _0x101864=document[_0x416556(0x15b8)](_0x416556(0x2251));_0x101864&&_0x101864[_0x416556(0x128)]();if(!_0x482784){const _0x36bc92=isBlocked('user',_0x3b95c0),_0x180ec4=isBlocked(_0x3b95c0,'user');if(_0x180ec4){const _0x3f646f=document[_0x416556(0x15b8)](_0x416556(0x13f6));if(_0x3f646f){const _0x2812cb=document[_0x416556(0x1ad8)](_0x416556(0x526));_0x2812cb['className']=_0x416556(0x1b6a),_0x2812cb[_0x416556(0xc02)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22notice-text\x22>你被\x20'+currentChatCharacter['name']+_0x416556(0x9ec),_0x3f646f[_0x416556(0x1925)](_0x2812cb);}addCharacterBlockedHint(_0x3b95c0);}renderChatMessages(_0x3b95c0);}}function addCharacterBlockedHint(_0x5e4ea1){const _0x288d69=_0x2cf6d4,_0x28dec1=document[_0x288d69(0x566)](_0x288d69(0x11e1));if(!_0x28dec1)return;const _0x588a2f=_0x28dec1[_0x288d69(0x15b8)](_0x288d69(0x2251));_0x588a2f&&_0x588a2f[_0x288d69(0x128)]();const _0x9e8bea=document['createElement'](_0x288d69(0x526));_0x9e8bea[_0x288d69(0x221)]='character-blocked-hint',_0x9e8bea[_0x288d69(0x655)]['cssText']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20text-align:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin:\x2020px\x20auto;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2015px\x2020px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20rgba(255,\x20193,\x207,\x200.1);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x201px\x20solid\x20rgba(255,\x20193,\x207,\x200.3);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20max-width:\x20320px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#856404;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2013px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20line-height:\x201.4;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x9e8bea[_0x288d69(0xc02)]=_0x288d69(0x1bbe)+currentChatCharacter[_0x288d69(0x222f)]+_0x288d69(0x18be),_0x28dec1[_0x288d69(0x1806)](_0x9e8bea,_0x28dec1['firstChild']);}function checkAndCreateBlockedSystemMessage(_0x2cadc8,_0x232192){const _0x4ab5fb=_0x2cf6d4;if(!currentChatCharacter||currentChatCharacter['isGroup'])return;const _0x5551d0=isBlocked(_0x232192,_0x4ab5fb(0x23b2));if(_0x5551d0){const _0x24de9f=document[_0x4ab5fb(0x566)]('api-chat-messages'),_0x1776ed=document[_0x4ab5fb(0x1ad8)]('div');_0x1776ed[_0x4ab5fb(0x221)]=_0x4ab5fb(0x249b),_0x1776ed[_0x4ab5fb(0x655)][_0x4ab5fb(0x17a3)]=_0x4ab5fb(0x11d6),_0x1776ed[_0x4ab5fb(0x21dc)]=_0x4ab5fb(0x81e),_0x24de9f[_0x4ab5fb(0x1925)](_0x1776ed),setTimeout(()=>{const _0xb65f31=_0x4ab5fb;_0x24de9f[_0xb65f31(0x5e5)]=_0x24de9f[_0xb65f31(0x14c8)];},0x64);}}function cleanupBlockedSystemMessages(){const _0x219dd5=_0x2cf6d4;let _0x57eadc=![];Object['keys'](chatMessages)[_0x219dd5(0x900)](_0x453b43=>{const _0x4cc4d4=_0x219dd5,_0x372a42=chatMessages[_0x453b43],_0x357173=_0x372a42['length'];chatMessages[_0x453b43]=_0x372a42[_0x4cc4d4(0x803)](_0x4a156b=>!(_0x4a156b[_0x4cc4d4(0xf75)]===_0x4cc4d4(0x212)&&_0x4a156b[_0x4cc4d4(0x245d)])),chatMessages[_0x453b43][_0x4cc4d4(0xcbf)]!==_0x357173&&(_0x57eadc=!![],console[_0x4cc4d4(0xc0d)](_0x4cc4d4(0x46d)+_0x453b43+'\x20的聊天记录中移除了\x20'+(_0x357173-chatMessages[_0x453b43][_0x4cc4d4(0xcbf)])+_0x4cc4d4(0x1cc5)));}),_0x57eadc&&(saveChatMessages(),console[_0x219dd5(0xc0d)](_0x219dd5(0x1ff4)));}function addBlockedIndicatorToMessage(_0x49db7c,_0x2418a7,_0x29d6d2){const _0x53edcf=_0x2cf6d4;if(!currentChatCharacter)return;if(_0x2418a7[_0x53edcf(0x23df)]===_0x53edcf(0x14f2))return;const _0x22aae8=_0x2418a7[_0x53edcf(0x7aa)];let _0x2a8a23=![],_0x22f826=null;if(_0x2418a7[_0x53edcf(0xf75)]==='sent'){const _0x2fca63=blacklistData[_0x53edcf(0x1aeb)](_0x4190d2=>_0x4190d2[_0x53edcf(0x1b1a)]===_0x29d6d2&&_0x4190d2[_0x53edcf(0x20ba)]===_0x53edcf(0x23b2));if(_0x2fca63){_0x22f826=new Date(_0x2fca63[_0x53edcf(0x7aa)])[_0x53edcf(0xa57)]();const _0x38f5a7=_0x2fca63[_0x53edcf(0x1f27)]&&_0x2fca63[_0x53edcf(0x313)]?new Date(_0x2fca63[_0x53edcf(0x313)])[_0x53edcf(0xa57)]():Date[_0x53edcf(0x18e0)]();_0x2a8a23=_0x22aae8>=_0x22f826&&(_0x22aae8<=_0x38f5a7||!_0x2fca63[_0x53edcf(0x1f27)]);}}else{if(_0x2418a7[_0x53edcf(0xf75)]===_0x53edcf(0x232)){const _0xaba978=blacklistData[_0x53edcf(0x1aeb)](_0x2588e5=>_0x2588e5[_0x53edcf(0x1b1a)]===_0x53edcf(0x23b2)&&_0x2588e5['blockedId']===_0x29d6d2);if(_0xaba978){_0x22f826=new Date(_0xaba978[_0x53edcf(0x7aa)])[_0x53edcf(0xa57)]();const _0x5b736e=_0xaba978[_0x53edcf(0x1f27)]&&_0xaba978['unblockTimestamp']?new Date(_0xaba978['unblockTimestamp'])[_0x53edcf(0xa57)]():Date[_0x53edcf(0x18e0)]();_0x2a8a23=_0x22aae8>=_0x22f826&&(_0x22aae8<=_0x5b736e||!_0xaba978[_0x53edcf(0x1f27)]);}}}if(_0x2a8a23){const _0x5783b7=_0x49db7c[_0x53edcf(0x15b8)](_0x53edcf(0x823)),_0x3e41b6=_0x49db7c[_0x53edcf(0x1063)]?.[_0x53edcf(0x226e)][_0x53edcf(0x1f9)](_0x53edcf(0x17e9));if(_0x5783b7&&_0x3e41b6)return;if(!_0x5783b7){const _0x28cb8a=document[_0x53edcf(0x1ad8)](_0x53edcf(0x526));_0x28cb8a['className']=_0x53edcf(0x251a),_0x28cb8a['innerHTML']='!',_0x28cb8a['title']='消息已发出，但被对方拒收了',_0x49db7c[_0x53edcf(0x655)][_0x53edcf(0x492)]=_0x53edcf(0x1b89),_0x49db7c['appendChild'](_0x28cb8a),setTimeout(()=>{const _0x5b6d24=_0x53edcf,_0x287007=_0x49db7c[_0x5b6d24(0x15b8)]('.message-bubble');if(_0x287007){const _0x1ad17=_0x49db7c[_0x5b6d24(0xb37)](),_0x2c6db2=_0x287007[_0x5b6d24(0xb37)]();if(_0x2418a7['sender']===_0x5b6d24(0xfda)){const _0x1ede08=_0x2c6db2[_0x5b6d24(0x1466)]-_0x1ad17[_0x5b6d24(0x1466)];_0x28cb8a[_0x5b6d24(0x655)][_0x5b6d24(0x1466)]=_0x1ede08-0x14+'px',_0x28cb8a[_0x5b6d24(0x655)]['right']=_0x5b6d24(0x153f);}else{if(_0x2418a7[_0x5b6d24(0xf75)]==='received'){const _0x44f9d5=_0x2c6db2[_0x5b6d24(0x1417)]-_0x1ad17[_0x5b6d24(0x1466)];_0x28cb8a[_0x5b6d24(0x655)][_0x5b6d24(0x1466)]=_0x44f9d5+0x3+'px',_0x28cb8a[_0x5b6d24(0x655)][_0x5b6d24(0x1417)]='auto';}}}},0xa);}if(!_0x3e41b6){const _0x51a03d=document[_0x53edcf(0x1ad8)]('div');_0x51a03d['className']=_0x53edcf(0x17e9),_0x51a03d[_0x53edcf(0x655)]['cssText']=_0x53edcf(0x110d),_0x51a03d['textContent']=_0x53edcf(0x81e),_0x49db7c[_0x53edcf(0xe9)][_0x53edcf(0x1806)](_0x51a03d,_0x49db7c[_0x53edcf(0x91f)]);}}}function showBlacklistSettings(){const _0x466095=_0x2cf6d4;if(!currentChatCharacter){showToast(_0x466095(0x1268),_0x466095(0x13bb));return;}const _0x36486b=currentChatCharacter['id'],_0x2e34fb=currentChatCharacter[_0x466095(0x4b7)];if(_0x2e34fb)showGroupMuteSettings(_0x36486b);else{const _0x293ba5=isBlocked(_0x466095(0x23b2),_0x36486b),_0x5cf426=document['getElementById'](_0x466095(0x221e)),_0x36c878=document[_0x466095(0x566)]('block-action-label'),_0x3d3afd=document[_0x466095(0x566)](_0x466095(0xd40));_0x293ba5?(_0x5cf426[_0x466095(0x21dc)]=_0x466095(0x997),_0x36c878[_0x466095(0x21dc)]=_0x466095(0xe00),_0x3d3afd[_0x466095(0x21dc)]='恢复与该角色的正常聊天'):(_0x5cf426[_0x466095(0x21dc)]=_0x466095(0x1bb7),_0x36c878[_0x466095(0x21dc)]='拉黑此角色',_0x3d3afd[_0x466095(0x21dc)]=_0x466095(0x2369)),document['getElementById'](_0x466095(0x71e))[_0x466095(0x655)][_0x466095(0x2526)]=_0x466095(0x1f0b);}}function updateBlockManageLabel(_0x4674cc){const _0x44871f=_0x2cf6d4,_0x452aa4=document['getElementById']('block-manage-label'),_0x1d2cd3=document['getElementById']('block-manage-desc');_0x452aa4&&_0x1d2cd3&&(_0x4674cc?(_0x452aa4[_0x44871f(0x21dc)]=_0x44871f(0x1a6e),_0x1d2cd3[_0x44871f(0x21dc)]=_0x44871f(0x209e)):(_0x452aa4['textContent']=_0x44871f(0x170d),_0x1d2cd3[_0x44871f(0x21dc)]=_0x44871f(0xc56)));}function showGroupMuteSettings(_0x44b7fb){const _0x53aeba=_0x2cf6d4,_0x1cf258=isGroupMuted(_0x44b7fb),_0x1fb0eb=document[_0x53aeba(0x566)](_0x53aeba(0x221e)),_0x372017=document['getElementById'](_0x53aeba(0x1846)),_0x434ba2=document[_0x53aeba(0x566)](_0x53aeba(0xd40));_0x1cf258?(_0x1fb0eb['textContent']='你已屏蔽此群聊',_0x372017['textContent']='取消屏蔽',_0x434ba2['textContent']=_0x53aeba(0x245f)):(_0x1fb0eb['textContent']='正常接收群聊消息',_0x372017[_0x53aeba(0x21dc)]=_0x53aeba(0x13c2),_0x434ba2[_0x53aeba(0x21dc)]=_0x53aeba(0xf8e)),document[_0x53aeba(0x566)]('blacklist-settings-modal')[_0x53aeba(0x655)][_0x53aeba(0x2526)]=_0x53aeba(0x1f0b);}function isGroupMuted(_0xa36c1a){const _0x59bc81=_0x2cf6d4,_0x1c8899=JSON[_0x59bc81(0x168e)](localStorage[_0x59bc81(0x2250)](_0x59bc81(0x190e))||'[]');return _0x1c8899[_0x59bc81(0x23ec)](_0xa36c1a);}function toggleGroupMute(_0x256a2e){const _0x300e12=_0x2cf6d4,_0x2ca3af=JSON[_0x300e12(0x168e)](localStorage[_0x300e12(0x2250)](_0x300e12(0x190e))||'[]'),_0x56746b=_0x2ca3af[_0x300e12(0x23ec)](_0x256a2e);if(_0x56746b){const _0x45a6c5=_0x2ca3af['indexOf'](_0x256a2e);_0x45a6c5>-0x1&&_0x2ca3af[_0x300e12(0x220f)](_0x45a6c5,0x1),showToast('已取消屏蔽\x20'+currentChatCharacter?.[_0x300e12(0x222f)],'success');}else _0x2ca3af[_0x300e12(0x6ee)](_0x256a2e),showToast('已屏蔽\x20'+currentChatCharacter?.[_0x300e12(0x222f)],_0x300e12(0x2422));localStorage[_0x300e12(0x2055)](_0x300e12(0x190e),JSON[_0x300e12(0x7fb)](_0x2ca3af)),renderContactList(),hideBlacklistSettings();}function hideBlacklistSettings(){const _0x385930=_0x2cf6d4;document[_0x385930(0x566)](_0x385930(0x71e))[_0x385930(0x655)]['display']=_0x385930(0xfe9);}function showFriendRequestModal(){const _0x18b2ba=_0x2cf6d4;if(!currentChatCharacter)return;document['getElementById'](_0x18b2ba(0x1d6b))[_0x18b2ba(0xc34)]='',document[_0x18b2ba(0x566)](_0x18b2ba(0x1e3e))['style'][_0x18b2ba(0x2526)]='flex';}function hideFriendRequestModal(){const _0x3af59e=_0x2cf6d4;document[_0x3af59e(0x566)](_0x3af59e(0x1e3e))[_0x3af59e(0x655)][_0x3af59e(0x2526)]=_0x3af59e(0xfe9);}async function sendFriendRequestConfirm(){const _0xea7eb9=_0x2cf6d4;if(!currentChatCharacter)return;const _0xdc79ae=document[_0xea7eb9(0x566)](_0xea7eb9(0x1d6b))[_0xea7eb9(0xc34)][_0xea7eb9(0x1424)](),_0x165028=currentChatCharacter['id'];await sendFriendRequest(_0x165028,_0xdc79ae),hideFriendRequestModal(),showToast(_0xea7eb9(0xcb9),_0xea7eb9(0x2422)),await processAIFriendRequestResponse(_0x165028,_0xdc79ae);}function isRecentFriendRequestSpam(_0x5716ca){const _0x157e6d=_0x2cf6d4;if(!_0x5716ca||!chatMessages[_0x5716ca])return![];const _0x4795cc=chatMessages[_0x5716ca],_0x17f143=Date[_0x157e6d(0x18e0)](),_0x51ec08=0x5*0x3c*0x3e8;for(let _0x161e73=_0x4795cc['length']-0x1;_0x161e73>=0x0;_0x161e73--){const _0x4c749b=_0x4795cc[_0x161e73];if(_0x4c749b['type']===_0x157e6d(0x14f2)&&_0x4c749b[_0x157e6d(0xf75)]===_0x157e6d(0x232)){const _0x43e15a=_0x17f143-_0x4c749b[_0x157e6d(0x7aa)];if(_0x43e15a<_0x51ec08&&!_0x4c749b[_0x157e6d(0xcc9)])return console[_0x157e6d(0xc0d)]('🚫\x20[防崩坏]\x20检测到5分钟内的重复好友申请，跳过'),!![];break;}}return![];}async function handleAIFriendRequest(_0x223285,_0x37cd42,_0xe5d368){const _0x1e4631=_0x2cf6d4;if(!currentChatCharacter||currentChatCharacter['id']!==_0x223285)return;try{const _0x13dec3=document[_0x1e4631(0x15b8)](_0x1e4631(0x64f)+_0xe5d368+'\x22]\x20.friend-request-card');if(_0x13dec3){const _0x31cb31=_0x13dec3[_0x1e4631(0x15b8)](_0x1e4631(0x767));if(_0x31cb31){const _0x18896c=_0x37cd42?'已同意':'已拒绝',_0x57c413=_0x37cd42?'accepted':_0x1e4631(0x1164);_0x31cb31[_0x1e4631(0xc02)]=_0x1e4631(0x93e)+_0x57c413+'\x22>'+_0x18896c+_0x1e4631(0xa54);}}if(_0x37cd42){await unblockCharacter(_0x223285);!chatMessages[_0x223285]&&(chatMessages[_0x223285]=[]);const _0x5c867f=chatMessages[_0x223285][_0x1e4631(0x23ba)](_0x5cd4b0=>_0x5cd4b0['id']===_0xe5d368);_0x5c867f!==-0x1?(chatMessages[_0x223285][_0x5c867f][_0x1e4631(0xcc9)]=!![],chatMessages[_0x223285][_0x5c867f][_0x1e4631(0xe45)]=!![],console[_0x1e4631(0xc0d)](_0x1e4631(0xdea),_0xe5d368)):console[_0x1e4631(0x24ab)](_0x1e4631(0xbf1),_0xe5d368);const _0x56573f={'id':Date[_0x1e4631(0x18e0)]()[_0x1e4631(0x9a3)](),'sender':_0x1e4631(0x212),'content':'你们已成功添加为好友，现在可以开始聊天了！','timestamp':Date[_0x1e4631(0x18e0)](),'role':'system'};chatMessages[_0x223285][_0x1e4631(0x6ee)](_0x56573f);try{if(_0x5c867f!==-0x1){const _0x5d05c6=chatMessages[_0x223285][_0x5c867f],_0x400608=_0x223285+'_'+_0x5d05c6['id']+'_'+_0x5c867f;await db[_0x1e4631(0x464)][_0x1e4631(0x53a)]({'id':_0x400608,'characterId':_0x223285,'timestamp':_0x5d05c6[_0x1e4631(0x7aa)],'messageOrder':_0x5c867f,'originalMessageId':_0x5d05c6['id'],'messageData':_0x5d05c6});}const _0x31c897=_0x223285+'_'+_0x56573f['id']+'_'+(chatMessages[_0x223285][_0x1e4631(0xcbf)]-0x1);await db[_0x1e4631(0x464)][_0x1e4631(0xe1)]({'id':_0x31c897,'characterId':_0x223285,'timestamp':_0x56573f[_0x1e4631(0x7aa)],'messageOrder':chatMessages[_0x223285]['length']-0x1,'originalMessageId':_0x56573f['id'],'messageData':_0x56573f}),console[_0x1e4631(0xc0d)](_0x1e4631(0x145b));}catch(_0x10e7c9){console[_0x1e4631(0x24ab)](_0x1e4631(0x127b),_0x10e7c9),await saveChatMessagesImmediate();}renderChatMessages(_0x223285),updateChatBlockedStatus();}else{!chatMessages[_0x223285]&&(chatMessages[_0x223285]=[]);const _0x1e223b=chatMessages[_0x223285]['findIndex'](_0x3729a1=>_0x3729a1['id']===_0xe5d368);_0x1e223b!==-0x1?(chatMessages[_0x223285][_0x1e223b][_0x1e4631(0xcc9)]=!![],chatMessages[_0x223285][_0x1e223b]['friendRequestAccepted']=![],console[_0x1e4631(0xc0d)]('✅\x20标记好友申请消息为已拒绝:',_0xe5d368)):console[_0x1e4631(0x24ab)](_0x1e4631(0xbf1),_0xe5d368);const _0x323713={'id':Date[_0x1e4631(0x18e0)]()[_0x1e4631(0x9a3)](),'sender':_0x1e4631(0x212),'content':_0x1e4631(0x1ccd),'timestamp':Date[_0x1e4631(0x18e0)](),'role':'system'};chatMessages[_0x223285][_0x1e4631(0x6ee)](_0x323713);try{if(_0x1e223b!==-0x1){const _0x18308a=chatMessages[_0x223285][_0x1e223b],_0x558ab4=_0x223285+'_'+_0x18308a['id']+'_'+_0x1e223b;await db['chatMessages'][_0x1e4631(0x53a)]({'id':_0x558ab4,'characterId':_0x223285,'timestamp':_0x18308a[_0x1e4631(0x7aa)],'messageOrder':_0x1e223b,'originalMessageId':_0x18308a['id'],'messageData':_0x18308a});}const _0x4e385a=_0x223285+'_'+_0x323713['id']+'_'+(chatMessages[_0x223285][_0x1e4631(0xcbf)]-0x1);await db['chatMessages'][_0x1e4631(0xe1)]({'id':_0x4e385a,'characterId':_0x223285,'timestamp':_0x323713[_0x1e4631(0x7aa)],'messageOrder':chatMessages[_0x223285][_0x1e4631(0xcbf)]-0x1,'originalMessageId':_0x323713['id'],'messageData':_0x323713}),console[_0x1e4631(0xc0d)]('✅\x20[高效好友申请拒绝]\x20消息已保存到数据库');}catch(_0xe6494){console['error']('好友申请拒绝消息单条保存失败，回退到批量保存:',_0xe6494),await saveChatMessagesImmediate();}renderChatMessages(_0x223285),window[_0x1e4631(0x18a2)]&&window[_0x1e4631(0x18a2)](_0x223285);}}catch(_0x8c3924){console[_0x1e4631(0x24ab)](_0x1e4631(0x19e4),_0x8c3924),showToast(_0x1e4631(0x1038),_0x1e4631(0x24ab));}}function performBlockAction(){const _0x32b4e8=_0x2cf6d4;if(!currentChatCharacter)return;const _0x5c75b2=currentChatCharacter['id'],_0x4b1c7d=currentChatCharacter[_0x32b4e8(0x4b7)];if(_0x4b1c7d){const _0x47fc0c=isGroupMuted(_0x5c75b2);_0x47fc0c?confirm(_0x32b4e8(0x11d2)+currentChatCharacter[_0x32b4e8(0x222f)]+_0x32b4e8(0x1e09))&&toggleGroupMute(_0x5c75b2):confirm('确定要屏蔽\x20'+currentChatCharacter[_0x32b4e8(0x222f)]+'\x20吗？\x0a\x0a屏蔽后将不再接收该群聊的消息通知')&&toggleGroupMute(_0x5c75b2);}else{const _0x29224e=isBlocked(_0x32b4e8(0x23b2),_0x5c75b2);_0x29224e?confirm(_0x32b4e8(0x23ce)+currentChatCharacter[_0x32b4e8(0x222f)]+_0x32b4e8(0x7c9))&&(unblockCharacter(_0x5c75b2),hideBlacklistSettings()):confirm('确定要拉黑\x20'+currentChatCharacter['name']+_0x32b4e8(0x1e09))&&(blockCharacter(_0x5c75b2,''),hideBlacklistSettings());}}document[_0x2cf6d4(0x167)](_0x2cf6d4(0x7f7),async function(){setTimeout(async()=>{const _0x4f140b=_0x3a81;try{await Promise['all']([loadBlacklistData(),loadFriendRequestsData(),loadCharacterStatusData()]),console[_0x4f140b(0xc0d)]('🚫\x20拉黑系统数据加载完成');}catch(_0x1417c2){console['error'](_0x4f140b(0x1e75),_0x1417c2);}},0x3e8);});async function loadFriendRequestsData(){const _0x2a53d5=_0x2cf6d4;try{friendRequestsData=await db[_0x2a53d5(0xa52)][_0x2a53d5(0x1902)](_0x2a53d5(0x7aa))['reverse']()[_0x2a53d5(0x18c6)](),console[_0x2a53d5(0xc0d)]('好友申请数据加载完成:',friendRequestsData);}catch(_0x3bf480){console['error'](_0x2a53d5(0x9d),_0x3bf480),friendRequestsData=[];}}async function loadCharacterStatusData(){const _0x25b12b=_0x2cf6d4;try{characterStatusData=await db[_0x25b12b(0x5a2)][_0x25b12b(0x18c6)](),console[_0x25b12b(0xc0d)](_0x25b12b(0x51b),characterStatusData);}catch(_0x3b67c3){console[_0x25b12b(0x24ab)](_0x25b12b(0x1158),_0x3b67c3),characterStatusData=[];}}function renderCharacterStatus(_0x1b7d88,_0x5eeee0){const _0x1595b3=_0x2cf6d4,_0x534595=getCurrentChatSettings();if(!_0x534595[_0x1595b3(0x261)]){if(_0x5eeee0){const _0x18997f=_0x5eeee0[_0x1595b3(0x15b8)](_0x1595b3(0x65c));_0x18997f&&_0x18997f[_0x1595b3(0x128)]();}return;}const _0x515e08=getCharacterStatus(_0x1b7d88),_0x2025f3=isBlocked(_0x1595b3(0x23b2),_0x1b7d88),_0x1867fd=isBlocked(_0x1b7d88,_0x1595b3(0x23b2));let _0x345925=_0x1595b3(0x20bb),_0x53cc12=_0x515e08[_0x1595b3(0x2016)]||'在线';if(_0x2025f3||_0x1867fd)_0x345925=_0x1595b3(0x1db5),_0x53cc12='已拉黑';else _0x515e08[_0x1595b3(0xe54)]===_0x1595b3(0x3cb)&&(_0x345925='busy');const _0x3cebe3='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22character-status\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22status-indicator\x20'+_0x345925+'\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22status-text\x22>'+_0x53cc12+_0x1595b3(0xff4);if(_0x5eeee0){const _0x99761f=_0x5eeee0[_0x1595b3(0x15b8)]('.character-status');_0x99761f&&_0x99761f['remove']();if(_0x5eeee0['classList'][_0x1595b3(0x1f9)](_0x1595b3(0x7be)))_0x5eeee0[_0x1595b3(0x22ba)](_0x1595b3(0x580),_0x3cebe3);else{if(_0x5eeee0[_0x1595b3(0x226e)][_0x1595b3(0x1f9)](_0x1595b3(0x2577))){const _0x41e09e=_0x5eeee0[_0x1595b3(0x15b8)]('.app-title');_0x41e09e?_0x41e09e['insertAdjacentHTML'](_0x1595b3(0x14ed),_0x3cebe3):_0x5eeee0['insertAdjacentHTML'](_0x1595b3(0x580),_0x3cebe3);}else _0x5eeee0[_0x1595b3(0x22ba)](_0x1595b3(0x580),_0x3cebe3);}}}async function generateCharacterStatus(_0x42ef02){const _0x19f063=_0x2cf6d4;try{const _0x38aabd=characters[_0x19f063(0x1aeb)](_0x1cf8b6=>_0x1cf8b6['id']===_0x42ef02);if(!_0x38aabd)return;const _0x5bb02a=await getAsyncChatSettings(_0x42ef02),_0x3e2f9e=chatMessages[_0x42ef02]||[],_0x2e6b73=[];let _0x5e870a=-0x1;for(let _0x2c4d92=_0x3e2f9e[_0x19f063(0xcbf)]-0x1;_0x2c4d92>=0x0;_0x2c4d92--){if(_0x3e2f9e[_0x2c4d92][_0x19f063(0xf75)]===_0x19f063(0x232)){_0x5e870a=_0x2c4d92;break;}}if(_0x5e870a===-0x1)console['log'](_0x19f063(0x239a));else{for(let _0x32f954=0x0;_0x32f954<=_0x5e870a;_0x32f954++){const _0x3a9521=_0x3e2f9e[_0x32f954];_0x3a9521&&_0x3a9521['timestamp']&&_0x3a9521['id']&&_0x2e6b73[_0x19f063(0x6ee)](_0x3a9521);}const _0x2ef535=_0x3e2f9e['slice'](_0x5e870a+0x1),_0x2dbf9a=_0x2ef535['filter'](_0x95c8b6=>_0x95c8b6[_0x19f063(0xf75)]===_0x19f063(0xfda));_0x2dbf9a['length']>0x0&&(console[_0x19f063(0xc0d)](_0x19f063(0x9a9)+_0x2dbf9a['length']+'条）:'),_0x2dbf9a[_0x19f063(0x900)]((_0x5a0208,_0x3e6d26)=>{const _0x3bc84b=_0x19f063;let _0x57a539='';if(typeof _0x5a0208[_0x3bc84b(0x1423)]===_0x3bc84b(0xb97))_0x57a539=_0x5a0208[_0x3bc84b(0x1423)][_0x3bc84b(0x4b2)](0x0,0x1e);else{if(Array[_0x3bc84b(0x1bcc)](_0x5a0208[_0x3bc84b(0x1423)])){const _0x42db54=_0x5a0208[_0x3bc84b(0x1423)]['find'](_0x5b957c=>_0x5b957c[_0x3bc84b(0x23df)]===_0x3bc84b(0x1e58));_0x57a539=_0x42db54?_0x42db54[_0x3bc84b(0x1e58)][_0x3bc84b(0x4b2)](0x0,0x1e):'[多媒体消息]';}else _0x57a539='[特殊消息]';}console[_0x3bc84b(0xc0d)](_0x3bc84b(0x61a)+(_0x3e6d26+0x1)+'.\x20'+_0x57a539+'...');}));}const _0x3790ce=_0x2e6b73[_0x19f063(0x136)](-0x7);let _0x17612d='';if(_0x3790ce['length']>0x0){const _0xf316e8=getCurrentPersonaName();_0x17612d='最近的聊天记录（仅包含已完成的对话轮次）：\x0a'+_0x3790ce[_0x19f063(0xf6d)](_0x28db24=>{const _0x4386a6=_0x19f063;if(!_0x28db24[_0x4386a6(0x1423)]||typeof _0x28db24['content']!=='string')return'';if(_0x28db24[_0x4386a6(0xf75)]===_0x4386a6(0xfda))return _0xf316e8+'：'+_0x28db24[_0x4386a6(0x1423)];if(_0x28db24[_0x4386a6(0xf75)]==='received')return _0x38aabd[_0x4386a6(0x222f)]+'：'+_0x28db24[_0x4386a6(0x1423)];return'';})['filter'](Boolean)[_0x19f063(0x140c)]('\x0a')+'\x0a\x0a';}else _0x17612d='当前没有已完成的对话轮次可供参考。\x0a\x0a';let _0x51c927='';if(_0x5bb02a?.[_0x19f063(0x1cee)]&&_0x5bb02a[_0x19f063(0x1cee)][_0x19f063(0xcbf)]>0x0)try{const _0x211d32=await Promise[_0x19f063(0x2339)](_0x5bb02a[_0x19f063(0x1cee)][_0x19f063(0xf6d)](_0x896f6d=>db[_0x19f063(0x195c)]['get'](_0x896f6d))),_0x15446b=_0x211d32['filter'](_0x328eab=>_0x328eab&&_0x328eab['content']);_0x15446b[_0x19f063(0xcbf)]>0x0&&(_0x51c927=_0x19f063(0x5fa)+_0x15446b[_0x19f063(0xf6d)](_0xeb6bea=>_0xeb6bea[_0x19f063(0x222f)]+'：'+_0xeb6bea['content'])[_0x19f063(0x140c)]('\x0a\x0a')+'\x0a\x0a');}catch(_0x45f8cf){console[_0x19f063(0x24ab)](_0x19f063(0xf5c),_0x45f8cf);}const _0x555d7e=Math[_0x19f063(0x191c)]()<0.5?_0x19f063(0x2016):_0x19f063(0x2179),_0x51e28b=new Date(),_0x58ff64='当前时间：'+_0x51e28b[_0x19f063(0x133a)]('zh-CN',{'weekday':'long','year':'numeric','month':_0x19f063(0x2040),'day':'numeric','hour':_0x19f063(0x19f3),'minute':'2-digit'});let _0x4fa73d;_0x555d7e==='activity'?_0x4fa73d='你是'+_0x38aabd[_0x19f063(0x222f)]+_0x19f063(0x688)+_0x38aabd[_0x19f063(0x1a84)]+'\x0a\x0a'+_0x51c927+_0x58ff64+'\x0a\x0a'+_0x17612d+'请根据你的人设、当前时间和剧情，生成一个符合你当前状况的活动状态。\x0a\x0a【重要要求】：\x0a1.\x20只输出5-15字的状态描述，不要任何解释或多余内容\x0a2.\x20必须符合你的性格和身份设定\x0a3.\x20要考虑当前时间（早上/下午/晚上）的合理性\x0a4.\x20基于最近的聊天内容调整活动内容\x0a5.\x20格式：在[地点][做什么]\x20或\x20[正在做什么]\x0a6.\x20要生动具体，体现角色个性\x0a\x0a优秀示例：\x0a-\x20在咖啡厅翻阅诗集\x0a-\x20正在阳台上浇花\x0a-\x20在工作室调试设备\x0a-\x20躺在床上发呆\x0a-\x20在厨房准备晚餐\x0a\x0a请直接输出状态（不要引号）：':_0x4fa73d='你是'+_0x38aabd[_0x19f063(0x222f)]+_0x19f063(0x688)+_0x38aabd[_0x19f063(0x1a84)]+'\x0a\x0a'+_0x51c927+_0x58ff64+'\x0a\x0a'+_0x17612d+_0x19f063(0x2046);const _0x2a180d=await generateStatusAPI(_0x4fa73d,_0x38aabd);if(_0x2a180d&&_0x2a180d[_0x19f063(0x1424)]()&&_0x2a180d!=='在线'){await updateCharacterStatus(_0x42ef02,'online',_0x2a180d),console[_0x19f063(0xc0d)](_0x19f063(0x1155)+_0x38aabd[_0x19f063(0x222f)]+'生成'+(_0x555d7e==='activity'?'活动':'心情')+_0x19f063(0x1f60)+_0x2a180d);const _0xc5ab3a=_0x3e2f9e['length']-_0x2e6b73[_0x19f063(0xcbf)],_0x586d2c=_0x3e2f9e[_0x19f063(0x136)](_0x2e6b73[_0x19f063(0xcbf)])[_0x19f063(0x803)](_0x231c83=>_0x231c83[_0x19f063(0xf75)]==='sent')[_0x19f063(0xcbf)];_0x586d2c>0x0?console['log'](_0x19f063(0x1968)+_0x3790ce[_0x19f063(0xcbf)]+_0x19f063(0x2a1)+_0x586d2c+_0x19f063(0x13b2)):console[_0x19f063(0xc0d)](_0x19f063(0x1968)+_0x3790ce[_0x19f063(0xcbf)]+_0x19f063(0x190c));}else{const _0x4a25f5=generateFallbackStatus(_0x38aabd,_0x555d7e);await updateCharacterStatus(_0x42ef02,'online',_0x4a25f5),console[_0x19f063(0xc0d)](_0x19f063(0x27f)+_0x38aabd[_0x19f063(0x222f)]+_0x19f063(0x55d)+(_0x555d7e===_0x19f063(0x2016)?'活动':'心情')+_0x19f063(0x1f60)+_0x4a25f5);}}catch(_0x3c232d){console[_0x19f063(0x24ab)](_0x19f063(0x860),_0x3c232d);const _0x2eb6f2=characters[_0x19f063(0x1aeb)](_0x49c31b=>_0x49c31b['id']===_0x42ef02);if(_0x2eb6f2){const _0x4386c7=generateFallbackStatus(_0x2eb6f2,'activity');await updateCharacterStatus(_0x42ef02,_0x19f063(0x20bb),_0x4386c7),console[_0x19f063(0xc0d)](_0x19f063(0x1e13)+_0x2eb6f2[_0x19f063(0x222f)]+_0x19f063(0x535)+_0x4386c7);}else console[_0x19f063(0x24ab)](_0x19f063(0xbd6)+_0x42ef02);}}function generateFallbackStatus(_0x41cd1c,_0x59f61d){const _0x42ba21=_0x2cf6d4,_0x599eee=(_0x41cd1c[_0x42ba21(0x1a84)]||'')[_0x42ba21(0x1d64)]();if(_0x59f61d==='activity'){if(_0x599eee[_0x42ba21(0x23ec)]('学者')||_0x599eee['includes']('研究')||_0x599eee[_0x42ba21(0x23ec)]('书'))return _0x42ba21(0x1916);else{if(_0x599eee[_0x42ba21(0x23ec)]('战士')||_0x599eee[_0x42ba21(0x23ec)]('剑')||_0x599eee[_0x42ba21(0x23ec)]('战斗'))return _0x42ba21(0x101e);else{if(_0x599eee[_0x42ba21(0x23ec)]('医生')||_0x599eee['includes']('治疗'))return _0x42ba21(0x687);else{if(_0x599eee[_0x42ba21(0x23ec)]('商人')||_0x599eee['includes']('买卖'))return _0x42ba21(0x1762);else{if(_0x599eee[_0x42ba21(0x23ec)]('艺术')||_0x599eee[_0x42ba21(0x23ec)]('画')||_0x599eee['includes']('音乐'))return _0x42ba21(0x537);else return _0x599eee[_0x42ba21(0x23ec)]('厨')||_0x599eee[_0x42ba21(0x23ec)]('料理')?'在厨房准备食材':_0x42ba21(0x1778);}}}}}else{if(_0x599eee[_0x42ba21(0x23ec)]('开朗')||_0x599eee[_0x42ba21(0x23ec)]('活泼')||_0x599eee['includes']('乐观'))return'心情愉悦';else{if(_0x599eee['includes']('冷静')||_0x599eee[_0x42ba21(0x23ec)]('理性')||_0x599eee['includes']('沉着'))return _0x42ba21(0x104b);else{if(_0x599eee[_0x42ba21(0x23ec)]('严肃')||_0x599eee['includes']('认真'))return _0x42ba21(0x1442);else{if(_0x599eee['includes']('温柔')||_0x599eee[_0x42ba21(0x23ec)]('善良'))return _0x42ba21(0x81f);else return _0x599eee[_0x42ba21(0x23ec)]('神秘')||_0x599eee[_0x42ba21(0x23ec)]('深沉')?'若有所思':_0x42ba21(0xd50);}}}}}let characterStatusTimer=null;function getStatusUpdateInterval(){const _0x21eb82=_0x2cf6d4;let _0x14df7e=_0x21eb82(0x1e86);try{const _0x31df55=localStorage['getItem']('globalStatusUpdateFrequency');if(_0x31df55)_0x14df7e=_0x31df55;else{if(currentChatCharacter){const _0x2dcd6c=getCurrentChatSettings();_0x14df7e=_0x2dcd6c[_0x21eb82(0x1e39)]||_0x21eb82(0x1e86),localStorage['setItem'](_0x21eb82(0x193e),_0x14df7e);}}}catch(_0x3c15dc){console[_0x21eb82(0x17cc)](_0x21eb82(0x1e59),_0x3c15dc);}const _0x4e1eed={'high':0x7530,'medium-high':0xea60,'medium':0x2bf20,'medium-low':0x493e0,'low':0x927c0};return _0x4e1eed[_0x14df7e]||_0x4e1eed[_0x21eb82(0x1e86)];}function clearCharacterStatusTimer(){const _0x24d151=_0x2cf6d4;characterStatusTimer&&(clearInterval(characterStatusTimer),characterStatusTimer=null,console[_0x24d151(0xc0d)]('角色状态更新定时器已清除'));}async function startCharacterStatusTimer(){const _0x26203a=_0x2cf6d4;clearCharacterStatusTimer();let _0x461d2=![];for(const _0x2cd972 of characters){if(contacts[_0x26203a(0x23ec)](_0x2cd972['id'])){const _0x331eb4=await getAsyncChatSettings(_0x2cd972['id']);if(_0x331eb4[_0x26203a(0x261)]){_0x461d2=!![];break;}}}if(!_0x461d2){console[_0x26203a(0xc0d)](_0x26203a(0x1c6));return;}const _0x358484=getStatusUpdateInterval();console[_0x26203a(0xc0d)](_0x26203a(0x1f46),_0x358484/0x3e8,'秒'),characterStatusTimer=setInterval(async()=>{const _0x391add=_0x26203a;let _0x35ca4d=![];for(const _0x3b3eee of characters){if(contacts[_0x391add(0x23ec)](_0x3b3eee['id'])){const _0x4013de=await getAsyncChatSettings(_0x3b3eee['id']);if(_0x4013de[_0x391add(0x261)]){_0x35ca4d=!![];const _0x209833=await shouldUpdateCharacterStatus(_0x3b3eee['id']);_0x209833&&await generateCharacterStatus(_0x3b3eee['id']);}}}if(!_0x35ca4d){console[_0x391add(0xc0d)](_0x391add(0x14b2)),clearCharacterStatusTimer();return;}if(currentChatCharacter){const _0x1b84dd=getCurrentChatSettings();if(_0x1b84dd['characterStatusEnabled']){const _0x16cf43=document[_0x391add(0x15b8)]('#api-chat-screen\x20.header');_0x16cf43&&renderCharacterStatus(currentChatCharacter['id'],_0x16cf43);}}},_0x358484);}function restartCharacterStatusTimer(){const _0x417767=_0x2cf6d4;console[_0x417767(0xc0d)]('重启角色状态更新定时器'),startCharacterStatusTimer();}function startStatusUpdateTimer(){startCharacterStatusTimer();}let globalMemoryDB=null;async function initGlobalMemoryDB(){const _0x48df74=_0x2cf6d4;try{!db[_0x48df74(0x1982)]&&(db['memorySummaries']=db[_0x48df74(0xf98)](_0x48df74(0x1982),'++id,\x20characterId,\x20date,\x20summary,\x20context,\x20importance,\x20timestamp')),!db[_0x48df74(0xa1b)]&&(db['coreMemories']=db[_0x48df74(0xf98)]('coreMemories',_0x48df74(0x7e6))),!db[_0x48df74(0x4ad)]&&(db[_0x48df74(0x4ad)]=db[_0x48df74(0xf98)]('memoryEvents',_0x48df74(0x926))),console[_0x48df74(0xc0d)](_0x48df74(0x2ad));}catch(_0x11ac1b){console['error'](_0x48df74(0x1baf),_0x11ac1b);}}async function recordMemoryEvent(_0x93432f,_0x38c1b9,_0x4801a7,_0x6522a5,_0x4183b0=0.5){const _0x170d82=_0x2cf6d4;try{if(!_0x93432f||!_0x4801a7||!_0x6522a5){console[_0x170d82(0x17cc)](_0x170d82(0x1588),{'characterIds':_0x93432f,'eventType':_0x4801a7,'eventData':_0x6522a5});return;}const _0x36dd56={'id':_0x170d82(0x1bcb)+Date[_0x170d82(0x18e0)]()+'_'+Math[_0x170d82(0x191c)]()[_0x170d82(0x9a3)](0x24)[_0x170d82(0x18cf)](0x2,0x9),'timestamp':Date[_0x170d82(0x18e0)](),'characterIds':Array[_0x170d82(0x1bcc)](_0x93432f)?_0x93432f:[_0x93432f],'context':_0x38c1b9||{'type':'unknown','id':_0x170d82(0x22b3)},'eventType':_0x4801a7,'eventData':_0x6522a5,'importance':_0x4183b0||0.5};if(typeof _0x36dd56['eventData']===_0x170d82(0x3c4)&&_0x36dd56[_0x170d82(0x1095)]!==null)try{JSON[_0x170d82(0x7fb)](_0x36dd56[_0x170d82(0x1095)]);}catch(_0x55fd7){console[_0x170d82(0x17cc)](_0x170d82(0x183d),_0x36dd56[_0x170d82(0x1095)]),_0x36dd56[_0x170d82(0x1095)]=String(_0x36dd56[_0x170d82(0x1095)]);}await db[_0x170d82(0x4ad)][_0x170d82(0xe1)](_0x36dd56),console[_0x170d82(0xc0d)]('📝\x20记录事件:',_0x4801a7,_0x93432f);}catch(_0x2462c3){console[_0x170d82(0x24ab)](_0x170d82(0xb94),_0x2462c3),console[_0x170d82(0x24ab)](_0x170d82(0x16d1),{'characterIds':_0x93432f,'context':_0x38c1b9,'eventType':_0x4801a7,'eventData':_0x6522a5,'importance':_0x4183b0});}}async function addCoreMemory(_0x2518d1,_0x8559f,_0x4bf6c8=_0x2cf6d4(0x227f),_0x168ff5=0.8){const _0x37a553=_0x2cf6d4;try{const _0x58423a={'characterId':_0x2518d1,'fact':_0x8559f,'category':_0x4bf6c8,'importance':_0x168ff5,'timestamp':Date[_0x37a553(0x18e0)](),'lastAccessed':Date['now']()};await db['coreMemories'][_0x37a553(0xe1)](_0x58423a),console['log'](_0x37a553(0x2423),_0x8559f);}catch(_0x2df285){console[_0x37a553(0x24ab)]('❌\x20添加核心记忆失败:',_0x2df285);}}async function generateMemorySummary(_0x4269f8,_0x494c43,_0x15e99a,_0x390a8e){const _0x15f6f4=_0x2cf6d4;try{const _0x34f8fe=characters[_0x15f6f4(0x1aeb)](_0x21ff89=>_0x21ff89['id']===_0x4269f8);if(!_0x34f8fe)return console['error']('未找到角色信息:',_0x4269f8),null;const _0x5f10c6=await db[_0x15f6f4(0x75b)][_0x15f6f4(0x4a6)](_0x15f6f4(0x10df))['equals'](_0x4269f8)[_0x15f6f4(0x1534)](_0x346e04=>_0x346e04[_0x15f6f4(0x7aa)]>=_0x494c43&&_0x346e04[_0x15f6f4(0x7aa)]<_0x15e99a)['toArray'](),_0x3eca4a=chatMessages[_0x4269f8]||[],_0x146b57=_0x3eca4a[_0x15f6f4(0x803)](_0x19f045=>_0x19f045[_0x15f6f4(0x7aa)]>=_0x494c43&&_0x19f045[_0x15f6f4(0x7aa)]<_0x15e99a);if(_0x5f10c6[_0x15f6f4(0xcbf)]===0x0&&_0x146b57[_0x15f6f4(0xcbf)]===0x0)return console['log'](_0x15f6f4(0xe4e)),null;let _0x23819c='';_0x146b57[_0x15f6f4(0xcbf)]>0x0&&(_0x23819c+=_0x15f6f4(0x20c),_0x146b57['forEach'](_0x12c9b0=>{const _0x3cd9bc=_0x15f6f4,_0x2ed628=new Date(_0x12c9b0[_0x3cd9bc(0x7aa)])[_0x3cd9bc(0xd4a)](),_0x50cfbe=_0x12c9b0[_0x3cd9bc(0x1562)]===_0x3cd9bc(0x23b2)?'用户':_0x34f8fe[_0x3cd9bc(0x222f)];_0x23819c+='['+_0x2ed628+']\x20'+_0x50cfbe+':\x20'+_0x12c9b0[_0x3cd9bc(0x1423)]+'\x0a';}));_0x5f10c6['length']>0x0&&(_0x23819c+=_0x15f6f4(0xb2d),_0x5f10c6[_0x15f6f4(0x900)](_0x37c228=>{const _0x5445a9=_0x15f6f4,_0x857cc6=new Date(_0x37c228[_0x5445a9(0x7aa)])['toLocaleTimeString'](),_0x41835e=getActionDescription(_0x37c228[_0x5445a9(0x23af)],_0x37c228[_0x5445a9(0x30b)]);_0x23819c+='['+_0x857cc6+']\x20'+_0x41835e+'\x0a';}));const _0x42a721=_0x15f6f4(0x854)+_0x34f8fe[_0x15f6f4(0x222f)]+'\x0a时间段：'+new Date(_0x494c43)[_0x15f6f4(0x133a)]()+_0x15f6f4(0x2316)+new Date(_0x15e99a)[_0x15f6f4(0x133a)]()+_0x15f6f4(0x8f9)+_0x23819c+_0x15f6f4(0x219a)+_0x34f8fe['name']+'\x22指代角色\x0a3.\x20重点记录重要事件和情感变化\x0a4.\x20不要使用\x22我\x22、\x22你\x22等第一、第二人称\x0a5.\x20直接输出摘要文本，不要JSON格式，不要聊天回复格式\x0a\x0a摘要：',_0x289c53=await callSummaryAPI(_0x42a721);if(_0x289c53&&_0x289c53[_0x15f6f4(0x1424)]()){const _0x5250b7=new Date(),_0x4dfd71=_0x5250b7[_0x15f6f4(0x885)]()+'-'+String(_0x5250b7[_0x15f6f4(0x17f3)]()+0x1)[_0x15f6f4(0x863)](0x2,'0')+'-'+String(_0x5250b7['getDate']())['padStart'](0x2,'0'),_0x1465b3={'id':_0x15f6f4(0x1437)+_0x4269f8+'_'+Date[_0x15f6f4(0x18e0)]()+'_'+Math[_0x15f6f4(0x191c)]()[_0x15f6f4(0x9a3)](0x24)[_0x15f6f4(0x18cf)](0x2,0x9),'characterId':_0x4269f8,'date':_0x4dfd71,'summary':_0x289c53[_0x15f6f4(0x1424)](),'context':_0x390a8e,'importance':calculateSummaryImportance(_0x5f10c6[_0x15f6f4(0x1fa8)](_0x146b57)),'timestamp':Date[_0x15f6f4(0x18e0)]()};return await db['memorySummaries'][_0x15f6f4(0xe1)](_0x1465b3),console[_0x15f6f4(0xc0d)](_0x15f6f4(0xa88),_0x1465b3[_0x15f6f4(0x1354)]),_0x1465b3;}}catch(_0x6f775a){console[_0x15f6f4(0x24ab)]('❌\x20生成记忆摘要失败:',_0x6f775a);}return null;}function getActionDescription(_0x5d9913,_0x4ac366){const _0x16e386=_0x2cf6d4,_0x55fe44={'user_message':_0x16e386(0xa62),'ai_reply':'回复了消息','moment_publish':_0x16e386(0x15d9),'moment_comment':_0x16e386(0xc04),'game_start':'开始游戏','game_end':_0x16e386(0x4b3)},_0x197359=_0x55fe44[_0x5d9913]||_0x5d9913;if(_0x4ac366&&_0x4ac366[_0x16e386(0x1423)])return _0x197359+':\x20'+_0x4ac366['content']['substring'](0x0,0x1e)+'...';return _0x197359;}async function callSummaryAPI(_0x5116c1){const _0x5ed431=_0x2cf6d4;if(!apiSettings[_0x5ed431(0x157f)])throw new Error(_0x5ed431(0x1789));const _0x3f0d1d=apiSettings[_0x5ed431(0x90b)]['includes'](_0x5ed431(0xad8));let _0x2d7931,_0x6a66c8,_0x32ba44;if(_0x3f0d1d)_0x6a66c8=apiSettings[_0x5ed431(0x90b)]+_0x5ed431(0x1f4e)+apiSettings[_0x5ed431(0xeea)]+_0x5ed431(0x23aa)+apiSettings[_0x5ed431(0x157f)],_0x32ba44={'Content-Type':_0x5ed431(0x302)},_0x2d7931={'contents':[{'role':_0x5ed431(0x23b2),'parts':[{'text':_0x5116c1}]}],'generationConfig':{'temperature':0.3}};else{if(apiSettings[_0x5ed431(0x90b)]['endsWith']('/v1'))_0x6a66c8=apiSettings[_0x5ed431(0x90b)]+_0x5ed431(0xb73);else apiSettings[_0x5ed431(0x90b)]['includes'](_0x5ed431(0x193c))?_0x6a66c8=apiSettings['base']+_0x5ed431(0xb73):_0x6a66c8=apiSettings[_0x5ed431(0x90b)]+_0x5ed431(0xce8);_0x32ba44={'Content-Type':_0x5ed431(0x302),'Authorization':_0x5ed431(0x858)+apiSettings[_0x5ed431(0x157f)]},_0x2d7931={'model':apiSettings[_0x5ed431(0xeea)],'messages':[{'role':_0x5ed431(0x212),'content':_0x5ed431(0x1c9d)},{'role':_0x5ed431(0x23b2),'content':_0x5116c1}],'temperature':0.3};}const _0x365310=await fetch(_0x6a66c8,{'method':'POST','headers':_0x32ba44,'body':JSON[_0x5ed431(0x7fb)](_0x2d7931)});if(!_0x365310['ok']){const _0x1b977f=await _0x365310[_0x5ed431(0x2318)]();throw new Error(_0x5ed431(0x669)+_0x365310[_0x5ed431(0xe54)]+'\x20-\x20'+(_0x1b977f[_0x5ed431(0x24ab)]?.['message']||'未知错误'));}const _0x44ac57=await _0x365310[_0x5ed431(0x2318)]();return _0x3f0d1d?_0x44ac57[_0x5ed431(0x1d23)]?.[0x0]?.[_0x5ed431(0x1423)]?.[_0x5ed431(0x23c1)]?.[0x0]?.[_0x5ed431(0x1e58)]:_0x44ac57[_0x5ed431(0x13cf)]?.[0x0]?.[_0x5ed431(0xd7a)]?.['content'];}function calculateSummaryImportance(_0x50fa0a){const _0x4724a7=_0x2cf6d4;if(!_0x50fa0a||_0x50fa0a[_0x4724a7(0xcbf)]===0x0)return 0.3;let _0x5c828a=0x0,_0x4cbec1=0x0;_0x50fa0a['forEach'](_0x269d24=>{const _0x185d45=_0x4724a7;_0x269d24[_0x185d45(0x3d1)]!==undefined?(_0x5c828a+=_0x269d24['importance'],_0x4cbec1++):(_0x5c828a+=0.6,_0x4cbec1++);});const _0x3c7181=_0x4cbec1>0x0?_0x5c828a/_0x4cbec1:0.5,_0x5e7310=_0x50fa0a[_0x4724a7(0xcbf)];return Math[_0x4724a7(0x21f7)](0.9,_0x3c7181+_0x5e7310*0.02);}async function buildGlobalMemoryContext(_0x3f5bc9,_0x54ff21,_0x4b5bbb=0x7){const _0x2ff9f8=_0x2cf6d4;try{_0x3f5bc9=safeCharacterId(_0x3f5bc9);if(!_0x54ff21||!_0x54ff21['id'])return console[_0x2ff9f8(0x24ab)](_0x2ff9f8(0x2514),_0x54ff21),'';let _0x258328='',_0x276f11=[],_0x47ec09=[String(_0x54ff21['id'])];try{const _0x15b835=await db[_0x2ff9f8(0x75b)]['where']('characterId')[_0x2ff9f8(0x14a)](_0x3f5bc9)[_0x2ff9f8(0x1534)](_0x412480=>_0x412480[_0x2ff9f8(0x7aa)]>Date[_0x2ff9f8(0x18e0)]()-0x7*0x18*0x3c*0x3c*0x3e8)[_0x2ff9f8(0x18c6)](),_0x49564d=_0x15b835[_0x2ff9f8(0xcbf)]>0x0;console['log'](_0x2ff9f8(0x1182)+_0x3f5bc9+_0x2ff9f8(0x2202)+_0x15b835[_0x2ff9f8(0xcbf)]+'条');if(_0x54ff21[_0x2ff9f8(0x23df)]===_0x2ff9f8(0x1f01)){const _0x2e74bd=await getAsyncChatSettings(_0x3f5bc9);_0x276f11=_0x2e74bd['memorySharedGroupIds']||[],console[_0x2ff9f8(0xc0d)](_0x2ff9f8(0xe65)+_0x3f5bc9),console[_0x2ff9f8(0xc0d)]('🔍\x20当前群聊ID:\x20'+_0x54ff21['id']),console[_0x2ff9f8(0xc0d)]('🔍\x20角色私聊设置的共享群聊IDs:\x20'+_0x276f11);if(_0x276f11['includes'](_0x54ff21['id']))_0x47ec09=[_0x3f5bc9,String(_0x54ff21['id'])],console['log'](_0x2ff9f8(0x1f7d));else _0x49564d?(_0x47ec09[_0x2ff9f8(0x6ee)](_0x3f5bc9),console['log'](_0x2ff9f8(0x461))):console['log']('❌\x20群聊未被挂载记忆共享且无跨应用活动，只使用群聊记忆');}else{if(_0x54ff21[_0x2ff9f8(0x23df)]===_0x2ff9f8(0x10d7)){const _0x4a34d3=getCurrentChatSettings();_0x276f11=_0x4a34d3[_0x2ff9f8(0x176c)]||[];if(_0x276f11[_0x2ff9f8(0xcbf)]>0x0)_0x47ec09[_0x2ff9f8(0x6ee)](..._0x276f11[_0x2ff9f8(0xf6d)](_0xe88082=>String(_0xe88082))),console['log'](_0x2ff9f8(0x1162),_0x276f11);else{if(_0x49564d){const _0x37f13b=_0x15b835[_0x2ff9f8(0x803)](_0x236b8f=>_0x236b8f['context']?.[_0x2ff9f8(0x23df)]===_0x2ff9f8(0x1f01)&&_0x236b8f[_0x2ff9f8(0x30b)]?.[_0x2ff9f8(0x1eb)])[_0x2ff9f8(0xf6d)](_0x44cae4=>_0x44cae4[_0x2ff9f8(0x30b)][_0x2ff9f8(0x1eb)])[_0x2ff9f8(0x803)]((_0x52ecba,_0x68617c,_0x5d518e)=>_0x5d518e[_0x2ff9f8(0x167a)](_0x52ecba)===_0x68617c);_0x37f13b[_0x2ff9f8(0xcbf)]>0x0&&(_0x47ec09[_0x2ff9f8(0x6ee)](..._0x37f13b[_0x2ff9f8(0xf6d)](_0x4a0186=>String(_0x4a0186))),console[_0x2ff9f8(0xc0d)](_0x2ff9f8(0x2033),_0x37f13b));}}}}}catch(_0x1f3b2c){console[_0x2ff9f8(0x17cc)](_0x2ff9f8(0x1010),_0x1f3b2c);}let _0x2ad85f=[];for(const _0x2467f2 of _0x47ec09){try{const _0x135fd7=await db[_0x2ff9f8(0xa1b)][_0x2ff9f8(0x4a6)](_0x2ff9f8(0x10df))[_0x2ff9f8(0x14a)](String(_0x3f5bc9))['and'](_0x2ca526=>{const _0x5b694f=_0x2ff9f8;if(!_0x2ca526['contextId'])return!![];return String(_0x2ca526[_0x5b694f(0x161f)])===String(_0x2467f2);})['toArray']();_0x2ad85f=_0x2ad85f[_0x2ff9f8(0x1fa8)](_0x135fd7);}catch(_0x290f9e){console[_0x2ff9f8(0x24ab)](_0x2ff9f8(0x1fb9)+_0x3f5bc9+',\x20contextId:\x20'+_0x2467f2+':',_0x290f9e);}}_0x2ad85f[_0x2ff9f8(0x1f0d)]((_0x3bc2ea,_0x4f06e3)=>{const _0x1082db=_0x2ff9f8,_0x401c1b=String(_0x3bc2ea['contextId'])===String(_0x3f5bc9),_0x45d717=String(_0x4f06e3['contextId'])===String(_0x3f5bc9);if(_0x401c1b&&!_0x45d717)return-0x1;if(!_0x401c1b&&_0x45d717)return 0x1;return(_0x4f06e3[_0x1082db(0x3d1)]||0x0)-(_0x3bc2ea[_0x1082db(0x3d1)]||0x0);});const _0x4a4033=_0x2ad85f['slice'](0x0,0xa);_0x4a4033[_0x2ff9f8(0xcbf)]>0x0&&(_0x258328+=_0x2ff9f8(0x8be),_0x4a4033[_0x2ff9f8(0x900)](_0x5d2219=>{const _0x4b98ee=_0x2ff9f8;_0x258328+='-\x20'+_0x5d2219[_0x4b98ee(0x77b)]+'\x0a';}));const _0x419b66=new Date();_0x419b66[_0x2ff9f8(0x1cd4)](_0x419b66['getDate']()-_0x4b5bbb);const _0x3d2a65=_0x419b66[_0x2ff9f8(0xa57)]();let _0x4a6390=[];for(const _0x1018af of _0x47ec09){const _0x44b831=await db[_0x2ff9f8(0x222e)]['where'](_0x2ff9f8(0x10df))[_0x2ff9f8(0x14a)](_0x3f5bc9)[_0x2ff9f8(0x1534)](_0x3e6147=>{const _0x323da2=_0x2ff9f8;if(_0x3e6147['timestamp']<_0x3d2a65)return![];if(!_0x3e6147['contextId'])return!![];return _0x3e6147[_0x323da2(0x161f)]===_0x1018af;})[_0x2ff9f8(0x18c6)]();_0x4a6390=_0x4a6390[_0x2ff9f8(0x1fa8)](_0x44b831);}_0x4a6390[_0x2ff9f8(0x1f0d)]((_0x3bb9d6,_0x34e480)=>{const _0x2c1387=_0x2ff9f8,_0x133259=String(_0x3bb9d6[_0x2c1387(0x161f)])===String(_0x3f5bc9),_0x419181=String(_0x34e480[_0x2c1387(0x161f)])===String(_0x3f5bc9);if(_0x133259&&!_0x419181)return-0x1;if(!_0x133259&&_0x419181)return 0x1;return _0x34e480[_0x2c1387(0x7aa)]-_0x3bb9d6[_0x2c1387(0x7aa)];});const _0x22a1e1=_0x4a6390[_0x2ff9f8(0x136)](0x0,0xf);_0x22a1e1['length']>0x0&&(_0x258328+=_0x2ff9f8(0xb3a),_0x22a1e1['forEach'](_0x37f08a=>{const _0xab3cc2=_0x2ff9f8,_0x9af17b=new Date(_0x37f08a[_0xab3cc2(0x7aa)]||Date[_0xab3cc2(0x18e0)]()),_0x190ead=isNaN(_0x9af17b[_0xab3cc2(0xa57)]())?_0xab3cc2(0x187c):_0x9af17b[_0xab3cc2(0x177f)]();_0x258328+='['+_0x190ead+']\x20'+_0x37f08a['fact']+'\x0a';}));const _0x110fed=Date[_0x2ff9f8(0x18e0)]()-_0x4b5bbb*0x18*0x3c*0x3c*0x3e8;let _0x3aff5b=[];for(const _0x31b6cf of _0x47ec09){const _0x5a97bf=await db[_0x2ff9f8(0x75b)][_0x2ff9f8(0x4a6)](_0x2ff9f8(0x10df))[_0x2ff9f8(0x14a)](_0x3f5bc9)[_0x2ff9f8(0x1534)](_0x2b0f99=>{const _0x23476=_0x2ff9f8;if(_0x2b0f99[_0x23476(0x7aa)]<_0x110fed)return![];if(!_0x2b0f99[_0x23476(0x30b)])return![];if(_0x2b0f99[_0x23476(0x12e0)]===_0x23476(0x73b)&&_0x2b0f99[_0x23476(0x23af)]===_0x23476(0x348))return!![];if(_0x2b0f99[_0x23476(0x12e0)]===_0x23476(0x1bc6))return _0x2b0f99[_0x23476(0x30b)]['id']===_0x31b6cf||_0x2b0f99[_0x23476(0x30b)][_0x23476(0x956)]===_0x31b6cf||_0x31b6cf===_0x3f5bc9;return _0x2b0f99[_0x23476(0x30b)]['id']===_0x31b6cf||_0x2b0f99[_0x23476(0x30b)][_0x23476(0x956)]===_0x31b6cf||_0x2b0f99[_0x23476(0x30b)][_0x23476(0x1eb)]===_0x31b6cf;})[_0x2ff9f8(0x18c6)](),_0x13f8c4=_0x5a97bf[_0x2ff9f8(0x803)](_0x51f3c4=>{const _0x29af16=_0x2ff9f8;if(_0x51f3c4[_0x29af16(0x10df)]!==_0x3f5bc9)return console[_0x29af16(0x17cc)](_0x29af16(0x18e5),{'expectedCharacterId':_0x3f5bc9,'actualCharacterId':_0x51f3c4[_0x29af16(0x10df)],'eventId':_0x51f3c4['id'],'action':_0x51f3c4[_0x29af16(0x23af)],'contextId':_0x31b6cf}),![];return!![];});_0x5a97bf['length']!==_0x13f8c4[_0x2ff9f8(0xcbf)]&&console['warn'](_0x2ff9f8(0xe6a)+_0x31b6cf+_0x2ff9f8(0xc55)+(_0x5a97bf[_0x2ff9f8(0xcbf)]-_0x13f8c4[_0x2ff9f8(0xcbf)])+_0x2ff9f8(0x8bb)),_0x3aff5b=_0x3aff5b[_0x2ff9f8(0x1fa8)](_0x13f8c4);}const _0x235b89=_0x3aff5b['filter']((_0xfda8d0,_0x3f77d1,_0x429254)=>_0x3f77d1===_0x429254[_0x2ff9f8(0x23ba)](_0xdfd615=>_0xdfd615['id']===_0xfda8d0['id']));_0x235b89[_0x2ff9f8(0x1f0d)]((_0x141c66,_0x11971c)=>_0x11971c[_0x2ff9f8(0x7aa)]-_0x141c66['timestamp']);const _0x5cc321=_0x235b89[_0x2ff9f8(0x136)](0x0,0x1e);_0x5cc321[_0x2ff9f8(0xcbf)]>0x0&&(_0x258328+='\x0a#\x20最近活动时间线\x0a',_0x5cc321[_0x2ff9f8(0x900)]((_0x6d6462,_0x2797c7)=>{const _0x1249ae=_0x2ff9f8,_0x1f1552=new Date(_0x6d6462['timestamp'])[_0x1249ae(0x133a)]();let _0x6585fd='私聊',_0x31c11c='💬';if(_0x6d6462[_0x1249ae(0x30b)]?.['type']===_0x1249ae(0x1f01))_0x6585fd=_0x6d6462[_0x1249ae(0x30b)]?.[_0x1249ae(0x1727)]?_0x1249ae(0x14ff)+_0x6d6462[_0x1249ae(0x30b)][_0x1249ae(0x1727)]+')':'群聊',_0x31c11c='👥';else{if(_0x6d6462[_0x1249ae(0x12e0)]===_0x1249ae(0x73b))_0x6585fd=_0x1249ae(0x1609),_0x31c11c='🎭';else _0x6d6462[_0x1249ae(0x12e0)]===_0x1249ae(0x1bc6)&&(_0x6585fd='短信',_0x31c11c='📱');}let _0x514e8e='',_0x627804=![];if(_0x6d6462['action']==='user_message')_0x6d6462[_0x1249ae(0x30b)]?.[_0x1249ae(0x1423)]?_0x514e8e=_0x1249ae(0xf8d)+_0x6d6462['context'][_0x1249ae(0x1423)][_0x1249ae(0x4b2)](0x0,0x3c)+(_0x6d6462[_0x1249ae(0x30b)][_0x1249ae(0x1423)][_0x1249ae(0xcbf)]>0x3c?_0x1249ae(0x24e6):'\x22'):_0x514e8e='用户发送了消息';else{if(_0x6d6462[_0x1249ae(0x23af)]==='ai_message'||_0x6d6462['action']===_0x1249ae(0x10bd))_0x6d6462[_0x1249ae(0x30b)]?.[_0x1249ae(0x1423)]?_0x514e8e=_0x1249ae(0x9ba)+_0x6d6462[_0x1249ae(0x30b)][_0x1249ae(0x1423)][_0x1249ae(0x4b2)](0x0,0x3c)+(_0x6d6462['context']['content']['length']>0x3c?_0x1249ae(0x24e6):'\x22'):_0x514e8e=_0x1249ae(0x286);else{if(_0x6d6462[_0x1249ae(0x12e0)]===_0x1249ae(0x1bc6)){if(_0x6d6462[_0x1249ae(0x23af)]===_0x1249ae(0x12b4))_0x514e8e=_0x1249ae(0x1650)+(_0x6d6462[_0x1249ae(0x30b)]?.[_0x1249ae(0x1423)]?.[_0x1249ae(0x4b2)](0x0,0x3c)||'')+((_0x6d6462[_0x1249ae(0x30b)]?.[_0x1249ae(0x1423)]?.[_0x1249ae(0xcbf)]||0x0)>0x3c?_0x1249ae(0x24e6):'\x22'),_0x627804=!![];else{if(_0x6d6462['action']==='ai_reply')_0x514e8e=_0x1249ae(0x13d3)+(_0x6d6462['context']?.['content']?.[_0x1249ae(0x4b2)](0x0,0x3c)||'')+((_0x6d6462[_0x1249ae(0x30b)]?.[_0x1249ae(0x1423)]?.[_0x1249ae(0xcbf)]||0x0)>0x3c?_0x1249ae(0x24e6):'\x22'),_0x627804=!![];else _0x6d6462[_0x1249ae(0x23af)]==='character_initiate'?(_0x514e8e=_0x1249ae(0xdfa)+(_0x6d6462[_0x1249ae(0x30b)]?.[_0x1249ae(0x1423)]?.[_0x1249ae(0x4b2)](0x0,0x3c)||'')+((_0x6d6462[_0x1249ae(0x30b)]?.[_0x1249ae(0x1423)]?.[_0x1249ae(0xcbf)]||0x0)>0x3c?_0x1249ae(0x24e6):'\x22'),_0x627804=!![]):_0x514e8e=_0x1249ae(0x233a);}}else _0x6d6462[_0x1249ae(0x23af)]===_0x1249ae(0x348)&&_0x6d6462[_0x1249ae(0x12e0)]===_0x1249ae(0x73b)?_0x6d6462['context']?.[_0x1249ae(0x1423)]?(_0x514e8e=_0x1249ae(0x1d93)+_0x6d6462[_0x1249ae(0x30b)][_0x1249ae(0x1423)]['substring'](0x0,0x50)+(_0x6d6462['context'][_0x1249ae(0x1423)][_0x1249ae(0xcbf)]>0x50?_0x1249ae(0x12da):''),_0x627804=!![]):_0x514e8e=_0x1249ae(0x2185):_0x514e8e=_0x6d6462[_0x1249ae(0x23af)]||_0x6d6462['eventType']||'未知活动';}}const _0x2c79e4=_0x6d6462[_0x1249ae(0x30b)]?.['id']!==_0x54ff21['id'],_0x19b8fb=_0x2c79e4?'\x20⭐':'',_0x3b38ce=_0x627804?_0x1249ae(0x665):'';_0x258328+='['+_0x1f1552+']\x20'+_0x31c11c+_0x6585fd+':\x20'+_0x514e8e+_0x19b8fb+_0x3b38ce+'\x0a';}));const _0x31f47c=_0x419b66[_0x2ff9f8(0xa4b)]()[_0x2ff9f8(0x633)]('T')[0x0],_0x246e84=await db[_0x2ff9f8(0x1982)][_0x2ff9f8(0x4a6)]('characterId')[_0x2ff9f8(0x14a)](_0x3f5bc9)[_0x2ff9f8(0x1534)](_0xaf59ba=>_0xaf59ba[_0x2ff9f8(0x1c5b)]>=_0x31f47c)['toArray']();_0x246e84[_0x2ff9f8(0x1f0d)]((_0x23537e,_0x4c7e43)=>_0x4c7e43['timestamp']-_0x23537e[_0x2ff9f8(0x7aa)]);const _0x3fe959=_0x246e84[_0x2ff9f8(0x136)](0x0,0xa);_0x3fe959['length']>0x0&&(_0x258328+=_0x2ff9f8(0x148e),_0x3fe959[_0x2ff9f8(0x900)](_0x57569f=>{const _0xe6b5d2=_0x2ff9f8,_0xe03357=new Date(_0x57569f[_0xe6b5d2(0x7aa)]||Date[_0xe6b5d2(0x18e0)]()),_0x310243=isNaN(_0xe03357[_0xe6b5d2(0xa57)]())?'未知日期':_0xe03357['toLocaleDateString']();_0x258328+='['+_0x310243+']\x20'+_0x57569f[_0xe6b5d2(0x1354)]+'\x0a';}));const _0x5664b7=await db[_0x2ff9f8(0x4ad)]['where']('timestamp')[_0x2ff9f8(0x2013)](Date[_0x2ff9f8(0x18e0)]()-0x18*0x3c*0x3c*0x3e8)['and'](_0x5a8366=>{const _0x5257c3=_0x2ff9f8;return _0x5a8366[_0x5257c3(0x1572)][_0x5257c3(0x23ec)](_0x3f5bc9)&&_0x47ec09[_0x5257c3(0x23ec)](_0x5a8366[_0x5257c3(0x30b)]['id']);})['toArray']();_0x5664b7[_0x2ff9f8(0x1f0d)]((_0x22a66f,_0x4e8bcd)=>_0x4e8bcd['timestamp']-_0x22a66f[_0x2ff9f8(0x7aa)]);const _0x336b7c=_0x5664b7['slice'](0x0,0xf);_0x336b7c['length']>0x0&&(_0x258328+='\x0a#\x20最近活动\x0a',_0x336b7c[_0x2ff9f8(0x900)](_0x1289df=>{const _0x2e3c0=_0x2ff9f8,_0x563d75=new Date(_0x1289df[_0x2e3c0(0x7aa)])[_0x2e3c0(0xd4a)](),_0x8ac6ec=_0x1289df['context'][_0x2e3c0(0x23df)]===_0x2e3c0(0x10d7)?'私聊':_0x1289df['context'][_0x2e3c0(0x23df)]===_0x2e3c0(0x1f01)?'群聊':_0x1289df[_0x2e3c0(0x30b)][_0x2e3c0(0x23df)]===_0x2e3c0(0x4f1)?'音乐':'其他',_0x2cd708=_0x1289df[_0x2e3c0(0x30b)]['id']!==_0x54ff21['id']?_0x2e3c0(0x1a35)+_0x8ac6ec+')':'';_0x258328+='['+_0x563d75+_0x2e3c0(0xacf)+_0x8ac6ec+'中'+_0x2cd708+':\x20'+_0x1289df[_0x2e3c0(0x12c4)]+'\x0a';}));if(_0x258328[_0x2ff9f8(0x1424)]()){const _0x9c2a2b=(_0x258328[_0x2ff9f8(0x1316)](/⭐/g)||[])[_0x2ff9f8(0xcbf)],_0x3b180e=(_0x258328[_0x2ff9f8(0x1316)](/📱/g)||[])[_0x2ff9f8(0xcbf)],_0x5248b4=(_0x258328[_0x2ff9f8(0x1316)](/🎭/g)||[])[_0x2ff9f8(0xcbf)];_0x258328+='\x0a\x0a【🧠\x20记忆连贯性指导】你拥有完整的跨场景记忆，请在回复时：\x0a',_0x54ff21[_0x2ff9f8(0x23df)]==='group_chat'&&_0x47ec09['includes'](_0x3f5bc9)&&(_0x258328+=_0x2ff9f8(0xbf4),_0x258328+=_0x2ff9f8(0x1184),_0x258328+=_0x2ff9f8(0x1583)),_0x9c2a2b>0x0&&(_0x258328+='•\x20你有'+_0x9c2a2b+_0x2ff9f8(0x4c0)),_0x3b180e>0x0&&(_0x258328+=_0x2ff9f8(0x1d4e)+_0x3b180e+_0x2ff9f8(0x7d5)),_0x5248b4>0x0&&(_0x258328+='•\x20你有'+_0x5248b4+'条线下剧情记忆(🎭)，这些是深度互动的回忆，可以自然地提及相关情节\x0a'),_0x258328+=_0x2ff9f8(0x110a),_0x258328+=_0x2ff9f8(0x1a8d),_0x258328+=_0x2ff9f8(0xc27),_0x258328+='•\x20特别重要：即使用户没有主动提及，你也可以根据当前话题自然地联想到相关的跨场景记忆\x0a';}return _0x258328;}catch(_0x2e3167){return console[_0x2ff9f8(0x24ab)](_0x2ff9f8(0x7cc),_0x2e3167),'';}}function showGlobalMemorySettings(){const _0x908e88=_0x2cf6d4;if(!currentChatCharacter){showToast(_0x908e88(0x1268),_0x908e88(0x24ab));return;}const _0x3ddc33=_0x908e88(0x782);document[_0x908e88(0x172c)]['insertAdjacentHTML'](_0x908e88(0x580),_0x3ddc33);const _0x433207=getGlobalMemorySettings(),_0x338206=document[_0x908e88(0x15b8)](_0x908e88(0x18a1)+_0x433207['memoryDays']+'\x22]');if(_0x338206)_0x338206[_0x908e88(0x306)]=!![];}function getGlobalMemorySettings(){const _0x341e57=_0x2cf6d4,_0x564da6=localStorage[_0x341e57(0x2250)](_0x341e57(0x109a));return _0x564da6?JSON[_0x341e57(0x168e)](_0x564da6):{'memoryDays':0x7,'autoSummary':!![],'coreMemoryEnabled':!![]};}function updateGlobalMemoryStatusDisplay(){const _0x15b301=_0x2cf6d4,_0x1772ff=getGlobalMemorySettings(),_0x20a84f=document['getElementById'](_0x15b301(0x2138));console[_0x15b301(0xc0d)](_0x15b301(0x9d8),_0x1772ff[_0x15b301(0x356)]);if(_0x20a84f){let _0x13e60d;switch(_0x1772ff[_0x15b301(0x356)]){case 0x3:_0x13e60d=_0x15b301(0x25f);break;case 0x7:_0x13e60d='7天记忆';break;case 0xf:_0x13e60d=_0x15b301(0x1602);break;case 0x1e:_0x13e60d=_0x15b301(0x1c4c);break;case-0x1:_0x13e60d=_0x15b301(0x1c3f);break;default:_0x13e60d=_0x15b301(0x3a2);}_0x20a84f[_0x15b301(0x21dc)]=_0x13e60d,console[_0x15b301(0xc0d)](_0x15b301(0x285),_0x13e60d);}else console[_0x15b301(0x17cc)]('🔥\x20找不到global-memory-status元素');}function saveGlobalMemorySettings(){const _0x3e513d=_0x2cf6d4,_0x8f5ccb=document['querySelector'](_0x3e513d(0xc9));if(!_0x8f5ccb){showToast(_0x3e513d(0x247b),_0x3e513d(0x24ab));return;}const _0x1fef97=parseInt(_0x8f5ccb[_0x3e513d(0xc34)]);console[_0x3e513d(0xc0d)](_0x3e513d(0x1440),_0x1fef97);const _0x133399={'memoryDays':_0x1fef97,'autoSummary':!![],'coreMemoryEnabled':!![]};localStorage[_0x3e513d(0x2055)]('globalMemorySettings',JSON[_0x3e513d(0x7fb)](_0x133399)),console[_0x3e513d(0xc0d)](_0x3e513d(0x1055),_0x133399),hideGlobalMemorySettings(),updateGlobalMemoryStatusDisplay(),showToast(_0x3e513d(0x1575),_0x3e513d(0xb27));}function hideGlobalMemorySettings(){const _0x257943=_0x2cf6d4,_0x3c4bdb=document['getElementById'](_0x257943(0x1f2d));if(_0x3c4bdb)_0x3c4bdb[_0x257943(0x128)]();}function showMemoryModal(_0x3a6ad7,_0x5b6c3b,_0x31603b){const _0x2cb92f=_0x2cf6d4,_0x1c1577=document[_0x2cb92f(0x566)](_0x2cb92f(0x871));if(_0x1c1577)_0x1c1577[_0x2cb92f(0x128)]();let _0x8c01b3='';_0x5b6c3b['length']===0x0?_0x8c01b3=_0x2cb92f(0x2358)+_0x3a6ad7+_0x2cb92f(0xa54):_0x8c01b3=_0x5b6c3b['map']((_0x383bf5,_0x47afa1)=>{const _0x26e02b=_0x2cb92f;let _0x309ca3='',_0x3d8ce7='',_0x7191a4='';if(_0x31603b==='core'){_0x309ca3=_0x383bf5[_0x26e02b(0x77b)]||'无内容';const _0x44bed8='★'[_0x26e02b(0x18bf)](Math[_0x26e02b(0x1dac)]((_0x383bf5[_0x26e02b(0x3d1)]||0x0)*0x5));_0x3d8ce7=_0x26e02b(0xed8)+_0x44bed8+'</div>';const _0x56f400=new Date(_0x383bf5[_0x26e02b(0x7aa)]||Date[_0x26e02b(0x18e0)]());_0x7191a4=isNaN(_0x56f400[_0x26e02b(0xa57)]())?_0x26e02b(0x187c):_0x56f400[_0x26e02b(0x177f)]();}else{if(_0x31603b===_0x26e02b(0x1354)){_0x309ca3=_0x383bf5[_0x26e02b(0x1354)]||_0x26e02b(0x12d8);if(_0x383bf5[_0x26e02b(0x7aa)]){const _0xc3a770=new Date(_0x383bf5[_0x26e02b(0x7aa)]);_0x7191a4=_0xc3a770['getFullYear']()+'-'+String(_0xc3a770[_0x26e02b(0x17f3)]()+0x1)['padStart'](0x2,'0')+'-'+String(_0xc3a770['getDate']())[_0x26e02b(0x863)](0x2,'0');}else _0x7191a4=_0x383bf5[_0x26e02b(0x1c5b)]||'未知日期';}}return _0x26e02b(0x2428)+_0x383bf5['id']+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22memory-modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22memory-modal-index\x22>'+(_0x47afa1+0x1)+_0x26e02b(0x1751)+_0x7191a4+_0x26e02b(0xd6a)+_0x383bf5['id']+'\x27,\x20\x27'+_0x31603b+_0x26e02b(0x1551)+_0x383bf5['id']+_0x26e02b(0x1799)+_0x31603b+_0x26e02b(0x138a)+_0x383bf5['id']+_0x26e02b(0x1799)+_0x31603b+_0x26e02b(0x221c)+_0x383bf5['id']+_0x26e02b(0x1799)+_0x31603b+_0x26e02b(0x25b)+_0x309ca3['replace'](/"/g,_0x26e02b(0xca))+'\x22>'+_0x309ca3+_0x26e02b(0x1e38)+_0x3d8ce7+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';})['join']('');const _0x270a15=_0x2cb92f(0x3b0)+currentChatCharacter[_0x2cb92f(0x222f)]+'\x20的'+_0x3a6ad7+_0x2cb92f(0xe9d)+_0x8c01b3+_0x2cb92f(0x72d);document[_0x2cb92f(0x172c)][_0x2cb92f(0x22ba)](_0x2cb92f(0x580),_0x270a15);}function hideMemoryModal(){const _0x17f41a=_0x2cf6d4,_0x23f73b=document[_0x17f41a(0x566)](_0x17f41a(0x871));if(_0x23f73b)_0x23f73b[_0x17f41a(0x128)]();}function toggleEditMode(_0x4a0d81,_0x5a338a){const _0x5a232a=_0x2cf6d4,_0x31c731=document[_0x5a232a(0x15b8)](_0x5a232a(0x1929)+_0x4a0d81+'\x22]');if(!_0x31c731)return;const _0x4fed13=_0x31c731[_0x5a232a(0x15b8)](_0x5a232a(0xd9f)),_0x29a099=_0x31c731[_0x5a232a(0x15b8)](_0x5a232a(0x264)),_0x1d6c27=_0x31c731[_0x5a232a(0x15b8)](_0x5a232a(0x5aa)),_0x10d4a2=_0x31c731[_0x5a232a(0x15b8)](_0x5a232a(0xfa7)),_0x3ce0ea=_0x31c731[_0x5a232a(0x15b8)]('.memory-delete-btn'),_0x290fc6=_0x4fed13['getAttribute']('data-original-content');_0x4fed13[_0x5a232a(0xc02)]=_0x5a232a(0x1c15)+_0x290fc6+_0x5a232a(0x1208),_0x29a099['style'][_0x5a232a(0x2526)]=_0x5a232a(0xfe9),_0x1d6c27['style'][_0x5a232a(0x2526)]=_0x5a232a(0xf09),_0x10d4a2[_0x5a232a(0x655)]['display']=_0x5a232a(0xf09),_0x3ce0ea[_0x5a232a(0x655)]['display']='none';const _0x2769df=_0x4fed13[_0x5a232a(0x15b8)](_0x5a232a(0x1b35));_0x2769df[_0x5a232a(0x1b12)](),_0x2769df['setSelectionRange'](_0x2769df['value'][_0x5a232a(0xcbf)],_0x2769df[_0x5a232a(0xc34)][_0x5a232a(0xcbf)]);}async function saveMemoryEdit(_0x279780,_0x54d41a){const _0x1bc5d4=_0x2cf6d4,_0x52f5f1=document[_0x1bc5d4(0x15b8)]('[data-memory-id=\x22'+_0x279780+'\x22]');if(!_0x52f5f1)return;const _0x28b895=_0x52f5f1[_0x1bc5d4(0x15b8)](_0x1bc5d4(0xd9f)),_0x4f8399=_0x28b895[_0x1bc5d4(0x15b8)]('.memory-edit-textarea'),_0x44412d=_0x4f8399[_0x1bc5d4(0xc34)][_0x1bc5d4(0x1424)]();if(!_0x44412d){showToast(_0x1bc5d4(0x187),_0x1bc5d4(0x24ab));return;}try{let _0x98d579,_0x2f7ac2;if(_0x54d41a===_0x1bc5d4(0x22c1))_0x98d579=await db[_0x1bc5d4(0xa1b)]['get'](_0x279780),_0x2f7ac2='fact';else _0x54d41a==='summary'&&(_0x98d579=await db[_0x1bc5d4(0x1982)][_0x1bc5d4(0x46a)](_0x279780),_0x2f7ac2=_0x1bc5d4(0x1354));if(!_0x98d579){showToast(_0x1bc5d4(0xbcb),_0x1bc5d4(0x24ab));return;}_0x98d579[_0x2f7ac2]=_0x44412d;if(_0x54d41a===_0x1bc5d4(0x22c1))await db[_0x1bc5d4(0xa1b)][_0x1bc5d4(0x53a)](_0x98d579),showToast('核心记忆已更新',_0x1bc5d4(0xb27));else _0x54d41a==='summary'&&(await db[_0x1bc5d4(0x1982)][_0x1bc5d4(0x53a)](_0x98d579),showToast(_0x1bc5d4(0x27a),_0x1bc5d4(0xb27)));exitEditMode(_0x279780,_0x44412d);}catch(_0x23af55){console[_0x1bc5d4(0x24ab)](_0x1bc5d4(0x1658),_0x23af55),showToast(_0x1bc5d4(0x244d),_0x1bc5d4(0x24ab));}}function cancelMemoryEdit(_0x553d55,_0x1eee99){const _0x36a778=_0x2cf6d4,_0x57bcc2=document[_0x36a778(0x15b8)](_0x36a778(0x1929)+_0x553d55+'\x22]');if(!_0x57bcc2)return;const _0x4ab9b4=_0x57bcc2[_0x36a778(0x15b8)](_0x36a778(0xd9f)),_0x1196c0=_0x4ab9b4[_0x36a778(0x1add)]('data-original-content');exitEditMode(_0x553d55,_0x1196c0);}function exitEditMode(_0x2e4bce,_0x108947){const _0x206351=_0x2cf6d4,_0x296fc4=document[_0x206351(0x15b8)]('[data-memory-id=\x22'+_0x2e4bce+'\x22]');if(!_0x296fc4)return;const _0x4f87ce=_0x296fc4[_0x206351(0x15b8)](_0x206351(0xd9f)),_0x412d01=_0x296fc4[_0x206351(0x15b8)]('.memory-edit-btn'),_0x5b24b5=_0x296fc4['querySelector'](_0x206351(0x5aa)),_0x1b3f79=_0x296fc4[_0x206351(0x15b8)](_0x206351(0xfa7)),_0x4d8dee=_0x296fc4[_0x206351(0x15b8)](_0x206351(0x1f63));_0x4f87ce['innerHTML']=_0x108947,_0x4f87ce[_0x206351(0x1dd4)](_0x206351(0x1f06),_0x108947),_0x412d01[_0x206351(0x655)]['display']='inline-block',_0x5b24b5['style']['display']=_0x206351(0xfe9),_0x1b3f79['style'][_0x206351(0x2526)]='none',_0x4d8dee[_0x206351(0x655)]['display']=_0x206351(0xf09);}async function deleteMemoryItem(_0x4135f7,_0x50ab3f){const _0x834721=_0x2cf6d4;if(!confirm(_0x834721(0x96a)))return;try{if(_0x50ab3f===_0x834721(0x22c1))await db[_0x834721(0xa1b)]['delete'](_0x4135f7),showToast(_0x834721(0x1e0),_0x834721(0xb27));else _0x50ab3f===_0x834721(0x1354)&&(await db[_0x834721(0x1982)][_0x834721(0xc2b)](_0x4135f7),showToast(_0x834721(0x257),'success'));if(_0x50ab3f==='core')viewCoreMemories();else _0x50ab3f===_0x834721(0x1354)&&viewMemorySummaries();}catch(_0x45705a){console[_0x834721(0x24ab)](_0x834721(0x1c74),_0x45705a),showToast(_0x834721(0x7f3),_0x834721(0x24ab));}}async function viewCoreMemories(){const _0xe376be=_0x2cf6d4;if(!currentChatCharacter){showToast(_0xe376be(0x1268),'error');return;}hideGlobalMemorySettings();const _0x112884=showLoadingModal(_0xe376be(0x934),_0xe376be(0xada));try{const _0x1e441b=await db[_0xe376be(0xa1b)][_0xe376be(0x4a6)]('characterId')['equals'](currentChatCharacter['id'])['toArray']();_0x1e441b['sort']((_0x2480ac,_0xee6353)=>(_0xee6353[_0xe376be(0x3d1)]||0x0)-(_0x2480ac[_0xe376be(0x3d1)]||0x0));const _0x42cd99=_0x1e441b[_0xe376be(0x136)](0x0,0xa);hideLoadingModal(_0x112884),showMemoryModal(_0xe376be(0x1ddf),_0x42cd99,_0xe376be(0x22c1));}catch(_0x44a627){hideLoadingModal(_0x112884),console[_0xe376be(0x24ab)]('查看核心记忆失败:',_0x44a627),showToast(_0xe376be(0xd1a),_0xe376be(0x24ab));}}async function viewMemorySummaries(){const _0x5829d1=_0x2cf6d4;if(!currentChatCharacter){showToast(_0x5829d1(0x1268),_0x5829d1(0x24ab));return;}hideGlobalMemorySettings();const _0x59424d=showLoadingModal(_0x5829d1(0xa3d),_0x5829d1(0x1cb));try{const _0x2fbab8=await db['memorySummaries'][_0x5829d1(0x4a6)]('characterId')[_0x5829d1(0x14a)](currentChatCharacter['id'])[_0x5829d1(0x18c6)]();_0x2fbab8[_0x5829d1(0x1f0d)]((_0x56fe49,_0x260c51)=>_0x260c51[_0x5829d1(0x7aa)]-_0x56fe49[_0x5829d1(0x7aa)]);const _0x5db378=_0x2fbab8[_0x5829d1(0x136)](0x0,0xa);hideLoadingModal(_0x59424d),showMemoryModal('记忆摘要',_0x5db378,_0x5829d1(0x1354));}catch(_0x8155fb){hideLoadingModal(_0x59424d),console[_0x5829d1(0x24ab)]('查看记忆摘要失败:',_0x8155fb),showToast('查看记忆摘要失败',_0x5829d1(0x24ab));}}async function generateDailySummary(){const _0x53efa4=_0x2cf6d4;if(!currentChatCharacter){showToast(_0x53efa4(0x1268),_0x53efa4(0x24ab));return;}const _0x19b71b=showLoadingModal(_0x53efa4(0x937),_0x53efa4(0x17a6));try{const _0x5c9b6f=new Date(),_0x5b49eb=new Date(_0x5c9b6f[_0x53efa4(0x885)](),_0x5c9b6f[_0x53efa4(0x17f3)](),_0x5c9b6f['getDate']())['getTime'](),_0x272079=_0x5b49eb+0x18*0x3c*0x3c*0x3e8,_0x46f189=await generateMemorySummary(currentChatCharacter['id'],_0x5b49eb,_0x272079,{'type':currentChatCharacter[_0x53efa4(0x4b7)]?_0x53efa4(0x1f01):_0x53efa4(0x10d7),'id':currentChatCharacter['id']});hideLoadingModal(_0x19b71b),_0x46f189?(showToast('今日摘要生成成功',_0x53efa4(0xb27)),alert('今日摘要已生成：\x0a\x0a'+_0x46f189[_0x53efa4(0x1354)])):showToast(_0x53efa4(0x1828),'warning');}catch(_0xb0aa72){hideLoadingModal(_0x19b71b),console[_0x53efa4(0x24ab)](_0x53efa4(0x1c7b),_0xb0aa72),showToast(_0x53efa4(0x546),_0x53efa4(0x24ab));}}function showMemoryShareSettings(){const _0x1eef4e=_0x2cf6d4;if(!currentChatCharacter||currentChatCharacter[_0x1eef4e(0x4b7)]){showToast(_0x1eef4e(0x1f4),_0x1eef4e(0x24ab));return;}const _0x399ba2=groupChats[_0x1eef4e(0x803)](_0x3b5479=>_0x3b5479[_0x1eef4e(0xcaa)]&&_0x3b5479[_0x1eef4e(0xcaa)][_0x1eef4e(0x184b)](_0xc481b2=>_0xc481b2['id']===currentChatCharacter['id']));if(_0x399ba2[_0x1eef4e(0xcbf)]===0x0){showToast(_0x1eef4e(0xdd),_0x1eef4e(0x13bb));return;}const _0x2903d2=getCurrentChatSettings(),_0x133b59=_0x2903d2['memorySharedGroupIds']||[],_0x487396=_0x1eef4e(0x1bd7)+_0x399ba2[_0x1eef4e(0xf6d)](_0x305e37=>_0x1eef4e(0xa1a)+_0x305e37['id']+'\x22\x20'+(_0x133b59['includes'](_0x305e37['id'])?_0x1eef4e(0x306):'')+'>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22checkbox-custom\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22checkbox-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22checkbox-title\x22>'+_0x305e37[_0x1eef4e(0x222f)]+_0x1eef4e(0x8b8))[_0x1eef4e(0x140c)]('')+_0x1eef4e(0x228d);document[_0x1eef4e(0x172c)]['insertAdjacentHTML']('beforeend',_0x487396);}async function saveMemoryShareSettings(){const _0x46f608=_0x2cf6d4,_0x5767ef=Array[_0x46f608(0x2308)](document['querySelectorAll'](_0x46f608(0x17d0)))[_0x46f608(0xf6d)](_0x13f33d=>_0x13f33d['value']),_0x47b78e=getCurrentChatSettings();_0x47b78e['memorySharedGroupIds']=_0x5767ef,_0x47b78e[_0x46f608(0x225a)]=_0x5767ef['length']>0x0?_0x5767ef[0x0]:'',await saveCurrentChatSettings(_0x47b78e),updateMemoryShareStatus(),hideMemoryShareSettings();if(_0x5767ef[_0x46f608(0xcbf)]>0x0){const _0x1411e6=_0x5767ef[_0x46f608(0xf6d)](_0x4b2e06=>{const _0x4e32a4=_0x46f608,_0x4f2129=groupChats['find'](_0x402364=>_0x402364['id']===_0x4b2e06);return _0x4f2129?_0x4f2129[_0x4e32a4(0x222f)]:_0x4e32a4(0xe1e);})[_0x46f608(0x140c)]('、');showToast('已开启与\x22'+_0x1411e6+_0x46f608(0x1fa4),_0x46f608(0xb27));}else showToast('已关闭记忆共享','success');}function hideMemoryShareSettings(){const _0x50f123=_0x2cf6d4,_0x594c19=document['getElementById'](_0x50f123(0x21f6));if(_0x594c19)_0x594c19[_0x50f123(0x128)]();}function updateMemoryShareStatus(){const _0x375fa8=_0x2cf6d4,_0x2938f2=document[_0x375fa8(0x566)]('memory-share-status');if(!_0x2938f2)return;const _0x21d3bf=getCurrentChatSettings(),_0x40c864=_0x21d3bf[_0x375fa8(0x176c)]||[];if(_0x40c864[_0x375fa8(0xcbf)]>0x0){if(_0x40c864[_0x375fa8(0xcbf)]===0x1){const _0x381a67=groupChats[_0x375fa8(0x1aeb)](_0x3f3cb9=>_0x3f3cb9['id']===_0x40c864[0x0]);_0x2938f2[_0x375fa8(0x21dc)]=_0x381a67?'与\x22'+_0x381a67[_0x375fa8(0x222f)]+_0x375fa8(0x1915):_0x375fa8(0xc5d);}else _0x2938f2[_0x375fa8(0x21dc)]='与'+_0x40c864[_0x375fa8(0xcbf)]+_0x375fa8(0x1760);}else _0x2938f2['textContent']='已关闭';}function backFromDiary(){const _0x3eddd8=_0x2cf6d4,_0x2ec09a=document[_0x3eddd8(0x566)](_0x3eddd8(0x1e5));if(_0x2ec09a&&_0x2ec09a[_0x3eddd8(0x226e)][_0x3eddd8(0x1f9)](_0x3eddd8(0x105d))){backFromSingleDiary();return;}const _0x4d6a16=window[_0x3eddd8(0x15fb)]||_0x3eddd8(0x1154);hideApp('diary-screen'),showApp(_0x4d6a16),window[_0x3eddd8(0x15fb)]=null;}function showDiaryMenu(){const _0x599853=_0x2cf6d4;if(!currentChatCharacter){showToast(_0x599853(0x1268),_0x599853(0x24ab));return;}if(currentChatCharacter[_0x599853(0x4b7)]){showToast(_0x599853(0x16f5),_0x599853(0x24ab));return;}window[_0x599853(0x15fb)]='api-chat-screen',showApp(_0x599853(0x1233)),initDiaryPaper(),switchDiaryTab(_0x599853(0x1b45)),loadTodayDiary();}function switchDiaryTab(_0x1a2084){const _0x50221c=_0x2cf6d4;document[_0x50221c(0x1ed9)](_0x50221c(0x158e))[_0x50221c(0x900)](_0xb4db93=>{const _0xec573=_0x50221c;_0xb4db93[_0xec573(0x226e)]['remove'](_0xec573(0x105d));});const _0x3743b7=document[_0x50221c(0x566)]('diary-mode-title'),_0x2cdd39=document[_0x50221c(0x566)](_0x50221c(0x2126)),_0xb8e44f=document[_0x50221c(0x566)](_0x50221c(0x1fb3)),_0x54d56b=document[_0x50221c(0x566)](_0x50221c(0x17b9)),_0x41a81e=document[_0x50221c(0x566)](_0x50221c(0x1459));if(_0x1a2084===_0x50221c(0x1b45)){document[_0x50221c(0x566)]('today-diary-view')[_0x50221c(0x226e)]['add']('active');if(_0x3743b7)_0x3743b7[_0x50221c(0x21dc)]='今日日记';if(_0xb8e44f)_0xb8e44f[_0x50221c(0x655)][_0x50221c(0x2526)]='inline-flex';if(_0x54d56b)_0x54d56b[_0x50221c(0x655)][_0x50221c(0x2526)]='inline-flex';if(_0x41a81e)_0x41a81e[_0x50221c(0x655)][_0x50221c(0x2526)]='none';loadTodayDiary();}else{if(_0x1a2084==='past'){document[_0x50221c(0x566)](_0x50221c(0x6d4))[_0x50221c(0x226e)][_0x50221c(0xe1)](_0x50221c(0x105d));if(_0x3743b7)_0x3743b7[_0x50221c(0x21dc)]=_0x50221c(0x1c2e);if(_0x2cdd39)_0x2cdd39[_0x50221c(0x655)][_0x50221c(0x2526)]=_0x50221c(0xfe9);if(_0xb8e44f)_0xb8e44f[_0x50221c(0x655)][_0x50221c(0x2526)]='none';if(_0x54d56b)_0x54d56b['style']['display']=_0x50221c(0xfe9);if(_0x41a81e)_0x41a81e[_0x50221c(0x655)][_0x50221c(0x2526)]='inline-flex';loadPastDiaries();}}}let gomokuGameState={'board':null,'currentPlayer':_0x2cf6d4(0x23b2),'gameActive':![],'gameStartTime':null,'gameSession':null,'chatHistory':[],'moveHistory':[],'gameTimer':null};function showGameMenu(){const _0x49bfa6=_0x2cf6d4;if(!currentChatCharacter){showToast(_0x49bfa6(0x1268),_0x49bfa6(0x24ab));return;}generateGameButtons(),showModal(_0x49bfa6(0xe37));}function generateGameButtons(){const _0x23e16c=_0x2cf6d4,_0x44f453=document[_0x23e16c(0x566)](_0x23e16c(0xdf)),_0x5350bb=currentChatCharacter&&currentChatCharacter['isGroup'],_0x3e1356={'gomoku':{'name':_0x23e16c(0x925),'desc':_0x23e16c(0x10f8),'icon':_0x23e16c(0x14fd),'class':_0x23e16c(0x171c),'badge':null,'badgeText':'','singleChat':!![],'groupChat':![],'available':!![]},'turtle-soup':{'name':_0x23e16c(0x1b0e),'desc':_0x23e16c(0xee5),'icon':_0x23e16c(0x545),'class':_0x23e16c(0x43a),'badge':_0x23e16c(0x241e),'badgeText':'优化','singleChat':!![],'groupChat':!![],'available':!![]},'werewolf':{'name':'狼人杀','desc':'多人推理游戏，适合群聊','icon':_0x23e16c(0xcfa),'class':_0x23e16c(0x29b),'badge':_0x23e16c(0x1401),'badgeText':_0x23e16c(0x23f7),'singleChat':![],'groupChat':!![],'available':![]},'monopoly':{'name':_0x23e16c(0x1138),'desc':_0x23e16c(0x420),'icon':_0x23e16c(0x34f),'class':_0x23e16c(0x700),'badge':_0x23e16c(0x1401),'badgeText':'开发中','singleChat':![],'groupChat':!![],'available':![]}},_0x470dbb=Object[_0x23e16c(0x230e)](_0x3e1356)['filter'](([_0x77689d,_0x2b109d])=>{const _0x21493c=_0x23e16c;return _0x5350bb?_0x2b109d[_0x21493c(0x8cf)]:_0x2b109d[_0x21493c(0x13d8)];});_0x44f453['innerHTML']=_0x470dbb[_0x23e16c(0xf6d)](([_0x1897c4,_0x107054])=>{const _0x4ba3f0=_0x23e16c,_0x21b01c=_0x107054[_0x4ba3f0(0x192b)]?'':'\x20disabled',_0x454df5=_0x107054[_0x4ba3f0(0x10d2)]?_0x4ba3f0(0x192f)+_0x107054[_0x4ba3f0(0x10d2)]+'\x22>'+_0x107054['badgeText']+_0x4ba3f0(0xa54):'';return _0x4ba3f0(0x794)+_0x107054[_0x4ba3f0(0x63e)]+_0x21b01c+_0x4ba3f0(0x1dfc)+_0x1897c4+_0x4ba3f0(0x230d)+(!_0x107054[_0x4ba3f0(0x192b)]?_0x4ba3f0(0x194e):'')+_0x4ba3f0(0x1f13)+_0x107054[_0x4ba3f0(0x689)]+'\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22game-button-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22game-button-title\x22>'+_0x107054[_0x4ba3f0(0x222f)]+_0x4ba3f0(0x22d2)+_0x107054[_0x4ba3f0(0x196a)]+_0x4ba3f0(0x2280)+_0x454df5+_0x4ba3f0(0xf5f);})[_0x23e16c(0x140c)]('');}function hideGameMenu(){const _0xc58b10=_0x2cf6d4;hideModal(_0xc58b10(0xe37));}function selectGame(_0x30ae4e){const _0x43d58c=_0x2cf6d4;if(!currentChatCharacter){showToast('请先选择一个角色',_0x43d58c(0x24ab));return;}if(_0x30ae4e===_0x43d58c(0x29b)||_0x30ae4e===_0x43d58c(0x700)){showToast(_0x43d58c(0x1a1f),_0x43d58c(0x2422));return;}hideGameMenu(),showWaitingModal(),requestGameWithAI(_0x30ae4e);}function showWaitingModal(){const _0x487883=_0x2cf6d4,_0x81f646=document[_0x487883(0x1ad8)]('div');_0x81f646[_0x487883(0x221)]=_0x487883(0xed7),_0x81f646['id']='waitingModal',_0x81f646[_0x487883(0xc02)]=_0x487883(0x1688),document['body'][_0x487883(0x1925)](_0x81f646);}function hideWaitingModal(){const _0x38c93a=_0x2cf6d4,_0x2cf295=document['getElementById'](_0x38c93a(0x610));_0x2cf295&&_0x2cf295['remove']();}function requestGameWithAI(_0x41bd4c){const _0x15351c=_0x2cf6d4,_0x4993d5={'gomoku':_0x15351c(0x925),'turtle-soup':_0x15351c(0x2bc),'werewolf':_0x15351c(0xd47),'monopoly':_0x15351c(0x1138)},_0x15360b=_0x4993d5[_0x41bd4c]||_0x41bd4c;setTimeout(()=>{const _0x30b6d2=_0x15351c,_0x59389f=Math[_0x30b6d2(0x191c)]()>0.2;hideWaitingModal(),_0x59389f?startGameSession(_0x41bd4c,_0x15360b):showToast(currentChatCharacter[_0x30b6d2(0x222f)]+_0x30b6d2(0x1921)+_0x15360b+_0x30b6d2(0x19fc),'info');},0x7d0+Math[_0x15351c(0x191c)]()*0x7d0);}function startGameSession(_0x51d9bf,_0x149366){const _0x2faec0=_0x2cf6d4;showToast(_0x2faec0(0x29d)+_0x149366+_0x2faec0(0x12da),_0x2faec0(0x2422)),setTimeout(async()=>{const _0x59fd55=_0x2faec0;if(_0x51d9bf===_0x59fd55(0x171c))await startGomokuGame();else _0x51d9bf===_0x59fd55(0x43a)?await startTurtleSoupGame():alert('🎮\x20'+_0x149366+'游戏界面开发中...\x0a\x0a即将支持：\x0a•\x20全屏游戏界面（上方70%游戏区，下方30%聊天区）\x0a•\x20实时游戏状态同步\x0a•\x20游戏中聊天记录\x0a•\x20游戏结果记录到记忆系统');},0x1f4);}function startGomokuGame(){const _0x4a1b0b=_0x2cf6d4,_0xff13bd=localStorage[_0x4a1b0b(0x2250)](_0x4a1b0b(0x1fc5));_0xff13bd?showContinueGameModal():startNewGomokuGame();}function showContinueGameModal(){const _0x21df90=_0x2cf6d4,_0x36c362=document[_0x21df90(0x1ad8)]('div');_0x36c362['className']=_0x21df90(0x130),_0x36c362['innerHTML']=_0x21df90(0x238a);const _0x348c0b=document[_0x21df90(0x566)](_0x21df90(0x2379));_0x348c0b?_0x348c0b[_0x21df90(0x1925)](_0x36c362):document[_0x21df90(0x172c)][_0x21df90(0x1925)](_0x36c362);}function continueGomokuGame(){const _0x254f97=_0x2cf6d4,_0x390e6b=JSON['parse'](localStorage[_0x254f97(0x2250)](_0x254f97(0x1fc5)));document[_0x254f97(0x15b8)](_0x254f97(0x1c3e))[_0x254f97(0x128)](),hideApp('chat-screen'),showApp('gomoku-game-screen'),gomokuGameState={'board':_0x390e6b['board'],'currentPlayer':_0x390e6b[_0x254f97(0x1849)],'gameActive':!![],'gameStartTime':_0x390e6b[_0x254f97(0x642)],'userIsBlack':_0x390e6b[_0x254f97(0x233b)]||!![],'gameSession':_0x390e6b[_0x254f97(0x12fc)],'chatHistory':_0x390e6b[_0x254f97(0x2121)]||[],'moveHistory':_0x390e6b[_0x254f97(0x24f4)],'gameTimer':null},gomokuGameState[_0x254f97(0x12fc)][_0x254f97(0x513)][_0x254f97(0x6ee)]({'type':'game_resume','timestamp':Date[_0x254f97(0x18e0)](),'player':_0x254f97(0x212),'data':{'reason':'继续之前暂停的游戏'}}),createGomokuBoard(),updateBoardUI(),updateGomokuUI(),updatePlayerPieceDisplay(),startGameTimer(),setupAIPlayerInfo(),updatePlayerPieceDisplay();const _0x371a2d=document[_0x254f97(0x566)](_0x254f97(0x1d71));_0x371a2d[_0x254f97(0xc02)]='',_0x390e6b[_0x254f97(0x2121)]&&_0x390e6b[_0x254f97(0x2121)][_0x254f97(0x900)](_0x32158a=>{const _0x3b0f99=_0x254f97;addGameChatMessage(_0x32158a[_0x3b0f99(0xf75)],_0x32158a[_0x3b0f99(0x1423)],![]);}),addGameChatMessage(_0x254f97(0x212),_0x254f97(0x1ebf)),addGameChatMessage('ai',_0x254f97(0x2079),!![]);}function startNewGomokuGameFromModal(){const _0x7920cf=_0x2cf6d4;localStorage[_0x7920cf(0x1c95)](_0x7920cf(0x1fc5)),document['querySelector'](_0x7920cf(0x1c3e))[_0x7920cf(0x128)](),startNewGomokuGame();}function startNewGomokuGame(){const _0x214bdb=_0x2cf6d4;hideApp(_0x214bdb(0xa76)),showApp(_0x214bdb(0x163e)),initGomokuGame(),recordGameStart();}async function initGomokuGame(){const _0x432f10=_0x2cf6d4,_0x34441a=Math[_0x432f10(0x191c)]()<0.5,_0x34e4b9=_0x34441a?_0x432f10(0x23b2):'ai';gomokuGameState={'board':Array(0xf)[_0x432f10(0x1da0)]()[_0x432f10(0xf6d)](()=>Array(0xf)['fill'](null)),'currentPlayer':_0x34e4b9,'gameActive':!![],'gameStartTime':Date[_0x432f10(0x18e0)](),'userIsBlack':_0x34441a,'gameSession':{'gameId':_0x432f10(0x14f0)+Date['now'](),'players':['user',currentChatCharacter['id']],'boardState':[],'chatHistory':[],'gameEvents':[{'type':'game_start','timestamp':Date[_0x432f10(0x18e0)](),'player':'system','data':{'gameName':_0x432f10(0x925),'userIsBlack':_0x34441a,'firstPlayer':_0x34e4b9}}]},'chatHistory':[],'moveHistory':[],'gameTimer':null},createGomokuBoard(),updateGomokuUI(),updatePlayerPieceDisplay(),startGameTimer(),setupAIPlayerInfo(),updatePlayerPieceDisplay();const _0x1dbac0=_0x34441a?'黑子':'白子',_0x5e1aaa=_0x34441a?'白子':'黑子',_0x1a2931=_0x34e4b9==='user'?_0x432f10(0x2007):_0x432f10(0x8d8);addGameChatMessage(_0x432f10(0x212),_0x432f10(0xbce)+_0x1dbac0+'，'+_0x1a2931+'。'),currentChatCharacter&&await recordGameEvent(currentChatCharacter['id'],_0x432f10(0x1414),{'gameName':_0x432f10(0x925),'result':null,'score':null,'chatContent':_0x432f10(0x10d5)+_0x5e1aaa+_0x432f10(0x11a)+_0x1dbac0+'，'+(_0x34e4b9===_0x432f10(0x23b2)?_0x432f10(0xee1):'你先行')}),_0x34e4b9==='ai'&&setTimeout(()=>{makeAIMove();},0x7d0);}function createGomokuBoard(){const _0x1fe99d=_0x2cf6d4,_0x1a3ffd=document[_0x1fe99d(0x566)](_0x1fe99d(0x171));_0x1a3ffd['innerHTML']='';for(let _0x5ac56a=0x0;_0x5ac56a<0xe;_0x5ac56a++){for(let _0x4f29b0=0x0;_0x4f29b0<0xe;_0x4f29b0++){const _0x175461=document[_0x1fe99d(0x1ad8)](_0x1fe99d(0x526));_0x175461['className']=_0x1fe99d(0x1e26),_0x1a3ffd[_0x1fe99d(0x1925)](_0x175461);}}for(let _0x183052=0x0;_0x183052<0xf;_0x183052++){for(let _0x2d8cc4=0x0;_0x2d8cc4<0xf;_0x2d8cc4++){const _0x227686=document['createElement'](_0x1fe99d(0x526));_0x227686['className']='gomoku-intersection',_0x227686[_0x1fe99d(0x1f26)][_0x1fe99d(0x1f44)]=_0x183052,_0x227686[_0x1fe99d(0x1f26)][_0x1fe99d(0x2262)]=_0x2d8cc4,_0x227686['onclick']=()=>handleCellClick(_0x183052,_0x2d8cc4);const _0x439913=0x12c/0xe,_0x4f655c=0x10;_0x227686[_0x1fe99d(0x655)][_0x1fe99d(0x492)]='absolute',_0x227686[_0x1fe99d(0x655)]['left']=_0x2d8cc4*_0x439913-_0x4f655c/0x2+'px',_0x227686[_0x1fe99d(0x655)]['top']=_0x183052*_0x439913-_0x4f655c/0x2+'px',_0x227686['style'][_0x1fe99d(0xaab)]=_0x4f655c+'px',_0x227686[_0x1fe99d(0x655)]['height']=_0x4f655c+'px',_0x227686[_0x1fe99d(0x655)][_0x1fe99d(0x1f07)]='pointer',_0x227686[_0x1fe99d(0x655)][_0x1fe99d(0xc21)]=_0x1fe99d(0xaf9),_0x227686['style'][_0x1fe99d(0x2175)]=_0x1fe99d(0x5e8),_0x227686[_0x1fe99d(0x655)][_0x1fe99d(0x2526)]=_0x1fe99d(0x1f0b),_0x227686['style'][_0x1fe99d(0x9c7)]=_0x1fe99d(0x23a1),_0x227686[_0x1fe99d(0x655)][_0x1fe99d(0x1571)]=_0x1fe99d(0x23a1),_0x227686['style']['zIndex']='10',_0x1a3ffd[_0x1fe99d(0x1925)](_0x227686);}}}async function handleCellClick(_0x31a87c,_0x2c0f46){const _0x291498=_0x2cf6d4;if(!gomokuGameState['gameActive']||gomokuGameState[_0x291498(0x1849)]!=='user'||gomokuGameState[_0x291498(0x2401)][_0x31a87c][_0x2c0f46]!==null)return;await makeMove(_0x31a87c,_0x2c0f46,_0x291498(0x23b2));}async function makeMove(_0x3547b4,_0x208b69,_0x4e68cb){const _0x145745=_0x2cf6d4;gomokuGameState[_0x145745(0x2401)][_0x3547b4][_0x208b69]=_0x4e68cb;const _0x4201ca={'row':_0x3547b4,'col':_0x208b69,'player':_0x4e68cb,'timestamp':Date['now'](),'moveNumber':gomokuGameState['moveHistory'][_0x145745(0xcbf)]+0x1};gomokuGameState[_0x145745(0x24f4)][_0x145745(0x6ee)](_0x4201ca),gomokuGameState[_0x145745(0x12fc)]['gameEvents'][_0x145745(0x6ee)]({'type':_0x145745(0x2302),'timestamp':Date[_0x145745(0x18e0)](),'player':_0x4e68cb,'data':{'row':_0x3547b4,'col':_0x208b69,'moveNumber':_0x4201ca[_0x145745(0x1afe)]}}),updateBoardUI(),gomokuGameState[_0x145745(0x1849)]=_0x4e68cb===_0x145745(0x23b2)?'ai':_0x145745(0x23b2),updateGomokuUI();const _0x1f9535=checkWinner(_0x3547b4,_0x208b69);if(_0x1f9535){endGame(_0x1f9535);return;}if(gomokuGameState['moveHistory'][_0x145745(0xcbf)]>=0xe1){endGame(_0x145745(0xe41));return;}gomokuGameState[_0x145745(0x1849)]==='ai'&&(setTimeout(()=>{const _0x379d6d=_0x145745,_0x594aac=document['getElementById'](_0x379d6d(0x2c0));_0x594aac[_0x379d6d(0x21dc)]=_0x379d6d(0x231f),_0x594aac[_0x379d6d(0x655)][_0x379d6d(0x2099)]='#718096';},0x1f4),setTimeout(()=>{makeAIMove();},0x3e8+Math[_0x145745(0x191c)]()*0x7d0));}async function makeAIMove(){const _0x2d582d=_0x2cf6d4;if(!gomokuGameState[_0x2d582d(0x938)]||gomokuGameState[_0x2d582d(0x1849)]!=='ai')return;if(!currentChatCharacter){makeBackupMove();return;}try{const _0x2abfa4=document[_0x2d582d(0x566)](_0x2d582d(0x2c0));_0x2abfa4[_0x2d582d(0x21dc)]=currentChatCharacter[_0x2d582d(0x222f)]+_0x2d582d(0x1d7a),_0x2abfa4[_0x2d582d(0x655)][_0x2d582d(0x2099)]=_0x2d582d(0x1062);const _0x4bcb7f=await getAIMoveFromAPI();_0x4bcb7f&&_0x4bcb7f['row']!==undefined&&_0x4bcb7f['col']!==undefined?isValidMove(_0x4bcb7f[_0x2d582d(0x1f44)],_0x4bcb7f['col'])?setTimeout(async()=>{const _0x10d028=_0x2d582d;await makeMove(_0x4bcb7f[_0x10d028(0x1f44)],_0x4bcb7f[_0x10d028(0x2262)],'ai'),_0x4bcb7f[_0x10d028(0xb04)]&&setTimeout(()=>{addGameChatMessage('ai',_0x4bcb7f['reasoning'],!![]);},0x1f4);},0x320+Math['random']()*0x4b0):(console['warn'](_0x2d582d(0x2113)),makeBackupMove()):(console[_0x2d582d(0x17cc)](_0x2d582d(0x809)),makeBackupMove());}catch(_0x182b95){console['error'](_0x2d582d(0x1890),_0x182b95),makeBackupMove();}}function makeRandomMove(){const _0x2ab291=_0x2cf6d4,_0x46bc41=[];for(let _0x561098=0x0;_0x561098<0xf;_0x561098++){for(let _0x132342=0x0;_0x132342<0xf;_0x132342++){gomokuGameState['board'][_0x561098][_0x132342]===null&&_0x46bc41['push']({'row':_0x561098,'col':_0x132342});}}if(_0x46bc41['length']>0x0){const _0x4f6088=Math[_0x2ab291(0x1dac)](Math[_0x2ab291(0x191c)]()*_0x46bc41[_0x2ab291(0xcbf)]),{row:_0x29262e,col:_0x5f36c1}=_0x46bc41[_0x4f6088];setTimeout(async()=>{await makeMove(_0x29262e,_0x5f36c1,'ai');},0x1f4);}}function findBestMove(_0x1718f6){const _0x284945=_0x2cf6d4,_0x4ba2ae=gomokuGameState['board'],_0xe16b28=findWinningMove('ai');if(_0xe16b28)return _0xe16b28;const _0xb64465=findWinningMove(_0x284945(0x23b2));if(_0xb64465)return _0xb64465;if(_0x1718f6>=0x2){const _0x546c1e=findStrategicMove(_0x1718f6);if(_0x546c1e)return _0x546c1e;}const _0x30beea=findCenterMove();if(_0x30beea)return _0x30beea;return null;}function findWinningMove(_0x29630b){const _0x6cecc7=_0x2cf6d4;for(let _0x165f7e=0x0;_0x165f7e<0xf;_0x165f7e++){for(let _0x2be911=0x0;_0x2be911<0xf;_0x2be911++){if(gomokuGameState[_0x6cecc7(0x2401)][_0x165f7e][_0x2be911]===null){gomokuGameState[_0x6cecc7(0x2401)][_0x165f7e][_0x2be911]=_0x29630b;if(checkWinner(_0x165f7e,_0x2be911))return gomokuGameState[_0x6cecc7(0x2401)][_0x165f7e][_0x2be911]=null,{'row':_0x165f7e,'col':_0x2be911};gomokuGameState[_0x6cecc7(0x2401)][_0x165f7e][_0x2be911]=null;}}}return null;}function findStrategicMove(_0xc35718){const _0x41991e=_0x2cf6d4;let _0x3e64cc=-0x1,_0x5d3f05=null;for(let _0x4283ce=0x0;_0x4283ce<0xf;_0x4283ce++){for(let _0x414003=0x0;_0x414003<0xf;_0x414003++){if(gomokuGameState[_0x41991e(0x2401)][_0x4283ce][_0x414003]===null){const _0x82a84f=evaluatePosition(_0x4283ce,_0x414003,'ai');_0x82a84f>_0x3e64cc&&(_0x3e64cc=_0x82a84f,_0x5d3f05={'row':_0x4283ce,'col':_0x414003});}}}return _0x5d3f05;}function findCenterMove(){const _0x1dbe05=_0x2cf6d4,_0x11dbec=0x7,_0x5be518=[];for(let _0x25e938=0x0;_0x25e938<=0x3;_0x25e938++){for(let _0x48cc8e=_0x11dbec-_0x25e938;_0x48cc8e<=_0x11dbec+_0x25e938;_0x48cc8e++){for(let _0x540a7d=_0x11dbec-_0x25e938;_0x540a7d<=_0x11dbec+_0x25e938;_0x540a7d++){_0x48cc8e>=0x0&&_0x48cc8e<0xf&&_0x540a7d>=0x0&&_0x540a7d<0xf&&gomokuGameState[_0x1dbe05(0x2401)][_0x48cc8e][_0x540a7d]===null&&_0x5be518[_0x1dbe05(0x6ee)]({'row':_0x48cc8e,'col':_0x540a7d});}}if(_0x5be518[_0x1dbe05(0xcbf)]>0x0)break;}return _0x5be518[_0x1dbe05(0xcbf)]>0x0?_0x5be518[Math[_0x1dbe05(0x1dac)](Math[_0x1dbe05(0x191c)]()*_0x5be518[_0x1dbe05(0xcbf)])]:null;}function evaluatePosition(_0x3ea806,_0x23e1d3,_0x567681){let _0x20c810=0x0;const _0x5018b0=[[0x0,0x1],[0x1,0x0],[0x1,0x1],[0x1,-0x1]];for(const [_0x52134d,_0x27b3d0]of _0x5018b0){_0x20c810+=evaluateDirection(_0x3ea806,_0x23e1d3,_0x52134d,_0x27b3d0,_0x567681);}return _0x20c810;}function evaluateDirection(_0x5689e4,_0x135736,_0xd69bf4,_0x1ff772,_0x314aaf){const _0x41433d=_0x2cf6d4;let _0x5b0efb=0x1,_0x29cb41=0x0,_0x45a4c5=_0x5689e4+_0xd69bf4,_0x19ddf6=_0x135736+_0x1ff772;while(_0x45a4c5>=0x0&&_0x45a4c5<0xf&&_0x19ddf6>=0x0&&_0x19ddf6<0xf&&gomokuGameState[_0x41433d(0x2401)][_0x45a4c5][_0x19ddf6]===_0x314aaf){_0x5b0efb++,_0x45a4c5+=_0xd69bf4,_0x19ddf6+=_0x1ff772;}_0x45a4c5>=0x0&&_0x45a4c5<0xf&&_0x19ddf6>=0x0&&_0x19ddf6<0xf&&gomokuGameState[_0x41433d(0x2401)][_0x45a4c5][_0x19ddf6]===null&&_0x29cb41++;_0x45a4c5=_0x5689e4-_0xd69bf4,_0x19ddf6=_0x135736-_0x1ff772;while(_0x45a4c5>=0x0&&_0x45a4c5<0xf&&_0x19ddf6>=0x0&&_0x19ddf6<0xf&&gomokuGameState['board'][_0x45a4c5][_0x19ddf6]===_0x314aaf){_0x5b0efb++,_0x45a4c5-=_0xd69bf4,_0x19ddf6-=_0x1ff772;}_0x45a4c5>=0x0&&_0x45a4c5<0xf&&_0x19ddf6>=0x0&&_0x19ddf6<0xf&&gomokuGameState[_0x41433d(0x2401)][_0x45a4c5][_0x19ddf6]===null&&_0x29cb41++;if(_0x5b0efb>=0x5)return 0x2710;if(_0x5b0efb===0x4&&_0x29cb41>0x0)return 0x3e8;if(_0x5b0efb===0x3&&_0x29cb41===0x2)return 0x64;if(_0x5b0efb===0x3&&_0x29cb41===0x1)return 0xa;if(_0x5b0efb===0x2&&_0x29cb41===0x2)return 0x5;return _0x5b0efb*_0x29cb41;}async function getAIMoveFromAPI(){const _0xbc8c35=_0x2cf6d4;if(!currentChatCharacter)return null;const _0x2398af=getBoardDescription(),_0x1e1dd3=getMoveHistoryDescription(),_0x5f7588=getGameAnalysis(),_0x4d19e8='你是'+currentChatCharacter[_0xbc8c35(0x222f)]+'，'+currentChatCharacter['prompt']+_0xbc8c35(0x9d5)+(gomokuGameState['userIsBlack']?_0xbc8c35(0x7ed):_0xbc8c35(0x2343))+'，用户执'+(gomokuGameState[_0xbc8c35(0x233b)]?_0xbc8c35(0x2343):_0xbc8c35(0x7ed))+_0xbc8c35(0x10bc)+_0x2398af+'\x0a\x0a'+_0x1e1dd3+'\x0a\x0a'+_0x5f7588+_0xbc8c35(0x250b);try{const _0x16931b=await callChatAPI(_0x4d19e8,currentChatCharacter);return parseAIMoveResponse(_0x16931b);}catch(_0x232f1c){return console[_0xbc8c35(0x24ab)]('AI下棋API调用失败:',_0x232f1c),null;}}function analyzeThreats(_0x362601,_0x15d3fb,_0x41adab){const _0xb0f35e=_0x2cf6d4,_0x34b3f1=[],_0x152fd6=[[0x0,0x1],[0x1,0x0],[0x1,0x1],[0x1,-0x1]];for(const [_0xf4a595,_0x3c1bcb]of _0x152fd6){const _0x50812b=countDirection(_0x362601,_0x15d3fb,_0xf4a595,_0x3c1bcb,_0x41adab);_0x50812b>=0x3&&_0x34b3f1[_0xb0f35e(0x6ee)]({'type':_0x50812b===0x3?'three':_0xb0f35e(0x1951),'direction':[_0xf4a595,_0x3c1bcb]});}return _0x34b3f1;}function countDirection(_0x130c3f,_0x2cb3ac,_0x44d00b,_0x83dca0,_0x2e05fa){const _0x141505=_0x2cf6d4;let _0x1f58d2=0x1,_0x2935d2=_0x130c3f+_0x44d00b,_0x5310ad=_0x2cb3ac+_0x83dca0;while(_0x2935d2>=0x0&&_0x2935d2<0xf&&_0x5310ad>=0x0&&_0x5310ad<0xf&&gomokuGameState[_0x141505(0x2401)][_0x2935d2][_0x5310ad]===_0x2e05fa){_0x1f58d2++,_0x2935d2+=_0x44d00b,_0x5310ad+=_0x83dca0;}_0x2935d2=_0x130c3f-_0x44d00b,_0x5310ad=_0x2cb3ac-_0x83dca0;while(_0x2935d2>=0x0&&_0x2935d2<0xf&&_0x5310ad>=0x0&&_0x5310ad<0xf&&gomokuGameState[_0x141505(0x2401)][_0x2935d2][_0x5310ad]===_0x2e05fa){_0x1f58d2++,_0x2935d2-=_0x44d00b,_0x5310ad-=_0x83dca0;}return _0x1f58d2;}function isBlockingUserThreat(_0x2974db,_0x6b03b0){const _0x361c0e=_0x2cf6d4;gomokuGameState['board'][_0x2974db][_0x6b03b0]=_0x361c0e(0x23b2);const _0x403070=analyzeThreats(_0x2974db,_0x6b03b0,_0x361c0e(0x23b2));return gomokuGameState[_0x361c0e(0x2401)][_0x2974db][_0x6b03b0]='ai',_0x403070[_0x361c0e(0xcbf)]>0x0;}function getBoardDescription(){const _0x278b07=_0x2cf6d4;let _0x1a672b=_0x278b07(0x19f8);_0x1a672b+=_0x278b07(0x61a);for(let _0x4f449d=0x0;_0x4f449d<0xf;_0x4f449d++){_0x1a672b+=_0x4f449d['toString']()[_0x278b07(0x863)](0x2,'\x20');}_0x1a672b+='\x0a';for(let _0x2639f5=0x0;_0x2639f5<0xf;_0x2639f5++){let _0x27dc22=_0x2639f5[_0x278b07(0x9a3)]()[_0x278b07(0x863)](0x2,'\x20')+'\x20';for(let _0x3c0136=0x0;_0x3c0136<0xf;_0x3c0136++){const _0x24786a=gomokuGameState[_0x278b07(0x2401)][_0x2639f5][_0x3c0136];if(_0x24786a==='user')_0x27dc22+=gomokuGameState[_0x278b07(0x233b)]?'●':'O';else _0x24786a==='ai'?_0x27dc22+=gomokuGameState[_0x278b07(0x233b)]?'O':'●':_0x27dc22+='·';if(_0x3c0136<0xe)_0x27dc22+='\x20';}_0x1a672b+=_0x27dc22+'\x0a';}const _0x228e9b=[];for(let _0x3f870d=0x0;_0x3f870d<0xf;_0x3f870d++){for(let _0xef298e=0x0;_0xef298e<0xf;_0xef298e++){gomokuGameState[_0x278b07(0x2401)][_0x3f870d][_0xef298e]===null&&_0x228e9b['push']('('+_0x3f870d+','+_0xef298e+')');}}return _0x228e9b[_0x278b07(0xcbf)]>0x0&&(_0x1a672b+='\x0a可下棋位置示例:\x20'+_0x228e9b['slice'](0x0,0x14)['join'](',\x20'),_0x228e9b[_0x278b07(0xcbf)]>0x14&&(_0x1a672b+='\x20等'+_0x228e9b[_0x278b07(0xcbf)]+_0x278b07(0x23c7))),_0x1a672b;}function getMoveHistoryDescription(){const _0x269b80=_0x2cf6d4;if(gomokuGameState[_0x269b80(0x24f4)]['length']===0x0)return _0x269b80(0x16d);let _0x646dcb=_0x269b80(0x1a6c)+gomokuGameState[_0x269b80(0x24f4)][_0x269b80(0xcbf)]+'步）：\x0a';const _0x43d5d5=gomokuGameState['moveHistory'][_0x269b80(0x136)](-0x6);return _0x43d5d5[_0x269b80(0x900)]((_0x510391,_0xf1bb18)=>{const _0x254daa=_0x269b80,_0x1ef2e7=gomokuGameState[_0x254daa(0x24f4)][_0x254daa(0xcbf)]-_0x43d5d5[_0x254daa(0xcbf)]+_0xf1bb18+0x1,_0x475c15=_0x510391[_0x254daa(0x866)]==='user'?'用户':'你';_0x646dcb+='第'+_0x1ef2e7+_0x254daa(0x810)+_0x475c15+'在('+_0x510391[_0x254daa(0x1f44)]+','+_0x510391[_0x254daa(0x2262)]+_0x254daa(0x155e)+(_0x510391[_0x254daa(0x866)]===_0x254daa(0x23b2)?gomokuGameState[_0x254daa(0x233b)]?_0x254daa(0x1c42):_0x254daa(0x697):gomokuGameState['userIsBlack']?_0x254daa(0x697):_0x254daa(0x1c42))+'\x0a';}),_0x646dcb;}function getGameAnalysis(){const _0x37f1ed=_0x2cf6d4,_0x2d9c9a=gomokuGameState['moveHistory'][_0x37f1ed(0xcbf)];let _0x49c2f2=_0x37f1ed(0x57b)+_0x2d9c9a+'步。';if(_0x2d9c9a<0x6)_0x49c2f2+=_0x37f1ed(0x898);else _0x2d9c9a<0xf?_0x49c2f2+=_0x37f1ed(0x1161):_0x49c2f2+=_0x37f1ed(0x1769);return _0x49c2f2;}function parseAIMoveResponse(_0x5ac241){const _0x3fa082=_0x2cf6d4;try{let _0x35583f='';Array['isArray'](_0x5ac241)?_0x35583f=_0x5ac241[0x0]:_0x35583f=_0x5ac241;console[_0x3fa082(0xc0d)]('🤖\x20AI原始回复:',_0x35583f);const _0x5026bb=_0x35583f[_0x3fa082(0x1316)](/\{[\s\S]*\}/);if(_0x5026bb){const _0x592908=JSON[_0x3fa082(0x168e)](_0x5026bb[0x0]);console['log'](_0x3fa082(0xf3d),_0x592908);if(typeof _0x592908['row']==='number'&&typeof _0x592908[_0x3fa082(0x2262)]===_0x3fa082(0x8f6)&&_0x592908['row']>=0x0&&_0x592908[_0x3fa082(0x1f44)]<=0xe&&_0x592908[_0x3fa082(0x2262)]>=0x0&&_0x592908[_0x3fa082(0x2262)]<=0xe){if(gomokuGameState[_0x3fa082(0x2401)][_0x592908[_0x3fa082(0x1f44)]][_0x592908[_0x3fa082(0x2262)]]!==null)return console[_0x3fa082(0x17cc)]('🚫\x20AI选择的位置('+_0x592908[_0x3fa082(0x1f44)]+','+_0x592908[_0x3fa082(0x2262)]+_0x3fa082(0x3b1),gomokuGameState[_0x3fa082(0x2401)][_0x592908[_0x3fa082(0x1f44)]][_0x592908[_0x3fa082(0x2262)]]),null;return console[_0x3fa082(0xc0d)](_0x3fa082(0x14e1)+_0x592908[_0x3fa082(0x1f44)]+','+_0x592908[_0x3fa082(0x2262)]+')'),_0x592908;}else console[_0x3fa082(0x17cc)](_0x3fa082(0x1548),_0x592908);}else console[_0x3fa082(0x17cc)](_0x3fa082(0x23be),_0x35583f);return null;}catch(_0x398fd6){return console[_0x3fa082(0x24ab)](_0x3fa082(0x16b3),_0x398fd6,_0x5ac241),null;}}function isValidMove(_0x580517,_0x389d1d){const _0x10562d=_0x2cf6d4;return _0x580517>=0x0&&_0x580517<0xf&&_0x389d1d>=0x0&&_0x389d1d<0xf&&gomokuGameState[_0x10562d(0x2401)][_0x580517][_0x389d1d]===null;}function makeBackupMove(){const _0xb5724f=_0x2cf6d4,_0xe5fac7=findBestMove(0x2);_0xe5fac7?setTimeout(async()=>{const _0x2e9406=_0x3a81;await makeMove(_0xe5fac7[_0x2e9406(0x1f44)],_0xe5fac7[_0x2e9406(0x2262)],'ai');},0x1f4+Math[_0xb5724f(0x191c)]()*0x3e8):makeRandomMove();}function checkWinner(_0x28b980,_0x4f6070){const _0x7dcdb9=_0x2cf6d4,_0x513188=gomokuGameState[_0x7dcdb9(0x2401)][_0x28b980][_0x4f6070],_0xa42f13=[[0x0,0x1],[0x1,0x0],[0x1,0x1],[0x1,-0x1]];for(const [_0xdaa319,_0x327358]of _0xa42f13){let _0xa446cf=0x1;const _0x2cea0b=[{'row':_0x28b980,'col':_0x4f6070}];for(let _0x448b4c=0x1;_0x448b4c<0x5;_0x448b4c++){const _0x1c5cd9=_0x28b980+_0xdaa319*_0x448b4c,_0x5b42a7=_0x4f6070+_0x327358*_0x448b4c;if(_0x1c5cd9>=0x0&&_0x1c5cd9<0xf&&_0x5b42a7>=0x0&&_0x5b42a7<0xf&&gomokuGameState[_0x7dcdb9(0x2401)][_0x1c5cd9][_0x5b42a7]===_0x513188)_0xa446cf++,_0x2cea0b[_0x7dcdb9(0x6ee)]({'row':_0x1c5cd9,'col':_0x5b42a7});else break;}for(let _0x46aa5f=0x1;_0x46aa5f<0x5;_0x46aa5f++){const _0x3b1167=_0x28b980-_0xdaa319*_0x46aa5f,_0x2e44b1=_0x4f6070-_0x327358*_0x46aa5f;if(_0x3b1167>=0x0&&_0x3b1167<0xf&&_0x2e44b1>=0x0&&_0x2e44b1<0xf&&gomokuGameState[_0x7dcdb9(0x2401)][_0x3b1167][_0x2e44b1]===_0x513188)_0xa446cf++,_0x2cea0b[_0x7dcdb9(0x50a)]({'row':_0x3b1167,'col':_0x2e44b1});else break;}if(_0xa446cf>=0x5)return _0x2cea0b[_0x7dcdb9(0x900)](({row:_0x16f79c,col:_0x3008d9})=>{const _0x2a8943=_0x7dcdb9,_0x3cf9ea=document[_0x2a8943(0x15b8)](_0x2a8943(0x11f8)+_0x16f79c+_0x2a8943(0x21a1)+_0x3008d9+'\x22]\x20.gomoku-piece');_0x3cf9ea&&_0x3cf9ea['classList'][_0x2a8943(0xe1)](_0x2a8943(0x7a7));}),_0x513188;}return null;}async function endGame(_0x2600bf){const _0x305ab4=_0x2cf6d4;gomokuGameState[_0x305ab4(0x938)]=![],clearInterval(gomokuGameState['gameTimer']);const _0x4b69e1={'type':'game_end','timestamp':Date[_0x305ab4(0x18e0)](),'player':_0x305ab4(0x212),'data':{'winner':_0x2600bf,'totalMoves':gomokuGameState[_0x305ab4(0x24f4)][_0x305ab4(0xcbf)],'gameDuration':Date[_0x305ab4(0x18e0)]()-gomokuGameState[_0x305ab4(0x81d)]}};gomokuGameState[_0x305ab4(0x12fc)][_0x305ab4(0x513)][_0x305ab4(0x6ee)](_0x4b69e1);let _0x196c47;if(_0x2600bf===_0x305ab4(0x23b2))_0x196c47=_0x305ab4(0x1e2e);else _0x2600bf==='ai'?_0x196c47=_0x305ab4(0xcd3):_0x196c47=_0x305ab4(0x80d);addGameChatMessage(_0x305ab4(0x212),_0x196c47);if(currentChatCharacter){const _0x2b03f3=Math[_0x305ab4(0x5f3)]((Date['now']()-gomokuGameState[_0x305ab4(0x81d)])/0x3e8/0x3c),_0x57ab15=gomokuGameState[_0x305ab4(0x24f4)][_0x305ab4(0xcbf)];await recordGameEvent(currentChatCharacter['id'],_0x305ab4(0x20d7),{'gameName':_0x305ab4(0x925),'result':_0x2600bf,'score':_0x57ab15,'chatContent':_0x305ab4(0x1eaf)+_0x2600bf+_0x305ab4(0xf5a)+_0x57ab15+_0x305ab4(0x62c)+_0x2b03f3+'分钟'});}updateGomokuUI(),setTimeout(()=>{summarizeGameSession();},0xbb8);}function updateBoardUI(){const _0x59d6a3=_0x2cf6d4;for(let _0x36f66a=0x0;_0x36f66a<0xf;_0x36f66a++){for(let _0x132220=0x0;_0x132220<0xf;_0x132220++){const _0x31b90f=document['querySelector'](_0x59d6a3(0x11f8)+_0x36f66a+_0x59d6a3(0x21a1)+_0x132220+'\x22]'),_0x3ece3d=gomokuGameState['board'][_0x36f66a][_0x132220];_0x31b90f[_0x59d6a3(0xc02)]='';if(_0x3ece3d){const _0x551882=document[_0x59d6a3(0x1ad8)](_0x59d6a3(0x526));let _0x368d58;_0x3ece3d==='user'?_0x368d58=gomokuGameState[_0x59d6a3(0x233b)]?_0x59d6a3(0x2326):'white':_0x368d58=gomokuGameState[_0x59d6a3(0x233b)]?_0x59d6a3(0x241f):_0x59d6a3(0x2326),_0x551882[_0x59d6a3(0x221)]=_0x59d6a3(0x2241)+_0x368d58,_0x31b90f[_0x59d6a3(0x1925)](_0x551882);}}}}function updateGomokuUI(){const _0x50f89e=_0x2cf6d4,_0x15fc7d=document[_0x50f89e(0x566)](_0x50f89e(0x2c0));gomokuGameState[_0x50f89e(0x938)]?gomokuGameState[_0x50f89e(0x1849)]===_0x50f89e(0x23b2)?(_0x15fc7d[_0x50f89e(0x21dc)]=_0x50f89e(0x19f4),_0x15fc7d['style'][_0x50f89e(0x2099)]=_0x50f89e(0x1bb6)):(_0x15fc7d['textContent']='对方回合',_0x15fc7d[_0x50f89e(0x655)]['color']=_0x50f89e(0x1062)):(_0x15fc7d[_0x50f89e(0x21dc)]=_0x50f89e(0x18a),_0x15fc7d[_0x50f89e(0x655)][_0x50f89e(0x2099)]=_0x50f89e(0x973));}function updatePlayerPieceDisplay(){const _0x58bc9a=_0x2cf6d4,_0x592376=document[_0x58bc9a(0x1ed9)]('.user-piece'),_0x5d728f=document[_0x58bc9a(0x1ed9)]('.ai-piece');console[_0x58bc9a(0xc0d)](_0x58bc9a(0x1a0e),{'userCount':_0x592376[_0x58bc9a(0xcbf)],'aiCount':_0x5d728f[_0x58bc9a(0xcbf)]}),_0x592376[_0x58bc9a(0x900)](_0x4962f0=>{const _0xef8caf=_0x58bc9a;_0x4962f0['classList'][_0xef8caf(0x128)]('black',_0xef8caf(0x241f)),gomokuGameState[_0xef8caf(0x233b)]?_0x4962f0[_0xef8caf(0x226e)][_0xef8caf(0xe1)](_0xef8caf(0x2326)):_0x4962f0[_0xef8caf(0x226e)]['add'](_0xef8caf(0x241f)),_0x4962f0[_0xef8caf(0x21dc)]='',_0x4962f0[_0xef8caf(0x655)]['display']=_0xef8caf(0x2d4),_0x4962f0[_0xef8caf(0x655)][_0xef8caf(0x311)]=_0xef8caf(0x1e35);}),_0x5d728f['forEach'](_0x190cdf=>{const _0x3890eb=_0x58bc9a;_0x190cdf[_0x3890eb(0x226e)]['remove'](_0x3890eb(0x2326),_0x3890eb(0x241f)),gomokuGameState[_0x3890eb(0x233b)]?_0x190cdf[_0x3890eb(0x226e)][_0x3890eb(0xe1)](_0x3890eb(0x241f)):_0x190cdf[_0x3890eb(0x226e)][_0x3890eb(0xe1)]('black'),_0x190cdf[_0x3890eb(0x21dc)]='',_0x190cdf[_0x3890eb(0x655)][_0x3890eb(0x2526)]=_0x3890eb(0x2d4),_0x190cdf[_0x3890eb(0x655)][_0x3890eb(0x311)]=_0x3890eb(0x1e35);}),console[_0x58bc9a(0xc0d)]('棋子显示已更新\x20-\x20用户执子:',gomokuGameState['userIsBlack']?'黑子':'白子');}function startGameTimer(){const _0x2545e4=_0x2cf6d4,_0x7c941b=document[_0x2545e4(0x566)](_0x2545e4(0x70d));gomokuGameState['gameTimer']=setInterval(()=>{const _0x54e17f=_0x2545e4,_0x3ec09a=Date['now']()-gomokuGameState[_0x54e17f(0x81d)],_0x232ae5=Math[_0x54e17f(0x1dac)](_0x3ec09a/0xea60),_0x3e3e0d=Math[_0x54e17f(0x1dac)](_0x3ec09a%0xea60/0x3e8);_0x7c941b[_0x54e17f(0x21dc)]=_0x232ae5[_0x54e17f(0x9a3)]()[_0x54e17f(0x863)](0x2,'0')+':'+_0x3e3e0d[_0x54e17f(0x9a3)]()[_0x54e17f(0x863)](0x2,'0');},0x3e8);}function setupAIPlayerInfo(){const _0x2f17de=_0x2cf6d4,_0x409322=document['getElementById'](_0x2f17de(0x15ae)),_0x5da080=document[_0x2f17de(0x566)](_0x2f17de(0x20ae)),_0x2310dd=document[_0x2f17de(0x566)](_0x2f17de(0xcce)),_0x58d890=document['getElementById'](_0x2f17de(0x159c)),_0x91b14=document[_0x2f17de(0x566)](_0x2f17de(0x234d));if(currentChatCharacter){_0x409322&&(_0x409322[_0x2f17de(0x21dc)]=currentChatCharacter['name']);const _0x69a631=getCurrentChatSettings(),_0x5425f7=_0x69a631[_0x2f17de(0x23e0)]||currentChatCharacter['avatarUrl']||currentChatCharacter['avatar'];if(_0x5425f7&&_0x5da080){const _0x2c1347=_0x5da080[_0x2f17de(0x15b8)](_0x2f17de(0x161c));_0x5da080['innerHTML']=_0x2f17de(0x2001)+_0x5425f7+'\x22\x20alt=\x22'+currentChatCharacter[_0x2f17de(0x222f)]+_0x2f17de(0xaa4),_0x2c1347&&_0x5da080['appendChild'](_0x2c1347);}if(_0x5425f7&&_0x2310dd){const _0x494eda=_0x2310dd['querySelector'](_0x2f17de(0x161c));_0x2310dd[_0x2f17de(0xc02)]=_0x2f17de(0x2001)+_0x5425f7+'\x22\x20alt=\x22'+currentChatCharacter[_0x2f17de(0x222f)]+_0x2f17de(0xaa4),_0x494eda&&_0x2310dd['appendChild'](_0x494eda);}}const _0x4f67f4=getCurrentChatSettings();let _0x5da5d4=null;_0x4f67f4[_0x2f17de(0x13af)]&&(_0x5da5d4=_0x4f67f4['myChatAvatar']);if(!_0x5da5d4&&_0x4f67f4[_0x2f17de(0x6a0)]){const _0xb8f601=personas[_0x2f17de(0x1aeb)](_0x422681=>_0x422681['id']===_0x4f67f4[_0x2f17de(0x6a0)]);_0xb8f601&&_0xb8f601['avatarUrl']&&(_0x5da5d4=_0xb8f601[_0x2f17de(0x10f9)]);}!_0x5da5d4&&window['userAvatar']&&(_0x5da5d4=window['userAvatar']);if(_0x5da5d4&&_0x58d890){const _0x9e77a7=_0x58d890[_0x2f17de(0x15b8)](_0x2f17de(0x161c));_0x58d890[_0x2f17de(0xc02)]=_0x2f17de(0x2001)+_0x5da5d4+'\x22\x20alt=\x22你\x22\x20style=\x22width:\x20100%;\x20height:\x20100%;\x20border-radius:\x2050%;\x20object-fit:\x20cover;\x22>',_0x9e77a7&&_0x58d890['appendChild'](_0x9e77a7);}if(_0x5da5d4&&_0x91b14){const _0xcbf90e=_0x91b14[_0x2f17de(0x15b8)](_0x2f17de(0x161c));_0x91b14['innerHTML']='<img\x20src=\x22'+_0x5da5d4+_0x2f17de(0x1b2e),_0xcbf90e&&_0x91b14['appendChild'](_0xcbf90e);}}function showGameChatLoading(){const _0x34e749=_0x2cf6d4,_0x293dd8=document[_0x34e749(0x566)](_0x34e749(0x1d71)),_0xdd2c02=document[_0x34e749(0x1ad8)](_0x34e749(0x526));_0xdd2c02[_0x34e749(0x221)]='game-chat-message\x20ai',_0xdd2c02['id']=_0x34e749(0x1793);const _0x27688f=document['createElement'](_0x34e749(0x526));_0x27688f['className']=_0x34e749(0x17df),_0x27688f[_0x34e749(0xc02)]=_0x34e749(0x2442),_0xdd2c02[_0x34e749(0x1925)](_0x27688f),_0x293dd8['appendChild'](_0xdd2c02),_0x293dd8[_0x34e749(0x5e5)]=_0x293dd8[_0x34e749(0x14c8)];}function hideGameChatLoading(){const _0xebe1bd=_0x2cf6d4,_0x4838a8=document[_0xebe1bd(0x566)](_0xebe1bd(0x1793));_0x4838a8&&_0x4838a8[_0xebe1bd(0x128)]();}function addGameChatMessage(_0x3f1bd3,_0x7c2c1d,_0x178dcf=![]){const _0x5192bf=_0x2cf6d4,_0x2fe556=document['getElementById']('gomoku-chat-messages'),_0x117a5c=document[_0x5192bf(0x1ad8)](_0x5192bf(0x526));_0x117a5c[_0x5192bf(0x221)]=_0x5192bf(0x248d)+_0x3f1bd3;const _0x194bf4=document[_0x5192bf(0x1ad8)](_0x5192bf(0x526));_0x194bf4[_0x5192bf(0x221)]=_0x5192bf(0x203e),_0x194bf4[_0x5192bf(0x21dc)]=_0x7c2c1d,_0x117a5c['appendChild'](_0x194bf4),_0x2fe556['appendChild'](_0x117a5c),_0x2fe556[_0x5192bf(0x5e5)]=_0x2fe556[_0x5192bf(0x14c8)];const _0x7dc636={'sender':_0x3f1bd3,'content':_0x7c2c1d,'timestamp':Date[_0x5192bf(0x18e0)]()};gomokuGameState[_0x5192bf(0x12fc)][_0x5192bf(0x2121)][_0x5192bf(0x6ee)](_0x7dc636),_0x178dcf&&currentChatCharacter&&recordGameChat(currentChatCharacter['id'],_0x3f1bd3,_0x7c2c1d,{'gameName':_0x5192bf(0x925),'gameState':_0x5192bf(0x171e)});}async function sendGameChatMessage(){const _0x283e1f=_0x2cf6d4,_0x15c713=document[_0x283e1f(0x566)]('gomoku-chat-input'),_0x402922=_0x15c713[_0x283e1f(0xc34)][_0x283e1f(0x1424)]();if(!_0x402922)return;if(!currentChatCharacter)return;addGameChatMessage(_0x283e1f(0x23b2),_0x402922,!![]),_0x15c713[_0x283e1f(0xc34)]='';try{showGameChatLoading();const _0x30b649=_0x283e1f(0x22fa)+_0x402922,_0x5c7a72={'id':Date[_0x283e1f(0x18e0)](),'characterId':currentChatCharacter['id'],'content':_0x30b649,'sender':_0x283e1f(0x23b2),'timestamp':Date[_0x283e1f(0x18e0)](),'isGameContext':!![]};await db[_0x283e1f(0x464)]['add'](_0x5c7a72);const _0x4fd3e9=gomokuGameState[_0x283e1f(0x938)]?_0x283e1f(0x1a1c):_0x283e1f(0x253a),_0x1422f9=gomokuGameState[_0x283e1f(0x24f4)][_0x283e1f(0xcbf)],_0x5df409=gomokuGameState[_0x283e1f(0x233b)]?'黑子':'白子',_0x3c5f47=gomokuGameState[_0x283e1f(0x233b)]?'白子':'黑子',_0x4699b0=_0x283e1f(0x7b8)+_0x4fd3e9+_0x283e1f(0x1d1b)+_0x1422f9+_0x283e1f(0x246)+_0x3c5f47+_0x283e1f(0x11a)+_0x5df409+_0x283e1f(0x1cc9)+_0x402922+'\x22\x0a\x0a请自然地回应用户，就像平时聊天一样。你可以：\x0a1.\x20回应用户的话题\x0a2.\x20评论当前的棋局\x0a3.\x20聊其他任何话题\x0a4.\x20保持你的性格特点\x0a\x0a回复要自然，不要刻意提醒这是在游戏中。',_0x6b70d7=await callChatAPI(_0x4699b0,currentChatCharacter),_0x2aca42=await parseAiResponse(_0x6b70d7);hideGameChatLoading();if(Array[_0x283e1f(0x1bcc)](_0x2aca42)&&_0x2aca42['length']>0x0)for(let _0x23ab9a=0x0;_0x23ab9a<_0x2aca42[_0x283e1f(0xcbf)];_0x23ab9a++){const _0x118652=_0x2aca42[_0x23ab9a];let _0x1eb42c='';if(typeof _0x118652===_0x283e1f(0xb97))_0x1eb42c=_0x118652[_0x283e1f(0x1424)]();else typeof _0x118652==='object'&&_0x118652[_0x283e1f(0x1423)]&&(_0x1eb42c=_0x118652['content'][_0x283e1f(0x1424)]());_0x1eb42c&&setTimeout(async()=>{const _0x49d1c4=_0x283e1f;addGameChatMessage('ai',_0x1eb42c,!![]);const _0x55f714={'id':Date[_0x49d1c4(0x18e0)]()+_0x23ab9a,'characterId':currentChatCharacter['id'],'content':_0x49d1c4(0x22fa)+_0x1eb42c,'sender':'ai','timestamp':Date[_0x49d1c4(0x18e0)]()+_0x23ab9a,'isGameContext':!![]};await db[_0x49d1c4(0x464)][_0x49d1c4(0xe1)](_0x55f714);},0x12c+_0x23ab9a*0x320);}await recordGameEvent(currentChatCharacter['id'],_0x283e1f(0x56a),{'gameName':'五子棋','result':null,'score':_0x1422f9,'chatContent':_0x283e1f(0x6b8)+_0x402922});}catch(_0x12fd63){console[_0x283e1f(0x24ab)](_0x283e1f(0x1b1c),_0x12fd63),hideGameChatLoading(),setTimeout(()=>{const _0x16e1e6=_0x283e1f,_0x2aeaff=[_0x16e1e6(0x2159),_0x16e1e6(0x557),_0x16e1e6(0x21d7),_0x16e1e6(0x1aef),'你说话真有意思',_0x16e1e6(0x66d),_0x16e1e6(0xeae),_0x16e1e6(0x2af)],_0xa71bd=_0x2aeaff[Math['floor'](Math[_0x16e1e6(0x191c)]()*_0x2aeaff['length'])];addGameChatMessage('ai',_0xa71bd,!![]);},0x3e8+Math[_0x283e1f(0x191c)]()*0x7d0);}}function clearGameChat(){const _0x496ccf=_0x2cf6d4;confirm(_0x496ccf(0x1004))&&(document[_0x496ccf(0x566)](_0x496ccf(0x1d71))[_0x496ccf(0xc02)]='',gomokuGameState[_0x496ccf(0x12fc)][_0x496ccf(0x2121)]=[],showToast(_0x496ccf(0xd60),'success'));}function recordGameStart(){const _0x59c4b1=_0x2cf6d4;currentChatCharacter&&recordGameEvent(currentChatCharacter['id'],_0x59c4b1(0x1414),{'gameName':'五子棋','result':null,'score':null,'chatContent':null});}async function clearGameTimelineMemories(_0x33bc3e,_0x5ada71){const _0x781d43=_0x2cf6d4;try{const _0x2a550b=await db['crossAppTimeline']['where'](_0x781d43(0x10df))[_0x781d43(0x14a)](_0x33bc3e)['toArray'](),_0x392a45=_0x2a550b[_0x781d43(0x803)](_0x2bd5ae=>{const _0x4b8b80=_0x781d43;if(_0x2bd5ae['appType']!==_0x4b8b80(0xe67))return![];const _0x546c7f=_0x2bd5ae[_0x4b8b80(0x4f2)]||{};return _0x546c7f[_0x4b8b80(0x181e)]===_0x5ada71||_0x546c7f['id']&&_0x546c7f['id'][_0x4b8b80(0x23ec)](_0x5ada71)||_0x2bd5ae[_0x4b8b80(0x7aa)]>=gomokuGameState['gameStartTime'];});if(_0x392a45[_0x781d43(0xcbf)]>0x0){const _0x570039=_0x392a45[_0x781d43(0xf6d)](_0x45b569=>_0x45b569['id']);await db[_0x781d43(0x75b)][_0x781d43(0xf71)](_0x570039),console[_0x781d43(0xc0d)](_0x781d43(0x629)+_0x392a45[_0x781d43(0xcbf)]+_0x781d43(0xbbc));}}catch(_0x2de418){console[_0x781d43(0x24ab)](_0x781d43(0x3d6),_0x2de418);throw _0x2de418;}}function exitGomokuGame(){const _0x241421=_0x2cf6d4;gomokuGameState[_0x241421(0x938)]?showExitGameModal():(hideApp(_0x241421(0x163e)),showApp(_0x241421(0x1154)));}function showExitGameModal(){const _0xe4e426=_0x2cf6d4,_0x462be1=document['createElement']('div');_0x462be1[_0xe4e426(0x221)]=_0xe4e426(0x130),_0x462be1[_0xe4e426(0xc02)]=_0xe4e426(0x1016);const _0x2d44de=document['getElementById']('phone-screen');_0x2d44de?_0x2d44de['appendChild'](_0x462be1):document['body'][_0xe4e426(0x1925)](_0x462be1);}function closeExitGameModal(){const _0x7e6a3a=_0x2cf6d4,_0x2fc293=document['querySelector'](_0x7e6a3a(0x1c3e));_0x2fc293&&_0x2fc293[_0x7e6a3a(0x128)]();}function exitGameWithSave(){const _0x126a2d=_0x2cf6d4;gomokuGameState[_0x126a2d(0x12fc)]['gameEvents']['push']({'type':_0x126a2d(0x1336),'timestamp':Date[_0x126a2d(0x18e0)](),'player':_0x126a2d(0x23b2),'data':{'reason':_0x126a2d(0x744)}}),gomokuGameState[_0x126a2d(0x938)]=![],clearInterval(gomokuGameState['gameTimer']),summarizeGameSession(),closeExitGameModal(),hideApp('gomoku-game-screen'),showApp(_0x126a2d(0x1154)),showToast(_0x126a2d(0x1c12),_0x126a2d(0xb27));}async function exitGameWithClear(){const _0x1204d4=_0x2cf6d4,_0x41020a=gomokuGameState[_0x1204d4(0x12fc)]?.[_0x1204d4(0x181e)];gomokuGameState['gameSession']={'gameId':null,'players':[],'boardState':[],'chatHistory':[],'gameEvents':[]},document[_0x1204d4(0x566)](_0x1204d4(0x1d71))[_0x1204d4(0xc02)]='',gomokuGameState[_0x1204d4(0x938)]=![],clearInterval(gomokuGameState[_0x1204d4(0x16a9)]);if(_0x41020a&&currentChatCharacter)try{await clearGameTimelineMemories(currentChatCharacter['id'],_0x41020a),console[_0x1204d4(0xc0d)](_0x1204d4(0x1ae4));}catch(_0x3ea23d){console[_0x1204d4(0x24ab)](_0x1204d4(0x3d6),_0x3ea23d);}closeExitGameModal(),hideApp(_0x1204d4(0x163e)),showApp('api-chat-screen'),showToast(_0x1204d4(0x1af4),'success');}function exitGameTemporary(){const _0xf7a3e4=_0x2cf6d4,_0x41611b={'board':gomokuGameState[_0xf7a3e4(0x2401)],'currentPlayer':gomokuGameState[_0xf7a3e4(0x1849)],'userIsBlack':gomokuGameState['userIsBlack'],'moveHistory':gomokuGameState[_0xf7a3e4(0x24f4)],'gameSession':gomokuGameState[_0xf7a3e4(0x12fc)],'startTime':gomokuGameState[_0xf7a3e4(0x642)],'chatHistory':Array[_0xf7a3e4(0x2308)](document[_0xf7a3e4(0x566)](_0xf7a3e4(0x1d71))[_0xf7a3e4(0xebd)])['map'](_0x353789=>({'sender':_0x353789['classList']['contains']('user')?_0xf7a3e4(0x23b2):_0x353789[_0xf7a3e4(0x226e)][_0xf7a3e4(0x1f9)]('ai')?'ai':_0xf7a3e4(0x212),'content':_0x353789[_0xf7a3e4(0x21dc)],'timestamp':Date[_0xf7a3e4(0x18e0)]()}))};localStorage[_0xf7a3e4(0x2055)](_0xf7a3e4(0x1fc5),JSON[_0xf7a3e4(0x7fb)](_0x41611b)),gomokuGameState[_0xf7a3e4(0x12fc)][_0xf7a3e4(0x513)][_0xf7a3e4(0x6ee)]({'type':'game_pause','timestamp':Date[_0xf7a3e4(0x18e0)](),'player':_0xf7a3e4(0x23b2),'data':{'reason':'用户选择暂时离开'}}),gomokuGameState[_0xf7a3e4(0x938)]=![],clearInterval(gomokuGameState[_0xf7a3e4(0x16a9)]),closeExitGameModal(),hideApp(_0xf7a3e4(0x163e)),showApp('api-chat-screen'),showToast(_0xf7a3e4(0xb6e),_0xf7a3e4(0xb27));}async function restartGomokuGame(){const _0x37dff6=_0x2cf6d4;confirm(_0x37dff6(0x6e1))&&(localStorage[_0x37dff6(0x1c95)](_0x37dff6(0x1fc5)),await initGomokuGame(),showToast(_0x37dff6(0x1089),_0x37dff6(0xb27)));}async function undoGomokuMove(){const _0x3df3fa=_0x2cf6d4;if(!gomokuGameState['gameActive']){showToast(_0x3df3fa(0x158b),'warning');return;}if(gomokuGameState[_0x3df3fa(0x24f4)][_0x3df3fa(0xcbf)]>=0x2){for(let _0x3beed9=0x0;_0x3beed9<0x2;_0x3beed9++){const _0x2f0796=gomokuGameState[_0x3df3fa(0x24f4)]['pop']();_0x2f0796&&(gomokuGameState[_0x3df3fa(0x2401)][_0x2f0796[_0x3df3fa(0x1f44)]][_0x2f0796['col']]=null);}gomokuGameState['currentPlayer']='user',updateBoardUI(),updateGomokuUI(),addGameChatMessage(_0x3df3fa(0x212),_0x3df3fa(0x1bb2)),currentChatCharacter&&(await recordCrossAppEvent(currentChatCharacter['id'],'game',_0x3df3fa(0x99c),{'id':'undo_'+Date['now'](),'type':'game_undo','gameName':'五子棋','content':_0x3df3fa(0xf37)+currentChatCharacter[_0x3df3fa(0x222f)]+_0x3df3fa(0x1082),'moveCount':gomokuGameState[_0x3df3fa(0x24f4)][_0x3df3fa(0xcbf)],'timestamp':Date['now']()}),addGameChatMessage('ai',_0x3df3fa(0xc5f),!![]));}else showToast('无法悔棋，棋盘上棋子不足',_0x3df3fa(0x13bb));}async function surrenderGomokuGame(){const _0x14f060=_0x2cf6d4;if(!gomokuGameState[_0x14f060(0x938)]){showToast(_0x14f060(0x191),'warning');return;}confirm(_0x14f060(0x76f))&&(addGameChatMessage(_0x14f060(0x212),_0x14f060(0x19d1)),currentChatCharacter&&(await recordCrossAppEvent(currentChatCharacter['id'],_0x14f060(0xe67),_0x14f060(0x1d95),{'id':_0x14f060(0xc15)+Date[_0x14f060(0x18e0)](),'type':_0x14f060(0x2144),'gameName':_0x14f060(0x925),'content':'用户在五子棋游戏中主动认输，'+currentChatCharacter[_0x14f060(0x222f)]+'获胜','result':_0x14f060(0x28d),'moveCount':gomokuGameState[_0x14f060(0x24f4)][_0x14f060(0xcbf)],'timestamp':Date[_0x14f060(0x18e0)]()}),addGameChatMessage('ai',_0x14f060(0x2347),!![])),setTimeout(()=>{endGame('ai');},0x5dc));}async function startNextGomokuGame(){const _0x34ecd9=_0x2cf6d4;if(gomokuGameState[_0x34ecd9(0x938)]){if(!confirm(_0x34ecd9(0x6a2)))return;}localStorage[_0x34ecd9(0x1c95)](_0x34ecd9(0x1fc5)),await initGomokuGame(),showToast('新的一局开始了！',_0x34ecd9(0xb27));}async function summarizeGameSession(){const _0x5eb6ba=_0x2cf6d4;if(!currentChatCharacter||!gomokuGameState[_0x5eb6ba(0x12fc)])return;try{const _0x2cbe28=gomokuGameState[_0x5eb6ba(0x12fc)][_0x5eb6ba(0x513)],_0x266ca7=gomokuGameState[_0x5eb6ba(0x12fc)][_0x5eb6ba(0x2121)],_0x177f2a=_0x2cbe28[_0x2cbe28['length']-0x1];let _0x4cb491=_0x5eb6ba(0x22b3),_0x2be00e=_0x5eb6ba(0xbf6);if(_0x177f2a&&_0x177f2a[_0x5eb6ba(0x23df)]===_0x5eb6ba(0x20d7)){_0x4cb491=_0x177f2a[_0x5eb6ba(0x4f2)][_0x5eb6ba(0xb91)];if(_0x4cb491===_0x5eb6ba(0x23b2))_0x2be00e='用户获胜';else _0x4cb491==='ai'?_0x2be00e=currentChatCharacter[_0x5eb6ba(0x222f)]+'获胜':_0x2be00e='平局';}try{const _0x2f06f1=Math['round']((Date[_0x5eb6ba(0x18e0)]()-gomokuGameState[_0x5eb6ba(0x81d)])/0x3e8/0x3c),_0xb99904=_0x266ca7[_0x5eb6ba(0xcbf)]>0x0?_0x5eb6ba(0x124c)+_0x266ca7['length']+'条消息，'+(_0x266ca7[_0x5eb6ba(0xcbf)]>0x5?_0x5eb6ba(0x1541):_0x5eb6ba(0x180c)):'专心下棋，没怎么聊天',_0x4fe975='你是'+currentChatCharacter[_0x5eb6ba(0x222f)]+_0x5eb6ba(0x4ea)+_0x2be00e+_0x5eb6ba(0x220e)+_0x2f06f1+_0x5eb6ba(0x21ee)+gomokuGameState[_0x5eb6ba(0x24f4)]['length']+_0x5eb6ba(0x40f)+_0xb99904+_0x5eb6ba(0x630)+currentChatCharacter[_0x5eb6ba(0x222f)]+_0x5eb6ba(0x359),_0x5e8ac6=await callChatAPI(_0x4fe975,currentChatCharacter);let _0x599a6c='';if(Array['isArray'](_0x5e8ac6)&&_0x5e8ac6['length']>0x0)_0x599a6c=_0x5e8ac6[0x0][_0x5eb6ba(0x1424)]();else typeof _0x5e8ac6==='string'&&(_0x599a6c=_0x5e8ac6['trim']());!_0x599a6c&&(_0x599a6c=_0x4cb491==='user'?'用户在五子棋中击败了'+currentChatCharacter[_0x5eb6ba(0x222f)]+'，'+(_0x266ca7['length']>0x0?_0x5eb6ba(0x1c1):_0x5eb6ba(0x1cd)):_0x4cb491==='ai'?currentChatCharacter['name']+_0x5eb6ba(0x3d4)+(_0x266ca7[_0x5eb6ba(0xcbf)]>0x0?_0x5eb6ba(0x1752):_0x5eb6ba(0x1a32)):currentChatCharacter[_0x5eb6ba(0x222f)]+_0x5eb6ba(0x1475)+(_0x266ca7[_0x5eb6ba(0xcbf)]>0x0?'边下边聊很有趣':_0x5eb6ba(0x4e4))),console[_0x5eb6ba(0xc0d)](_0x5eb6ba(0x113d),_0x599a6c),await recordCrossAppEvent(currentChatCharacter['id'],_0x5eb6ba(0xe67),_0x5eb6ba(0x2e3),{'id':_0x5eb6ba(0x14df)+Date[_0x5eb6ba(0x18e0)](),'type':_0x5eb6ba(0x1775),'gameName':_0x5eb6ba(0x925),'summary':_0x599a6c,'result':_0x2be00e,'totalMoves':gomokuGameState[_0x5eb6ba(0x24f4)][_0x5eb6ba(0xcbf)],'chatMessages':_0x266ca7[_0x5eb6ba(0xcbf)],'gameDuration':_0x2f06f1,'timestamp':Date[_0x5eb6ba(0x18e0)]()}),await db[_0x5eb6ba(0x222e)][_0x5eb6ba(0xe1)]({'id':'game_memory_'+Date['now'](),'characterId':currentChatCharacter['id'],'fact':_0x599a6c,'importance':0.7,'timestamp':Date[_0x5eb6ba(0x18e0)](),'category':_0x5eb6ba(0x3ba),'contextId':currentChatCharacter['id']});}catch(_0x3b36ac){console['error'](_0x5eb6ba(0x1034),_0x3b36ac);const _0x31d8a8=_0x4cb491==='user'?_0x5eb6ba(0x136c):_0x4cb491==='ai'?currentChatCharacter[_0x5eb6ba(0x222f)]+_0x5eb6ba(0x38b):'五子棋下成了平局';await db[_0x5eb6ba(0x222e)][_0x5eb6ba(0xe1)]({'id':_0x5eb6ba(0x1d35)+Date[_0x5eb6ba(0x18e0)](),'characterId':currentChatCharacter['id'],'fact':_0x31d8a8,'importance':0.7,'timestamp':Date['now'](),'category':'game_interaction','contextId':currentChatCharacter['id']});}console[_0x5eb6ba(0xc0d)](_0x5eb6ba(0x117)),showToast(_0x5eb6ba(0x231b),_0x5eb6ba(0xb27));}catch(_0x122630){console[_0x5eb6ba(0x24ab)]('保存游戏记忆失败:',_0x122630);}}document[_0x2cf6d4(0x167)](_0x2cf6d4(0x7f7),function(){const _0x38b67e=_0x2cf6d4,_0x4f6e4e=document[_0x38b67e(0x566)]('gomoku-chat-input');_0x4f6e4e&&_0x4f6e4e[_0x38b67e(0x167)](_0x38b67e(0x1a17),function(_0x46aac0){const _0x4aefa5=_0x38b67e;_0x46aac0[_0x4aefa5(0x157f)]===_0x4aefa5(0x165c)&&sendGameChatMessage();});});let turtleSoupGameState={'gameActive':![],'gameStartTime':null,'currentStory':null,'currentAnswer':null,'questionCount':0x0,'gameTimer':null,'gameSession':null,'dmPersonality':_0x2cf6d4(0x1fac),'gameMode':'single'};const turtleSoupStories=[{'id':0x1,'title':'深夜的电话','story':'一个男人在深夜接到一个电话，听了几句话后就自杀了。','answer':_0x2cf6d4(0x1917),'difficulty':'medium','tags':[_0x2cf6d4(0x200a),'心理','医疗','误解']},{'id':0x2,'title':_0x2cf6d4(0x3e2),'story':_0x2cf6d4(0x1880),'answer':'这个人是邮递员，推门进入时发现屋主已经死了很久，尸体腐烂发臭。','difficulty':'easy','tags':[_0x2cf6d4(0x200a),'日常','发现','死亡']},{'id':0x3,'title':'半夜惊醒','story':_0x2cf6d4(0x659),'answer':_0x2cf6d4(0x48b),'difficulty':'hard','tags':['horror','夫妻','盲人','死亡']},{'id':0x4,'title':_0x2cf6d4(0xdca),'story':_0x2cf6d4(0x14f9),'answer':_0x2cf6d4(0x1941),'difficulty':'easy','tags':['funny','幽默','心理','比喻']},{'id':0x5,'title':_0x2cf6d4(0xa70),'story':_0x2cf6d4(0x6fe),'answer':_0x2cf6d4(0xa24),'difficulty':_0x2cf6d4(0x1e86),'tags':[_0x2cf6d4(0x14e9),'爱情','关心','细节']},{'id':0x6,'title':'神秘的礼物','story':'一个女人收到匿名礼物，是一把钥匙，她用这把钥匙打开了自己家的门。','answer':_0x2cf6d4(0x118f),'difficulty':_0x2cf6d4(0x1e86),'tags':[_0x2cf6d4(0x14e9),'爱情','失忆','温暖']}];async function startTurtleSoupGame(){const _0x59778e=_0x2cf6d4;document[_0x59778e(0x566)](_0x59778e(0x1154))[_0x59778e(0x655)][_0x59778e(0x2526)]!==_0x59778e(0xfe9)&&hideApp(_0x59778e(0x1154)),document['getElementById'](_0x59778e(0xa76))[_0x59778e(0x655)]['display']!==_0x59778e(0xfe9)&&hideApp(_0x59778e(0xa76)),showApp(_0x59778e(0x6fa)),await initTurtleSoupGame();}async function initTurtleSoupGame(){const _0x35affc=_0x2cf6d4,_0xafba50=currentChatCharacter&&currentChatCharacter['isGroup']?_0x35affc(0x22f5):'single';let _0x4012fb={'preferredType':_0x35affc(0x191c),'dmPersonality':'friendly'};try{const _0x50874a=await db[_0x35affc(0x2217)][_0x35affc(0x46a)]('turtleSoupSettings');_0x50874a&&_0x50874a['value']&&(_0x4012fb=_0x50874a['value']);}catch(_0x25db5c){console[_0x35affc(0x24ab)]('加载海龟汤设置失败:',_0x25db5c);}let _0x4fd72d;try{console[_0x35affc(0xc0d)](_0x35affc(0xf33)),_0x4fd72d=await generateTurtleSoupStoryByDM(_0x4012fb[_0x35affc(0x10a0)]);}catch(_0xa95694){console['error'](_0x35affc(0x19b8),_0xa95694);let _0x2b3107=turtleSoupStories;_0x4012fb[_0x35affc(0x10a0)]!==_0x35affc(0x191c)&&(_0x2b3107=turtleSoupStories['filter'](_0x161bac=>_0x161bac[_0x35affc(0x13b9)]&&_0x161bac[_0x35affc(0x13b9)][_0x35affc(0x23ec)](_0x4012fb[_0x35affc(0x10a0)])),_0x2b3107[_0x35affc(0xcbf)]===0x0&&(_0x2b3107=turtleSoupStories)),_0x4fd72d=_0x2b3107[Math[_0x35affc(0x1dac)](Math[_0x35affc(0x191c)]()*_0x2b3107[_0x35affc(0xcbf)])];}turtleSoupGameState={'gameActive':!![],'gameStartTime':Date['now'](),'currentStory':_0x4fd72d,'currentAnswer':_0x4fd72d[_0x35affc(0x24a6)],'questionCount':0x0,'gameTimer':null,'gameMode':_0xafba50,'dmPersonality':_0x4012fb[_0x35affc(0xd0d)],'gameSession':{'gameId':'turtle_soup_'+Date[_0x35affc(0x18e0)](),'players':_0xafba50===_0x35affc(0x22f5)?['user',...Object[_0x35affc(0x16c7)](currentChatCharacter[_0x35affc(0xcaa)]||{})]:[_0x35affc(0x23b2),currentChatCharacter['id']],'storyId':_0x4fd72d['id'],'chatHistory':[],'gameEvents':[{'type':_0x35affc(0x1414),'timestamp':Date[_0x35affc(0x18e0)](),'player':_0x35affc(0x212),'data':{'gameName':'海龟汤','storyTitle':_0x4fd72d['title'],'gameMode':_0xafba50}}]}},updateTurtleSoupUI(),startTurtleSoupTimer();const _0x4b4a53=document[_0x35affc(0x566)]('turtle-soup-chat-messages');_0x4b4a53[_0x35affc(0xc02)]='',setTimeout(()=>{const _0xdff95d=_0x35affc;showDMMessage(_0xdff95d(0x1e0e));},0x1f4),setTimeout(()=>{showDMMessage('规则很简单：我会给出一个看似不合理的情景，你们通过提问来推理出真相。');},0x5dc),setTimeout(()=>{showDMMessage('记住，你们只能问是/否问题，我只会回答\x27是\x27、\x27否\x27或\x27无关\x27。');},0x9c4),setTimeout(()=>{const _0x12cf61=_0x35affc;showDMMessage(_0x12cf61(0x40e));},0xdac),setTimeout(()=>{presentStory(_0x4fd72d);},0x1194);}function presentStory(_0x21b4da){const _0x7df3cf=_0x2cf6d4;console[_0x7df3cf(0xc0d)](_0x7df3cf(0x13f7),_0x21b4da);const _0x2e20d1=document['getElementById']('turtle-soup-story-content');if(!_0x2e20d1){console[_0x7df3cf(0x24ab)](_0x7df3cf(0x1189));return;}if(!_0x21b4da||!_0x21b4da[_0x7df3cf(0xa7f)]){console[_0x7df3cf(0x24ab)]('🎮\x20故事数据无效:',_0x21b4da),_0x2e20d1[_0x7df3cf(0x21dc)]=_0x7df3cf(0x10d3);return;}_0x2e20d1[_0x7df3cf(0x21dc)]=_0x21b4da['story'],console[_0x7df3cf(0xc0d)](_0x7df3cf(0x226c),_0x21b4da['story'][_0x7df3cf(0x4b2)](0x0,0x32)+_0x7df3cf(0x12da)),setTimeout(()=>{const _0x135c54=_0x7df3cf;showDMMessage(_0x135c54(0x1ffe)+_0x21b4da[_0x135c54(0x1c18)]+'\x22');},0x1f4),setTimeout(()=>{const _0x5afe34=_0x7df3cf;showDMMessage(_0x5afe34(0x93b));},0x5dc);}function showDMMessage(_0x1a39ec,_0x3d29ba=!![]){const _0x3a79a5=_0x2cf6d4,_0x3add78=document[_0x3a79a5(0x566)]('turtle-soup-dm-message');_0x3add78[_0x3a79a5(0x21dc)]=_0x1a39ec;if(_0x3d29ba&&turtleSoupGameState['gameActive']){const _0x388984={'id':_0x3a79a5(0x11c2)+Date['now']()+'_'+Math['random']()[_0x3a79a5(0x9a3)](0x24)[_0x3a79a5(0x18cf)](0x2,0x9),'sender':'dm','content':_0x1a39ec,'timestamp':Date[_0x3a79a5(0x18e0)](),'isGameMessage':!![],'gameName':_0x3a79a5(0x2bc),'visibleToCharacters':![]};turtleSoupGameState['gameSession'][_0x3a79a5(0x2121)][_0x3a79a5(0x6ee)](_0x388984);}}function addTurtleSoupChatMessage(_0x2e8682,_0x1e64b8,_0x29ff67=![]){const _0x37b3c3=_0x2cf6d4,_0x46429f=document[_0x37b3c3(0x566)](_0x37b3c3(0x132b)),_0xd7390a=document[_0x37b3c3(0x1ad8)]('div');_0x2e8682===_0x37b3c3(0x23b2)?(_0xd7390a['className']=_0x37b3c3(0x14ef),console[_0x37b3c3(0xc0d)](_0x37b3c3(0x241b),_0x1e64b8[_0x37b3c3(0x4b2)](0x0,0x1e))):(_0xd7390a[_0x37b3c3(0x221)]='game-chat-message\x20character-message',console[_0x37b3c3(0xc0d)](_0x37b3c3(0x1960),_0x1e64b8[_0x37b3c3(0x4b2)](0x0,0x1e)));const _0x1c6caa=document[_0x37b3c3(0x1ad8)](_0x37b3c3(0x526));_0x1c6caa[_0x37b3c3(0x221)]=_0x37b3c3(0x138e);if(_0x2e8682===_0x37b3c3(0x23b2))_0x1c6caa[_0x37b3c3(0x21dc)]='我';else{const _0x4d3323=currentChatCharacter;_0x1c6caa[_0x37b3c3(0x21dc)]=_0x4d3323?_0x4d3323[_0x37b3c3(0x222f)]:'角色';}const _0x504e21=document['createElement'](_0x37b3c3(0x526));_0x504e21['className']='game-chat-bubble',_0x504e21['textContent']=_0x1e64b8,_0xd7390a[_0x37b3c3(0x1925)](_0x1c6caa),_0xd7390a['appendChild'](_0x504e21),_0x46429f[_0x37b3c3(0x1925)](_0xd7390a),_0x46429f['scrollTop']=_0x46429f[_0x37b3c3(0x14c8)],console[_0x37b3c3(0xc0d)]('🎮\x20添加消息:\x20'+_0x2e8682+_0x37b3c3(0x14e4)+_0x1e64b8['substring'](0x0,0x32)+'...');const _0x515b3e={'id':'chat_'+Date[_0x37b3c3(0x18e0)]()+'_'+Math[_0x37b3c3(0x191c)]()['toString'](0x24)[_0x37b3c3(0x18cf)](0x2,0x9),'sender':_0x2e8682,'content':_0x1e64b8,'timestamp':Date[_0x37b3c3(0x18e0)](),'isGameMessage':!![],'gameName':_0x37b3c3(0x2bc)};turtleSoupGameState[_0x37b3c3(0x12fc)]['chatHistory'][_0x37b3c3(0x6ee)](_0x515b3e),_0x29ff67&&currentChatCharacter&&recordGameChat(currentChatCharacter['id'],_0x2e8682,_0x1e64b8,{'gameName':'海龟汤','gameState':_0x37b3c3(0x171e)});}function showCharacterTypingIndicator(){const _0x12a433=_0x2cf6d4,_0x236b54=document[_0x12a433(0x566)](_0x12a433(0x132b)),_0x55e5fe=_0x236b54[_0x12a433(0x15b8)]('.character-typing-indicator');_0x55e5fe&&_0x55e5fe[_0x12a433(0x128)]();const _0x47c11f=document[_0x12a433(0x1ad8)](_0x12a433(0x526));_0x47c11f[_0x12a433(0x221)]=_0x12a433(0xde),_0x47c11f['id']=_0x12a433(0xde);const _0x346eff=document[_0x12a433(0x1ad8)](_0x12a433(0x526));_0x346eff[_0x12a433(0x221)]='game-chat-message\x20character-message';const _0x6b2a14=document[_0x12a433(0x1ad8)](_0x12a433(0x526));_0x6b2a14['className']='game-chat-sender';const _0x479a64=currentChatCharacter;_0x6b2a14['textContent']=_0x479a64?_0x479a64[_0x12a433(0x222f)]:'角色';const _0x445627=document[_0x12a433(0x1ad8)]('div');_0x445627['className']=_0x12a433(0xc72);const _0x5d7b20=document[_0x12a433(0x1ad8)]('div');_0x5d7b20[_0x12a433(0x221)]=_0x12a433(0x6cf);for(let _0x21020c=0x0;_0x21020c<0x3;_0x21020c++){const _0x50ddc9=document['createElement'](_0x12a433(0x526));_0x50ddc9[_0x12a433(0x221)]=_0x12a433(0xd0f),_0x5d7b20['appendChild'](_0x50ddc9);}_0x445627[_0x12a433(0x1925)](_0x5d7b20),_0x346eff['appendChild'](_0x6b2a14),_0x346eff[_0x12a433(0x1925)](_0x445627),_0x47c11f['appendChild'](_0x346eff),_0x236b54[_0x12a433(0x1925)](_0x47c11f),_0x236b54[_0x12a433(0x5e5)]=_0x236b54[_0x12a433(0x14c8)],console['log']('🎮\x20显示角色输入指示器');}function hideCharacterTypingIndicator(){const _0x16080b=_0x2cf6d4,_0x42ffbc=document['getElementById']('character-typing-indicator');_0x42ffbc&&(_0x42ffbc[_0x16080b(0x128)](),console[_0x16080b(0xc0d)](_0x16080b(0x1193)));}async function sendTurtleSoupQuestion(){const _0x94de87=_0x2cf6d4,_0x55a82a=document['getElementById'](_0x94de87(0x67d)),_0x334a83=_0x55a82a[_0x94de87(0xc34)][_0x94de87(0x1424)]();if(!_0x334a83)return;if(!turtleSoupGameState[_0x94de87(0x938)]){showToast(_0x94de87(0x191),_0x94de87(0x13bb));return;}addTurtleSoupChatMessage(_0x94de87(0x23b2),_0x334a83,!![]),_0x55a82a[_0x94de87(0xc34)]='',setTimeout(()=>{const _0x314aac=_0x94de87;showCharacterTypingIndicator(),setTimeout(async()=>{const _0x3ea90e=_0x3a81;try{await generateCharacterTurtleSoupResponse(_0x334a83);}catch(_0x2c5ecb){console[_0x3ea90e(0x24ab)](_0x3ea90e(0xb8a),_0x2c5ecb),hideCharacterTypingIndicator();const _0x34d5e1=[_0x3ea90e(0x1781),'这个线索很有意思',_0x3ea90e(0x2360),_0x3ea90e(0x209f)],_0x689e8c=_0x34d5e1[Math['floor'](Math[_0x3ea90e(0x191c)]()*_0x34d5e1['length'])];addTurtleSoupChatMessage(currentChatCharacter['id'],_0x689e8c,!![]);}},0x5dc+Math[_0x314aac(0x191c)]()*0x7d0);},0x1f4);}async function finishSpeakingAndTriggerDM(){const _0x1bbaaa=_0x2cf6d4;if(!turtleSoupGameState[_0x1bbaaa(0x938)]){showToast('游戏已结束',_0x1bbaaa(0x13bb));return;}const _0x4fdb9f=turtleSoupGameState[_0x1bbaaa(0x12fc)]['chatHistory'][_0x1bbaaa(0x136)](-0xa)[_0x1bbaaa(0x803)](_0xbf82f8=>_0xbf82f8[_0x1bbaaa(0xf75)]===_0x1bbaaa(0x23b2)||_0xbf82f8[_0x1bbaaa(0xf75)]!=='dm'&&_0xbf82f8[_0x1bbaaa(0xf75)]!==_0x1bbaaa(0x212))[_0x1bbaaa(0xf6d)](_0x10136c=>_0x10136c[_0x1bbaaa(0xf75)]+':\x20'+_0x10136c[_0x1bbaaa(0x1423)])[_0x1bbaaa(0x140c)]('\x0a');if(!_0x4fdb9f[_0x1bbaaa(0x1424)]()){showToast(_0x1bbaaa(0xc73),_0x1bbaaa(0x13bb));return;}showDMMessage(_0x1bbaaa(0x246e)),setTimeout(async()=>{const _0x25b828=_0x1bbaaa;try{const _0x23bf97=await generateDMResponseToDiscussion(_0x4fdb9f);showDMMessage(_0x23bf97);const _0x2a6f27=_0x4fdb9f['includes']('?')||_0x4fdb9f[_0x25b828(0x23ec)]('？')||_0x4fdb9f[_0x25b828(0x23ec)]('是否')||_0x4fdb9f['includes']('是不是')||_0x4fdb9f['includes'](_0x25b828(0x1772))||_0x4fdb9f[_0x25b828(0x23ec)](_0x25b828(0x22dc));_0x2a6f27&&(turtleSoupGameState[_0x25b828(0x2208)]++,updateTurtleSoupUI());}catch(_0x4136ce){console['error']('DM回应生成失败:',_0x4136ce);const _0x36cf3d=['这个问题很有趣，让我想想...',_0x25b828(0x4b5),_0x25b828(0x1930),_0x25b828(0x1f38),_0x25b828(0x2011)],_0x348dc0=_0x36cf3d[Math[_0x25b828(0x1dac)](Math[_0x25b828(0x191c)]()*_0x36cf3d[_0x25b828(0xcbf)])];showDMMessage(_0x348dc0);}},0x1f4+Math['random']()*0x3e8);}async function generateDMResponseToDiscussion(_0x4bb10e){const _0x440468=_0x2cf6d4,_0xb81093=turtleSoupGameState[_0x440468(0x23c3)],_0x2fc421=turtleSoupGameState[_0x440468(0x93a)],_0x4cccbe=turtleSoupGameState['questionCount'],_0x11861d=turtleSoupGameState['gameSession'][_0x440468(0x2121)][_0x440468(0x136)](-0xf)[_0x440468(0xf6d)](_0x541061=>_0x541061['sender']+':\x20'+_0x541061[_0x440468(0x1423)])[_0x440468(0x140c)]('\x0a'),_0x10c05a=turtleSoupGameState['dmPersonality']||_0x440468(0x1fac);let _0xac4ee6='';switch(_0x10c05a){case _0x440468(0x1fac):_0xac4ee6=_0x440468(0x357);break;case _0x440468(0x209b):_0xac4ee6=_0x440468(0x19ce);break;case _0x440468(0x1926):_0xac4ee6=_0x440468(0x1031);break;default:_0xac4ee6=_0x440468(0x1bc9);}const _0x27aa07='你是海龟汤游戏的专业主持人(DM)。'+_0xac4ee6+_0x440468(0x364)+_0xb81093[_0x440468(0xa7f)]+_0x440468(0xe6)+_0x2fc421+_0x440468(0xc17)+_0x4cccbe+'\x0a-\x20游戏历史：\x0a'+_0x11861d+'\x0a\x0a【这轮用户和角色的讨论内容】：\x0a'+_0x4bb10e+_0x440468(0x1958);try{const _0x32f204=await callTurtleSoupDMAPI(_0x27aa07);let _0xa98f09='';if(Array[_0x440468(0x1bcc)](_0x32f204)&&_0x32f204['length']>0x0)_0xa98f09=_0x32f204[0x0][_0x440468(0x1424)]();else typeof _0x32f204===_0x440468(0xb97)&&(_0xa98f09=_0x32f204[_0x440468(0x1424)]());(_0xa98f09[_0x440468(0x1cab)](_0x440468(0x1ea9))||_0xa98f09['startsWith'](_0x440468(0x1b9d)))&&(_0xa98f09=_0xa98f09['replace'](/```json\s*|\s*```/g,'')[_0x440468(0x1424)]());if(_0xa98f09[_0x440468(0x1cab)]('[')&&_0xa98f09[_0x440468(0xd7e)](']'))try{const _0x20a40a=JSON[_0x440468(0x168e)](_0xa98f09);Array['isArray'](_0x20a40a)&&_0x20a40a['length']>0x0&&(_0xa98f09=_0x20a40a[0x0][_0x440468(0x9a3)]()[_0x440468(0x1424)]());}catch(_0x219293){_0xa98f09=_0xa98f09[_0x440468(0x882)](/^\[|\]$/g,'')[_0x440468(0x1424)](),_0xa98f09[_0x440468(0x1cab)]('\x22')&&_0xa98f09[_0x440468(0xd7e)]('\x22')&&(_0xa98f09=_0xa98f09[_0x440468(0x136)](0x1,-0x1));}if(!_0xa98f09||_0xa98f09[_0x440468(0xcbf)]>0x64)throw new Error(_0x440468(0x2153));return _0xa98f09;}catch(_0x15c78e){console[_0x440468(0x24ab)](_0x440468(0x162c),_0x15c78e);throw _0x15c78e;}}async function generateAIDMAnswer(_0x509fa6){const _0x422579=_0x2cf6d4,_0x49cc4e=turtleSoupGameState['currentStory'],_0x24187c=turtleSoupGameState[_0x422579(0x93a)],_0x2270f5=turtleSoupGameState[_0x422579(0x2208)],_0x246ff9=turtleSoupGameState[_0x422579(0x12fc)][_0x422579(0x2121)][_0x422579(0x136)](-0xa)[_0x422579(0xf6d)](_0xfb6600=>_0xfb6600[_0x422579(0xf75)]+':\x20'+_0xfb6600[_0x422579(0x1423)])[_0x422579(0x140c)]('\x0a'),_0x223fe0=turtleSoupGameState[_0x422579(0xd0d)]||'friendly';let _0x42de50='';switch(_0x223fe0){case _0x422579(0x1fac):_0x42de50=_0x422579(0x357);break;case'mysterious':_0x42de50=_0x422579(0x19ce);break;case'humorous':_0x42de50=_0x422579(0x1031);break;default:_0x42de50='你是一个专业的DM，保持中性的态度。';}const _0x9b4c56='你是海龟汤游戏的专业主持人(DM)。'+_0x42de50+'\x0a\x0a【当前汤面】：'+_0x49cc4e[_0x422579(0xa7f)]+'\x0a【汤底真相】：'+_0x24187c+_0x422579(0x1766)+_0x2270f5+'\x0a-\x20最近对话：\x0a'+_0x246ff9+_0x422579(0xd22)+_0x509fa6+_0x422579(0x1dc8);try{const _0x3ff565=await callTurtleSoupDMAPI(_0x9b4c56);let _0x229dc1='';if(Array[_0x422579(0x1bcc)](_0x3ff565)&&_0x3ff565[_0x422579(0xcbf)]>0x0)_0x229dc1=_0x3ff565[0x0][_0x422579(0x1424)]();else typeof _0x3ff565==='string'&&(_0x229dc1=_0x3ff565[_0x422579(0x1424)]());(_0x229dc1[_0x422579(0x1cab)]('```json')||_0x229dc1[_0x422579(0x1cab)](_0x422579(0x1b9d)))&&(_0x229dc1=_0x229dc1['replace'](/```json\s*|\s*```/g,'')[_0x422579(0x1424)]());if(_0x229dc1[_0x422579(0x1cab)]('[')&&_0x229dc1[_0x422579(0xd7e)](']'))try{const _0x72cad4=JSON['parse'](_0x229dc1);Array[_0x422579(0x1bcc)](_0x72cad4)&&_0x72cad4['length']>0x0&&(_0x229dc1=_0x72cad4[0x0]['toString']()['trim']());}catch(_0x1d5e02){_0x229dc1=_0x229dc1['replace'](/^\[|\]$/g,'')['trim'](),_0x229dc1['startsWith']('\x22')&&_0x229dc1[_0x422579(0xd7e)]('\x22')&&(_0x229dc1=_0x229dc1['slice'](0x1,-0x1));}if(!_0x229dc1||_0x229dc1[_0x422579(0xcbf)]>0x32)throw new Error(_0x422579(0x13a6));return _0x229dc1;}catch(_0x4fa40a){console[_0x422579(0x24ab)](_0x422579(0x868),_0x4fa40a);throw _0x4fa40a;}}async function callTurtleSoupDMAPI(_0x32f4d9){const _0x1e1b4c=_0x2cf6d4;console[_0x1e1b4c(0xc0d)](_0x1e1b4c(0x16cd),apiSettings);if(!apiSettings[_0x1e1b4c(0x157f)]||!apiSettings['base'])throw new Error(_0x1e1b4c(0x24aa));const _0x31907f={'id':_0x1e1b4c(0x1ba2),'name':_0x1e1b4c(0x5cd),'description':_0x1e1b4c(0x24ac),'personality':_0x1e1b4c(0xb8d),'scenario':'你是一个专业的海龟汤游戏主持人，负责主持推理游戏。','firstMessage':'欢迎来到海龟汤推理游戏！','avatar':'🎭'};console[_0x1e1b4c(0xc0d)](_0x1e1b4c(0x1326),_0x32f4d9[_0x1e1b4c(0xcbf)]);const _0x309f69=await callChatAPI(_0x32f4d9,_0x31907f);return console['log']('🎭\x20callChatAPI返回结果:',_0x309f69),_0x309f69;}async function generateTurtleSoupStoryByDM(_0x5710d1=_0x2cf6d4(0x191c)){const _0x297989=_0x2cf6d4;let _0x2be36b='';switch(_0x5710d1){case _0x297989(0x200a):_0x2be36b=_0x297989(0x1ed2);break;case _0x297989(0x2557):_0x2be36b=_0x297989(0x1b5b);break;case _0x297989(0x2357):_0x2be36b=_0x297989(0x18e7);break;case _0x297989(0x14e9):_0x2be36b='浪漫情感类型，以爱情为主题的推理故事';break;default:_0x2be36b='任意类型，可以是经典、恐怖、搞笑或浪漫中的任何一种';}const _0xef9e9=_0x297989(0x10b)+_0x2be36b+_0x297989(0xae4);try{const _0x470378=await callTurtleSoupDMAPI(_0xef9e9);let _0x5babbe='';if(Array[_0x297989(0x1bcc)](_0x470378)&&_0x470378['length']>0x0)_0x5babbe=_0x470378[0x0][_0x297989(0x1424)]();else typeof _0x470378===_0x297989(0xb97)&&(_0x5babbe=_0x470378[_0x297989(0x1424)]());console[_0x297989(0xc0d)](_0x297989(0x95d),_0x5babbe);let _0x4af144;try{_0x5babbe=_0x5babbe[_0x297989(0x882)](/```json\n?/g,'')[_0x297989(0x882)](/```\n?/g,''),console['log']('🎭\x20清理后的文本:',_0x5babbe);const _0x213105=JSON['parse'](_0x5babbe);console[_0x297989(0xc0d)]('🎭\x20解析后的数据:',_0x213105);if(Array[_0x297989(0x1bcc)](_0x213105)&&_0x213105[_0x297989(0xcbf)]>0x0)_0x4af144=_0x213105[0x0],console[_0x297989(0xc0d)](_0x297989(0x1678),_0x4af144);else{if(typeof _0x213105===_0x297989(0x3c4)&&_0x213105!==null)_0x4af144=_0x213105;else throw new Error(_0x297989(0xe7b));}}catch(_0x48ef81){console[_0x297989(0x24ab)](_0x297989(0x9c5),_0x48ef81),console[_0x297989(0x24ab)](_0x297989(0xfb2),_0x5babbe);throw new Error('故事格式解析失败');}console[_0x297989(0xc0d)](_0x297989(0x1777),{'title':_0x4af144[_0x297989(0x1c18)],'story':_0x4af144[_0x297989(0xa7f)],'answer':_0x4af144['answer']});if(!_0x4af144['title']||!_0x4af144[_0x297989(0xa7f)]||!_0x4af144['answer']){console[_0x297989(0x24ab)]('🎭\x20故事数据不完整:',_0x4af144);throw new Error(_0x297989(0xa5e));}return _0x4af144['id']=_0x297989(0x1f74)+Date[_0x297989(0x18e0)](),_0x4af144[_0x297989(0x186d)]=_0x4af144[_0x297989(0x186d)]||_0x297989(0x1e86),_0x4af144['tags']=_0x4af144[_0x297989(0x13b9)]||[_0x5710d1],console[_0x297989(0xc0d)](_0x297989(0x947),_0x4af144[_0x297989(0x1c18)]),_0x4af144;}catch(_0x4706c8){console[_0x297989(0x24ab)]('DM生成故事失败:',_0x4706c8),console[_0x297989(0xc0d)](_0x297989(0xe2e));const _0x1dd33b=generateBackupTurtleSoupStory(_0x5710d1);return _0x1dd33b;}}function generateBackupTurtleSoupStory(_0x2083f1=_0x2cf6d4(0x191c)){const _0x2de5dc=_0x2cf6d4,_0x19ca19={'classic':{'title':'深夜的电话','story':_0x2de5dc(0x1a0),'answer':'他是医生，接到急救电话后出诊，但在路上心脏病发作去世了。','difficulty':'medium','tags':['classic']},'horror':{'title':_0x2de5dc(0xad),'story':_0x2de5dc(0x1091),'answer':_0x2de5dc(0x1dc2),'difficulty':_0x2de5dc(0x202),'tags':[_0x2de5dc(0x2557)]},'funny':{'title':_0x2de5dc(0x159f),'story':_0x2de5dc(0x1348),'answer':'这是美食评论家在拍照写评论，虽然不吃但会带来很多客人。','difficulty':'easy','tags':[_0x2de5dc(0x2357)]},'romantic':{'title':_0x2de5dc(0x1990),'story':_0x2de5dc(0x23c2),'answer':_0x2de5dc(0xd57),'difficulty':_0x2de5dc(0x1e86),'tags':[_0x2de5dc(0x14e9)]}};let _0x28e96c;if(_0x2083f1!=='random'&&_0x19ca19[_0x2083f1])_0x28e96c=_0x19ca19[_0x2083f1];else{const _0x5dfe74=Object[_0x2de5dc(0x16c7)](_0x19ca19),_0x22b31d=_0x5dfe74[Math[_0x2de5dc(0x1dac)](Math[_0x2de5dc(0x191c)]()*_0x5dfe74['length'])];_0x28e96c=_0x19ca19[_0x22b31d];}return _0x28e96c['id']=_0x2de5dc(0x1f90)+Date['now'](),console[_0x2de5dc(0xc0d)](_0x2de5dc(0x1b95),_0x28e96c[_0x2de5dc(0x1c18)]),_0x28e96c;}async function generateCharacterTurtleSoupResponse(_0x8c157c){const _0xefa869=_0x2cf6d4;if(!turtleSoupGameState['gameActive'])return;const _0x5e072f=currentChatCharacter;if(!_0x5e072f)return;const _0x5b0059=turtleSoupGameState[_0xefa869(0x23c3)],_0x15437c=turtleSoupGameState[_0xefa869(0x2208)],_0xbe5051=turtleSoupGameState[_0xefa869(0x12fc)][_0xefa869(0x2121)]['slice'](-0x8)['filter'](_0x28e5b6=>{const _0x4a64eb=_0xefa869;return _0x28e5b6[_0x4a64eb(0xf75)]!=='dm'&&_0x28e5b6['sender']!==_0x4a64eb(0x212)&&_0x28e5b6[_0x4a64eb(0x9e1)]!==![];})[_0xefa869(0xf6d)](_0x69988b=>(_0x69988b['sender']==='user'?'用户':_0x69988b[_0xefa869(0xf75)])+':\x20'+_0x69988b[_0xefa869(0x1423)])[_0xefa869(0x140c)]('\x0a'),_0x1235dc='你是'+_0x5e072f[_0xefa869(0x222f)]+'，'+_0x5e072f[_0xefa869(0x1f8f)]+'\x0a\x0a现在你在和用户一起玩海龟汤推理游戏。你和用户一样，都不知道答案，需要通过推理来解谜。\x0a\x0a【汤面】：'+_0x5b0059[_0xefa869(0xa7f)]+_0xefa869(0x1c79)+_0x15437c+_0xefa869(0x17f6)+(_0xbe5051||'暂无讨论记录')+_0xefa869(0x249)+_0x8c157c+_0xefa869(0xfa3)+_0x5e072f[_0xefa869(0x222f)]+_0xefa869(0x100e)+_0x5e072f[_0xefa869(0x222f)]+_0xefa869(0x1369);try{const _0xd7cad7=await callChatAPI(_0x1235dc,_0x5e072f);let _0x54e226='';if(Array[_0xefa869(0x1bcc)](_0xd7cad7)&&_0xd7cad7[_0xefa869(0xcbf)]>0x0)_0x54e226=_0xd7cad7[0x0][_0xefa869(0x1424)]();else typeof _0xd7cad7===_0xefa869(0xb97)&&(_0x54e226=_0xd7cad7[_0xefa869(0x1424)]());if(_0x54e226&&_0x54e226[_0xefa869(0xcbf)]>0x0){_0x54e226=_0x54e226['replace'](/```json\s*|\s*```/g,''),_0x54e226=_0x54e226[_0xefa869(0x882)](/^\[|\]$/g,'');try{const _0x5e2634=JSON[_0xefa869(0x168e)](_0x54e226);typeof _0x5e2634==='object'&&(_0x54e226=_0x5e2634[_0xefa869(0x1423)]||_0x5e2634['message']||_0x5e2634['reply']||_0x5e2634[_0xefa869(0x1e58)]||JSON[_0xefa869(0x7fb)](_0x5e2634));}catch(_0x505d63){}_0x54e226=String(_0x54e226)[_0xefa869(0x882)](/^["']|["']$/g,'')[_0xefa869(0x1424)]();_0x54e226[_0xefa869(0xcbf)]>0x64&&(_0x54e226=_0x54e226[_0xefa869(0x4b2)](0x0,0x61)+'...');if(_0x54e226&&_0x54e226!=='{}'&&_0x54e226!=='[]')hideCharacterTypingIndicator(),addTurtleSoupChatMessage(_0x5e072f['id'],_0x54e226,!![]);else throw new Error(_0xefa869(0x1092));}else throw new Error(_0xefa869(0x13c4));}catch(_0x4c6cec){console[_0xefa869(0x24ab)]('角色回应生成失败:',_0x4c6cec),hideCharacterTypingIndicator();const _0x41d4d0=getPersonalizedBackupResponses(_0x5e072f,_0x8c157c),_0x39dd90=_0x41d4d0[Math[_0xefa869(0x1dac)](Math[_0xefa869(0x191c)]()*_0x41d4d0[_0xefa869(0xcbf)])];addTurtleSoupChatMessage(_0x5e072f['id'],_0x39dd90,!![]);}}function getPersonalizedBackupResponses(_0x315b9a,_0x5a3cfa){const _0x3e3096=_0x2cf6d4,_0x3910ac=[_0x3e3096(0x1d38),'让我想想这个可能性',_0x3e3096(0xdb0),'这个方向值得探索'],_0x3b9b34=(_0x315b9a[_0x3e3096(0x1f8f)]||_0x315b9a[_0x3e3096(0x1c6f)]||'')['toLowerCase']();if(_0x3b9b34[_0x3e3096(0x23ec)]('可爱')||_0x3b9b34[_0x3e3096(0x23ec)]('萌')||_0x3b9b34['includes']('天真'))return[_0x3e3096(0x16c5),_0x3e3096(0xab1),_0x3e3096(0x1070),_0x3e3096(0x1eca)];else{if(_0x3b9b34[_0x3e3096(0x23ec)]('冷静')||_0x3b9b34[_0x3e3096(0x23ec)]('理性')||_0x3b9b34[_0x3e3096(0x23ec)]('聪明'))return[_0x3e3096(0x1b83),_0x3e3096(0x685),'还有其他可能性',_0x3e3096(0x1b97)];else{if(_0x3b9b34[_0x3e3096(0x23ec)]('活泼')||_0x3b9b34[_0x3e3096(0x23ec)]('开朗')||_0x3b9b34[_0x3e3096(0x23ec)]('热情'))return[_0x3e3096(0x2566),_0x3e3096(0x65a),'还有什么线索呢？',_0x3e3096(0x2151)];}}return _0x3910ac;}function generateDMAnswer(_0x332428){const _0x385222=_0x2cf6d4,_0x5b9252=_0x332428[_0x385222(0x1d64)](),_0x33e679=turtleSoupGameState[_0x385222(0x23c3)],_0x2471a1=turtleSoupGameState[_0x385222(0x93a)];if(_0x5b9252[_0x385222(0x23ec)]('死')||_0x5b9252[_0x385222(0x23ec)]('自杀')){if(_0x33e679['id']===0x1)return'是的。';return _0x385222(0x2454);}if(_0x5b9252['includes']('盲')||_0x5b9252['includes'](_0x385222(0x1ed0))){if(_0x33e679['id']===0x1||_0x33e679['id']===0x3)return _0x385222(0x13f9);return _0x385222(0x2454);}if(_0x5b9252['includes']('电话')||_0x5b9252[_0x385222(0x23ec)]('通话')){if(_0x33e679['id']===0x1)return _0x385222(0x19b7);return'无关。';}if(_0x5b9252[_0x385222(0x23ec)]('医院')||_0x5b9252['includes']('医生')){if(_0x33e679['id']===0x1)return _0x385222(0x9fe);return'不是。';}if(_0x5b9252[_0x385222(0x23ec)]('邮递员')||_0x5b9252[_0x385222(0x23ec)]('送信')){if(_0x33e679['id']===0x2)return _0x385222(0x9fe);return'不是。';}if(_0x5b9252[_0x385222(0x23ec)]('尸体')||_0x5b9252['includes']('死人')){if(_0x33e679['id']===0x2||_0x33e679['id']===0x3)return _0x385222(0x13f9);return _0x385222(0x2454);}const _0x30f660=[_0x385222(0x13f9),_0x385222(0x2454),_0x385222(0x752),_0x385222(0x758),'是的，你想对了！'];return _0x30f660[Math[_0x385222(0x1dac)](Math[_0x385222(0x191c)]()*_0x30f660[_0x385222(0xcbf)])];}function getDMComment(_0x518d55,_0x32dd44){const _0x2e9454=_0x2cf6d4;if(_0x32dd44[_0x2e9454(0x23ec)](_0x2e9454(0x9fe))||_0x32dd44[_0x2e9454(0x23ec)]('你想对了'))return _0x2e9454(0x152b);else{if(_0x32dd44===_0x2e9454(0x13f9))return _0x2e9454(0x180a);else return _0x32dd44==='不是。'?_0x2e9454(0xe35):_0x2e9454(0xbe7);}}function updateTurtleSoupUI(){const _0x11c451=_0x2cf6d4,_0x3e5791=document[_0x11c451(0x566)](_0x11c451(0x543));_0x3e5791['textContent']='提问次数:\x20'+turtleSoupGameState[_0x11c451(0x2208)];}function startTurtleSoupTimer(){const _0x400876=_0x2cf6d4,_0x139cde=document[_0x400876(0x566)]('turtle-soup-game-timer');turtleSoupGameState[_0x400876(0x16a9)]=setInterval(()=>{const _0x35734f=_0x400876,_0x41fe37=Date[_0x35734f(0x18e0)]()-turtleSoupGameState[_0x35734f(0x81d)],_0xa90ac3=Math[_0x35734f(0x1dac)](_0x41fe37/0xea60),_0x358890=Math[_0x35734f(0x1dac)](_0x41fe37%0xea60/0x3e8);_0x139cde[_0x35734f(0x21dc)]=_0xa90ac3['toString']()[_0x35734f(0x863)](0x2,'0')+':'+_0x358890[_0x35734f(0x9a3)]()[_0x35734f(0x863)](0x2,'0');},0x3e8);}function requestTurtleSoupHint(){const _0x17c89e=_0x2cf6d4;if(!turtleSoupGameState[_0x17c89e(0x938)]){showToast(_0x17c89e(0x191),_0x17c89e(0x13bb));return;}const _0x1018e7=turtleSoupGameState[_0x17c89e(0x23c3)],_0x7ea13f=[_0x17c89e(0x157c),_0x17c89e(0xa2d),_0x17c89e(0x196e),'思考一下感官方面的问题...'],_0x41110c=_0x7ea13f[Math[_0x17c89e(0x1dac)](Math[_0x17c89e(0x191c)]()*_0x7ea13f['length'])];showDMMessage(_0x17c89e(0x15f4)+_0x41110c);}function giveTurtleSoupAnswer(){const _0x292ca6=_0x2cf6d4;if(!turtleSoupGameState['gameActive']){showToast(_0x292ca6(0x191),_0x292ca6(0x13bb));return;}confirm('确定要公布答案吗？游戏将会结束。')&&endTurtleSoupGame(_0x292ca6(0x10fb));}function endTurtleSoupGame(_0x168f6d){const _0x5e1a5f=_0x2cf6d4;turtleSoupGameState[_0x5e1a5f(0x938)]=![],clearInterval(turtleSoupGameState[_0x5e1a5f(0x16a9)]);const _0x49b2bf=turtleSoupGameState[_0x5e1a5f(0x93a)],_0xf16209=turtleSoupGameState[_0x5e1a5f(0x23c3)];showDMMessage(_0x5e1a5f(0x216e));const _0x290b2c=document['getElementById'](_0x5e1a5f(0x1cae));if(!_0x290b2c){console[_0x5e1a5f(0x24ab)]('🎮\x20找不到汤面显示元素！'),showDMMessage(_0x5e1a5f(0x11f6));return;}_0x290b2c[_0x5e1a5f(0xc02)]='<div\x20style=\x22color:\x20red;\x22>测试：答案即将显示...</div>',console[_0x5e1a5f(0xc0d)]('🎮\x20测试更新完成，当前内容:',_0x290b2c[_0x5e1a5f(0xc02)]),setTimeout(()=>{const _0x544676=_0x5e1a5f;_0x290b2c[_0x544676(0xc02)]=_0x544676(0x14a9);},0x7d0),setTimeout(()=>{const _0x572a27=_0x5e1a5f;_0x290b2c['innerHTML']=_0x572a27(0x1627)+(_0xf16209[_0x572a27(0x1c18)]||_0x572a27(0x13c6))+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';},0xfa0),setTimeout(()=>{const _0x7381be=_0x5e1a5f;_0x290b2c[_0x7381be(0xc02)]=_0x7381be(0x1627)+(_0xf16209['title']||_0x7381be(0x13c6))+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22background:\x20#f8f9fa;\x20padding:\x2015px;\x20border-radius:\x208px;\x20border-left:\x204px\x20solid\x20#28a745;\x20line-height:\x201.6;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22color:\x20#28a745;\x20font-weight:\x20bold;\x20margin-bottom:\x208px;\x22>🎯\x20汤底真相：</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22color:\x20#333;\x20font-size:\x2014px;\x22>'+(_0x49b2bf||'答案加载失败')+_0x7381be(0x92d);},0x1770),setTimeout(()=>{const _0x28abc0=_0x5e1a5f;let _0x547a16='';if(_0x168f6d===_0x28abc0(0x10fb))_0x547a16=_0x28abc0(0x1269);else _0x168f6d===_0x28abc0(0xd66)?_0x547a16=_0x28abc0(0x253e):_0x547a16=_0x28abc0(0x16c8);showDMMessage(_0x547a16);},0x1f40),setTimeout(()=>{const _0x9bbace=_0x5e1a5f;showDMMessage(_0x9bbace(0xf5b));},0x2ee0),turtleSoupGameState[_0x5e1a5f(0x12fc)]['gameEvents']['push']({'type':_0x5e1a5f(0x20d7),'timestamp':Date[_0x5e1a5f(0x18e0)](),'player':_0x5e1a5f(0x212),'data':{'reason':_0x168f6d,'questionCount':turtleSoupGameState[_0x5e1a5f(0x2208)],'gameDuration':Date['now']()-turtleSoupGameState['gameStartTime']}});}async function startNewTurtleSoupGame(){const _0x4d7a7b=_0x2cf6d4;if(turtleSoupGameState[_0x4d7a7b(0x938)]){if(!confirm(_0x4d7a7b(0xf92)))return;}await initTurtleSoupGame(),showToast(_0x4d7a7b(0x9da),_0x4d7a7b(0xb27));}function exitTurtleSoupGame(){const _0x19f244=_0x2cf6d4;turtleSoupGameState['gameActive']?confirm(_0x19f244(0x1620))&&(turtleSoupGameState[_0x19f244(0x938)]=![],clearInterval(turtleSoupGameState[_0x19f244(0x16a9)]),hideApp(_0x19f244(0x6fa)),showApp('api-chat-screen')):(hideApp(_0x19f244(0x6fa)),showApp(_0x19f244(0x1154)));}function showTurtleSoupSettings(){const _0x1aeb58=_0x2cf6d4;console[_0x1aeb58(0xc0d)](_0x1aeb58(0x7ea));const _0x38e8eb=document[_0x1aeb58(0x1ad8)](_0x1aeb58(0x526));_0x38e8eb[_0x1aeb58(0x221)]=_0x1aeb58(0x12a0),_0x38e8eb['innerHTML']=_0x1aeb58(0x377),document[_0x1aeb58(0x172c)][_0x1aeb58(0x1925)](_0x38e8eb),_0x38e8eb[_0x1aeb58(0x655)][_0x1aeb58(0x2526)]=_0x1aeb58(0x1f0b),loadTurtleSoupSettings();}async function saveTurtleSoupSettings(){const _0xc26896=_0x2cf6d4,_0x1d35e2=document[_0xc26896(0x15b8)](_0xc26896(0x411)),_0x470d29=document[_0xc26896(0x15b8)](_0xc26896(0x114));if(!_0x1d35e2||!_0x470d29){showToast(_0xc26896(0x24b5),_0xc26896(0x13bb));return;}const _0x131e9d={'preferredType':_0x1d35e2[_0xc26896(0xc34)],'dmPersonality':_0x470d29[_0xc26896(0xc34)]};try{await db[_0xc26896(0x2217)][_0xc26896(0x53a)]({'key':_0xc26896(0x12e9),'value':_0x131e9d}),turtleSoupGameState['gameActive']&&(turtleSoupGameState[_0xc26896(0xd0d)]=_0x131e9d[_0xc26896(0xd0d)]),showToast(_0xc26896(0x1f21),_0xc26896(0xb27)),document[_0xc26896(0x15b8)](_0xc26896(0x89c))[_0xc26896(0x128)]();}catch(_0x2b70d5){console[_0xc26896(0x24ab)]('保存海龟汤设置失败:',_0x2b70d5),showToast(_0xc26896(0x1bda),_0xc26896(0x24ab));}}async function loadTurtleSoupSettings(){const _0x482573=_0x2cf6d4;try{const _0x29aa7b=await db[_0x482573(0x2217)][_0x482573(0x46a)](_0x482573(0x12e9));if(_0x29aa7b&&_0x29aa7b[_0x482573(0xc34)]){const {preferredType:_0x265a40,dmPersonality:_0x12a2cc}=_0x29aa7b[_0x482573(0xc34)],_0x3f74c7=document[_0x482573(0x15b8)](_0x482573(0x20b7)+_0x265a40+'\x22]');if(_0x3f74c7)_0x3f74c7[_0x482573(0x306)]=!![];const _0x309005=document[_0x482573(0x15b8)](_0x482573(0x3c9)+_0x12a2cc+'\x22]');if(_0x309005)_0x309005[_0x482573(0x306)]=!![];}}catch(_0x3e8cf4){console[_0x482573(0x24ab)]('加载海龟汤设置失败:',_0x3e8cf4);}}document[_0x2cf6d4(0x167)](_0x2cf6d4(0x7f7),function(){const _0x26830c=_0x2cf6d4,_0x221a92=document[_0x26830c(0x566)](_0x26830c(0x67d));_0x221a92&&_0x221a92[_0x26830c(0x167)](_0x26830c(0x1a17),function(_0x32287e){const _0x311cac=_0x26830c;_0x32287e[_0x311cac(0x157f)]==='Enter'&&sendTurtleSoupQuestion();});const _0x1410b0=document['querySelector'](_0x26830c(0x1fd7));_0x1410b0&&_0x1410b0['addEventListener'](_0x26830c(0x1e62),function(_0x184ed0){const _0x220ed5=_0x26830c;_0x184ed0[_0x220ed5(0x4d9)](),console[_0x220ed5(0xc0d)](_0x220ed5(0xf64)),showTurtleSoupSettings();});});async function loadTodayDiary(){const _0x166e4f=_0x2cf6d4;if(!currentChatCharacter)return;const _0x27a7ae=new Date()[_0x166e4f(0xa4b)]()[_0x166e4f(0x633)]('T')[0x0],_0x263f85=currentChatCharacter['id']+'_'+_0x27a7ae;let _0x538133=null;try{_0x538133=await db[_0x166e4f(0x8e3)]['get'](_0x263f85);if(!_0x538133){const _0x130e42='diary_'+currentChatCharacter['id']+'_'+_0x27a7ae,_0x16973d=localStorage[_0x166e4f(0x2250)](_0x130e42);if(_0x16973d){const _0x20a334=cleanDiaryContent(_0x16973d);await db[_0x166e4f(0x8e3)]['add']({'id':_0x263f85,'characterId':currentChatCharacter['id'],'date':_0x27a7ae,'content':_0x20a334,'timestamp':new Date()['getTime'](),'weather':'☀️'}),_0x538133={'content':_0x20a334},localStorage[_0x166e4f(0x1c95)](_0x130e42),console[_0x166e4f(0xc0d)](_0x166e4f(0xd9a));}}}catch(_0x249cd7){console[_0x166e4f(0x24ab)](_0x166e4f(0x1215),_0x249cd7),showToast(_0x166e4f(0x134b),_0x166e4f(0x24ab));return;}const _0x14b0be=document['getElementById']('today-diary-content'),_0x4a3a46=document['getElementById'](_0x166e4f(0x157)),_0x285160=document[_0x166e4f(0x566)](_0x166e4f(0x2126));_0x4a3a46&&(_0x4a3a46[_0x166e4f(0x194e)]=![],_0x4a3a46[_0x166e4f(0xc02)]=_0x166e4f(0x1694),_0x4a3a46[_0x166e4f(0x1c18)]=_0x166e4f(0xfe2));if(_0x538133&&_0x538133[_0x166e4f(0x1423)]){const _0x45a575=createDiaryWithHeader(_0x538133[_0x166e4f(0x1423)],_0x27a7ae);_0x14b0be[_0x166e4f(0xc02)]=_0x45a575,_0x14b0be[_0x166e4f(0x226e)][_0x166e4f(0x128)]('empty');_0x4a3a46&&(_0x4a3a46[_0x166e4f(0x655)][_0x166e4f(0x2526)]=_0x166e4f(0x2d4),_0x4a3a46[_0x166e4f(0x1c18)]=_0x166e4f(0xe39));if(_0x285160)_0x285160[_0x166e4f(0x655)][_0x166e4f(0x2526)]=_0x166e4f(0x2d4);}else{_0x14b0be[_0x166e4f(0xc02)]=_0x166e4f(0x1298),_0x14b0be[_0x166e4f(0x226e)][_0x166e4f(0xe1)]('empty');_0x4a3a46&&(_0x4a3a46[_0x166e4f(0x655)]['display']='block',_0x4a3a46[_0x166e4f(0x1c18)]=_0x166e4f(0xfe2));if(_0x285160)_0x285160[_0x166e4f(0x655)][_0x166e4f(0x2526)]=_0x166e4f(0xfe9);}await applyDiarySettingsToContent();}async function showTodayDiary(){showDiaryMenu();}async function generateTodayDiary(){const _0x72655=_0x2cf6d4;if(!currentChatCharacter){showToast(_0x72655(0x1268),_0x72655(0x24ab));return;}if(currentChatCharacter[_0x72655(0x4b7)]){showToast(_0x72655(0x16f5),_0x72655(0x24ab));return;}const _0x14673d=document[_0x72655(0x566)](_0x72655(0x157)),_0xfc5b0e=document['getElementById'](_0x72655(0xf1b)),_0x1e39de=new Date()[_0x72655(0xa4b)]()[_0x72655(0x633)]('T')[0x0],_0xd232a1=currentChatCharacter['id']+'_'+_0x1e39de;let _0x568e51=null;try{_0x568e51=await db[_0x72655(0x8e3)][_0x72655(0x46a)](_0xd232a1);}catch(_0x32538f){console[_0x72655(0x24ab)](_0x72655(0x1215),_0x32538f);}if(_0x568e51&&_0x568e51[_0x72655(0x1423)]){const _0x11f3cc=confirm(_0x72655(0xe4b));if(!_0x11f3cc)return;}_0x14673d&&(_0x14673d[_0x72655(0x194e)]=!![],_0x14673d[_0x72655(0xc02)]=_0x72655(0x18ce),_0x14673d[_0x72655(0x1c18)]=_0x72655(0x14d1));_0xfc5b0e['innerHTML']=_0x72655(0x147),_0xfc5b0e[_0x72655(0x226e)]['remove'](_0x72655(0xaa0));try{const _0x5513f8=currentChatCharacter,_0x184f7e=_0x5513f8['id'],_0x4e4704=await getAsyncChatSettings(_0x184f7e),_0x424a02=chatMessages[_0x184f7e]||[],_0x4fbc8e=_0x4e4704[_0x72655(0xe03)]||0x5,_0x14daac=_0x424a02[_0x72655(0x136)](-_0x4fbc8e),_0xbe5e07=_0x4e4704['crossWindowMemory']||0x3,_0x1f3278=await getVisibleMomentsForCharacter(_0x5513f8['id'],_0xbe5e07);let _0x2b3259='';_0x14daac[_0x72655(0xcbf)]>0x0&&(_0x2b3259='\x0a\x0a最近的聊天记录：\x0a'+_0x14daac[_0x72655(0xf6d)](_0x31832d=>{const _0x43be85=_0x72655;if(_0x31832d[_0x43be85(0xf75)]===_0x43be85(0xfda))return _0x43be85(0x1e7e)+_0x31832d[_0x43be85(0x1423)];if(_0x31832d[_0x43be85(0xf75)]===_0x43be85(0x232))return _0x5513f8['name']+'：'+_0x31832d[_0x43be85(0x1423)];return'';})[_0x72655(0x803)](Boolean)[_0x72655(0x140c)]('\x0a'));let _0x2694fb='';_0x1f3278[_0x72655(0xcbf)]>0x0&&(_0x2694fb=_0x72655(0xb8),_0x1f3278['forEach']((_0x2cc094,_0x280591)=>{const _0x13c208=_0x72655,_0x23c9cf=_0x2cc094[_0x13c208(0x3df)]===_0x13c208(0x23b2)?'用户':_0x2cc094['nickname'];let _0x4f25ff='';if(_0x2cc094['timestamp']){const _0x57cfed=Date[_0x13c208(0x18e0)](),_0x4277f5=_0x57cfed-_0x2cc094[_0x13c208(0x7aa)],_0x2d4da4=Math['floor'](_0x4277f5/(0x3e8*0x3c)),_0x51c9a3=Math[_0x13c208(0x1dac)](_0x4277f5/(0x3e8*0x3c*0x3c)),_0x570e8a=Math[_0x13c208(0x1dac)](_0x4277f5/(0x3e8*0x3c*0x3c*0x18));if(_0x570e8a>0x0)_0x4f25ff='（'+_0x570e8a+_0x13c208(0x22c4);else{if(_0x51c9a3>0x0)_0x4f25ff='（'+_0x51c9a3+'小时前发布）';else _0x2d4da4>0x0?_0x4f25ff='（'+_0x2d4da4+_0x13c208(0x11e5):_0x4f25ff='（刚刚发布）';}}let _0x2ed20b=_0x23c9cf+':\x20'+_0x2cc094[_0x13c208(0x1e58)]+_0x4f25ff;if(_0x2cc094[_0x13c208(0x1508)]&&_0x2cc094[_0x13c208(0x1508)][_0x13c208(0xcbf)]>0x0){const _0x3ad241=_0x2cc094[_0x13c208(0x1508)][_0x13c208(0xf6d)](_0x4df038=>'\x20\x20'+_0x4df038['nickname']+':\x20'+_0x4df038[_0x13c208(0x1e58)])[_0x13c208(0x140c)]('\x0a');_0x2ed20b+=_0x13c208(0x370)+_0x3ad241;}_0x2694fb+=_0x2ed20b+'\x0a\x0a';}));let _0x1d8940='';_0x5513f8['worldbook']&&_0x5513f8[_0x72655(0xff5)][_0x72655(0xcbf)]>0x0&&(_0x1d8940=_0x72655(0xe6e)+_0x5513f8[_0x72655(0xff5)][_0x72655(0xf6d)](_0x2e3c71=>_0x2e3c71[_0x72655(0x157f)]+':\x20'+_0x2e3c71[_0x72655(0xc34)])['join']('\x0a'));const _0x328ade=new Date()['toLocaleDateString'](_0x72655(0x1c0b),{'year':_0x72655(0xf4e),'month':_0x72655(0x2040),'day':'numeric','weekday':_0x72655(0x2040)}),_0x50e52e='你是'+_0x5513f8['name']+_0x72655(0x1da8)+_0x5513f8[_0x72655(0x1a84)]+_0x1d8940+_0x72655(0x193b)+_0x328ade+_0x72655(0x12e6)+_0x2b3259+_0x2694fb+_0x72655(0x87b)+_0x5513f8['name']+'的私人日记内容：',_0x3675e3=await generateAIResponse(_0x50e52e,_0x5513f8);if(_0x3675e3&&_0x3675e3[_0x72655(0x1424)]()){let _0x33782e=_0x3675e3[_0x72655(0x1424)]();_0x33782e=cleanDiaryContent(_0x33782e);try{await db[_0x72655(0x8e3)]['put']({'id':_0xd232a1,'characterId':_0x184f7e,'date':_0x1e39de,'content':_0x33782e,'timestamp':Date[_0x72655(0x18e0)](),'weather':'☀️'}),console[_0x72655(0xc0d)](_0x72655(0x1bb8));}catch(_0xe6b007){console[_0x72655(0x24ab)](_0x72655(0x228e),_0xe6b007);throw new Error(_0x72655(0x2555));}const _0x3f9fbf=createDiaryWithHeader(_0x33782e);_0xfc5b0e[_0x72655(0xc02)]=_0x3f9fbf,_0xfc5b0e['classList']['remove'](_0x72655(0xaa0)),await applyDiarySettingsToContent();_0x14673d&&(_0x14673d[_0x72655(0x194e)]=![],_0x14673d[_0x72655(0xc02)]=_0x72655(0x1694),_0x14673d[_0x72655(0x1c18)]=_0x72655(0xe39));const _0x47bcba=document['getElementById'](_0x72655(0x2126));if(_0x47bcba)_0x47bcba[_0x72655(0x655)][_0x72655(0x2526)]=_0x72655(0x2d4);showToast(_0x568e51?_0x72655(0xfb5):_0x72655(0x1df0),_0x72655(0xb27));}else throw new Error(_0x72655(0x232d));}catch(_0x18084c){console[_0x72655(0x24ab)](_0x72655(0x125c),_0x18084c),_0xfc5b0e['innerHTML']='生成日记失败，请稍后重试',_0xfc5b0e[_0x72655(0x226e)][_0x72655(0xe1)]('empty'),_0x14673d&&(_0x14673d[_0x72655(0x194e)]=![],_0x14673d['innerHTML']=_0x72655(0x1694),_0x14673d[_0x72655(0x1c18)]=_0x568e51?_0x72655(0xe39):'生成日记'),showToast('生成日记失败',_0x72655(0x24ab));}}async function loadPastDiaries(){const _0x11ca05=_0x2cf6d4;if(!currentChatCharacter)return;const _0x19f327=currentChatCharacter['id'];let _0x4ff8c2=[];try{_0x4ff8c2=await db['characterDiaries'][_0x11ca05(0x4a6)](_0x11ca05(0x10df))['equals'](_0x19f327)[_0x11ca05(0x2253)]()[_0x11ca05(0xa3b)]('timestamp'),console[_0x11ca05(0xc0d)]('获取到\x20'+_0x4ff8c2['length']+_0x11ca05(0x1fc1));}catch(_0x4dd90c){console[_0x11ca05(0x24ab)](_0x11ca05(0x1eeb),_0x4dd90c),showToast(_0x11ca05(0x134b),_0x11ca05(0x24ab));return;}const _0x55abf2=document[_0x11ca05(0x566)]('past-diaries-list');_0x4ff8c2['length']===0x0?_0x55abf2[_0x11ca05(0xc02)]=_0x11ca05(0xa17):_0x55abf2[_0x11ca05(0xc02)]=_0x4ff8c2[_0x11ca05(0xf6d)]((_0x3deebb,_0xc2e0db)=>{const _0xac6dee=_0x11ca05,_0x496922=new Date(_0x3deebb['date'])['toLocaleDateString']('zh-CN',{'year':'numeric','month':_0xac6dee(0x2040),'day':_0xac6dee(0xf4e),'weekday':_0xac6dee(0x2040)}),_0x3df9cc=_0x3deebb[_0xac6dee(0x1423)][_0xac6dee(0x882)](/<[^>]*>/g,''),_0xbead4=_0x3df9cc[_0xac6dee(0xcbf)]>0x64?_0x3df9cc['substring'](0x0,0x64)+_0xac6dee(0x12da):_0x3df9cc;return _0xac6dee(0xa23)+_0xc2e0db+_0xac6dee(0x1468)+_0x3deebb[_0xac6dee(0x1c5b)]+_0xac6dee(0x14c4)+_0x496922+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-entry-preview\x22>'+_0xbead4+_0xac6dee(0x1394);})['join']('');}async function showPastDiaries(){showDiaryMenu(),switchDiaryTab('past');}async function toggleDiaryEntry(_0x385b61){const _0x2c97f5=_0x2cf6d4;if(!currentChatCharacter)return;const _0x3880d3=document[_0x2c97f5(0x566)](_0x2c97f5(0xcdc));if(_0x3880d3[_0x2c97f5(0x226e)][_0x2c97f5(0x1f9)](_0x2c97f5(0xd42)))return;try{const _0x49680c=currentChatCharacter['id'],_0x21d2ac=await db[_0x2c97f5(0x8e3)]['where']('characterId')['equals'](_0x49680c)['reverse']()['sortBy'](_0x2c97f5(0x1c5b));if(_0x385b61>=0x0&&_0x385b61<_0x21d2ac['length']){const _0x216727=_0x21d2ac[_0x385b61];await showSingleDiaryView(_0x216727);}}catch(_0x4766dd){console[_0x2c97f5(0x24ab)](_0x2c97f5(0x2412),_0x4766dd),showToast('打开日记失败','error');}}function toggleDiaryDeleteMode(){const _0x1e2e6e=_0x2cf6d4,_0x1b6f7b=document[_0x1e2e6e(0x566)](_0x1e2e6e(0xcdc)),_0x1d13af=document[_0x1e2e6e(0x566)](_0x1e2e6e(0x1459));_0x1b6f7b[_0x1e2e6e(0x226e)]['contains'](_0x1e2e6e(0xd42))?exitDiaryDeleteMode():enterDiaryDeleteMode();}function enterDiaryDeleteMode(){const _0x4cb820=_0x2cf6d4,_0x2bb184=document[_0x4cb820(0x566)]('past-diaries-list'),_0x5523b1=document['getElementById'](_0x4cb820(0x1459));_0x2bb184[_0x4cb820(0x226e)]['add'](_0x4cb820(0xd42));const _0x5648dc=_0x2bb184[_0x4cb820(0x1ed9)](_0x4cb820(0xa9f));_0x5648dc[_0x4cb820(0x900)]((_0x4e1dc9,_0x42a6e8)=>{const _0xf718ef=_0x4cb820;if(!_0x4e1dc9[_0xf718ef(0x15b8)](_0xf718ef(0x1305))){const _0x934cbd=document['createElement'](_0xf718ef(0x526));_0x934cbd[_0xf718ef(0x221)]='diary-checkbox',_0x934cbd[_0xf718ef(0xc02)]=_0xf718ef(0x1983)+_0x42a6e8+'\x22>',_0x4e1dc9[_0xf718ef(0x1806)](_0x934cbd,_0x4e1dc9[_0xf718ef(0x1bd8)]);}});if(!document[_0x4cb820(0x566)](_0x4cb820(0xcfd))){const _0x32f44a=document[_0x4cb820(0x1ad8)](_0x4cb820(0x526));_0x32f44a['id']=_0x4cb820(0xcfd),_0x32f44a[_0x4cb820(0x221)]=_0x4cb820(0xcfd),_0x32f44a[_0x4cb820(0xc02)]=_0x4cb820(0x2370),_0x2bb184[_0x4cb820(0xe9)][_0x4cb820(0x1925)](_0x32f44a);}}function exitDiaryDeleteMode(){const _0x43704d=_0x2cf6d4,_0x12850e=document[_0x43704d(0x566)](_0x43704d(0xcdc)),_0x195170=document['getElementById'](_0x43704d(0xcfd));_0x12850e[_0x43704d(0x226e)][_0x43704d(0x128)](_0x43704d(0xd42));const _0x4c44ea=_0x12850e[_0x43704d(0x1ed9)](_0x43704d(0x1305));_0x4c44ea[_0x43704d(0x900)](_0x582833=>_0x582833[_0x43704d(0x128)]()),_0x195170&&_0x195170[_0x43704d(0x128)]();}async function deleteSelectedDiaries(){const _0x4971f7=_0x2cf6d4,_0x794b1f=document[_0x4971f7(0x1ed9)](_0x4971f7(0x21a6));if(_0x794b1f[_0x4971f7(0xcbf)]===0x0){showToast(_0x4971f7(0x155a),'warning');return;}if(!confirm(_0x4971f7(0x5d1)+_0x794b1f['length']+_0x4971f7(0x1eb0)))return;try{const _0x163ee7=currentChatCharacter['id'],_0x2fcfe7=[];_0x794b1f['forEach'](_0x5a3bbd=>{const _0x18b760=_0x4971f7,_0x32db84=parseInt(_0x5a3bbd['dataset']['diaryIndex']),_0x440c60=_0x5a3bbd[_0x18b760(0x2026)](_0x18b760(0xa9f)),_0x16a557=_0x440c60[_0x18b760(0x1f26)][_0x18b760(0x3fd)];_0x2fcfe7[_0x18b760(0x6ee)]({'index':_0x32db84,'date':_0x16a557});});for(const _0x2ebef1 of _0x2fcfe7){await db['characterDiaries'][_0x4971f7(0x4a6)]('characterId')[_0x4971f7(0x14a)](_0x163ee7)[_0x4971f7(0x1534)](_0x315b3a=>_0x315b3a[_0x4971f7(0x1c5b)]===_0x2ebef1[_0x4971f7(0x1c5b)])['delete']();}showToast(_0x4971f7(0x174f)+_0x2fcfe7[_0x4971f7(0xcbf)]+_0x4971f7(0x121d),_0x4971f7(0xb27)),exitDiaryDeleteMode(),loadPastDiaries();}catch(_0x354069){console[_0x4971f7(0x24ab)](_0x4971f7(0x983),_0x354069),showToast(_0x4971f7(0x253),'error');}}async function showSingleDiaryView(_0x1ddb0a){const _0x29ca5e=_0x2cf6d4;document[_0x29ca5e(0x566)]('past-diaries-view')[_0x29ca5e(0x226e)][_0x29ca5e(0x128)]('active');const _0xea3bb9=document[_0x29ca5e(0x566)](_0x29ca5e(0x1e5));_0xea3bb9[_0x29ca5e(0x226e)][_0x29ca5e(0xe1)](_0x29ca5e(0x105d));const _0x368a10=document[_0x29ca5e(0x566)](_0x29ca5e(0x10aa)),_0x4145d2=new Date(_0x1ddb0a['date'])[_0x29ca5e(0x177f)]('zh-CN',{'year':'numeric','month':'long','day':'numeric','weekday':_0x29ca5e(0x2040)});_0x368a10[_0x29ca5e(0x21dc)]=_0x4145d2;const _0x24be49=document[_0x29ca5e(0x566)](_0x29ca5e(0x204a)),_0x571c40=createDiaryWithHeader(_0x1ddb0a[_0x29ca5e(0x1423)],_0x1ddb0a[_0x29ca5e(0x1c5b)]);_0x24be49[_0x29ca5e(0xc02)]=_0x571c40,await applyDiarySettingsToSingleView();}function backFromSingleDiary(){const _0x2dcfb6=_0x2cf6d4;document[_0x2dcfb6(0x566)]('single-diary-view')[_0x2dcfb6(0x226e)][_0x2dcfb6(0x128)](_0x2dcfb6(0x105d)),document[_0x2dcfb6(0x566)](_0x2dcfb6(0x6d4))[_0x2dcfb6(0x226e)][_0x2dcfb6(0xe1)](_0x2dcfb6(0x105d)),document['getElementById']('diary-mode-title')['textContent']=_0x2dcfb6(0x1c2e);}function createDiaryWithHeader(_0xa69140,_0x27e5e2=null){const _0x5d7f62=processDiaryStyles(_0xa69140);return _0x5d7f62;}function cleanDiaryContent(_0x52e6b3){const _0x24cfc6=_0x2cf6d4;_0x52e6b3[_0x24cfc6(0x1cab)](_0x24cfc6(0x1ea9))&&_0x52e6b3[_0x24cfc6(0xd7e)]('```')&&(_0x52e6b3=_0x52e6b3[_0x24cfc6(0x136)](0x7,-0x3)[_0x24cfc6(0x1424)]());_0x52e6b3['startsWith'](_0x24cfc6(0x1b9d))&&_0x52e6b3['endsWith']('```')&&(_0x52e6b3=_0x52e6b3[_0x24cfc6(0x136)](0x3,-0x3)[_0x24cfc6(0x1424)]());try{const _0x5894d3=JSON['parse'](_0x52e6b3);if(typeof _0x5894d3==='string')_0x52e6b3=_0x5894d3;else{if(_0x5894d3['content'])_0x52e6b3=_0x5894d3[_0x24cfc6(0x1423)];else{if(_0x5894d3[_0x24cfc6(0x770)])_0x52e6b3=_0x5894d3[_0x24cfc6(0x770)];else _0x5894d3[_0x24cfc6(0x1e58)]&&(_0x52e6b3=_0x5894d3[_0x24cfc6(0x1e58)]);}}}catch(_0xc25a9e){}return(_0x52e6b3[_0x24cfc6(0x1cab)]('\x22')&&_0x52e6b3[_0x24cfc6(0xd7e)]('\x22')||_0x52e6b3[_0x24cfc6(0x1cab)]('\x27')&&_0x52e6b3[_0x24cfc6(0xd7e)]('\x27'))&&(_0x52e6b3=_0x52e6b3[_0x24cfc6(0x136)](0x1,-0x1)),_0x52e6b3=processDiaryStyles(_0x52e6b3),_0x52e6b3;}function processDiaryStyles(_0x1833cd){const _0x606dc3=_0x2cf6d4;let _0x2b0c0b=0x0,_0x4f737b=0x0;_0x1833cd=_0x1833cd[_0x606dc3(0x882)](/<strike>(.*?)<\/strike>/gi,(_0x490dcc,_0x1e2a45)=>{const _0x2aaf0f=_0x606dc3;if(_0x2b0c0b<0x2)return _0x2b0c0b++,_0x2aaf0f(0x16b7)+_0x1e2a45+_0x2aaf0f(0x19d2);return _0x1e2a45;}),_0x1833cd=_0x1833cd[_0x606dc3(0x882)](/<mark>(.*?)<\/mark>/gi,(_0x528af5,_0x71e8a7)=>{const _0x487f70=_0x606dc3;if(_0x4f737b<0x2)return _0x4f737b++,_0x487f70(0x6da)+_0x71e8a7+_0x487f70(0x19d2);return _0x71e8a7;});const _0x586ec6=_0x1833cd[_0x606dc3(0x633)](/\n\s*\n|\n/)['filter'](_0x29349e=>_0x29349e[_0x606dc3(0x1424)]());if(_0x586ec6[_0x606dc3(0xcbf)]>0x1)_0x1833cd=_0x586ec6['map'](_0x43bb08=>'<p>'+_0x43bb08[_0x606dc3(0x1424)]()+_0x606dc3(0x12f8))[_0x606dc3(0x140c)]('');else _0x586ec6[_0x606dc3(0xcbf)]===0x1&&(_0x1833cd='<p>'+_0x586ec6[0x0]['trim']()+_0x606dc3(0x12f8));return _0x1833cd;}function migratePastDiariesFormat(_0x11e5ff,_0x762412,_0x33177d,_0x141afd){const _0x191740=_0x2cf6d4,_0x281377=_0x191740(0x218e)+_0x11e5ff;if(localStorage[_0x191740(0x2250)](_0x281377))return;const _0xbb6ac5=_0x191740(0x76c)+_0x11e5ff;let _0xf0a28d=JSON[_0x191740(0x168e)](localStorage[_0x191740(0x2250)](_0xbb6ac5)||'[]');const _0x4dc5f1=_0xf0a28d['findIndex'](_0x470b50=>_0x470b50[_0x191740(0x1c5b)]===_0x33177d);if(_0x4dc5f1===-0x1){const _0x11a698=_0xf0a28d['findIndex'](_0x2cf948=>_0x2cf948[_0x191740(0x1c5b)]===_0x762412);_0x11a698!==-0x1?(_0xf0a28d[_0x11a698][_0x191740(0x1c5b)]=_0x33177d,_0xf0a28d[_0x11a698]['content']=_0x141afd,_0xf0a28d[_0x11a698][_0x191740(0x7aa)]=Date[_0x191740(0x18e0)]()):_0xf0a28d[_0x191740(0x50a)]({'date':_0x33177d,'content':_0x141afd,'timestamp':Date[_0x191740(0x18e0)]()}),localStorage[_0x191740(0x2055)](_0xbb6ac5,JSON['stringify'](_0xf0a28d));}localStorage['setItem'](_0x281377,'completed');}async function editTodayDiary(){const _0x527b33=_0x2cf6d4;if(!currentChatCharacter){showToast(_0x527b33(0x146),_0x527b33(0x24ab));return;}if(currentChatCharacter[_0x527b33(0x4b7)]){showToast(_0x527b33(0x16f5),_0x527b33(0x24ab));return;}const _0x5ed07c=currentChatCharacter['id'],_0x239f75=new Date()[_0x527b33(0xa4b)]()[_0x527b33(0x633)]('T')[0x0],_0x4d7f82=_0x5ed07c+'_'+_0x239f75;let _0x43aaa9=null;try{_0x43aaa9=await db['characterDiaries'][_0x527b33(0x46a)](_0x4d7f82);}catch(_0x211f03){console[_0x527b33(0x24ab)](_0x527b33(0x1215),_0x211f03),showToast(_0x527b33(0x134b),_0x527b33(0x24ab));return;}if(!_0x43aaa9||!_0x43aaa9[_0x527b33(0x1423)]){showToast(_0x527b33(0x905),_0x527b33(0x24ab));return;}const _0x3d11c0=convertHtmlToMarkup(_0x43aaa9['content']),_0x112bfd=document[_0x527b33(0x1ad8)](_0x527b33(0x526));_0x112bfd[_0x527b33(0x221)]=_0x527b33(0xb07),_0x112bfd[_0x527b33(0x655)][_0x527b33(0x2526)]='flex',_0x112bfd[_0x527b33(0xc02)]=_0x527b33(0x2381)+_0x3d11c0+_0x527b33(0x15f0),document[_0x527b33(0x172c)][_0x527b33(0x1925)](_0x112bfd);const _0x1f4888=_0x112bfd['querySelector']('#edit-diary-textarea');_0x1f4888[_0x527b33(0x1b12)](),_0x1f4888[_0x527b33(0x5f1)](_0x1f4888['value'][_0x527b33(0xcbf)],_0x1f4888[_0x527b33(0xc34)][_0x527b33(0xcbf)]);}function convertHtmlToMarkup(_0x12cd1f){const _0x3c6d64=_0x2cf6d4;return _0x12cd1f[_0x3c6d64(0x882)](/<span class="diary-strikethrough">(.*?)<\/span>/gi,_0x3c6d64(0x1717))[_0x3c6d64(0x882)](/<span class="diary-highlight">(.*?)<\/span>/gi,_0x3c6d64(0xef5));}async function saveDiaryEdit(){const _0x2ecf93=_0x2cf6d4;if(!currentChatCharacter){showToast(_0x2ecf93(0x146),_0x2ecf93(0x24ab));return;}if(currentChatCharacter[_0x2ecf93(0x4b7)]){showToast(_0x2ecf93(0x16f5),_0x2ecf93(0x24ab));return;}const _0x2f3f4b=currentChatCharacter['id'],_0x2d0e5e=new Date()[_0x2ecf93(0xa4b)]()[_0x2ecf93(0x633)]('T')[0x0],_0x3faced=_0x2f3f4b+'_'+_0x2d0e5e,_0x3a4003=document[_0x2ecf93(0x566)](_0x2ecf93(0x2507)),_0x1814ac=_0x3a4003[_0x2ecf93(0xc34)][_0x2ecf93(0x1424)]();if(!_0x1814ac){showToast('日记内容不能为空','error');return;}const _0x496c4e=processDiaryStyles(_0x1814ac);try{await db[_0x2ecf93(0x8e3)]['put']({'id':_0x3faced,'characterId':_0x2f3f4b,'date':_0x2d0e5e,'content':_0x496c4e,'timestamp':Date[_0x2ecf93(0x18e0)](),'weather':'☀️'});const _0x4c56da=document[_0x2ecf93(0x566)](_0x2ecf93(0xf1b)),_0x5b3111=createDiaryWithHeader(_0x496c4e,_0x2d0e5e);_0x4c56da[_0x2ecf93(0xc02)]=_0x5b3111,_0x4c56da[_0x2ecf93(0x226e)][_0x2ecf93(0x128)](_0x2ecf93(0xaa0)),await applyDiarySettingsToContent(),document[_0x2ecf93(0x15b8)](_0x2ecf93(0x555))[_0x2ecf93(0x128)](),showToast(_0x2ecf93(0xbd2),_0x2ecf93(0xb27));}catch(_0x5eefa0){console['error']('保存日记失败:',_0x5eefa0),showToast(_0x2ecf93(0x2555),_0x2ecf93(0x24ab));}}async function openDiarySettings(){const _0x4afef6=_0x2cf6d4;window['diarySettingsSourceScreen']=_0x4afef6(0x1233),showApp(_0x4afef6(0x19a0)),await initDiarySettingsScreen();}async function backFromDiarySettings(){const _0xf2e060=_0x2cf6d4,_0x13f32d=window['diarySettingsSourceScreen']||_0xf2e060(0x1233);hideApp(_0xf2e060(0x19a0)),showApp(_0x13f32d),window[_0xf2e060(0x1731)]=null,await applyDiarySettingsToContent();}async function initDiarySettingsScreen(){const _0x2d87c7=_0x2cf6d4;try{await loadDiarySettings(),await updateDiaryPreview();}catch(_0x4914db){console[_0x2d87c7(0x24ab)](_0x2d87c7(0x17da),_0x4914db);}}function getDiarySettingId(_0x57e9e5){const _0x4513af=_0x2cf6d4;if(!currentChatCharacter)return _0x4513af(0x102f)+_0x57e9e5;return currentChatCharacter['id']+'_'+_0x57e9e5;}async function getDiarySetting(_0x49342e,_0x257d89){const _0x265ec4=_0x2cf6d4;try{const _0x2885e3=getDiarySettingId(_0x49342e),_0x5d2599=await db[_0x265ec4(0xda3)][_0x265ec4(0x46a)](_0x2885e3);return _0x5d2599?_0x5d2599[_0x265ec4(0x224d)]:_0x257d89;}catch(_0x1f39ea){return console['error'](_0x265ec4(0x1816),_0x1f39ea),_0x257d89;}}async function setDiarySetting(_0x33632a,_0x499ef3){const _0x143edb=_0x2cf6d4;try{const _0x2401d6=getDiarySettingId(_0x33632a),_0x5b51a2=currentChatCharacter?currentChatCharacter['id']:null;await db[_0x143edb(0xda3)][_0x143edb(0x53a)]({'id':_0x2401d6,'characterId':_0x5b51a2,'settingName':_0x33632a,'settingValue':_0x499ef3,'timestamp':Date[_0x143edb(0x18e0)]()});}catch(_0x1d9ddb){console['error']('保存日记设置失败:',_0x1d9ddb);}}async function loadDiarySettings(){const _0x24eec5=_0x2cf6d4;try{const _0x4c9bc9=await getDiarySetting(_0x24eec5(0x1203),''),_0x23bc2f=await getDiarySetting(_0x24eec5(0x22cc),''),_0x2e9b4b=await getDiarySetting(_0x24eec5(0x81b),''),_0x398981=await getDiarySetting(_0x24eec5(0x58c),'16'),_0x1dd059=await getDiarySetting(_0x24eec5(0x998),_0x24eec5(0x1b00)),_0x3269df=await getDiarySetting(_0x24eec5(0x22be),'#000000'),_0x325272=await getDiarySetting(_0x24eec5(0xb21),_0x24eec5(0x1d29)),_0x5e9aaa=await getDiarySetting(_0x24eec5(0xeba),'15'),_0x41ae5e=await getDiarySetting(_0x24eec5(0x2509),'0'),_0x470d4b=await getDiarySetting(_0x24eec5(0x5a9),'left'),_0x4f13cd=await getDiarySetting(_0x24eec5(0x2521),_0x24eec5(0x1c8d)),_0x47e9b2=await getDiarySetting(_0x24eec5(0x2266),'40'),_0xb23a57=await getDiarySetting(_0x24eec5(0x17f7),'20'),_0x27a282=await getDiarySetting(_0x24eec5(0x903),_0x24eec5(0x4e3)),_0x18241e=document[_0x24eec5(0x566)](_0x24eec5(0x8c9)),_0x124838=document[_0x24eec5(0x566)](_0x24eec5(0x1847)),_0x1d5a6b=document[_0x24eec5(0x566)](_0x24eec5(0x22cc));if(_0x18241e)_0x18241e[_0x24eec5(0xc34)]=_0x4c9bc9;if(_0x1d5a6b)_0x1d5a6b[_0x24eec5(0xc34)]=_0x23bc2f;_0x124838&&(_0x124838[_0x24eec5(0x655)][_0x24eec5(0x2526)]=_0x4c9bc9===_0x24eec5(0x13a8)?_0x24eec5(0x2d4):_0x24eec5(0xfe9));document[_0x24eec5(0x566)](_0x24eec5(0x1f89))[_0x24eec5(0xc34)]=_0x398981,document[_0x24eec5(0x566)](_0x24eec5(0xc3f))[_0x24eec5(0x21dc)]=_0x398981+'px',document['getElementById'](_0x24eec5(0x23b7))['value']=_0x325272,document[_0x24eec5(0x566)]('line-height-value')['textContent']=_0x325272,document['getElementById'](_0x24eec5(0x140d))[_0x24eec5(0xc34)]=_0x5e9aaa,document['getElementById'](_0x24eec5(0xeb1))[_0x24eec5(0x21dc)]=_0x5e9aaa+'px',document['getElementById'](_0x24eec5(0x17ee))[_0x24eec5(0xc34)]=_0x41ae5e,document['getElementById'](_0x24eec5(0x2119))[_0x24eec5(0x21dc)]=_0x41ae5e+'px',document[_0x24eec5(0x566)](_0x24eec5(0x2480))[_0x24eec5(0xc34)]=_0x4f13cd,document[_0x24eec5(0x566)](_0x24eec5(0x1d13))['textContent']=_0x4f13cd+'%',document[_0x24eec5(0x566)]('content-padding-slider')[_0x24eec5(0xc34)]=_0x47e9b2,document[_0x24eec5(0x566)](_0x24eec5(0x331))[_0x24eec5(0x21dc)]=_0x47e9b2+'px',document['getElementById']('content-top-margin-slider')['value']=_0xb23a57,document['getElementById']('content-top-margin-value')['textContent']=_0xb23a57+'px';const _0x325c0d=document[_0x24eec5(0x566)]('fontWeightSelect');_0x325c0d&&(_0x325c0d['value']=_0x1dd059);const _0x52e10e=document[_0x24eec5(0x566)](_0x24eec5(0x170c));_0x52e10e&&(_0x52e10e[_0x24eec5(0xc34)]=_0x3269df);const _0x3f7617=document[_0x24eec5(0x566)](_0x24eec5(0x115c));_0x3f7617&&(_0x3f7617[_0x24eec5(0xc34)]=_0x470d4b);const _0x4e5af8=await getDiarySetting(_0x24eec5(0x181b),_0x24eec5(0xfe9)),_0x45f116=document[_0x24eec5(0x566)](_0x24eec5(0xcd));_0x45f116&&(_0x45f116['value']=_0x4e5af8),document[_0x24eec5(0x1ed9)](_0x24eec5(0x1c52))['forEach'](_0x565b4e=>{const _0x457e19=_0x24eec5;_0x565b4e[_0x457e19(0x226e)][_0x457e19(0x128)](_0x457e19(0x105d)),_0x565b4e['dataset'][_0x457e19(0x1139)]===_0x27a282&&_0x565b4e[_0x457e19(0x226e)]['add'](_0x457e19(0x105d));});}catch(_0x331763){console[_0x24eec5(0x24ab)](_0x24eec5(0xc87),_0x331763);}}async function updateDiarySettings(){const _0x2aafcf=_0x2cf6d4;try{const _0x37b1f3=document[_0x2aafcf(0x566)]('font-size-slider')[_0x2aafcf(0xc34)],_0x11d96c=document['getElementById']('line-height-slider')[_0x2aafcf(0xc34)],_0x16667d=document[_0x2aafcf(0x566)]('paragraph-spacing-slider')[_0x2aafcf(0xc34)],_0x4227c4=document[_0x2aafcf(0x566)](_0x2aafcf(0x17ee))[_0x2aafcf(0xc34)],_0x5ccf93=document[_0x2aafcf(0x566)](_0x2aafcf(0x2480))['value'],_0x437c7b=document[_0x2aafcf(0x566)](_0x2aafcf(0xdc5))[_0x2aafcf(0xc34)],_0x20be96=document['getElementById'](_0x2aafcf(0xff1))['value'];document[_0x2aafcf(0x566)](_0x2aafcf(0xc3f))[_0x2aafcf(0x21dc)]=_0x37b1f3+'px',document[_0x2aafcf(0x566)](_0x2aafcf(0x1179))[_0x2aafcf(0x21dc)]=_0x11d96c,document['getElementById'](_0x2aafcf(0xeb1))[_0x2aafcf(0x21dc)]=_0x16667d+'px',document[_0x2aafcf(0x566)](_0x2aafcf(0x2119))['textContent']=_0x4227c4+'px',document[_0x2aafcf(0x566)](_0x2aafcf(0x1d13))[_0x2aafcf(0x21dc)]=_0x5ccf93+'%',document[_0x2aafcf(0x566)](_0x2aafcf(0x331))[_0x2aafcf(0x21dc)]=_0x437c7b+'px',document[_0x2aafcf(0x566)](_0x2aafcf(0xd79))[_0x2aafcf(0x21dc)]=_0x20be96+'px',await setDiarySetting('font-size',_0x37b1f3),await setDiarySetting(_0x2aafcf(0xb21),_0x11d96c),await setDiarySetting(_0x2aafcf(0xeba),_0x16667d),await setDiarySetting(_0x2aafcf(0x2509),_0x4227c4),await setDiarySetting(_0x2aafcf(0x2521),_0x5ccf93),await setDiarySetting(_0x2aafcf(0x2266),_0x437c7b),await setDiarySetting(_0x2aafcf(0x17f7),_0x20be96),await updateDiaryPreview();}catch(_0x29c37b){console['error'](_0x2aafcf(0x1d6e),_0x29c37b);}}async function setFontWeight(_0x234977){const _0x1f3423=_0x2cf6d4,_0x5bbb0f=document[_0x1f3423(0x566)](_0x1f3423(0xf07));_0x5bbb0f&&(_0x5bbb0f['value']=_0x234977),await setDiarySetting('font-weight',_0x234977),await updateDiaryPreview();}async function setFontColor(_0x1b8916){const _0x53b829=_0x2cf6d4,_0x2cd240=document['getElementById'](_0x53b829(0x170c));_0x2cd240&&(_0x2cd240[_0x53b829(0xc34)]=_0x1b8916),await setDiarySetting(_0x53b829(0x22be),_0x1b8916),await updateDiaryPreview();}async function setTextAlign(_0x1a9764){const _0x463dea=_0x2cf6d4,_0x50a9f3=document[_0x463dea(0x566)](_0x463dea(0x115c));_0x50a9f3&&(_0x50a9f3[_0x463dea(0xc34)]=_0x1a9764),await setDiarySetting(_0x463dea(0x5a9),_0x1a9764),await updateDiaryPreview();}async function setTextDecoration(_0x57e949){const _0x18df9c=_0x2cf6d4,_0xcd4982=document[_0x18df9c(0x566)](_0x18df9c(0xcd));_0xcd4982&&(_0xcd4982[_0x18df9c(0xc34)]=_0x57e949),await setDiarySetting(_0x18df9c(0x181b),_0x57e949),applyTextDecoration(_0x57e949),await updateDiaryPreview();}function applyTextDecoration(_0xf9e1cd){const _0x46ab6c=_0x2cf6d4,_0x3f234d=document[_0x46ab6c(0x566)](_0x46ab6c(0xf1b));_0x3f234d&&(_0x3f234d[_0x46ab6c(0x226e)][_0x46ab6c(0x128)](_0x46ab6c(0x1dab),_0x46ab6c(0x94a)),_0xf9e1cd&&_0xf9e1cd!==_0x46ab6c(0xfe9)&&_0x3f234d[_0x46ab6c(0x226e)]['add'](_0x46ab6c(0x1f84)+_0xf9e1cd));}async function updateDiaryPreview(){const _0x12fca7=_0x2cf6d4,_0x329c01=document['getElementById'](_0x12fca7(0xfc9));if(!_0x329c01)return;try{const _0x30721d=await getDiarySetting(_0x12fca7(0x1203),''),_0x5e112a=await getDiarySetting('diary-font-name',''),_0xf78fba=await getDiarySetting(_0x12fca7(0x58c),'16'),_0x4d22eb=await getDiarySetting(_0x12fca7(0x998),_0x12fca7(0x1b00)),_0x1abe18=await getDiarySetting(_0x12fca7(0x22be),'#000000'),_0x27cb1e=await getDiarySetting(_0x12fca7(0xb21),_0x12fca7(0x1d29)),_0x242bfe=await getDiarySetting(_0x12fca7(0xeba),'15'),_0x43f918=await getDiarySetting('text-indent','0'),_0x41b1f0=await getDiarySetting(_0x12fca7(0x5a9),_0x12fca7(0x1466)),_0x5be902=await getDiarySetting(_0x12fca7(0x2521),'100'),_0x30203c=await getDiarySetting(_0x12fca7(0x2266),'40'),_0x5e6d2d=await getDiarySetting(_0x12fca7(0x17f7),'20'),_0x51a759=await getDiarySetting(_0x12fca7(0x903),_0x12fca7(0x4e3)),_0x327d9a=await getDiarySetting(_0x12fca7(0x181b),'none');_0x30721d===_0x12fca7(0x13a8)&&_0x5e112a?_0x329c01[_0x12fca7(0x655)][_0x12fca7(0x16db)]('font-family','\x27'+_0x5e112a+_0x12fca7(0x178b),_0x12fca7(0x153c)):_0x329c01[_0x12fca7(0x655)]['fontFamily']='';_0x329c01[_0x12fca7(0x655)][_0x12fca7(0x1ae6)]=_0xf78fba+'px',_0x329c01[_0x12fca7(0x655)]['fontWeight']=_0x4d22eb,_0x329c01[_0x12fca7(0x655)][_0x12fca7(0x2099)]=_0x1abe18,_0x329c01[_0x12fca7(0x655)]['lineHeight']=_0x27cb1e,_0x329c01[_0x12fca7(0x655)][_0x12fca7(0xd2d)]=_0x41b1f0,_0x329c01['style'][_0x12fca7(0x16db)]('--diary-text-indent',_0x43f918+'px'),_0x329c01[_0x12fca7(0x655)][_0x12fca7(0xaab)]=_0x5be902+'%',_0x329c01[_0x12fca7(0x655)]['paddingLeft']=_0x30203c+'px',_0x329c01[_0x12fca7(0x655)][_0x12fca7(0xa6f)]=_0x30203c+'px',_0x329c01[_0x12fca7(0x655)][_0x12fca7(0x1d8)]=_0x5e6d2d+'px';const _0x290120=_0x329c01['querySelector']('.preview-text');_0x290120&&(_0x290120[_0x12fca7(0x655)][_0x12fca7(0x1e8c)]=_0x242bfe+'px');_0x329c01[_0x12fca7(0x221)]='diary-preview-paper';_0x51a759&&_0x51a759!=='plain'&&_0x329c01['classList'][_0x12fca7(0xe1)](_0x51a759+_0x12fca7(0x218b));_0x327d9a&&_0x327d9a!==_0x12fca7(0xfe9)&&_0x329c01[_0x12fca7(0x226e)][_0x12fca7(0xe1)]('decoration-'+_0x327d9a);if(_0x51a759===_0x12fca7(0x13a8)){const _0x79e877=await getDiarySetting(_0x12fca7(0x1d98),'');_0x79e877?_0x329c01[_0x12fca7(0x655)]['backgroundImage']=_0x12fca7(0xcb5)+_0x79e877+')':_0x329c01[_0x12fca7(0x655)][_0x12fca7(0x1584)]='';}else _0x329c01[_0x12fca7(0x655)][_0x12fca7(0x1584)]='';}catch(_0x493548){console['error']('更新日记预览失败:',_0x493548);}}async function resetDiarySettings(){const _0x2705b3=_0x2cf6d4;if(!confirm(_0x2705b3(0x108a)))return;try{await clearDiaryFont();const _0x27115d=[_0x2705b3(0x51c),_0x2705b3(0x58c),_0x2705b3(0x998),_0x2705b3(0x22be),_0x2705b3(0xb21),_0x2705b3(0xeba),_0x2705b3(0x2509),_0x2705b3(0x5a9),_0x2705b3(0x2521),_0x2705b3(0x2266),'content-top-margin',_0x2705b3(0x903),'custom-background','text-decoration',_0x2705b3(0x1203),'diary-font-url','diary-font-name'];for(const _0x4520d2 of _0x27115d){const _0x5e27c4=getDiarySettingId(_0x4520d2);await db[_0x2705b3(0xda3)]['delete'](_0x5e27c4);}await loadDiarySettings(),await updateDiaryPreview(),showToast('设置已重置为默认值',_0x2705b3(0xb27));}catch(_0x5948cd){console['error'](_0x2705b3(0x131e),_0x5948cd),showToast(_0x2705b3(0x2474),'error');}}async function applyDiarySettingsToContent(){const _0x371381=_0x2cf6d4,_0x2e258e=document['getElementById'](_0x371381(0xf1b));if(!_0x2e258e)return;try{const _0x5494e7=await getDiarySetting('diary-font-type',''),_0x272c09=await getDiarySetting(_0x371381(0x81b),''),_0x527fa9=await getDiarySetting(_0x371381(0x58c),'16'),_0xabd190=await getDiarySetting(_0x371381(0x998),'500'),_0x142c14=await getDiarySetting(_0x371381(0x22be),'#000000'),_0x42c750=await getDiarySetting(_0x371381(0xb21),_0x371381(0x1d29)),_0x2cfd12=await getDiarySetting(_0x371381(0x2509),'0'),_0x308308=await getDiarySetting('text-align',_0x371381(0x1466)),_0x3d0930=await getDiarySetting('content-width',_0x371381(0x1c8d)),_0x50cf4a=await getDiarySetting(_0x371381(0x2266),'40'),_0x4c1075=await getDiarySetting(_0x371381(0x17f7),'20'),_0x2140f3=await getDiarySetting(_0x371381(0x181b),'none');_0x5494e7===_0x371381(0x13a8)&&_0x272c09?_0x2e258e['style'][_0x371381(0x16db)](_0x371381(0x51c),'\x27'+_0x272c09+_0x371381(0x178b),_0x371381(0x153c)):_0x2e258e[_0x371381(0x655)]['fontFamily']='',_0x2e258e[_0x371381(0x655)]['fontSize']=_0x527fa9+'px',_0x2e258e[_0x371381(0x655)][_0x371381(0x1311)]=_0xabd190,_0x2e258e[_0x371381(0x655)][_0x371381(0x2099)]=_0x142c14,_0x2e258e['style']['lineHeight']=_0x42c750,_0x2e258e['style'][_0x371381(0xd2d)]=_0x308308,_0x2e258e[_0x371381(0x655)][_0x371381(0x16db)](_0x371381(0x90c),_0x2cfd12+'px'),_0x2e258e[_0x371381(0x655)][_0x371381(0xaab)]=_0x3d0930+'%',_0x2e258e[_0x371381(0x655)][_0x371381(0x1b13)]=_0x50cf4a+'px',_0x2e258e[_0x371381(0x655)][_0x371381(0xa6f)]=_0x50cf4a+'px',_0x2e258e[_0x371381(0x655)][_0x371381(0x1d8)]=_0x4c1075+'px',applyTextDecoration(_0x2140f3);}catch(_0x543a35){console[_0x371381(0x24ab)](_0x371381(0x199a),_0x543a35);}}async function applyDiarySettingsToSingleView(){const _0xa7ccd9=_0x2cf6d4,_0xb4eaa7=document[_0xa7ccd9(0x566)](_0xa7ccd9(0x204a));if(!_0xb4eaa7)return;try{const _0x430293=await getDiarySetting('diary-font-type',''),_0x143e12=await getDiarySetting(_0xa7ccd9(0x81b),''),_0x5e1dc9=await getDiarySetting(_0xa7ccd9(0x58c),'16'),_0x32b033=await getDiarySetting(_0xa7ccd9(0x998),_0xa7ccd9(0x1b00)),_0x4eedc0=await getDiarySetting(_0xa7ccd9(0x22be),_0xa7ccd9(0x1f42)),_0x2044a1=await getDiarySetting(_0xa7ccd9(0xb21),_0xa7ccd9(0x1d29)),_0x2996c6=await getDiarySetting(_0xa7ccd9(0x2509),'0'),_0x4de68d=await getDiarySetting(_0xa7ccd9(0x5a9),_0xa7ccd9(0x1466)),_0x891d7b=await getDiarySetting(_0xa7ccd9(0x2521),'100'),_0x439587=await getDiarySetting(_0xa7ccd9(0x2266),'40'),_0x2ba779=await getDiarySetting(_0xa7ccd9(0x17f7),'20'),_0x2c5695=await getDiarySetting(_0xa7ccd9(0x181b),_0xa7ccd9(0xfe9)),_0x593943=await getDiarySetting('paper-type','lined');_0x430293===_0xa7ccd9(0x13a8)&&_0x143e12?_0xb4eaa7[_0xa7ccd9(0x655)][_0xa7ccd9(0x16db)](_0xa7ccd9(0x51c),'\x27'+_0x143e12+_0xa7ccd9(0x178b),_0xa7ccd9(0x153c)):_0xb4eaa7[_0xa7ccd9(0x655)][_0xa7ccd9(0x16b1)]='';_0xb4eaa7[_0xa7ccd9(0x655)][_0xa7ccd9(0x1ae6)]=_0x5e1dc9+'px',_0xb4eaa7[_0xa7ccd9(0x655)][_0xa7ccd9(0x1311)]=_0x32b033,_0xb4eaa7[_0xa7ccd9(0x655)]['color']=_0x4eedc0,_0xb4eaa7[_0xa7ccd9(0x655)][_0xa7ccd9(0x1b6b)]=_0x2044a1,_0xb4eaa7[_0xa7ccd9(0x655)][_0xa7ccd9(0xd2d)]=_0x4de68d,_0xb4eaa7[_0xa7ccd9(0x655)][_0xa7ccd9(0x16db)](_0xa7ccd9(0x90c),_0x2996c6+'px'),_0xb4eaa7[_0xa7ccd9(0x655)]['width']=_0x891d7b+'%',_0xb4eaa7[_0xa7ccd9(0x655)][_0xa7ccd9(0x1b13)]=_0x439587+'px',_0xb4eaa7[_0xa7ccd9(0x655)][_0xa7ccd9(0xa6f)]=_0x439587+'px',_0xb4eaa7[_0xa7ccd9(0x655)][_0xa7ccd9(0x1d8)]=_0x2ba779+'px',_0xb4eaa7['classList'][_0xa7ccd9(0x128)](_0xa7ccd9(0x137f),_0xa7ccd9(0x21b6),_0xa7ccd9(0x139a),'vintage-paper',_0xa7ccd9(0x1dba));_0x593943&&_0x593943!==_0xa7ccd9(0x4e3)&&_0xb4eaa7['classList'][_0xa7ccd9(0xe1)](_0x593943+_0xa7ccd9(0x218b));if(_0x593943===_0xa7ccd9(0x13a8)){const _0x2dd638=await getDiarySetting('custom-background','');_0x2dd638&&(_0xb4eaa7['style']['backgroundImage']='url('+_0x2dd638+')');}_0xb4eaa7[_0xa7ccd9(0x226e)][_0xa7ccd9(0x128)](_0xa7ccd9(0x1dab),'decoration-underline'),_0x2c5695&&_0x2c5695!=='none'&&_0xb4eaa7['classList'][_0xa7ccd9(0xe1)]('decoration-'+_0x2c5695);}catch(_0x5281ec){console['error']('应用日记设置到单个视图失败:',_0x5281ec);}}async function setDiaryPaper(_0xc8bfb1){const _0x16a034=_0x2cf6d4;document['querySelectorAll']('.paper-option')[_0x16a034(0x900)](_0x36a43d=>{const _0x3ce45b=_0x16a034;_0x36a43d[_0x3ce45b(0x226e)][_0x3ce45b(0x128)](_0x3ce45b(0x105d)),_0x36a43d[_0x3ce45b(0x1f26)][_0x3ce45b(0x1139)]===_0xc8bfb1&&_0x36a43d['classList'][_0x3ce45b(0xe1)](_0x3ce45b(0x105d));}),await setDiarySetting(_0x16a034(0x903),_0xc8bfb1),await applyDiaryPaper(_0xc8bfb1),document[_0x16a034(0x566)](_0x16a034(0xfc9))&&await updateDiaryPreview();}async function applyDiaryPaper(_0x5af4ba){const _0x561ec4=_0x2cf6d4,_0x2e4d29=document[_0x561ec4(0x566)](_0x561ec4(0xf1b));if(_0x2e4d29)try{_0x2e4d29[_0x561ec4(0x226e)][_0x561ec4(0x128)](_0x561ec4(0x137f),_0x561ec4(0x21b6),_0x561ec4(0x139a),_0x561ec4(0xc97),_0x561ec4(0x1dba));_0x5af4ba&&_0x5af4ba!==_0x561ec4(0x4e3)&&_0x2e4d29[_0x561ec4(0x226e)][_0x561ec4(0xe1)](_0x5af4ba+'-paper');if(_0x5af4ba===_0x561ec4(0x13a8)){const _0x22bb96=await getDiarySetting('custom-background','');_0x22bb96&&(_0x2e4d29[_0x561ec4(0x655)][_0x561ec4(0x1584)]=_0x561ec4(0xcb5)+_0x22bb96+')');}else _0x2e4d29[_0x561ec4(0x655)][_0x561ec4(0x1584)]='';}catch(_0x311ef5){console[_0x561ec4(0x24ab)](_0x561ec4(0xf27),_0x311ef5);}}function uploadCustomPaper(){const _0x5a5106=_0x2cf6d4,_0x34c1eb=document[_0x5a5106(0x566)](_0x5a5106(0x14c1));_0x34c1eb?_0x34c1eb[_0x5a5106(0x1e62)]():console[_0x5a5106(0x24ab)](_0x5a5106(0x202c));}function handlePaperUpload(_0x5e4413){const _0x237dd0=_0x2cf6d4,_0x15102b=_0x5e4413['target'][_0x237dd0(0x173e)][0x0];if(!_0x15102b)return;if(!_0x15102b[_0x237dd0(0x23df)][_0x237dd0(0x1cab)](_0x237dd0(0x1183))){showToast(_0x237dd0(0x76b),_0x237dd0(0x24ab));return;}const _0x4fa4f6=new FileReader();_0x4fa4f6['onload']=async function(_0x520a65){const _0x3fefbc=_0x237dd0;try{const _0xcc5a1e=_0x520a65[_0x3fefbc(0x1144)]['result'];await setDiarySetting('custom-background',_0xcc5a1e),await setDiaryPaper(_0x3fefbc(0x13a8));const _0x441a72=document[_0x3fefbc(0x566)](_0x3fefbc(0xf1b));_0x441a72&&(_0x441a72[_0x3fefbc(0x655)][_0x3fefbc(0x1584)]=_0x3fefbc(0xcb5)+_0xcc5a1e+')'),document[_0x3fefbc(0x566)](_0x3fefbc(0xfc9))&&await updateDiaryPreview(),showToast(_0x3fefbc(0x1d7c),_0x3fefbc(0xb27));}catch(_0x3dd226){console[_0x3fefbc(0x24ab)]('上传自定义背景失败:',_0x3dd226),showToast(_0x3fefbc(0x872),_0x3fefbc(0x24ab));}},_0x4fa4f6[_0x237dd0(0x145e)](_0x15102b);}async function initDiaryPaper(){const _0x41f60f=_0x2cf6d4;try{const _0xd3dbc1=await getDiarySetting(_0x41f60f(0x903),_0x41f60f(0x4e3));await applyDiaryPaper(_0xd3dbc1),await applyDiarySettingsToContent(),await initDiaryFont();}catch(_0x13c7f5){console['error']('初始化日记纸张设置失败:',_0x13c7f5);}}let diaryFontSettings={'fontUrl':'','fontName':'','isApplied':![]};async function handleDiaryFontChange(){const _0x34760b=_0x2cf6d4,_0x21f6a8=document[_0x34760b(0x566)](_0x34760b(0x8c9)),_0x176a50=document[_0x34760b(0x566)]('diary-custom-font-input');if(_0x21f6a8['value']===_0x34760b(0x13a8)){_0x176a50[_0x34760b(0x655)][_0x34760b(0x2526)]=_0x34760b(0x2d4);const _0x59da7b=await getDiarySetting(_0x34760b(0x22cc),'');document[_0x34760b(0x566)](_0x34760b(0x22cc))[_0x34760b(0xc34)]=_0x59da7b;}else _0x176a50['style'][_0x34760b(0x2526)]=_0x34760b(0xfe9),await clearDiaryFont();await setDiarySetting(_0x34760b(0x1203),_0x21f6a8[_0x34760b(0xc34)]);}async function previewDiaryFont(){const _0x2bccc5=_0x2cf6d4,_0xe29ee3=document['getElementById'](_0x2bccc5(0x22cc))['value'][_0x2bccc5(0x1424)]();if(!_0xe29ee3){showDiaryFontStatus(_0x2bccc5(0x789),'error');return;}showDiaryFontStatus(_0x2bccc5(0xb65),'info');const _0x597825=document[_0x2bccc5(0x566)](_0x2bccc5(0x796));_0x597825&&_0x597825[_0x2bccc5(0x128)]();if(isCSSFontUrl(_0xe29ee3))await loadDiaryCSSFontPreview(_0xe29ee3);else isFontFileUrl(_0xe29ee3)?await loadDiaryFontFilePreview(_0xe29ee3):showDiaryFontStatus(_0x2bccc5(0x1022),_0x2bccc5(0x24ab));}async function applyDiaryFont(){const _0xcc0b18=_0x2cf6d4,_0x370c80=document[_0xcc0b18(0x566)](_0xcc0b18(0x22cc))[_0xcc0b18(0xc34)][_0xcc0b18(0x1424)]();if(!_0x370c80){showDiaryFontStatus(_0xcc0b18(0x789),_0xcc0b18(0x24ab));return;}const _0x1efd62=document[_0xcc0b18(0x566)](_0xcc0b18(0x10bf));_0x1efd62&&_0x1efd62[_0xcc0b18(0x128)]();showDiaryFontStatus(_0xcc0b18(0xa8d),_0xcc0b18(0x2422));if(isCSSFontUrl(_0x370c80))await applyDiaryCSSFont(_0x370c80);else isFontFileUrl(_0x370c80)?await applyDiaryFontFile(_0x370c80):showDiaryFontStatus(_0xcc0b18(0x1022),'error');}async function clearDiaryFont(){const _0x2c51da=_0x2cf6d4,_0x5a241c=document[_0x2c51da(0x566)](_0x2c51da(0x10bf));_0x5a241c&&_0x5a241c[_0x2c51da(0x128)]();const _0x217204=document[_0x2c51da(0x566)]('diary-font-preview');_0x217204&&_0x217204[_0x2c51da(0x128)]();const _0x23b79d=document[_0x2c51da(0x566)](_0x2c51da(0x813));_0x23b79d&&_0x23b79d['remove']();const _0x27ac12=document[_0x2c51da(0x1ed9)](_0x2c51da(0x1ae3));_0x27ac12[_0x2c51da(0x900)](_0x305ee8=>{const _0x4d6cca=_0x2c51da;_0x305ee8[_0x4d6cca(0x655)][_0x4d6cca(0xdae)]('font-family');}),await setDiarySetting('diary-font-url',''),await setDiarySetting(_0x2c51da(0x81b),''),await setDiarySetting('diary-font-type',''),document[_0x2c51da(0x566)](_0x2c51da(0x22cc))[_0x2c51da(0xc34)]='',document[_0x2c51da(0x566)](_0x2c51da(0x8c9))[_0x2c51da(0xc34)]='',document[_0x2c51da(0x566)](_0x2c51da(0x1847))[_0x2c51da(0x655)][_0x2c51da(0x2526)]=_0x2c51da(0xfe9),diaryFontSettings={'fontUrl':'','fontName':'','isApplied':![]},showDiaryFontStatus(_0x2c51da(0x243a),_0x2c51da(0xb27));}async function loadDiaryCSSFontPreview(_0x4572fe){const _0x36ba41=_0x2cf6d4,_0x3bc30e=document[_0x36ba41(0x1ad8)](_0x36ba41(0xa58));_0x3bc30e['id']=_0x36ba41(0x796),_0x3bc30e[_0x36ba41(0xe06)]=_0x36ba41(0x1cb4),_0x3bc30e[_0x36ba41(0xe1d)]=_0x4572fe,_0x3bc30e['crossOrigin']=_0x36ba41(0xb99),_0x3bc30e[_0x36ba41(0xc28)]=function(){const _0x189a3e=_0x36ba41;console[_0x189a3e(0xc0d)]('🎨\x20日记CSS字体预览加载成功'),setTimeout(()=>{const _0x356d6d=_0x189a3e;let _0x4fe7cc=extractFontNameFromCSS(_0x4572fe);try{const _0x46edea=document[_0x356d6d(0x13d9)];for(let _0x35adcc=_0x46edea[_0x356d6d(0xcbf)]-0x1;_0x35adcc>=0x0;_0x35adcc--){const _0x1e75b9=_0x46edea[_0x35adcc];if(_0x1e75b9[_0x356d6d(0xe1d)]===_0x4572fe){try{const _0x42ca97=_0x1e75b9[_0x356d6d(0x21aa)]||_0x1e75b9[_0x356d6d(0x5fe)];for(let _0x463346=0x0;_0x463346<_0x42ca97[_0x356d6d(0xcbf)];_0x463346++){const _0x4e0678=_0x42ca97[_0x463346];if(_0x4e0678['type']===CSSRule[_0x356d6d(0x4e7)]&&_0x4e0678[_0x356d6d(0x655)][_0x356d6d(0x16b1)]){_0x4fe7cc=_0x4e0678['style'][_0x356d6d(0x16b1)][_0x356d6d(0x882)](/['"]/g,'');break;}}}catch(_0xd5424e){console[_0x356d6d(0xc0d)](_0x356d6d(0x19a4));}break;}}}catch(_0x2c420b){console[_0x356d6d(0xc0d)](_0x356d6d(0x33d));}const _0x515da1=document[_0x356d6d(0x566)]('diary-preview-content');_0x515da1&&_0x515da1[_0x356d6d(0x655)][_0x356d6d(0x16db)](_0x356d6d(0x51c),'\x27'+_0x4fe7cc+_0x356d6d(0x178b),_0x356d6d(0x153c)),showDiaryFontStatus(_0x356d6d(0x1a4c)+_0x4fe7cc,_0x356d6d(0xb27));},0x1f4);},_0x3bc30e[_0x36ba41(0x1795)]=function(){const _0x3c9317=_0x36ba41;console['error'](_0x3c9317(0x8f4),_0x4572fe),showDiaryFontStatus(_0x3c9317(0x1b18),_0x3c9317(0x24ab));},document['head'][_0x36ba41(0x1925)](_0x3bc30e);}async function loadDiaryFontFilePreview(_0x282a8c){const _0x59a311=_0x2cf6d4,_0x564f65=_0x59a311(0x2e8)+Date['now'](),_0x30cdae=document[_0x59a311(0x1ad8)]('style');_0x30cdae['id']=_0x59a311(0x796);let _0x554529=_0x59a311(0x16d0);if(_0x282a8c['endsWith'](_0x59a311(0x1f1b)))_0x554529='woff';if(_0x282a8c['endsWith'](_0x59a311(0x12fd)))_0x554529='woff2';if(_0x282a8c[_0x59a311(0xd7e)](_0x59a311(0x22f6)))_0x554529='opentype';_0x30cdae[_0x59a311(0x21dc)]=_0x59a311(0x233e)+_0x564f65+_0x59a311(0x7e8)+_0x282a8c+_0x59a311(0x158a)+_0x554529+_0x59a311(0x1c1d),document[_0x59a311(0x1e4c)][_0x59a311(0x1925)](_0x30cdae),setTimeout(()=>{const _0x243cc7=_0x59a311,_0x22df25=document[_0x243cc7(0x566)]('diary-preview-content');_0x22df25&&_0x22df25[_0x243cc7(0x655)][_0x243cc7(0x16db)](_0x243cc7(0x51c),'\x27'+_0x564f65+_0x243cc7(0x178b),'important'),showDiaryFontStatus(_0x243cc7(0x1a4c)+_0x564f65,_0x243cc7(0xb27));},0x1f4);}async function applyDiaryCSSFont(_0xa5e51e){const _0x275109=_0x2cf6d4,_0x378eb2=document[_0x275109(0x1ad8)](_0x275109(0xa58));_0x378eb2['id']='diary-custom-font',_0x378eb2[_0x275109(0xe06)]=_0x275109(0x1cb4),_0x378eb2[_0x275109(0xe1d)]=_0xa5e51e,_0x378eb2[_0x275109(0x4c9)]=_0x275109(0xb99),_0x378eb2[_0x275109(0xc28)]=function(){const _0x3fc74=_0x275109;console[_0x3fc74(0xc0d)]('🎨\x20日记CSS字体加载成功，开始应用'),setTimeout(async()=>{const _0x1ff321=_0x3fc74;let _0x1253a6=extractFontNameFromCSS(_0xa5e51e);try{const _0x4832c2=document[_0x1ff321(0x13d9)];for(let _0x3e7542=_0x4832c2[_0x1ff321(0xcbf)]-0x1;_0x3e7542>=0x0;_0x3e7542--){const _0x37f165=_0x4832c2[_0x3e7542];if(_0x37f165[_0x1ff321(0xe1d)]===_0xa5e51e){try{const _0x5ce384=_0x37f165[_0x1ff321(0x21aa)]||_0x37f165[_0x1ff321(0x5fe)];for(let _0x8debbf=0x0;_0x8debbf<_0x5ce384['length'];_0x8debbf++){const _0x3f2fe7=_0x5ce384[_0x8debbf];if(_0x3f2fe7[_0x1ff321(0x23df)]===CSSRule[_0x1ff321(0x4e7)]&&_0x3f2fe7[_0x1ff321(0x655)][_0x1ff321(0x16b1)]){_0x1253a6=_0x3f2fe7[_0x1ff321(0x655)]['fontFamily'][_0x1ff321(0x882)](/['"]/g,'');break;}}}catch(_0x2d9f9f){console[_0x1ff321(0xc0d)](_0x1ff321(0x19a4));}break;}}}catch(_0x522c48){console['log'](_0x1ff321(0x33d));}await applyDiaryFontToElements(_0x1253a6),await setDiarySetting(_0x1ff321(0x22cc),_0xa5e51e),await setDiarySetting(_0x1ff321(0x81b),_0x1253a6),diaryFontSettings={'fontUrl':_0xa5e51e,'fontName':_0x1253a6,'isApplied':!![]},showDiaryFontStatus(_0x1ff321(0x156d)+_0x1253a6,_0x1ff321(0xb27));},0x1f4);},_0x378eb2['onerror']=function(){const _0x19fab3=_0x275109;console[_0x19fab3(0x24ab)](_0x19fab3(0x15e1),_0xa5e51e),showDiaryFontStatus('字体CSS加载失败，请检查URL',_0x19fab3(0x24ab));},document[_0x275109(0x1e4c)]['appendChild'](_0x378eb2);}async function applyDiaryFontFile(_0x527d24){const _0x4689b1=_0x2cf6d4,_0x271cb8=_0x4689b1(0x1218)+Date[_0x4689b1(0x18e0)](),_0x109202=document[_0x4689b1(0x1ad8)](_0x4689b1(0x655));_0x109202['id']=_0x4689b1(0x10bf);let _0x26c89b=_0x4689b1(0x16d0);if(_0x527d24[_0x4689b1(0xd7e)](_0x4689b1(0x1f1b)))_0x26c89b='woff';if(_0x527d24[_0x4689b1(0xd7e)](_0x4689b1(0x12fd)))_0x26c89b='woff2';if(_0x527d24[_0x4689b1(0xd7e)](_0x4689b1(0x22f6)))_0x26c89b=_0x4689b1(0x1794);_0x109202[_0x4689b1(0x21dc)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20@font-face\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20\x27'+_0x271cb8+'\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20src:\x20url(\x27'+_0x527d24+_0x4689b1(0x158a)+_0x26c89b+_0x4689b1(0x1c1d),document[_0x4689b1(0x1e4c)][_0x4689b1(0x1925)](_0x109202),setTimeout(async()=>{const _0x14f645=_0x4689b1;await applyDiaryFontToElements(_0x271cb8),await setDiarySetting('diary-font-url',_0x527d24),await setDiarySetting(_0x14f645(0x81b),_0x271cb8),diaryFontSettings={'fontUrl':_0x527d24,'fontName':_0x271cb8,'isApplied':!![]},showDiaryFontStatus(_0x14f645(0x156d)+_0x271cb8,'success');},0x1f4);}async function applyDiaryFontToElements(_0x61f2f2){const _0x58ac60=_0x2cf6d4;console['log']('🎨\x20开始应用日记专用字体:',_0x61f2f2);const _0x3e1c7a=document['getElementById'](_0x58ac60(0x813));_0x3e1c7a&&_0x3e1c7a[_0x58ac60(0x128)]();const _0x325567=document['createElement'](_0x58ac60(0x655));_0x325567['id']=_0x58ac60(0x813),_0x325567[_0x58ac60(0x21dc)]=_0x58ac60(0x24c)+_0x61f2f2+_0x58ac60(0x159b),document['head'][_0x58ac60(0x1925)](_0x325567),console['log'](_0x58ac60(0xdb2));}async function initDiaryFont(){const _0x104184=_0x2cf6d4;try{const _0x12e78d=await getDiarySetting('diary-font-type',''),_0x407560=await getDiarySetting(_0x104184(0x22cc),''),_0x1218cb=await getDiarySetting(_0x104184(0x81b),''),_0x452ef2=document[_0x104184(0x566)](_0x104184(0x8c9)),_0x2b27a9=document[_0x104184(0x566)](_0x104184(0x1847)),_0x5ea988=document[_0x104184(0x566)](_0x104184(0x22cc));if(_0x452ef2)_0x452ef2[_0x104184(0xc34)]=_0x12e78d;if(_0x5ea988)_0x5ea988['value']=_0x407560;if(_0x12e78d==='custom'){if(_0x2b27a9)_0x2b27a9['style'][_0x104184(0x2526)]='block';if(_0x407560&&_0x1218cb){if(isCSSFontUrl(_0x407560))await applyDiaryCSSFont(_0x407560);else isFontFileUrl(_0x407560)&&await applyDiaryFontFile(_0x407560);}}else{if(_0x2b27a9)_0x2b27a9[_0x104184(0x655)][_0x104184(0x2526)]=_0x104184(0xfe9);}}catch(_0x17ca04){console[_0x104184(0x24ab)](_0x104184(0x6ae),_0x17ca04);}}function showDiaryFontStatus(_0xee6441,_0x2462c0){const _0x4ca5ec=_0x2cf6d4,_0x3b8526=document[_0x4ca5ec(0x566)](_0x4ca5ec(0xef8));if(!_0x3b8526)return;_0x3b8526[_0x4ca5ec(0x21dc)]=_0xee6441,_0x3b8526[_0x4ca5ec(0x221)]='diary-font-status';switch(_0x2462c0){case _0x4ca5ec(0xb27):_0x3b8526[_0x4ca5ec(0x655)][_0x4ca5ec(0x2099)]=_0x4ca5ec(0x23b8);break;case _0x4ca5ec(0x24ab):_0x3b8526[_0x4ca5ec(0x655)][_0x4ca5ec(0x2099)]=_0x4ca5ec(0x1dd7);break;case _0x4ca5ec(0x2422):_0x3b8526[_0x4ca5ec(0x655)][_0x4ca5ec(0x2099)]=_0x4ca5ec(0x207c);break;default:_0x3b8526['style'][_0x4ca5ec(0x2099)]=_0x4ca5ec(0x2070);}setTimeout(()=>{const _0x2bde86=_0x4ca5ec;_0x3b8526['textContent']===_0xee6441&&(_0x3b8526[_0x2bde86(0x21dc)]='');},0xbb8);}function isCSSFontUrl(_0x344f04){const _0x46d4b2=_0x2cf6d4;return _0x344f04[_0x46d4b2(0x23ec)](_0x46d4b2(0xd54))||_0x344f04[_0x46d4b2(0x23ec)]('fonts.google.com')||_0x344f04[_0x46d4b2(0x23ec)](_0x46d4b2(0x20a0))||_0x344f04['includes'](_0x46d4b2(0x8ff))&&_0x344f04['includes']('css');}function isFontFileUrl(_0x277f40){const _0x270a3f=_0x2cf6d4;return _0x277f40[_0x270a3f(0xd7e)](_0x270a3f(0x1b55))||_0x277f40[_0x270a3f(0xd7e)](_0x270a3f(0x22f6))||_0x277f40[_0x270a3f(0xd7e)](_0x270a3f(0x1f1b))||_0x277f40[_0x270a3f(0xd7e)](_0x270a3f(0x12fd));}function extractFontNameFromCSS(_0x304e19){const _0x4061bb=_0x2cf6d4;if(_0x304e19[_0x4061bb(0x23ec)](_0x4061bb(0xd54))||_0x304e19[_0x4061bb(0x23ec)](_0x4061bb(0xb9b))){const _0x14214d=_0x304e19[_0x4061bb(0x1316)](/family=([^&:]+)/);if(_0x14214d){let _0x565bf8=decodeURIComponent(_0x14214d[0x1]);return _0x565bf8=_0x565bf8[_0x4061bb(0x882)](/:\d+.*$/,''),_0x565bf8=_0x565bf8[_0x4061bb(0x882)](/\+/g,'\x20'),_0x565bf8;}}return _0x4061bb(0x1e12);}async function shouldUpdateCharacterStatus(_0x2ddd52){const _0x5c3ce1=_0x2cf6d4;try{const _0x33f840=getCharacterStatus(_0x2ddd52),_0x43530c=new Date(_0x33f840[_0x5c3ce1(0x1e69)]),_0x32ac17=new Date(),_0x56f669=_0x32ac17-_0x43530c,_0x43f54e=getStatusUpdateInterval();if(_0x56f669<_0x43f54e)return![];if(_0x56f669>_0x43f54e*0x2)return!![];if(_0x33f840[_0x5c3ce1(0x152)]){const _0x35997c=new Date(_0x33f840[_0x5c3ce1(0x152)]),_0x4eebd7=_0x32ac17-_0x35997c;if(_0x4eebd7<_0x43f54e&&_0x56f669>=_0x43f54e)return Math['random']()<0.7;}return Math[_0x5c3ce1(0x191c)]()<0.3;}catch(_0x1e2c81){return console[_0x5c3ce1(0x24ab)](_0x5c3ce1(0x1b17),_0x1e2c81),Math[_0x5c3ce1(0x191c)]()<0.1;}}async function updateCharacterLastChatTime(_0x50b089){const _0x42403c=_0x2cf6d4;try{let _0x13cc16=characterStatusData[_0x42403c(0x1aeb)](_0x3575fe=>_0x3575fe[_0x42403c(0x10df)]===_0x50b089);!_0x13cc16?(_0x13cc16={'id':'status_'+_0x50b089,'characterId':_0x50b089,'status':_0x42403c(0x20bb),'activity':'在线','location':'','lastUpdate':new Date()[_0x42403c(0xa4b)](),'lastChatTime':Date[_0x42403c(0x18e0)]()},characterStatusData[_0x42403c(0x6ee)](_0x13cc16)):_0x13cc16['lastChatTime']=Date['now'](),await db[_0x42403c(0x5a2)][_0x42403c(0x53a)](_0x13cc16);}catch(_0x448de4){console[_0x42403c(0x24ab)]('更新角色聊天时间失败:',_0x448de4);}}async function triggerStatusUpdateAfterMessage(_0x37da6b){const _0x5051dd=_0x2cf6d4,_0x154617=await getAsyncChatSettings(_0x37da6b);if(!_0x154617['characterStatusEnabled']){console[_0x5051dd(0xc0d)]('角色\x20'+_0x37da6b+'\x20未启用状态显示，跳过状态更新');return;}await updateCharacterLastChatTime(_0x37da6b),console[_0x5051dd(0xc0d)](_0x5051dd(0x13a3)+_0x37da6b+_0x5051dd(0x5ac));}document[_0x2cf6d4(0x167)]('DOMContentLoaded',function(){setTimeout(()=>{startStatusUpdateTimer();},0x1388);}),console[_0x2cf6d4(0xc0d)](_0x2cf6d4(0x1d22)),document[_0x2cf6d4(0x167)]('DOMContentLoaded',function(){const _0x49daf0=_0x2cf6d4,_0x1d78dc=document[_0x49daf0(0x566)]('coreMemoryThreshold'),_0x36bfc5=document[_0x49daf0(0x566)](_0x49daf0(0xe8f));_0x1d78dc&&_0x1d78dc[_0x49daf0(0x167)]('input',updateThresholdDisplay),_0x36bfc5&&_0x36bfc5['addEventListener'](_0x49daf0(0x627),updateThresholdDisplay);});function calculateTextSimilarity(_0x5b0cee,_0x2091ab){const _0x2c34e1=_0x2cf6d4;if(!_0x5b0cee||!_0x2091ab)return 0x0;const _0x3dbf77=new Set(_0x5b0cee['toLowerCase']()['match'](/[\u4e00-\u9fa5\w]+/g)||[]),_0xddc354=new Set(_0x2091ab[_0x2c34e1(0x1d64)]()[_0x2c34e1(0x1316)](/[\u4e00-\u9fa5\w]+/g)||[]),_0x4a9872=new Set([..._0x3dbf77][_0x2c34e1(0x803)](_0x5ce84f=>_0xddc354['has'](_0x5ce84f))),_0x5a3ffd=new Set([..._0x3dbf77,..._0xddc354]);return _0x5a3ffd[_0x2c34e1(0x41a)]===0x0?0x0:_0x4a9872[_0x2c34e1(0x41a)]/_0x5a3ffd['size'];}let MEMORY_CONFIG={'AI_EXTRACT_INTERVAL':0x3c,'CORE_MEMORY_IMPORTANCE_THRESHOLD':0.9,'MAX_CORE_MEMORIES_PER_CHARACTER':0x32,'EPISODIC_MEMORY_IMPORTANCE_THRESHOLD':0.6,'MAX_EPISODIC_MEMORIES_PER_CHARACTER':0x64,'CROSS_APP_TIMELINE_LIMIT':0x14};async function loadMemoryConfig(){const _0x3cbc5f=_0x2cf6d4;try{const _0x29ea5b=await db['globalSettings'][_0x3cbc5f(0x46a)](_0x3cbc5f(0x1492));_0x29ea5b&&_0x29ea5b[_0x3cbc5f(0xc34)]&&(MEMORY_CONFIG={...MEMORY_CONFIG,..._0x29ea5b[_0x3cbc5f(0xc34)]});}catch(_0x6ec28b){console[_0x3cbc5f(0x24ab)](_0x3cbc5f(0x1321),_0x6ec28b);}}async function saveMemoryConfig(){const _0x3fbdb3=_0x2cf6d4;try{await db[_0x3fbdb3(0x2217)][_0x3fbdb3(0x53a)]({'id':'memoryConfig','value':MEMORY_CONFIG});}catch(_0x3cc4ed){console[_0x3fbdb3(0x24ab)](_0x3fbdb3(0x24e0),_0x3cc4ed);}}async function generateConversationSummary(_0x2afec5,_0x49eed0){const _0x416e01=_0x2cf6d4;if(!_0x49eed0||_0x49eed0[_0x416e01(0xcbf)]===0x0)return null;try{const _0x153fdc=characters[_0x416e01(0x1aeb)](_0x5bb2aa=>_0x5bb2aa['id']===_0x2afec5);if(!_0x153fdc)return null;const _0x354b48=_0x416e01(0x1b99)+_0x153fdc[_0x416e01(0x222f)]+_0x416e01(0x14d6)+(_0x153fdc[_0x416e01(0x1a84)]||_0x416e01(0x8ee))+_0x416e01(0x1dd2)+_0x49eed0[_0x416e01(0xf6d)](_0x1dbd05=>{const _0x22e020=_0x416e01,_0x4b86e7=_0x1dbd05['sender']===_0x22e020(0xfda)?'用户':_0x153fdc['name'],_0x71a9dc=typeof _0x1dbd05[_0x22e020(0x1423)]===_0x22e020(0xb97)?_0x1dbd05[_0x22e020(0x1423)]:_0x22e020(0xd0b);return _0x4b86e7+':\x20'+_0x71a9dc;})[_0x416e01(0x140c)]('\x0a')+'\x0a\x0a##\x20摘要要求\x0a请生成一个100-200字的对话摘要，包含：\x0a1.\x20主要话题和讨论内容\x0a2.\x20重要的情感变化或关键事件\x0a3.\x20双方的态度和关系变化\x0a4.\x20任何重要的决定或约定\x0a\x0a##\x20重要要求：统一使用第三人称\x0a-\x20用\x22用户\x22指代用户，用\x22'+_0x153fdc[_0x416e01(0x222f)]+_0x416e01(0x1e20)+_0x153fdc[_0x416e01(0x222f)]+_0x416e01(0x123f),_0x99efa0=await callChatAPI(extractPrompt,_0x153fdc),_0x2be093=Array[_0x416e01(0x1bcc)](_0x99efa0)?_0x99efa0[0x0]:_0x99efa0;if(_0x2be093&&typeof _0x2be093==='string')try{const _0x1d5257=_0x2be093['match'](/\{[\s\S]*\}/);if(_0x1d5257){const _0x325b18=JSON[_0x416e01(0x168e)](_0x1d5257[0x0]),_0x19ee98=await db[_0x416e01(0xa1b)]['where']('characterId')[_0x416e01(0x14a)](_0x2afec5)[_0x416e01(0x18c6)]();for(const _0x570776 of _0x325b18[_0x416e01(0x1f61)]||[]){if(_0x570776[_0x416e01(0x3d1)]>=MEMORY_CONFIG['CORE_MEMORY_IMPORTANCE_THRESHOLD']){const _0x2d2344=_0x19ee98[_0x416e01(0x184b)](_0xebbce8=>{const _0x4489e4=_0x416e01,_0x46b0da=calculateTextSimilarity(_0xebbce8[_0x4489e4(0x77b)],_0x570776[_0x4489e4(0x77b)]);return _0x46b0da>0.8;});if(!_0x2d2344){const _0x25a47b={'id':_0x416e01(0x17d5)+_0x2afec5+'_'+Date[_0x416e01(0x18e0)]()+'_'+Math['random']()[_0x416e01(0x9a3)](0x24)[_0x416e01(0x18cf)](0x2,0x9),'characterId':_0x2afec5,'fact':_0x570776[_0x416e01(0x77b)],'importance':_0x570776[_0x416e01(0x3d1)],'category':_0x570776['category']||'other','timestamp':Date[_0x416e01(0x18e0)](),'type':_0x416e01(0x22c1),'source':_0x416e01(0x11a5),'contextId':_0x2afec5};await db['coreMemories']['add'](_0x25a47b),console[_0x416e01(0xc0d)](_0x416e01(0x142)+_0x153fdc['name']+']\x20核心记忆:\x20'+_0x570776[_0x416e01(0x77b)]);}}}for(const _0x519886 of _0x325b18[_0x416e01(0x282)]||[]){if(_0x519886['importance']>=MEMORY_CONFIG[_0x416e01(0x1f28)]){const _0x1573a4={'id':_0x416e01(0x96b)+_0x2afec5+'_'+Date[_0x416e01(0x18e0)]()+'_'+Math['random']()[_0x416e01(0x9a3)](0x24)[_0x416e01(0x18cf)](0x2,0x9),'characterId':_0x2afec5,'fact':_0x519886[_0x416e01(0x77b)],'importance':_0x519886[_0x416e01(0x3d1)],'category':_0x519886[_0x416e01(0x1dd5)]||_0x416e01(0x9dd),'timestamp':Date['now'](),'source':_0x416e01(0x11a5),'contextId':_0x2afec5};await db[_0x416e01(0x222e)][_0x416e01(0xe1)](_0x1573a4),console[_0x416e01(0xc0d)](_0x416e01(0x142)+_0x153fdc[_0x416e01(0x222f)]+_0x416e01(0x1eb4)+_0x519886[_0x416e01(0x77b)]);}}}}catch(_0x553d42){console['warn']('解析记忆JSON失败:',_0x553d42);}}catch(_0x2e979d){console['error']('AI记忆提取失败:',_0x2e979d);}}async function checkAndGenerateSummary(_0x2e0424){const _0xcad638=_0x2cf6d4;try{const _0x1e3c9f=chatMessages[_0x2e0424]||[];if(_0x1e3c9f['length']===0x0)return;const _0x103f0d=await db[_0xcad638(0x1982)]['where'](_0xcad638(0x10df))[_0xcad638(0x14a)](_0x2e0424)[_0xcad638(0x18c6)](),_0x4b401b=_0x103f0d['length']>0x0?_0x103f0d['sort']((_0x1288c5,_0x47ae3e)=>_0x47ae3e['timestamp']-_0x1288c5[_0xcad638(0x7aa)])[0x0]:null;let _0x3396a9=![],_0x3a565e=[];if(!_0x4b401b)_0x1e3c9f['length']>=MEMORY_CONFIG[_0xcad638(0x20f0)]&&(_0x3a565e=_0x1e3c9f[_0xcad638(0x136)](-MEMORY_CONFIG[_0xcad638(0x20f0)]),_0x3396a9=!![]);else{const _0x1d0b25=_0x4b401b[_0xcad638(0x30b)]?.[_0xcad638(0x1ce3)]||_0x4b401b['timestamp'],_0x2b227b=_0x1e3c9f[_0xcad638(0x803)](_0x3fd514=>_0x3fd514[_0xcad638(0x7aa)]>_0x1d0b25),_0x208679=Date[_0xcad638(0x18e0)]()-_0x4b401b['timestamp'],_0x451e00=_0x208679/(0x3e8*0x3c*0x3c);(_0x2b227b[_0xcad638(0xcbf)]>=MEMORY_CONFIG['SUMMARY_TRIGGER_MESSAGE_COUNT']||_0x451e00>=MEMORY_CONFIG[_0xcad638(0xc98)])&&(_0x3a565e=_0x2b227b[_0xcad638(0x136)](-MEMORY_CONFIG[_0xcad638(0x20f0)]),_0x3396a9=!![]);}_0x3396a9&&_0x3a565e[_0xcad638(0xcbf)]>0x0&&await generateConversationSummary(_0x2e0424,_0x3a565e);}catch(_0x28c8ac){console[_0xcad638(0x24ab)](_0xcad638(0x1e16),_0x28c8ac);}}async function extractMemoriesWithAI(_0x2f658c,_0x4fbf09,_0x689d7c=null){const _0xa2f5ed=_0x2cf6d4;if(!_0x4fbf09||_0x4fbf09['length']===0x0)return;try{const _0x295496=characters['find'](_0x3ddc0f=>_0x3ddc0f['id']===_0x2f658c);if(!_0x295496)return;!_0x689d7c&&(_0x689d7c=_0x2f658c);const _0x1b95d0=_0xa2f5ed(0x20ed)+_0x295496[_0xa2f5ed(0x222f)]+_0xa2f5ed(0x14d6)+(_0x295496['bio']||_0xa2f5ed(0x8ee))+_0xa2f5ed(0x1dd2)+_0x4fbf09['map'](_0x5b212c=>{const _0x4c2829=_0xa2f5ed,_0x146335=_0x5b212c[_0x4c2829(0xf75)]===_0x4c2829(0xfda)?'用户':_0x295496[_0x4c2829(0x222f)],_0x187e4a=typeof _0x5b212c[_0x4c2829(0x1423)]==='string'?_0x5b212c[_0x4c2829(0x1423)]:_0x4c2829(0xd0b);return _0x146335+':\x20'+_0x187e4a;})[_0xa2f5ed(0x140c)]('\x0a')+_0xa2f5ed(0x203c)+_0x295496['name']+_0xa2f5ed(0x184f)+_0x295496[_0xa2f5ed(0x222f)]+'自己的生日是...\x22而不是\x22我的生日是...\x22\x0a\x0a请严格按照以下JSON格式返回，不要添加任何其他文字：\x0a\x0a{\x0a\x20\x20\x22core_memories\x22:\x20[\x0a\x20\x20\x20\x20{\x22fact\x22:\x20\x22简洁的核心事实（使用第三人称）\x22,\x20\x22importance\x22:\x200.9,\x20\x22category\x22:\x20\x22类别\x22}\x0a\x20\x20],\x0a\x20\x20\x22episodic_memories\x22:\x20[\x0a\x20\x20\x20\x20{\x22fact\x22:\x20\x22情景描述（使用第三人称）\x22,\x20\x22importance\x22:\x200.7,\x20\x22category\x22:\x20\x22类别\x22}\x0a\x20\x20]\x0a}\x0a\x0a注意：\x0a1.\x20只返回JSON，不要有任何解释文字\x0a2.\x20如果没有符合标准的记忆，对应数组为空\x0a3.\x20importance必须是数字，不要用字符串\x0a4.\x20确保JSON格式完全正确\x0a5.\x20所有fact字段必须使用第三人称描述',_0x2c6b63=await callChatAPI(_0x1b95d0,_0x295496);let _0x2a5535=[],_0x153992=null;try{_0x153992=Array[_0xa2f5ed(0x1bcc)](_0x2c6b63)?_0x2c6b63[0x0]:_0x2c6b63;if(_0x153992&&typeof _0x153992===_0xa2f5ed(0xb97)){console['log'](_0xa2f5ed(0x2028),_0x153992);let _0x14f4ce=null;const _0x2f055f=_0x153992[_0xa2f5ed(0x1316)](/\{[\s\S]*\}/);if(_0x2f055f)_0x14f4ce=_0x2f055f[0x0];else{const _0x4d08ba=_0x153992[_0xa2f5ed(0x1316)](/\[[\s\S]*\]/);_0x4d08ba&&(_0x14f4ce=_0x4d08ba[0x0]);}if(_0x14f4ce)console[_0xa2f5ed(0xc0d)](_0xa2f5ed(0x163),_0x14f4ce),_0x2a5535=JSON['parse'](_0x14f4ce);else{console[_0xa2f5ed(0x17cc)]('⚠️\x20未找到有效的JSON格式');return;}}}catch(_0x674515){console[_0xa2f5ed(0x17cc)](_0xa2f5ed(0x18e),_0x674515),console[_0xa2f5ed(0x17cc)](_0xa2f5ed(0xd86),_0x153992);return;}const [_0x40de43,_0x1554ba]=await Promise[_0xa2f5ed(0x2339)]([db[_0xa2f5ed(0xa1b)][_0xa2f5ed(0x4a6)]('characterId')[_0xa2f5ed(0x14a)](_0x2f658c)[_0xa2f5ed(0x18c6)](),db[_0xa2f5ed(0x222e)]['where'](_0xa2f5ed(0x10df))[_0xa2f5ed(0x14a)](_0x2f658c)[_0xa2f5ed(0x18c6)]()]);if(_0x2a5535[_0xa2f5ed(0x1f61)]&&Array['isArray'](_0x2a5535[_0xa2f5ed(0x1f61)]))for(const _0x5a1e5a of _0x2a5535[_0xa2f5ed(0x1f61)]){if(_0x5a1e5a['importance']>=MEMORY_CONFIG[_0xa2f5ed(0x6c7)]){const _0x18ca49=_0x40de43['some'](_0x221754=>{const _0x131e09=_0xa2f5ed,_0x233450=calculateTextSimilarity(_0x221754['fact'],_0x5a1e5a[_0x131e09(0x77b)]);return _0x233450>0.8;});if(!_0x18ca49){const _0x5b6746={'id':_0xa2f5ed(0x17d5)+_0x2f658c+'_'+Date[_0xa2f5ed(0x18e0)]()+'_'+Math[_0xa2f5ed(0x191c)]()[_0xa2f5ed(0x9a3)](0x24)[_0xa2f5ed(0x18cf)](0x2,0x9),'characterId':_0x2f658c,'fact':_0x5a1e5a[_0xa2f5ed(0x77b)],'importance':_0x5a1e5a[_0xa2f5ed(0x3d1)],'category':_0x5a1e5a[_0xa2f5ed(0x1dd5)]||_0xa2f5ed(0x9dd),'timestamp':Date[_0xa2f5ed(0x18e0)](),'type':_0xa2f5ed(0x22c1),'contextId':_0x689d7c};await db[_0xa2f5ed(0xa1b)][_0xa2f5ed(0xe1)](_0x5b6746),console[_0xa2f5ed(0xc0d)](_0xa2f5ed(0x9ff)+_0x295496[_0xa2f5ed(0x222f)]+'\x20添加核心记忆:\x20'+_0x5a1e5a[_0xa2f5ed(0x77b)]);}else console['log'](_0xa2f5ed(0x1a92)+_0x5a1e5a[_0xa2f5ed(0x77b)]);}}if(_0x2a5535[_0xa2f5ed(0x282)]&&Array[_0xa2f5ed(0x1bcc)](_0x2a5535['episodic_memories']))for(const _0x4a37b8 of _0x2a5535[_0xa2f5ed(0x282)]){if(_0x4a37b8[_0xa2f5ed(0x3d1)]>=MEMORY_CONFIG[_0xa2f5ed(0x1f28)]){const _0x2125fe=_0x1554ba[_0xa2f5ed(0x184b)](_0x2c527b=>{const _0x49d343=_0xa2f5ed,_0x2528ff=calculateTextSimilarity(_0x2c527b['fact'],_0x4a37b8[_0x49d343(0x77b)]);return _0x2528ff>0.8;});if(!_0x2125fe){const _0x4c0c3e={'id':_0xa2f5ed(0x96b)+_0x2f658c+'_'+Date[_0xa2f5ed(0x18e0)]()+'_'+Math[_0xa2f5ed(0x191c)]()[_0xa2f5ed(0x9a3)](0x24)[_0xa2f5ed(0x18cf)](0x2,0x9),'characterId':_0x2f658c,'fact':_0x4a37b8[_0xa2f5ed(0x77b)],'importance':_0x4a37b8[_0xa2f5ed(0x3d1)],'category':_0x4a37b8[_0xa2f5ed(0x1dd5)]||_0xa2f5ed(0x9dd),'timestamp':Date[_0xa2f5ed(0x18e0)](),'contextId':_0x689d7c};await db[_0xa2f5ed(0x222e)][_0xa2f5ed(0xe1)](_0x4c0c3e),console['log'](_0xa2f5ed(0x9ff)+_0x295496[_0xa2f5ed(0x222f)]+_0xa2f5ed(0x18b0)+_0x4a37b8['fact']);}else console['log']('⚠️\x20跳过重复情景记忆:\x20'+_0x4a37b8[_0xa2f5ed(0x77b)]);}}await cleanupCoreMemories(_0x2f658c),await cleanupEpisodicMemories(_0x2f658c);}catch(_0x2b38ac){console[_0xa2f5ed(0x24ab)](_0xa2f5ed(0x10ba),_0x2b38ac);}}async function cleanupCoreMemories(_0xaf5ec7){const _0x50414b=_0x2cf6d4;try{const _0x2c0c38=await db[_0x50414b(0xa1b)][_0x50414b(0x4a6)](_0x50414b(0x10df))[_0x50414b(0x14a)](_0xaf5ec7)[_0x50414b(0x18c6)]();console[_0x50414b(0xc0d)](_0x50414b(0x2077)+_0xaf5ec7+_0x50414b(0xa45)+_0x2c0c38[_0x50414b(0xcbf)]+_0x50414b(0x20d));const _0x31b769=MEMORY_CONFIG[_0x50414b(0x2093)]||0x32;_0x2c0c38[_0x50414b(0xcbf)]>_0x31b769&&console['log'](_0x50414b(0x481)+_0x31b769+_0x50414b(0xd92)+_0x2c0c38[_0x50414b(0xcbf)]+_0x50414b(0x1dec));}catch(_0x2164b5){console['error'](_0x50414b(0x1671),_0x2164b5);}}async function cleanupEpisodicMemories(_0x149a58){const _0x31083c=_0x2cf6d4;try{const _0x274f78=await db[_0x31083c(0x222e)]['where'](_0x31083c(0x10df))[_0x31083c(0x14a)](_0x149a58)[_0x31083c(0x18c6)](),_0x4804bd=_0x274f78['sort']((_0x249feb,_0x1be7bb)=>{const _0xc1bde0=_0x31083c;if(Math['abs'](_0x249feb[_0xc1bde0(0x3d1)]-_0x1be7bb[_0xc1bde0(0x3d1)])>0.1)return _0x1be7bb[_0xc1bde0(0x3d1)]-_0x249feb[_0xc1bde0(0x3d1)];return _0x1be7bb['timestamp']-_0x249feb[_0xc1bde0(0x7aa)];}),_0x484a99=MEMORY_CONFIG[_0x31083c(0x1b8a)]||0x64;if(_0x4804bd[_0x31083c(0xcbf)]>_0x484a99){const _0x3ec001=_0x4804bd['slice'](_0x484a99);for(const _0x447c14 of _0x3ec001){await db['episodicMemories'][_0x31083c(0xc2b)](_0x447c14['id']);}console[_0x31083c(0xc0d)](_0x31083c(0x1e99)+_0x3ec001[_0x31083c(0xcbf)]+_0x31083c(0x1e41));}}catch(_0x5d802e){console[_0x31083c(0x24ab)](_0x31083c(0xede),_0x5d802e);}}async function cleanupExpiredMemories(){const _0x1097cc=_0x2cf6d4;try{const _0x1a0f40=getGlobalMemorySettings();if(_0x1a0f40['memoryDays']===-0x1){console['log'](_0x1097cc(0x1c75));return;}const _0x3b5314=Date['now']()-_0x1a0f40[_0x1097cc(0x356)]*0x18*0x3c*0x3c*0x3e8,_0x5422f2=new Date(_0x3b5314)[_0x1097cc(0xa4b)]()[_0x1097cc(0x633)]('T')[0x0],_0x3e662e=await db[_0x1097cc(0x75b)][_0x1097cc(0x4a6)](_0x1097cc(0x7aa))['below'](_0x3b5314)['toArray']();_0x3e662e['length']>0x0&&(await db[_0x1097cc(0x75b)][_0x1097cc(0x4a6)]('timestamp')['below'](_0x3b5314)[_0x1097cc(0xc2b)](),console['log'](_0x1097cc(0x1e99)+_0x3e662e['length']+_0x1097cc(0x1935)));const _0x2cbebc=await db[_0x1097cc(0x1982)][_0x1097cc(0x4a6)](_0x1097cc(0x7aa))[_0x1097cc(0x5c6)](_0x3b5314)[_0x1097cc(0x18c6)]();_0x2cbebc['length']>0x0&&(await db[_0x1097cc(0x1982)][_0x1097cc(0x4a6)](_0x1097cc(0x7aa))[_0x1097cc(0x5c6)](_0x3b5314)['delete'](),console['log']('🧹\x20清理了\x20'+_0x2cbebc['length']+_0x1097cc(0x1b0)));const _0x2d9665=await db[_0x1097cc(0x222e)][_0x1097cc(0x4a6)](_0x1097cc(0x7aa))[_0x1097cc(0x5c6)](_0x3b5314)[_0x1097cc(0x18c6)]();_0x2d9665[_0x1097cc(0xcbf)]>0x0&&(await db[_0x1097cc(0x222e)][_0x1097cc(0x4a6)](_0x1097cc(0x7aa))[_0x1097cc(0x5c6)](_0x3b5314)[_0x1097cc(0xc2b)](),console['log'](_0x1097cc(0x1e99)+_0x2d9665[_0x1097cc(0xcbf)]+_0x1097cc(0x1f34)));}catch(_0x583ac0){console[_0x1097cc(0x24ab)](_0x1097cc(0x1ab6),_0x583ac0);}}setInterval(cleanupExpiredMemories,0x3c*0x3c*0x3e8),document[_0x2cf6d4(0x167)](_0x2cf6d4(0x7f7),()=>{setTimeout(cleanupExpiredMemories,0x1388);});async function getCoreMemoriesForChat(_0xe7dce3,_0x81ab2d=0xa){const _0x411c85=_0x2cf6d4;try{const _0x4a93eb=await db[_0x411c85(0xa1b)][_0x411c85(0x4a6)]('characterId')[_0x411c85(0x14a)](_0xe7dce3)['toArray'](),_0x2853fd=_0x4a93eb[_0x411c85(0x1f0d)]((_0x4193b5,_0x116bfd)=>_0x116bfd['importance']-_0x4193b5[_0x411c85(0x3d1)])[_0x411c85(0x136)](0x0,_0x81ab2d);return _0x2853fd[_0x411c85(0xf6d)](_0x1a8803=>_0x1a8803[_0x411c85(0x77b)])[_0x411c85(0x140c)]('\x0a');}catch(_0x504591){return console[_0x411c85(0x24ab)](_0x411c85(0x1bf5),_0x504591),'';}}async function shouldRecordGroupMemoryForCharacter(_0x597cc0,_0x54a4b4){const _0x270ac0=_0x2cf6d4;try{const _0x3355c4=await getAsyncChatSettings(_0x597cc0),_0x5ef158=_0x3355c4[_0x270ac0(0x176c)]||[],_0x11990e=_0x5ef158[_0x270ac0(0x23ec)](_0x54a4b4);return console[_0x270ac0(0xc0d)](_0x270ac0(0x138b)+_0x597cc0+_0x270ac0(0x1a3b)+_0x54a4b4+_0x270ac0(0x1d72)+_0x11990e),console[_0x270ac0(0xc0d)](_0x270ac0(0xdc0),_0x5ef158),_0x11990e;}catch(_0x113e0f){return console[_0x270ac0(0x17cc)](_0x270ac0(0x20d1),_0x113e0f),![];}}async function recordCrossAppEvent(_0x324663,_0x50129e,_0x5a61ea,_0x1bc7d6,_0x1f54a4=null){const _0x59ba21=_0x2cf6d4;try{if(!_0x324663||!_0x50129e||!_0x5a61ea){console['error']('❌\x20记录事件失败:\x20缺少必需参数',{'characterId':_0x324663,'appType':_0x50129e,'action':_0x5a61ea});return;}const _0x7eb8b2=_0x1bc7d6&&typeof _0x1bc7d6==='object'?_0x1bc7d6:{},_0x498329=Date[_0x59ba21(0x18e0)](),_0x5a1616=Math[_0x59ba21(0x191c)]()[_0x59ba21(0x9a3)](0x24)['substring'](0x2,0x8),_0x2a69c4=_0x324663+'_'+_0x50129e+'_'+_0x5a61ea+'_'+_0x498329+'_'+_0x5a1616,_0x3dcb0c={'id':_0x2a69c4,'characterId':String(_0x324663),'appType':String(_0x50129e),'action':String(_0x5a61ea),'timestamp':_0x498329,'context':_0x7eb8b2,'messageId':_0x1f54a4?String(_0x1f54a4):null};if(!_0x3dcb0c['id']||!_0x3dcb0c[_0x59ba21(0x10df)]||!_0x3dcb0c[_0x59ba21(0x12e0)]||!_0x3dcb0c[_0x59ba21(0x23af)]){console[_0x59ba21(0x24ab)]('❌\x20记录事件失败:\x20必需字段缺失',_0x3dcb0c);return;}if(!db||!db['crossAppTimeline']){console['error']('❌\x20记录事件失败:\x20数据库未初始化');return;}await db[_0x59ba21(0x75b)][_0x59ba21(0xe1)](_0x3dcb0c),console[_0x59ba21(0xc0d)](_0x59ba21(0x150)+_0x50129e+'.'+_0x5a61ea,{'characterId':_0x3dcb0c[_0x59ba21(0x10df)],'contextId':_0x7eb8b2['id'],'contextType':_0x7eb8b2[_0x59ba21(0x23df)],'groupId':_0x7eb8b2[_0x59ba21(0x1eb)]||'无','content':_0x7eb8b2[_0x59ba21(0x1423)]?.[_0x59ba21(0x4b2)](0x0,0x1e)+'...'});}catch(_0x1403ed){console[_0x59ba21(0x24ab)](_0x59ba21(0xb94),_0x1403ed),console[_0x59ba21(0x24ab)]('事件数据:',{'characterId':_0x324663,'appType':_0x50129e,'action':_0x5a61ea,'context':_0x1bc7d6,'messageId':_0x1f54a4});if(_0x1403ed[_0x59ba21(0x222f)]===_0x59ba21(0x702))console[_0x59ba21(0x24ab)]('数据库键值错误，可能是ID字段问题');else _0x1403ed[_0x59ba21(0x222f)]===_0x59ba21(0x172e)&&console['error'](_0x59ba21(0x250c));}}async function getCrossAppTimeline(_0x28dde2,_0x420907=0x1e){const _0x2bd4c2=_0x2cf6d4;try{const _0x5c71f7=await db[_0x2bd4c2(0x75b)][_0x2bd4c2(0x4a6)](_0x2bd4c2(0x10df))[_0x2bd4c2(0x14a)](_0x28dde2)[_0x2bd4c2(0x18c6)]();return _0x5c71f7[_0x2bd4c2(0x1f0d)]((_0x37fd63,_0x1281e6)=>_0x1281e6[_0x2bd4c2(0x7aa)]-_0x37fd63['timestamp'])['slice'](0x0,_0x420907);}catch(_0x42c230){return console[_0x2bd4c2(0x24ab)](_0x2bd4c2(0x451),_0x42c230),[];}}function calculateMessagesByRounds(_0x2da00c,_0x11901b){const _0x1c0822=_0x2cf6d4;if(!_0x2da00c||_0x2da00c['length']===0x0)return[];if(_0x11901b<=0x0)return[];console[_0x1c0822(0xc0d)](_0x1c0822(0x442)+_0x2da00c['length']+'条消息,\x20限制:\x20'+_0x11901b+'回合');const _0x578ec0=[];let _0x15893c=[],_0xc66ef7=null;for(let _0x1a2ca9=_0x2da00c['length']-0x1;_0x1a2ca9>=0x0;_0x1a2ca9--){const _0x31c2da=_0x2da00c[_0x1a2ca9],_0x335ef9=_0x31c2da[_0x1c0822(0xf75)];if(_0x335ef9!==_0xc66ef7||_0x335ef9===_0x1c0822(0x212)){if(_0x15893c[_0x1c0822(0xcbf)]>0x0){_0x578ec0[_0x1c0822(0x50a)](_0x15893c);if(_0x578ec0[_0x1c0822(0xcbf)]>=_0x11901b){console[_0x1c0822(0xc0d)](_0x1c0822(0xa31)+_0x578ec0[_0x1c0822(0xcbf)]+_0x1c0822(0x1304));break;}_0x15893c=[];}}_0x15893c[_0x1c0822(0x50a)](_0x31c2da),_0xc66ef7=_0x335ef9;}_0x15893c['length']>0x0&&_0x578ec0[_0x1c0822(0xcbf)]<_0x11901b&&_0x578ec0['unshift'](_0x15893c);const _0x17fa64=_0x578ec0[_0x1c0822(0x136)](-_0x11901b),_0x3b348d=_0x17fa64[_0x1c0822(0x1f92)]();return console[_0x1c0822(0xc0d)]('🔍\x20[calculateMessagesByRounds]\x20输出:\x20'+_0x17fa64[_0x1c0822(0xcbf)]+_0x1c0822(0x1faa)+_0x3b348d['length']+'条消息'),_0x3b348d;}function countActualRounds(_0x4a5197){const _0x38032a=_0x2cf6d4;if(!_0x4a5197||_0x4a5197[_0x38032a(0xcbf)]===0x0)return 0x0;let _0x4599b1=0x0,_0xa47664=null;for(const _0x3ec0ed of _0x4a5197){const _0x4516fb=_0x3ec0ed[_0x38032a(0xf75)];(_0x4516fb!==_0xa47664||_0x4516fb==='system')&&_0x4599b1++,_0xa47664=_0x4516fb;}return _0x4599b1;}window[_0x2cf6d4(0xa4f)]=function(){const _0x1f3ced=_0x2cf6d4;console[_0x1f3ced(0xc0d)](_0x1f3ced(0x12ab)),console[_0x1f3ced(0xc0d)]('viewStorylineSummary:',typeof window[_0x1f3ced(0x1648)]),console[_0x1f3ced(0xc0d)](_0x1f3ced(0x9b0),typeof window[_0x1f3ced(0x1978)]),console[_0x1f3ced(0xc0d)](_0x1f3ced(0x414),typeof window[_0x1f3ced(0x9d7)]);},window[_0x2cf6d4(0x1648)]=async function(_0x4b201a){const _0x374b03=_0x2cf6d4;console[_0x374b03(0xc0d)](_0x374b03(0xe3b),_0x4b201a);try{console['log'](_0x374b03(0x1b33));const _0x12f068=await db[_0x374b03(0x75b)][_0x374b03(0x46a)](_0x4b201a);console['log']('🔍\x20[调试]\x20数据库查询结果:',_0x12f068);if(!_0x12f068){console[_0x374b03(0x24ab)]('🔍\x20[调试]\x20找不到记忆，memoryId:',_0x4b201a),showToast(_0x374b03(0x1c65),_0x374b03(0x24ab));return;}if(_0x12f068[_0x374b03(0x23af)]!==_0x374b03(0x348)){console[_0x374b03(0x24ab)](_0x374b03(0x1c50),_0x12f068[_0x374b03(0x23af)]),showToast(_0x374b03(0x1c65),_0x374b03(0x24ab));return;}if(currentMemoryCharacter&&_0x12f068[_0x374b03(0x10df)]!==currentMemoryCharacter['id']){console[_0x374b03(0x24ab)]('🚨\x20角色ID不匹配，期望:',currentMemoryCharacter['id'],'实际:',_0x12f068[_0x374b03(0x10df)]),showToast(_0x374b03(0x197e),'error');return;}console['log'](_0x374b03(0xbf5));let _0x3c686a=_0x12f068[_0x374b03(0x30b)]?.['content']||_0x12f068[_0x374b03(0x225b)]||'无内容';_0x3c686a[_0x374b03(0x1cab)](_0x374b03(0x1116))&&(_0x3c686a=_0x3c686a['substring'](0x6));const _0x1e6da8=_0x12f068[_0x374b03(0x30b)]?.[_0x374b03(0x1c5b)]||_0x374b03(0x187c),_0x3679b6=_0x12f068[_0x374b03(0x30b)]?.[_0x374b03(0x2049)]||0x0;console[_0x374b03(0xc0d)](_0x374b03(0x22b6),_0x3c686a[_0x374b03(0x4b2)](0x0,0x64)+_0x374b03(0x12da));const _0x2888d6=document[_0x374b03(0x1ad8)](_0x374b03(0x526));_0x2888d6[_0x374b03(0x221)]=_0x374b03(0x256e),console[_0x374b03(0xc0d)](_0x374b03(0x22fe)),_0x2888d6[_0x374b03(0xc02)]=_0x374b03(0x578)+_0x1e6da8+_0x374b03(0x1e7c)+_0x3679b6+_0x374b03(0x2b9)+_0x3c686a+_0x374b03(0x474)+_0x4b201a+_0x374b03(0x271),console[_0x374b03(0xc0d)](_0x374b03(0xf3f)),_0x2888d6['style']['zIndex']='9999',_0x2888d6[_0x374b03(0x655)][_0x374b03(0x2526)]=_0x374b03(0x1f0b),document[_0x374b03(0x172c)][_0x374b03(0x1925)](_0x2888d6),console[_0x374b03(0xc0d)](_0x374b03(0x24bb),_0x2888d6[_0x374b03(0x655)][_0x374b03(0x8bc)]),setTimeout(()=>{const _0x1abcb7=_0x374b03,_0x362099=document[_0x1abcb7(0x15b8)](_0x1abcb7(0x89c));console[_0x1abcb7(0xc0d)](_0x1abcb7(0x1222),_0x362099),console['log'](_0x1abcb7(0xf44),_0x362099?window[_0x1abcb7(0x13bc)](_0x362099):'未找到');},0x64);}catch(_0x107765){console[_0x374b03(0x24ab)](_0x374b03(0x8cd),_0x107765),showToast('查看剧情总结失败','error');}},window['editStorylineSummary']=async function(_0x2496ea){const _0x469b4a=_0x2cf6d4;console[_0x469b4a(0xc0d)]('✏️\x20[调试]\x20editStorylineSummary\x20被调用，memoryId:',_0x2496ea);try{console[_0x469b4a(0xc0d)]('✏️\x20[调试]\x20开始查询数据库...');const _0x1028b5=await db[_0x469b4a(0x75b)][_0x469b4a(0x46a)](_0x2496ea);console[_0x469b4a(0xc0d)]('✏️\x20[调试]\x20数据库查询结果:',_0x1028b5);if(!_0x1028b5){console[_0x469b4a(0x24ab)](_0x469b4a(0x1817),_0x2496ea),showToast('找不到该剧情总结',_0x469b4a(0x24ab));return;}if(_0x1028b5[_0x469b4a(0x23af)]!==_0x469b4a(0x348)){console[_0x469b4a(0x24ab)](_0x469b4a(0x1ca3),_0x1028b5[_0x469b4a(0x23af)]),showToast('找不到该剧情总结',_0x469b4a(0x24ab));return;}if(currentMemoryCharacter&&_0x1028b5[_0x469b4a(0x10df)]!==currentMemoryCharacter['id']){console[_0x469b4a(0x24ab)]('🚨\x20角色ID不匹配，期望:',currentMemoryCharacter['id'],_0x469b4a(0x130e),_0x1028b5[_0x469b4a(0x10df)]),showToast('该剧情总结不属于当前角色','error');return;}console['log'](_0x469b4a(0x1a1a));let _0x54bd8=_0x1028b5[_0x469b4a(0x30b)]?.[_0x469b4a(0x1423)]||_0x1028b5[_0x469b4a(0x225b)]||'';_0x54bd8[_0x469b4a(0x1cab)]('[剧情模式]\x20')&&(_0x54bd8=_0x54bd8['substring'](0x6));const _0x5a3863=_0x1028b5['context']?.[_0x469b4a(0x1c5b)]||'未知日期',_0x3cd9bf=_0x1028b5[_0x469b4a(0x30b)]?.[_0x469b4a(0x2049)]||0x0,_0x568f40=document['querySelector']('.storyline-edit-modal');_0x568f40&&_0x568f40['remove']();const _0x3a8201=document[_0x469b4a(0x1ad8)]('div');_0x3a8201[_0x469b4a(0x221)]=_0x469b4a(0x652),_0x3a8201[_0x469b4a(0xc02)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3>编辑线下剧情总结</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-close\x22\x20onclick=\x22this.closest(\x27.modal-overlay\x27).remove()\x22>×</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22margin-bottom:\x2015px;\x20color:\x20#666;\x20font-size:\x2014px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>日期:\x20'+_0x5a3863+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>消息数:\x20'+_0x3cd9bf+'条</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22color:\x20#999;\x20font-size:\x2012px;\x20margin-top:\x205px;\x22>提示:\x20修改后的内容将同步到AI的工作记忆中</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22storyline-summary-editor-'+_0x2496ea+_0x469b4a(0x3f0)+_0x54bd8+'</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-primary\x22\x20onclick=\x22saveStorylineSummary(\x27'+_0x2496ea+_0x469b4a(0xd6)+_0x2496ea+'\x27)\x22>保存修改</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-secondary\x22\x20onclick=\x22this.closest(\x27.modal-overlay\x27).remove()\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',console['log']('✏️\x20[调试]\x20编辑模态框HTML已设置，准备添加到DOM'),_0x3a8201[_0x469b4a(0x655)][_0x469b4a(0x8bc)]='9999',_0x3a8201[_0x469b4a(0x655)]['display']=_0x469b4a(0x1f0b),document[_0x469b4a(0x172c)][_0x469b4a(0x1925)](_0x3a8201),console[_0x469b4a(0xc0d)](_0x469b4a(0x1d09),_0x3a8201['style'][_0x469b4a(0x8bc)]),setTimeout(()=>{const _0x101a6f=_0x469b4a,_0x2ad55c=document[_0x101a6f(0x566)]('storyline-summary-editor-'+_0x2496ea);_0x2ad55c&&(_0x2ad55c[_0x101a6f(0x1b12)](),_0x2ad55c[_0x101a6f(0x5f1)](_0x2ad55c[_0x101a6f(0xc34)][_0x101a6f(0xcbf)],_0x2ad55c[_0x101a6f(0xc34)][_0x101a6f(0xcbf)]));},0x64);}catch(_0x3f6f75){console['error'](_0x469b4a(0x9dc),_0x3f6f75),showToast(_0x469b4a(0x205a),_0x469b4a(0x24ab));}},window[_0x2cf6d4(0x9d7)]=async function(_0x39b776,_0x321894=_0x2cf6d4(0xc64)){const _0x2175e9=_0x2cf6d4;console[_0x2175e9(0xc0d)](_0x2175e9(0x1210),_0x39b776,_0x2175e9(0x1cda),_0x321894);try{const _0x5cefca=document[_0x2175e9(0x566)](_0x321894);if(!_0x5cefca){showToast('找不到编辑器',_0x2175e9(0x24ab));return;}const _0x33d967=_0x5cefca[_0x2175e9(0xc34)]['trim']();if(!_0x33d967){showToast(_0x2175e9(0xf43),_0x2175e9(0x13bb));return;}const _0xf93cd6=await db[_0x2175e9(0x75b)][_0x2175e9(0x46a)](_0x39b776);if(!_0xf93cd6){showToast(_0x2175e9(0x1c65),_0x2175e9(0x24ab));return;}if(currentMemoryCharacter&&_0xf93cd6['characterId']!==currentMemoryCharacter['id']){console['error'](_0x2175e9(0x9e0),currentMemoryCharacter['id'],'实际:',_0xf93cd6[_0x2175e9(0x10df)]),showToast(_0x2175e9(0xf0),_0x2175e9(0x24ab));return;}_0xf93cd6[_0x2175e9(0x30b)][_0x2175e9(0x1423)]=_0x2175e9(0x1116)+_0x33d967,_0xf93cd6['timestamp']=Date[_0x2175e9(0x18e0)](),await db['crossAppTimeline']['put'](_0xf93cd6);const _0x1e6353=_0x5cefca[_0x2175e9(0x2026)](_0x2175e9(0x89c));_0x1e6353&&_0x1e6353[_0x2175e9(0x128)](),currentMemoryCharacter&&await loadCharacterMemories(),showToast(_0x2175e9(0x572),_0x2175e9(0xb27)),console['log']('✅\x20线下剧情总结已更新:',_0xf93cd6);}catch(_0x33e1fc){console[_0x2175e9(0x24ab)](_0x2175e9(0x2371),_0x33e1fc),showToast(_0x2175e9(0xe01),_0x2175e9(0x24ab));}};async function buildContinuousWorkingMemory(_0xd92608,_0x5019c2,_0x1e8814=0x32){const _0x475365=_0x2cf6d4;try{_0xd92608=safeCharacterId(_0xd92608);!Array['isArray'](_0x5019c2)&&(console[_0x475365(0x17cc)](_0x475365(0x154b)),_0x5019c2=[]);const _0x3b7548=_0x5019c2['map'](_0x2c0406=>({'type':_0x475365(0x23b3),'timestamp':_0x2c0406[_0x475365(0x7aa)],'content':_0x2c0406,'appType':_0x475365(0x23b3),'characterId':String(_0xd92608)}));let _0x401c46=[];try{const _0x4653b5=await db[_0x475365(0x75b)]['where'](_0x475365(0x10df))['equals'](String(_0xd92608))[_0x475365(0x18c6)]();_0x401c46=_0x4653b5[_0x475365(0x803)](_0x66719c=>{const _0x2505a4=_0x475365;if(_0x66719c[_0x2505a4(0x10df)]!==String(_0xd92608))return console[_0x2505a4(0x17cc)]('🚨\x20工作记忆构建中发现角色ID不匹配的时间线记录:',{'expectedCharacterId':String(_0xd92608),'actualCharacterId':_0x66719c['characterId'],'timelineId':_0x66719c['id'],'action':_0x66719c[_0x2505a4(0x23af)]}),![];return!![];}),_0x4653b5[_0x475365(0xcbf)]!==_0x401c46[_0x475365(0xcbf)]&&console['warn'](_0x475365(0x1482)+(_0x4653b5[_0x475365(0xcbf)]-_0x401c46[_0x475365(0xcbf)])+_0x475365(0x8bb));}catch(_0x1030e3){console['error'](_0x475365(0x1aee)+_0xd92608+':',_0x1030e3),_0x401c46=[];}const _0x11c9b1=_0x401c46['filter'](_0x5e59f6=>_0x5e59f6[_0x475365(0x12e0)]!==_0x475365(0x23b3))[_0x475365(0xf6d)](_0x27df91=>({'type':_0x475365(0x244c),'timestamp':_0x27df91[_0x475365(0x7aa)],'content':_0x27df91,'appType':_0x27df91[_0x475365(0x12e0)],'characterId':_0xd92608})),_0x2e8314=[..._0x3b7548,..._0x11c9b1][_0x475365(0x1f0d)]((_0x4ae5b8,_0x20d0d2)=>_0x4ae5b8[_0x475365(0x7aa)]-_0x20d0d2['timestamp']),_0xf8a8f1=_0x2e8314[_0x475365(0x803)](_0x512041=>_0x512041[_0x475365(0x23df)]===_0x475365(0x23b3)),_0x3ddc39=_0xf8a8f1['map'](_0x271ab6=>_0x271ab6[_0x475365(0x1423)]),_0x43621b=calculateMessagesByRounds(_0x3ddc39,_0x1e8814),_0x4ed126=_0x43621b[_0x475365(0xf6d)](_0x2c71aa=>({'type':_0x475365(0x23b3),'timestamp':_0x2c71aa[_0x475365(0x7aa)],'content':_0x2c71aa,'appType':_0x475365(0x23b3),'characterId':_0xd92608})),_0x3459ea=_0x4ed126[_0x475365(0xcbf)]>0x0?_0x4ed126[0x0][_0x475365(0x7aa)]:0x0,_0x40b5af=_0x11c9b1['filter'](_0x314626=>_0x314626[_0x475365(0x7aa)]>=_0x3459ea),_0x2dc7ed=[..._0x4ed126,..._0x40b5af][_0x475365(0x1f0d)]((_0x6ed02e,_0x5c835)=>_0x6ed02e['timestamp']-_0x5c835['timestamp']);return _0x2dc7ed;}catch(_0x26aea9){return console[_0x475365(0x24ab)](_0x475365(0x839),_0x26aea9),_0x5019c2[_0x475365(0xf6d)](_0x209d09=>({'type':_0x475365(0x23b3),'timestamp':_0x209d09[_0x475365(0x7aa)],'content':_0x209d09,'appType':_0x475365(0x23b3),'characterId':_0xd92608}));}}async function generateCrossAppMemoryDescription(_0x37c66b,_0x2fb9f0){const _0x52555c=_0x2cf6d4;try{const _0x276476=characters['find'](_0x4d65fd=>_0x4d65fd['id']===_0x37c66b);if(!_0x276476)return;let _0x57010a='';const _0x2636a1=_0x2fb9f0[_0x52555c(0x30b)];switch(_0x2fb9f0[_0x52555c(0x12c4)]){case _0x52555c(0x121c):if(_0x2636a1[_0x52555c(0x23af)]===_0x52555c(0xb0e))_0x57010a=_0x52555c(0x644)+_0x2636a1['songTitle']+'》，'+(_0x2636a1[_0x52555c(0x1ff)]||'');else _0x2636a1['action']===_0x52555c(0x1c33)&&(_0x57010a='对歌曲《'+_0x2636a1['songTitle']+_0x52555c(0x80a)+_0x2636a1[_0x52555c(0x8a4)]);break;case _0x52555c(0x3ba):if(_0x2636a1[_0x52555c(0x23af)]==='play_together')_0x57010a=_0x52555c(0x6bc)+_0x2636a1[_0x52555c(0xb02)]+'，'+(_0x2636a1[_0x52555c(0x1fff)]||'');else _0x2636a1[_0x52555c(0x23af)]==='game_comment'&&(_0x57010a=_0x52555c(0x1b0a)+_0x2636a1[_0x52555c(0xb02)]+_0x52555c(0x1519)+_0x2636a1[_0x52555c(0x8a4)]);break;case _0x52555c(0x56e):if(_0x2636a1['action']===_0x52555c(0x53d))_0x57010a='在论坛发表了评论：'+_0x2636a1[_0x52555c(0x8a4)];else _0x2636a1[_0x52555c(0x23af)]===_0x52555c(0x593)&&(_0x57010a=_0x52555c(0x19c7)+_0x2636a1[_0x52555c(0xed1)]+_0x52555c(0x1ce6));break;}if(_0x57010a){const _0x511dec={'id':_0x52555c(0x1744)+_0x37c66b+'_'+Date[_0x52555c(0x18e0)]()+'_'+Math[_0x52555c(0x191c)]()[_0x52555c(0x9a3)](0x24)[_0x52555c(0x18cf)](0x2,0x9),'characterId':_0x37c66b,'fact':_0x57010a,'importance':0.6,'category':'cross_app','timestamp':Date[_0x52555c(0x18e0)](),'sourceEvent':_0x2fb9f0['id']};await db['coreMemories']['add'](_0x511dec),console[_0x52555c(0xc0d)](_0x52555c(0x9ff)+_0x276476[_0x52555c(0x222f)]+_0x52555c(0x23fc)+_0x57010a);}}catch(_0x272410){console[_0x52555c(0x24ab)]('生成跨应用记忆描述失败:',_0x272410);}}async function getCrossAppMemories(_0x4acc6f,_0xb87618=0x5){const _0x509bb8=_0x2cf6d4;try{const _0x318fac=await db[_0x509bb8(0xa1b)][_0x509bb8(0x4a6)]('characterId')[_0x509bb8(0x14a)](_0x4acc6f)['toArray'](),_0x35ae00=_0x318fac['filter'](_0x495811=>_0x495811[_0x509bb8(0x1dd5)]===_0x509bb8(0x244c))['sort']((_0x14a28a,_0x3db62a)=>_0x3db62a['timestamp']-_0x14a28a[_0x509bb8(0x7aa)])[_0x509bb8(0x136)](0x0,_0xb87618);return _0x35ae00[_0x509bb8(0xf6d)](_0x5d63cc=>_0x5d63cc[_0x509bb8(0x77b)]);}catch(_0x21861a){return console[_0x509bb8(0x24ab)](_0x509bb8(0x7e2),_0x21861a),[];}}async function cleanupDuplicateMemories(_0x16cad9){const _0x31e0c6=_0x2cf6d4;try{const _0x57b620=await db[_0x31e0c6(0xa1b)]['where'](_0x31e0c6(0x10df))[_0x31e0c6(0x14a)](_0x16cad9)[_0x31e0c6(0x18c6)](),_0x54edec=[];for(let _0x1a624e=0x0;_0x1a624e<_0x57b620[_0x31e0c6(0xcbf)];_0x1a624e++){for(let _0x564282=_0x1a624e+0x1;_0x564282<_0x57b620[_0x31e0c6(0xcbf)];_0x564282++){const _0x891bde=calculateTextSimilarity(_0x57b620[_0x1a624e][_0x31e0c6(0x77b)],_0x57b620[_0x564282][_0x31e0c6(0x77b)]);if(_0x891bde>0.95){const _0x19e389=_0x57b620[_0x1a624e][_0x31e0c6(0x3d1)]>=_0x57b620[_0x564282][_0x31e0c6(0x3d1)]?_0x57b620[_0x564282]:_0x57b620[_0x1a624e];!_0x54edec['find'](_0x5e3794=>_0x5e3794['id']===_0x19e389['id'])&&(_0x54edec[_0x31e0c6(0x6ee)](_0x19e389),console[_0x31e0c6(0xc0d)]('🔍\x20发现高度重复记忆\x20(相似度:\x20'+(_0x891bde*0x64)[_0x31e0c6(0x3cd)](0x1)+_0x31e0c6(0x6c6)),console[_0x31e0c6(0xc0d)](_0x31e0c6(0x1ba4)+(_0x57b620[_0x1a624e][_0x31e0c6(0x3d1)]>=_0x57b620[_0x564282][_0x31e0c6(0x3d1)]?_0x57b620[_0x1a624e][_0x31e0c6(0x77b)]:_0x57b620[_0x564282]['fact'])),console[_0x31e0c6(0xc0d)](_0x31e0c6(0x17ec)+_0x19e389[_0x31e0c6(0x77b)]));}}}for(const _0x102544 of _0x54edec){await db['coreMemories'][_0x31e0c6(0xc2b)](_0x102544['id']),console[_0x31e0c6(0xc0d)]('🧹\x20删除高度重复记忆:\x20'+_0x102544['fact']);}_0x54edec['length']>0x0?console[_0x31e0c6(0xc0d)](_0x31e0c6(0x20c0)+_0x54edec[_0x31e0c6(0xcbf)]+_0x31e0c6(0x2090)):console[_0x31e0c6(0xc0d)](_0x31e0c6(0x2136));}catch(_0x1e9c9e){console[_0x31e0c6(0x24ab)](_0x31e0c6(0x1461),_0x1e9c9e);}}async function cleanupIncorrectTimelineRecords(){const _0x3cfb65=_0x2cf6d4;try{console[_0x3cfb65(0xc0d)]('🧹\x20开始清理错误的跨应用时间线记录...');const _0x22a96c=await db[_0x3cfb65(0x75b)][_0x3cfb65(0x4a6)](_0x3cfb65(0x12e0))[_0x3cfb65(0x14a)](_0x3cfb65(0x23b3))[_0x3cfb65(0x18c6)]();for(const _0x5c05f9 of _0x22a96c){await db[_0x3cfb65(0x75b)][_0x3cfb65(0xc2b)](_0x5c05f9['id']);}return console[_0x3cfb65(0xc0d)](_0x3cfb65(0x2310)+_0x22a96c['length']+_0x3cfb65(0x10b2)),_0x22a96c['length'];}catch(_0x35b95a){return console['error'](_0x3cfb65(0x21fb),_0x35b95a),0x0;}}async function logMemoryUsageStats(_0x29d0b0,_0x254595){const _0x55576c=_0x2cf6d4;try{const _0x1d267e=_0x29d0b0[_0x55576c(0x4b7)]?_0x55576c(0x22f5):_0x29d0b0['id'],_0x21c98b=getGlobalMemorySettings();console[_0x55576c(0xc0d)]('\x0a📊\x20=====\x20记忆使用统计\x20('+_0x254595+_0x55576c(0x178c)),console[_0x55576c(0xc0d)](_0x55576c(0x11d5)+_0x29d0b0[_0x55576c(0x222f)]+'\x20('+(_0x29d0b0[_0x55576c(0x4b7)]?'群聊':'单聊')+')'),console[_0x55576c(0xc0d)]('⏰\x20记忆天数设置:\x20'+_0x21c98b['memoryDays']+'天');if(_0x29d0b0[_0x55576c(0x4b7)])for(const _0x5f3c9e of _0x29d0b0[_0x55576c(0xcaa)]){await logSingleCharacterMemoryStats(_0x5f3c9e['id'],_0x5f3c9e[_0x55576c(0x222f)],_0x21c98b[_0x55576c(0x356)]);}else await logSingleCharacterMemoryStats(_0x29d0b0['id'],_0x29d0b0[_0x55576c(0x222f)],_0x21c98b['memoryDays']);console[_0x55576c(0xc0d)](_0x55576c(0x1a8b));}catch(_0x4f8947){console[_0x55576c(0x24ab)](_0x55576c(0x217b),_0x4f8947);}}async function logSingleCharacterMemoryStats(_0x57aa5c,_0x152f4b,_0x1f484e){const _0x309b95=_0x2cf6d4;try{const _0x3fc39b=await db[_0x309b95(0xa1b)][_0x309b95(0x4a6)]('characterId')[_0x309b95(0x14a)](_0x57aa5c)[_0x309b95(0x18c6)](),_0x1d9028=_0x3fc39b[_0x309b95(0x136)](0x0,0xa),_0x51ecf8=Date[_0x309b95(0x18e0)]()-_0x1f484e*0x18*0x3c*0x3c*0x3e8,_0x22395a=await db['episodicMemories'][_0x309b95(0x4a6)](_0x309b95(0x10df))['equals'](_0x57aa5c)[_0x309b95(0x1534)](_0xca3a36=>_0xca3a36['timestamp']>=_0x51ecf8)['toArray'](),_0x5d1284=_0x22395a[_0x309b95(0x136)](0x0,0xf),_0x55f753=await db['crossAppTimeline']['where'](_0x309b95(0x10df))['equals'](_0x57aa5c)[_0x309b95(0x1534)](_0x1f63f5=>_0x1f63f5[_0x309b95(0x7aa)]>=_0x51ecf8)[_0x309b95(0x18c6)](),_0x273fe5=_0x55f753[_0x309b95(0x136)](0x0,0x14),_0x2f59fe=new Date(_0x51ecf8)[_0x309b95(0xa4b)]()[_0x309b95(0x633)]('T')[0x0],_0x8d1a2b=await db[_0x309b95(0x1982)][_0x309b95(0x4a6)](_0x309b95(0x10df))[_0x309b95(0x14a)](_0x57aa5c)[_0x309b95(0x1534)](_0x21aa27=>_0x21aa27[_0x309b95(0x1c5b)]>=_0x2f59fe)[_0x309b95(0x18c6)](),_0xee5a14=_0x8d1a2b[_0x309b95(0x136)](0x0,0xa),_0x31b7ee=_0x1d9028[_0x309b95(0x14f5)]((_0x4782ca,_0x168e14)=>_0x4782ca+(_0x168e14[_0x309b95(0x77b)]?.['length']||0x0),0x0)*1.5,_0x3e9603=_0x5d1284[_0x309b95(0x14f5)]((_0x5de03b,_0x23f5dd)=>_0x5de03b+(_0x23f5dd[_0x309b95(0x77b)]?.[_0x309b95(0xcbf)]||0x0),0x0)*1.5,_0x5a6d1c=_0x273fe5['reduce']((_0x4d9aed,_0x453db6)=>_0x4d9aed+(_0x453db6[_0x309b95(0x30b)]?.[_0x309b95(0x1423)]?.['length']||0x0),0x0)*1.5,_0x20ef02=_0xee5a14[_0x309b95(0x14f5)]((_0x466193,_0x4d5e68)=>_0x466193+(_0x4d5e68[_0x309b95(0x1354)]?.[_0x309b95(0xcbf)]||0x0),0x0)*1.5,_0x51c15f=_0x31b7ee+_0x3e9603+_0x5a6d1c+_0x20ef02;console[_0x309b95(0xc0d)](_0x309b95(0x188d)+_0x152f4b+_0x309b95(0x192)+_0x57aa5c+'):'),console[_0x309b95(0xc0d)](_0x309b95(0xbb8)+_0x1d9028['length']+'条\x20(总库存:\x20'+_0x3fc39b['length']+_0x309b95(0xb43)+Math[_0x309b95(0x5f3)](_0x31b7ee)+_0x309b95(0xc76)),console['log']('\x20\x20🟠\x20情景记忆:\x20'+_0x5d1284[_0x309b95(0xcbf)]+_0x309b95(0x1edf)+_0x22395a[_0x309b95(0xcbf)]+_0x309b95(0xb43)+Math[_0x309b95(0x5f3)](_0x3e9603)+_0x309b95(0xc76)),console[_0x309b95(0xc0d)]('\x20\x20🟣\x20时间线记忆:\x20'+_0x273fe5[_0x309b95(0xcbf)]+_0x309b95(0x1edf)+_0x55f753['length']+_0x309b95(0xb43)+Math[_0x309b95(0x5f3)](_0x5a6d1c)+'tokens'),console['log'](_0x309b95(0x965)+_0xee5a14[_0x309b95(0xcbf)]+'条\x20(总库存:\x20'+_0x8d1a2b['length']+_0x309b95(0xb43)+Math[_0x309b95(0x5f3)](_0x20ef02)+_0x309b95(0xc76)),console[_0x309b95(0xc0d)]('\x20\x20💰\x20记忆总消耗:\x20~'+Math[_0x309b95(0x5f3)](_0x51c15f)+_0x309b95(0xc76));const _0x57757e=getCurrentChatSettings()['historyCount']||0x5,_0x42fa3c=Math[_0x309b95(0x1dac)](_0x57757e*0.3),_0x3e8c38=_0x57757e-_0x42fa3c;console['log'](_0x309b95(0x14e6)),console[_0x309b95(0xc0d)]('\x20\x20📝\x20工作记忆构成:'),console[_0x309b95(0xc0d)](_0x309b95(0xc58)+_0x3e8c38+'条\x20(用户设置:\x20'+_0x57757e+'条)'),console[_0x309b95(0xc0d)](_0x309b95(0x1194)+_0x42fa3c+'条\x20(自动集成)'),console[_0x309b95(0xc0d)](_0x309b95(0x738)+_0x57757e+_0x309b95(0x17e0));}catch(_0x88935c){console['error'](_0x309b95(0x1d1e)+_0x152f4b+_0x309b95(0x20a6),_0x88935c);}}async function deleteRelatedTimelineEvents(_0x447743){const _0x99dca5=_0x2cf6d4;try{const _0x331540=currentChatCharacter['id'],_0x5db7c9=_0x447743['id'],_0x491199=_0x447743['timestamp'],_0x396926=typeof _0x447743['content']===_0x99dca5(0xb97)?_0x447743[_0x99dca5(0x1423)]:_0x447743[_0x99dca5(0x1423)]?.[_0x99dca5(0x1e58)]||_0x447743['content']?.[_0x99dca5(0xd7a)]||'';let _0x138653=[];_0x5db7c9&&(_0x138653=await db[_0x99dca5(0x75b)][_0x99dca5(0x4a6)](_0x99dca5(0x61f))[_0x99dca5(0x14a)](String(_0x5db7c9))[_0x99dca5(0x18c6)](),console['log'](_0x99dca5(0x1bec)+_0x138653[_0x99dca5(0xcbf)]+_0x99dca5(0x2378)));_0x138653[_0x99dca5(0xcbf)]===0x0&&_0x491199&&_0x396926&&(_0x138653=await db[_0x99dca5(0x75b)][_0x99dca5(0x4a6)]('characterId')['equals'](_0x331540)[_0x99dca5(0x1534)](_0x91ec9c=>{const _0x471a60=_0x99dca5,_0x1b8f21=Math[_0x471a60(0x2424)](_0x91ec9c[_0x471a60(0x7aa)]-_0x491199);if(_0x1b8f21>0x1e*0x3e8)return![];const _0x1ac94=_0x91ec9c[_0x471a60(0x30b)]?.[_0x471a60(0x1423)]||'',_0x1f4192=_0x396926[_0x471a60(0x4b2)](0x0,0x14)===_0x1ac94[_0x471a60(0x4b2)](0x0,0x14);return _0x1f4192;})[_0x99dca5(0x18c6)](),console[_0x99dca5(0xc0d)](_0x99dca5(0x985)+_0x138653[_0x99dca5(0xcbf)]+'\x20条时间线记录'));if(_0x138653[_0x99dca5(0xcbf)]===0x0&&_0x396926[_0x99dca5(0x23ec)](_0x99dca5(0x20c3))||_0x396926[_0x99dca5(0x23ec)](_0x99dca5(0x23e6))){console[_0x99dca5(0xc0d)](_0x99dca5(0x1d7));return;}for(const _0x55ff00 of _0x138653){await db[_0x99dca5(0x75b)][_0x99dca5(0xc2b)](_0x55ff00['id']);const _0x33db25=_0x55ff00['context']?.[_0x99dca5(0x1423)]&&typeof _0x55ff00['context'][_0x99dca5(0x1423)]==='string'?_0x55ff00[_0x99dca5(0x30b)]['content'][_0x99dca5(0x4b2)](0x0,0x32):'无内容';console[_0x99dca5(0xc0d)](_0x99dca5(0x1f3a)+_0x55ff00['action']+_0x99dca5(0x2316)+_0x33db25+_0x99dca5(0x12da));}console[_0x99dca5(0xc0d)](_0x99dca5(0x1f36)+_0x138653[_0x99dca5(0xcbf)]+'\x20条相关时间线记录');}catch(_0x4afe83){console['error'](_0x99dca5(0xaad),_0x4afe83);}}async function deleteSMSRelatedTimelineEvents(_0x51fcd1,_0x43707c){const _0xfba553=_0x2cf6d4;try{const _0x2af87f=_0x51fcd1[_0xfba553(0x1423)],_0x8c14b2=_0x51fcd1[_0xfba553(0x7aa)],_0x578e93=await db['crossAppTimeline'][_0xfba553(0x4a6)]('characterId')[_0xfba553(0x14a)](_0x43707c)[_0xfba553(0x1534)](_0x5df719=>{const _0x325ceb=_0xfba553;if(_0x5df719['appType']!==_0x325ceb(0x1bc6))return![];if(_0x5df719[_0x325ceb(0x61f)]===_0x51fcd1['id'])return!![];const _0x29889f=Math[_0x325ceb(0x2424)](_0x5df719['timestamp']-_0x8c14b2),_0x2c05b5=_0x29889f<0x5*0x3c*0x3e8,_0x3a964b=_0x5df719[_0x325ceb(0x30b)]&&_0x5df719['context']['content']&&typeof _0x5df719['context'][_0x325ceb(0x1423)]===_0x325ceb(0xb97)&&_0x2af87f&&typeof _0x2af87f==='string'&&_0x5df719['context'][_0x325ceb(0x1423)][_0x325ceb(0x23ec)](_0x2af87f['substring'](0x0,0x1e));return _0x2c05b5&&_0x3a964b;})[_0xfba553(0x18c6)]();for(const _0x4d10e1 of _0x578e93){await db[_0xfba553(0x75b)]['delete'](_0x4d10e1['id']);const _0x539f20=_0x4d10e1['context']?.['content']&&typeof _0x4d10e1[_0xfba553(0x30b)][_0xfba553(0x1423)]==='string'?_0x4d10e1[_0xfba553(0x30b)][_0xfba553(0x1423)][_0xfba553(0x4b2)](0x0,0x32):'无内容';console[_0xfba553(0xc0d)]('🗑️\x20删除短信相关时间线记录:\x20'+_0x4d10e1['action']+'\x20-\x20'+_0x539f20+'...');}console[_0xfba553(0xc0d)](_0xfba553(0x1f36)+_0x578e93[_0xfba553(0xcbf)]+'\x20条短信相关时间线记录');}catch(_0x4c93b7){console[_0xfba553(0x24ab)](_0xfba553(0x1e80),_0x4c93b7);}}async function cleanupLowQualityMemories(_0x2a0f3c){const _0xa98e39=_0x2cf6d4;try{console['log']('🧹\x20开始检查角色\x20'+_0x2a0f3c+_0xa98e39(0x1c7e));const _0xb3a012=MEMORY_CONFIG[_0xa98e39(0x6c7)],_0x1ea2f8=await db[_0xa98e39(0xa1b)]['where']('characterId')[_0xa98e39(0x14a)](_0x2a0f3c)[_0xa98e39(0x1534)](_0x58beaa=>(_0x58beaa[_0xa98e39(0x3d1)]||0x0)<_0xb3a012)[_0xa98e39(0x18c6)]();return _0x1ea2f8[_0xa98e39(0xcbf)]>0x0&&(console[_0xa98e39(0xc0d)](_0xa98e39(0x20b)+_0x1ea2f8[_0xa98e39(0xcbf)]+'\x20条重要性低于阈值的核心记忆，但核心记忆永久保存，不会自动删除'),_0x1ea2f8[_0xa98e39(0x900)](_0x4a2611=>{const _0x52ec48=_0xa98e39;console[_0x52ec48(0xc0d)](_0x52ec48(0x640)+_0x4a2611[_0x52ec48(0x3d1)]+'):\x20'+_0x4a2611[_0x52ec48(0x77b)]);})),console[_0xa98e39(0xc0d)](_0xa98e39(0x177)+_0x1ea2f8[_0xa98e39(0xcbf)]+_0xa98e39(0x1253)),0x0;}catch(_0x3eb0eb){return console[_0xa98e39(0x24ab)](_0xa98e39(0x4a2),_0x3eb0eb),0x0;}}let currentMemoryFilter=_0x2cf6d4(0x2339),currentMemoryCharacter=null,allMemories=[];async function initMemoryViewer(){await loadCharacterSelectOptions();}async function loadCharacterSelectOptions(){const _0x4daa2c=_0x2cf6d4,_0x36f831=document[_0x4daa2c(0x566)](_0x4daa2c(0x1f08));if(!_0x36f831)return;_0x36f831[_0x4daa2c(0xc02)]=_0x4daa2c(0x2285),characters['forEach'](_0x4ba4e3=>{const _0x5b1c68=_0x4daa2c,_0x50f8ec=document[_0x5b1c68(0x1ad8)](_0x5b1c68(0x1e6c));_0x50f8ec[_0x5b1c68(0xc34)]=_0x4ba4e3['id'],_0x50f8ec[_0x5b1c68(0x21dc)]=_0x4ba4e3[_0x5b1c68(0x222f)],_0x36f831[_0x5b1c68(0x1925)](_0x50f8ec);});}async function loadCharacterMemories(){const _0x108ff8=_0x2cf6d4,_0x178092=document[_0x108ff8(0x566)](_0x108ff8(0x1f08)),_0xe792f6=_0x178092['value'];if(!_0xe792f6){currentMemoryCharacter=null,allMemories=[],renderMemoryList();return;}currentMemoryCharacter=characters[_0x108ff8(0x1aeb)](_0x386ec1=>_0x386ec1['id']===_0xe792f6);if(!currentMemoryCharacter){console['error'](_0x108ff8(0xa73),_0xe792f6),showToast(_0x108ff8(0x2389),_0x108ff8(0x24ab));return;}try{const [_0x537130,_0x595fc0,_0x322e65,_0x14963e]=await Promise[_0x108ff8(0x2339)]([db[_0x108ff8(0xa1b)][_0x108ff8(0x4a6)](_0x108ff8(0x10df))['equals'](_0xe792f6)[_0x108ff8(0x18c6)](),db[_0x108ff8(0x222e)]['where']('characterId')[_0x108ff8(0x14a)](_0xe792f6)[_0x108ff8(0x18c6)](),db[_0x108ff8(0x1982)][_0x108ff8(0x4a6)]('characterId')[_0x108ff8(0x14a)](_0xe792f6)[_0x108ff8(0x18c6)](),db[_0x108ff8(0x75b)][_0x108ff8(0x4a6)](_0x108ff8(0x10df))['equals'](_0xe792f6)['toArray']()]);console[_0x108ff8(0xc0d)](_0x108ff8(0x2077)+_0xe792f6+_0x108ff8(0x1dc4),_0x14963e[_0x108ff8(0xcbf)],'条'),_0x14963e[_0x108ff8(0x900)]((_0x20dcd6,_0x439191)=>{const _0x3bbff5=_0x108ff8;_0x439191<0x5&&console[_0x3bbff5(0xc0d)]('\x20\x20'+(_0x439191+0x1)+'.\x20'+_0x20dcd6[_0x3bbff5(0x12e0)]+'.'+_0x20dcd6[_0x3bbff5(0x23af)]+_0x3bbff5(0x1b2b)+_0x20dcd6[_0x3bbff5(0x30b)]?.['id']+',\x20type:\x20'+_0x20dcd6[_0x3bbff5(0x30b)]?.[_0x3bbff5(0x23df)]+_0x3bbff5(0x232f)+(_0x20dcd6[_0x3bbff5(0x30b)]?.[_0x3bbff5(0x1eb)]||'无'));});const _0x3a219a=await db[_0x108ff8(0x75b)][_0x108ff8(0x4a6)](_0x108ff8(0x10df))[_0x108ff8(0x14a)](_0xe792f6)[_0x108ff8(0x1534)](_0x5ee140=>{const _0x254944=_0x108ff8;return _0x5ee140[_0x254944(0x23af)]===_0x254944(0x348)&&_0x5ee140[_0x254944(0x12e0)]===_0x254944(0x73b)&&_0x5ee140[_0x254944(0x10df)]===_0xe792f6;})[_0x108ff8(0x18c6)](),_0x1695c2=_0x3a219a['filter'](_0x38a4cd=>{const _0x43776d=_0x108ff8;if(_0x38a4cd[_0x43776d(0x10df)]!==_0xe792f6)return console[_0x43776d(0x17cc)](_0x43776d(0x250e),{'expectedCharacterId':_0xe792f6,'actualCharacterId':_0x38a4cd[_0x43776d(0x10df)],'summaryId':_0x38a4cd['id']}),![];return!![];});console[_0x108ff8(0xc0d)](_0x108ff8(0x251d)+_0x1695c2['length']+'条\x20(原始查询:\x20'+_0x3a219a[_0x108ff8(0xcbf)]+'条)'),console[_0x108ff8(0xc0d)](_0x108ff8(0x143c)+_0xe792f6),console['log'](_0x108ff8(0xe12)+_0x537130['length']+'条'),console['log']('\x20\x20情景记忆:\x20'+_0x595fc0['length']+'条'),console[_0x108ff8(0xc0d)](_0x108ff8(0x18fe)+_0x322e65[_0x108ff8(0xcbf)]+'条'),console['log']('\x20\x20时间线记录:\x20'+_0x14963e[_0x108ff8(0xcbf)]+'条'),console['log'](_0x108ff8(0x10f)+_0x1695c2[_0x108ff8(0xcbf)]+'条'),allMemories=[..._0x537130[_0x108ff8(0xf6d)](_0x9d4f25=>({..._0x9d4f25,'memoryType':'core'})),..._0x595fc0['map'](_0xb68289=>({..._0xb68289,'memoryType':_0x108ff8(0x176)})),..._0x322e65['map'](_0x3b4b5f=>({..._0x3b4b5f,'memoryType':_0x108ff8(0x1354),'fact':_0x3b4b5f[_0x108ff8(0x1354)]})),..._0x14963e[_0x108ff8(0xf6d)](_0x54a899=>({..._0x54a899,'memoryType':_0x108ff8(0x11fb),'fact':formatTimelineEvent(_0x54a899)})),..._0x1695c2[_0x108ff8(0xf6d)](_0x4ad4cf=>{const _0x2fef95=_0x108ff8,_0x12f836=_0x4ad4cf[_0x2fef95(0x30b)]?.['content']||'线下剧情总结',_0x2927fe=_0x12f836[_0x2fef95(0x633)]('\x0a'),_0x1a8754=_0x2927fe[_0x2fef95(0x136)](0x0,0x3)[_0x2fef95(0x140c)]('\x0a')+(_0x2927fe[_0x2fef95(0xcbf)]>0x3?_0x2fef95(0xfab):'');return{..._0x4ad4cf,'memoryType':_0x2fef95(0x104e),'fact':_0x1a8754,'summary':_0x1a8754,'fullContent':_0x12f836};})],console['log'](_0x108ff8(0x2be)+allMemories[_0x108ff8(0xcbf)]+'条'),allMemories[_0x108ff8(0x1f0d)]((_0x13903d,_0x3ad34a)=>_0x3ad34a['timestamp']-_0x13903d[_0x108ff8(0x7aa)]),renderMemoryList();}catch(_0x1f514f){console[_0x108ff8(0x24ab)]('加载角色记忆失败:',_0x1f514f),showToast(_0x108ff8(0x6df),_0x108ff8(0x24ab));}}function switchMemoryFilter(_0x34e2ac){const _0x27b8a1=_0x2cf6d4;currentMemoryFilter=_0x34e2ac,document[_0x27b8a1(0x1ed9)](_0x27b8a1(0x235))[_0x27b8a1(0x900)](_0x5bf8f2=>{const _0x5070cd=_0x27b8a1;_0x5bf8f2[_0x5070cd(0x226e)]['remove'](_0x5070cd(0x105d));}),document[_0x27b8a1(0x15b8)](_0x27b8a1(0x485)+_0x34e2ac+'\x22]')[_0x27b8a1(0x226e)][_0x27b8a1(0xe1)]('active'),renderMemoryList();}function filterMemories(){renderMemoryList();}function renderMemoryList(){const _0x5ba6fe=_0x2cf6d4,_0x1914b9=document[_0x5ba6fe(0x566)](_0x5ba6fe(0x2447));if(!_0x1914b9)return;if(!currentMemoryCharacter||allMemories[_0x5ba6fe(0xcbf)]===0x0){_0x1914b9[_0x5ba6fe(0xc02)]=_0x5ba6fe(0x1a27)+(currentMemoryCharacter?_0x5ba6fe(0x1841):_0x5ba6fe(0x1397))+_0x5ba6fe(0x1fe6);return;}const _0x148afc=document[_0x5ba6fe(0x566)](_0x5ba6fe(0x12c3))[_0x5ba6fe(0xc34)][_0x5ba6fe(0x1d64)]();let _0x2bdb86=allMemories;currentMemoryFilter!=='all'&&(_0x2bdb86=_0x2bdb86['filter'](_0x442467=>_0x442467[_0x5ba6fe(0x948)]===currentMemoryFilter));_0x148afc&&(_0x2bdb86=_0x2bdb86[_0x5ba6fe(0x803)](_0x3378e8=>{const _0xb70db8=_0x5ba6fe,_0x3cc191=_0x3378e8[_0xb70db8(0x77b)]||_0x3378e8[_0xb70db8(0x1354)]||'';return _0x3cc191[_0xb70db8(0x1d64)]()[_0xb70db8(0x23ec)](_0x148afc);}));if(_0x2bdb86[_0x5ba6fe(0xcbf)]===0x0){_0x1914b9[_0x5ba6fe(0xc02)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22memory-empty-state\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-search\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>没有找到匹配的记忆</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';return;}const _0x532003=_0x2bdb86[_0x5ba6fe(0xf6d)](_0x1c9657=>renderMemoryItem(_0x1c9657))['join']('');_0x1914b9[_0x5ba6fe(0xc02)]=_0x532003;}function renderMemoryItem(_0x5b07cd){const _0x3fa9b5=_0x2cf6d4,_0x3dcb3a=new Date(_0x5b07cd['timestamp']||Date[_0x3fa9b5(0x18e0)]()),_0x25f655=isNaN(_0x3dcb3a['getTime']())?'未知日期':_0x3dcb3a[_0x3fa9b5(0x177f)](_0x3fa9b5(0x1c0b)),_0x3762f6=_0x5b07cd[_0x3fa9b5(0x77b)]||_0x5b07cd[_0x3fa9b5(0x1354)]||'',_0x4823f4=_0x5b07cd[_0x3fa9b5(0x3d1)]||0x0,_0x35d226='★'[_0x3fa9b5(0x18bf)](Math[_0x3fa9b5(0x5f3)](_0x4823f4*0x5)),_0x402b75={'core':_0x3fa9b5(0x1ddf),'episodic':_0x3fa9b5(0x404),'storyline':_0x3fa9b5(0x1d10),'timeline':_0x3fa9b5(0xf11)};return _0x3fa9b5(0xc50)+_0x5b07cd['id']+_0x3fa9b5(0x29f)+_0x5b07cd[_0x3fa9b5(0x948)]+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-'+getMemoryTypeIcon(_0x5b07cd['memoryType'])+_0x3fa9b5(0x1ede)+_0x402b75[_0x5b07cd['memoryType']]+_0x3fa9b5(0x1db2)+_0x25f655+_0x3fa9b5(0x69f)+_0x3762f6+_0x3fa9b5(0xc38)+(_0x5b07cd['memoryType']==='core'||_0x5b07cd[_0x3fa9b5(0x948)]===_0x3fa9b5(0x176)?'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22memory-item-importance\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>重要性:</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22importance-stars\x22>'+_0x35d226+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>('+(_0x4823f4*0x64)[_0x3fa9b5(0x3cd)](0x0)+_0x3fa9b5(0x773):'')+_0x3fa9b5(0x1b31)+(_0x5b07cd[_0x3fa9b5(0x948)]===_0x3fa9b5(0x104e)?_0x3fa9b5(0x1b8b)+_0x5b07cd['id']+_0x3fa9b5(0x1874)+_0x5b07cd['id']+_0x3fa9b5(0x229f):'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22memory-action-btn\x22\x20onclick=\x22editMemory(\x27'+_0x5b07cd['id']+_0x3fa9b5(0x1799)+_0x5b07cd[_0x3fa9b5(0x948)]+_0x3fa9b5(0x1be6))+_0x3fa9b5(0x9cb)+_0x5b07cd['id']+_0x3fa9b5(0x1799)+_0x5b07cd[_0x3fa9b5(0x948)]+'\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-trash\x22></i>\x20删除\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';}function getMemoryTypeIcon(_0x3036fd){const _0x450231=_0x2cf6d4,_0x4daa91={'core':_0x450231(0x41d),'episodic':_0x450231(0x39e),'storyline':_0x450231(0x17ca),'timeline':_0x450231(0x1413)};return _0x4daa91[_0x3036fd]||'circle';}function formatTimelineEvent(_0x2b135f){const _0x1988b0=_0x2cf6d4,_0x35ded2={'chat':'聊天','music':'音乐','moments':'动态','diary':'日记'},_0x37ac1c=_0x35ded2[_0x2b135f[_0x1988b0(0x12e0)]]||_0x2b135f['appType'];let _0x1c655b='';try{const _0x51df06=typeof _0x2b135f['context']===_0x1988b0(0xb97)?JSON[_0x1988b0(0x168e)](_0x2b135f[_0x1988b0(0x30b)]):_0x2b135f[_0x1988b0(0x30b)];switch(_0x2b135f[_0x1988b0(0x12e0)]){case _0x1988b0(0x23b3):const _0x203d1e=_0x51df06?.[_0x1988b0(0x23df)]===_0x1988b0(0x1f01)?'群聊':'单聊',_0x5a84d9=_0x51df06?.[_0x1988b0(0x1727)]?'('+_0x51df06[_0x1988b0(0x1727)]+')':'';if(_0x2b135f[_0x1988b0(0x23af)]==='ai_reply')_0x1c655b='在'+_0x203d1e+_0x5a84d9+'中回复了消息';else _0x2b135f[_0x1988b0(0x23af)]===_0x1988b0(0x12b4)?_0x1c655b='在'+_0x203d1e+_0x5a84d9+'中收到用户消息':_0x1c655b='在'+_0x203d1e+_0x5a84d9+_0x1988b0(0xe40);break;case'music':if(_0x51df06[_0x1988b0(0x23af)]===_0x1988b0(0xb0e))_0x1c655b=_0x1988b0(0x1b66)+(_0x51df06[_0x1988b0(0xf68)]||_0x51df06[_0x1988b0(0x1c2d)]||'');else _0x51df06['action']===_0x1988b0(0x1c33)?_0x1c655b=_0x1988b0(0x24b0):_0x1c655b=_0x1988b0(0x1709);break;case _0x1988b0(0x1a72):if(_0x2b135f[_0x1988b0(0x23af)]==='ai_to_ai_reply')_0x1c655b=_0x1988b0(0x1e6a);else _0x2b135f[_0x1988b0(0x23af)]==='reply_to_user'?_0x1c655b=_0x1988b0(0x19e1):_0x1c655b=_0x1988b0(0xf89);break;case _0x1988b0(0x770):_0x1c655b=_0x1988b0(0x1cdf);break;default:_0x1c655b=_0x1988b0(0xdaa)+(_0x2b135f[_0x1988b0(0x23af)]||'未知')+'活动';}}catch(_0xa063db){_0x1c655b='进行了'+(_0x2b135f['action']||'未知')+'活动';}return'【'+_0x37ac1c+'】'+_0x1c655b;}async function refreshMemoryData(){const _0x5b9bb8=_0x2cf6d4;currentMemoryCharacter&&(await loadCharacterMemories(),showToast(_0x5b9bb8(0xb8c),'success'));}async function diagnoseMemoryData(){const _0x3ed573=_0x2cf6d4;if(!currentMemoryCharacter){showToast(_0x3ed573(0x1268),_0x3ed573(0x13bb));return;}try{const _0xece4c4=currentMemoryCharacter?currentMemoryCharacter['id']:null;if(!_0xece4c4){console[_0x3ed573(0x24ab)](_0x3ed573(0x1700));return;}console[_0x3ed573(0xc0d)]('🔍\x20开始诊断角色\x20'+_0xece4c4+_0x3ed573(0xafb));const [_0x1c2734,_0x343545,_0x5cc624,_0x55c0da]=await Promise[_0x3ed573(0x2339)]([db[_0x3ed573(0xa1b)][_0x3ed573(0x4a6)](_0x3ed573(0x10df))[_0x3ed573(0x14a)](_0xece4c4)[_0x3ed573(0x18c6)](),db[_0x3ed573(0x222e)]['where'](_0x3ed573(0x10df))['equals'](_0xece4c4)['toArray'](),db[_0x3ed573(0x1982)][_0x3ed573(0x4a6)]('characterId')[_0x3ed573(0x14a)](_0xece4c4)[_0x3ed573(0x18c6)](),db[_0x3ed573(0x75b)][_0x3ed573(0x4a6)](_0x3ed573(0x10df))['equals'](_0xece4c4)['toArray']()]),[_0x58327e,_0x43cbdb,_0x1d6af4]=await Promise['all']([db[_0x3ed573(0xa1b)][_0x3ed573(0x803)](_0x30fc06=>!_0x30fc06[_0x3ed573(0x10df)]||_0x30fc06[_0x3ed573(0x10df)]==='')['toArray'](),db[_0x3ed573(0x222e)][_0x3ed573(0x803)](_0x2d79dc=>!_0x2d79dc[_0x3ed573(0x10df)]||_0x2d79dc[_0x3ed573(0x10df)]==='')[_0x3ed573(0x18c6)](),db['memorySummaries'][_0x3ed573(0x803)](_0x21f97a=>!_0x21f97a['characterId']||_0x21f97a[_0x3ed573(0x10df)]==='')['toArray']()]),_0x467990=_0x3ed573(0x7d8)+_0xece4c4+_0x3ed573(0x336)+_0x1c2734[_0x3ed573(0xcbf)]+'条\x0a\x20\x20•\x20情景记忆:\x20'+_0x343545[_0x3ed573(0xcbf)]+_0x3ed573(0x1863)+_0x5cc624[_0x3ed573(0xcbf)]+_0x3ed573(0xddc)+_0x55c0da['length']+_0x3ed573(0x1c63)+_0x58327e['length']+_0x3ed573(0x558)+_0x43cbdb[_0x3ed573(0xcbf)]+'条\x0a\x20\x20•\x20孤立记忆摘要:\x20'+_0x1d6af4[_0x3ed573(0xcbf)]+_0x3ed573(0xbc8)+(_0x58327e[_0x3ed573(0xcbf)]>0x0||_0x43cbdb[_0x3ed573(0xcbf)]>0x0||_0x1d6af4[_0x3ed573(0xcbf)]>0x0?_0x3ed573(0x2067):_0x3ed573(0x3a4))+_0x3ed573(0x1edd);alert(_0x467990),(_0x58327e[_0x3ed573(0xcbf)]>0x0||_0x43cbdb[_0x3ed573(0xcbf)]>0x0||_0x1d6af4[_0x3ed573(0xcbf)]>0x0)&&(confirm(_0x3ed573(0x1d28))&&await recoverOrphanedMemories(_0xece4c4,_0x58327e,_0x43cbdb,_0x1d6af4));}catch(_0x3b2b78){console[_0x3ed573(0x24ab)]('记忆数据诊断失败:',_0x3b2b78),showToast(_0x3ed573(0xad9)+_0x3b2b78['message'],_0x3ed573(0x24ab));}}async function recoverOrphanedMemories(_0x488738,_0x2a3dc4,_0x2ecbe2,_0x233612){const _0x5d1165=_0x2cf6d4;try{let _0x484488=0x0;for(const _0x5163ad of _0x2a3dc4){_0x5163ad[_0x5d1165(0x10df)]=_0x488738,await db[_0x5d1165(0xa1b)][_0x5d1165(0x53a)](_0x5163ad),_0x484488++;}for(const _0x17dd8a of _0x2ecbe2){_0x17dd8a['characterId']=_0x488738,await db['episodicMemories'][_0x5d1165(0x53a)](_0x17dd8a),_0x484488++;}for(const _0x11284e of _0x233612){_0x11284e[_0x5d1165(0x10df)]=_0x488738,await db[_0x5d1165(0x1982)][_0x5d1165(0x53a)](_0x11284e),_0x484488++;}await loadCharacterMemories(),showToast(_0x5d1165(0x1f20)+_0x484488+_0x5d1165(0xd1c),_0x5d1165(0xb27)),console[_0x5d1165(0xc0d)](_0x5d1165(0x10f6)+_0x484488+_0x5d1165(0x1d6));}catch(_0x23ead2){console[_0x5d1165(0x24ab)](_0x5d1165(0x1043),_0x23ead2),showToast(_0x5d1165(0x175a)+_0x23ead2[_0x5d1165(0xd7a)],_0x5d1165(0x24ab));}}async function showAddCoreMemoryForm(){const _0x2a1b86=_0x2cf6d4;if(!currentMemoryCharacter){showToast(_0x2a1b86(0x1268),_0x2a1b86(0x13bb));return;}try{const _0x50dc7f=await showCustomPrompt(_0x2a1b86(0x174c),_0x2a1b86(0xedd));if(_0x50dc7f&&_0x50dc7f[_0x2a1b86(0x1424)]()){const _0x4a0ddd={'id':'core_memory_'+currentMemoryCharacter['id']+'_'+Date[_0x2a1b86(0x18e0)](),'characterId':currentMemoryCharacter['id'],'fact':_0x50dc7f[_0x2a1b86(0x1424)](),'category':_0x2a1b86(0x881),'importance':0.95,'timestamp':Date[_0x2a1b86(0x18e0)](),'lastAccessed':Date[_0x2a1b86(0x18e0)](),'type':'core','source':_0x2a1b86(0x11b2)};await db['coreMemories']['add'](_0x4a0ddd),await loadCharacterMemories(),showToast(_0x2a1b86(0x14ba),_0x2a1b86(0xb27)),console[_0x2a1b86(0xc0d)](_0x2a1b86(0x9ff)+currentMemoryCharacter[_0x2a1b86(0x222f)]+'\x20('+currentMemoryCharacter['id']+_0x2a1b86(0xfd5),_0x50dc7f[_0x2a1b86(0x1424)]());}}catch(_0x490b7b){console[_0x2a1b86(0x24ab)](_0x2a1b86(0xd11),_0x490b7b),showToast(_0x2a1b86(0x10f1)+_0x490b7b[_0x2a1b86(0xd7a)],_0x2a1b86(0x24ab));}}function checkWorldbookMemoryUsage(){const _0x4ab030=_0x2cf6d4;try{const _0x4a5bee=worldbooks[_0x4ab030(0x14f5)]((_0x43dc67,_0xa75a83)=>{const _0x3159f7=_0x4ab030;return _0x43dc67+new Blob([_0xa75a83[_0x3159f7(0x1423)]||''])['size'];},0x0),_0x34dcfa=(_0x4a5bee/(0x400*0x400))[_0x4ab030(0x3cd)](0x2);console[_0x4ab030(0xc0d)](_0x4ab030(0x49b)+_0x34dcfa+'MB\x20('+worldbooks[_0x4ab030(0xcbf)]+_0x4ab030(0x161e));if(_0x4a5bee>0x32*0x400*0x400){console[_0x4ab030(0x17cc)](_0x4ab030(0x1a85));const _0x51f9d6=worldbooks[_0x4ab030(0xf6d)](_0x35cc63=>({'id':_0x35cc63['id'],'title':_0x35cc63['title']||_0x35cc63[_0x4ab030(0x222f)],'size':new Blob([_0x35cc63[_0x4ab030(0x1423)]||''])['size']}))['filter'](_0x150d2c=>_0x150d2c[_0x4ab030(0x41a)]>0x400*0x400)[_0x4ab030(0x1f0d)]((_0x29024c,_0xbbb9ad)=>_0xbbb9ad['size']-_0x29024c[_0x4ab030(0x41a)])[_0x4ab030(0x136)](0x0,0x5);_0x51f9d6[_0x4ab030(0xcbf)]>0x0&&console['log'](_0x4ab030(0xc0b),_0x51f9d6[_0x4ab030(0xf6d)](_0x81e302=>_0x81e302['title']+':\x20'+(_0x81e302[_0x4ab030(0x41a)]/(0x400*0x400))[_0x4ab030(0x3cd)](0x2)+'MB'));}return{'totalSize':_0x4a5bee,'totalSizeMB':_0x34dcfa,'count':worldbooks[_0x4ab030(0xcbf)]};}catch(_0x1ea0db){return console[_0x4ab030(0x24ab)]('检查世界书内存使用失败:',_0x1ea0db),null;}}setInterval(()=>{const _0x319c04=_0x2cf6d4;worldbooks[_0x319c04(0xcbf)]>0x0&&checkWorldbookMemoryUsage();},0x5*0x3c*0x3e8);async function cleanupIncorrectRecords(){const _0x433a6b=_0x2cf6d4;if(!confirm('确定要清理错误的记录吗？这将删除跨应用时间线中错误的聊天记录。'))return;try{const _0x17a161=await cleanupIncorrectTimelineRecords();await loadCharacterMemories(),showToast(_0x433a6b(0x1513)+_0x17a161+_0x433a6b(0x1400),_0x433a6b(0xb27));}catch(_0x4ae291){console[_0x433a6b(0x24ab)](_0x433a6b(0x21fb),_0x4ae291),showToast(_0x433a6b(0x13d2),'error');}}async function testCrossAppMemorySharing(_0x46e683){const _0x56a871=_0x2cf6d4;console[_0x56a871(0xc0d)](_0x56a871(0x1c56));try{console[_0x56a871(0xc0d)](_0x56a871(0xc12)),await recordCrossAppEvent(_0x46e683,'sms',_0x56a871(0x12b4),{'id':_0x46e683,'type':_0x56a871(0x216f),'content':'测试短信内容：我刚刚吃了冰淇淋','chatId':_0x46e683,'sender':'user'},_0x56a871(0x1d3f)+Date['now']()),await new Promise(_0x8f0a44=>setTimeout(_0x8f0a44,0x3e8)),console[_0x56a871(0xc0d)](_0x56a871(0x2165));const _0x10e8d0=await getCrossAppTimeline(_0x46e683,0xa);console[_0x56a871(0xc0d)](_0x56a871(0x219),_0x10e8d0[_0x56a871(0xcbf)]);const _0x283aa7=_0x10e8d0['filter'](_0x1cd10c=>_0x1cd10c['appType']===_0x56a871(0x1bc6));console['log'](_0x56a871(0xee7),_0x283aa7[_0x56a871(0xcbf)]);_0x283aa7[_0x56a871(0xcbf)]>0x0?(console[_0x56a871(0xc0d)]('✅\x20成功！chatapp可以读取到短信事件'),_0x283aa7[_0x56a871(0x900)]((_0x328220,_0x27932e)=>{const _0x1fbc9a=_0x56a871;console['log']('📱\x20短信事件\x20'+(_0x27932e+0x1)+':',{'action':_0x328220[_0x1fbc9a(0x23af)],'content':_0x328220[_0x1fbc9a(0x30b)]?.[_0x1fbc9a(0x1423)]?.['substring'](0x0,0x32),'timestamp':new Date(_0x328220[_0x1fbc9a(0x7aa)])[_0x1fbc9a(0x133a)]()});})):console[_0x56a871(0xc0d)](_0x56a871(0x1e3c));console[_0x56a871(0xc0d)](_0x56a871(0x16fb));const _0x1fc989=await buildGlobalMemoryContext(_0x46e683,{'id':_0x46e683,'type':_0x56a871(0x10d7)},0x7);_0x1fc989[_0x56a871(0x23ec)]('短信')||_0x1fc989[_0x56a871(0x23ec)]('冰淇淋')?(console[_0x56a871(0xc0d)](_0x56a871(0x21e1)),console[_0x56a871(0xc0d)](_0x56a871(0x16cb),_0x1fc989[_0x56a871(0x4b2)](0x0,0x1f4)+'...')):(console[_0x56a871(0xc0d)](_0x56a871(0xf76)),console[_0x56a871(0xc0d)]('🧠\x20记忆上下文内容:',_0x1fc989));}catch(_0x4636bf){console[_0x56a871(0x24ab)]('❌\x20测试过程中发生错误:',_0x4636bf);}}async function cleanupDuplicateTimelineEvents(_0x12c918){const _0x5001f4=_0x2cf6d4;try{console[_0x5001f4(0xc0d)](_0x5001f4(0xcf0)+_0x12c918+_0x5001f4(0x1ed8));const _0x1a2d7c=await db[_0x5001f4(0x75b)][_0x5001f4(0x4a6)](_0x5001f4(0x10df))[_0x5001f4(0x14a)](_0x12c918)[_0x5001f4(0x18c6)](),_0x3bf0b3=[],_0x19a982=new Map();for(const _0x23b264 of _0x1a2d7c){const _0x513866=_0x23b264[_0x5001f4(0x30b)]?.[_0x5001f4(0x1423)];if(_0x513866){const _0x3f0cce=_0x513866['toLowerCase']()[_0x5001f4(0x1424)]();if(_0x19a982[_0x5001f4(0x1af1)](_0x3f0cce)){const _0x1dc793=_0x19a982['get'](_0x3f0cce);_0x23b264[_0x5001f4(0x7aa)]>_0x1dc793['timestamp']?_0x3bf0b3[_0x5001f4(0x6ee)](_0x23b264):(_0x3bf0b3['push'](_0x1dc793),_0x19a982[_0x5001f4(0x21c0)](_0x3f0cce,_0x23b264));}else _0x19a982[_0x5001f4(0x21c0)](_0x3f0cce,_0x23b264);}}for(const _0x3eb688 of _0x3bf0b3){await db['crossAppTimeline']['delete'](_0x3eb688['id']),console[_0x5001f4(0xc0d)](_0x5001f4(0xd89)+_0x3eb688['action']+_0x5001f4(0x2316)+_0x3eb688['context']?.[_0x5001f4(0x1423)]?.[_0x5001f4(0x4b2)](0x0,0x32)+_0x5001f4(0x12da));}return console[_0x5001f4(0xc0d)](_0x5001f4(0x2310)+_0x3bf0b3['length']+_0x5001f4(0x501)),_0x3bf0b3[_0x5001f4(0xcbf)];}catch(_0x24e245){return console['error'](_0x5001f4(0x15d6),_0x24e245),0x0;}}function showMemorySettings(){const _0x260e5e=_0x2cf6d4;document[_0x260e5e(0x566)]('aiExtractInterval')[_0x260e5e(0xc34)]=MEMORY_CONFIG[_0x260e5e(0xa2c)]/0x2,document[_0x260e5e(0x566)](_0x260e5e(0xa9a))[_0x260e5e(0xc34)]=MEMORY_CONFIG['CORE_MEMORY_IMPORTANCE_THRESHOLD'],document[_0x260e5e(0x566)](_0x260e5e(0xe8f))[_0x260e5e(0xc34)]=MEMORY_CONFIG[_0x260e5e(0x1f28)],updateThresholdDisplay(),document['getElementById'](_0x260e5e(0x4c3))[_0x260e5e(0x655)][_0x260e5e(0x2526)]=_0x260e5e(0x1f0b);}function closeMemorySettings(){const _0x41bd09=_0x2cf6d4;document[_0x41bd09(0x566)](_0x41bd09(0x4c3))[_0x41bd09(0x655)]['display']=_0x41bd09(0xfe9);}function updateThresholdDisplay(){const _0x59d196=_0x2cf6d4,_0x2a2665=document[_0x59d196(0x566)](_0x59d196(0xa9a))[_0x59d196(0xc34)],_0x3fb26b=document['getElementById'](_0x59d196(0xe8f))[_0x59d196(0xc34)];document[_0x59d196(0x566)]('coreThresholdValue')['textContent']=Math[_0x59d196(0x5f3)](_0x2a2665*0x64)+'%',document[_0x59d196(0x566)](_0x59d196(0x298))['textContent']=Math[_0x59d196(0x5f3)](_0x3fb26b*0x64)+'%';}async function saveMemorySettings(){const _0x1de8a7=_0x2cf6d4;try{const _0x2c92d7=parseInt(document[_0x1de8a7(0x566)](_0x1de8a7(0x222c))[_0x1de8a7(0xc34)]),_0x1a5720=parseFloat(document['getElementById']('coreMemoryThreshold')[_0x1de8a7(0xc34)]),_0x1fc456=parseFloat(document[_0x1de8a7(0x566)](_0x1de8a7(0xe8f))['value']);MEMORY_CONFIG[_0x1de8a7(0xa2c)]=_0x2c92d7*0x2,MEMORY_CONFIG['CORE_MEMORY_IMPORTANCE_THRESHOLD']=_0x1a5720,MEMORY_CONFIG[_0x1de8a7(0x1f28)]=_0x1fc456,await saveMemoryConfig(),closeMemorySettings(),showToast(_0x1de8a7(0x16a7),_0x1de8a7(0xb27));}catch(_0x24f518){console[_0x1de8a7(0x24ab)](_0x1de8a7(0x1a9c),_0x24f518),showToast(_0x1de8a7(0x857),_0x1de8a7(0x24ab));}}async function editMemory(_0x4fb3ff,_0x30a752){const _0x3a018d=_0x2cf6d4;try{if(_0x30a752===_0x3a018d(0x11fb)){showToast(_0x3a018d(0x1c3),_0x3a018d(0x13bb));return;}let _0x146b44;if(_0x30a752===_0x3a018d(0x1354))_0x146b44=await db[_0x3a018d(0x1982)][_0x3a018d(0x46a)](_0x4fb3ff);else{if(_0x30a752===_0x3a018d(0x22c1))_0x146b44=await db[_0x3a018d(0xa1b)][_0x3a018d(0x46a)](_0x4fb3ff);else{showToast(_0x3a018d(0x24ff),_0x3a018d(0x24ab));return;}}if(!_0x146b44){showToast(_0x3a018d(0xbcb),_0x3a018d(0x24ab));return;}const _0x1da8e7=_0x146b44[_0x3a018d(0x77b)]||_0x146b44['summary']||'',_0x2b3500=await showCustomPrompt(_0x3a018d(0x131a),_0x3a018d(0x9f6),_0x1da8e7);_0x2b3500&&_0x2b3500[_0x3a018d(0x1424)]()&&_0x2b3500!==_0x1da8e7&&(_0x30a752===_0x3a018d(0x1354)?(_0x146b44['summary']=_0x2b3500[_0x3a018d(0x1424)](),await db[_0x3a018d(0x1982)][_0x3a018d(0x53a)](_0x146b44)):(_0x146b44[_0x3a018d(0x77b)]=_0x2b3500[_0x3a018d(0x1424)](),await db[_0x3a018d(0xa1b)][_0x3a018d(0x53a)](_0x146b44)),await loadCharacterMemories(),showToast(_0x3a018d(0x1d18),'success'));}catch(_0x1cac76){console['error'](_0x3a018d(0xa8b),_0x1cac76),showToast('编辑记忆失败',_0x3a018d(0x24ab));}}async function deleteMemory(_0x3373c4,_0x28bbb0){const _0x146533=_0x2cf6d4;let _0x3e073c='确定要删除这条记忆吗？此操作不可撤销。';if(_0x28bbb0===_0x146533(0x11fb))_0x3e073c='确定要删除这条时间线记录吗？这是自动记录的活动日志，删除后无法恢复。';else _0x28bbb0==='storyline'&&(_0x3e073c=_0x146533(0x1277));if(!confirm(_0x3e073c))return;try{if(_0x28bbb0===_0x146533(0x1354))await db[_0x146533(0x1982)][_0x146533(0xc2b)](_0x3373c4);else{if(_0x28bbb0==='core')await db[_0x146533(0xa1b)][_0x146533(0xc2b)](_0x3373c4);else{if(_0x28bbb0==='episodic')await db[_0x146533(0x222e)]['delete'](_0x3373c4);else{if(_0x28bbb0===_0x146533(0x11fb))await db[_0x146533(0x75b)][_0x146533(0xc2b)](_0x3373c4);else{if(_0x28bbb0===_0x146533(0x104e))await db[_0x146533(0x75b)][_0x146533(0xc2b)](_0x3373c4);else{showToast(_0x146533(0x24ff),_0x146533(0x24ab));return;}}}}}await loadCharacterMemories(),showToast('记忆已删除',_0x146533(0xb27));}catch(_0x351e97){console[_0x146533(0x24ab)](_0x146533(0x1c74),_0x351e97),showToast(_0x146533(0x7f3),'error');}}let heartrateInterval=null,currentHeartrate=0x48;function updateAiHeartrate(){const _0x2e20d4=_0x2cf6d4,_0x615b5e=document['getElementById'](_0x2e20d4(0x12e)),_0x30b594=document[_0x2e20d4(0x566)](_0x2e20d4(0x2519));if(!_0x615b5e||!_0x30b594)return;const _0x525093=getCurrentChatSettings();if(!_0x525093[_0x2e20d4(0xbb1)]||currentChatCharacter&&currentChatCharacter[_0x2e20d4(0x4b7)]){hideAiHeartrate();return;}const _0x291ebf=_0x525093[_0x2e20d4(0xd87)]||_0x2e20d4(0x23a1),_0x3a2b8d=_0x291ebf===_0x2e20d4(0x1417)?_0x30b594:_0x615b5e;_0x615b5e['style'][_0x2e20d4(0x2526)]=_0x291ebf===_0x2e20d4(0x23a1)?_0x2e20d4(0x2d4):'none',_0x30b594[_0x2e20d4(0x655)][_0x2e20d4(0x2526)]=_0x291ebf===_0x2e20d4(0x1417)?_0x2e20d4(0x2d4):_0x2e20d4(0xfe9);const _0x4687b1=(currentChatCharacter[_0x2e20d4(0x1a84)]||'')[_0x2e20d4(0x1d64)](),_0x23b3ce=(currentChatCharacter[_0x2e20d4(0x222f)]||'')[_0x2e20d4(0x1d64)]();let _0x2e68fb=0x48;if(_0x4687b1[_0x2e20d4(0x23ec)]('紧张')||_0x4687b1['includes']('害羞')||_0x4687b1[_0x2e20d4(0x23ec)]('敏感')||_0x4687b1['includes']('羞涩')||_0x4687b1[_0x2e20d4(0x23ec)](_0x2e20d4(0x2494))||_0x4687b1[_0x2e20d4(0x23ec)]('内向'))_0x2e68fb=0x55;else{if(_0x4687b1[_0x2e20d4(0x23ec)]('冷静')||_0x4687b1['includes']('理性')||_0x4687b1[_0x2e20d4(0x23ec)]('成熟')||_0x4687b1[_0x2e20d4(0x23ec)]('沉稳')||_0x4687b1[_0x2e20d4(0x23ec)]('内敛')||_0x4687b1[_0x2e20d4(0x23ec)]('严肃'))_0x2e68fb=0x41;else{if(_0x4687b1[_0x2e20d4(0x23ec)]('活泼')||_0x4687b1[_0x2e20d4(0x23ec)]('兴奋')||_0x4687b1[_0x2e20d4(0x23ec)]('热情')||_0x4687b1[_0x2e20d4(0x23ec)]('开朗')||_0x4687b1[_0x2e20d4(0x23ec)]('外向')||_0x4687b1[_0x2e20d4(0x23ec)]('爱笑'))_0x2e68fb=0x52;else{if(_0x4687b1[_0x2e20d4(0x23ec)]('运动')||_0x4687b1['includes']('健身')||_0x4687b1[_0x2e20d4(0x23ec)]('体育')||_0x4687b1[_0x2e20d4(0x23ec)](_0x2e20d4(0xd4))||_0x4687b1[_0x2e20d4(0x23ec)]('活跃'))_0x2e68fb=0x3a;else{if(_0x4687b1[_0x2e20d4(0x23ec)]('温柔')||_0x4687b1[_0x2e20d4(0x23ec)]('甜美')||_0x4687b1[_0x2e20d4(0x23ec)]('可爱')||_0x4687b1[_0x2e20d4(0x23ec)]('软萌')||_0x4687b1[_0x2e20d4(0x23ec)]('小鸟依人')||_0x4687b1['includes']('乖巧'))_0x2e68fb=0x4b;else{if(_0x4687b1[_0x2e20d4(0x23ec)]('冷酷')||_0x4687b1[_0x2e20d4(0x23ec)]('高冷')||_0x4687b1[_0x2e20d4(0x23ec)]('傲娇')||_0x4687b1['includes']('女王')||_0x4687b1[_0x2e20d4(0x23ec)]('强势')||_0x4687b1[_0x2e20d4(0x23ec)]('霸道'))_0x2e68fb=0x44;else{if(_0x4687b1[_0x2e20d4(0x23ec)]('热血')||_0x4687b1[_0x2e20d4(0x23ec)]('冲动')||_0x4687b1[_0x2e20d4(0x23ec)](_0x2e20d4(0x159e))||_0x4687b1[_0x2e20d4(0x23ec)]('火爆')||_0x4687b1[_0x2e20d4(0x23ec)]('暴躁')||_0x4687b1[_0x2e20d4(0x23ec)]('易怒'))_0x2e68fb=0x58;else(_0x4687b1[_0x2e20d4(0x23ec)]('神秘')||_0x4687b1[_0x2e20d4(0x23ec)]('深沉')||_0x4687b1[_0x2e20d4(0x23ec)]('安静')||_0x4687b1[_0x2e20d4(0x23ec)]('文静')||_0x4687b1[_0x2e20d4(0x23ec)]('内向'))&&(_0x2e68fb=0x46);}}}}}}if(_0x23b3ce[_0x2e20d4(0x23ec)]('小')||_0x23b3ce[_0x2e20d4(0x23ec)]('萌')||_0x23b3ce[_0x2e20d4(0x23ec)]('可爱'))_0x2e68fb+=0x3;else{if(_0x23b3ce['includes']('冰')||_0x23b3ce[_0x2e20d4(0x23ec)]('雪')||_0x23b3ce[_0x2e20d4(0x23ec)]('静')||_0x23b3ce[_0x2e20d4(0x23ec)]('冷')||_0x23b3ce['includes']('凉'))_0x2e68fb-=0x5;else(_0x23b3ce['includes']('火')||_0x23b3ce[_0x2e20d4(0x23ec)]('热')||_0x23b3ce['includes']('烈'))&&(_0x2e68fb+=0x5);}const _0x365b5d=(chatMessages[currentChatCharacter['id']]||[])['slice'](-0x8);let _0x1c1b50=0x0;_0x365b5d['forEach'](_0x206660=>{const _0x3e0b8c=_0x2e20d4;let _0x1656ae='';if(typeof _0x206660[_0x3e0b8c(0x1423)]==='string')_0x1656ae=_0x206660[_0x3e0b8c(0x1423)][_0x3e0b8c(0x1d64)]();else Array[_0x3e0b8c(0x1bcc)](_0x206660['content'])?_0x1656ae='':_0x1656ae='';(_0x1656ae[_0x3e0b8c(0x23ec)]('爱你')||_0x1656ae[_0x3e0b8c(0x23ec)]('我爱你')||_0x1656ae[_0x3e0b8c(0x23ec)](_0x3e0b8c(0x2108))||_0x1656ae[_0x3e0b8c(0x23ec)](_0x3e0b8c(0x1dcd))||_0x1656ae['includes']('想你')||_0x1656ae[_0x3e0b8c(0x23ec)](_0x3e0b8c(0x5b9))||_0x1656ae['includes'](_0x3e0b8c(0x106e))||_0x1656ae['includes']('亲亲')||_0x1656ae[_0x3e0b8c(0x23ec)]('抱抱')||_0x1656ae[_0x3e0b8c(0x23ec)]('宝贝')||_0x1656ae[_0x3e0b8c(0x23ec)]('darling')||_0x1656ae['includes']('honey')||_0x1656ae[_0x3e0b8c(0x23ec)](_0x3e0b8c(0x1a28))||_0x1656ae[_0x3e0b8c(0x23ec)](_0x3e0b8c(0x1f5a))||_0x1656ae['includes']('需要你')||_0x1656ae[_0x3e0b8c(0x23ec)](_0x3e0b8c(0xc3))||_0x1656ae[_0x3e0b8c(0x23ec)](_0x3e0b8c(0xa71))||_0x1656ae[_0x3e0b8c(0x23ec)](_0x3e0b8c(0x210c)))&&(_0x1c1b50+=0xf),(_0x1656ae['includes']('表白')||_0x1656ae[_0x3e0b8c(0x23ec)]('喜欢')||_0x1656ae[_0x3e0b8c(0x23ec)]('心动')||_0x1656ae['includes']('心跳')||_0x1656ae[_0x3e0b8c(0x23ec)]('脸红')||_0x1656ae[_0x3e0b8c(0x23ec)]('害羞')||_0x1656ae['includes']('可爱')||_0x1656ae[_0x3e0b8c(0x23ec)]('甜')||_0x1656ae['includes']('温柔')||_0x1656ae[_0x3e0b8c(0x23ec)]('美丽')||_0x1656ae[_0x3e0b8c(0x23ec)]('漂亮')||_0x1656ae[_0x3e0b8c(0x23ec)]('迷人')||_0x1656ae[_0x3e0b8c(0x23ec)]('魅力')||_0x1656ae['includes']('吸引')||_0x1656ae[_0x3e0b8c(0x23ec)]('心仪'))&&(_0x1c1b50+=0xa),(_0x1656ae[_0x3e0b8c(0x23ec)]('撒娇')||_0x1656ae[_0x3e0b8c(0x23ec)]('嘤嘤')||_0x1656ae[_0x3e0b8c(0x23ec)]('哼')||_0x1656ae[_0x3e0b8c(0x23ec)]('人家')||_0x1656ae['includes']('讨厌')||_0x1656ae[_0x3e0b8c(0x23ec)]('不要')||_0x1656ae[_0x3e0b8c(0x23ec)](_0x3e0b8c(0xd25))||_0x1656ae[_0x3e0b8c(0x23ec)]('求你')||_0x1656ae[_0x3e0b8c(0x23ec)]('拜托')||_0x1656ae[_0x3e0b8c(0x23ec)]('陪我')||_0x1656ae[_0x3e0b8c(0x23ec)]('陪陪')||_0x1656ae[_0x3e0b8c(0x23ec)]('一起'))&&(_0x1c1b50+=0x8),(_0x1656ae[_0x3e0b8c(0x23ec)]('开心')||_0x1656ae[_0x3e0b8c(0x23ec)]('高兴')||_0x1656ae[_0x3e0b8c(0x23ec)]('快乐')||_0x1656ae[_0x3e0b8c(0x23ec)]('兴奋')||_0x1656ae[_0x3e0b8c(0x23ec)]('激动')||_0x1656ae[_0x3e0b8c(0x23ec)]('好棒')||_0x1656ae[_0x3e0b8c(0x23ec)]('厉害')||_0x1656ae[_0x3e0b8c(0x23ec)]('哇')||_0x1656ae[_0x3e0b8c(0x23ec)](_0x3e0b8c(0x1291))||_0x1656ae[_0x3e0b8c(0x23ec)]('amazing')||_0x1656ae[_0x3e0b8c(0x23ec)](_0x3e0b8c(0x14a4))||_0x1656ae[_0x3e0b8c(0x23ec)](_0x3e0b8c(0x2297)))&&(_0x1c1b50+=0x6),(_0x1656ae[_0x3e0b8c(0x23ec)]('难过')||_0x1656ae[_0x3e0b8c(0x23ec)]('生气')||_0x1656ae[_0x3e0b8c(0x23ec)]('担心')||_0x1656ae[_0x3e0b8c(0x23ec)]('害怕')||_0x1656ae[_0x3e0b8c(0x23ec)]('紧张')||_0x1656ae[_0x3e0b8c(0x23ec)]('焦虑')||_0x1656ae[_0x3e0b8c(0x23ec)](_0x3e0b8c(0x446))||_0x1656ae[_0x3e0b8c(0x23ec)]('郁闷')||_0x1656ae[_0x3e0b8c(0x23ec)]('烦')||_0x1656ae[_0x3e0b8c(0x23ec)]('压力')||_0x1656ae['includes']('累')||_0x1656ae[_0x3e0b8c(0x23ec)]('疲惫'))&&(_0x1c1b50+=0x8);}),currentHeartrate=Math[_0x2e20d4(0x910)](0x32,Math[_0x2e20d4(0x21f7)](0x8c,_0x2e68fb+_0x1c1b50));if(heartrateInterval)clearInterval(heartrateInterval);heartrateInterval=setInterval(()=>{const _0x136ecc=_0x2e20d4,_0x515a84=Math[_0x136ecc(0x1dac)](Math[_0x136ecc(0x191c)]()*0x9)-0x4,_0x74412=Math[_0x136ecc(0x910)](0x32,Math[_0x136ecc(0x21f7)](0x8c,currentHeartrate+_0x515a84));_0x3a2b8d[_0x136ecc(0x221)]=_0x136ecc(0x2567);if(_0x74412>=0x6e)_0x3a2b8d['classList'][_0x136ecc(0xe1)](_0x136ecc(0x236));else _0x74412>=0x5f&&_0x3a2b8d[_0x136ecc(0x226e)][_0x136ecc(0xe1)](_0x136ecc(0x2a7));_0x3a2b8d[_0x136ecc(0xc02)]=_0x136ecc(0x17c5)+_0x74412+_0x136ecc(0xbd3);},0x5dc+Math['random']()*0x3e8),_0x3a2b8d[_0x2e20d4(0xc02)]='♥️\x20<span\x20class=\x22heartrate-number\x22>'+currentHeartrate+_0x2e20d4(0xbd3);}function hideAiHeartrate(){const _0x5166da=_0x2cf6d4,_0x58ffdb=document['getElementById'](_0x5166da(0x12e)),_0x2d6e8b=document[_0x5166da(0x566)](_0x5166da(0x2519));_0x58ffdb&&(_0x58ffdb['style'][_0x5166da(0x2526)]='none'),_0x2d6e8b&&(_0x2d6e8b[_0x5166da(0x655)][_0x5166da(0x2526)]='none'),heartrateInterval&&(clearInterval(heartrateInterval),heartrateInterval=null);}function adjustHeartrateForMessage(_0x2e50a4,_0x6dfa97=![]){const _0x5c6c3d=_0x2cf6d4;if(!heartrateInterval)return;let _0x132a51=0x0,_0x532b47='',_0xe6955d=0xbb8;if(typeof _0x2e50a4===_0x5c6c3d(0xb97))_0x532b47=_0x2e50a4[_0x5c6c3d(0x1d64)]();else Array[_0x5c6c3d(0x1bcc)](_0x2e50a4)?_0x532b47='':_0x532b47='';if(_0x6dfa97){if(_0x532b47['includes']('爱你')||_0x532b47['includes'](_0x5c6c3d(0x10a3))||_0x532b47[_0x5c6c3d(0x23ec)](_0x5c6c3d(0x2108))||_0x532b47['includes'](_0x5c6c3d(0x1dcd))||_0x532b47[_0x5c6c3d(0x23ec)]('想你')||_0x532b47[_0x5c6c3d(0x23ec)](_0x5c6c3d(0x5b9))||_0x532b47['includes'](_0x5c6c3d(0x106e))||_0x532b47[_0x5c6c3d(0x23ec)]('亲亲')||_0x532b47[_0x5c6c3d(0x23ec)]('抱抱')||_0x532b47[_0x5c6c3d(0x23ec)]('宝贝')||_0x532b47[_0x5c6c3d(0x23ec)](_0x5c6c3d(0x225))||_0x532b47[_0x5c6c3d(0x23ec)](_0x5c6c3d(0x1351))||_0x532b47[_0x5c6c3d(0x23ec)]('亲爱的')||_0x532b47[_0x5c6c3d(0x23ec)](_0x5c6c3d(0x1f5a))||_0x532b47[_0x5c6c3d(0x23ec)]('需要你')||_0x532b47[_0x5c6c3d(0x23ec)](_0x5c6c3d(0xc3))||_0x532b47[_0x5c6c3d(0x23ec)]('想和你')||_0x532b47[_0x5c6c3d(0x23ec)](_0x5c6c3d(0x210c)))_0x132a51=0x14,_0xe6955d=0x1f40;else{if(_0x532b47[_0x5c6c3d(0x23ec)]('表白')||_0x532b47[_0x5c6c3d(0x23ec)]('喜欢')||_0x532b47['includes']('心动')||_0x532b47[_0x5c6c3d(0x23ec)]('心跳')||_0x532b47[_0x5c6c3d(0x23ec)]('脸红')||_0x532b47['includes']('害羞')||_0x532b47[_0x5c6c3d(0x23ec)]('可爱')||_0x532b47['includes']('甜')||_0x532b47['includes']('温柔')||_0x532b47[_0x5c6c3d(0x23ec)]('美丽')||_0x532b47[_0x5c6c3d(0x23ec)]('漂亮')||_0x532b47[_0x5c6c3d(0x23ec)]('迷人')||_0x532b47[_0x5c6c3d(0x23ec)]('魅力')||_0x532b47[_0x5c6c3d(0x23ec)]('吸引')||_0x532b47[_0x5c6c3d(0x23ec)]('心仪'))_0x132a51=0xf,_0xe6955d=0x1770;else{if(_0x532b47[_0x5c6c3d(0x23ec)]('撒娇')||_0x532b47[_0x5c6c3d(0x23ec)]('嘤嘤')||_0x532b47[_0x5c6c3d(0x23ec)]('哼')||_0x532b47[_0x5c6c3d(0x23ec)]('人家')||_0x532b47[_0x5c6c3d(0x23ec)]('讨厌')||_0x532b47[_0x5c6c3d(0x23ec)]('不要')||_0x532b47['includes'](_0x5c6c3d(0xd25))||_0x532b47[_0x5c6c3d(0x23ec)]('求你')||_0x532b47[_0x5c6c3d(0x23ec)]('拜托')||_0x532b47[_0x5c6c3d(0x23ec)]('陪我')||_0x532b47['includes']('陪陪')||_0x532b47[_0x5c6c3d(0x23ec)]('一起'))_0x132a51=0xc,_0xe6955d=0x1388;else{if(_0x532b47[_0x5c6c3d(0x23ec)]('开心')||_0x532b47[_0x5c6c3d(0x23ec)]('高兴')||_0x532b47[_0x5c6c3d(0x23ec)]('快乐')||_0x532b47[_0x5c6c3d(0x23ec)]('兴奋')||_0x532b47[_0x5c6c3d(0x23ec)]('激动')||_0x532b47[_0x5c6c3d(0x23ec)]('好棒')||_0x532b47[_0x5c6c3d(0x23ec)]('厉害')||_0x532b47[_0x5c6c3d(0x23ec)]('哇')||_0x532b47['includes']('太好了'))_0x132a51=0x8,_0xe6955d=0xfa0;else{if(_0x532b47[_0x5c6c3d(0x23ec)]('生气')||_0x532b47[_0x5c6c3d(0x23ec)](_0x5c6c3d(0x446))||_0x532b47[_0x5c6c3d(0x23ec)]('难过')||_0x532b47['includes']('担心')||_0x532b47[_0x5c6c3d(0x23ec)]('害怕')||_0x532b47[_0x5c6c3d(0x23ec)]('紧张')||_0x532b47[_0x5c6c3d(0x23ec)]('焦虑')||_0x532b47['includes']('郁闷')||_0x532b47[_0x5c6c3d(0x23ec)]('烦'))_0x132a51=0xa,_0xe6955d=0x1770;else(_0x532b47['includes']('你好')||_0x532b47[_0x5c6c3d(0x23ec)]('hi')||_0x532b47[_0x5c6c3d(0x23ec)]('hello')||_0x532b47['includes']('早上好')||_0x532b47[_0x5c6c3d(0x23ec)]('晚安'))&&(_0x132a51=0x5,_0xe6955d=0xbb8);}}}}}else{if(_0x532b47[_0x5c6c3d(0x23ec)]('害羞')||_0x532b47[_0x5c6c3d(0x23ec)]('脸红')||_0x532b47[_0x5c6c3d(0x23ec)](_0x5c6c3d(0x1042)))_0x132a51=0xa,_0xe6955d=0x1388;else{if(_0x532b47[_0x5c6c3d(0x23ec)]('兴奋')||_0x532b47['includes']('开心')||_0x532b47['includes']('激动'))_0x132a51=0x8,_0xe6955d=0xfa0;else{if(_0x532b47[_0x5c6c3d(0x23ec)]('紧张')||_0x532b47[_0x5c6c3d(0x23ec)]('担心')||_0x532b47[_0x5c6c3d(0x23ec)]('焦虑'))_0x132a51=0xc,_0xe6955d=0x1770;else(_0x532b47['includes']('爱')||_0x532b47[_0x5c6c3d(0x23ec)]('喜欢')||_0x532b47[_0x5c6c3d(0x23ec)]('想'))&&(_0x132a51=0xf,_0xe6955d=0x1b58);}}}currentHeartrate=Math[_0x5c6c3d(0x910)](0x37,Math[_0x5c6c3d(0x21f7)](0x82,currentHeartrate+_0x132a51)),setTimeout(()=>{const _0x55b3c3=_0x5c6c3d,_0x3f58cd=Math[_0x55b3c3(0x1dac)](_0x132a51*0.6);currentHeartrate=Math[_0x55b3c3(0x910)](0x41,currentHeartrate-_0x3f58cd),setTimeout(()=>{const _0x384a89=_0x55b3c3,_0xe8e818=Math[_0x384a89(0x1dac)](_0x132a51*0.3);currentHeartrate=Math['max'](0x41,currentHeartrate-_0xe8e818);},_0xe6955d*0.5);},_0xe6955d);}async function processAIFriendRequestResponse(_0x453abb,_0x2cb946){const _0x204e24=_0x2cf6d4,_0x40e0c6=characters[_0x204e24(0x1aeb)](_0x57a6c1=>_0x57a6c1['id']===_0x453abb);if(!_0x40e0c6)return;const _0x3e95be='\x0a#\x20指令：好友申请决策\x0a你是\x20'+_0x40e0c6[_0x204e24(0x222f)]+_0x204e24(0x2413)+_0x40e0c6['name']+'\x0a-\x20你的设定:\x20'+_0x40e0c6['bio']+_0x204e24(0x1a65)+(_0x2cb946||_0x204e24(0x21ba))+_0x204e24(0x1a7c);try{const _0x5c2424=await callChatAPI(_0x3e95be,_0x40e0c6),_0x6dc23b=Array[_0x204e24(0x1bcc)](_0x5c2424)?_0x5c2424[0x0]['toLowerCase']():_0x5c2424[_0x204e24(0x1d64)]();console[_0x204e24(0xc0d)](_0x204e24(0x118e)+_0x6dc23b);if(_0x6dc23b[_0x204e24(0x23ec)]('同意')){await aiUnblockUser(_0x453abb);const _0x5ba54b={'id':_0x204e24(0xf32)+Date[_0x204e24(0x18e0)](),'sender':'system','content':_0x204e24(0x84c),'timestamp':Date['now'](),'isFriendAddedMessage':!![]};addMessageToChat(_0x5ba54b),showToast('✅\x20'+_0x40e0c6[_0x204e24(0x222f)]+'\x20同意了你的好友申请',_0x204e24(0xb27));}else{const _0x3a98de={'id':'system_'+Date[_0x204e24(0x18e0)](),'sender':_0x204e24(0x212),'content':_0x40e0c6[_0x204e24(0x222f)]+'\x20拒绝了你的好友申请。','timestamp':Date[_0x204e24(0x18e0)]()};addMessageToChat(_0x3a98de),showToast('❌\x20'+_0x40e0c6[_0x204e24(0x222f)]+_0x204e24(0x1fa3),_0x204e24(0x13bb));}}catch(_0x2e1337){console[_0x204e24(0x24ab)](_0x204e24(0x5bc),_0x2e1337),showToast(_0x204e24(0x12c8),_0x204e24(0x24ab));}}async function aiUnblockUser(_0x39f81d){const _0xdaa776=_0x2cf6d4;try{const _0x3d174b=blacklistData[_0xdaa776(0x1aeb)](_0x2c5a16=>_0x2c5a16[_0xdaa776(0x1b1a)]===_0x39f81d&&_0x2c5a16['blockedId']===_0xdaa776(0x23b2)&&!_0x2c5a16[_0xdaa776(0x1f27)]);if(!_0x3d174b){console[_0xdaa776(0x17cc)](_0xdaa776(0xf86));return;}_0x3d174b[_0xdaa776(0x1f27)]=!![],_0x3d174b[_0xdaa776(0x313)]=new Date()[_0xdaa776(0xa4b)](),await db[_0xdaa776(0x1c45)][_0xdaa776(0x53a)](_0x3d174b),console[_0xdaa776(0xc0d)]('✅\x20'+_0x39f81d+_0xdaa776(0x5b4)),currentChatCharacter&&currentChatCharacter['id']===_0x39f81d&&updateChatBlockedStatus(),renderContactList(),renderMessageList();}catch(_0x2cb604){console[_0xdaa776(0x24ab)]('AI解除拉黑失败:',_0x2cb604);}}console['log'](_0x2cf6d4(0x16ef));async function notifyCharacterBlocked(_0x50983d,_0x2bf2b5=''){const _0xde0d18=_0x2cf6d4;try{const _0x1c7d1f=characters[_0xde0d18(0x1aeb)](_0x25b31f=>_0x25b31f['id']===_0x50983d);if(!_0x1c7d1f)return;const _0x2bc5ac=_0xde0d18(0x165d)+(_0x2bf2b5?_0xde0d18(0x142e)+_0x2bf2b5:_0xde0d18(0x1153))+_0xde0d18(0x157d)+_0x1c7d1f['name']+_0xde0d18(0x688)+_0x1c7d1f['bio']+_0xde0d18(0x152a),_0x3ce7a6=await generateAIResponse(_0x2bc5ac,_0x1c7d1f),_0x51f300=await parseAiResponse(_0x3ce7a6);for(let _0x46977d=0x0;_0x46977d<_0x51f300['length'];_0x46977d++){const _0x4f3267=_0x51f300[_0x46977d];if(typeof _0x4f3267===_0xde0d18(0x3c4)&&_0x4f3267!==null&&_0x4f3267['type']==='block_user')continue;let _0x4dafbd;if(typeof _0x4f3267==='string')_0x4dafbd={'id':(Date[_0xde0d18(0x18e0)]()+_0x46977d)[_0xde0d18(0x9a3)](),'sender':_0xde0d18(0x232),'content':_0x4f3267,'timestamp':Date[_0xde0d18(0x18e0)]()+_0x46977d*0x64,'isBlockReaction':!![]};else{if(typeof _0x4f3267===_0xde0d18(0x3c4)&&_0x4f3267!==null){if(_0x4f3267[_0xde0d18(0x23df)]===_0xde0d18(0x14f2))_0x4dafbd={'id':(Date['now']()+_0x46977d)[_0xde0d18(0x9a3)](),'sender':_0xde0d18(0x232),'type':_0xde0d18(0x14f2),'message':_0x4f3267[_0xde0d18(0xd7a)]||_0xde0d18(0x12e7),'timestamp':Date['now']()+_0x46977d*0x64,'isBlockReaction':!![]};else{const _0x1d7ce2=_0x4f3267[_0xde0d18(0x1423)]||_0x4f3267[_0xde0d18(0xd7a)]||_0x4f3267[_0xde0d18(0x1e58)]||_0xde0d18(0x1b22);_0x4dafbd={'id':(Date[_0xde0d18(0x18e0)]()+_0x46977d)[_0xde0d18(0x9a3)](),'sender':_0xde0d18(0x232),'content':_0x1d7ce2,'timestamp':Date[_0xde0d18(0x18e0)]()+_0x46977d*0x64,'isBlockReaction':!![]};}}}_0x4dafbd&&(!chatMessages[_0x50983d]&&(chatMessages[_0x50983d]=[]),chatMessages[_0x50983d][_0xde0d18(0x6ee)](_0x4dafbd),currentChatCharacter&&currentChatCharacter['id']===_0x50983d&&addMessageWithAnimation(_0x4dafbd,_0x50983d));}try{await saveChatMessagesImmediate([_0x50983d]),console[_0xde0d18(0xc0d)](_0xde0d18(0x1a60));}catch(_0x17ea79){console[_0xde0d18(0x24ab)](_0xde0d18(0xffc),_0x17ea79),await saveChatMessages();}console[_0xde0d18(0xc0d)]('✅\x20'+_0x1c7d1f[_0xde0d18(0x222f)]+_0xde0d18(0x243));}catch(_0x328669){console[_0xde0d18(0x24ab)](_0xde0d18(0xed9),_0x328669);}}async function notifyCharacterUnblocked(_0x53342c){const _0x2f45f4=_0x2cf6d4;try{const _0x4ac1bc=characters['find'](_0x519514=>_0x519514['id']===_0x53342c);if(!_0x4ac1bc)return;const _0x203366=_0x2f45f4(0x240e)+_0x4ac1bc[_0x2f45f4(0x222f)]+'，人设如下：'+_0x4ac1bc['bio']+_0x2f45f4(0x1d60),_0xf240e=await callChatAPI(_0x203366,_0x4ac1bc),_0x3a9228=await parseAiResponse(_0xf240e);for(let _0x376900=0x0;_0x376900<_0x3a9228['length'];_0x376900++){const _0x593cf2=_0x3a9228[_0x376900];if(typeof _0x593cf2==='object'&&_0x593cf2!==null&&_0x593cf2[_0x2f45f4(0x23df)]===_0x2f45f4(0x1db6))continue;let _0x59b020;if(typeof _0x593cf2===_0x2f45f4(0xb97))_0x59b020={'id':(Date[_0x2f45f4(0x18e0)]()+_0x376900)[_0x2f45f4(0x9a3)](),'sender':_0x2f45f4(0x232),'content':_0x593cf2,'timestamp':Date[_0x2f45f4(0x18e0)]()+_0x376900*0x64,'isUnblockReaction':!![]};else{if(typeof _0x593cf2===_0x2f45f4(0x3c4)&&_0x593cf2!==null){const _0x1da5fd=_0x593cf2[_0x2f45f4(0x1423)]||_0x593cf2[_0x2f45f4(0xd7a)]||_0x593cf2[_0x2f45f4(0x1e58)]||'[角色反应]';_0x59b020={'id':(Date['now']()+_0x376900)[_0x2f45f4(0x9a3)](),'sender':'received','content':_0x1da5fd,'timestamp':Date[_0x2f45f4(0x18e0)]()+_0x376900*0x64,'isUnblockReaction':!![]};}}_0x59b020&&(!chatMessages[_0x53342c]&&(chatMessages[_0x53342c]=[]),chatMessages[_0x53342c][_0x2f45f4(0x6ee)](_0x59b020),currentChatCharacter&&currentChatCharacter['id']===_0x53342c&&addMessageWithAnimation(_0x59b020,_0x53342c));}try{await saveChatMessagesImmediate([_0x53342c]),console[_0x2f45f4(0xc0d)](_0x2f45f4(0x73d));}catch(_0x3ce478){console[_0x2f45f4(0x24ab)](_0x2f45f4(0xb29),_0x3ce478),await saveChatMessages();}console[_0x2f45f4(0xc0d)]('✅\x20'+_0x4ac1bc[_0x2f45f4(0x222f)]+_0x2f45f4(0xb6a));}catch(_0x514eb2){console['error']('通知角色被解除拉黑失败:',_0x514eb2);}}console[_0x2cf6d4(0xc0d)](_0x2cf6d4(0x169a));async function showInnerThoughtsModal(_0x33e640){const _0x3f76b2=_0x2cf6d4;if(!_0x33e640)return;const _0xfd4fc0=document[_0x3f76b2(0x566)]('inner-thoughts-modal'),_0x2459a0=document[_0x3f76b2(0x566)](_0x3f76b2(0x23e7));_0xfd4fc0['style'][_0x3f76b2(0x2526)]=_0x3f76b2(0x1f0b);try{const _0x1829f9=await db[_0x3f76b2(0xfc7)][_0x3f76b2(0x46a)](_0x33e640);_0x1829f9?(console[_0x3f76b2(0xc0d)](_0x3f76b2(0x1db1)),displayInnerThoughts(_0x1829f9[_0x3f76b2(0x1423)],_0x33e640)):(console[_0x3f76b2(0xc0d)]('🆕\x20生成新的心声内容'),_0x2459a0['innerHTML']=_0x3f76b2(0xbd),await generateInnerThoughts(_0x33e640));}catch(_0x464a97){console['error']('加载心声失败:',_0x464a97),displayInnerThoughtsError(_0x3f76b2(0x214e));}}function hideInnerThoughtsModal(){const _0x187322=_0x2cf6d4,_0x216bb3=document[_0x187322(0x566)](_0x187322(0xc33));_0x216bb3['style'][_0x187322(0x2526)]='none';}async function generateInnerThoughts(_0x505ffb,_0x2524f6=![]){const _0x1ec870=_0x2cf6d4;try{const _0x517f08=chatMessages[currentChatCharacter['id']]||[],_0x2f9752=_0x517f08['find'](_0x290573=>_0x290573['id']===_0x505ffb);if(!_0x2f9752||_0x2f9752['sender']!==_0x1ec870(0x232))throw new Error(_0x1ec870(0x1452));let _0x352f8c=currentChatCharacter,_0x444b32=_0x352f8c[_0x1ec870(0x222f)];if(_0x352f8c[_0x1ec870(0x4b7)]&&_0x2f9752[_0x1ec870(0x210b)]){const _0x2fc783=_0x352f8c[_0x1ec870(0xcaa)][_0x1ec870(0x1aeb)](_0x1cc310=>_0x1cc310['id']===_0x2f9752['senderId']);if(_0x2fc783){const _0x2f1fc6=characters[_0x1ec870(0x1aeb)](_0x1a750e=>_0x1a750e['id']===_0x2fc783['id']);_0x2f1fc6?(_0x352f8c=_0x2f1fc6,_0x444b32=_0x2fc783['name'],console[_0x1ec870(0xc0d)](_0x1ec870(0x5cb)+_0x444b32+'\x20('+_0x2fc783['id']+')')):console['warn']('⚠️\x20群聊心声\x20-\x20未找到角色完整信息:\x20'+_0x2fc783['id']);}else throw new Error(_0x1ec870(0x1f69)+_0x2f9752['senderId']);}else{if(_0x352f8c[_0x1ec870(0x4b7)]&&_0x2f9752[_0x1ec870(0x222f)]){const _0x23ba17=_0x352f8c[_0x1ec870(0xcaa)][_0x1ec870(0x1aeb)](_0x58418d=>_0x58418d['name']===_0x2f9752[_0x1ec870(0x222f)]);if(_0x23ba17){const _0x4de61f=characters[_0x1ec870(0x1aeb)](_0x1a4b47=>_0x1a4b47['id']===_0x23ba17['id']);_0x4de61f&&(_0x352f8c=_0x4de61f,_0x444b32=_0x23ba17[_0x1ec870(0x222f)],console[_0x1ec870(0xc0d)](_0x1ec870(0xdc6)+_0x444b32+'\x20('+_0x23ba17['id']+')'));}else throw new Error(_0x1ec870(0x23d0)+_0x2f9752[_0x1ec870(0x222f)]);}}if(!_0x352f8c)throw new Error(_0x1ec870(0x2218));if(!_0x2524f6){const _0x455177=await db[_0x1ec870(0xfc7)][_0x1ec870(0x46a)](_0x505ffb);if(_0x455177){displayInnerThoughts(_0x455177[_0x1ec870(0x1423)],_0x505ffb);return;}}const _0x45f444=buildInnerThoughtsPrompt(_0x2f9752,_0x352f8c,_0x517f08,{'isGroupChat':currentChatCharacter[_0x1ec870(0x4b7)],'groupName':currentChatCharacter[_0x1ec870(0x4b7)]?currentChatCharacter[_0x1ec870(0x222f)]:null,'characterName':_0x444b32,'groupMembers':currentChatCharacter[_0x1ec870(0x4b7)]?currentChatCharacter[_0x1ec870(0xcaa)]:null}),_0x5c2066=await generateAIResponse(_0x45f444,_0x352f8c);if(_0x5c2066&&_0x5c2066[_0x1ec870(0x1424)]()){const _0x18221d=_0x5c2066[_0x1ec870(0x1424)]();await db['innerThoughts'][_0x1ec870(0x53a)]({'id':_0x505ffb,'messageId':_0x505ffb,'characterId':_0x352f8c['id'],'content':_0x18221d,'timestamp':Date[_0x1ec870(0x18e0)]()}),console['log'](_0x1ec870(0xc90)),displayInnerThoughts(_0x18221d,_0x505ffb);}else throw new Error('AI未能生成心声内容');}catch(_0x58b6f1){console[_0x1ec870(0x24ab)](_0x1ec870(0x18d2),_0x58b6f1),displayInnerThoughtsError(_0x58b6f1[_0x1ec870(0xd7a)]);}}function extractMessageText(_0x198ba9){const _0x4432ee=_0x2cf6d4;if(!_0x198ba9||!_0x198ba9[_0x4432ee(0x1423)])return'';if(Array['isArray'](_0x198ba9[_0x4432ee(0x1423)])){const _0x589320=_0x198ba9[_0x4432ee(0x1423)][_0x4432ee(0x803)](_0x42f84c=>_0x42f84c[_0x4432ee(0x23df)]===_0x4432ee(0x1e58));let _0x36d576=_0x589320[_0x4432ee(0xf6d)](_0x33adfa=>_0x33adfa['text'])[_0x4432ee(0x140c)]('\x20');const _0x5637f9=_0x198ba9[_0x4432ee(0x1423)]['filter'](_0x5d5770=>_0x5d5770[_0x4432ee(0x23df)]==='image_url');return _0x5637f9[_0x4432ee(0xcbf)]>0x0&&(_0x36d576+=_0x4432ee(0x12db)+_0x5637f9['length']+_0x4432ee(0xb7e)),_0x36d576;}else return typeof _0x198ba9[_0x4432ee(0x1423)]==='string'?_0x198ba9[_0x4432ee(0x1423)]:String(_0x198ba9[_0x4432ee(0x1423)]);}function buildInnerThoughtsPrompt(_0x358853,_0x20e04b,_0x32445d,_0x4f7255={}){const _0x3175fe=_0x2cf6d4,_0x89f859=_0x32445d[_0x3175fe(0x23ba)](_0x2a9292=>_0x2a9292['id']===_0x358853['id']),_0x47e21d=Math[_0x3175fe(0x910)](0x0,_0x89f859-0x3),_0x527f7f=Math[_0x3175fe(0x21f7)](_0x32445d[_0x3175fe(0xcbf)],_0x89f859+0x1),_0x285a63=_0x32445d['slice'](_0x47e21d,_0x527f7f),_0x4bb6d6=_0x285a63['map'](_0x1d94c9=>{const _0x18ef13=_0x3175fe;if(_0x1d94c9[_0x18ef13(0xf75)]===_0x18ef13(0xfda)){const _0xc3618f=extractMessageText(_0x1d94c9);return _0x18ef13(0x1e7e)+_0xc3618f;}else{if(_0x1d94c9[_0x18ef13(0xf75)]===_0x18ef13(0x232)){const _0x4794ca=extractMessageText(_0x1d94c9);if(_0x4f7255[_0x18ef13(0x137b)]){let _0x4dfc16=_0x18ef13(0x20e7);if(_0x1d94c9[_0x18ef13(0x210b)]&&_0x4f7255['groupMembers']){const _0x1d4064=_0x4f7255[_0x18ef13(0x2467)]['find'](_0x3b8048=>_0x3b8048['id']===_0x1d94c9['senderId']);_0x4dfc16=_0x1d4064?_0x1d4064[_0x18ef13(0x222f)]:_0x1d94c9[_0x18ef13(0x210b)];}else _0x1d94c9[_0x18ef13(0x222f)]&&(_0x4dfc16=_0x1d94c9[_0x18ef13(0x222f)]);return _0x4dfc16+'：'+_0x4794ca;}else return _0x20e04b[_0x18ef13(0x222f)]+'：'+_0x4794ca;}}return'';})[_0x3175fe(0x803)](Boolean)[_0x3175fe(0x140c)]('\x0a');let _0x53da86='';_0x4f7255['isGroupChat']&&(_0x53da86=_0x3175fe(0x16ca)+_0x4f7255[_0x3175fe(0x1727)]+'\x22中，与多个角色和用户互动。群聊成员包括：'+(_0x4f7255['groupMembers']?_0x4f7255['groupMembers'][_0x3175fe(0xf6d)](_0x4a9698=>_0x4a9698['name'])[_0x3175fe(0x140c)]('、'):'其他成员')+_0x3175fe(0x842));const _0x3e2f64=_0x3175fe(0x21ff)+(_0x4f7255['characterName']||_0x20e04b[_0x3175fe(0x222f)])+_0x3175fe(0x57a)+(_0x20e04b[_0x3175fe(0x1a84)]||_0x3175fe(0x20f))+_0x53da86+_0x3175fe(0xc47)+_0x4bb6d6+_0x3175fe(0x20b6)+extractMessageText(_0x358853)+_0x3175fe(0x1b56)+(_0x4f7255[_0x3175fe(0x137b)]?_0x3175fe(0x1748):'')+_0x3175fe(0x77e);return _0x3e2f64;}function displayInnerThoughts(_0xf73c04,_0x2c0fff){const _0x470504=_0x2cf6d4,_0x50f0e8=document[_0x470504(0x566)]('inner-thoughts-content'),_0x817067=chatMessages[currentChatCharacter['id']]||[],_0x56f948=_0x817067[_0x470504(0x1aeb)](_0x5c15b2=>_0x5c15b2['id']===_0x2c0fff);let _0x4b74c2='';if(currentChatCharacter[_0x470504(0x4b7)]&&_0x56f948){let _0x3c60e8=_0x470504(0x20e7),_0x5c082e='';if(_0x56f948[_0x470504(0x210b)]){const _0x55b2fa=currentChatCharacter[_0x470504(0xcaa)][_0x470504(0x1aeb)](_0x24dd72=>_0x24dd72['id']===_0x56f948['senderId']);_0x55b2fa&&(_0x3c60e8=_0x55b2fa[_0x470504(0x222f)],_0x5c082e=_0x55b2fa[_0x470504(0x107f)]||'');}else _0x56f948[_0x470504(0x222f)]&&(_0x3c60e8=_0x56f948[_0x470504(0x222f)]);_0x4b74c2='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22inner-thoughts-character-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x5c082e?_0x470504(0x2001)+_0x5c082e+_0x470504(0x1ca8)+_0x3c60e8+_0x470504(0x1080):'')+_0x470504(0x115d)+_0x3c60e8+_0x470504(0x2550);}_0x50f0e8[_0x470504(0xc02)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x4b74c2+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22inner-thoughts-text\x22>'+_0xf73c04+_0x470504(0x158f);const _0x4d9475=document[_0x470504(0x15b8)](_0x470504(0xa33));_0x4d9475&&(_0x4d9475['onclick']=()=>refreshInnerThoughts(_0x2c0fff));}async function refreshInnerThoughts(_0x1af237){const _0xdf1baf=_0x2cf6d4;if(!_0x1af237)return;const _0xe36ac9=document[_0xdf1baf(0x566)](_0xdf1baf(0x23e7));_0xe36ac9[_0xdf1baf(0xc02)]=_0xdf1baf(0x21b1);try{await db[_0xdf1baf(0xfc7)]['delete'](_0x1af237),console[_0xdf1baf(0xc0d)](_0xdf1baf(0x9a2)),await generateInnerThoughts(_0x1af237,!![]);}catch(_0x376393){console[_0xdf1baf(0x24ab)]('刷新心声失败:',_0x376393),displayInnerThoughtsError(_0xdf1baf(0x449));}}function displayInnerThoughtsError(_0x4ecf15){const _0x274b35=_0x2cf6d4,_0x1560a8=document[_0x274b35(0x566)](_0x274b35(0x23e7));_0x1560a8[_0x274b35(0xc02)]=_0x274b35(0x1e83)+_0x4ecf15+_0x274b35(0x4e5);}console[_0x2cf6d4(0xc0d)](_0x2cf6d4(0x1a6d)),function fixImportIssues(){const _0x4ff156=_0x2cf6d4,_0x14c419=window['importDataFromFile'];window[_0x4ff156(0xac7)]=function(){const _0x241d31=_0x4ff156,_0x212f14=document['createElement'](_0x241d31(0x627));_0x212f14[_0x241d31(0x23df)]=_0x241d31(0x199b),_0x212f14['accept']=_0x241d31(0x539),_0x212f14[_0x241d31(0x1889)]=async function(_0x4dc782){const _0x475cd9=_0x241d31,_0x53fd2b=_0x4dc782[_0x475cd9(0x1144)][_0x475cd9(0x173e)][0x0];if(!_0x53fd2b)return;try{showToast('🔍\x20验证文件格式...',_0x475cd9(0x2422));const _0x1ec7f0=await _0x53fd2b[_0x475cd9(0x1e58)]();let _0x46f5ff;try{_0x46f5ff=JSON[_0x475cd9(0x168e)](_0x1ec7f0);}catch(_0x4560d8){throw new Error('JSON格式错误:\x20'+_0x4560d8[_0x475cd9(0xd7a)]+_0x475cd9(0x16ff));}if(!_0x46f5ff||typeof _0x46f5ff!==_0x475cd9(0x3c4))throw new Error(_0x475cd9(0xfa));const _0x1425c4=[];if(_0x46f5ff[_0x475cd9(0x164d)]?.['length'])_0x1425c4[_0x475cd9(0x6ee)](_0x475cd9(0x1e8d)+_0x46f5ff[_0x475cd9(0x164d)][_0x475cd9(0xcbf)]+'个');if(_0x46f5ff[_0x475cd9(0x464)]?.[_0x475cd9(0xcbf)])_0x1425c4[_0x475cd9(0x6ee)]('消息:\x20'+_0x46f5ff[_0x475cd9(0x464)][_0x475cd9(0xcbf)]+'条');if(_0x46f5ff['chatSettings']?.[_0x475cd9(0xcbf)])_0x1425c4[_0x475cd9(0x6ee)](_0x475cd9(0x1864)+_0x46f5ff[_0x475cd9(0xb08)][_0x475cd9(0xcbf)]+'个');if(_0x46f5ff[_0x475cd9(0x14ee)]?.[_0x475cd9(0xcbf)]){_0x1425c4['push']('群聊:\x20'+_0x46f5ff['groupChats'][_0x475cd9(0xcbf)]+'个');let _0x3ce979=0x0;if(_0x46f5ff['chatMessages']?.[_0x475cd9(0xcbf)]&&_0x46f5ff[_0x475cd9(0x14ee)]?.[_0x475cd9(0xcbf)]){const _0x7f42f0=_0x46f5ff['groupChats'][_0x475cd9(0xf6d)](_0x36720a=>_0x36720a['id']);_0x3ce979=_0x46f5ff[_0x475cd9(0x464)][_0x475cd9(0x803)](_0xca12e5=>_0x7f42f0['includes'](_0xca12e5[_0x475cd9(0x10df)]))[_0x475cd9(0xcbf)];}_0x3ce979>0x0&&_0x1425c4[_0x475cd9(0x6ee)]('群聊消息:\x20'+_0x3ce979+'条');let _0x7a70c5=0x0;_0x46f5ff['groupChats']?.[_0x475cd9(0xcbf)]&&_0x46f5ff[_0x475cd9(0x14ee)][_0x475cd9(0x900)](_0x1b176e=>{const _0xaecec5=_0x475cd9;_0x1b176e[_0xaecec5(0xcaa)]&&Array['isArray'](_0x1b176e[_0xaecec5(0xcaa)])&&(_0x7a70c5+=_0x1b176e['members'][_0xaecec5(0xcbf)]);}),_0x7a70c5>0x0&&_0x1425c4[_0x475cd9(0x6ee)]('群聊成员:\x20'+_0x7a70c5+'个');}if(_0x46f5ff[_0x475cd9(0x1e42)]?.['length'])_0x1425c4['push']('核心记忆:\x20'+_0x46f5ff[_0x475cd9(0x1e42)]['length']+'条');if(_0x46f5ff['coreMemories']?.[_0x475cd9(0xcbf)])_0x1425c4[_0x475cd9(0x6ee)](_0x475cd9(0x21c)+_0x46f5ff[_0x475cd9(0xa1b)][_0x475cd9(0xcbf)]+'条');if(_0x46f5ff[_0x475cd9(0x2196)]?.['length'])_0x1425c4[_0x475cd9(0x6ee)](_0x475cd9(0xebc)+_0x46f5ff[_0x475cd9(0x2196)]['length']+'条');if(_0x46f5ff['episodicMemories']?.[_0x475cd9(0xcbf)])_0x1425c4['push']('情景记忆:\x20'+_0x46f5ff['episodicMemories'][_0x475cd9(0xcbf)]+'条');if(_0x46f5ff[_0x475cd9(0x9b5)]?.['length'])_0x1425c4[_0x475cd9(0x6ee)](_0x475cd9(0x24c0)+_0x46f5ff['workingMemory'][_0x475cd9(0xcbf)]+'条');if(_0x46f5ff[_0x475cd9(0x1982)]?.['length'])_0x1425c4[_0x475cd9(0x6ee)](_0x475cd9(0x18f)+_0x46f5ff[_0x475cd9(0x1982)]['length']+'条');if(_0x46f5ff[_0x475cd9(0x4ad)]?.[_0x475cd9(0xcbf)])_0x1425c4[_0x475cd9(0x6ee)](_0x475cd9(0x17ab)+_0x46f5ff['memoryEvents'][_0x475cd9(0xcbf)]+'条');if(_0x46f5ff[_0x475cd9(0x75b)]?.[_0x475cd9(0xcbf)])_0x1425c4[_0x475cd9(0x6ee)](_0x475cd9(0x1805)+_0x46f5ff[_0x475cd9(0x75b)][_0x475cd9(0xcbf)]+'条');if(_0x46f5ff['customEmojis']?.[_0x475cd9(0xcbf)])_0x1425c4[_0x475cd9(0x6ee)](_0x475cd9(0x133)+_0x46f5ff[_0x475cd9(0x20c7)][_0x475cd9(0xcbf)]+'个');if(_0x46f5ff['recentEmojis']?.[_0x475cd9(0xcbf)])_0x1425c4[_0x475cd9(0x6ee)](_0x475cd9(0x136b)+_0x46f5ff[_0x475cd9(0xa1f)]['length']+'个');if(_0x46f5ff[_0x475cd9(0x229d)]?.['length'])_0x1425c4[_0x475cd9(0x6ee)](_0x475cd9(0x12a7)+_0x46f5ff[_0x475cd9(0x229d)]['length']+'个');if(_0x46f5ff[_0x475cd9(0x1f22)]?.[_0x475cd9(0xcbf)])_0x1425c4[_0x475cd9(0x6ee)]('应用图标:\x20'+_0x46f5ff[_0x475cd9(0x1f22)][_0x475cd9(0xcbf)]+'个');if(_0x46f5ff['characterGroups']?.[_0x475cd9(0xcbf)])_0x1425c4[_0x475cd9(0x6ee)](_0x475cd9(0x1959)+_0x46f5ff[_0x475cd9(0x15e0)][_0x475cd9(0xcbf)]+'个');if(_0x46f5ff[_0x475cd9(0x1f1d)]?.[_0x475cd9(0xcbf)])_0x1425c4[_0x475cd9(0x6ee)](_0x475cd9(0x795)+_0x46f5ff[_0x475cd9(0x1f1d)]['length']+'个');if(_0x46f5ff[_0x475cd9(0x530)]?.[_0x475cd9(0xcbf)])_0x1425c4[_0x475cd9(0x6ee)]('API设置:\x20'+_0x46f5ff[_0x475cd9(0x530)][_0x475cd9(0xcbf)]+'个');if(_0x46f5ff['globalSettings']?.[_0x475cd9(0xcbf)])_0x1425c4['push'](_0x475cd9(0x1094)+_0x46f5ff[_0x475cd9(0x2217)][_0x475cd9(0xcbf)]+'个');if(_0x46f5ff[_0x475cd9(0x8e3)]?.[_0x475cd9(0xcbf)])_0x1425c4[_0x475cd9(0x6ee)](_0x475cd9(0x14d5)+_0x46f5ff[_0x475cd9(0x8e3)][_0x475cd9(0xcbf)]+'条');if(_0x46f5ff['moments']?.[_0x475cd9(0xcbf)])_0x1425c4['push'](_0x475cd9(0x1920)+_0x46f5ff[_0x475cd9(0x1a72)]['length']+'条');if(_0x46f5ff['momentComments']?.[_0x475cd9(0xcbf)])_0x1425c4[_0x475cd9(0x6ee)](_0x475cd9(0xb58)+_0x46f5ff['momentComments'][_0x475cd9(0xcbf)]+'条');if(_0x46f5ff[_0x475cd9(0x101)]?.[_0x475cd9(0xcbf)])_0x1425c4[_0x475cd9(0x6ee)](_0x475cd9(0x4a8)+_0x46f5ff[_0x475cd9(0x101)]['length']+'条');if(_0x46f5ff['forums']?.['length'])_0x1425c4[_0x475cd9(0x6ee)]('论坛:\x20'+_0x46f5ff['forums']['length']+'个');if(_0x46f5ff['forumPosts']?.[_0x475cd9(0xcbf)])_0x1425c4['push'](_0x475cd9(0x1664)+_0x46f5ff[_0x475cd9(0x1f71)]['length']+'条');if(_0x46f5ff['forumReplies']?.[_0x475cd9(0xcbf)])_0x1425c4['push'](_0x475cd9(0xf7b)+_0x46f5ff['forumReplies'][_0x475cd9(0xcbf)]+'条');if(_0x46f5ff[_0x475cd9(0x1dd3)]?.[_0x475cd9(0xcbf)])_0x1425c4[_0x475cd9(0x6ee)](_0x475cd9(0x1764)+_0x46f5ff['forumFavorites'][_0x475cd9(0xcbf)]+'条');if(_0x46f5ff[_0x475cd9(0x3b2)]?.[_0x475cd9(0xcbf)])_0x1425c4[_0x475cd9(0x6ee)](_0x475cd9(0x755)+_0x46f5ff[_0x475cd9(0x3b2)][_0x475cd9(0xcbf)]+'张');if(_0x46f5ff['forumMountedWorldbooks']?.[_0x475cd9(0xcbf)])_0x1425c4[_0x475cd9(0x6ee)](_0x475cd9(0x19b4)+_0x46f5ff[_0x475cd9(0x657)][_0x475cd9(0xcbf)]+'个');if(_0x46f5ff[_0x475cd9(0x195c)]?.[_0x475cd9(0xcbf)])_0x1425c4['push'](_0x475cd9(0x71f)+_0x46f5ff[_0x475cd9(0x195c)][_0x475cd9(0xcbf)]+'个');if(_0x46f5ff[_0x475cd9(0x4b0)]?.[_0x475cd9(0xcbf)])_0x1425c4[_0x475cd9(0x6ee)](_0x475cd9(0x1425)+_0x46f5ff[_0x475cd9(0x4b0)][_0x475cd9(0xcbf)]+'条');if(_0x46f5ff[_0x475cd9(0x2c5)]?.[_0x475cd9(0xcbf)])_0x1425c4[_0x475cd9(0x6ee)]('纪念日:\x20'+_0x46f5ff['anniversaries'][_0x475cd9(0xcbf)]+'个');if(_0x46f5ff[_0x475cd9(0xda3)]?.['length'])_0x1425c4[_0x475cd9(0x6ee)](_0x475cd9(0x1142)+_0x46f5ff[_0x475cd9(0xda3)][_0x475cd9(0xcbf)]+'个');if(_0x46f5ff[_0x475cd9(0xfc7)]?.[_0x475cd9(0xcbf)])_0x1425c4[_0x475cd9(0x6ee)]('心声:\x20'+_0x46f5ff[_0x475cd9(0xfc7)][_0x475cd9(0xcbf)]+'条');if(_0x46f5ff[_0x475cd9(0x1c45)]?.[_0x475cd9(0xcbf)])_0x1425c4['push'](_0x475cd9(0x9f7)+_0x46f5ff[_0x475cd9(0x1c45)][_0x475cd9(0xcbf)]+'条');if(_0x46f5ff[_0x475cd9(0x189f)]?.['length'])_0x1425c4['push'](_0x475cd9(0x1ce7)+_0x46f5ff[_0x475cd9(0x189f)][_0x475cd9(0xcbf)]+'个');if(_0x46f5ff[_0x475cd9(0xa52)]?.['length'])_0x1425c4[_0x475cd9(0x6ee)](_0x475cd9(0x79f)+_0x46f5ff[_0x475cd9(0xa52)]['length']+'条');if(_0x46f5ff['characterStatus']?.[_0x475cd9(0xcbf)])_0x1425c4[_0x475cd9(0x6ee)]('角色状态:\x20'+_0x46f5ff[_0x475cd9(0x5a2)][_0x475cd9(0xcbf)]+'条');if(_0x46f5ff[_0x475cd9(0x1143)]?.[_0x475cd9(0xcbf)])_0x1425c4[_0x475cd9(0x6ee)](_0x475cd9(0x1ad)+_0x46f5ff['offlineHistoryRecords'][_0x475cd9(0xcbf)]+'条');if(_0x46f5ff[_0x475cd9(0xe3d)]?.[_0x475cd9(0xcbf)])_0x1425c4[_0x475cd9(0x6ee)](_0x475cd9(0x19dc)+_0x46f5ff[_0x475cd9(0xe3d)]['length']+'个');if(_0x46f5ff[_0x475cd9(0xa0c)]?.[_0x475cd9(0xcbf)])_0x1425c4[_0x475cd9(0x6ee)]('线下预设:\x20'+_0x46f5ff['offlinePresets'][_0x475cd9(0xcbf)]+'个');if(_0x46f5ff[_0x475cd9(0x13ac)]?.[_0x475cd9(0xcbf)])_0x1425c4[_0x475cd9(0x6ee)](_0x475cd9(0x10c8)+_0x46f5ff[_0x475cd9(0x13ac)][_0x475cd9(0xcbf)]+'首');if(_0x46f5ff[_0x475cd9(0x1235)]?.['length'])_0x1425c4[_0x475cd9(0x6ee)]('音乐封面:\x20'+_0x46f5ff['musicCovers'][_0x475cd9(0xcbf)]+'个');if(_0x46f5ff[_0x475cd9(0x111c)]?.[_0x475cd9(0xcbf)])_0x1425c4[_0x475cd9(0x6ee)](_0x475cd9(0x1eaa)+_0x46f5ff[_0x475cd9(0x111c)][_0x475cd9(0xcbf)]+'个');if(_0x46f5ff['smsMessages']?.[_0x475cd9(0xcbf)])_0x1425c4['push'](_0x475cd9(0x1493)+_0x46f5ff[_0x475cd9(0xd94)][_0x475cd9(0xcbf)]+'条');const _0xc84a2c=_0x1425c4[_0x475cd9(0xcbf)]?_0x475cd9(0x24fa)+_0x1425c4[_0x475cd9(0x140c)]('\x0a')+'\x0a\x0a确定继续？':'文件无有效数据，继续？';if(!confirm(_0xc84a2c))return;showToast(_0x475cd9(0x1e90),_0x475cd9(0x2422));let _0x29beee=0x0,_0x46b990=[];if(_0x46f5ff[_0x475cd9(0x15e0)]?.[_0x475cd9(0xcbf)])try{await db[_0x475cd9(0x15e0)][_0x475cd9(0x2215)]();const _0x2dc071=_0x46f5ff['characterGroups'][_0x475cd9(0xf6d)](_0x9bc0c8=>({..._0x9bc0c8,'id':_0x9bc0c8['id']||_0x475cd9(0x74a)+Date['now']()+'_'+Math[_0x475cd9(0x191c)]()[_0x475cd9(0x9a3)](0x24)[_0x475cd9(0x18cf)](0x2,0x9)}));await db[_0x475cd9(0x15e0)][_0x475cd9(0x4c5)](_0x2dc071),characterGroups=_0x2dc071,_0x29beee++,console[_0x475cd9(0xc0d)](_0x475cd9(0x5ad)+_0x2dc071[_0x475cd9(0xcbf)]+_0x475cd9(0x1c9a));}catch(_0x3a6236){console[_0x475cd9(0x24ab)]('❌\x20修复脚本：角色分组导入失败:',_0x3a6236),_0x46b990[_0x475cd9(0x6ee)]('角色分组:\x20'+_0x3a6236['message']);}if(_0x46f5ff[_0x475cd9(0x164d)]?.['length'])try{await db[_0x475cd9(0x164d)][_0x475cd9(0x2215)]();const _0x270a93=_0x46f5ff['characters'][_0x475cd9(0x803)](_0x491319=>_0x491319?.[_0x475cd9(0x222f)])['map'](_0x2b8c7a=>{const _0x2f3c0c=_0x475cd9;let _0x34bdba=_0x2b8c7a['groupId'];if(_0x34bdba&&!characterGroups[_0x2f3c0c(0x1aeb)](_0x283f34=>_0x283f34['id']===_0x34bdba))console[_0x2f3c0c(0x17cc)](_0x2f3c0c(0x13a3)+_0x2b8c7a['name']+'\x20的分组\x20'+_0x34bdba+_0x2f3c0c(0x1a36)),_0x34bdba=_0x2f3c0c(0xf58);else!_0x34bdba&&(_0x34bdba=_0x2f3c0c(0xf58));return{..._0x2b8c7a,'id':_0x2b8c7a['id']||'char_'+Date[_0x2f3c0c(0x18e0)]()+'_'+Math[_0x2f3c0c(0x191c)]()[_0x2f3c0c(0x9a3)](0x24)['substr'](0x2,0x9),'groupId':_0x34bdba};});await db[_0x475cd9(0x164d)][_0x475cd9(0x4c5)](_0x270a93),characters=_0x270a93,_0x29beee++,console[_0x475cd9(0xc0d)]('✅\x20修复脚本：成功导入\x20'+_0x270a93['length']+_0x475cd9(0x1e2));}catch(_0x47c1a8){console[_0x475cd9(0x24ab)]('❌\x20修复脚本：角色导入失败:',_0x47c1a8),_0x46b990['push'](_0x475cd9(0x1e8d)+_0x47c1a8[_0x475cd9(0xd7a)]);}if(_0x46f5ff[_0x475cd9(0x464)]?.[_0x475cd9(0xcbf)])try{console['log'](_0x475cd9(0x943));let _0x20e702=[];const _0x208fc2=_0x46f5ff[_0x475cd9(0x464)]['some'](_0x5df4b9=>_0x5df4b9['messageData']);if(_0x208fc2)_0x20e702=_0x46f5ff[_0x475cd9(0x464)][_0x475cd9(0xf6d)](_0x4492e3=>({..._0x4492e3,'id':_0x4492e3['id']||'msg_'+Date[_0x475cd9(0x18e0)]()+'_'+Math[_0x475cd9(0x191c)]()['toString'](0x24)['substr'](0x2,0x9)}));else{const _0x5d0310={};for(const _0x2d3edf of _0x46f5ff[_0x475cd9(0x464)]){if(!_0x2d3edf?.[_0x475cd9(0x1423)])continue;const _0x236ea6=_0x2d3edf['characterId']||_0x475cd9(0x22b3);!_0x5d0310[_0x236ea6]&&(_0x5d0310[_0x236ea6]=[]);const _0x210857={..._0x2d3edf};_0x2d3edf[_0x475cd9(0x180)]&&(_0x210857['replyTo']={'id':_0x2d3edf[_0x475cd9(0x180)]['id']||_0x475cd9(0x22b3),'content':_0x2d3edf[_0x475cd9(0x180)][_0x475cd9(0x1423)]||_0x475cd9(0x47a),'sender':_0x2d3edf['replyTo'][_0x475cd9(0xf75)]||_0x475cd9(0x22b3),'senderName':_0x2d3edf[_0x475cd9(0x180)][_0x475cd9(0xadb)]||'未知','timestamp':_0x2d3edf[_0x475cd9(0x180)][_0x475cd9(0x7aa)]||Date[_0x475cd9(0x18e0)](),'_fixed':!![]}),_0x5d0310[_0x236ea6][_0x475cd9(0x6ee)](_0x210857);}let _0x29bfc6=0x0;for(const [_0x192c2a,_0x3981ca]of Object[_0x475cd9(0x230e)](_0x5d0310)){for(let _0x47b949=0x0;_0x47b949<_0x3981ca['length'];_0x47b949++){const _0x42bec0=_0x3981ca[_0x47b949];_0x20e702[_0x475cd9(0x6ee)]({'id':_0x192c2a+'_'+_0x29bfc6++,'characterId':_0x192c2a,'timestamp':_0x42bec0[_0x475cd9(0x7aa)],'messageOrder':_0x47b949,'originalMessageId':_0x42bec0['id'],'messageData':_0x42bec0});}}}await db[_0x475cd9(0x464)][_0x475cd9(0x2215)](),await db['chatMessages'][_0x475cd9(0x4c5)](_0x20e702),_0x29beee++,console[_0x475cd9(0xc0d)](_0x475cd9(0x5ad)+_0x20e702[_0x475cd9(0xcbf)]+_0x475cd9(0x16d2));}catch(_0x10532e){console['error'](_0x475cd9(0x3d9),_0x10532e),_0x46b990[_0x475cd9(0x6ee)](_0x475cd9(0x18d4)+_0x10532e[_0x475cd9(0xd7a)]);}if(_0x46f5ff['chatSettings']?.[_0x475cd9(0xcbf)])try{await db[_0x475cd9(0xb08)][_0x475cd9(0x2215)]();const _0x4a924f=_0x46f5ff[_0x475cd9(0xb08)][_0x475cd9(0xf6d)](_0x519870=>({..._0x519870,'id':_0x519870['id']||_0x475cd9(0xf0f)+Date[_0x475cd9(0x18e0)]()+'_'+Math[_0x475cd9(0x191c)]()['toString'](0x24)[_0x475cd9(0x18cf)](0x2,0x9)}));await db['chatSettings']['bulkPut'](_0x4a924f),_0x29beee++;}catch(_0x4bacc2){_0x46b990['push'](_0x475cd9(0x1864)+_0x4bacc2['message']);}if(_0x46f5ff[_0x475cd9(0xa1b)]?.[_0x475cd9(0xcbf)])try{await db[_0x475cd9(0xa1b)][_0x475cd9(0x2215)]();const _0x2ca776=_0x46f5ff[_0x475cd9(0xa1b)][_0x475cd9(0xf6d)](_0xec2e3a=>({..._0xec2e3a,'id':_0xec2e3a['id']||_0x475cd9(0x17d5)+Date[_0x475cd9(0x18e0)]()+'_'+Math[_0x475cd9(0x191c)]()[_0x475cd9(0x9a3)](0x24)[_0x475cd9(0x18cf)](0x2,0x9)}));await db[_0x475cd9(0xa1b)][_0x475cd9(0x4c5)](_0x2ca776),_0x29beee++;}catch(_0x2c3e84){_0x46b990[_0x475cd9(0x6ee)](_0x475cd9(0x1b2f)+_0x2c3e84['message']);}if(_0x46f5ff[_0x475cd9(0x222e)]?.[_0x475cd9(0xcbf)])try{await db[_0x475cd9(0x222e)]['clear']();const _0x47efa9=_0x46f5ff['episodicMemories'][_0x475cd9(0xf6d)](_0x68b65f=>({..._0x68b65f,'id':_0x68b65f['id']||'episodic_'+Date[_0x475cd9(0x18e0)]()+'_'+Math[_0x475cd9(0x191c)]()[_0x475cd9(0x9a3)](0x24)[_0x475cd9(0x18cf)](0x2,0x9)}));await db['episodicMemories'][_0x475cd9(0x4c5)](_0x47efa9),_0x29beee++;}catch(_0x97afde){_0x46b990['push'](_0x475cd9(0xebc)+_0x97afde['message']);}if(_0x46f5ff[_0x475cd9(0x75b)]?.['length'])try{await db[_0x475cd9(0x75b)][_0x475cd9(0x2215)]();const _0x500d43=_0x46f5ff[_0x475cd9(0x75b)][_0x475cd9(0xf6d)](_0x2acd97=>({..._0x2acd97,'id':_0x2acd97['id']||_0x475cd9(0x21df)+Date[_0x475cd9(0x18e0)]()+'_'+Math[_0x475cd9(0x191c)]()[_0x475cd9(0x9a3)](0x24)['substr'](0x2,0x9)}));await db[_0x475cd9(0x75b)]['bulkPut'](_0x500d43),_0x29beee++;}catch(_0x2bda0a){_0x46b990['push'](_0x475cd9(0x1805)+_0x2bda0a['message']);}if(_0x46f5ff['customEmojis']?.[_0x475cd9(0xcbf)])try{await db['customEmojis'][_0x475cd9(0x803)](_0x38b13e=>_0x38b13e[_0x475cd9(0xd6e)]!==![])[_0x475cd9(0xc2b)]();const _0x10a4d5=_0x46f5ff[_0x475cd9(0x20c7)][_0x475cd9(0xf6d)](_0xa36b8c=>({..._0xa36b8c,'id':_0xa36b8c['id']||_0x475cd9(0x48e)+Date[_0x475cd9(0x18e0)]()+'_'+Math[_0x475cd9(0x191c)]()[_0x475cd9(0x9a3)](0x24)['substr'](0x2,0x9),'isPersonal':_0xa36b8c[_0x475cd9(0xd6e)]!==![]?!![]:![]}));await db[_0x475cd9(0x20c7)][_0x475cd9(0x4c5)](_0x10a4d5),_0x29beee++;}catch(_0x3d7d58){_0x46b990[_0x475cd9(0x6ee)]('表情包:\x20'+_0x3d7d58['message']);}if(_0x46f5ff[_0x475cd9(0x1f1d)]?.['length'])try{await db[_0x475cd9(0x1f1d)][_0x475cd9(0x2215)]();const _0x5e5cdf=_0x46f5ff['personas'][_0x475cd9(0xf6d)](_0x1ba9b3=>({..._0x1ba9b3,'id':_0x1ba9b3['id']||_0x475cd9(0x183f)+Date[_0x475cd9(0x18e0)]()+'_'+Math[_0x475cd9(0x191c)]()[_0x475cd9(0x9a3)](0x24)[_0x475cd9(0x18cf)](0x2,0x9)}));await db[_0x475cd9(0x1f1d)]['bulkPut'](_0x5e5cdf),_0x29beee++;}catch(_0x565e99){_0x46b990[_0x475cd9(0x6ee)](_0x475cd9(0x795)+_0x565e99[_0x475cd9(0xd7a)]);}if(_0x46f5ff[_0x475cd9(0x1a72)]?.[_0x475cd9(0xcbf)])try{await db[_0x475cd9(0x1a72)]['clear']();const _0x36bf45=_0x46f5ff[_0x475cd9(0x1a72)]['map'](_0x3efab2=>({..._0x3efab2,'id':_0x3efab2['id']||_0x475cd9(0x1580)+Date[_0x475cd9(0x18e0)]()+'_'+Math[_0x475cd9(0x191c)]()['toString'](0x24)[_0x475cd9(0x18cf)](0x2,0x9)}));await db['moments'][_0x475cd9(0x4c5)](_0x36bf45),_0x29beee++;}catch(_0x3933e9){_0x46b990[_0x475cd9(0x6ee)]('动态:\x20'+_0x3933e9[_0x475cd9(0xd7a)]);}if(_0x46f5ff[_0x475cd9(0x1733)]?.[_0x475cd9(0xcbf)])try{await db[_0x475cd9(0x1733)][_0x475cd9(0x2215)]();const _0x3e4ff8=_0x46f5ff[_0x475cd9(0x1733)][_0x475cd9(0xf6d)](_0x2fab2f=>({..._0x2fab2f,'id':_0x2fab2f['id']||'comment_'+Date['now']()+'_'+Math['random']()[_0x475cd9(0x9a3)](0x24)[_0x475cd9(0x18cf)](0x2,0x9)}));await db[_0x475cd9(0x1733)][_0x475cd9(0x4c5)](_0x3e4ff8),_0x29beee++;}catch(_0x8103ed){_0x46b990['push'](_0x475cd9(0xb58)+_0x8103ed[_0x475cd9(0xd7a)]);}if(_0x46f5ff[_0x475cd9(0x8e3)]?.['length'])try{await db[_0x475cd9(0x8e3)][_0x475cd9(0x2215)]();const _0x1c1b56=_0x46f5ff[_0x475cd9(0x8e3)][_0x475cd9(0xf6d)](_0x19c61c=>({..._0x19c61c,'id':_0x19c61c['id']||_0x19c61c['characterId']+'_'+_0x19c61c[_0x475cd9(0x1c5b)],'timestamp':_0x19c61c[_0x475cd9(0x7aa)]||new Date(_0x19c61c[_0x475cd9(0x1c5b)])['getTime'](),'weather':_0x19c61c['weather']||'☀️'}));await db[_0x475cd9(0x8e3)][_0x475cd9(0x4c5)](_0x1c1b56),_0x29beee++;}catch(_0x144d22){_0x46b990[_0x475cd9(0x6ee)](_0x475cd9(0x14d5)+_0x144d22['message']);}if(_0x46f5ff[_0x475cd9(0x1a13)]?.[_0x475cd9(0xcbf)])try{await db['forums'][_0x475cd9(0x2215)]();const _0x2768a1=_0x46f5ff[_0x475cd9(0x1a13)]['map'](_0x56fae0=>({..._0x56fae0,'id':_0x56fae0['id']||Date['now']()+Math['floor'](Math[_0x475cd9(0x191c)]()*0x3e8)}));await db['forums']['bulkPut'](_0x2768a1),_0x29beee++;}catch(_0xbf7c03){_0x46b990['push'](_0x475cd9(0x706)+_0xbf7c03[_0x475cd9(0xd7a)]);}if(_0x46f5ff[_0x475cd9(0x1f71)]?.[_0x475cd9(0xcbf)])try{await db[_0x475cd9(0x1f71)]['clear']();const _0xb98073=_0x46f5ff['forumPosts'][_0x475cd9(0xf6d)](_0x21a36e=>({..._0x21a36e,'id':_0x21a36e['id']||Date[_0x475cd9(0x18e0)]()+Math['floor'](Math['random']()*0x3e8)}));await db[_0x475cd9(0x1f71)][_0x475cd9(0x4c5)](_0xb98073),_0x29beee++;}catch(_0x59a0bf){_0x46b990[_0x475cd9(0x6ee)](_0x475cd9(0x1664)+_0x59a0bf[_0x475cd9(0xd7a)]);}if(_0x46f5ff[_0x475cd9(0x1d3c)]?.[_0x475cd9(0xcbf)])try{await db[_0x475cd9(0x1d3c)]['clear']();const _0xf8b05a=_0x46f5ff['forumReplies']['map'](_0x3e6adc=>({..._0x3e6adc,'id':_0x3e6adc['id']||Date[_0x475cd9(0x18e0)]()+Math[_0x475cd9(0x1dac)](Math[_0x475cd9(0x191c)]()*0x3e8)}));await db[_0x475cd9(0x1d3c)][_0x475cd9(0x4c5)](_0xf8b05a),_0x29beee++;}catch(_0x258dbe){_0x46b990['push'](_0x475cd9(0xf7b)+_0x258dbe[_0x475cd9(0xd7a)]);}if(_0x46f5ff[_0x475cd9(0x1dd3)]?.['length'])try{await db[_0x475cd9(0x1dd3)]['clear']();const _0x3b9f47=_0x46f5ff[_0x475cd9(0x1dd3)][_0x475cd9(0xf6d)](_0x3d91b1=>({..._0x3d91b1,'id':_0x3d91b1['id']||Date[_0x475cd9(0x18e0)]()+Math['floor'](Math[_0x475cd9(0x191c)]()*0x3e8)}));await db[_0x475cd9(0x1dd3)][_0x475cd9(0x4c5)](_0x3b9f47),_0x29beee++;}catch(_0x4759ce){_0x46b990[_0x475cd9(0x6ee)](_0x475cd9(0x1764)+_0x4759ce['message']);}if(_0x46f5ff[_0x475cd9(0x14ee)]?.['length'])try{await db['groupChats'][_0x475cd9(0x2215)]();const _0x2d2d26=_0x46f5ff['groupChats']['map'](_0x4793e9=>({..._0x4793e9,'id':_0x4793e9['id']||_0x475cd9(0x1cd5)+Date['now']()+'_'+Math[_0x475cd9(0x191c)]()[_0x475cd9(0x9a3)](0x24)[_0x475cd9(0x18cf)](0x2,0x9)}));await db[_0x475cd9(0x14ee)][_0x475cd9(0x4c5)](_0x2d2d26),_0x29beee++,console[_0x475cd9(0xc0d)]('✅\x20修复脚本：成功导入\x20'+_0x2d2d26[_0x475cd9(0xcbf)]+'\x20个群聊');}catch(_0x3f9805){console[_0x475cd9(0x24ab)]('❌\x20修复脚本：群聊导入失败:',_0x3f9805),_0x46b990[_0x475cd9(0x6ee)]('群聊:\x20'+_0x3f9805[_0x475cd9(0xd7a)]);}if(_0x46f5ff[_0x475cd9(0x195c)]?.[_0x475cd9(0xcbf)])try{await db['worldbooks'][_0x475cd9(0x2215)]();const _0x3e79e0=_0x46f5ff[_0x475cd9(0x195c)]['map'](_0x455518=>({..._0x455518,'id':_0x455518['id']||_0x475cd9(0x2259)+Date['now']()+'_'+Math['random']()[_0x475cd9(0x9a3)](0x24)[_0x475cd9(0x18cf)](0x2,0x9)}));await db[_0x475cd9(0x195c)][_0x475cd9(0x4c5)](_0x3e79e0),_0x29beee++;}catch(_0x2812f7){_0x46b990[_0x475cd9(0x6ee)](_0x475cd9(0x71f)+_0x2812f7[_0x475cd9(0xd7a)]);}if(_0x46f5ff[_0x475cd9(0x4b0)]?.['length'])try{await db[_0x475cd9(0x4b0)][_0x475cd9(0x2215)]();const _0x1412d7=_0x46f5ff['worldbookEntries'][_0x475cd9(0xf6d)](_0x5efbde=>({..._0x5efbde,'id':_0x5efbde['id']||_0x475cd9(0x20f9)+Date[_0x475cd9(0x18e0)]()+'_'+Math[_0x475cd9(0x191c)]()[_0x475cd9(0x9a3)](0x24)[_0x475cd9(0x18cf)](0x2,0x9)}));await db['worldbookEntries'][_0x475cd9(0x4c5)](_0x1412d7),_0x29beee++;}catch(_0x53a6d9){_0x46b990['push'](_0x475cd9(0x1425)+_0x53a6d9['message']);}if(_0x46f5ff[_0x475cd9(0x9b5)]?.[_0x475cd9(0xcbf)])try{await db[_0x475cd9(0x9b5)][_0x475cd9(0x2215)]();const _0x207f0f=_0x46f5ff[_0x475cd9(0x9b5)][_0x475cd9(0xf6d)](_0x304867=>({..._0x304867,'id':_0x304867['id']||_0x475cd9(0x12a4)+Date[_0x475cd9(0x18e0)]()+'_'+Math[_0x475cd9(0x191c)]()[_0x475cd9(0x9a3)](0x24)[_0x475cd9(0x18cf)](0x2,0x9)}));await db[_0x475cd9(0x9b5)]['bulkPut'](_0x207f0f),_0x29beee++;}catch(_0x5ef44f){_0x46b990[_0x475cd9(0x6ee)]('工作记忆:\x20'+_0x5ef44f['message']);}if(_0x46f5ff[_0x475cd9(0x1982)]?.[_0x475cd9(0xcbf)])try{await db[_0x475cd9(0x1982)]['clear']();const _0x39a54c=_0x46f5ff[_0x475cd9(0x1982)][_0x475cd9(0xf6d)](_0x3223a5=>({..._0x3223a5,'id':_0x3223a5['id']||'summary_'+Date[_0x475cd9(0x18e0)]()+'_'+Math['random']()[_0x475cd9(0x9a3)](0x24)['substr'](0x2,0x9)}));await db[_0x475cd9(0x1982)]['bulkPut'](_0x39a54c),_0x29beee++;}catch(_0x3f4e9b){_0x46b990[_0x475cd9(0x6ee)]('记忆总结:\x20'+_0x3f4e9b[_0x475cd9(0xd7a)]);}if(_0x46f5ff['memoryEvents']?.[_0x475cd9(0xcbf)])try{await db['memoryEvents'][_0x475cd9(0x2215)]();const _0x5a9e7a=_0x46f5ff['memoryEvents']['map'](_0x542e88=>({..._0x542e88,'id':_0x542e88['id']||'event_'+Date[_0x475cd9(0x18e0)]()+'_'+Math[_0x475cd9(0x191c)]()[_0x475cd9(0x9a3)](0x24)[_0x475cd9(0x18cf)](0x2,0x9)}));await db[_0x475cd9(0x4ad)][_0x475cd9(0x4c5)](_0x5a9e7a),_0x29beee++;}catch(_0x3e36ca){_0x46b990[_0x475cd9(0x6ee)](_0x475cd9(0x17ab)+_0x3e36ca[_0x475cd9(0xd7a)]);}if(_0x46f5ff[_0x475cd9(0xa1f)]?.[_0x475cd9(0xcbf)])try{await db[_0x475cd9(0xa1f)][_0x475cd9(0x2215)]();const _0x1605c5=_0x46f5ff[_0x475cd9(0xa1f)]['map'](_0xea3625=>({..._0xea3625,'id':_0xea3625['id']||'recent_'+Date[_0x475cd9(0x18e0)]()+'_'+Math[_0x475cd9(0x191c)]()['toString'](0x24)[_0x475cd9(0x18cf)](0x2,0x9)}));await db[_0x475cd9(0xa1f)][_0x475cd9(0x4c5)](_0x1605c5),_0x29beee++;}catch(_0x42f9e8){_0x46b990[_0x475cd9(0x6ee)](_0x475cd9(0x136b)+_0x42f9e8[_0x475cd9(0xd7a)]);}if(_0x46f5ff[_0x475cd9(0x229d)]?.[_0x475cd9(0xcbf)])try{await db['wallpapers'][_0x475cd9(0x2215)]();const _0x117f87=_0x46f5ff['wallpapers'][_0x475cd9(0xf6d)](_0x3ca5b7=>({..._0x3ca5b7,'id':_0x3ca5b7['id']||'wp_'+Date[_0x475cd9(0x18e0)]()+'_'+Math['random']()['toString'](0x24)[_0x475cd9(0x18cf)](0x2,0x9)}));await db['wallpapers'][_0x475cd9(0x4c5)](_0x117f87),_0x29beee++;}catch(_0x5dee97){_0x46b990['push']('壁纸:\x20'+_0x5dee97[_0x475cd9(0xd7a)]);}if(_0x46f5ff['appIcons']?.[_0x475cd9(0xcbf)])try{await db[_0x475cd9(0x1f22)][_0x475cd9(0x2215)]();const _0x4e01f2=_0x46f5ff['appIcons'][_0x475cd9(0xf6d)](_0x1f2e7b=>({..._0x1f2e7b,'id':_0x1f2e7b['id']||_0x475cd9(0x1a98)+Date[_0x475cd9(0x18e0)]()+'_'+Math['random']()[_0x475cd9(0x9a3)](0x24)[_0x475cd9(0x18cf)](0x2,0x9)}));await db[_0x475cd9(0x1f22)][_0x475cd9(0x4c5)](_0x4e01f2),_0x29beee++;}catch(_0x4f3bed){_0x46b990[_0x475cd9(0x6ee)]('应用图标:\x20'+_0x4f3bed[_0x475cd9(0xd7a)]);}if(_0x46f5ff[_0x475cd9(0x1f1d)]?.[_0x475cd9(0xcbf)])try{await db[_0x475cd9(0x1f1d)][_0x475cd9(0x2215)]();const _0x3ef751=_0x46f5ff[_0x475cd9(0x1f1d)][_0x475cd9(0xf6d)](_0x268f24=>({..._0x268f24,'id':_0x268f24['id']||_0x475cd9(0x183f)+Date[_0x475cd9(0x18e0)]()+'_'+Math[_0x475cd9(0x191c)]()[_0x475cd9(0x9a3)](0x24)[_0x475cd9(0x18cf)](0x2,0x9)}));await db[_0x475cd9(0x1f1d)][_0x475cd9(0x4c5)](_0x3ef751),_0x29beee++;}catch(_0x1bb2ad){_0x46b990[_0x475cd9(0x6ee)](_0x475cd9(0x795)+_0x1bb2ad[_0x475cd9(0xd7a)]);}if(_0x46f5ff[_0x475cd9(0x530)]?.['length'])try{await db[_0x475cd9(0x530)][_0x475cd9(0x2215)]();const _0x5563b9=_0x46f5ff[_0x475cd9(0x530)][_0x475cd9(0xf6d)](_0x4c58f7=>({..._0x4c58f7,'id':_0x4c58f7['id']||_0x475cd9(0x1c13)+Date['now']()+'_'+Math[_0x475cd9(0x191c)]()[_0x475cd9(0x9a3)](0x24)[_0x475cd9(0x18cf)](0x2,0x9)}));await db[_0x475cd9(0x530)]['bulkPut'](_0x5563b9),_0x29beee++;}catch(_0x55735b){_0x46b990['push'](_0x475cd9(0x15bb)+_0x55735b[_0x475cd9(0xd7a)]);}if(_0x46f5ff['globalSettings']?.[_0x475cd9(0xcbf)])try{await db[_0x475cd9(0x2217)][_0x475cd9(0x2215)]();const _0x213cc2=_0x46f5ff[_0x475cd9(0x2217)]['map'](_0x540b75=>({..._0x540b75,'id':_0x540b75['id']||'global_'+Date[_0x475cd9(0x18e0)]()+'_'+Math['random']()[_0x475cd9(0x9a3)](0x24)[_0x475cd9(0x18cf)](0x2,0x9)}));await db['globalSettings'][_0x475cd9(0x4c5)](_0x213cc2),_0x29beee++;}catch(_0x58e9eb){_0x46b990[_0x475cd9(0x6ee)](_0x475cd9(0x1094)+_0x58e9eb[_0x475cd9(0xd7a)]);}if(_0x46f5ff[_0x475cd9(0x101)]?.['length'])try{await db['momentLikes'][_0x475cd9(0x2215)]();const _0x4b4697=_0x46f5ff[_0x475cd9(0x101)][_0x475cd9(0xf6d)](_0x464724=>({..._0x464724,'id':_0x464724['id']||_0x475cd9(0x20e3)+Date[_0x475cd9(0x18e0)]()+'_'+Math[_0x475cd9(0x191c)]()[_0x475cd9(0x9a3)](0x24)[_0x475cd9(0x18cf)](0x2,0x9)}));await db['momentLikes'][_0x475cd9(0x4c5)](_0x4b4697),_0x29beee++;}catch(_0x56b57c){_0x46b990[_0x475cd9(0x6ee)](_0x475cd9(0x4a8)+_0x56b57c['message']);}if(_0x46f5ff[_0x475cd9(0x3b2)]?.[_0x475cd9(0xcbf)])try{await db['forumPostImages'][_0x475cd9(0x2215)]();const _0x1ffc39=_0x46f5ff[_0x475cd9(0x3b2)][_0x475cd9(0xf6d)](_0x4e9357=>({..._0x4e9357,'id':_0x4e9357['id']||_0x475cd9(0x1ef6)+Date[_0x475cd9(0x18e0)]()+'_'+Math[_0x475cd9(0x191c)]()[_0x475cd9(0x9a3)](0x24)[_0x475cd9(0x18cf)](0x2,0x9)}));await db[_0x475cd9(0x3b2)][_0x475cd9(0x4c5)](_0x1ffc39),_0x29beee++;}catch(_0x350828){_0x46b990[_0x475cd9(0x6ee)](_0x475cd9(0x755)+_0x350828[_0x475cd9(0xd7a)]);}if(_0x46f5ff[_0x475cd9(0x657)]?.[_0x475cd9(0xcbf)])try{await db[_0x475cd9(0x657)]['clear']();const _0x41cbc5=_0x46f5ff[_0x475cd9(0x657)][_0x475cd9(0xf6d)](_0x423afd=>({..._0x423afd,'id':_0x423afd['id']||_0x475cd9(0x1303)+Date['now']()+'_'+Math[_0x475cd9(0x191c)]()[_0x475cd9(0x9a3)](0x24)['substr'](0x2,0x9)}));await db[_0x475cd9(0x657)][_0x475cd9(0x4c5)](_0x41cbc5),_0x29beee++;}catch(_0x2a00eb){_0x46b990[_0x475cd9(0x6ee)](_0x475cd9(0x19b4)+_0x2a00eb[_0x475cd9(0xd7a)]);}if(_0x46f5ff[_0x475cd9(0x2c5)]?.[_0x475cd9(0xcbf)])try{await db[_0x475cd9(0x2c5)][_0x475cd9(0x2215)]();const _0x5044ca=_0x46f5ff[_0x475cd9(0x2c5)][_0x475cd9(0xf6d)](_0x173268=>({..._0x173268,'id':_0x173268['id']||_0x475cd9(0xb1d)+Date[_0x475cd9(0x18e0)]()+'_'+Math['random']()['toString'](0x24)[_0x475cd9(0x18cf)](0x2,0x9)}));await db[_0x475cd9(0x2c5)]['bulkPut'](_0x5044ca),_0x29beee++;}catch(_0x5b2937){_0x46b990[_0x475cd9(0x6ee)]('纪念日:\x20'+_0x5b2937['message']);}if(_0x46f5ff[_0x475cd9(0xda3)]?.[_0x475cd9(0xcbf)])try{await db['diarySettings'][_0x475cd9(0x2215)]();const _0x4aa352=_0x46f5ff[_0x475cd9(0xda3)][_0x475cd9(0xf6d)](_0x10b390=>({..._0x10b390,'id':_0x10b390['id']||'diary_'+Date[_0x475cd9(0x18e0)]()+'_'+Math['random']()[_0x475cd9(0x9a3)](0x24)[_0x475cd9(0x18cf)](0x2,0x9)}));await db[_0x475cd9(0xda3)][_0x475cd9(0x4c5)](_0x4aa352),_0x29beee++;}catch(_0x151de2){_0x46b990[_0x475cd9(0x6ee)](_0x475cd9(0x1142)+_0x151de2[_0x475cd9(0xd7a)]);}if(_0x46f5ff[_0x475cd9(0xfc7)]?.[_0x475cd9(0xcbf)])try{await db[_0x475cd9(0xfc7)]['clear']();const _0x198f7e=_0x46f5ff[_0x475cd9(0xfc7)][_0x475cd9(0xf6d)](_0x3fd264=>({..._0x3fd264,'id':_0x3fd264['id']||_0x475cd9(0x1c2b)+Date['now']()+'_'+Math['random']()[_0x475cd9(0x9a3)](0x24)[_0x475cd9(0x18cf)](0x2,0x9)}));await db[_0x475cd9(0xfc7)][_0x475cd9(0x4c5)](_0x198f7e),_0x29beee++;}catch(_0x5e747a){_0x46b990[_0x475cd9(0x6ee)](_0x475cd9(0x7d9)+_0x5e747a['message']);}if(_0x46f5ff[_0x475cd9(0x1c45)]?.[_0x475cd9(0xcbf)])try{await db['blacklist'][_0x475cd9(0x2215)]();const _0x47418a=_0x46f5ff['blacklist'][_0x475cd9(0xf6d)](_0x4fa6bd=>({..._0x4fa6bd,'id':_0x4fa6bd['id']||_0x475cd9(0xcef)+Date[_0x475cd9(0x18e0)]()+'_'+Math[_0x475cd9(0x191c)]()[_0x475cd9(0x9a3)](0x24)[_0x475cd9(0x18cf)](0x2,0x9)}));await db['blacklist'][_0x475cd9(0x4c5)](_0x47418a),_0x29beee++;}catch(_0x1fc4cb){_0x46b990[_0x475cd9(0x6ee)](_0x475cd9(0x9f7)+_0x1fc4cb[_0x475cd9(0xd7a)]);}if(_0x46f5ff[_0x475cd9(0x189f)]?.['length'])try{await db[_0x475cd9(0x189f)]['clear']();const _0x5d3c22=_0x46f5ff[_0x475cd9(0x189f)][_0x475cd9(0xf6d)](_0x36afc5=>({..._0x36afc5,'id':_0x36afc5['id']||_0x475cd9(0x4cd)+Date[_0x475cd9(0x18e0)]()+'_'+Math['random']()['toString'](0x24)['substr'](0x2,0x9)}));await db[_0x475cd9(0x189f)][_0x475cd9(0x4c5)](_0x5d3c22),_0x29beee++;}catch(_0x3a2e39){_0x46b990[_0x475cd9(0x6ee)](_0x475cd9(0x1ce7)+_0x3a2e39[_0x475cd9(0xd7a)]);}if(_0x46f5ff[_0x475cd9(0xa52)]?.[_0x475cd9(0xcbf)])try{await db[_0x475cd9(0xa52)]['clear']();const _0x32160b=_0x46f5ff[_0x475cd9(0xa52)][_0x475cd9(0xf6d)](_0x24e1c6=>({..._0x24e1c6,'id':_0x24e1c6['id']||_0x475cd9(0x36d)+Date[_0x475cd9(0x18e0)]()+'_'+Math[_0x475cd9(0x191c)]()['toString'](0x24)['substr'](0x2,0x9)}));await db[_0x475cd9(0xa52)][_0x475cd9(0x4c5)](_0x32160b),_0x29beee++;}catch(_0x22984f){_0x46b990[_0x475cd9(0x6ee)](_0x475cd9(0x79f)+_0x22984f[_0x475cd9(0xd7a)]);}if(_0x46f5ff[_0x475cd9(0x5a2)]?.['length'])try{await db[_0x475cd9(0x5a2)][_0x475cd9(0x2215)]();const _0x484814=_0x46f5ff['characterStatus'][_0x475cd9(0xf6d)](_0x205ad0=>({..._0x205ad0,'id':_0x205ad0['id']||'status_'+Date[_0x475cd9(0x18e0)]()+'_'+Math[_0x475cd9(0x191c)]()['toString'](0x24)['substr'](0x2,0x9)}));await db[_0x475cd9(0x5a2)][_0x475cd9(0x4c5)](_0x484814),_0x29beee++;}catch(_0x4fd2c2){_0x46b990[_0x475cd9(0x6ee)](_0x475cd9(0xf00)+_0x4fd2c2[_0x475cd9(0xd7a)]);}if(_0x46f5ff[_0x475cd9(0x1143)]?.[_0x475cd9(0xcbf)])try{await db[_0x475cd9(0x1143)][_0x475cd9(0x2215)]();const _0x507a0e=_0x46f5ff[_0x475cd9(0x1143)][_0x475cd9(0xf6d)](_0x4ba306=>({..._0x4ba306,'id':_0x4ba306['id']||_0x475cd9(0x2512)+Date[_0x475cd9(0x18e0)]()+'_'+Math[_0x475cd9(0x191c)]()[_0x475cd9(0x9a3)](0x24)[_0x475cd9(0x18cf)](0x2,0x9)}));await db[_0x475cd9(0x1143)]['bulkPut'](_0x507a0e),_0x29beee++;}catch(_0xccb74){_0x46b990['push'](_0x475cd9(0x1ad)+_0xccb74[_0x475cd9(0xd7a)]);}if(_0x46f5ff[_0x475cd9(0xe3d)]?.[_0x475cd9(0xcbf)])try{await db[_0x475cd9(0xe3d)]['clear']();const _0x5523b7=_0x46f5ff['offlineUISettings'][_0x475cd9(0xf6d)](_0x1dcaa6=>({..._0x1dcaa6,'id':_0x1dcaa6['id']||_0x475cd9(0x20cd)+Date['now']()+'_'+Math[_0x475cd9(0x191c)]()['toString'](0x24)[_0x475cd9(0x18cf)](0x2,0x9)}));await db[_0x475cd9(0xe3d)][_0x475cd9(0x4c5)](_0x5523b7),_0x29beee++;}catch(_0x57c12e){_0x46b990[_0x475cd9(0x6ee)](_0x475cd9(0x19dc)+_0x57c12e[_0x475cd9(0xd7a)]);}if(_0x46f5ff[_0x475cd9(0xa0c)]?.[_0x475cd9(0xcbf)])try{await db['offlinePresets']['clear']();const _0x2e3a52=_0x46f5ff[_0x475cd9(0xa0c)]['map'](_0x6feb30=>({..._0x6feb30,'id':_0x6feb30['id']||_0x475cd9(0x197a)+Date['now']()+'_'+Math['random']()[_0x475cd9(0x9a3)](0x24)[_0x475cd9(0x18cf)](0x2,0x9)}));await db[_0x475cd9(0xa0c)][_0x475cd9(0x4c5)](_0x2e3a52),_0x29beee++;}catch(_0x386f21){_0x46b990[_0x475cd9(0x6ee)]('线下预设:\x20'+_0x386f21[_0x475cd9(0xd7a)]);}if(_0x46f5ff[_0x475cd9(0x13ac)]?.['length'])try{await db[_0x475cd9(0x13ac)]['clear']();const _0x3d68d2=_0x46f5ff[_0x475cd9(0x13ac)]['map'](_0x2132f3=>({..._0x2132f3,'id':_0x2132f3['id']||_0x475cd9(0x232e)+Date[_0x475cd9(0x18e0)]()+'_'+Math['random']()[_0x475cd9(0x9a3)](0x24)[_0x475cd9(0x18cf)](0x2,0x9)}));await db[_0x475cd9(0x13ac)][_0x475cd9(0x4c5)](_0x3d68d2),_0x29beee++;}catch(_0x4aff58){_0x46b990[_0x475cd9(0x6ee)]('音乐:\x20'+_0x4aff58[_0x475cd9(0xd7a)]);}if(_0x46f5ff[_0x475cd9(0x1235)]?.[_0x475cd9(0xcbf)])try{await db['musicCovers']['clear']();const _0xfe6b94=_0x46f5ff['musicCovers'][_0x475cd9(0xf6d)](_0x455c95=>({..._0x455c95,'id':_0x455c95['id']||_0x475cd9(0x2e6)+Date['now']()+'_'+Math[_0x475cd9(0x191c)]()['toString'](0x24)[_0x475cd9(0x18cf)](0x2,0x9)}));await db['musicCovers'][_0x475cd9(0x4c5)](_0xfe6b94),_0x29beee++;}catch(_0x201e3d){_0x46b990[_0x475cd9(0x6ee)](_0x475cd9(0x1090)+_0x201e3d[_0x475cd9(0xd7a)]);}if(_0x46f5ff[_0x475cd9(0x111c)]?.['length'])try{await db[_0x475cd9(0x111c)][_0x475cd9(0x2215)]();const _0x278211=_0x46f5ff[_0x475cd9(0x111c)]['map'](_0x10859d=>({..._0x10859d,'id':_0x10859d['id']||_0x475cd9(0x229a)+Date[_0x475cd9(0x18e0)]()+'_'+Math[_0x475cd9(0x191c)]()[_0x475cd9(0x9a3)](0x24)[_0x475cd9(0x18cf)](0x2,0x9)}));await db[_0x475cd9(0x111c)][_0x475cd9(0x4c5)](_0x278211),_0x29beee++;}catch(_0x2a3a8d){_0x46b990['push'](_0x475cd9(0x1eaa)+_0x2a3a8d[_0x475cd9(0xd7a)]);}if(_0x46f5ff[_0x475cd9(0xd94)]?.[_0x475cd9(0xcbf)])try{await db[_0x475cd9(0xd94)][_0x475cd9(0x2215)]();const _0xe30268=_0x46f5ff[_0x475cd9(0xd94)]['map'](_0x3cae98=>({..._0x3cae98,'id':_0x3cae98['id']||_0x475cd9(0x108)+Date[_0x475cd9(0x18e0)]()+'_'+Math[_0x475cd9(0x191c)]()['toString'](0x24)['substr'](0x2,0x9)}));await db[_0x475cd9(0xd94)]['bulkPut'](_0xe30268),_0x29beee++;}catch(_0x148306){_0x46b990[_0x475cd9(0x6ee)]('短信消息:\x20'+_0x148306[_0x475cd9(0xd7a)]);}await loadCharacterGroups(),await loadCharacters(),await loadContacts(),await loadChatMessages(),await loadChatSettings(),await loadGroupChats(),await loadWorldbooks(),renderCharacterList(),renderContactList(),renderMessageList();try{await renderForumArchives(),renderWorldbookList();}catch(_0x2f09ed){console[_0x475cd9(0x24ab)](_0x475cd9(0x108b),_0x2f09ed);}const _0x2ef7ef=_0x29beee>0x0?'🎉\x20导入成功\x20'+_0x29beee+'\x20项'+(_0x46b990[_0x475cd9(0xcbf)]?_0x475cd9(0x7f8)+_0x46b990[_0x475cd9(0xcbf)]+_0x475cd9(0x2129):''):_0x475cd9(0x918)+_0x46b990[_0x475cd9(0x140c)]('\x0a');showToast(_0x2ef7ef,_0x29beee>0x0?'success':_0x475cd9(0x24ab));}catch(_0x411f3c){showToast('❌\x20导入失败:\x20'+_0x411f3c[_0x475cd9(0xd7a)],'error'),_0x411f3c[_0x475cd9(0xd7a)][_0x475cd9(0x23ec)](_0x475cd9(0x1fc8))&&setTimeout(()=>alert(_0x475cd9(0x20b4)),0x3e8);}},_0x212f14[_0x241d31(0x1e62)]();};}(),function fixReplyIssues(){const _0x49f761=window['generateReplyHTML'];window['generateReplyHTML']=function(_0x26e762){const _0x1897e6=_0x3a81;if(!_0x26e762)return'';let _0x34c88c={'id':_0x26e762['id']||'unknown','senderName':_0x26e762[_0x1897e6(0xadb)]||'未知','content':_0x26e762[_0x1897e6(0x1423)]||'[已删除]'};if(_0x26e762['id']!==_0x1897e6(0x22b3)&&currentChatCharacter){const _0x4b8de3=chatMessages[currentChatCharacter['id']]||[],_0x1f6d56=_0x4b8de3[_0x1897e6(0x1aeb)](_0x9aeb9a=>_0x9aeb9a['id']===_0x26e762['id']);if(_0x1f6d56){if(Array[_0x1897e6(0x1bcc)](_0x1f6d56[_0x1897e6(0x1423)])){const _0x78510e=_0x1f6d56[_0x1897e6(0x1423)][_0x1897e6(0x1aeb)](_0x58cb7c=>_0x58cb7c[_0x1897e6(0x23df)]===_0x1897e6(0x1e58)),_0x18b22f=_0x1f6d56[_0x1897e6(0x1423)][_0x1897e6(0x1aeb)](_0x434e77=>_0x434e77[_0x1897e6(0x23df)]===_0x1897e6(0x1cfa));if(_0x78510e?.[_0x1897e6(0x1e58)])_0x34c88c[_0x1897e6(0x1423)]=_0x78510e['text'];else _0x18b22f?_0x34c88c[_0x1897e6(0x1423)]=_0x1897e6(0xff7):_0x34c88c[_0x1897e6(0x1423)]='[多媒体消息]';}else _0x34c88c[_0x1897e6(0x1423)]=_0x1f6d56['content']||_0x1897e6(0xff7);_0x34c88c[_0x1897e6(0xadb)]=getSenderDisplayName(_0x1f6d56);}}const _0x56961d=truncateText(_0x34c88c['content'],0x14);return _0x1897e6(0x1ae)+_0x34c88c['id']+_0x1897e6(0xaaa)+_0x34c88c[_0x1897e6(0xadb)]+_0x1897e6(0x1be4)+_0x56961d+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';};}();async function diagnoseDatabaseIssue(){const _0x414858=_0x2cf6d4;try{console[_0x414858(0xc0d)]('🔍\x20开始数据库状态诊断...');if(!db){console['error'](_0x414858(0x6d2));return;}const _0x43f720=[_0x414858(0x75b),_0x414858(0x4ad),_0x414858(0x5a2)];for(const _0x1f4740 of _0x43f720){if(db[_0x1f4740]){console['log'](_0x414858(0x3cc)+_0x1f4740+_0x414858(0x2561));try{const _0x30c231=await db[_0x1f4740]['count']();console[_0x414858(0xc0d)]('📊\x20表\x20'+_0x1f4740+_0x414858(0x1db0)+_0x30c231);}catch(_0x44359c){console['error'](_0x414858(0x279)+_0x1f4740+_0x414858(0xcf8),_0x44359c);}}else console[_0x414858(0x24ab)](_0x414858(0x20f8)+_0x1f4740+_0x414858(0x1df1));}const _0xc28a43={'id':_0x414858(0x354)+Date['now'](),'characterId':_0x414858(0x1344),'appType':'test','action':'test_action','timestamp':Date['now'](),'context':{'test':!![]},'messageId':null};try{await db[_0x414858(0x75b)][_0x414858(0xe1)](_0xc28a43),console[_0x414858(0xc0d)](_0x414858(0x1ee3)),await db[_0x414858(0x75b)][_0x414858(0xc2b)](_0xc28a43['id']),console[_0x414858(0xc0d)](_0x414858(0x1713));}catch(_0xb81a18){console[_0x414858(0x24ab)](_0x414858(0x408),_0xb81a18);}}catch(_0x1ab710){console[_0x414858(0x24ab)](_0x414858(0x1133),_0x1ab710);}}setTimeout(()=>{diagnoseDatabaseIssue();},0x1388);async function emergencyDataRecovery(){const _0x3df2b5=_0x2cf6d4;console['log']('===\x20紧急数据恢复开始\x20===');try{const _0x372078=await db[_0x3df2b5(0x164d)][_0x3df2b5(0x18c6)](),_0xe46396=await db['chatMessages'][_0x3df2b5(0x18c6)](),_0x51e03e=await db['contacts'][_0x3df2b5(0x18c6)]();console[_0x3df2b5(0xc0d)](_0x3df2b5(0x244f),_0x372078),console[_0x3df2b5(0xc0d)]('IndexedDB聊天记录:',_0xe46396),console[_0x3df2b5(0xc0d)](_0x3df2b5(0xd85),_0x51e03e);const _0x5d8a6b=localStorage[_0x3df2b5(0x2250)]('characters'),_0xa5dd71=localStorage['getItem'](_0x3df2b5(0x464)),_0x27834c=localStorage[_0x3df2b5(0x2250)](_0x3df2b5(0xb51));return console['log'](_0x3df2b5(0x1905),_0x5d8a6b?JSON[_0x3df2b5(0x168e)](_0x5d8a6b):null),console[_0x3df2b5(0xc0d)](_0x3df2b5(0x2473),_0xa5dd71?JSON[_0x3df2b5(0x168e)](_0xa5dd71):null),console[_0x3df2b5(0xc0d)](_0x3df2b5(0x104c),_0x27834c?JSON[_0x3df2b5(0x168e)](_0x27834c):null),{'indexedDB':{'characters':_0x372078,'chatMessages':_0xe46396,'contacts':_0x51e03e},'localStorage':{'characters':_0x5d8a6b?JSON['parse'](_0x5d8a6b):null,'chatMessages':_0xa5dd71?JSON[_0x3df2b5(0x168e)](_0xa5dd71):null,'contacts':_0x27834c?JSON[_0x3df2b5(0x168e)](_0x27834c):null}};}catch(_0x1fd9b0){return console[_0x3df2b5(0x24ab)](_0x3df2b5(0xce1),_0x1fd9b0),null;}}async function recoverFromExportData(_0x232d50){const _0x527ddc=_0x2cf6d4;try{console[_0x527ddc(0xc0d)](_0x527ddc(0x112e));if(_0x232d50[_0x527ddc(0x164d)]&&_0x232d50[_0x527ddc(0x164d)][_0x527ddc(0xcbf)]>0x0){const _0x59833f=_0x232d50['characters'][_0x527ddc(0x803)](_0x2dc562=>_0x2dc562[_0x527ddc(0x222f)]!=='张三'&&_0x2dc562[_0x527ddc(0x222f)]!=='李四');console['log']('有效角色数据:',_0x59833f),await safeDataSave(_0x527ddc(0x164d),_0x59833f),characters=_0x59833f;const _0x392bde=_0x59833f['map'](_0x32bced=>_0x32bced['id']);contacts=_0x392bde,await saveContacts(),console[_0x527ddc(0xc0d)]('角色数据恢复完成');}if(_0x232d50[_0x527ddc(0x464)]){await db[_0x527ddc(0x464)][_0x527ddc(0x2215)]();for(const [_0x5e9572,_0x58f18e]of Object[_0x527ddc(0x230e)](_0x232d50['chatMessages'])){if(_0x58f18e&&_0x58f18e[_0x527ddc(0xcbf)]>0x0)for(const _0x27fdc3 of _0x58f18e){await db['chatMessages'][_0x527ddc(0xe1)]({'characterId':_0x5e9572,..._0x27fdc3});}}chatMessages=_0x232d50[_0x527ddc(0x464)],console[_0x527ddc(0xc0d)](_0x527ddc(0x1746));}return renderCharacterList(),renderContactList(),renderMessageList(),showToast('数据恢复成功！','success'),!![];}catch(_0x5da118){return console[_0x527ddc(0x24ab)](_0x527ddc(0x108f),_0x5da118),showToast(_0x527ddc(0x247e)+_0x5da118[_0x527ddc(0xd7a)],_0x527ddc(0x24ab)),![];}}function addRecoveryLog(_0x339a89){const _0x3d0e3a=_0x2cf6d4,_0x2c2856=document[_0x3d0e3a(0x566)]('recovery-log'),_0x5f18de=document[_0x3d0e3a(0x566)](_0x3d0e3a(0xdd3));if(_0x2c2856&&_0x5f18de){_0x2c2856[_0x3d0e3a(0x655)][_0x3d0e3a(0x2526)]=_0x3d0e3a(0x2d4);const _0x17ee94=new Date()[_0x3d0e3a(0xd4a)]();_0x5f18de[_0x3d0e3a(0xc02)]+='['+_0x17ee94+']\x20'+_0x339a89+'\x0a',_0x5f18de[_0x3d0e3a(0x5e5)]=_0x5f18de[_0x3d0e3a(0x14c8)];}}async function checkDataStatus(){const _0x30be88=_0x2cf6d4;addRecoveryLog(_0x30be88(0x2279));try{const _0xa723d=await db[_0x30be88(0x164d)][_0x30be88(0x18c6)](),_0x22c8e0=await db[_0x30be88(0x464)]['toArray'](),_0x8ef4c2=await db['contacts'][_0x30be88(0x18c6)](),_0x163b5e=localStorage['getItem']('characters'),_0x15bf5e=localStorage['getItem'](_0x30be88(0x464)),_0x40171b=localStorage[_0x30be88(0x2250)]('contacts'),_0x590ef4='\x0a===\x20数据状态检查结果\x20===\x0a\x0a📊\x20IndexedDB\x20数据：\x0a-\x20角色数量:\x20'+_0xa723d[_0x30be88(0xcbf)]+_0x30be88(0xac6)+_0x22c8e0[_0x30be88(0xcbf)]+'\x20条\x0a-\x20联系人:\x20'+_0x8ef4c2['length']+_0x30be88(0x7a3)+(_0x163b5e?JSON['parse'](_0x163b5e)['length']:0x0)+_0x30be88(0x156e)+(_0x15bf5e?Object[_0x30be88(0x16c7)](JSON[_0x30be88(0x168e)](_0x15bf5e))[_0x30be88(0xcbf)]:0x0)+_0x30be88(0x1be3)+(_0x40171b?JSON[_0x30be88(0x168e)](_0x40171b)[_0x30be88(0xcbf)]:0x0)+_0x30be88(0x21c2)+characters[_0x30be88(0xcbf)]+_0x30be88(0x1485)+contacts[_0x30be88(0xcbf)]+_0x30be88(0x1862)+Object['keys'](chatMessages)[_0x30be88(0xcbf)]+'\x20个对话\x0a\x0a⚠️\x20异常角色检测：\x0a'+(_0xa723d[_0x30be88(0x803)](_0x16de68=>_0x16de68[_0x30be88(0x222f)]==='张三'||_0x16de68[_0x30be88(0x222f)]==='李四')[_0x30be88(0xf6d)](_0x2e05bb=>'-\x20'+_0x2e05bb[_0x30be88(0x222f)]+_0x30be88(0x192)+_0x2e05bb['id']+')')[_0x30be88(0x140c)]('\x0a')||'未发现异常角色')+_0x30be88(0x1edd);document['getElementById']('data-status-result')[_0x30be88(0x655)][_0x30be88(0x2526)]=_0x30be88(0x2d4),document['getElementById']('data-status-text')[_0x30be88(0x21dc)]=_0x590ef4,addRecoveryLog(_0x30be88(0x14bc));}catch(_0x37e88e){addRecoveryLog('数据检查失败:\x20'+_0x37e88e[_0x30be88(0xd7a)]);}}async function deepDataSearch(){const _0x31d6db=_0x2cf6d4;addRecoveryLog('开始深度搜索残留数据...');try{const _0x4d0564=[];addRecoveryLog(_0x31d6db(0xcaf));for(let _0x4c0062=0x0;_0x4c0062<localStorage[_0x31d6db(0xcbf)];_0x4c0062++){const _0x20805f=localStorage[_0x31d6db(0x157f)](_0x4c0062);if(_0x20805f&&(_0x20805f['includes']('character')||_0x20805f[_0x31d6db(0x23ec)](_0x31d6db(0x23b3)))){const _0x2532d0=localStorage[_0x31d6db(0x2250)](_0x20805f);if(_0x2532d0&&_0x2532d0[_0x31d6db(0xcbf)]>0x64){_0x4d0564[_0x31d6db(0x6ee)]('localStorage['+_0x20805f+_0x31d6db(0x2490)+_0x2532d0['length']+_0x31d6db(0x1cf7));if(_0x20805f===_0x31d6db(0xc96))_0x4d0564[_0x31d6db(0x6ee)](_0x31d6db(0x1b69)),_0x4d0564[_0x31d6db(0x6ee)](_0x31d6db(0x20fa));else{if(_0x20805f[_0x31d6db(0x1cab)](_0x31d6db(0x20f4))){const _0xacaffd=_0x20805f['replace'](_0x31d6db(0x20f4),'');_0x4d0564[_0x31d6db(0x6ee)]('\x20\x20⚠️\x20发现聊天'+_0xacaffd+'的紧急备份！'),_0x4d0564[_0x31d6db(0x6ee)]('\x20\x20📋\x20点击下方\x22恢复紧急备份\x22按钮来尝试恢复');}}}}}addRecoveryLog(_0x31d6db(0x2485));const _0x1c8e44=[_0x31d6db(0x164d),_0x31d6db(0x464),_0x31d6db(0xb51),'chatSettings',_0x31d6db(0x20c7),_0x31d6db(0x195c),_0x31d6db(0x1a72),'personas','groupChats'];for(const _0x574cf8 of _0x1c8e44){try{const _0x343ad5=await db[_0x574cf8]['toArray']();_0x343ad5[_0x31d6db(0xcbf)]>0x0&&(_0x4d0564[_0x31d6db(0x6ee)](_0x31d6db(0x1f81)+_0x574cf8+_0x31d6db(0x2490)+_0x343ad5['length']+'\x20条记录'),_0x574cf8===_0x31d6db(0x164d)&&_0x343ad5[_0x31d6db(0x900)](_0x40d29c=>{const _0xe2a5f8=_0x31d6db;_0x40d29c['name']!=='张三'&&_0x40d29c['name']!=='李四'&&_0x4d0564[_0xe2a5f8(0x6ee)](_0xe2a5f8(0x98e)+_0x40d29c[_0xe2a5f8(0x222f)]+'\x20(ID:\x20'+_0x40d29c['id']+')');}));}catch(_0x16ef56){}}addRecoveryLog('分析聊天记录...');const _0x5cc3c3=await db['chatMessages'][_0x31d6db(0x18c6)](),_0xc6a836=new Set();_0x5cc3c3[_0x31d6db(0x900)](_0x463690=>{const _0x4e896a=_0x31d6db;_0x463690[_0x4e896a(0x10df)]&&_0x463690[_0x4e896a(0x10df)]!==_0x4e896a(0x23b2)&&_0xc6a836[_0x4e896a(0xe1)](_0x463690['characterId']);});_0xc6a836[_0x31d6db(0x41a)]>0x0&&(_0x4d0564[_0x31d6db(0x6ee)]('聊天记录中发现\x20'+_0xc6a836[_0x31d6db(0x41a)]+_0x31d6db(0x1a3f)),_0xc6a836['forEach'](_0x182054=>{const _0x4d0fb5=_0x31d6db;_0x4d0564['push'](_0x4d0fb5(0x2513)+_0x182054);}));const _0x5f567b=_0x4d0564[_0x31d6db(0xcbf)]>0x0?_0x4d0564[_0x31d6db(0x140c)]('\x0a'):_0x31d6db(0x13a2);document['getElementById'](_0x31d6db(0x4f7))[_0x31d6db(0x655)][_0x31d6db(0x2526)]=_0x31d6db(0x2d4),document[_0x31d6db(0x566)](_0x31d6db(0x1e8))[_0x31d6db(0x21dc)]=_0x5f567b;const _0x421c1e=localStorage[_0x31d6db(0x2250)](_0x31d6db(0xc96)),_0x1118f4=Object[_0x31d6db(0x16c7)](localStorage)['some'](_0x4ee629=>_0x4ee629[_0x31d6db(0x1cab)](_0x31d6db(0x20f4)));if(_0x421c1e||_0x1118f4){const _0x1436ce=document[_0x31d6db(0x1ad8)](_0x31d6db(0x217f));_0x1436ce[_0x31d6db(0x21dc)]=_0x31d6db(0x23c8),_0x1436ce[_0x31d6db(0x655)][_0x31d6db(0x17a3)]=_0x31d6db(0x16be),_0x1436ce[_0x31d6db(0x11cf)]=()=>restoreEmergencyBackup();const _0x3184b6=document[_0x31d6db(0x566)](_0x31d6db(0x4f7)),_0x279253=_0x3184b6[_0x31d6db(0x15b8)]('button');if(_0x279253)_0x279253[_0x31d6db(0x128)]();_0x3184b6[_0x31d6db(0x1925)](_0x1436ce);}addRecoveryLog(_0x31d6db(0x23a6)+_0x4d0564[_0x31d6db(0xcbf)]+_0x31d6db(0x2531));}catch(_0x2191ad){addRecoveryLog(_0x31d6db(0x1211)+_0x2191ad[_0x31d6db(0xd7a)]);}}async function restoreEmergencyBackup(){const _0x4137f8=_0x2cf6d4;addRecoveryLog('开始恢复紧急备份数据...');try{let _0x3be6fd={},_0x2ad20e=0x0;const _0x5e7d8c=localStorage['getItem'](_0x4137f8(0xc96));if(_0x5e7d8c)try{const _0x1a13b1=JSON[_0x4137f8(0x168e)](_0x5e7d8c);Object[_0x4137f8(0x1284)](_0x3be6fd,_0x1a13b1),_0x2ad20e++,addRecoveryLog(_0x4137f8(0x1455)+Object[_0x4137f8(0x16c7)](_0x1a13b1)['length']+'\x20个聊天设置');}catch(_0x106ca5){addRecoveryLog('⚠️\x20全局紧急备份数据格式错误:\x20'+_0x106ca5['message']);}Object[_0x4137f8(0x16c7)](localStorage)[_0x4137f8(0x900)](_0x321c0d=>{const _0x271743=_0x4137f8;if(_0x321c0d[_0x271743(0x1cab)]('chatSettings_emergency_')){const _0x2aca67=_0x321c0d['replace'](_0x271743(0x20f4),'');try{const _0x5182bb=JSON['parse'](localStorage['getItem'](_0x321c0d));_0x3be6fd[_0x2aca67]=_0x5182bb,_0x2ad20e++,addRecoveryLog('✅\x20发现聊天'+_0x2aca67+_0x271743(0x239f));}catch(_0x5679ea){addRecoveryLog(_0x271743(0xfce)+_0x2aca67+'的紧急备份数据格式错误:\x20'+_0x5679ea[_0x271743(0xd7a)]);}}});if(Object[_0x4137f8(0x16c7)](_0x3be6fd)['length']===0x0){addRecoveryLog('❌\x20未找到有效的紧急备份数据'),showToast(_0x4137f8(0x10a1),_0x4137f8(0x24ab));return;}addRecoveryLog(_0x4137f8(0x3c6)+_0x2ad20e+_0x4137f8(0xe10)+Object['keys'](_0x3be6fd)[_0x4137f8(0xcbf)]+_0x4137f8(0x128b));let _0xccd580=0x0;Object['keys'](_0x3be6fd)['forEach'](_0x113a00=>{const _0x585c09=_0x4137f8;_0x3be6fd[_0x113a00]&&typeof _0x3be6fd[_0x113a00]===_0x585c09(0x3c4)&&(!chatSettings&&(chatSettings={}),chatSettings[_0x113a00]={...chatSettings[_0x113a00],..._0x3be6fd[_0x113a00]},_0xccd580++,addRecoveryLog(_0x585c09(0x153d)+_0x113a00));});try{await saveChatSettings(),addRecoveryLog(_0x4137f8(0x23f5)+_0xccd580+_0x4137f8(0x1b59)),showToast(_0x4137f8(0x1f20)+_0xccd580+_0x4137f8(0x128b),_0x4137f8(0xb27));}catch(_0x1fc94d){addRecoveryLog(_0x4137f8(0x67e)+_0x1fc94d[_0x4137f8(0xd7a)]),showToast(_0x4137f8(0x8f7),_0x4137f8(0x13bb));}const _0x13a5d1=Object[_0x4137f8(0x16c7)](_0x3be6fd)[_0x4137f8(0xf6d)](_0x50e87c=>{const _0x1b22f1=_0x4137f8,_0x32a26e=_0x3be6fd[_0x50e87c],_0x55948b=[];if(_0x32a26e[_0x1b22f1(0xa7e)])_0x55948b[_0x1b22f1(0x6ee)](_0x1b22f1(0xcb1)+_0x32a26e['bubbleStyle']);if(_0x32a26e[_0x1b22f1(0x23e0)])_0x55948b[_0x1b22f1(0x6ee)](_0x1b22f1(0xd99));if(_0x32a26e[_0x1b22f1(0x13af)])_0x55948b['push'](_0x1b22f1(0x1632));if(_0x32a26e[_0x1b22f1(0x1584)])_0x55948b[_0x1b22f1(0x6ee)](_0x1b22f1(0x1e40));if(_0x32a26e[_0x1b22f1(0x1ae6)])_0x55948b['push'](_0x1b22f1(0x167e)+_0x32a26e['fontSize']);return _0x1b22f1(0x1570)+_0x50e87c+_0x1b22f1(0x1319)+_0x55948b[_0x1b22f1(0x140c)](_0x1b22f1(0x1319));})[_0x4137f8(0x140c)]('\x0a\x0a');document[_0x4137f8(0x566)](_0x4137f8(0x1e8))[_0x4137f8(0x21dc)]='🆘\x20紧急备份恢复完成！\x0a\x0a从\x20'+_0x2ad20e+_0x4137f8(0x2205)+_0xccd580+_0x4137f8(0x1522)+_0x13a5d1+_0x4137f8(0x14dc),addRecoveryLog('🎉\x20紧急备份恢复完成！');}catch(_0x1fec61){addRecoveryLog(_0x4137f8(0x1b9f)+_0x1fec61[_0x4137f8(0xd7a)]),showToast(_0x4137f8(0x19e3),'error'),console[_0x4137f8(0x24ab)]('恢复紧急备份失败:',_0x1fec61);}}async function searchChatHistory(){const _0x428d17=_0x2cf6d4;addRecoveryLog(_0x428d17(0xcb8));try{const _0x238af5=await db[_0x428d17(0x464)][_0x428d17(0x18c6)](),_0x26c1ce=new Map();_0x238af5[_0x428d17(0x900)](_0x45ca77=>{const _0x3006e6=_0x428d17;if(_0x45ca77[_0x3006e6(0x10df)]&&_0x45ca77[_0x3006e6(0x10df)]!==_0x3006e6(0x23b2)){!_0x26c1ce['has'](_0x45ca77[_0x3006e6(0x10df)])&&_0x26c1ce[_0x3006e6(0x21c0)](_0x45ca77[_0x3006e6(0x10df)],{'id':_0x45ca77['characterId'],'messageCount':0x0,'lastMessage':null,'firstMessage':null});const _0x25ea10=_0x26c1ce[_0x3006e6(0x46a)](_0x45ca77['characterId']);_0x25ea10[_0x3006e6(0x2049)]++,(!_0x25ea10['firstMessage']||_0x45ca77[_0x3006e6(0x7aa)]<_0x25ea10[_0x3006e6(0x56b)][_0x3006e6(0x7aa)])&&(_0x25ea10['firstMessage']=_0x45ca77),(!_0x25ea10[_0x3006e6(0x14bb)]||_0x45ca77[_0x3006e6(0x7aa)]>_0x25ea10['lastMessage'][_0x3006e6(0x7aa)])&&(_0x25ea10[_0x3006e6(0x14bb)]=_0x45ca77);}});let _0x1cfe34=_0x428d17(0x16b5);_0x26c1ce[_0x428d17(0x41a)]===0x0?_0x1cfe34+=_0x428d17(0x1e0a):(_0x1cfe34+='发现\x20'+_0x26c1ce[_0x428d17(0x41a)]+_0x428d17(0x11a4),_0x26c1ce[_0x428d17(0x900)]((_0xe8b43a,_0x5541c0)=>{const _0x408627=_0x428d17;_0x1cfe34+=_0x408627(0x2038)+_0x5541c0+'\x0a',_0x1cfe34+=_0x408627(0x18ca)+_0xe8b43a[_0x408627(0x2049)]+_0x408627(0x24ec),_0x1cfe34+=_0x408627(0x786)+new Date(_0xe8b43a[_0x408627(0x56b)]['timestamp'])[_0x408627(0x133a)]()+'\x0a',_0x1cfe34+=_0x408627(0x18b8)+new Date(_0xe8b43a[_0x408627(0x14bb)][_0x408627(0x7aa)])[_0x408627(0x133a)]()+'\x0a',_0x1cfe34+=_0x408627(0x1294)+_0xe8b43a['lastMessage'][_0x408627(0x1423)]?.['substring'](0x0,0x32)+_0x408627(0xd08);}),_0x1cfe34+=_0x428d17(0xaca)),document[_0x428d17(0x566)](_0x428d17(0x4f7))[_0x428d17(0x655)]['display']=_0x428d17(0x2d4),document[_0x428d17(0x566)]('deep-search-text')[_0x428d17(0x21dc)]=_0x1cfe34,addRecoveryLog(_0x428d17(0xf9));}catch(_0x323fe3){addRecoveryLog(_0x428d17(0x1cd7)+_0x323fe3[_0x428d17(0xd7a)]);}}async function rebuildCharactersFromChat(){const _0x35229f=_0x2cf6d4;addRecoveryLog(_0x35229f(0x198));try{const _0x368c17=await db['chatMessages']['toArray'](),_0x165ceb=new Map();_0x368c17[_0x35229f(0x900)](_0x4d4ab6=>{const _0xa4272e=_0x35229f;if(_0x4d4ab6[_0xa4272e(0x10df)]&&_0x4d4ab6[_0xa4272e(0x10df)]!==_0xa4272e(0x23b2)){!_0x165ceb[_0xa4272e(0x1af1)](_0x4d4ab6[_0xa4272e(0x10df)])&&_0x165ceb[_0xa4272e(0x21c0)](_0x4d4ab6[_0xa4272e(0x10df)],{'id':_0x4d4ab6[_0xa4272e(0x10df)],'messages':[],'firstMessage':null,'lastMessage':null});const _0x122aa5=_0x165ceb[_0xa4272e(0x46a)](_0x4d4ab6[_0xa4272e(0x10df)]);_0x122aa5['messages'][_0xa4272e(0x6ee)](_0x4d4ab6),(!_0x122aa5['firstMessage']||_0x4d4ab6[_0xa4272e(0x7aa)]<_0x122aa5['firstMessage'][_0xa4272e(0x7aa)])&&(_0x122aa5[_0xa4272e(0x56b)]=_0x4d4ab6),(!_0x122aa5[_0xa4272e(0x14bb)]||_0x4d4ab6[_0xa4272e(0x7aa)]>_0x122aa5[_0xa4272e(0x14bb)]['timestamp'])&&(_0x122aa5['lastMessage']=_0x4d4ab6);}}),addRecoveryLog(_0x35229f(0x532)+_0x165ceb[_0x35229f(0x41a)]+_0x35229f(0xf05));const _0x2e640f=[];let _0x54e539=0x0;for(const [_0x5d82e3,_0xe45a18]of _0x165ceb){if(_0x5d82e3==='张三'||_0x5d82e3==='李四')continue;let _0x24ed14=_0x35229f(0x226b)+_0x5d82e3[_0x35229f(0x136)](-0x4);const _0x19f13e=_0xe45a18['messages'][_0x35229f(0x136)](0x0,0x14),_0x55f260=_0x19f13e['filter'](_0x457252=>_0x457252[_0x35229f(0xf75)]===_0x35229f(0xfda));for(const _0x5d738d of _0x55f260){const _0x3def3c=_0x5d738d[_0x35229f(0x1423)]||'',_0x407332=[/(?:你好|嗨|hi|hello)[，,\s]*([^\s，,。！？]{1,8})/i,/([^\s，,。！？]{1,8})[，,\s]*(?:你好|在吗|在不在)/i,/^([^\s，,。！？]{1,8})[，,\s]/,/叫你([^\s，,。！？]{1,8})/i];for(const _0x3b112c of _0x407332){const _0x438210=_0x3def3c[_0x35229f(0x1316)](_0x3b112c);if(_0x438210&&_0x438210[0x1]&&_0x438210[0x1][_0x35229f(0xcbf)]<=0x8&&_0x438210[0x1][_0x35229f(0xcbf)]>=0x2){_0x24ed14=_0x438210[0x1];break;}}if(_0x24ed14!==_0x35229f(0x226b)+_0x5d82e3['slice'](-0x4))break;}if(_0x24ed14===_0x35229f(0x226b)+_0x5d82e3[_0x35229f(0x136)](-0x4)){const _0x26dd9d=_0x19f13e[_0x35229f(0x803)](_0x4dabb5=>_0x4dabb5[_0x35229f(0xf75)]===_0x35229f(0xfbe));for(const _0x5e889a of _0x26dd9d[_0x35229f(0x136)](0x0,0x5)){const _0x550c24=_0x5e889a[_0x35229f(0x1423)]||'',_0x334d23=[/我是([^\s，,。！？]{1,8})/i,/我叫([^\s，,。！？]{1,8})/i,/叫我([^\s，,。！？]{1,8})/i,/^([^\s，,。！？]{1,8})(?:在这里|来了|回来了)/i];for(const _0x3fdd01 of _0x334d23){const _0x37340=_0x550c24[_0x35229f(0x1316)](_0x3fdd01);if(_0x37340&&_0x37340[0x1]&&_0x37340[0x1][_0x35229f(0xcbf)]<=0x8&&_0x37340[0x1]['length']>=0x2){_0x24ed14=_0x37340[0x1];break;}}if(_0x24ed14!==_0x35229f(0x226b)+_0x5d82e3[_0x35229f(0x136)](-0x4))break;}}const _0x24858e={'id':_0x5d82e3,'name':_0x24ed14,'description':_0x35229f(0x41c)+_0xe45a18[_0x35229f(0x1767)][_0x35229f(0xcbf)]+_0x35229f(0xe98),'personality':_0x35229f(0x8cb),'scenario':_0x35229f(0x1157),'firstMessage':_0xe45a18['firstMessage']?.[_0x35229f(0x1423)]||'你好！','avatar':'','createdAt':_0xe45a18['firstMessage']?.[_0x35229f(0x7aa)]||Date[_0x35229f(0x18e0)](),'updatedAt':_0xe45a18['lastMessage']?.[_0x35229f(0x7aa)]||Date[_0x35229f(0x18e0)](),'tags':[_0x35229f(0x1791)],'isPublic':![],'messageCount':_0xe45a18[_0x35229f(0x1767)][_0x35229f(0xcbf)]};_0x2e640f[_0x35229f(0x6ee)](_0x24858e),_0x54e539++,addRecoveryLog('重建角色:\x20'+_0x24ed14+'\x20(ID:\x20'+_0x5d82e3[_0x35229f(0x136)](-0x6)+_0x35229f(0x21c3));}if(_0x2e640f[_0x35229f(0xcbf)]===0x0)throw new Error(_0x35229f(0x17c1));await safeDataSave(_0x35229f(0x164d),_0x2e640f),characters=_0x2e640f,contacts=_0x2e640f['map'](_0x13b9ee=>_0x13b9ee['id']),await saveContacts(),await loadCharacters(),await loadContacts(),await loadChatMessages(),renderCharacterList(),renderContactList(),renderMessageList();if(currentCharacterId){const _0x51fcd7=characters[_0x35229f(0x1aeb)](_0x4a1643=>_0x4a1643['id']===currentCharacterId);_0x51fcd7&&renderChatHeader();}addRecoveryLog('✅\x20成功重建\x20'+_0x54e539+_0x35229f(0x181)),addRecoveryLog(_0x35229f(0x240b)+_0x2e640f['map'](_0x27001a=>_0x27001a[_0x35229f(0x222f)])['join'](',\x20')),alert('角色重建完成！成功恢复\x20'+_0x54e539+_0x35229f(0x901)+_0x2e640f[_0x35229f(0xf6d)](_0x579cb1=>_0x579cb1[_0x35229f(0x222f)])[_0x35229f(0x140c)](',\x20'));}catch(_0x438fed){addRecoveryLog(_0x35229f(0x1da2)+_0x438fed[_0x35229f(0xd7a)]),alert(_0x35229f(0x1357)+_0x438fed['message']);}}async function showManualRebuild(){const _0x445cf9=_0x2cf6d4;try{const _0x232afa=await db['chatMessages'][_0x445cf9(0x18c6)](),_0x13455c=new Map();_0x232afa[_0x445cf9(0x900)](_0x21502f=>{const _0x2e4616=_0x445cf9;if(_0x21502f[_0x2e4616(0x10df)]&&_0x21502f[_0x2e4616(0x10df)]!==_0x2e4616(0x23b2)&&_0x21502f[_0x2e4616(0x10df)]!=='张三'&&_0x21502f[_0x2e4616(0x10df)]!=='李四'){!_0x13455c[_0x2e4616(0x1af1)](_0x21502f[_0x2e4616(0x10df)])&&_0x13455c['set'](_0x21502f['characterId'],{'id':_0x21502f['characterId'],'messageCount':0x0,'lastMessage':null});const _0x271cbd=_0x13455c['get'](_0x21502f[_0x2e4616(0x10df)]);_0x271cbd[_0x2e4616(0x2049)]++,(!_0x271cbd[_0x2e4616(0x14bb)]||_0x21502f['timestamp']>_0x271cbd[_0x2e4616(0x14bb)][_0x2e4616(0x7aa)])&&(_0x271cbd['lastMessage']=_0x21502f);}});if(_0x13455c['size']===0x0){alert(_0x445cf9(0x92f));return;}let _0x1c68ab=_0x445cf9(0x52c);_0x1c68ab+=_0x445cf9(0x1a9b),_0x13455c[_0x445cf9(0x900)]((_0x14f02d,_0x4233dc)=>{const _0x1e6b48=_0x445cf9,_0x4064df=_0x4233dc[_0x1e6b48(0x136)](-0x6),_0x4c53e4=_0x14f02d[_0x1e6b48(0x14bb)]?.[_0x1e6b48(0x1423)]?.[_0x1e6b48(0x4b2)](0x0,0x1e)||'';_0x1c68ab+=_0x1e6b48(0x1610)+_0x4064df+_0x1e6b48(0x2127)+_0x14f02d[_0x1e6b48(0x2049)]+_0x1e6b48(0x212e)+_0x4c53e4+_0x1e6b48(0x1895)+_0x4233dc+_0x1e6b48(0x1796)+_0x4233dc+_0x1e6b48(0x84f);}),_0x1c68ab+=_0x445cf9(0xa54),_0x1c68ab+=_0x445cf9(0x2198),document[_0x445cf9(0x566)](_0x445cf9(0x4f7))[_0x445cf9(0x655)][_0x445cf9(0x2526)]=_0x445cf9(0x2d4),document[_0x445cf9(0x566)](_0x445cf9(0x1e8))[_0x445cf9(0xc02)]=_0x1c68ab,window[_0x445cf9(0xd5a)]=_0x13455c;}catch(_0x245176){alert(_0x445cf9(0x2177)+_0x245176['message']);}}async function debugCurrentState(){const _0x5a1ddd=_0x2cf6d4;addRecoveryLog(_0x5a1ddd(0x11b1));try{addRecoveryLog('内存中角色数量:\x20'+characters[_0x5a1ddd(0xcbf)]),addRecoveryLog('内存中联系人数量:\x20'+contacts[_0x5a1ddd(0xcbf)]);characters[_0x5a1ddd(0xcbf)]>0x0&&(addRecoveryLog(_0x5a1ddd(0x5ae)),characters[_0x5a1ddd(0x900)](_0x1d291b=>{const _0x4d2231=_0x5a1ddd;addRecoveryLog(_0x4d2231(0x15b5)+_0x1d291b[_0x4d2231(0x222f)]+'\x20(ID:\x20'+_0x1d291b['id'][_0x4d2231(0x136)](-0x6)+'...)');}));const _0x46c76d=await db[_0x5a1ddd(0x164d)][_0x5a1ddd(0x18c6)](),_0xf86bf=await db['contacts'][_0x5a1ddd(0x18c6)](),_0x105774=await db[_0x5a1ddd(0x464)]['toArray']();addRecoveryLog('数据库中角色数量:\x20'+_0x46c76d['length']),addRecoveryLog(_0x5a1ddd(0x3ed)+_0xf86bf[_0x5a1ddd(0xcbf)]),addRecoveryLog(_0x5a1ddd(0xb77)+_0x105774[_0x5a1ddd(0xcbf)]);_0x46c76d[_0x5a1ddd(0xcbf)]>0x0&&(addRecoveryLog('数据库中的角色:'),_0x46c76d['forEach'](_0x24693b=>{const _0x264aa1=_0x5a1ddd;addRecoveryLog(_0x264aa1(0x15b5)+_0x24693b['name']+_0x264aa1(0x192)+_0x24693b['id'][_0x264aa1(0x136)](-0x6)+_0x264aa1(0x21c3));}));const _0x5931b3=document[_0x5a1ddd(0x566)]('character-list'),_0x41677e=document[_0x5a1ddd(0x566)](_0x5a1ddd(0x1853));addRecoveryLog(_0x5a1ddd(0x44c)+!!_0x5931b3),addRecoveryLog('联系人列表元素存在:\x20'+!!_0x41677e),_0x5931b3&&addRecoveryLog('角色列表子元素数量:\x20'+_0x5931b3[_0x5a1ddd(0xebd)]['length']),_0x41677e&&addRecoveryLog(_0x5a1ddd(0x2d9)+_0x41677e[_0x5a1ddd(0xebd)][_0x5a1ddd(0xcbf)]),addRecoveryLog('当前页面:\x20'+currentPage),addRecoveryLog(_0x5a1ddd(0x1bd)+(currentCharacterId||'无')),addRecoveryLog(_0x5a1ddd(0xfc4));}catch(_0x3252e4){addRecoveryLog(_0x5a1ddd(0x1d73)+_0x3252e4[_0x5a1ddd(0xd7a)]);}}async function forceRefreshAll(){const _0x5e22a2=_0x2cf6d4;addRecoveryLog(_0x5e22a2(0x1312));try{await loadCharacters(),await loadContacts(),await loadChatMessages(),addRecoveryLog(_0x5e22a2(0xe8d)+characters['length']),addRecoveryLog(_0x5e22a2(0x242)+contacts[_0x5e22a2(0xcbf)]),renderCharacterList(),renderContactList(),renderMessageList();if(currentPage===_0x5e22a2(0x23b3)&&currentCharacterId){const _0x16d89a=characters[_0x5e22a2(0x1aeb)](_0x25ded5=>_0x25ded5['id']===currentCharacterId);_0x16d89a?(renderChatHeader(),renderChatMessages(currentCharacterId)):hideApp(_0x5e22a2(0x1154));}currentPage===_0x5e22a2(0x164d)&&renderCharacterList(),addRecoveryLog(_0x5e22a2(0x12a2)),alert(_0x5e22a2(0x8aa));}catch(_0x308108){addRecoveryLog(_0x5e22a2(0xe86)+_0x308108[_0x5e22a2(0xd7a)]),alert(_0x5e22a2(0xe86)+_0x308108[_0x5e22a2(0xd7a)]);}}async function executeManualRebuild(){const _0x66bd88=_0x2cf6d4;try{const _0x37f780=[];for(const [_0x4fc8a6,_0x5b0d45]of window['manualRebuildInfo']){const _0x218785=document[_0x66bd88(0x566)](_0x66bd88(0x913)+_0x4fc8a6),_0x487367=document[_0x66bd88(0x566)](_0x66bd88(0x699)+_0x4fc8a6);if(_0x218785&&_0x218785[_0x66bd88(0x306)]){const _0x23968e=_0x487367[_0x66bd88(0xc34)][_0x66bd88(0x1424)]()||_0x66bd88(0x226b)+_0x4fc8a6[_0x66bd88(0x136)](-0x4),_0x3c9efb={'id':_0x4fc8a6,'name':_0x23968e,'description':_0x66bd88(0x1f35)+_0x5b0d45['messageCount']+'\x20条对话记录','personality':_0x66bd88(0x2452),'scenario':_0x66bd88(0x1157),'firstMessage':_0x5b0d45[_0x66bd88(0x14bb)]?.[_0x66bd88(0x1423)]||'你好！','avatar':'','createdAt':Date[_0x66bd88(0x18e0)]()-0x5265c00,'updatedAt':Date[_0x66bd88(0x18e0)](),'tags':[_0x66bd88(0xcab)],'isPublic':![],'messageCount':_0x5b0d45[_0x66bd88(0x2049)]};_0x37f780[_0x66bd88(0x6ee)](_0x3c9efb);}}if(_0x37f780['length']===0x0){alert(_0x66bd88(0xfb3));return;}await safeDataSave(_0x66bd88(0x164d),_0x37f780),characters=_0x37f780,contacts=_0x37f780['map'](_0x499e74=>_0x499e74['id']),await saveContacts(),renderCharacterList(),renderContactList(),addRecoveryLog(_0x66bd88(0x1906)+_0x37f780[_0x66bd88(0xcbf)]+_0x66bd88(0x1e2)),alert(_0x66bd88(0x2373)+_0x37f780[_0x66bd88(0xcbf)]+'\x20个角色。'),document[_0x66bd88(0x566)](_0x66bd88(0x4f7))['style'][_0x66bd88(0x2526)]=_0x66bd88(0xfe9);}catch(_0x13b419){alert(_0x66bd88(0x47b)+_0x13b419[_0x66bd88(0xd7a)]);}}async function recoverFromFile(){const _0x2be3b2=_0x2cf6d4,_0x7cf16b=document[_0x2be3b2(0x566)]('recovery-file-input'),_0x4e772d=_0x7cf16b[_0x2be3b2(0x173e)][0x0];if(!_0x4e772d){alert(_0x2be3b2(0x11bc));return;}try{addRecoveryLog(_0x2be3b2(0x1b16)+_0x4e772d[_0x2be3b2(0x222f)]+'\x20('+(_0x4e772d[_0x2be3b2(0x41a)]/0x400/0x400)['toFixed'](0x2)+'\x20MB)');const _0x487567=await _0x4e772d[_0x2be3b2(0x1e58)](),_0x14a644=JSON[_0x2be3b2(0x168e)](_0x487567);if(!_0x14a644[_0x2be3b2(0x164d)]||!Array['isArray'](_0x14a644[_0x2be3b2(0x164d)]))throw new Error(_0x2be3b2(0x8e8));addRecoveryLog(_0x2be3b2(0x17f0)+_0x14a644[_0x2be3b2(0x164d)][_0x2be3b2(0xcbf)]+_0x2be3b2(0x1e2));const _0x2a2ff2=_0x14a644[_0x2be3b2(0x164d)][_0x2be3b2(0x803)](_0x5c38da=>_0x5c38da['name']!=='张三'&&_0x5c38da[_0x2be3b2(0x222f)]!=='李四');addRecoveryLog('过滤后有效角色:\x20'+_0x2a2ff2[_0x2be3b2(0xcbf)]+'\x20个');if(_0x2a2ff2[_0x2be3b2(0xcbf)]===0x0)throw new Error(_0x2be3b2(0x946));await safeDataSave(_0x2be3b2(0x164d),_0x2a2ff2),characters=_0x2a2ff2;const _0x5b0b6c=_0x2a2ff2[_0x2be3b2(0xf6d)](_0x3c8138=>_0x3c8138['id']);contacts=_0x5b0b6c,await saveContacts(),addRecoveryLog(_0x2be3b2(0x2290));if(_0x14a644[_0x2be3b2(0x464)]){await db['chatMessages']['clear']();let _0x58367e=0x0;for(const [_0x319db5,_0x55bce1]of Object['entries'](_0x14a644['chatMessages'])){if(_0x55bce1&&_0x55bce1['length']>0x0)for(const _0x1042af of _0x55bce1){await db['chatMessages'][_0x2be3b2(0xe1)]({'characterId':_0x319db5,..._0x1042af}),_0x58367e++;}}chatMessages=_0x14a644[_0x2be3b2(0x464)],addRecoveryLog('聊天记录恢复完成:\x20'+_0x58367e+_0x2be3b2(0x16d2));}renderCharacterList(),renderContactList(),renderMessageList(),addRecoveryLog('✅\x20文件恢复成功！'),alert('数据恢复成功！您的角色和聊天记录已恢复。');}catch(_0x400107){addRecoveryLog(_0x2be3b2(0x16bc)+_0x400107[_0x2be3b2(0xd7a)]),alert('文件恢复失败:\x20'+_0x400107['message']);}}async function cleanupBadData(){const _0x3bb5ca=_0x2cf6d4;try{addRecoveryLog(_0x3bb5ca(0x24f1));const _0x15c100=await db[_0x3bb5ca(0x164d)][_0x3bb5ca(0x4a6)](_0x3bb5ca(0x222f))[_0x3bb5ca(0xe07)](['张三','李四'])[_0x3bb5ca(0xc2b)]();addRecoveryLog(_0x3bb5ca(0xfba)+_0x15c100+'\x20个异常角色'),characters=characters[_0x3bb5ca(0x803)](_0x53e62a=>_0x53e62a[_0x3bb5ca(0x222f)]!=='张三'&&_0x53e62a[_0x3bb5ca(0x222f)]!=='李四'),contacts=contacts[_0x3bb5ca(0x803)](_0x43f52d=>{const _0x3933b8=_0x3bb5ca,_0x5b4abc=characters['find'](_0x3117e3=>_0x3117e3['id']===_0x43f52d);return _0x5b4abc&&_0x5b4abc[_0x3933b8(0x222f)]!=='张三'&&_0x5b4abc['name']!=='李四';}),await saveContacts(),renderCharacterList(),renderContactList(),renderMessageList(),addRecoveryLog('✅\x20异常数据清理完成'),alert(_0x3bb5ca(0x84a));}catch(_0x40369b){addRecoveryLog('❌\x20清理失败:\x20'+_0x40369b['message']),alert(_0x3bb5ca(0x1c06)+_0x40369b['message']);}}async function forceReload(){const _0x2fe68f=_0x2cf6d4;try{addRecoveryLog(_0x2fe68f(0xe7a)),await loadCharacterGroups(),await loadCharacters(),await loadContacts(),await loadChatMessages(),await loadChatSettings(),await loadPersonas(),await loadGroupChats(),renderCharacterList(),renderContactList(),renderMessageList(),addRecoveryLog(_0x2fe68f(0x4e1)),alert(_0x2fe68f(0xce3));}catch(_0x49576d){addRecoveryLog(_0x2fe68f(0x1bd6)+_0x49576d['message']),alert('重新加载失败:\x20'+_0x49576d[_0x2fe68f(0xd7a)]);}}let isOfflineMode=![],offlinePresets=[],currentOfflinePreset=null,selectedOfflinePresets=[],offlineMessages=[],windowId=null;function initializeWindowId(){const _0x1120d8=_0x2cf6d4;windowId=sessionStorage[_0x1120d8(0x2250)](_0x1120d8(0x30e)),!windowId&&(windowId=_0x1120d8(0x853)+Date[_0x1120d8(0x18e0)]()+'_'+Math[_0x1120d8(0x191c)]()[_0x1120d8(0x9a3)](0x24)['substr'](0x2,0x9),sessionStorage[_0x1120d8(0x2055)](_0x1120d8(0x30e),windowId)),console['log'](_0x1120d8(0x152e),windowId);}function toggleOfflineMode(){const _0x3634e1=_0x2cf6d4;if(!currentChatCharacter){showToast('请先选择一个角色','warning');return;}offlineMessages=[],isOfflineMode=!isOfflineMode;const _0x7d1927=document[_0x3634e1(0x566)](_0x3634e1(0x1634)),_0x3115b8=document[_0x3634e1(0x566)]('offline-mode-icon'),_0x16677c=document['getElementById']('api-chat-screen'),_0x21313b=document[_0x3634e1(0x566)]('offline-mode-title');isOfflineMode?(_0x7d1927[_0x3634e1(0x655)][_0x3634e1(0x2526)]='flex',_0x3115b8[_0x3634e1(0x221)]=_0x3634e1(0x24b),_0x16677c[_0x3634e1(0x226e)][_0x3634e1(0xe1)](_0x3634e1(0xf54)),_0x21313b&&currentChatCharacter&&(_0x21313b['textContent']=currentChatCharacter[_0x3634e1(0x222f)]),pauseProactiveChatTimer(currentChatCharacter['id']),loadOfflineMessages(),loadAndApplyOfflineUISettings(),setTimeout(()=>scrollOfflineMessagesToBottom(),0xc8),showToast(_0x3634e1(0x1852),_0x3634e1(0xb27))):exitOfflineMode();}function exitOfflineMode(){const _0x3654bc=_0x2cf6d4,_0x3a5664=offlineMessages['length']>initialOfflineMessageCount;_0x3a5664?(console[_0x3654bc(0xc0d)](_0x3654bc(0xa21)+offlineMessages['length']+_0x3654bc(0x22c5)+initialOfflineMessageCount+'条'),showOfflineExitModal()):(console['log'](_0x3654bc(0x12c6)),doExitOfflineMode());}function showOfflineExitModal(){const _0x3882e1=_0x2cf6d4,_0x26e78e=document[_0x3882e1(0x1ad8)](_0x3882e1(0x526));_0x26e78e['className']='modal\x20offline-exit-modal',_0x26e78e[_0x3882e1(0x655)][_0x3882e1(0x2526)]=_0x3882e1(0x1f0b),_0x26e78e[_0x3882e1(0x655)][_0x3882e1(0x8bc)]=_0x3882e1(0xad3),_0x26e78e[_0x3882e1(0xc02)]=_0x3882e1(0x6c4),document[_0x3882e1(0x172c)]['appendChild'](_0x26e78e);}async function exitWithSummary(){const _0x4521e6=_0x2cf6d4;try{const _0x895472=document[_0x4521e6(0x15b8)](_0x4521e6(0x204f)),_0x28224c=_0x895472[_0x4521e6(0xc02)];_0x895472[_0x4521e6(0xc02)]='<i\x20class=\x22fas\x20fa-spinner\x20fa-spin\x22></i>\x20AI正在总结中...',_0x895472[_0x4521e6(0x194e)]=!![];const _0x16db24=document[_0x4521e6(0x1ed9)](_0x4521e6(0x2178));_0x16db24[_0x4521e6(0x900)](_0x4d9498=>_0x4d9498[_0x4521e6(0x194e)]=!![]),showToast('正在生成剧情总结...',_0x4521e6(0x2422)),await generateOfflineStorylineSummary();const _0xc1bac8=document[_0x4521e6(0x15b8)](_0x4521e6(0x22c8));if(_0xc1bac8)_0xc1bac8[_0x4521e6(0x128)]();doExitOfflineMode(),showToast(_0x4521e6(0x18ae),_0x4521e6(0xb27));}catch(_0x49ed9e){console[_0x4521e6(0x24ab)](_0x4521e6(0x1e65),_0x49ed9e);const _0x1e14c4=document[_0x4521e6(0x15b8)](_0x4521e6(0x204f));_0x1e14c4&&(_0x1e14c4[_0x4521e6(0xc02)]=_0x4521e6(0x1587),_0x1e14c4['disabled']=![]);const _0x22b731=document[_0x4521e6(0x1ed9)](_0x4521e6(0x2178));_0x22b731[_0x4521e6(0x900)](_0x486d10=>_0x486d10[_0x4521e6(0x194e)]=![]);const _0xa01a99=document[_0x4521e6(0x15b8)](_0x4521e6(0x22c8));if(_0xa01a99)_0xa01a99['remove']();doExitOfflineMode(),showToast('生成剧情总结失败，但已退出线下模式','warning');}}async function exitWithoutSummary(){const _0x99ae38=_0x2cf6d4,_0x389527=document[_0x99ae38(0x15b8)](_0x99ae38(0x22c8));_0x389527?(_0x389527[_0x99ae38(0x128)](),console[_0x99ae38(0xc0d)](_0x99ae38(0x1b78))):console[_0x99ae38(0xc0d)]('❌\x20结束且不总结：找不到模态框');if(offlineMessages[_0x99ae38(0xcbf)]>0x0){console[_0x99ae38(0xc0d)](_0x99ae38(0x133c)+offlineMessages[_0x99ae38(0xcbf)]+_0x99ae38(0x2418));const _0x1c2d5b=_0x99ae38(0x21d0)+new Date()[_0x99ae38(0x133a)]()+'\x20('+offlineCurrentMessages[_0x99ae38(0xcbf)]+'条新消息)';offlineCurrentMessages[_0x99ae38(0xcbf)]>0x0&&await saveOfflineHistoryRecord(_0x1c2d5b,offlineCurrentMessages[_0x99ae38(0x136)]());const _0x5011ca=currentChatCharacter['id'];if(chatMessages[_0x5011ca]){const _0x408d54=chatMessages[_0x5011ca]['filter'](_0x2bea10=>_0x2bea10[_0x99ae38(0x14ad)]);console[_0x99ae38(0xc0d)](_0x99ae38(0x69a)+_0x408d54[_0x99ae38(0xcbf)]+'条'),console[_0x99ae38(0xc0d)](_0x99ae38(0x206f)+offlineMessages['length']+'条'),console[_0x99ae38(0xc0d)]('✅\x20线下模式消息已通过高效单条保存机制保存到主聊天记录中');}else console['warn'](_0x99ae38(0x13b1));offlineMessages=[],offlineCurrentMessages=[],offlineHistoryMessages=[],offlineHistoryLoadedCount=0x0,offlineHistoryTotalCount=0x0,clearOfflineMessagesCache(),showToast('已结束线下模式，对话已保存到聊天记录',_0x99ae38(0xb27));}else console[_0x99ae38(0xc0d)]('📝\x20没有线下模式对话需要保存'),showToast('已结束线下模式',_0x99ae38(0xb27));doExitOfflineMode();}function doExitOfflineMode(){const _0x47c57c=_0x2cf6d4;isOfflineMode=![];const _0x233699=document[_0x47c57c(0x566)](_0x47c57c(0x1634)),_0xbdfd7f=document[_0x47c57c(0x566)](_0x47c57c(0x23c4)),_0x36ad0e=document[_0x47c57c(0x566)]('api-chat-screen');_0x233699['style'][_0x47c57c(0x2526)]='none',_0xbdfd7f[_0x47c57c(0x221)]=_0x47c57c(0xb7a),_0x36ad0e[_0x47c57c(0x226e)]['remove']('offline-mode-active');currentChatCharacter&&resumeProactiveChatTimer(currentChatCharacter['id']);const _0x3f6c84=document[_0x47c57c(0x566)](_0x47c57c(0x1697));_0x3f6c84&&(_0x3f6c84[_0x47c57c(0xc02)]='',console[_0x47c57c(0xc0d)](_0x47c57c(0x2414)));}async function generateOfflineStorylineSummary(){const _0x25c348=_0x2cf6d4;if(!currentChatCharacter||offlineCurrentMessages['length']===0x0){console[_0x25c348(0xc0d)]('⚠️\x20没有当前会话消息，跳过剧情总结生成');return;}if(!currentChatCharacter['id']){console[_0x25c348(0x24ab)](_0x25c348(0x1b3));throw new Error(_0x25c348(0x23a5));}const _0x559e58={'id':currentChatCharacter['id'],'name':currentChatCharacter[_0x25c348(0x222f)]};console[_0x25c348(0xc0d)](_0x25c348(0x1d43)+_0x559e58['name']+_0x25c348(0xdb1)+_0x559e58['id']+',\x20当前会话'+offlineCurrentMessages[_0x25c348(0xcbf)]+_0x25c348(0xd14));try{let _0x12d5f3='';offlineCurrentMessages[_0x25c348(0x900)]((_0xfb7f5e,_0x198aa8)=>{const _0x5becac=_0x25c348,_0x2b53c2=_0xfb7f5e[_0x5becac(0xf75)]===_0x5becac(0x23b2)?'用户':_0x559e58[_0x5becac(0x222f)],_0x2d38fb=safeExtractMessageContent(_0xfb7f5e);_0x12d5f3+=_0x2b53c2+'：'+_0x2d38fb+'\x0a';}),console[_0x25c348(0xc0d)](_0x25c348(0x36c),_0x12d5f3[_0x25c348(0x4b2)](0x0,0xc8)+_0x25c348(0x12da));const _0x348ba7=_0x25c348(0x39a)+_0x559e58[_0x25c348(0x222f)]+'\x22指代角色\x0a7.\x20不要使用\x22我\x22、\x22你\x22等第一、第二人称\x0a\x0a角色信息：\x0a'+_0x559e58['name']+_0x25c348(0x981)+_0x12d5f3+'\x0a\x0a请生成一个200-800字的客观剧情总结，要求：\x0a1.\x20按时间顺序记录发生的主要事件\x0a2.\x20客观描述角色的行为和对话要点，使用\x22用户\x22和\x22'+_0x559e58[_0x25c348(0x222f)]+'\x22来指代双方\x0a3.\x20记录重要的情节转折和结果\x0a4.\x20避免过度的主观情感描述和过度修饰\x0a5.\x20使用简洁明了的语言\x0a6.\x20重点记录关键细节和对后续剧情有影响的关键信息\x0a7.\x20严格使用第三人称：用户做了什么，'+_0x559e58[_0x25c348(0x222f)]+_0x25c348(0x2248);console[_0x25c348(0xc0d)](_0x25c348(0x23d3),_0x348ba7);const _0x59ba69=await callOfflineChatAPI(_0x348ba7,currentChatCharacter);console['log'](_0x25c348(0x1ca1),_0x59ba69);if(_0x59ba69&&_0x59ba69['trim']()){const _0x30bc7e={'id':'offline_summary_'+_0x559e58['id']+'_'+Date[_0x25c348(0x18e0)]()+'_'+Math[_0x25c348(0x191c)]()[_0x25c348(0x9a3)](0x24)[_0x25c348(0x18cf)](0x2,0x9),'characterId':_0x559e58['id'],'appType':'offline_mode','action':_0x25c348(0x348),'timestamp':Date['now'](),'context':{'type':'offline_storyline','content':'[剧情模式]\x20'+_0x59ba69[_0x25c348(0x1424)](),'date':new Date()[_0x25c348(0xa4b)]()['split']('T')[0x0],'messageCount':offlineCurrentMessages[_0x25c348(0xcbf)],'importance':0.9},'messageId':_0x25c348(0x1bc1)+Date[_0x25c348(0x18e0)]()};await db[_0x25c348(0x75b)][_0x25c348(0xe1)](_0x30bc7e),console[_0x25c348(0xc0d)](_0x25c348(0xd6b),_0x30bc7e);const _0x358914=await db[_0x25c348(0x75b)][_0x25c348(0x46a)](_0x30bc7e['id']);_0x358914&&_0x358914[_0x25c348(0x10df)]===_0x559e58['id']?console[_0x25c348(0xc0d)](_0x25c348(0x1734)):console[_0x25c348(0x24ab)]('🚨\x20剧情总结保存验证失败，角色ID不匹配');offlineCurrentMessages['length']>0x0&&saveOfflineHistoryRecord(_0x59ba69[_0x25c348(0x1424)](),offlineCurrentMessages[_0x25c348(0x136)]());const _0x24eaed=_0x559e58['id'];if(chatMessages[_0x24eaed]){const _0x2f1e24=chatMessages[_0x24eaed][_0x25c348(0x803)](_0xb733f7=>_0xb733f7[_0x25c348(0x14ad)]);console['log'](_0x25c348(0x69a)+_0x2f1e24[_0x25c348(0xcbf)]+'条'),console[_0x25c348(0xc0d)](_0x25c348(0x206f)+offlineMessages[_0x25c348(0xcbf)]+'条'),console[_0x25c348(0xc0d)]('✅\x20线下模式消息已通过高效单条保存机制保存到主聊天记录中');}else console[_0x25c348(0x17cc)](_0x25c348(0x13b1));offlineMessages=[],offlineCurrentMessages=[],offlineHistoryMessages=[],offlineHistoryLoadedCount=0x0,offlineHistoryTotalCount=0x0,clearOfflineMessagesCache();}else throw new Error(_0x25c348(0xbff));}catch(_0xd767ad){console[_0x25c348(0x24ab)]('生成线下模式剧情总结失败:',_0xd767ad);throw _0xd767ad;}}function showOfflinePresetSettings(){const _0x14553a=_0x2cf6d4;document['getElementById']('offline-preset-modal')['style'][_0x14553a(0x2526)]=_0x14553a(0x1f0b),loadAndDisplayPresets(),clearPresetForm();}function closeOfflinePresetSettings(){const _0x1e6606=_0x2cf6d4;document[_0x1e6606(0x566)](_0x1e6606(0x1622))[_0x1e6606(0x655)]['display']=_0x1e6606(0xfe9),delete window['editingPresetId'];}function clearPresetForm(){const _0x21a8a9=_0x2cf6d4;document[_0x21a8a9(0x566)]('offline-preset-name')[_0x21a8a9(0xc34)]='',document[_0x21a8a9(0x566)]('offline-preset-content')[_0x21a8a9(0xc34)]='';}async function loadAndDisplayPresets(){const _0x4bfa49=_0x2cf6d4;try{const _0x5cdbb3=await db[_0x4bfa49(0xa0c)][_0x4bfa49(0x18c6)](),_0xa66312=_0x5cdbb3[_0x4bfa49(0x803)](_0x174f8f=>_0x174f8f[_0x4bfa49(0x58b)]===!![]),_0x2ebd22=document[_0x4bfa49(0x566)](_0x4bfa49(0xdb6));_0x2ebd22['innerHTML']='';const _0x185cfd=document['createElement'](_0x4bfa49(0x526));_0x185cfd[_0x4bfa49(0x221)]='preset-item';selectedOfflinePresets[_0x4bfa49(0xcbf)]===0x0&&_0x185cfd[_0x4bfa49(0x226e)]['add']('active');const _0x204ad7=document[_0x4bfa49(0x1ad8)](_0x4bfa49(0x526));_0x204ad7[_0x4bfa49(0x221)]=_0x4bfa49(0x14f6);const _0xef9ba5=document[_0x4bfa49(0x1ad8)](_0x4bfa49(0x526));_0xef9ba5[_0x4bfa49(0x221)]='preset-name',_0xef9ba5[_0x4bfa49(0x21dc)]='不使用预设';const _0x167523=document[_0x4bfa49(0x1ad8)]('div');_0x167523[_0x4bfa49(0x221)]='preset-preview',_0x167523['textContent']=_0x4bfa49(0x290),_0x204ad7['appendChild'](_0xef9ba5),_0x204ad7[_0x4bfa49(0x1925)](_0x167523);const _0x58da97=document[_0x4bfa49(0x1ad8)](_0x4bfa49(0x526));_0x58da97[_0x4bfa49(0x221)]=_0x4bfa49(0xae);const _0x5b7880=document[_0x4bfa49(0x1ad8)]('button');_0x5b7880['className']=_0x4bfa49(0x1f9a),_0x5b7880['innerHTML']=selectedOfflinePresets[_0x4bfa49(0xcbf)]===0x0?'<div\x20class=\x22checkbox-circle\x20checked\x22><i\x20class=\x22fas\x20fa-check\x22></i></div>':_0x4bfa49(0x9f4),_0x5b7880[_0x4bfa49(0x1c18)]='不使用任何预设',_0x5b7880['onclick']=()=>clearAllPresets(),_0x58da97[_0x4bfa49(0x1925)](_0x5b7880),_0x185cfd['appendChild'](_0x204ad7),_0x185cfd[_0x4bfa49(0x1925)](_0x58da97),_0x2ebd22['appendChild'](_0x185cfd);if(_0xa66312[_0x4bfa49(0xcbf)]===0x0)return;_0xa66312[_0x4bfa49(0x1f0d)]((_0x332161,_0x14ea92)=>_0x332161[_0x4bfa49(0x7aa)]-_0x14ea92[_0x4bfa49(0x7aa)]),_0xa66312[_0x4bfa49(0x900)](_0x1acb9e=>{const _0x5a21ac=_0x4bfa49,_0x2e5b81=document[_0x5a21ac(0x1ad8)]('div');_0x2e5b81[_0x5a21ac(0x221)]=_0x5a21ac(0x173d);const _0x39f7b3=selectedOfflinePresets[_0x5a21ac(0x184b)](_0x470b66=>_0x470b66['id']===_0x1acb9e['id']);_0x39f7b3&&_0x2e5b81['classList']['add'](_0x5a21ac(0x105d));const _0x189574=document[_0x5a21ac(0x1ad8)](_0x5a21ac(0x526));_0x189574[_0x5a21ac(0x221)]=_0x5a21ac(0x14f6);const _0x566526=document[_0x5a21ac(0x1ad8)](_0x5a21ac(0x526));_0x566526['className']=_0x5a21ac(0x1689),_0x566526[_0x5a21ac(0x21dc)]=_0x1acb9e['name'];const _0x4c8066=document[_0x5a21ac(0x1ad8)](_0x5a21ac(0x526));_0x4c8066[_0x5a21ac(0x221)]=_0x5a21ac(0x196),_0x4c8066['textContent']=_0x1acb9e[_0x5a21ac(0x1423)][_0x5a21ac(0x4b2)](0x0,0x32)+(_0x1acb9e[_0x5a21ac(0x1423)]['length']>0x32?_0x5a21ac(0x12da):''),_0x189574[_0x5a21ac(0x1925)](_0x566526),_0x189574['appendChild'](_0x4c8066);const _0x8a526b=document[_0x5a21ac(0x1ad8)]('div');_0x8a526b['className']=_0x5a21ac(0xae);const _0x176721=document[_0x5a21ac(0x1ad8)]('button');_0x176721[_0x5a21ac(0x221)]='preset-checkbox-btn',_0x176721[_0x5a21ac(0xc02)]=_0x39f7b3?_0x5a21ac(0x102e):'<div\x20class=\x22checkbox-circle\x22></div>',_0x176721[_0x5a21ac(0x1c18)]='选择此预设',_0x176721['onclick']=()=>togglePreset(_0x1acb9e);const _0x390206=document[_0x5a21ac(0x1ad8)](_0x5a21ac(0x217f));_0x390206[_0x5a21ac(0x221)]=_0x5a21ac(0x707),_0x390206[_0x5a21ac(0xc02)]=_0x5a21ac(0xac2),_0x390206[_0x5a21ac(0x1c18)]=_0x5a21ac(0x24fd),_0x390206[_0x5a21ac(0x11cf)]=()=>editPreset(_0x1acb9e);const _0x4218be=document['createElement'](_0x5a21ac(0x217f));_0x4218be[_0x5a21ac(0x221)]=_0x5a21ac(0x1426),_0x4218be['innerHTML']=_0x5a21ac(0x1c8c),_0x4218be[_0x5a21ac(0x1c18)]=_0x5a21ac(0x125e),_0x4218be[_0x5a21ac(0x11cf)]=()=>deletePreset(_0x1acb9e['id']),_0x8a526b['appendChild'](_0x176721),_0x8a526b[_0x5a21ac(0x1925)](_0x390206),_0x8a526b[_0x5a21ac(0x1925)](_0x4218be),_0x2e5b81[_0x5a21ac(0x1925)](_0x189574),_0x2e5b81[_0x5a21ac(0x1925)](_0x8a526b),_0x2ebd22[_0x5a21ac(0x1925)](_0x2e5b81);}),console[_0x4bfa49(0xc0d)](_0x4bfa49(0x60b)+_0xa66312['length']+'\x20个线下模式预设');}catch(_0x49b3c7){console[_0x4bfa49(0x24ab)](_0x4bfa49(0x1b57),_0x49b3c7),showToast('加载预设失败',_0x4bfa49(0x24ab));}}function togglePreset(_0x244b22){const _0x5daf2a=_0x2cf6d4,_0x2eb955=selectedOfflinePresets[_0x5daf2a(0x23ba)](_0x27413c=>_0x27413c['id']===_0x244b22['id']);_0x2eb955>=0x0?(selectedOfflinePresets[_0x5daf2a(0x220f)](_0x2eb955,0x1),showToast(_0x5daf2a(0x1373)+_0x244b22[_0x5daf2a(0x222f)]+'\x22',_0x5daf2a(0x2422))):(selectedOfflinePresets[_0x5daf2a(0x6ee)](_0x244b22),showToast(_0x5daf2a(0xb88)+_0x244b22[_0x5daf2a(0x222f)]+'\x22',_0x5daf2a(0xb27)));if(currentChatCharacter){const _0x29b051=selectedOfflinePresets[_0x5daf2a(0xf6d)](_0x1e869b=>_0x1e869b['id']);localStorage[_0x5daf2a(0x2055)]('offlinePreset_'+currentChatCharacter['id'],JSON[_0x5daf2a(0x7fb)](_0x29b051)),console[_0x5daf2a(0xc0d)](_0x5daf2a(0xb83)+currentChatCharacter[_0x5daf2a(0x222f)]+_0x5daf2a(0x67b),selectedOfflinePresets[_0x5daf2a(0xf6d)](_0x1b1b5a=>_0x1b1b5a[_0x5daf2a(0x222f)]));}currentOfflinePreset=selectedOfflinePresets[_0x5daf2a(0xcbf)]>0x0?selectedOfflinePresets[0x0]:null,loadAndDisplayPresets();}function clearAllPresets(){const _0x33caf4=_0x2cf6d4;selectedOfflinePresets=[],currentOfflinePreset=null,currentChatCharacter&&(localStorage[_0x33caf4(0x2055)](_0x33caf4(0x4d3)+currentChatCharacter['id'],'none'),console[_0x33caf4(0xc0d)]('💾\x20已保存角色\x20'+currentChatCharacter[_0x33caf4(0x222f)]+_0x33caf4(0x5ef))),loadAndDisplayPresets(),showToast('已取消所有预设，将使用默认设置',_0x33caf4(0x2422));}function usePreset(_0x126b3f){const _0x3845db=_0x2cf6d4;selectedOfflinePresets=[_0x126b3f],currentOfflinePreset=_0x126b3f,currentChatCharacter&&(localStorage[_0x3845db(0x2055)](_0x3845db(0x4d3)+currentChatCharacter['id'],JSON['stringify']([_0x126b3f['id']])),console[_0x3845db(0xc0d)](_0x3845db(0xb83)+currentChatCharacter[_0x3845db(0x222f)]+_0x3845db(0x1fee)+_0x126b3f[_0x3845db(0x222f)])),loadAndDisplayPresets(),showToast('已启用预设\x22'+_0x126b3f[_0x3845db(0x222f)]+'\x22',_0x3845db(0xb27));}function clearCurrentPreset(){clearAllPresets();}function editPreset(_0x9fc7d3){const _0x23246b=_0x2cf6d4;document[_0x23246b(0x566)](_0x23246b(0x7d4))[_0x23246b(0xc34)]=_0x9fc7d3[_0x23246b(0x222f)],document[_0x23246b(0x566)]('offline-preset-content')['value']=_0x9fc7d3[_0x23246b(0x1423)],window['editingPresetId']=_0x9fc7d3['id'];}async function deletePreset(_0xcf2297){const _0x2c6d3a=_0x2cf6d4;if(!confirm(_0x2c6d3a(0x22f)))return;try{const _0x12b0a9=await db['offlinePresets'][_0x2c6d3a(0x46a)](_0xcf2297);if(!_0x12b0a9){showToast(_0x2c6d3a(0xd6f),_0x2c6d3a(0x13bb));return;}await db[_0x2c6d3a(0xa0c)]['delete'](_0xcf2297);const _0x53c4aa=selectedOfflinePresets[_0x2c6d3a(0x23ba)](_0x19cb22=>_0x19cb22['id']===_0xcf2297);if(_0x53c4aa>=0x0){selectedOfflinePresets[_0x2c6d3a(0x220f)](_0x53c4aa,0x1),currentOfflinePreset=selectedOfflinePresets['length']>0x0?selectedOfflinePresets[0x0]:null;if(currentChatCharacter){if(selectedOfflinePresets[_0x2c6d3a(0xcbf)]===0x0)localStorage[_0x2c6d3a(0x2055)](_0x2c6d3a(0x4d3)+currentChatCharacter['id'],_0x2c6d3a(0xfe9));else{const _0x5d8503=selectedOfflinePresets[_0x2c6d3a(0xf6d)](_0x357320=>_0x357320['id']);localStorage[_0x2c6d3a(0x2055)](_0x2c6d3a(0x4d3)+currentChatCharacter['id'],JSON[_0x2c6d3a(0x7fb)](_0x5d8503));}}}Object[_0x2c6d3a(0x16c7)](localStorage)[_0x2c6d3a(0x900)](_0x1bb679=>{const _0x25ff82=_0x2c6d3a;_0x1bb679[_0x25ff82(0x1cab)]('offlinePreset_')&&localStorage[_0x25ff82(0x2250)](_0x1bb679)===_0xcf2297&&(localStorage['setItem'](_0x1bb679,_0x25ff82(0xfe9)),console[_0x25ff82(0xc0d)]('🧹\x20清理了角色预设引用:\x20'+_0x1bb679));}),await loadAndDisplayPresets(),showToast(_0x2c6d3a(0x200d)+_0x12b0a9[_0x2c6d3a(0x222f)]+_0x2c6d3a(0x1ae9),_0x2c6d3a(0x2422)),console[_0x2c6d3a(0xc0d)](_0x2c6d3a(0x950)+_0x12b0a9[_0x2c6d3a(0x222f)]+'\x20('+_0xcf2297+')');}catch(_0x2ccbaa){console[_0x2c6d3a(0x24ab)](_0x2c6d3a(0x11c7),_0x2ccbaa),showToast(_0x2c6d3a(0x1140),_0x2c6d3a(0x24ab));}}async function saveOfflinePreset(){const _0x1db0c6=_0x2cf6d4,_0x3dee00=document[_0x1db0c6(0x566)]('offline-preset-name')[_0x1db0c6(0xc34)][_0x1db0c6(0x1424)](),_0x4383ce=document[_0x1db0c6(0x566)]('offline-preset-content')[_0x1db0c6(0xc34)]['trim']();if(!_0x3dee00){showToast('请输入预设名称',_0x1db0c6(0x13bb));return;}if(!_0x4383ce){showToast(_0x1db0c6(0x1747),'warning');return;}try{if(window[_0x1db0c6(0x389)]){const _0x56faa5=await db[_0x1db0c6(0xa0c)][_0x1db0c6(0x46a)](window[_0x1db0c6(0x389)]);if(_0x56faa5){_0x56faa5[_0x1db0c6(0x222f)]=_0x3dee00,_0x56faa5['content']=_0x4383ce,_0x56faa5[_0x1db0c6(0x7aa)]=Date[_0x1db0c6(0x18e0)](),await db[_0x1db0c6(0xa0c)][_0x1db0c6(0x53a)](_0x56faa5);currentOfflinePreset&&currentOfflinePreset['id']===window[_0x1db0c6(0x389)]&&(currentOfflinePreset=_0x56faa5);delete window[_0x1db0c6(0x389)],await loadAndDisplayPresets(),clearPresetForm(),showToast(_0x1db0c6(0x200d)+_0x3dee00+_0x1db0c6(0x819),_0x1db0c6(0xb27)),console[_0x1db0c6(0xc0d)](_0x1db0c6(0x936)+_0x3dee00+'\x20('+_0x56faa5['id']+')');return;}delete window[_0x1db0c6(0x389)];}const _0x22b292={'id':_0x1db0c6(0x197a)+Date[_0x1db0c6(0x18e0)]()+'_'+Math['random']()[_0x1db0c6(0x9a3)](0x24)['substr'](0x2,0x9),'name':_0x3dee00,'content':_0x4383ce,'timestamp':Date[_0x1db0c6(0x18e0)](),'isGlobal':!![]};await db['offlinePresets'][_0x1db0c6(0xe1)](_0x22b292),currentOfflinePreset=_0x22b292,await loadAndDisplayPresets(),clearPresetForm(),showToast(_0x1db0c6(0x200d)+_0x3dee00+_0x1db0c6(0xce2),_0x1db0c6(0xb27)),console[_0x1db0c6(0xc0d)](_0x1db0c6(0x1243)+_0x3dee00+'\x20('+_0x22b292['id']+')');}catch(_0x34fb75){console['error'](_0x1db0c6(0x23ff),_0x34fb75),showToast('保存预设失败',_0x1db0c6(0x24ab));}}let offlineHistoryMessages=[],offlineCurrentMessages=[],currentSessionStartTime=null,initialOfflineMessageCount=0x0,offlineHistoryPageSize=0x14,offlineHistoryLoadedCount=0x0,offlineHistoryTotalCount=0x0;function loadOfflineMessages(){const _0x4ccf14=_0x2cf6d4;if(!currentChatCharacter)return;const _0x4e50cf=currentChatCharacter['id'];offlineHistoryMessages=[],offlineCurrentMessages=[],currentSessionStartTime=Date[_0x4ccf14(0x18e0)](),offlineHistoryLoadedCount=0x0,offlineHistoryTotalCount=0x0;const _0x528438=loadOfflineMessagesFromCache();loadOfflineHistoryPage(),loadLatestOfflinePreset(),renderOfflineMessages();}async function fixMissingOfflineMessageFlags(){const _0x4d615d=_0x2cf6d4;console[_0x4d615d(0x17cc)](_0x4d615d(0x1b36));return;}function loadOfflineHistoryPage(){const _0x1d6450=_0x2cf6d4;if(!currentChatCharacter)return;const _0x3177b6=currentChatCharacter['id'];if(chatMessages[_0x3177b6]){const _0x4acae7=chatMessages[_0x3177b6],_0x57821d=_0x4acae7['filter'](_0x59bfc8=>_0x59bfc8['isOfflineMode']);console[_0x1d6450(0xc0d)]('📊\x20[线下消息]\x20角色'+_0x3177b6+_0x1d6450(0xa1d)+_0x57821d[_0x1d6450(0xcbf)]+'条');const _0x667b03=chatMessages[_0x3177b6][_0x1d6450(0x803)](_0x4ff287=>_0x4ff287['isOfflineMode'])[_0x1d6450(0xf6d)](_0x48172b=>({'id':_0x48172b['id']['toString'](),'sender':_0x48172b[_0x1d6450(0xf75)]==='sent'?_0x1d6450(0x23b2):'ai','content':_0x48172b['content'],'timestamp':new Date(_0x48172b['timestamp'])[_0x1d6450(0xa4b)](),'isHistorical':!![]}));offlineHistoryTotalCount=_0x667b03[_0x1d6450(0xcbf)];if(offlineHistoryLoadedCount===0x0){const _0x3d3d4d=Math[_0x1d6450(0x910)](0x0,_0x667b03[_0x1d6450(0xcbf)]-offlineHistoryPageSize),_0x2d4c28=_0x667b03[_0x1d6450(0x136)](_0x3d3d4d);offlineHistoryMessages=_0x2d4c28,offlineHistoryLoadedCount=_0x2d4c28['length'];}else{const _0x208558=offlineHistoryTotalCount-offlineHistoryLoadedCount,_0x84ab21=Math[_0x1d6450(0x21f7)](offlineHistoryPageSize,_0x208558),_0x532e69=offlineHistoryTotalCount-offlineHistoryLoadedCount-_0x84ab21,_0x23cfe0=offlineHistoryTotalCount-offlineHistoryLoadedCount,_0x4a45ec=_0x667b03[_0x1d6450(0x136)](_0x532e69,_0x23cfe0);offlineHistoryMessages=[..._0x4a45ec,...offlineHistoryMessages],offlineHistoryLoadedCount+=_0x4a45ec[_0x1d6450(0xcbf)];}console['log'](_0x1d6450(0x1c16)+(offlineHistoryLoadedCount===offlineHistoryMessages[_0x1d6450(0xcbf)]?offlineHistoryMessages[_0x1d6450(0xcbf)]:offlineHistoryPageSize)+'条,\x20已加载'+offlineHistoryLoadedCount+_0x1d6450(0xed3)+offlineHistoryTotalCount+'条');}offlineMessages=[...offlineHistoryMessages,...offlineCurrentMessages],initialOfflineMessageCount=offlineMessages[_0x1d6450(0xcbf)],console[_0x1d6450(0xc0d)](_0x1d6450(0xe53)+offlineHistoryMessages['length']+_0x1d6450(0x2542)+offlineCurrentMessages[_0x1d6450(0xcbf)]+_0x1d6450(0x20fd)+offlineMessages['length']+'条');}function loadMoreOfflineHistory(){const _0x6ea26=_0x2cf6d4;if(!currentChatCharacter)return;if(offlineHistoryLoadedCount>=offlineHistoryTotalCount){console['log'](_0x6ea26(0x197b));return;}console[_0x6ea26(0xc0d)](_0x6ea26(0x2da));const _0x3fa9b3=document[_0x6ea26(0x566)](_0x6ea26(0x1697)),_0x11d281=_0x3fa9b3[_0x6ea26(0x14c8)];loadOfflineHistoryPage(),renderOfflineMessages(),setTimeout(()=>{const _0x436961=_0x6ea26,_0x1f1c49=_0x3fa9b3[_0x436961(0x14c8)],_0x4787df=_0x1f1c49-_0x11d281;_0x3fa9b3[_0x436961(0x5e5)]=_0x4787df,console[_0x436961(0xc0d)](_0x436961(0xa0d)+_0x4787df+'px');},0x32);}function loadOfflineMessagesFromCache(){const _0x5437f4=_0x2cf6d4;if(!currentChatCharacter||!windowId)return![];try{const _0x3796db=_0x5437f4(0x12ae)+currentChatCharacter['id']+'_'+windowId,_0xe074a8=localStorage['getItem'](_0x3796db);if(_0xe074a8){const _0x426b89=JSON['parse'](_0xe074a8);if(_0x426b89[_0x5437f4(0x1359)]&&Array[_0x5437f4(0x1bcc)](_0x426b89[_0x5437f4(0x1359)]))return offlineCurrentMessages=_0x426b89['currentMessages'],currentSessionStartTime=_0x426b89[_0x5437f4(0x2399)]||Date[_0x5437f4(0x18e0)](),console[_0x5437f4(0xc0d)]('📥\x20从localStorage加载当前会话消息:\x20'+offlineCurrentMessages['length']+'条'),!![];}}catch(_0x2c14a2){console['warn'](_0x5437f4(0xaeb),_0x2c14a2);}return![];}function clearOfflineMessagesCache(){const _0x4836c2=_0x2cf6d4;if(!currentChatCharacter||!windowId)return;try{const _0x153931='offlineMessages_'+currentChatCharacter['id']+'_'+windowId;localStorage[_0x4836c2(0x1c95)](_0x153931),console[_0x4836c2(0xc0d)](_0x4836c2(0x1d0)+_0x153931);}catch(_0x3eae8c){console[_0x4836c2(0x17cc)]('清理localStorage缓存失败:',_0x3eae8c);}}async function loadLatestOfflinePreset(){const _0x438e2f=_0x2cf6d4;if(!currentChatCharacter){selectedOfflinePresets=[],currentOfflinePreset=null;return;}try{const _0x21edb3=currentChatCharacter['id'],_0x157782=localStorage[_0x438e2f(0x2250)](_0x438e2f(0x4d3)+_0x21edb3);if(_0x157782===_0x438e2f(0xfe9))selectedOfflinePresets=[],currentOfflinePreset=null,console[_0x438e2f(0xc0d)](_0x438e2f(0x197f)+currentChatCharacter[_0x438e2f(0x222f)]+_0x438e2f(0xd69));else{if(_0x157782)try{const _0x37bf8a=JSON[_0x438e2f(0x168e)](_0x157782);if(Array[_0x438e2f(0x1bcc)](_0x37bf8a)){selectedOfflinePresets=[];for(const _0x24a51b of _0x37bf8a){const _0x27c3e3=await db[_0x438e2f(0xa0c)][_0x438e2f(0x46a)](_0x24a51b);_0x27c3e3&&_0x27c3e3[_0x438e2f(0x58b)]===!![]&&selectedOfflinePresets['push'](_0x27c3e3);}currentOfflinePreset=selectedOfflinePresets['length']>0x0?selectedOfflinePresets[0x0]:null,console[_0x438e2f(0xc0d)]('✅\x20为角色\x20'+currentChatCharacter[_0x438e2f(0x222f)]+'\x20加载预设:',selectedOfflinePresets['map'](_0x46cc7f=>_0x46cc7f[_0x438e2f(0x222f)]));}else throw new Error('不是数组格式');}catch(_0xda50a6){const _0x481516=await db[_0x438e2f(0xa0c)][_0x438e2f(0x46a)](_0x157782);_0x481516&&_0x481516['isGlobal']===!![]?(selectedOfflinePresets=[_0x481516],currentOfflinePreset=_0x481516,console[_0x438e2f(0xc0d)]('✅\x20为角色\x20'+currentChatCharacter[_0x438e2f(0x222f)]+'\x20加载预设（旧格式）:\x20'+_0x481516[_0x438e2f(0x222f)])):(selectedOfflinePresets=[],currentOfflinePreset=null,localStorage['removeItem'](_0x438e2f(0x4d3)+_0x21edb3),console[_0x438e2f(0xc0d)]('⚠️\x20角色\x20'+currentChatCharacter[_0x438e2f(0x222f)]+_0x438e2f(0x1b15)));}else selectedOfflinePresets=[],currentOfflinePreset=null,console[_0x438e2f(0xc0d)](_0x438e2f(0x197f)+currentChatCharacter['name']+'\x20首次使用线下模式，默认不使用预设');}}catch(_0x5728e8){console[_0x438e2f(0x24ab)](_0x438e2f(0x1ec5),_0x5728e8),selectedOfflinePresets=[],currentOfflinePreset=null;}}function renderOfflineMessages(){const _0xe45822=_0x2cf6d4,_0x5d6ca5=document[_0xe45822(0x566)](_0xe45822(0x1697));_0x5d6ca5[_0xe45822(0xc02)]='';if(offlineHistoryLoadedCount<offlineHistoryTotalCount&&offlineHistoryTotalCount>0x0){const _0x39ac10=offlineHistoryTotalCount-offlineHistoryLoadedCount,_0x4654d4=document[_0xe45822(0x1ad8)](_0xe45822(0x526));_0x4654d4[_0xe45822(0x221)]='offline-load-more-btn',_0x4654d4[_0xe45822(0xc02)]=_0xe45822(0x2518)+_0x39ac10+_0xe45822(0x1275),_0x5d6ca5[_0xe45822(0x1925)](_0x4654d4);}offlineHistoryMessages[_0xe45822(0x900)](_0x1351e6=>{const _0x4ea2d9=_0xe45822,_0x361933=createOfflineMessageElement(_0x1351e6);_0x5d6ca5[_0x4ea2d9(0x1925)](_0x361933);});if(offlineHistoryMessages[_0xe45822(0xcbf)]>0x0){const _0x80e11=document[_0xe45822(0x1ad8)](_0xe45822(0x526));_0x80e11['className']=_0xe45822(0x2508),_0x80e11[_0xe45822(0xc02)]=_0xe45822(0x2440),_0x5d6ca5[_0xe45822(0x1925)](_0x80e11);}offlineCurrentMessages[_0xe45822(0x900)](_0x2e6aa0=>{const _0x4bb4eb=createOfflineMessageElement(_0x2e6aa0);_0x5d6ca5['appendChild'](_0x4bb4eb);}),setTimeout(()=>{requestAnimationFrame(()=>{const _0x4d8c04=_0x3a81;_0x5d6ca5['scrollTop']=_0x5d6ca5[_0x4d8c04(0x14c8)];});},0x32),setTimeout(()=>{applyOfflineUISettings();},0x64);}function createOfflineMessageElement(_0x2f1bbd){const _0x3286f8=_0x2cf6d4,_0x4d83a8=document['createElement']('div');_0x4d83a8[_0x3286f8(0x221)]='offline-message\x20'+_0x2f1bbd['sender'],_0x4d83a8[_0x3286f8(0x1f26)][_0x3286f8(0x61f)]=_0x2f1bbd['id'];_0x2f1bbd[_0x3286f8(0x1d7f)]&&_0x4d83a8['classList'][_0x3286f8(0xe1)](_0x3286f8(0x2457));const _0x1101fa=document[_0x3286f8(0x1ad8)]('div');_0x1101fa['className']='offline-avatar\x20'+(_0x2f1bbd['sender']===_0x3286f8(0x23b2)?'user-avatar':_0x3286f8(0xf8));if(_0x2f1bbd[_0x3286f8(0xf75)]==='user'){let _0x56f560=null,_0x25dd2e='用户';const _0x4824f4=getCurrentChatSettings();_0x4824f4['myChatAvatar']&&(_0x56f560=_0x4824f4[_0x3286f8(0x13af)]);if(!_0x56f560&&_0x4824f4[_0x3286f8(0x6a0)]){const _0x524e22=personas['find'](_0x743cb7=>_0x743cb7['id']===_0x4824f4['selectedIdentityId']);_0x524e22&&(_0x56f560=_0x524e22[_0x3286f8(0x10f9)],_0x25dd2e=_0x524e22[_0x3286f8(0x222f)]);}!_0x56f560&&window[_0x3286f8(0x21cd)]&&(_0x56f560=window['userAvatar']);if(_0x56f560&&_0x56f560[_0x3286f8(0x1424)]())_0x1101fa[_0x3286f8(0x655)]['backgroundImage']=_0x3286f8(0xcb5)+_0x56f560+')',_0x1101fa['style'][_0x3286f8(0x2000)]=_0x3286f8(0xe3e),_0x1101fa[_0x3286f8(0x655)]['backgroundPosition']=_0x3286f8(0x23a1),_0x1101fa['textContent']='';else{const _0xd10246=createDefaultAvatar(_0x25dd2e);_0x1101fa[_0x3286f8(0x655)]['backgroundImage']=_0x3286f8(0xcb5)+_0xd10246+')',_0x1101fa[_0x3286f8(0x655)][_0x3286f8(0x2000)]='cover',_0x1101fa[_0x3286f8(0x655)]['backgroundPosition']=_0x3286f8(0x23a1),_0x1101fa[_0x3286f8(0x21dc)]='';}}else{let _0x300bf5=null;if(currentChatCharacter){const _0x39f89e=getCurrentChatSettings();if(_0x39f89e[_0x3286f8(0x23e0)])_0x300bf5=_0x39f89e[_0x3286f8(0x23e0)];else{if(currentChatCharacter['avatarUrl'])_0x300bf5=currentChatCharacter['avatarUrl'];else currentChatCharacter['avatar']&&(_0x300bf5=currentChatCharacter['avatar']);}}if(_0x300bf5&&_0x300bf5[_0x3286f8(0x1424)]())_0x1101fa['style'][_0x3286f8(0x1584)]=_0x3286f8(0xcb5)+_0x300bf5+')',_0x1101fa[_0x3286f8(0x655)][_0x3286f8(0x2000)]=_0x3286f8(0xe3e),_0x1101fa[_0x3286f8(0x655)][_0x3286f8(0x18b3)]=_0x3286f8(0x23a1),_0x1101fa[_0x3286f8(0x21dc)]='';else{const _0x418d00=currentChatCharacter?.[_0x3286f8(0x222f)]||'AI',_0x59509d=createDefaultAvatar(_0x418d00);_0x1101fa['style']['backgroundImage']=_0x3286f8(0xcb5)+_0x59509d+')',_0x1101fa['style']['backgroundSize']='cover',_0x1101fa[_0x3286f8(0x655)][_0x3286f8(0x18b3)]='center',_0x1101fa[_0x3286f8(0x21dc)]='';}}const _0x21fd8f=document[_0x3286f8(0x1ad8)](_0x3286f8(0x526));return _0x21fd8f['className']='offline-message-content',_0x21fd8f[_0x3286f8(0xc02)]=formatOfflineText(_0x2f1bbd[_0x3286f8(0x1423)]),_0x4d83a8[_0x3286f8(0x1925)](_0x1101fa),_0x4d83a8[_0x3286f8(0x1925)](_0x21fd8f),addOfflineMessageLongPressListener(_0x4d83a8,_0x2f1bbd['id']),_0x4d83a8;}function scrollOfflineMessagesToBottom(){const _0xf10e16=_0x2cf6d4,_0x267a48=document[_0xf10e16(0x566)](_0xf10e16(0x1697));if(!_0x267a48)return;setTimeout(()=>{requestAnimationFrame(()=>{const _0xc1617d=_0x3a81;_0x267a48[_0xc1617d(0x5e5)]=_0x267a48[_0xc1617d(0x14c8)],setTimeout(()=>{const _0x468ca0=_0xc1617d;_0x267a48[_0x468ca0(0x5e5)]=_0x267a48[_0x468ca0(0x14c8)];},0xa);});},0x64);}async function sendOfflineMessage(){const _0x5e7fea=_0x2cf6d4,_0x5ecb52=document[_0x5e7fea(0x566)](_0x5e7fea(0xb46)),_0x3d1952=_0x5ecb52[_0x5e7fea(0xc34)][_0x5e7fea(0x1424)]();if(!_0x3d1952)return;if(!currentChatCharacter)return;const _0x143264=currentChatCharacter['id'];!chatMessages[_0x143264]&&(chatMessages[_0x143264]=[]);const _0x915031={'id':Date[_0x5e7fea(0x18e0)](),'sender':_0x5e7fea(0xfda),'content':_0x3d1952,'timestamp':Date[_0x5e7fea(0x18e0)](),'type':'text','isOfflineMode':!![]};chatMessages[_0x143264][_0x5e7fea(0x6ee)](_0x915031);try{const _0x2a9177=_0x143264+'_'+_0x915031['id']+'_'+(chatMessages[_0x143264][_0x5e7fea(0xcbf)]-0x1);await db['chatMessages'][_0x5e7fea(0xe1)]({'id':_0x2a9177,'characterId':_0x143264,'timestamp':_0x915031['timestamp'],'messageOrder':chatMessages[_0x143264]['length']-0x1,'originalMessageId':_0x915031['id'],'messageData':_0x915031}),console[_0x5e7fea(0xc0d)](_0x5e7fea(0x22ac));}catch(_0x1bb1f7){console[_0x5e7fea(0x24ab)]('线下用户消息单条保存失败，回退到批量保存:',_0x1bb1f7),await saveChatMessagesImmediate();}const _0xfb0ac7={'id':Date[_0x5e7fea(0x18e0)]()[_0x5e7fea(0x9a3)](),'sender':_0x5e7fea(0x23b2),'content':_0x3d1952,'timestamp':new Date()[_0x5e7fea(0xa4b)]()};offlineCurrentMessages['push'](_0xfb0ac7),offlineMessages=[...offlineHistoryMessages,...offlineCurrentMessages],_0x5ecb52['value']='',renderOfflineMessages(),saveOfflineMessages(),showOfflineLoadingMessage();try{const _0x221d46=await generateOfflineResponse(_0x3d1952),_0x498527={'id':Date[_0x5e7fea(0x18e0)]()+0x1,'sender':'received','content':_0x221d46,'timestamp':Date[_0x5e7fea(0x18e0)]()+0x1,'type':_0x5e7fea(0x1e58),'isOfflineMode':!![]};chatMessages[_0x143264]['push'](_0x498527);try{const _0x560c30=_0x143264+'_offline_ai_'+_0x498527['timestamp']+'_'+Math['random']()[_0x5e7fea(0x9a3)](0x24)[_0x5e7fea(0x18cf)](0x2,0x9)+'_'+(chatMessages[_0x143264][_0x5e7fea(0xcbf)]-0x1);await db['chatMessages'][_0x5e7fea(0xe1)]({'id':_0x560c30,'characterId':_0x143264,'timestamp':_0x498527['timestamp'],'messageOrder':chatMessages[_0x143264][_0x5e7fea(0xcbf)]-0x1,'originalMessageId':_0x498527['id'],'messageData':_0x498527}),console[_0x5e7fea(0xc0d)](_0x5e7fea(0x1a94));}catch(_0x1c5c95){console['error'](_0x5e7fea(0x3f7),_0x1c5c95),await saveChatMessagesImmediate();}const _0xc01748={'id':(Date[_0x5e7fea(0x18e0)]()+0x1)[_0x5e7fea(0x9a3)](),'sender':'ai','content':_0x221d46,'timestamp':new Date()['toISOString']()};offlineCurrentMessages[_0x5e7fea(0x6ee)](_0xc01748),offlineMessages=[...offlineHistoryMessages,...offlineCurrentMessages],hideOfflineLoadingMessage(),renderOfflineMessages(),saveOfflineMessages(),scrollOfflineMessagesToBottom();}catch(_0x43a247){console[_0x5e7fea(0x24ab)]('生成线下回复失败:',_0x43a247),hideOfflineLoadingMessage(),showToast(_0x5e7fea(0x1b82),_0x5e7fea(0x24ab));}}async function callOfflineChatAPI(_0xe88417,_0x140ba5){const _0x4ba85c=_0x2cf6d4;if(!apiSettings[_0x4ba85c(0x157f)])throw new Error('请先设置API密钥');const _0x5d7781=apiSettings[_0x4ba85c(0x90b)][_0x4ba85c(0x23ec)](_0x4ba85c(0xad8));if(_0x5d7781){const _0x345061=apiSettings[_0x4ba85c(0x90b)]+_0x4ba85c(0x1f4e)+apiSettings[_0x4ba85c(0xeea)]+':generateContent?key='+apiSettings[_0x4ba85c(0x157f)],_0x4ade92={'contents':[{'role':'user','parts':[{'text':'你是'+_0x140ba5[_0x4ba85c(0x222f)]+'，'+_0x140ba5['prompt']+_0x4ba85c(0xdc8)+_0xe88417}]}],'generationConfig':{'temperature':apiSettings[_0x4ba85c(0x2b0)]||0.8}},_0x45e76b=await fetch(_0x345061,{'method':_0x4ba85c(0x227d),'headers':{'Content-Type':'application/json'},'body':JSON['stringify'](_0x4ade92)});if(!_0x45e76b['ok'])throw new Error(_0x4ba85c(0x1cf0)+_0x45e76b['status']);const _0x5dd80f=await _0x45e76b[_0x4ba85c(0x2318)]();console['log'](_0x4ba85c(0x1ab3),JSON[_0x4ba85c(0x7fb)](_0x5dd80f,null,0x2));const _0x1f03eb=_0x5dd80f[_0x4ba85c(0x1d23)]?.[0x0]?.[_0x4ba85c(0x1423)]?.[_0x4ba85c(0x23c1)]?.[0x0]?.['text'];if(!_0x1f03eb)return console[_0x4ba85c(0xc0d)](_0x4ba85c(0x75a),_0x5dd80f),console[_0x4ba85c(0xc0d)](_0x4ba85c(0x1322),_0x5dd80f[_0x4ba85c(0x1d23)]?.[0x0]),_0x5dd80f[_0x4ba85c(0x1d23)]?.[0x0]?.[_0x4ba85c(0x1423)]&&console[_0x4ba85c(0xc0d)](_0x4ba85c(0x1a1d),_0x5dd80f['candidates'][0x0][_0x4ba85c(0x1423)]),_0x5dd80f[_0x4ba85c(0x1d23)]?.[0x0]?.[_0x4ba85c(0x1423)]?.['parts']&&console['log']('🔥\x20parts:',_0x5dd80f[_0x4ba85c(0x1d23)][0x0]['content'][_0x4ba85c(0x23c1)]),_0x4ba85c(0x2059);return _0x1f03eb;}else{let _0x48fb0e=apiSettings[_0x4ba85c(0x90b)],_0x26b217;if(_0x48fb0e['endsWith'](_0x4ba85c(0x812)))_0x26b217=_0x48fb0e+'/chat/completions';else _0x48fb0e[_0x4ba85c(0x23ec)](_0x4ba85c(0x193c))?_0x26b217=_0x48fb0e+'/chat/completions':_0x26b217=_0x48fb0e+_0x4ba85c(0xce8);const _0x336e1e={'model':apiSettings['model'],'messages':[{'role':_0x4ba85c(0x212),'content':'你是'+_0x140ba5[_0x4ba85c(0x222f)]+'，'+_0x140ba5['prompt']+_0x4ba85c(0x23ed)},{'role':'user','content':_0xe88417}],'temperature':apiSettings[_0x4ba85c(0x2b0)]||0.8},_0x13a810=await fetch(_0x26b217,{'method':_0x4ba85c(0x227d),'headers':{'Content-Type':_0x4ba85c(0x302),'Authorization':'Bearer\x20'+apiSettings[_0x4ba85c(0x157f)]},'body':JSON[_0x4ba85c(0x7fb)](_0x336e1e)});if(!_0x13a810['ok'])throw new Error(_0x4ba85c(0x1cf0)+_0x13a810[_0x4ba85c(0xe54)]);const _0x3cf32c=await _0x13a810[_0x4ba85c(0x2318)]();console[_0x4ba85c(0xc0d)]('线下模式OpenAI\x20API响应数据:',_0x3cf32c);const _0x1b55d2=_0x3cf32c['choices']?.[0x0]?.[_0x4ba85c(0xd7a)]?.['content'];if(!_0x1b55d2){console['error'](_0x4ba85c(0xade),_0x3cf32c);throw new Error(_0x4ba85c(0x846));}return _0x1b55d2;}}async function generateOfflineResponse(_0x39b9d6){const _0x2fa323=_0x2cf6d4,_0x3d4fd5=currentChatCharacter;console['log'](_0x2fa323(0x10d0)),console['log'](_0x2fa323(0x20e),_0x3d4fd5[_0x2fa323(0x222f)]),console['log'](_0x2fa323(0x1a44),_0x39b9d6);let _0x4bd051=_0x2fa323(0xc7d);const _0x4141df=getCurrentChatSettings();console['log']('⚙️\x20聊天设置:',_0x4141df);let _0x41da1b='';const _0x319c97=_0x4141df['enableDynamicMemory']!==![];console[_0x2fa323(0xc0d)](_0x2fa323(0x170a),_0x319c97);if(_0x319c97)try{const _0x413ef6=await getVisibleMomentsForCharacter(_0x3d4fd5['id'],0x5);console[_0x2fa323(0xc0d)](_0x2fa323(0xcdd),_0x413ef6[_0x2fa323(0xcbf)]),_0x413ef6[_0x2fa323(0xcbf)]>0x0?(_0x41da1b='\x0a\x0a【最新动态记忆】以下是最近的动态内容和讨论，你可以在对话中自然地提及：\x0a',_0x413ef6[_0x2fa323(0x900)]((_0x260696,_0x55bcd0)=>{const _0x1deb0c=_0x2fa323,_0x314fa6=_0x260696[_0x1deb0c(0x3df)]==='user'?'用户':_0x260696[_0x1deb0c(0x201a)];let _0x524cd1='';if(_0x260696[_0x1deb0c(0x7aa)]){const _0x4575d2=Date[_0x1deb0c(0x18e0)](),_0x1643d0=_0x4575d2-_0x260696[_0x1deb0c(0x7aa)],_0xaa243a=Math[_0x1deb0c(0x1dac)](_0x1643d0/(0x3e8*0x3c)),_0x1bd70e=Math[_0x1deb0c(0x1dac)](_0x1643d0/(0x3e8*0x3c*0x3c)),_0x4ce262=Math[_0x1deb0c(0x1dac)](_0x1643d0/(0x3e8*0x3c*0x3c*0x18));if(_0x4ce262>0x0)_0x524cd1='\x20('+_0x4ce262+'天前)';else{if(_0x1bd70e>0x0)_0x524cd1='\x20('+_0x1bd70e+_0x1deb0c(0xa01);else _0xaa243a>0x0?_0x524cd1='\x20('+_0xaa243a+'分钟前)':_0x524cd1=_0x1deb0c(0x2085);}}const _0x424810=_0x55bcd0+0x1+'.\x20'+_0x314fa6+':\x20'+_0x260696[_0x1deb0c(0x1e58)]+_0x524cd1+(_0x260696[_0x1deb0c(0x6a7)]||'');_0x41da1b+=_0x424810,console[_0x1deb0c(0xc0d)](_0x1deb0c(0x19ea)+(_0x55bcd0+0x1)+':\x20'+_0x314fa6+_0x1deb0c(0x2316)+_0x260696[_0x1deb0c(0x1e58)]+(_0x260696[_0x1deb0c(0x21ed)]>0x0?'\x20('+_0x260696['commentsCount']+_0x1deb0c(0x1fe2):''));})):console[_0x2fa323(0xc0d)]('📱\x20没有可用的动态记忆');}catch(_0x1ce2b6){console[_0x2fa323(0x24ab)]('获取动态记忆失败:',_0x1ce2b6);}let _0x977ab2='';if(_0x3d4fd5&&!currentChatCharacter?.['isGroup']){const _0x347b6b=isBlocked(_0x3d4fd5['id'],_0x2fa323(0x23b2));if(_0x347b6b){const _0x59cf51=_0x2fa323(0x1366)+_0x3d4fd5['id'],_0x40765f=parseInt(localStorage[_0x2fa323(0x2250)](_0x59cf51)||'0');_0x977ab2='\x0a\x0a🚨\x20**【重要状态提醒】**\x20🚨\x0a你目前被用户拉黑了！这个状态会持续影响你的行为和情绪。\x0a'+(_0x40765f>0x0?_0x2fa323(0x732)+_0x40765f+_0x2fa323(0x14c7):_0x2fa323(0xfea))+_0x2fa323(0x1ada);}}let _0xf90648='';try{const _0x286ebb=getGlobalMemorySettings();console[_0x2fa323(0xc0d)](_0x2fa323(0x16c4),_0x286ebb);const _0x4cbdd1={'type':_0x2fa323(0x10d7),'id':_0x3d4fd5['id']};console[_0x2fa323(0xc0d)](_0x2fa323(0x1b76),_0x4cbdd1),console[_0x2fa323(0xc0d)](_0x2fa323(0x179b)),_0xf90648=await buildGlobalMemoryContext(_0x3d4fd5['id'],_0x4cbdd1,_0x286ebb['memoryDays']),console[_0x2fa323(0xc0d)](_0x2fa323(0x2d3),_0xf90648),_0xf90648&&_0xf90648['trim']()?(console[_0x2fa323(0xc0d)](_0x2fa323(0x2303),_0xf90648[_0x2fa323(0xcbf)]),console[_0x2fa323(0xc0d)](_0x2fa323(0x1aac),_0xf90648[_0x2fa323(0x4b2)](0x0,0xc8)+'...')):console[_0x2fa323(0xc0d)]('🧠\x20全局记忆内容为空');}catch(_0x51f85b){console[_0x2fa323(0x24ab)]('获取全局记忆失败:',_0x51f85b);}const _0x3daa59=_0x3d4fd5[_0x2fa323(0x1f8f)]||_0x3d4fd5['bio']||'你是'+_0x3d4fd5['name']+'。';console['log'](_0x2fa323(0x847),_0x3daa59),console[_0x2fa323(0xc0d)](_0x2fa323(0xa0e),_0x3d4fd5),_0x4bd051+=_0x2fa323(0x1a09)+_0x3daa59+'\x0a\x0a';let _0x518614='';try{const _0x15513d=_0x4141df[_0x2fa323(0x9af)]&&_0x4141df['selectedWorldbooks']?_0x4141df[_0x2fa323(0xefa)]:[],_0x5d4ece=window[_0x2fa323(0xfb9)]||[],_0x10dce9=[...new Set([..._0x5d4ece,..._0x15513d])];console[_0x2fa323(0xc0d)](_0x2fa323(0xfc3),_0x10dce9),console['log'](_0x2fa323(0x1611),_0x5d4ece),console[_0x2fa323(0xc0d)]('📚\x20局部世界书:',_0x15513d),console[_0x2fa323(0xc0d)](_0x2fa323(0xa12),worldbooks),_0x10dce9[_0x2fa323(0xcbf)]>0x0?(_0x518614='\x0a【世界书信息】以下是相关的世界设定：\x0a',_0x10dce9[_0x2fa323(0x900)]((_0x14aba8,_0x5e4105)=>{const _0x170683=_0x2fa323,_0x4926cc=worldbooks[_0x170683(0x1aeb)](_0x15014d=>_0x15014d['id']===_0x14aba8);_0x4926cc?(console[_0x170683(0xc0d)]('📚\x20找到世界书\x20'+(_0x5e4105+0x1)+':\x20'+(_0x4926cc[_0x170683(0x222f)]||_0x4926cc[_0x170683(0x1c18)])),_0x518614+=_0x5e4105+0x1+'.\x20'+(_0x4926cc[_0x170683(0x222f)]||_0x4926cc[_0x170683(0x1c18)])+':\x20'+_0x4926cc[_0x170683(0x1423)]+'\x0a'):console[_0x170683(0xc0d)](_0x170683(0x23d1)+_0x14aba8);}),_0x4bd051+=_0x518614+'\x0a',console['log']('📚\x20世界书内容已添加到prompt，长度:',_0x518614[_0x2fa323(0xcbf)])):console[_0x2fa323(0xc0d)](_0x2fa323(0x220b));}catch(_0x1012d9){console[_0x2fa323(0x24ab)](_0x2fa323(0x332),_0x1012d9);}_0xf90648&&_0xf90648[_0x2fa323(0x1424)]()&&(_0x4bd051+=_0x2fa323(0x993)+_0xf90648+'\x0a');_0x41da1b&&(_0x4bd051+=_0x41da1b+'\x0a');_0x977ab2&&(_0x4bd051+=_0x977ab2+'\x0a');selectedOfflinePresets&&selectedOfflinePresets[_0x2fa323(0xcbf)]>0x0?(_0x4bd051+=_0x2fa323(0x4d6),selectedOfflinePresets[_0x2fa323(0x900)]((_0x1c2af9,_0x133fe1)=>{const _0x47a2db=_0x2fa323;_0x4bd051+=_0x133fe1+0x1+'.\x20'+_0x1c2af9['name']+'：\x0a'+_0x1c2af9[_0x47a2db(0x1423)]+'\x0a\x0a';})):_0x4bd051+='默认剧情模式要求：\x0a-\x20以第三人称视角进行情景描写\x0a-\x20包含环境描写、动作描写、心理描写\x0a-\x20每次回复300-500字\x0a-\x20营造沉浸式的剧情体验\x0a-\x20**重要**：用户消息中的括号()内容是环境描写、动作描写或心理活动，你可以观察到这些信息作为背景，但不能表现得像是\x22听到\x22了用户的内心想法。你只能对括号外的实际话语进行回应，可以通过观察用户的可见行为（如犹豫、停顿等）来推测情况，但不能直接回应用户的内心想法\x0a\x0a';const _0x2e43e1=_0x4141df[_0x2fa323(0xe03)]||0x5,_0x3881d5=chatMessages[_0x3d4fd5['id']]||[],_0x5d1745=_0x3881d5[_0x2fa323(0x136)](-_0x2e43e1),_0x1d12da=_0x5d1745[_0x2fa323(0x803)](_0x559e90=>!_0x559e90['isOfflineMode'])[_0x2fa323(0xcbf)],_0x34eb56=_0x5d1745[_0x2fa323(0x803)](_0x23973b=>_0x23973b[_0x2fa323(0x14ad)])[_0x2fa323(0xcbf)];console[_0x2fa323(0xc0d)](_0x2fa323(0x212d),_0x5d1745),console[_0x2fa323(0xc0d)](_0x2fa323(0xe0)+_0x1d12da+_0x2fa323(0x824)+_0x34eb56+_0x2fa323(0x1a66)+_0x5d1745['length']+_0x2fa323(0x24a4)+_0x2e43e1+'条)'),console[_0x2fa323(0xc0d)](_0x2fa323(0xc1a),_0x5d1745['map'](_0x2f829d=>_0x2f829d[_0x2fa323(0xf75)]+':\x20'+safeExtractMessageContent(_0x2f829d)[_0x2fa323(0x4b2)](0x0,0x32)+_0x2fa323(0x12da)));_0x5d1745[_0x2fa323(0xcbf)]>0x0&&(_0x4bd051+='最近的对话历史：\x0a',_0x5d1745[_0x2fa323(0x900)](_0x328005=>{const _0x5846b7=_0x2fa323,_0x420811=_0x328005[_0x5846b7(0xf75)]==='sent'||_0x328005[_0x5846b7(0xf75)]===_0x5846b7(0x23b2)?'用户':_0x3d4fd5[_0x5846b7(0x222f)],_0x1bfa3d=_0x328005[_0x5846b7(0x14ad)]?'[线下]':_0x5846b7(0x1eee),_0x431a42=safeExtractMessageContent(_0x328005);_0x4bd051+=''+_0x420811+_0x1bfa3d+'：'+_0x431a42+'\x0a';}),_0x4bd051+='\x0a');_0x4bd051+=_0x2fa323(0x37d)+_0x39b9d6+_0x2fa323(0x219f),console['log']('📝\x20=====\x20完整的Prompt内容\x20====='),console[_0x2fa323(0xc0d)](_0x4bd051),console[_0x2fa323(0xc0d)](_0x2fa323(0x11b7));try{const _0x5696ea=await callOfflineChatAPI(_0x4bd051,_0x3d4fd5);return _0x5696ea||_0x2fa323(0x2059);}catch(_0x1a976d){console[_0x2fa323(0x24ab)]('线下模式API调用失败:',_0x1a976d);throw _0x1a976d;}}function saveOfflineMessages(){const _0x3ce4a5=_0x2cf6d4;if(!currentChatCharacter||!windowId)return;try{const _0x1c0514='offlineMessages_'+currentChatCharacter['id']+'_'+windowId,_0x4a4d1a={'currentMessages':offlineCurrentMessages,'sessionStartTime':currentSessionStartTime,'lastUpdate':Date[_0x3ce4a5(0x18e0)]()};localStorage[_0x3ce4a5(0x2055)](_0x1c0514,JSON['stringify'](_0x4a4d1a)),console[_0x3ce4a5(0xc0d)](_0x3ce4a5(0x13fe)+windowId+'):\x20'+offlineCurrentMessages[_0x3ce4a5(0xcbf)]+'条');}catch(_0x3c7b20){console['warn']('localStorage缓存失败，但不影响功能:',_0x3c7b20);if(_0x3c7b20[_0x3ce4a5(0x222f)]===_0x3ce4a5(0xf22)){console[_0x3ce4a5(0xc0d)](_0x3ce4a5(0x2e9));try{const _0x30cfe6=[];for(let _0x9b1309=0x0;_0x9b1309<localStorage['length'];_0x9b1309++){const _0xa3a89b=localStorage[_0x3ce4a5(0x157f)](_0x9b1309);_0xa3a89b&&_0xa3a89b[_0x3ce4a5(0x1cab)](_0x3ce4a5(0x12ae))&&_0x30cfe6[_0x3ce4a5(0x6ee)](_0xa3a89b);}const _0x297cf6=_0x3ce4a5(0x12ae)+currentChatCharacter['id']+'_'+windowId;_0x30cfe6[_0x3ce4a5(0x900)](_0x37a206=>{const _0x4583cf=_0x3ce4a5;_0x37a206!==_0x297cf6&&(localStorage[_0x4583cf(0x1c95)](_0x37a206),console[_0x4583cf(0xc0d)](_0x4583cf(0x1caf),_0x37a206));});const _0x1bb3ce={'currentMessages':offlineCurrentMessages,'sessionStartTime':currentSessionStartTime,'lastUpdate':Date[_0x3ce4a5(0x18e0)]()};localStorage[_0x3ce4a5(0x2055)](_0x297cf6,JSON[_0x3ce4a5(0x7fb)](_0x1bb3ce)),console['log'](_0x3ce4a5(0x1bd2));}catch(_0x4de842){console['warn'](_0x3ce4a5(0x432),_0x4de842);}}}}async function regenerateLastOfflineMessage(){const _0x4c882e=_0x2cf6d4;if(!currentChatCharacter)return;if(offlineMessages[_0x4c882e(0xcbf)]===0x0)return;console[_0x4c882e(0xc0d)](_0x4c882e(0x1039));let _0x87988b=-0x1,_0x263173=null;for(let _0x395f82=offlineMessages[_0x4c882e(0xcbf)]-0x1;_0x395f82>=0x0;_0x395f82--){if(offlineMessages[_0x395f82]['sender']==='ai'){_0x87988b=_0x395f82,_0x263173=offlineMessages[_0x395f82];break;}}if(_0x87988b===-0x1){showToast(_0x4c882e(0x1b19),'warning');return;}let _0x237de1=![];for(let _0x483668=_0x87988b+0x1;_0x483668<offlineMessages[_0x4c882e(0xcbf)];_0x483668++){if(offlineMessages[_0x483668][_0x4c882e(0xf75)]==='user'){_0x237de1=!![];break;}}let _0x5223ef=![];_0x87988b>0x0&&offlineMessages[_0x87988b-0x1]['sender']==='ai'&&(_0x5223ef=!![]);const _0x123621=!_0x237de1&&_0x5223ef;let _0x1d341d=-0x1,_0x363d8d=null;if(!_0x123621){for(let _0x3058b2=_0x87988b-0x1;_0x3058b2>=0x0;_0x3058b2--){if(offlineMessages[_0x3058b2][_0x4c882e(0xf75)]===_0x4c882e(0x23b2)){_0x1d341d=_0x3058b2,_0x363d8d=offlineMessages[_0x3058b2];break;}}if(_0x1d341d===-0x1){showToast(_0x4c882e(0x141),_0x4c882e(0x13bb));return;}}console[_0x4c882e(0xc0d)]('🔄\x20[线下最后消息重新生成]\x20消息类型分析:',{'lastAiMessageIndex':_0x87988b,'hasUserMessageAfterLastAI':_0x237de1,'isPreviousMessageAlsoAI':_0x5223ef,'isContinuationMessage':_0x123621,'userMessageIndex':_0x1d341d,'lastAiContent':_0x263173['content'][_0x4c882e(0x4b2)](0x0,0x32)+'...'}),console[_0x4c882e(0xc0d)](_0x4c882e(0x15f9));const _0x59c352=document[_0x4c882e(0x15b8)](_0x4c882e(0x64f)+_0x263173['id']+'\x22]');_0x59c352&&_0x59c352['remove']();const _0x53d6e4=currentChatCharacter['id'],_0x20b3e8=chatMessages[_0x53d6e4]||[];console[_0x4c882e(0xc0d)](_0x4c882e(0x822),_0x20b3e8[_0x4c882e(0xcbf)]),console[_0x4c882e(0xc0d)]('🔍\x20[线下最后消息重新生成]\x20要删除的消息:',_0x263173);let _0x5565ea=-0x1;for(let _0xbd0459=_0x20b3e8[_0x4c882e(0xcbf)]-0x1;_0xbd0459>=0x0;_0xbd0459--){if(_0x20b3e8[_0xbd0459][_0x4c882e(0x14ad)]&&(_0x20b3e8[_0xbd0459][_0x4c882e(0xc48)]===_0x263173['id']||_0x20b3e8[_0xbd0459][_0x4c882e(0x7aa)]===_0x263173[_0x4c882e(0x7aa)]&&_0x20b3e8[_0xbd0459][_0x4c882e(0x1423)]===_0x263173[_0x4c882e(0x1423)])){_0x5565ea=_0xbd0459;break;}}if(_0x5565ea!==-0x1){console[_0x4c882e(0xc0d)](_0x4c882e(0x21b9),_0x5565ea);const _0xb8db81=_0x20b3e8[_0x5565ea];try{await deleteRelatedTimelineEvents(_0xb8db81),console['log'](_0x4c882e(0x382));}catch(_0x4163a2){console['error']('清理时间线记忆失败:',_0x4163a2);}chatMessages[_0x53d6e4][_0x4c882e(0x220f)](_0x5565ea,0x1),console['log'](_0x4c882e(0xf5d),chatMessages[_0x53d6e4]['length']);try{const _0x2db144=await db[_0x4c882e(0x464)][_0x4c882e(0x4a6)]('characterId')[_0x4c882e(0x14a)](_0x53d6e4)[_0x4c882e(0x1534)](_0x2a504f=>_0x2a504f[_0x4c882e(0xc48)]===_0xb8db81['id'])[_0x4c882e(0x2200)]();_0x2db144&&(await db['chatMessages'][_0x4c882e(0xc2b)](_0x2db144['id']),console[_0x4c882e(0xc0d)](_0x4c882e(0x2565)));}catch(_0x407d0f){console[_0x4c882e(0x24ab)](_0x4c882e(0x818),_0x407d0f);}}else console[_0x4c882e(0x17cc)](_0x4c882e(0x622));await deleteOfflineMessageInternal(_0x263173['id']),showOfflineLoadingMessage();try{let _0x33af7f;if(_0x123621)console[_0x4c882e(0xc0d)](_0x4c882e(0x11d4)),_0x33af7f=await generateOfflineContinuation();else{console[_0x4c882e(0xc0d)](_0x4c882e(0x1c07));if(_0x363d8d)_0x33af7f=await generateOfflineResponse(_0x363d8d[_0x4c882e(0x1423)]);else{showToast('用户消息不存在，无法重新生成',_0x4c882e(0x24ab)),hideOfflineLoadingMessage();return;}}const _0x2ca7d6={'id':Date[_0x4c882e(0x18e0)]()['toString'](),'sender':'ai','content':_0x33af7f,'timestamp':new Date()[_0x4c882e(0xa4b)]()};offlineCurrentMessages['push'](_0x2ca7d6),offlineMessages=[...offlineHistoryMessages,...offlineCurrentMessages];const _0x44a68a={'id':Date[_0x4c882e(0x18e0)]()+0x1,'sender':_0x4c882e(0x232),'content':_0x33af7f,'timestamp':Date[_0x4c882e(0x18e0)]()+0x1,'type':_0x4c882e(0x1e58),'isOfflineMode':!![]},_0x4c9e40=currentChatCharacter['id'];!chatMessages[_0x4c9e40]&&(chatMessages[_0x4c9e40]=[]);chatMessages[_0x4c9e40][_0x4c882e(0x6ee)](_0x44a68a);try{const _0x17eb48=_0x4c9e40+_0x4c882e(0xf84)+_0x44a68a[_0x4c882e(0x7aa)]+'_'+Math[_0x4c882e(0x191c)]()[_0x4c882e(0x9a3)](0x24)[_0x4c882e(0x18cf)](0x2,0x9)+'_'+(chatMessages[_0x4c9e40]['length']-0x1);await db[_0x4c882e(0x464)][_0x4c882e(0xe1)]({'id':_0x17eb48,'characterId':_0x4c9e40,'timestamp':_0x44a68a['timestamp'],'messageOrder':chatMessages[_0x4c9e40][_0x4c882e(0xcbf)]-0x1,'originalMessageId':_0x44a68a['id'],'messageData':_0x44a68a}),console[_0x4c882e(0xc0d)](_0x4c882e(0x1bdd));}catch(_0x306623){console['error'](_0x4c882e(0x1fdb),_0x306623);}hideOfflineLoadingMessage(),renderOfflineMessages(),saveOfflineMessages(),scrollOfflineMessagesToBottom(),showToast('AI回复已重新生成','success'),console[_0x4c882e(0xc0d)]('✅\x20[线下最后消息重新生成]\x20重新生成完成');}catch(_0x1b3731){console[_0x4c882e(0x24ab)](_0x4c882e(0x10d1),_0x1b3731),hideOfflineLoadingMessage(),showToast(_0x4c882e(0x141c),_0x4c882e(0x24ab));}}function addOfflineMessageLongPressListener(_0x1f86d5,_0x3fa588){const _0x4f2a29=_0x2cf6d4;let _0x35b997=null,_0x747328=![];const _0x3acbd8=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i[_0x4f2a29(0x17ba)](navigator[_0x4f2a29(0x473)])||'ontouchstart'in window||navigator[_0x4f2a29(0x1e9e)]>0x0||window[_0x4f2a29(0x2145)]<=0x300,_0x36bfa3=_0x1aff3a=>{_0x747328=![];const _0x53cbcc=_0x3acbd8?0x258:0x3e8;_0x35b997=setTimeout(()=>{const _0x369c67=_0x3a81;_0x747328=!![],navigator[_0x369c67(0xd8f)]&&_0x3acbd8&&navigator[_0x369c67(0xd8f)](0x32),showOfflineMessageMenu(_0x3fa588,_0x1aff3a),_0x1aff3a[_0x369c67(0x4d9)]();},_0x53cbcc);},_0x553d43=()=>{_0x35b997&&(clearTimeout(_0x35b997),_0x35b997=null),setTimeout(()=>{_0x747328=![];},0x32);},_0x5202c3=_0xdcb301=>{const _0x36b4ab=_0x4f2a29;if(_0x747328)return _0xdcb301[_0x36b4ab(0x4d9)](),_0xdcb301[_0x36b4ab(0x1023)](),![];};_0x1f86d5[_0x4f2a29(0x167)](_0x4f2a29(0xf52),_0x36bfa3,{'passive':![]}),_0x1f86d5[_0x4f2a29(0x167)]('touchend',_0x553d43),_0x1f86d5[_0x4f2a29(0x167)]('touchmove',_0x553d43),_0x1f86d5['addEventListener']('mousedown',_0x36bfa3),_0x1f86d5[_0x4f2a29(0x167)](_0x4f2a29(0x1fb0),_0x553d43),_0x1f86d5[_0x4f2a29(0x167)](_0x4f2a29(0x1761),_0x553d43),_0x1f86d5[_0x4f2a29(0x167)](_0x4f2a29(0xd3e),_0xc40b6b=>{_0xc40b6b['preventDefault'](),showOfflineMessageMenu(_0x3fa588,_0xc40b6b);}),_0x1f86d5[_0x4f2a29(0x167)]('click',_0x5202c3,!![]);}function showOfflineMessageMenu(_0xa81e25,_0x45d3e4){const _0x50d342=_0x2cf6d4,_0x5deda1=offlineMessages[_0x50d342(0x1aeb)](_0x559880=>_0x559880['id']===_0xa81e25);if(!_0x5deda1){console[_0x50d342(0x17cc)](_0x50d342(0x21c5),_0xa81e25);return;}const _0xfec2e2=offlineHistoryMessages['some'](_0x4775fd=>_0x4775fd['id']===_0xa81e25),_0x3e10ea=document[_0x50d342(0x1ad8)](_0x50d342(0x526));_0x3e10ea['className']=_0x50d342(0x4f8);if(_0xfec2e2)_0x5deda1['sender']===_0x50d342(0x23b2)?_0x3e10ea[_0x50d342(0xc02)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22menu-item\x22\x20onclick=\x22editOfflineMessage(\x27'+_0xa81e25+_0x50d342(0x2496)+_0xa81e25+_0x50d342(0x1517):_0x3e10ea[_0x50d342(0xc02)]=_0x50d342(0x18e3)+_0xa81e25+'\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-edit\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>编辑历史消息</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22menu-item\x20delete\x22\x20onclick=\x22deleteOfflineMessage(\x27'+_0xa81e25+_0x50d342(0x1517);else _0x5deda1['sender']===_0x50d342(0x23b2)?_0x3e10ea['innerHTML']=_0x50d342(0x1995)+_0xa81e25+'\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-edit\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>修改消息</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22menu-item\x20delete\x22\x20onclick=\x22deleteOfflineMessage(\x27'+_0xa81e25+'\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-trash\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>删除消息</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20':_0x3e10ea[_0x50d342(0xc02)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22menu-item\x22\x20onclick=\x22editOfflineMessage(\x27'+_0xa81e25+_0x50d342(0x672)+_0xa81e25+'\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-trash\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>删除消息</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22menu-item\x22\x20onclick=\x22regenerateOfflineMessage(\x27'+_0xa81e25+_0x50d342(0x108c);const _0x264b9c=document[_0x50d342(0x15b8)](_0x50d342(0x1f04));_0x264b9c&&_0x264b9c['remove']();const _0x8150cf=document[_0x50d342(0x566)](_0x50d342(0x1634));_0x8150cf?_0x8150cf[_0x50d342(0x1925)](_0x3e10ea):document['body'][_0x50d342(0x1925)](_0x3e10ea);const _0x4d3268=_0x45d3e4[_0x50d342(0x1144)][_0x50d342(0xb37)](),_0x2c1e10=_0x8150cf?_0x8150cf[_0x50d342(0xb37)]():{'left':0x0,'top':0x0},_0x5b58ab=_0x4d3268[_0x50d342(0x1466)]-_0x2c1e10[_0x50d342(0x1466)],_0x3f1e95=_0x4d3268[_0x50d342(0x15f7)]-_0x2c1e10[_0x50d342(0x15f7)];_0x3e10ea[_0x50d342(0x655)][_0x50d342(0x492)]='absolute',_0x3e10ea[_0x50d342(0x655)][_0x50d342(0x8bc)]=_0x50d342(0xad3),setTimeout(()=>{const _0x141efa=_0x50d342,_0xa213a6=_0x3e10ea[_0x141efa(0x1486)]||0x8c,_0x50dcd1=_0x3e10ea['offsetHeight']||0x64,_0x10e73d=_0x8150cf?.[_0x141efa(0x1486)]||0x190,_0x2de00b=_0x8150cf?.['offsetHeight']||0x258;let _0x2bb353=Math[_0x141efa(0x21f7)](_0x5b58ab,_0x10e73d-_0xa213a6-0xa),_0x5d7c5d=_0x3f1e95-_0x50dcd1-0x5;_0x5d7c5d<0xa&&(_0x5d7c5d=_0x3f1e95+0x1e),_0x2bb353=Math[_0x141efa(0x910)](0xa,_0x2bb353),_0x5d7c5d=Math[_0x141efa(0x910)](0xa,Math[_0x141efa(0x21f7)](_0x5d7c5d,_0x2de00b-_0x50dcd1-0xa)),_0x3e10ea[_0x141efa(0x655)][_0x141efa(0x1466)]=_0x2bb353+'px',_0x3e10ea[_0x141efa(0x655)]['top']=_0x5d7c5d+'px';},0x0);const _0x3a88f6=_0x445e40=>{const _0x3698f5=_0x50d342;!_0x3e10ea[_0x3698f5(0x1f9)](_0x445e40['target'])&&(_0x3e10ea['remove'](),document[_0x3698f5(0x6be)](_0x3698f5(0x1e62),_0x3a88f6));};setTimeout(()=>{const _0x98d8e3=_0x50d342;document[_0x98d8e3(0x167)](_0x98d8e3(0x1e62),_0x3a88f6);},0x64);}function editOfflineMessage(_0x347119){const _0x4634c2=_0x2cf6d4,_0x67a28e=offlineMessages['find'](_0x444760=>_0x444760['id']===_0x347119);if(!_0x67a28e)return;const _0x493293=document[_0x4634c2(0x1ad8)](_0x4634c2(0x526));_0x493293[_0x4634c2(0x221)]=_0x4634c2(0x169b),_0x493293['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x20edit-message-modal\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3>编辑'+(_0x67a28e[_0x4634c2(0xf75)]==='ai'?_0x4634c2(0x19e2):_0x4634c2(0xe16))+_0x4634c2(0x362)+_0x67a28e[_0x4634c2(0x1423)]+_0x4634c2(0x363)+_0x67a28e['content'][_0x4634c2(0xcbf)]+_0x4634c2(0x6ea)+(_0x67a28e[_0x4634c2(0xf75)]==='ai'?_0x4634c2(0x189):'')+_0x4634c2(0x1aa)+_0x347119+_0x4634c2(0x1be),document[_0x4634c2(0x172c)][_0x4634c2(0x1925)](_0x493293);const _0x424aca=_0x493293[_0x4634c2(0x15b8)](_0x4634c2(0x1bcf)),_0xa627ae=_0x493293[_0x4634c2(0x15b8)]('#edit-offline-char-count');_0x424aca[_0x4634c2(0x167)](_0x4634c2(0x627),function(){const _0x719381=_0x4634c2;_0xa627ae['textContent']=this[_0x719381(0xc34)][_0x719381(0xcbf)];}),_0x424aca[_0x4634c2(0x1b12)](),_0x424aca[_0x4634c2(0x5f1)](_0x424aca[_0x4634c2(0xc34)][_0x4634c2(0xcbf)],_0x424aca[_0x4634c2(0xc34)][_0x4634c2(0xcbf)]);const _0x1c89eb=document[_0x4634c2(0x15b8)](_0x4634c2(0x1f04));if(_0x1c89eb)_0x1c89eb[_0x4634c2(0x128)]();}async function saveEditedOfflineMessage(_0x3a0816){const _0x790fa6=_0x2cf6d4,_0x35f79e=document[_0x790fa6(0x566)]('edit-offline-message-content'),_0x1d9cd4=_0x35f79e['value']['trim']();if(!_0x1d9cd4){showToast('消息内容不能为空',_0x790fa6(0x13bb));return;}const _0x50d8ca=offlineMessages[_0x790fa6(0x1aeb)](_0x39ff73=>_0x39ff73['id']===_0x3a0816);if(_0x50d8ca){console[_0x790fa6(0xc0d)]('✏️\x20编辑线下模式消息:',_0x3a0816,'新内容:',_0x1d9cd4);const _0x42a407=currentChatCharacter['id'];try{const _0x2118d5=await db[_0x790fa6(0x464)]['where'](_0x790fa6(0x10df))[_0x790fa6(0x14a)](_0x42a407)[_0x790fa6(0x18c6)]();console['log'](_0x790fa6(0x1fa0),_0x2118d5[_0x790fa6(0x136)](-0x5));let _0x57b1dc=await db[_0x790fa6(0x464)]['where'](_0x790fa6(0x10df))[_0x790fa6(0x14a)](_0x42a407)[_0x790fa6(0x1534)](_0x438a12=>_0x438a12[_0x790fa6(0x1110)]&&_0x438a12[_0x790fa6(0x1110)]['isOfflineMode']&&_0x438a12[_0x790fa6(0xc48)]===_0x3a0816)['first']();if(!_0x57b1dc){const _0x51349f=new Date(_0x50d8ca['timestamp'])[_0x790fa6(0xa57)]();_0x57b1dc=await db['chatMessages'][_0x790fa6(0x4a6)](_0x790fa6(0x10df))[_0x790fa6(0x14a)](_0x42a407)['and'](_0x4ea807=>_0x4ea807[_0x790fa6(0x1110)]&&_0x4ea807['messageData'][_0x790fa6(0x14ad)]&&Math[_0x790fa6(0x2424)](_0x4ea807[_0x790fa6(0x1110)][_0x790fa6(0x7aa)]-_0x51349f)<0x1388)[_0x790fa6(0x2200)]();}_0x57b1dc?(_0x57b1dc['messageData']['content']=_0x1d9cd4,await db[_0x790fa6(0x464)]['put'](_0x57b1dc),console[_0x790fa6(0xc0d)]('✅\x20[高效线下消息编辑]\x20消息已直接更新到数据库')):console['log']('⚠️\x20数据库中未找到消息，直接更新内存并保存');if(chatMessages[_0x42a407]){const _0xbfd124=new Date(_0x50d8ca['timestamp'])[_0x790fa6(0xa57)]();chatMessages[_0x42a407][_0x790fa6(0x900)](_0x266d98=>{const _0x575911=_0x790fa6;_0x266d98[_0x575911(0x14ad)]&&(_0x266d98['sender']===_0x575911(0xfda)&&_0x50d8ca[_0x575911(0xf75)]==='user'||_0x266d98[_0x575911(0xf75)]===_0x575911(0x232)&&_0x50d8ca[_0x575911(0xf75)]==='ai')&&Math[_0x575911(0x2424)](_0x266d98['timestamp']-_0xbfd124)<0x1388&&(_0x266d98['content']=_0x1d9cd4);}),!_0x57b1dc&&(await saveChatMessagesImmediate(),console['log'](_0x790fa6(0x23ad)));}}catch(_0x1120ee){console[_0x790fa6(0x24ab)]('线下消息编辑失败:',_0x1120ee);}const _0x1c6b25=offlineHistoryMessages['some'](_0x56cf13=>_0x56cf13['id']===_0x3a0816),_0x5a2b2e=offlineCurrentMessages[_0x790fa6(0x184b)](_0x575a92=>_0x575a92['id']===_0x3a0816);if(_0x1c6b25){const _0xcea9a3=offlineHistoryMessages[_0x790fa6(0x1aeb)](_0x2c5da2=>_0x2c5da2['id']===_0x3a0816);_0xcea9a3&&(_0xcea9a3['content']=_0x1d9cd4);}else{if(_0x5a2b2e){const _0x1a60aa=offlineCurrentMessages[_0x790fa6(0x1aeb)](_0x26ec2c=>_0x26ec2c['id']===_0x3a0816);_0x1a60aa&&(_0x1a60aa[_0x790fa6(0x1423)]=_0x1d9cd4);}}offlineMessages=[...offlineHistoryMessages,...offlineCurrentMessages],saveOfflineMessages();if(chatMessages[_0x42a407])try{await saveChatMessagesImmediate(),console['log']('✅\x20[线下消息编辑]\x20记忆数据已保存到数据库');}catch(_0x27a8dc){console[_0x790fa6(0x24ab)](_0x790fa6(0xe94),_0x27a8dc);}renderOfflineMessages(),showToast(_0x790fa6(0xa86),'success');}const _0x4ac2dc=document[_0x790fa6(0x15b8)](_0x790fa6(0x1aaf));if(_0x4ac2dc)_0x4ac2dc['remove']();}async function regenerateOfflineMessage(_0x319c21){const _0x4c82d2=_0x2cf6d4,_0x112699=offlineMessages[_0x4c82d2(0x23ba)](_0x25f963=>_0x25f963['id']===_0x319c21);if(_0x112699===-0x1)return;const _0x1a638c=offlineMessages[_0x112699];if(_0x1a638c[_0x4c82d2(0xf75)]!=='ai')return;console[_0x4c82d2(0xc0d)]('🔄\x20[线下重新生成]\x20开始重新生成AI回复:',_0x319c21);let _0x291348=![];for(let _0x530718=_0x112699+0x1;_0x530718<offlineMessages[_0x4c82d2(0xcbf)];_0x530718++){if(offlineMessages[_0x530718][_0x4c82d2(0xf75)]===_0x4c82d2(0x23b2)){_0x291348=!![];break;}}let _0x563fd1=![];_0x112699>0x0&&offlineMessages[_0x112699-0x1][_0x4c82d2(0xf75)]==='ai'&&(_0x563fd1=!![]);const _0x4e4acc=!_0x291348&&_0x563fd1;let _0x28ff15=-0x1,_0x2e3703=null;if(!_0x4e4acc){_0x28ff15=_0x112699-0x1;while(_0x28ff15>=0x0&&offlineMessages[_0x28ff15]['sender']!==_0x4c82d2(0x23b2)){_0x28ff15--;}if(_0x28ff15<0x0){showToast(_0x4c82d2(0x93d),_0x4c82d2(0x24ab));return;}_0x2e3703=offlineMessages[_0x28ff15];}console[_0x4c82d2(0xc0d)](_0x4c82d2(0x1b72),{'messageId':_0x319c21,'isContinuationMessage':_0x4e4acc,'hasUserMessageAfter':_0x291348,'isPreviousMessageAlsoAI':_0x563fd1,'userMessageIndex':_0x28ff15}),console[_0x4c82d2(0xc0d)](_0x4c82d2(0x1ba8));const _0x5e6936=document[_0x4c82d2(0x15b8)]('[data-message-id=\x22'+_0x319c21+'\x22]');_0x5e6936&&_0x5e6936[_0x4c82d2(0x128)]();const _0x3ec3b9=currentChatCharacter['id'],_0x55fff3=chatMessages[_0x3ec3b9]||[];console['log'](_0x4c82d2(0xedc),_0x55fff3[_0x4c82d2(0xcbf)]),console[_0x4c82d2(0xc0d)]('🔍\x20[线下重新生成]\x20要删除的消息:',_0x1a638c);let _0x545cca=-0x1;for(let _0xd381af=_0x55fff3[_0x4c82d2(0xcbf)]-0x1;_0xd381af>=0x0;_0xd381af--){if(_0x55fff3[_0xd381af][_0x4c82d2(0x14ad)]&&(_0x55fff3[_0xd381af][_0x4c82d2(0xc48)]===_0x319c21||_0x55fff3[_0xd381af][_0x4c82d2(0x7aa)]===_0x1a638c[_0x4c82d2(0x7aa)]&&_0x55fff3[_0xd381af][_0x4c82d2(0x1423)]===_0x1a638c[_0x4c82d2(0x1423)])){_0x545cca=_0xd381af;break;}}if(_0x545cca!==-0x1){console[_0x4c82d2(0xc0d)]('🔍\x20[线下重新生成]\x20在chatMessages中找到消息，索引:',_0x545cca);const _0x29aca8=_0x55fff3[_0x545cca];try{await deleteRelatedTimelineEvents(_0x29aca8),console[_0x4c82d2(0xc0d)](_0x4c82d2(0xfc1));}catch(_0x25674d){console[_0x4c82d2(0x24ab)](_0x4c82d2(0xce7),_0x25674d);}chatMessages[_0x3ec3b9][_0x4c82d2(0x220f)](_0x545cca,0x1),console['log'](_0x4c82d2(0x24ca),chatMessages[_0x3ec3b9][_0x4c82d2(0xcbf)]);try{const _0x541210=await db[_0x4c82d2(0x464)][_0x4c82d2(0x4a6)](_0x4c82d2(0x10df))[_0x4c82d2(0x14a)](_0x3ec3b9)[_0x4c82d2(0x1534)](_0x3b0add=>_0x3b0add[_0x4c82d2(0xc48)]===_0x29aca8['id'])[_0x4c82d2(0x2200)]();_0x541210&&(await db[_0x4c82d2(0x464)]['delete'](_0x541210['id']),console['log'](_0x4c82d2(0xeb4)));}catch(_0x2305f9){console['error'](_0x4c82d2(0x818),_0x2305f9);}}else console[_0x4c82d2(0x17cc)](_0x4c82d2(0x1af5));await deleteOfflineMessageInternal(_0x319c21),showOfflineLoadingMessage();try{let _0x281ba1;if(_0x4e4acc)console[_0x4c82d2(0xc0d)](_0x4c82d2(0x1b30)),_0x281ba1=await generateOfflineContinuation();else{console[_0x4c82d2(0xc0d)](_0x4c82d2(0x17c4));if(_0x2e3703)_0x281ba1=await generateOfflineResponse(_0x2e3703[_0x4c82d2(0x1423)]);else{showToast(_0x4c82d2(0x13e7),_0x4c82d2(0x24ab)),hideOfflineLoadingMessage();return;}}const _0x26654b={'id':Date['now']()[_0x4c82d2(0x9a3)](),'sender':'ai','content':_0x281ba1,'timestamp':new Date()[_0x4c82d2(0xa4b)]()};offlineCurrentMessages['push'](_0x26654b),offlineMessages=[...offlineHistoryMessages,...offlineCurrentMessages];const _0x92a1ea={'id':Date[_0x4c82d2(0x18e0)]()+0x1,'sender':'received','content':_0x281ba1,'timestamp':Date[_0x4c82d2(0x18e0)]()+0x1,'type':'text','isOfflineMode':!![]},_0x34964b=currentChatCharacter['id'];!chatMessages[_0x34964b]&&(chatMessages[_0x34964b]=[]);chatMessages[_0x34964b][_0x4c82d2(0x6ee)](_0x92a1ea);try{const _0x477136=_0x34964b+_0x4c82d2(0x457)+_0x92a1ea[_0x4c82d2(0x7aa)]+'_'+Math[_0x4c82d2(0x191c)]()[_0x4c82d2(0x9a3)](0x24)[_0x4c82d2(0x18cf)](0x2,0x9)+'_'+(chatMessages[_0x34964b][_0x4c82d2(0xcbf)]-0x1);await db[_0x4c82d2(0x464)][_0x4c82d2(0xe1)]({'id':_0x477136,'characterId':_0x34964b,'timestamp':_0x92a1ea[_0x4c82d2(0x7aa)],'messageOrder':chatMessages[_0x34964b]['length']-0x1,'originalMessageId':_0x92a1ea['id'],'messageData':_0x92a1ea}),console[_0x4c82d2(0xc0d)](_0x4c82d2(0xfd8));}catch(_0x4a577f){console[_0x4c82d2(0x24ab)]('重新生成消息保存失败:',_0x4a577f);}hideOfflineLoadingMessage(),renderOfflineMessages(),saveOfflineMessages(),scrollOfflineMessagesToBottom(),showToast('AI回复已重新生成',_0x4c82d2(0xb27)),console['log'](_0x4c82d2(0x24ad));}catch(_0x1ce037){console[_0x4c82d2(0x24ab)](_0x4c82d2(0x10d1),_0x1ce037),hideOfflineLoadingMessage(),showToast(_0x4c82d2(0x141c),_0x4c82d2(0x24ab));}}async function deleteOfflineMessageInternal(_0x4f6747){const _0x270cce=_0x2cf6d4,_0x106382=offlineMessages['findIndex'](_0xe5480=>_0xe5480['id']===_0x4f6747);if(_0x106382===-0x1)return;const _0x5de271=offlineMessages[_0x106382],_0x27a5a6=currentChatCharacter['id'];console['log'](_0x270cce(0x1dbc),_0x4f6747,'类型:',_0x5de271[_0x270cce(0xf75)]);const _0x586de3=offlineHistoryMessages[_0x270cce(0x184b)](_0x14de1a=>_0x14de1a['id']===_0x4f6747),_0x4d922c=offlineCurrentMessages['some'](_0x1783f7=>_0x1783f7['id']===_0x4f6747);if(chatMessages[_0x27a5a6]){const _0x144b09=[];console[_0x270cce(0xc0d)](_0x270cce(0x1eb2),_0x4f6747,_0x270cce(0x2186),_0x5de271['content']['substring'](0x0,0x32)),chatMessages[_0x27a5a6][_0x270cce(0x900)]((_0x32cad8,_0x1b3b43)=>{const _0x3d0329=_0x270cce;if(_0x32cad8[_0x3d0329(0x14ad)]){const _0x11b224=new Date(_0x5de271[_0x3d0329(0x7aa)])[_0x3d0329(0xa57)](),_0x550b08=_0x5de271[_0x3d0329(0x1423)],_0x556591=_0x32cad8[_0x3d0329(0xc48)]===_0x4f6747||_0x32cad8['id']===_0x4f6747||_0x32cad8['id'][_0x3d0329(0x9a3)]()===_0x4f6747,_0x2174d6=Math['abs'](_0x32cad8['timestamp']-_0x11b224)<0x7d0&&_0x32cad8['content']===_0x550b08,_0x29e86e=Math[_0x3d0329(0x2424)](_0x32cad8['timestamp']-_0x11b224)<0x3e8&&(_0x32cad8[_0x3d0329(0xf75)]==='sent'&&_0x5de271[_0x3d0329(0xf75)]===_0x3d0329(0x23b2)||_0x32cad8[_0x3d0329(0xf75)]===_0x3d0329(0x232)&&_0x5de271[_0x3d0329(0xf75)]==='ai'),_0x45dae1=_0x5de271[_0x3d0329(0x10eb)]&&_0x32cad8['content'][_0x3d0329(0x23ec)](_0x550b08[_0x3d0329(0x4b2)](0x0,0x1e)),_0x5f01e6=_0x556591||_0x2174d6||_0x29e86e||_0x45dae1;_0x5f01e6&&(console[_0x3d0329(0xc0d)](_0x3d0329(0x130c),{'index':_0x1b3b43,'msgId':_0x32cad8['id'],'originalMessageId':_0x32cad8[_0x3d0329(0xc48)],'timestamp':_0x32cad8[_0x3d0329(0x7aa)],'content':_0x32cad8[_0x3d0329(0x1423)][_0x3d0329(0x4b2)](0x0,0x32)}),_0x144b09[_0x3d0329(0x6ee)](_0x1b3b43));}}),_0x144b09[_0x270cce(0x2253)]()[_0x270cce(0x900)](_0x284d7f=>{const _0x3b629c=_0x270cce;console['log'](_0x3b629c(0x1145),_0x284d7f),chatMessages[_0x27a5a6][_0x3b629c(0x220f)](_0x284d7f,0x1);}),console[_0x270cce(0xc0d)](_0x270cce(0x1919),_0x144b09[_0x270cce(0xcbf)],_0x270cce(0x2418));}if(_0x586de3){const _0x5d1318=offlineHistoryMessages[_0x270cce(0x23ba)](_0x31031a=>_0x31031a['id']===_0x4f6747);_0x5d1318!==-0x1&&offlineHistoryMessages[_0x270cce(0x220f)](_0x5d1318,0x1);}if(_0x4d922c){const _0x43b757=offlineCurrentMessages[_0x270cce(0x23ba)](_0x5c396c=>_0x5c396c['id']===_0x4f6747);_0x43b757!==-0x1&&offlineCurrentMessages[_0x270cce(0x220f)](_0x43b757,0x1);}offlineMessages=[...offlineHistoryMessages,...offlineCurrentMessages],saveOfflineMessages();try{const _0x1fd3a0='offlineMessages_'+_0x27a5a6+'_'+windowId,_0x3ed80a=localStorage[_0x270cce(0x2250)](_0x1fd3a0);if(_0x3ed80a){const _0x339d32=JSON[_0x270cce(0x168e)](_0x3ed80a);_0x339d32[_0x270cce(0x1359)]&&(_0x339d32[_0x270cce(0x1359)]=_0x339d32[_0x270cce(0x1359)][_0x270cce(0x803)](_0x284bcb=>_0x284bcb['id']!==_0x4f6747),localStorage[_0x270cce(0x2055)](_0x1fd3a0,JSON[_0x270cce(0x7fb)](_0x339d32)),console[_0x270cce(0xc0d)](_0x270cce(0x2163),_0x4f6747));}}catch(_0x3b80df){console[_0x270cce(0x17cc)](_0x270cce(0x1c28),_0x3b80df);}try{const _0x40cd2d=new Date(_0x5de271[_0x270cce(0x7aa)])['getTime'](),_0x3a3a3b=_0x5de271[_0x270cce(0x1423)],_0x466032=[],_0x42dfc9=await db[_0x270cce(0x464)][_0x270cce(0x4a6)](_0x270cce(0x10df))[_0x270cce(0x14a)](_0x27a5a6)['and'](_0x33f904=>_0x33f904[_0x270cce(0xc48)]===_0x4f6747)[_0x270cce(0x18c6)]();_0x466032[_0x270cce(0x6ee)](..._0x42dfc9);const _0x13de18=await db[_0x270cce(0x464)][_0x270cce(0x4a6)](_0x270cce(0x10df))[_0x270cce(0x14a)](_0x27a5a6)[_0x270cce(0x1534)](_0x3ba215=>_0x3ba215['messageData']&&_0x3ba215[_0x270cce(0x1110)]['id']===_0x4f6747)['toArray']();_0x466032['push'](..._0x13de18);const _0x46771d=await db['chatMessages'][_0x270cce(0x4a6)](_0x270cce(0x10df))['equals'](_0x27a5a6)[_0x270cce(0x1534)](_0x5cf8b2=>_0x5cf8b2[_0x270cce(0x1110)]&&_0x5cf8b2[_0x270cce(0x1110)][_0x270cce(0x14ad)]&&Math[_0x270cce(0x2424)](_0x5cf8b2['messageData'][_0x270cce(0x7aa)]-_0x40cd2d)<0x7d0&&_0x5cf8b2['messageData'][_0x270cce(0x1423)]===_0x3a3a3b)[_0x270cce(0x18c6)]();_0x466032[_0x270cce(0x6ee)](..._0x46771d);const _0x290bee=_0x466032[_0x270cce(0x803)]((_0x116bb9,_0x47381b,_0x1097f4)=>_0x47381b===_0x1097f4[_0x270cce(0x23ba)](_0x2cc25d=>_0x2cc25d['id']===_0x116bb9['id']));_0x290bee[_0x270cce(0xcbf)]>0x0?(await db[_0x270cce(0x464)][_0x270cce(0xf71)](_0x290bee[_0x270cce(0xf6d)](_0x4a821c=>_0x4a821c['id'])),console['log'](_0x270cce(0x1d03)+_0x290bee[_0x270cce(0xcbf)]+_0x270cce(0x125d))):console[_0x270cce(0xc0d)](_0x270cce(0x254a));}catch(_0x54564c){console[_0x270cce(0x24ab)](_0x270cce(0x32a),_0x54564c);}}async function deleteOfflineMessage(_0x2f13e2){const _0x505b43=_0x2cf6d4,_0x21a0dc=offlineMessages[_0x505b43(0x23ba)](_0xfa5120=>_0xfa5120['id']===_0x2f13e2);if(_0x21a0dc===-0x1)return;const _0x3a8d4b=offlineMessages[_0x21a0dc],_0x4fb617=offlineHistoryMessages['some'](_0xfe9038=>_0xfe9038['id']===_0x2f13e2),_0x4e0163=offlineCurrentMessages[_0x505b43(0x184b)](_0x30730f=>_0x30730f['id']===_0x2f13e2),_0x5b246f=_0x3a8d4b[_0x505b43(0xf75)]===_0x505b43(0x23b2)?_0x505b43(0x12a6):_0x505b43(0x14e);if(confirm(_0x5b246f)){console[_0x505b43(0xc0d)](_0x505b43(0x129),_0x2f13e2,_0x505b43(0x8a2),_0x3a8d4b[_0x505b43(0xf75)]);const _0x569f47=currentChatCharacter['id'];if(chatMessages[_0x569f47]){const _0x34c76e=offlineMessages[_0x21a0dc],_0x56d3a3=new Date(_0x34c76e['timestamp'])[_0x505b43(0xa57)](),_0x24fd0a=_0x34c76e[_0x505b43(0x1423)],_0x3dd533=[];chatMessages[_0x569f47][_0x505b43(0x900)]((_0x57e976,_0xb86d1f)=>{const _0x452e85=_0x505b43,_0x1c1091=_0x57e976[_0x452e85(0xc48)]===_0x2f13e2||_0x57e976['id']===_0x2f13e2,_0x397418=_0x57e976[_0x452e85(0x14ad)]&&Math[_0x452e85(0x2424)](_0x57e976['timestamp']-_0x56d3a3)<0x7d0&&_0x57e976[_0x452e85(0x1423)]===_0x24fd0a,_0x4e8000=_0x57e976[_0x452e85(0x14ad)]&&Math[_0x452e85(0x2424)](_0x57e976[_0x452e85(0x7aa)]-_0x56d3a3)<0x3e8&&(_0x57e976[_0x452e85(0xf75)]===_0x452e85(0xfda)&&_0x3a8d4b['sender']===_0x452e85(0x23b2)||_0x57e976[_0x452e85(0xf75)]===_0x452e85(0x232)&&_0x3a8d4b['sender']==='ai');(_0x1c1091||_0x397418||_0x4e8000)&&(_0x3dd533[_0x452e85(0x6ee)](_0xb86d1f),console[_0x452e85(0xc0d)](_0x452e85(0xb82),{'index':_0xb86d1f,'msgId':_0x57e976['id'],'originalId':_0x57e976[_0x452e85(0xc48)],'timestamp':_0x57e976['timestamp'],'content':_0x57e976['content'][_0x452e85(0x4b2)](0x0,0x32)+'...'}));}),_0x3dd533[_0x505b43(0x2253)]()[_0x505b43(0x900)](_0x463e2b=>{const _0x340902=_0x505b43;console[_0x340902(0xc0d)]('🗑️\x20删除记忆数据:',chatMessages[_0x569f47][_0x463e2b]),chatMessages[_0x569f47][_0x340902(0x220f)](_0x463e2b,0x1);});try{const _0x24d8e5=[],_0x483516=await db[_0x505b43(0x464)]['where'](_0x505b43(0x10df))[_0x505b43(0x14a)](_0x569f47)['and'](_0x135f8f=>_0x135f8f[_0x505b43(0xc48)]===_0x2f13e2)[_0x505b43(0x18c6)]();_0x24d8e5[_0x505b43(0x6ee)](..._0x483516);const _0x30ea0a=await db[_0x505b43(0x464)]['where']('characterId')[_0x505b43(0x14a)](_0x569f47)[_0x505b43(0x1534)](_0x5b7883=>_0x5b7883[_0x505b43(0x1110)]&&_0x5b7883[_0x505b43(0x1110)]['id']===_0x2f13e2)['toArray']();_0x24d8e5['push'](..._0x30ea0a);const _0x414623=await db[_0x505b43(0x464)][_0x505b43(0x4a6)](_0x505b43(0x10df))[_0x505b43(0x14a)](_0x569f47)[_0x505b43(0x1534)](_0x3e60ef=>_0x3e60ef[_0x505b43(0x1110)]&&_0x3e60ef[_0x505b43(0x1110)][_0x505b43(0x14ad)]&&Math['abs'](_0x3e60ef[_0x505b43(0x1110)]['timestamp']-_0x56d3a3)<0x7d0&&_0x3e60ef['messageData'][_0x505b43(0x1423)]===_0x24fd0a)['toArray']();_0x24d8e5[_0x505b43(0x6ee)](..._0x414623);const _0xf240c1=_0x24d8e5[_0x505b43(0x803)]((_0x55b653,_0x14806f,_0x370f40)=>_0x14806f===_0x370f40['findIndex'](_0x36c625=>_0x36c625['id']===_0x55b653['id']));_0xf240c1[_0x505b43(0xcbf)]>0x0?(await db[_0x505b43(0x464)][_0x505b43(0xf71)](_0xf240c1[_0x505b43(0xf6d)](_0x4ed34c=>_0x4ed34c['id'])),console['log'](_0x505b43(0x2436)+_0xf240c1[_0x505b43(0xcbf)]+_0x505b43(0x125d)),_0xf240c1['forEach'](_0x4f2d37=>{const _0x24999d=_0x505b43;console[_0x24999d(0xc0d)](_0x24999d(0xa5d),{'id':_0x4f2d37['id'],'originalId':_0x4f2d37['originalMessageId'],'timestamp':_0x4f2d37[_0x24999d(0x1110)]?.[_0x24999d(0x7aa)],'content':_0x4f2d37[_0x24999d(0x1110)]?.['content']?.[_0x24999d(0x4b2)](0x0,0x32)+_0x24999d(0x12da)});})):console[_0x505b43(0xc0d)]('⚠️\x20[线下消息删除]\x20数据库中未找到对应记录');}catch(_0x1245f4){console['error'](_0x505b43(0x13ba),_0x1245f4);}}if(_0x4fb617){const _0x51e5a4=offlineHistoryMessages[_0x505b43(0x23ba)](_0xc012b2=>_0xc012b2['id']===_0x2f13e2);if(_0x51e5a4!==-0x1){console[_0x505b43(0xc0d)](_0x505b43(0xacc),offlineHistoryMessages[_0x51e5a4]),offlineHistoryMessages[_0x505b43(0x220f)](_0x51e5a4,0x1);try{let _0x3f66d7=await db[_0x505b43(0x464)][_0x505b43(0x4a6)](_0x505b43(0x10df))[_0x505b43(0x14a)](_0x569f47)[_0x505b43(0x1534)](_0x585d6a=>_0x585d6a[_0x505b43(0x1110)]&&_0x585d6a[_0x505b43(0x1110)][_0x505b43(0x14ad)]&&_0x585d6a[_0x505b43(0xc48)]===_0x2f13e2)[_0x505b43(0x2200)]();if(!_0x3f66d7){const _0x2b74a0=new Date(_0x3a8d4b[_0x505b43(0x7aa)])[_0x505b43(0xa57)]();_0x3f66d7=await db[_0x505b43(0x464)][_0x505b43(0x4a6)](_0x505b43(0x10df))[_0x505b43(0x14a)](_0x569f47)[_0x505b43(0x1534)](_0x20d7d0=>_0x20d7d0[_0x505b43(0x1110)]&&_0x20d7d0[_0x505b43(0x1110)][_0x505b43(0x14ad)]&&Math[_0x505b43(0x2424)](_0x20d7d0['messageData'][_0x505b43(0x7aa)]-_0x2b74a0)<0x1388)[_0x505b43(0x2200)]();}_0x3f66d7?(await db[_0x505b43(0x464)]['delete'](_0x3f66d7['id']),console[_0x505b43(0xc0d)]('✅\x20[高效线下消息删除]\x20消息已从数据库删除')):console[_0x505b43(0xc0d)](_0x505b43(0x22ff));if(chatMessages[_0x569f47]){const _0x4747d8=new Date(_0x3a8d4b['timestamp'])['getTime'](),_0x1bde10=[];chatMessages[_0x569f47][_0x505b43(0x900)]((_0x444d39,_0x1eb66c)=>{const _0x4b26d9=_0x505b43;_0x444d39[_0x4b26d9(0x14ad)]&&(_0x444d39[_0x4b26d9(0xc48)]===_0x2f13e2||Math[_0x4b26d9(0x2424)](_0x444d39[_0x4b26d9(0x7aa)]-_0x4747d8)<0x3e8&&_0x444d39[_0x4b26d9(0x1423)]===_0x3a8d4b['content'])&&_0x1bde10[_0x4b26d9(0x6ee)](_0x1eb66c);}),_0x1bde10[_0x505b43(0x2253)]()[_0x505b43(0x900)](_0x1f57cb=>{chatMessages[_0x569f47]['splice'](_0x1f57cb,0x1);}),!_0x3f66d7&&console[_0x505b43(0xc0d)]('✅\x20[高效线下消息删除]\x20消息仅存在于内存中，已删除');}}catch(_0x1148da){console[_0x505b43(0x24ab)](_0x505b43(0x1a51),_0x1148da);}console[_0x505b43(0xc0d)](_0x505b43(0x390)),offlineMessages=[...offlineHistoryMessages,...offlineCurrentMessages],showToast(_0x505b43(0x138d),'success');}}else{if(_0x4e0163){const _0xd8e881=offlineCurrentMessages['findIndex'](_0x3373dd=>_0x3373dd['id']===_0x2f13e2);if(_0xd8e881!==-0x1){if(_0x3a8d4b[_0x505b43(0xf75)]===_0x505b43(0x23b2)){offlineCurrentMessages[_0x505b43(0x220f)](_0xd8e881,0x1);if(_0xd8e881<offlineCurrentMessages['length']&&offlineCurrentMessages[_0xd8e881][_0x505b43(0xf75)]==='ai'){const _0x3d14b6=offlineCurrentMessages[_0xd8e881],_0x1a803d=new Date(_0x3d14b6['timestamp'])[_0x505b43(0xa57)](),_0x411641=[];chatMessages[_0x569f47]['forEach']((_0x3af55f,_0x31cae0)=>{const _0x59cfea=_0x505b43;_0x3af55f['isOfflineMode']&&_0x3af55f[_0x59cfea(0xf75)]===_0x59cfea(0x232)&&(_0x3af55f[_0x59cfea(0xc48)]===_0x3d14b6['id']||Math['abs'](_0x3af55f[_0x59cfea(0x7aa)]-_0x1a803d)<0x3e8&&_0x3af55f[_0x59cfea(0x1423)]===_0x3d14b6['content'])&&_0x411641[_0x59cfea(0x6ee)](_0x31cae0);}),_0x411641[_0x505b43(0x2253)]()['forEach'](_0x4631d1=>{const _0x3c9fbc=_0x505b43;console['log'](_0x3c9fbc(0x686),chatMessages[_0x569f47][_0x4631d1]),chatMessages[_0x569f47][_0x3c9fbc(0x220f)](_0x4631d1,0x1);}),offlineCurrentMessages[_0x505b43(0x220f)](_0xd8e881,0x1);}}else offlineCurrentMessages[_0x505b43(0x220f)](_0xd8e881,0x1);offlineMessages=[...offlineHistoryMessages,...offlineCurrentMessages];}}}saveOfflineMessages();try{const _0x19b1d4='offlineMessages_'+_0x569f47+'_'+windowId,_0x28c84d=localStorage[_0x505b43(0x2250)](_0x19b1d4);if(_0x28c84d){const _0x339253=JSON[_0x505b43(0x168e)](_0x28c84d);_0x339253[_0x505b43(0x1359)]&&(_0x339253[_0x505b43(0x1359)]=_0x339253[_0x505b43(0x1359)][_0x505b43(0x803)](_0x30a91a=>_0x30a91a['id']!==_0x2f13e2),localStorage[_0x505b43(0x2055)](_0x19b1d4,JSON[_0x505b43(0x7fb)](_0x339253)),console['log'](_0x505b43(0x1546),_0x2f13e2));}}catch(_0x2a312b){console[_0x505b43(0x17cc)](_0x505b43(0x1c28),_0x2a312b);}try{const _0x272a82=await db[_0x505b43(0x464)]['where'](_0x505b43(0x10df))[_0x505b43(0x14a)](_0x569f47)[_0x505b43(0x1534)](_0x3eddcf=>_0x3eddcf[_0x505b43(0x1110)]&&(_0x3eddcf[_0x505b43(0xc48)]===_0x2f13e2||_0x3eddcf[_0x505b43(0x1110)][_0x505b43(0x7aa)]===_0x3a8d4b[_0x505b43(0x7aa)]&&_0x3eddcf['messageData'][_0x505b43(0x1423)]===_0x3a8d4b[_0x505b43(0x1423)]))[_0x505b43(0x18c6)]();_0x272a82['length']>0x0?(await db['chatMessages'][_0x505b43(0xf71)](_0x272a82['map'](_0x463abb=>_0x463abb['id'])),console[_0x505b43(0xc0d)](_0x505b43(0x2436)+_0x272a82[_0x505b43(0xcbf)]+'\x20条记录')):console[_0x505b43(0xc0d)](_0x505b43(0x255));}catch(_0xf36537){console['error'](_0x505b43(0x13ba),_0xf36537);}renderOfflineMessages(),showToast(_0x505b43(0x212f),_0x505b43(0xb27));}const _0x24ab73=document[_0x505b43(0x15b8)]('.offline-message-menu');if(_0x24ab73)_0x24ab73[_0x505b43(0x128)]();}function showOfflineLoadingMessage(){const _0xe0b8ad=_0x2cf6d4,_0x259fc3=document[_0xe0b8ad(0x566)](_0xe0b8ad(0x1697)),_0x45c735=_0x259fc3[_0xe0b8ad(0x15b8)](_0xe0b8ad(0x20a3));_0x45c735&&_0x45c735[_0xe0b8ad(0x128)]();const _0x56bc4d=document['createElement']('div');_0x56bc4d[_0xe0b8ad(0x221)]=_0xe0b8ad(0xef3),_0x56bc4d['id']='offline-loading-indicator';const _0x2ded8a=document[_0xe0b8ad(0x1ad8)](_0xe0b8ad(0x526));_0x2ded8a[_0xe0b8ad(0x221)]=_0xe0b8ad(0x1109);const _0x430524=document[_0xe0b8ad(0x1ad8)](_0xe0b8ad(0x526));_0x430524[_0xe0b8ad(0x221)]='offline-loading-dots';for(let _0x4b2dfc=0x0;_0x4b2dfc<0x3;_0x4b2dfc++){const _0x44318e=document[_0xe0b8ad(0x1ad8)]('div');_0x44318e[_0xe0b8ad(0x221)]=_0xe0b8ad(0x24f2),_0x430524[_0xe0b8ad(0x1925)](_0x44318e);}_0x2ded8a['appendChild'](_0x430524),_0x56bc4d[_0xe0b8ad(0x1925)](_0x2ded8a),_0x259fc3[_0xe0b8ad(0x1925)](_0x56bc4d),_0x259fc3['scrollTop']=_0x259fc3[_0xe0b8ad(0x14c8)];}function hideOfflineLoadingMessage(){const _0x5dede2=_0x2cf6d4,_0x20f543=document[_0x5dede2(0x566)](_0x5dede2(0x1e10));_0x20f543&&_0x20f543[_0x5dede2(0x128)]();}async function continueOfflineStory(){const _0x55747e=_0x2cf6d4;if(!currentChatCharacter){showToast(_0x55747e(0x1268),_0x55747e(0x13bb));return;}if(offlineMessages['length']===0x0){showToast('请先开始对话再使用续写功能',_0x55747e(0x13bb));return;}const _0x238ce4=document[_0x55747e(0x15b8)](_0x55747e(0x1acd));_0x238ce4&&(_0x238ce4['disabled']=!![],_0x238ce4[_0x55747e(0xc02)]='<i\x20class=\x22fas\x20fa-spinner\x20fa-spin\x22></i>\x20<span>续写中</span>');try{showOfflineLoadingMessage();const _0x2a7846=await generateOfflineContinuation();if(_0x2a7846&&_0x2a7846['trim']()){const _0x106836=currentChatCharacter['id'];!chatMessages[_0x106836]&&(chatMessages[_0x106836]=[]);const _0x125aa7={'id':Date[_0x55747e(0x18e0)](),'sender':_0x55747e(0x232),'content':_0x2a7846,'timestamp':Date[_0x55747e(0x18e0)](),'type':_0x55747e(0x1e58),'isOfflineMode':!![]};chatMessages[_0x106836][_0x55747e(0x6ee)](_0x125aa7);try{const _0x5359ac=_0x106836+_0x55747e(0x1d87)+_0x125aa7[_0x55747e(0x7aa)]+'_'+Math[_0x55747e(0x191c)]()[_0x55747e(0x9a3)](0x24)['substr'](0x2,0x9)+'_'+(chatMessages[_0x106836]['length']-0x1);await db[_0x55747e(0x464)][_0x55747e(0xe1)]({'id':_0x5359ac,'characterId':_0x106836,'timestamp':_0x125aa7['timestamp'],'messageOrder':chatMessages[_0x106836][_0x55747e(0xcbf)]-0x1,'originalMessageId':_0x125aa7['id'],'messageData':_0x125aa7}),console[_0x55747e(0xc0d)](_0x55747e(0x113e),_0x125aa7['id']);}catch(_0x53905d){console[_0x55747e(0x24ab)]('续写消息保存失败，回退到防抖保存:',_0x53905d),await saveChatMessagesImmediate([_0x106836]);}const _0x2079d3={'id':_0x125aa7['id'][_0x55747e(0x9a3)](),'sender':'ai','content':_0x2a7846,'timestamp':new Date(_0x125aa7[_0x55747e(0x7aa)])['toISOString']()};offlineCurrentMessages['push'](_0x2079d3),offlineMessages=[...offlineHistoryMessages,...offlineCurrentMessages],hideOfflineLoadingMessage(),setTimeout(()=>{renderOfflineMessages(),saveOfflineMessages(),scrollOfflineMessagesToBottom();},0xa);}else throw new Error('续写内容为空');}catch(_0xa83b8c){console['error'](_0x55747e(0x2258),_0xa83b8c),hideOfflineLoadingMessage(),showToast('续写失败，请稍后重试',_0x55747e(0x24ab));}finally{_0x238ce4&&(_0x238ce4[_0x55747e(0x194e)]=![],_0x238ce4[_0x55747e(0xc02)]=_0x55747e(0x21b8));}}function showLoadingModal(_0x3ca35a,_0x38f1f4){const _0xa495e8=_0x2cf6d4,_0x25db5b=_0xa495e8(0x97d)+Date[_0xa495e8(0x18e0)](),_0x561cf4=_0xa495e8(0x1c25)+_0x25db5b+'\x22\x20class=\x22waiting-modal\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22waiting-modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22waiting-spinner\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22waiting-text\x22>'+_0x3ca35a+_0xa495e8(0x15dc)+(_0x38f1f4?_0xa495e8(0x284)+_0x38f1f4+_0xa495e8(0x12f8):'')+_0xa495e8(0x1c40);return document[_0xa495e8(0x172c)][_0xa495e8(0x22ba)](_0xa495e8(0x580),_0x561cf4),_0x25db5b;}function hideLoadingModal(_0x591649){const _0x2e37fa=_0x2cf6d4,_0x492183=document[_0x2e37fa(0x566)](_0x591649);_0x492183&&_0x492183[_0x2e37fa(0x128)]();}async function generateOfflineContinuation(){const _0x12e092=_0x2cf6d4,_0x5b58e5=currentChatCharacter;console[_0x12e092(0xc0d)](_0x12e092(0x10be)),console[_0x12e092(0xc0d)]('✍️\x20当前角色:',_0x5b58e5['name']);let _0xe24c81='你现在处于线下剧情模式，需要以纯文本形式回复，不要使用JSON格式。\x0a\x0a【重要提示】用户消息中的括号()内容是环境描写、动作描写或心理活动，你可以观察到这些信息作为背景，但不能表现得像是\x22听到\x22了用户的内心想法。你只能对括号外的实际话语进行回应，可以通过观察用户的可见行为（如犹豫、停顿等）来推测情况，但不能直接回应用户的内心想法。\x0a\x0a';const _0xeaa8d0=getCurrentChatSettings();console[_0x12e092(0xc0d)](_0x12e092(0x1489),_0xeaa8d0);let _0x16bfac='';const _0x5729aa=_0xeaa8d0[_0x12e092(0x1de6)]!==![];console[_0x12e092(0xc0d)](_0x12e092(0xf14),_0x5729aa);if(_0x5729aa)try{const _0x5e0c36=await getVisibleMomentsForCharacter(_0x5b58e5['id'],0x5);console[_0x12e092(0xc0d)](_0x12e092(0x16b2),_0x5e0c36['length']),_0x5e0c36[_0x12e092(0xcbf)]>0x0&&(_0x16bfac=_0x12e092(0xe47),_0x5e0c36[_0x12e092(0x900)]((_0x3b693e,_0x4a27de)=>{const _0x31c6fc=_0x12e092,_0x581f54=_0x3b693e[_0x31c6fc(0x3df)]==='user'?'用户':_0x3b693e[_0x31c6fc(0x201a)];let _0x1dd826='';if(_0x3b693e['timestamp']){const _0x580ea6=Date['now'](),_0x5039c8=_0x580ea6-_0x3b693e['timestamp'],_0x5840e7=Math[_0x31c6fc(0x1dac)](_0x5039c8/(0x3e8*0x3c)),_0x301e7f=Math[_0x31c6fc(0x1dac)](_0x5039c8/(0x3e8*0x3c*0x3c)),_0x457a44=Math[_0x31c6fc(0x1dac)](_0x5039c8/(0x3e8*0x3c*0x3c*0x18));if(_0x457a44>0x0)_0x1dd826='\x20('+_0x457a44+_0x31c6fc(0xead);else{if(_0x301e7f>0x0)_0x1dd826='\x20('+_0x301e7f+'小时前)';else _0x5840e7>0x0?_0x1dd826='\x20('+_0x5840e7+'分钟前)':_0x1dd826=_0x31c6fc(0x2085);}}const _0x1c1c1e=_0x4a27de+0x1+'.\x20'+_0x581f54+':\x20'+_0x3b693e[_0x31c6fc(0x1e58)]+_0x1dd826+(_0x3b693e['commentsText']||'');_0x16bfac+=_0x1c1c1e;}));}catch(_0x557f99){console[_0x12e092(0x24ab)](_0x12e092(0x239e),_0x557f99);}let _0xed41d6='';if(_0x5b58e5&&!currentChatCharacter?.[_0x12e092(0x4b7)]){const _0x37acbc=isBlocked(_0x5b58e5['id'],_0x12e092(0x23b2));if(_0x37acbc){const _0x5b43c4=_0x12e092(0x1366)+_0x5b58e5['id'],_0x5e6b85=parseInt(localStorage[_0x12e092(0x2250)](_0x5b43c4)||'0');_0xed41d6=_0x12e092(0x1c84)+(_0x5e6b85>0x0?_0x12e092(0x732)+_0x5e6b85+_0x12e092(0x14c7):_0x12e092(0xfea))+_0x12e092(0x1ada);}}let _0x85490f='';try{const _0x1aa893=getGlobalMemorySettings();console[_0x12e092(0xc0d)](_0x12e092(0x1ba5),_0x1aa893);const _0x4bde4e={'type':'private_chat','id':_0x5b58e5['id']};console[_0x12e092(0xc0d)](_0x12e092(0x117c),_0x4bde4e),console[_0x12e092(0xc0d)]('🧠\x20续写模式：强制启用全局记忆读取...'),_0x85490f=await buildGlobalMemoryContext(_0x5b58e5['id'],_0x4bde4e,_0x1aa893[_0x12e092(0x356)]),console['log'](_0x12e092(0x1759),_0x85490f),_0x85490f&&_0x85490f[_0x12e092(0x1424)]()?(console[_0x12e092(0xc0d)](_0x12e092(0x1e52),_0x85490f['length']),console[_0x12e092(0xc0d)](_0x12e092(0x1a8),_0x85490f['substring'](0x0,0xc8)+_0x12e092(0x12da))):console[_0x12e092(0xc0d)](_0x12e092(0x2455));}catch(_0x2e7803){console[_0x12e092(0x24ab)](_0x12e092(0x14dd),_0x2e7803);}const _0x35b7a3=_0x5b58e5[_0x12e092(0x1f8f)]||_0x5b58e5['bio']||'你是'+_0x5b58e5[_0x12e092(0x222f)]+'。';console['log']('👤\x20续写角色人设:',_0x35b7a3),_0xe24c81+='角色信息：\x0a'+_0x35b7a3+'\x0a\x0a';let _0xfcc3d7='';try{const _0x41e22b=_0xeaa8d0['worldbookMountEnabled']&&_0xeaa8d0['selectedWorldbooks']?_0xeaa8d0[_0x12e092(0xefa)]:[],_0x24bd98=window[_0x12e092(0xfb9)]||[],_0x4a6f08=[...new Set([..._0x24bd98,..._0x41e22b])];console[_0x12e092(0xc0d)](_0x12e092(0x488),_0x4a6f08),_0x4a6f08[_0x12e092(0xcbf)]>0x0&&(_0xfcc3d7=_0x12e092(0xe11),_0x4a6f08[_0x12e092(0x900)]((_0x4917bd,_0x10c33e)=>{const _0x3ceeb0=_0x12e092,_0x48ee4a=worldbooks[_0x3ceeb0(0x1aeb)](_0x5714a7=>_0x5714a7['id']===_0x4917bd);_0x48ee4a&&(console[_0x3ceeb0(0xc0d)]('📚\x20续写找到世界书\x20'+(_0x10c33e+0x1)+':\x20'+(_0x48ee4a[_0x3ceeb0(0x222f)]||_0x48ee4a[_0x3ceeb0(0x1c18)])),_0xfcc3d7+=_0x10c33e+0x1+'.\x20'+(_0x48ee4a[_0x3ceeb0(0x222f)]||_0x48ee4a[_0x3ceeb0(0x1c18)])+':\x20'+_0x48ee4a['content']+'\x0a');}),_0xe24c81+=_0xfcc3d7+'\x0a',console['log'](_0x12e092(0x23ab),_0xfcc3d7[_0x12e092(0xcbf)]));}catch(_0x339c23){console[_0x12e092(0x24ab)]('续写获取世界书失败:',_0x339c23);}_0x16bfac&&(_0xe24c81+=_0x16bfac+'\x0a');_0x85490f&&_0x85490f[_0x12e092(0x1424)]()&&(_0xe24c81+=_0x12e092(0x1121)+_0x85490f+'\x0a\x0a');_0xed41d6&&(_0xe24c81+=_0xed41d6+'\x0a');selectedOfflinePresets&&selectedOfflinePresets['length']>0x0?(_0xe24c81+=_0x12e092(0x4d6),selectedOfflinePresets[_0x12e092(0x900)]((_0xe27afe,_0x3e5a73)=>{const _0x5f05d0=_0x12e092;_0xe24c81+=_0x3e5a73+0x1+'.\x20'+_0xe27afe[_0x5f05d0(0x222f)]+'：\x0a'+_0xe27afe[_0x5f05d0(0x1423)]+'\x0a\x0a';})):_0xe24c81+=_0x12e092(0x1820);const _0x3f4ee3=_0xeaa8d0[_0x12e092(0xe03)]||0x5,_0x2457d7=chatMessages[_0x5b58e5['id']]||[],_0xca594d=_0x2457d7[_0x12e092(0x136)](-_0x3f4ee3),_0x245a9d=_0xca594d[_0x12e092(0x803)](_0x470288=>!_0x470288['isOfflineMode'])['length'],_0x5442cb=_0xca594d[_0x12e092(0x803)](_0x4ad7df=>_0x4ad7df['isOfflineMode'])['length'];console['log']('💬\x20[续写重新生成]\x20续写模式完整前文记忆:',_0xca594d),console['log'](_0x12e092(0x33b)+_0x245a9d+_0x12e092(0x824)+_0x5442cb+_0x12e092(0x1a66)+_0xca594d['length']+_0x12e092(0x24a4)+_0x3f4ee3+'条)'),console[_0x12e092(0xc0d)]('🔍\x20[续写重新生成]\x20消息内容预览:',_0xca594d['map'](_0x54f670=>_0x54f670['sender']+':\x20'+safeExtractMessageContent(_0x54f670)[_0x12e092(0x4b2)](0x0,0x32)+_0x12e092(0x12da)));_0xca594d[_0x12e092(0xcbf)]>0x0&&(_0xe24c81+=_0x12e092(0xfee),_0xca594d[_0x12e092(0x900)](_0x58c117=>{const _0x4a1a03=_0x12e092,_0x8ad2d2=_0x58c117[_0x4a1a03(0xf75)]==='sent'?'用户':_0x5b58e5[_0x4a1a03(0x222f)],_0x4acf2c=safeExtractMessageContent(_0x58c117);_0xe24c81+=_0x8ad2d2+'：'+_0x4acf2c+'\x0a';}),_0xe24c81+='\x0a');_0xe24c81+=_0x12e092(0x1c70)+_0x5b58e5[_0x12e092(0x222f)]+_0x12e092(0x196d),console[_0x12e092(0xc0d)]('📝\x20=====\x20续写Prompt内容\x20====='),console['log'](_0xe24c81),console[_0x12e092(0xc0d)](_0x12e092(0x11b7));try{const _0x41f276=await callOfflineChatAPI(_0xe24c81,_0x5b58e5);return console[_0x12e092(0xc0d)]('✍️\x20续写响应:',_0x41f276),_0x41f276||_0x12e092(0xa15);}catch(_0x1f5d0a){console[_0x12e092(0x24ab)](_0x12e092(0x119b),_0x1f5d0a);throw _0x1f5d0a;}}function formatOfflineText(_0x2c5f1c){const _0x2e1d18=_0x2cf6d4;if(!_0x2c5f1c)return'';let _0x4f3612=_0x2c5f1c;const _0x4fd8a4=[];return _0x4f3612=_0x4f3612[_0x2e1d18(0x882)](/<details[^>]*>[\s\S]*?<\/details>/gi,_0x4885e7=>{const _0x16e235=_0x2e1d18,_0x4175f8=_0x16e235(0x1a6)+_0x4fd8a4[_0x16e235(0xcbf)]+'__';return _0x4fd8a4[_0x16e235(0x6ee)](_0x4885e7),_0x4175f8;}),_0x4f3612=_0x4f3612[_0x2e1d18(0x882)](/<p>/gi,'')[_0x2e1d18(0x882)](/<\/p>/gi,'\x0a\x0a')[_0x2e1d18(0x882)](/<br\s*\/?>/gi,'\x0a')[_0x2e1d18(0x882)](/<[^>]*>/g,''),_0x4fd8a4[_0x2e1d18(0x900)]((_0x7d2116,_0x199ca8)=>{const _0x1d16d4=_0x2e1d18,_0x1506a1=_0x1d16d4(0x1a6)+_0x199ca8+'__';_0x4f3612=_0x4f3612['replace'](_0x1506a1,_0x7d2116);}),_0x4f3612=_0x4f3612[_0x2e1d18(0x882)](/\*\*([^*]+)\*\*/g,'<strong>$1</strong>'),_0x4f3612=_0x4f3612['replace'](/\*([^*]+)\*/g,'<em>$1</em>'),_0x4f3612=_0x4f3612['replace'](/\n/g,_0x2e1d18(0x365)),_0x4f3612=_0x4f3612[_0x2e1d18(0x882)](/(<br>\s*){3,}/g,_0x2e1d18(0xdbf)),_0x4f3612;}document[_0x2cf6d4(0x167)]('DOMContentLoaded',function(){const _0x4368ca=_0x2cf6d4,_0x258a97=document[_0x4368ca(0x566)]('offline-input');_0x258a97&&_0x258a97['addEventListener'](_0x4368ca(0x695),function(_0x17d415){const _0x2e6983=_0x4368ca;_0x17d415[_0x2e6983(0x157f)]===_0x2e6983(0x165c)&&!_0x17d415['shiftKey']&&(_0x17d415[_0x2e6983(0x4d9)](),sendOfflineMessage());});});async function saveOfflineHistoryRecord(_0x4dbaad,_0x48f7c0){const _0x519175=_0x2cf6d4;if(!currentChatCharacter||!_0x48f7c0||_0x48f7c0['length']===0x0)return;try{const _0x499f95={'id':_0x519175(0x1e67)+currentChatCharacter['id']+'_'+Date[_0x519175(0x18e0)](),'characterId':currentChatCharacter['id'],'timestamp':Date[_0x519175(0x18e0)](),'date':new Date()[_0x519175(0x133a)](),'summary':_0x4dbaad,'messages':_0x48f7c0,'messageCount':_0x48f7c0[_0x519175(0xcbf)]};await db[_0x519175(0x1143)][_0x519175(0xe1)](_0x499f95);const _0x4d1fbb=await db[_0x519175(0x1143)]['where']('characterId')['equals'](currentChatCharacter['id'])[_0x519175(0x2253)]()['sortBy'](_0x519175(0x7aa));if(_0x4d1fbb['length']>0x14){const _0x11a0cb=_0x4d1fbb['slice'](0x14);for(const _0x2ac509 of _0x11a0cb){await db[_0x519175(0x1143)][_0x519175(0xc2b)](_0x2ac509['id']);}}console['log'](_0x519175(0x24d6),_0x499f95);}catch(_0x4530ad){console['error'](_0x519175(0x1ab0),_0x4530ad);}}function showOfflineHistoryModal(){const _0x335dd1=_0x2cf6d4;if(!currentChatCharacter)return;document[_0x335dd1(0x566)](_0x335dd1(0x1e44))[_0x335dd1(0x655)][_0x335dd1(0x2526)]=_0x335dd1(0x1f0b),loadOfflineHistoryList();}function closeOfflineHistoryModal(){const _0xd332a3=_0x2cf6d4;document[_0xd332a3(0x566)](_0xd332a3(0x1e44))[_0xd332a3(0x655)]['display']=_0xd332a3(0xfe9);}async function loadOfflineHistoryList(){const _0x34a91b=_0x2cf6d4;if(!currentChatCharacter)return;try{const _0x150113=await db['offlineHistoryRecords'][_0x34a91b(0x4a6)](_0x34a91b(0x10df))[_0x34a91b(0x14a)](currentChatCharacter['id'])[_0x34a91b(0x2253)]()[_0x34a91b(0xa3b)](_0x34a91b(0x7aa)),_0x371721=document[_0x34a91b(0x566)](_0x34a91b(0x7ad));_0x371721[_0x34a91b(0xc02)]='';if(_0x150113[_0x34a91b(0xcbf)]===0x0){_0x371721[_0x34a91b(0xc02)]=_0x34a91b(0x1eea);return;}_0x150113[_0x34a91b(0x900)]((_0x7a092f,_0x48d623)=>{const _0x2d0b6e=_0x34a91b,_0x50bd83=document[_0x2d0b6e(0x1ad8)]('div');_0x50bd83[_0x2d0b6e(0x221)]=_0x2d0b6e(0x78a);const _0x38fd07=new Date(_0x7a092f['timestamp'])[_0x2d0b6e(0x177f)]();_0x50bd83['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22history-record-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22history-record-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22history-record-title\x22>剧情记录\x20#'+(_0x150113[_0x2d0b6e(0xcbf)]-_0x48d623)+_0x2d0b6e(0x1f4c)+_0x38fd07+'\x20•\x20'+_0x7a092f[_0x2d0b6e(0x2049)]+_0x2d0b6e(0x1494)+_0x7a092f['id']+_0x2d0b6e(0x2363)+_0x7a092f['id']+_0x2d0b6e(0x15cc)+_0x7a092f['id']+'\x27)\x22\x20title=\x22删除记录\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-trash\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22history-record-summary\x22>'+_0x7a092f[_0x2d0b6e(0x1354)][_0x2d0b6e(0x4b2)](0x0,0x64)+(_0x7a092f[_0x2d0b6e(0x1354)][_0x2d0b6e(0xcbf)]>0x64?_0x2d0b6e(0x12da):'')+_0x2d0b6e(0xc38),_0x371721[_0x2d0b6e(0x1925)](_0x50bd83);});}catch(_0x5411ff){console[_0x34a91b(0x24ab)]('加载线下模式聊天记录失败:',_0x5411ff);}}async function viewOfflineHistory(_0x4bcb39){const _0x5979a4=_0x2cf6d4;if(!currentChatCharacter)return;try{const _0x4f586f=await db[_0x5979a4(0x1143)]['get'](_0x4bcb39);if(!_0x4f586f){showToast(_0x5979a4(0x6c0),_0x5979a4(0x24ab));return;}const _0x153904=document[_0x5979a4(0x1ad8)](_0x5979a4(0x526));_0x153904[_0x5979a4(0x221)]='modal',_0x153904[_0x5979a4(0x655)]['display']=_0x5979a4(0x1f0b),_0x153904[_0x5979a4(0xc02)]=_0x5979a4(0x6de)+(_0x4f586f['date']||new Date(_0x4f586f[_0x5979a4(0x7aa)])[_0x5979a4(0x133a)]())+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>消息数：</strong>'+_0x4f586f[_0x5979a4(0x2049)]+_0x5979a4(0xeb5)+_0x4f586f[_0x5979a4(0x1767)]['map'](_0x177521=>_0x5979a4(0x4c7)+_0x177521[_0x5979a4(0xf75)]+_0x5979a4(0x19ab)+(_0x177521[_0x5979a4(0xf75)]===_0x5979a4(0x23b2)?getCurrentPersonaName()||'用户':currentChatCharacter[_0x5979a4(0x222f)])+_0x5979a4(0x2293)+_0x177521['content'][_0x5979a4(0x882)](/\n/g,_0x5979a4(0x365))+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-time\x22>'+new Date(_0x177521['timestamp'])['toLocaleTimeString']()+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20')['join']('')+_0x5979a4(0x2502),document[_0x5979a4(0x172c)]['appendChild'](_0x153904);}catch(_0x55b6e9){console['error'](_0x5979a4(0x4ec),_0x55b6e9),showToast(_0x5979a4(0x135d),_0x5979a4(0x24ab));}}async function exportOfflineHistory(_0x4ce4fc){const _0x182a89=_0x2cf6d4;try{const _0x10f439=await db[_0x182a89(0x1143)][_0x182a89(0x46a)](_0x4ce4fc);if(!_0x10f439){showToast(_0x182a89(0x226f),'error');return;}const _0x2e2230=generateOfflineHistoryHTML(_0x10f439),_0x12ea04=new Blob([_0x2e2230],{'type':_0x182a89(0x1b8d)}),_0x41bf14=URL[_0x182a89(0x17c3)](_0x12ea04),_0x38660e=document[_0x182a89(0x1ad8)]('a');_0x38660e['href']=_0x41bf14;const _0x8aecbb=new Date(_0x10f439[_0x182a89(0x7aa)])[_0x182a89(0x177f)]()[_0x182a89(0x882)](/\//g,'-'),_0x1ddbed=currentChatCharacter?currentChatCharacter[_0x182a89(0x222f)]:'角色';_0x38660e[_0x182a89(0x154c)]=_0x1ddbed+_0x182a89(0x739)+_0x8aecbb+'.html',document[_0x182a89(0x172c)][_0x182a89(0x1925)](_0x38660e),_0x38660e[_0x182a89(0x1e62)](),document[_0x182a89(0x172c)][_0x182a89(0x1624)](_0x38660e),URL[_0x182a89(0x2101)](_0x41bf14),showToast(_0x182a89(0x19c3),_0x182a89(0xb27));}catch(_0x5c1a62){console[_0x182a89(0x24ab)](_0x182a89(0x1553),_0x5c1a62),showToast(_0x182a89(0x22bc),'error');}}function generateOfflineHistoryHTML(_0x28eeeb){const _0x10f493=_0x2cf6d4,_0x2d808a=currentChatCharacter?currentChatCharacter[_0x10f493(0x222f)]:'角色',_0x3d6516=new Date(_0x28eeeb[_0x10f493(0x7aa)])[_0x10f493(0x133a)](),_0x5cb422=getCurrentPersonaName(),_0x28a0fa=_0x28eeeb[_0x10f493(0x1767)][_0x10f493(0xf6d)](_0x2eef5c=>{const _0x4e5a1f=_0x10f493,_0x453d14=_0x2eef5c['sender']===_0x4e5a1f(0x23b2)?_0x5cb422:_0x2d808a,_0x39b805=new Date(_0x2eef5c[_0x4e5a1f(0x7aa)])[_0x4e5a1f(0x133a)](),_0x42e420=safeExtractMessageContent(_0x2eef5c),_0x3cb838=_0x42e420[_0x4e5a1f(0x882)](/&/g,'&amp;')[_0x4e5a1f(0x882)](/</g,'&lt;')[_0x4e5a1f(0x882)](/>/g,_0x4e5a1f(0x571))[_0x4e5a1f(0x882)](/"/g,_0x4e5a1f(0xca))['replace'](/'/g,_0x4e5a1f(0x25c));return _0x4e5a1f(0xdfd)+_0x2eef5c[_0x4e5a1f(0xf75)]+_0x4e5a1f(0x1a41)+_0x453d14+_0x4e5a1f(0x1b9b)+_0x39b805+_0x4e5a1f(0x2dc)+_0x3cb838+_0x4e5a1f(0x92d);})['join']('');return'<!DOCTYPE\x20html>\x0a<html\x20lang=\x22zh-CN\x22>\x0a<head>\x0a\x20\x20\x20\x20<meta\x20charset=\x22UTF-8\x22>\x0a\x20\x20\x20\x20<meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,\x20initial-scale=1.0\x22>\x0a\x20\x20\x20\x20<title>'+_0x2d808a+_0x10f493(0x1a9e)+_0x3d6516+'</title>\x0a\x20\x20\x20\x20<style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20body\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20-apple-system,\x20BlinkMacSystemFont,\x20\x27Segoe\x20UI\x27,\x20Roboto,\x20sans-serif;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20line-height:\x201.6;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#333;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20max-width:\x20800px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin:\x200\x20auto;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2020px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#ffffff;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.header\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20text-align:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-bottom:\x2030px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2025px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#2196F3;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20white;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.header\x20h1\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin:\x200\x200\x2010px\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2028px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-weight:\x20600;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.header\x20.meta\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2014px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x200.9;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.chat-container\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#fafafa;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2020px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x201px\x20solid\x20#e0e0e0;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.message\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-bottom:\x2020px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2016px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20white;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x201px\x20solid\x20#e0e0e0;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20box-shadow:\x200\x201px\x203px\x20rgba(0,0,0,0.1);\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.message.user\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#e3f2fd;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-color:\x20#2196F3;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.message-header\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20justify-content:\x20space-between;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20align-items:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-bottom:\x2010px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2013px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.sender\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-weight:\x20600;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#2196F3;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.time\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#666;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.message-content\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2015px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20line-height:\x201.8;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#333;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20white-space:\x20pre-wrap;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20word-wrap:\x20break-word;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20word-break:\x20break-word;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-top:\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x208px\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.footer\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20text-align:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-top:\x2030px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2015px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#666;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-top:\x201px\x20solid\x20#e0e0e0;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20</style>\x0a</head>\x0a<body>\x0a\x20\x20\x20\x20<div\x20class=\x22header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<h1>'+_0x2d808a+_0x10f493(0xbad)+_0x3d6516+_0x10f493(0xb3f)+_0x28eeeb['messageCount']+_0x10f493(0x424)+_0x28a0fa+'\x0a\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20<div\x20class=\x22footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20此聊天记录由\x20EVE\x20Chat\x20导出\x20|\x20'+new Date()[_0x10f493(0x133a)]()+_0x10f493(0xf20);}async function deleteOfflineHistory(_0x1a4a0a){const _0x6965d6=_0x2cf6d4;if(!confirm(_0x6965d6(0x1361)))return;if(!currentChatCharacter)return;try{await db[_0x6965d6(0x1143)][_0x6965d6(0xc2b)](_0x1a4a0a),loadOfflineHistoryList(),showToast(_0x6965d6(0x18b6),_0x6965d6(0xb27));}catch(_0x2ad999){console['error'](_0x6965d6(0xcff),_0x2ad999),showToast('删除聊天记录失败','error');}}async function fixOfflineHistoryMessages(){const _0x28e26f=_0x2cf6d4;showToast(_0x28e26f(0x1b5d),_0x28e26f(0x13bb)),console[_0x28e26f(0x17cc)](_0x28e26f(0x148a));return;let _0x148a69=0x0;const _0x381318=chatMessages[characterId];for(let _0x5e1130=0x0;_0x5e1130<_0x381318[_0x28e26f(0xcbf)];_0x5e1130++){const _0x17b4e8=_0x381318[_0x5e1130];if(_0x17b4e8[_0x28e26f(0x14ad)])continue;if(_0x17b4e8[_0x28e26f(0x1827)]||_0x17b4e8[_0x28e26f(0x1ea4)]||_0x17b4e8['isPoke']||_0x17b4e8[_0x28e26f(0x549)]||_0x17b4e8['isLocationMessage']||_0x17b4e8[_0x28e26f(0xf75)]==='system')continue;if((_0x17b4e8['type']===_0x28e26f(0x1e58)||!_0x17b4e8[_0x28e26f(0x23df)])&&(_0x17b4e8[_0x28e26f(0xf75)]===_0x28e26f(0xfda)||_0x17b4e8['sender']===_0x28e26f(0x232))){const _0x44bbff=_0x5e1130>0x0?_0x381318[_0x5e1130-0x1]:null,_0x21a07b=_0x5e1130<_0x381318[_0x28e26f(0xcbf)]-0x1?_0x381318[_0x5e1130+0x1]:null,_0x59e02b=_0x44bbff&&_0x21a07b&&_0x44bbff[_0x28e26f(0x14ad)]&&_0x21a07b[_0x28e26f(0x14ad)]&&_0x17b4e8['timestamp']-_0x44bbff['timestamp']<0xea60&&_0x21a07b[_0x28e26f(0x7aa)]-_0x17b4e8['timestamp']<0xea60;if(_0x59e02b){const _0x1d7d6e=typeof _0x17b4e8[_0x28e26f(0x1423)]===_0x28e26f(0xb97)?_0x17b4e8[_0x28e26f(0x1423)]:'',_0xe87016=_0x1d7d6e[_0x28e26f(0x23ec)]('「')||_0x1d7d6e[_0x28e26f(0x23ec)]('」')||_0x1d7d6e[_0x28e26f(0x23ec)]('(')||_0x1d7d6e[_0x28e26f(0x23ec)]('（')||_0x1d7d6e[_0x28e26f(0xcbf)]>0x32;_0xe87016&&(_0x17b4e8['isOfflineMode']=!![],_0x148a69++,console['log'](_0x28e26f(0x1300)+_0x1d7d6e[_0x28e26f(0x4b2)](0x0,0x32)+_0x28e26f(0x12da)));}}}if(_0x148a69>0x0)try{await saveChatMessagesImmediate([characterId]),showToast(_0x28e26f(0x2421)+_0x148a69+_0x28e26f(0x8cc),'success'),document[_0x28e26f(0x566)](_0x28e26f(0x1634))[_0x28e26f(0x655)]['display']!=='none'&&loadOfflineMessages();}catch(_0xfa3aa2){console['error'](_0x28e26f(0x44b),_0xfa3aa2),showToast(_0x28e26f(0x20c8),_0x28e26f(0x24ab));}else showToast(_0x28e26f(0x71d),_0x28e26f(0x2422));}async function clearAllOfflineHistory(){const _0x2859e4=_0x2cf6d4;if(!confirm(_0x2859e4(0x1aa7)))return;if(!currentChatCharacter)return;try{await db[_0x2859e4(0x1143)][_0x2859e4(0x4a6)](_0x2859e4(0x10df))['equals'](currentChatCharacter['id'])[_0x2859e4(0xc2b)](),loadOfflineHistoryList(),showToast('所有聊天记录已清空','success');}catch(_0xb0736f){console[_0x2859e4(0x24ab)](_0x2859e4(0xf9d),_0xb0736f),showToast(_0x2859e4(0x15ba),_0x2859e4(0x24ab));}}let offlineUISettings={};async function preloadOfflineUISettings(){const _0x4c10b2=_0x2cf6d4;try{console['log'](_0x4c10b2(0xac));const _0x568c15=await db[_0x4c10b2(0xe3d)][_0x4c10b2(0x18c6)]();console[_0x4c10b2(0xc0d)]('📦\x20从数据库加载了\x20'+_0x568c15[_0x4c10b2(0xcbf)]+_0x4c10b2(0x12ea));if(_0x568c15[_0x4c10b2(0xcbf)]===0x0){console[_0x4c10b2(0xc0d)](_0x4c10b2(0x1fd2));for(let _0x340a7b=0x0;_0x340a7b<localStorage[_0x4c10b2(0xcbf)];_0x340a7b++){const _0x10b15e=localStorage[_0x4c10b2(0x157f)](_0x340a7b);if(_0x10b15e&&_0x10b15e[_0x4c10b2(0x1cab)](_0x4c10b2(0x2111)))try{const _0xc5673a=localStorage[_0x4c10b2(0x2250)](_0x10b15e);if(_0xc5673a){const _0x16224b=JSON['parse'](_0xc5673a),_0x38f6f4=_0x10b15e[_0x4c10b2(0x882)](_0x4c10b2(0x2111),'')[_0x4c10b2(0x633)]('_')[0x0],_0x5f2093=_0x38f6f4+_0x4c10b2(0x11b4);await db['offlineUISettings']['put']({'id':_0x5f2093,'characterId':_0x38f6f4,'windowId':null,'settings':_0x16224b,'timestamp':Date[_0x4c10b2(0x18e0)]()}),console[_0x4c10b2(0xc0d)]('✅\x20已迁移角色\x20'+_0x38f6f4+_0x4c10b2(0x1b41));}}catch(_0x5d81a7){console[_0x4c10b2(0x17cc)](_0x4c10b2(0xfe1)+_0x10b15e+'):',_0x5d81a7);}}}console[_0x4c10b2(0xc0d)]('✅\x20线下模式设置预加载完成');}catch(_0x433d13){console[_0x4c10b2(0x24ab)](_0x4c10b2(0x2231),_0x433d13);}}function showOfflineUISettings(){const _0x373dd5=_0x2cf6d4;if(!currentChatCharacter){showToast(_0x373dd5(0x1268),_0x373dd5(0x13bb));return;}document['getElementById'](_0x373dd5(0x1b4d))['style'][_0x373dd5(0x2526)]=_0x373dd5(0x1f0b),loadOfflineUISettings();}function closeOfflineUISettings(){const _0x343c5c=_0x2cf6d4;document['getElementById']('offline-ui-settings-modal')[_0x343c5c(0x655)]['display']=_0x343c5c(0xfe9);}async function loadOfflineUISettings(){const _0x3db0ab=_0x2cf6d4;if(!currentChatCharacter)return;const _0x29cb44=currentChatCharacter['id'];try{let _0x5354b8=null,_0x317f7d=![];if(windowId)try{_0x5354b8=await db[_0x3db0ab(0xe3d)][_0x3db0ab(0x46a)](_0x29cb44+'_'+windowId+_0x3db0ab(0x11b4)),_0x5354b8&&_0x5354b8[_0x3db0ab(0x1fbb)]&&(_0x317f7d=!![],console['log']('✅\x20从数据库加载窗口隔离设置成功\x20(窗口'+windowId+')'));}catch(_0x13c54b){console[_0x3db0ab(0x17cc)]('数据库加载窗口隔离设置失败:',_0x13c54b);}if(!_0x317f7d)try{_0x5354b8=await db['offlineUISettings'][_0x3db0ab(0x46a)](_0x29cb44+_0x3db0ab(0x11b4)),_0x5354b8&&_0x5354b8[_0x3db0ab(0x1fbb)]&&(_0x317f7d=!![],console['log']('✅\x20从数据库加载通用格式设置成功（回退模式）'));}catch(_0x5b98eb){console[_0x3db0ab(0x17cc)](_0x3db0ab(0x968),_0x5b98eb);}if(!_0x317f7d)try{let _0x4f2164=null,_0x2b8d60=null;windowId&&(_0x2b8d60=_0x3db0ab(0x2111)+_0x29cb44+'_'+windowId,_0x4f2164=localStorage[_0x3db0ab(0x2250)](_0x2b8d60));!_0x4f2164&&(_0x2b8d60=_0x3db0ab(0x2111)+_0x29cb44,_0x4f2164=localStorage[_0x3db0ab(0x2250)](_0x2b8d60));if(_0x4f2164){const _0x48d53e=JSON[_0x3db0ab(0x168e)](_0x4f2164);if(!_0x48d53e[_0x3db0ab(0xde4)])try{const _0x205423=windowId?_0x29cb44+'_'+windowId+_0x3db0ab(0x11b4):_0x29cb44+_0x3db0ab(0x11b4),_0x2695d5=await db['offlineUISettings'][_0x3db0ab(0x46a)](_0x205423);_0x2695d5&&_0x2695d5[_0x3db0ab(0x1fbb)]&&_0x2695d5[_0x3db0ab(0x1fbb)][_0x3db0ab(0xde4)]&&(_0x48d53e[_0x3db0ab(0xde4)]=_0x2695d5[_0x3db0ab(0x1fbb)]['wallpaperData'],console[_0x3db0ab(0xc0d)](_0x3db0ab(0x1f9f)));}catch(_0x3aa1fc){console[_0x3db0ab(0x17cc)](_0x3db0ab(0x18ed),_0x3aa1fc);}_0x5354b8={'settings':_0x48d53e},console['log'](_0x3db0ab(0x96d)+_0x2b8d60+')'),setTimeout(async()=>{const _0x5b6fb9=_0x3db0ab;try{const _0x1c6bcc=windowId?_0x29cb44+'_'+windowId+_0x5b6fb9(0x11b4):_0x29cb44+_0x5b6fb9(0x11b4);await db[_0x5b6fb9(0xe3d)][_0x5b6fb9(0x53a)]({'id':_0x1c6bcc,'characterId':_0x29cb44,'windowId':windowId||null,'settings':_0x48d53e,'timestamp':Date['now']()}),console[_0x5b6fb9(0xc0d)](_0x5b6fb9(0x198d)+_0x1c6bcc+')');}catch(_0x33e95d){console['warn']('异步迁移失败，但不影响当前使用:',_0x33e95d);}},0x64);}}catch(_0x31dc12){console[_0x3db0ab(0x17cc)](_0x3db0ab(0x23fb),_0x31dc12);}_0x5354b8&&_0x5354b8['settings']?(offlineUISettings=_0x5354b8[_0x3db0ab(0x1fbb)],console[_0x3db0ab(0xc0d)](_0x3db0ab(0x17d8))):(console[_0x3db0ab(0xc0d)](_0x3db0ab(0x2449)),offlineUISettings={'myBubbleColor':'#BED6EF','aiBubbleColor':_0x3db0ab(0x1679),'bubbleOpacity':0.9,'fontSize':0xf,'wallpaperData':'','fontFamily':'','fontUrl':'','userNormalTextColor':_0x3db0ab(0x1f42),'userItalicTextColor':'#333333','userBoldTextColor':_0x3db0ab(0x1f42),'aiNormalTextColor':_0x3db0ab(0x1f42),'aiItalicTextColor':_0x3db0ab(0x1f39),'aiBoldTextColor':'#333333','showUserAvatar':![],'showAiAvatar':![],'avatarPosition':_0x3db0ab(0xd07),'bubbleWidth':_0x3db0ab(0xbf),'bubbleStyle':_0x3db0ab(0xbf),'customCSS':'','savedColors':{'userNormal':[],'userItalic':[],'userBold':[],'aiNormal':[],'aiItalic':[],'aiBold':[]}}),updateOfflineUISettingsForm(),updateOfflinePreview();}catch(_0x223b77){console[_0x3db0ab(0x24ab)]('加载线下模式界面设置完全失败:',_0x223b77),offlineUISettings={'myBubbleColor':'#BED6EF','aiBubbleColor':_0x3db0ab(0x1679),'bubbleOpacity':0.9,'fontSize':0xf,'wallpaperData':'','fontFamily':'','fontUrl':'','userNormalTextColor':'#000000','userItalicTextColor':'#333333','userBoldTextColor':'#000000','aiNormalTextColor':'#000000','aiItalicTextColor':_0x3db0ab(0x1f39),'aiBoldTextColor':_0x3db0ab(0x17dc),'showUserAvatar':![],'showAiAvatar':![],'avatarPosition':_0x3db0ab(0xd07),'bubbleWidth':'default','bubbleStyle':_0x3db0ab(0xbf),'customCSS':'','savedColors':{'userNormal':[],'userItalic':[],'userBold':[],'aiNormal':[],'aiItalic':[],'aiBold':[]}},updateOfflineUISettingsForm(),updateOfflinePreview();}}function updateOfflineUISettingsForm(){const _0x341809=_0x2cf6d4;document[_0x341809(0x566)](_0x341809(0x1972))[_0x341809(0xc34)]=offlineUISettings[_0x341809(0x1aab)],document[_0x341809(0x566)]('offline-ai-bubble-color')[_0x341809(0xc34)]=offlineUISettings['aiBubbleColor'],document[_0x341809(0x566)](_0x341809(0x330))[_0x341809(0xc34)]=offlineUISettings['bubbleOpacity'],document[_0x341809(0x566)](_0x341809(0xe96))[_0x341809(0x21dc)]=Math[_0x341809(0x5f3)](offlineUISettings[_0x341809(0xbd8)]*0x64)+'%',document[_0x341809(0x566)](_0x341809(0x4a4))[_0x341809(0xc34)]=offlineUISettings[_0x341809(0x1ae6)]||0xf,document[_0x341809(0x566)](_0x341809(0x15fc))[_0x341809(0x21dc)]=(offlineUISettings['fontSize']||0xf)+'px',document[_0x341809(0x566)](_0x341809(0xf42))['value']=offlineUISettings['fontFamily']||'';offlineUISettings[_0x341809(0x16b1)]===_0x341809(0x13a8)?(document[_0x341809(0x566)](_0x341809(0x1430))[_0x341809(0x655)][_0x341809(0x2526)]=_0x341809(0x2d4),document['getElementById'](_0x341809(0xde3))[_0x341809(0xc34)]=offlineUISettings[_0x341809(0x1f53)]||''):document['getElementById'](_0x341809(0x1430))['style']['display']=_0x341809(0xfe9);document[_0x341809(0x566)](_0x341809(0x178e))[_0x341809(0xc34)]=offlineUISettings[_0x341809(0xf21)]||_0x341809(0x2338),document[_0x341809(0x566)]('offline-user-italic-text-color')[_0x341809(0xc34)]=offlineUISettings[_0x341809(0x75f)]||'#f0f0f0',document[_0x341809(0x566)](_0x341809(0x13e5))[_0x341809(0xc34)]=offlineUISettings[_0x341809(0x190d)]||_0x341809(0x2338),document[_0x341809(0x566)]('offline-ai-normal-text-color')[_0x341809(0xc34)]=offlineUISettings[_0x341809(0x1a4)]||'#000000',document[_0x341809(0x566)](_0x341809(0x9fb))[_0x341809(0xc34)]=offlineUISettings[_0x341809(0xc09)]||_0x341809(0x1f39),document[_0x341809(0x566)](_0x341809(0x16b6))[_0x341809(0xc34)]=offlineUISettings['aiBoldTextColor']||'#333333',document[_0x341809(0x566)](_0x341809(0x22f3))['checked']=offlineUISettings[_0x341809(0x2366)]===!![],document[_0x341809(0x566)](_0x341809(0x10cc))[_0x341809(0x306)]=offlineUISettings[_0x341809(0x13ee)]===!![];const _0x3b5eb0=offlineUISettings[_0x341809(0x8e6)]||_0x341809(0xd07);document[_0x341809(0x15b8)]('input[name=\x22offline-avatar-position\x22][value=\x22'+_0x3b5eb0+'\x22]')[_0x341809(0x306)]=!![];const _0x1f3daa=offlineUISettings[_0x341809(0x1bd0)]||'default';document['querySelector'](_0x341809(0xdc1)+_0x1f3daa+'\x22]')[_0x341809(0x306)]=!![];const _0x10494b=offlineUISettings['bubbleStyle']||'default';document[_0x341809(0x15b8)](_0x341809(0x184e)+_0x10494b+'\x22]')[_0x341809(0x306)]=!![],document['getElementById'](_0x341809(0xe88))['value']=offlineUISettings['customCSS']||'',updateSavedColorsDisplay();const _0x18c1f1=document[_0x341809(0x566)](_0x341809(0x330));_0x18c1f1['oninput']=function(){const _0x5d735b=_0x341809,_0xf2dcbd=Math[_0x5d735b(0x5f3)](this[_0x5d735b(0xc34)]*0x64);document[_0x5d735b(0x566)]('offline-opacity-value')[_0x5d735b(0x21dc)]=_0xf2dcbd+'%',updateOfflinePreview();};const _0x5cd7c9=document[_0x341809(0x566)](_0x341809(0x4a4));_0x5cd7c9[_0x341809(0x116e)]=function(){const _0x5bd1b3=_0x341809,_0x3ed62f=this[_0x5bd1b3(0xc34)];document[_0x5bd1b3(0x566)](_0x5bd1b3(0x15fc))[_0x5bd1b3(0x21dc)]=_0x3ed62f+'px',updateOfflinePreview();},[_0x341809(0x1972),_0x341809(0x208a),_0x341809(0x178e),_0x341809(0x1beb),'offline-user-bold-text-color','offline-ai-normal-text-color',_0x341809(0x9fb),_0x341809(0x16b6)]['forEach'](_0x3f38f7=>{const _0x1797d3=_0x341809;document[_0x1797d3(0x566)](_0x3f38f7)[_0x1797d3(0x116e)]=updateOfflinePreview;}),document[_0x341809(0x566)](_0x341809(0x22f3))[_0x341809(0x1889)]=updateOfflinePreview,document[_0x341809(0x566)](_0x341809(0x10cc))['onchange']=updateOfflinePreview,document[_0x341809(0x1ed9)](_0x341809(0x662))['forEach'](_0x28aad5=>{const _0x5427ae=_0x341809;_0x28aad5[_0x5427ae(0x1889)]=updateOfflinePreview;}),document[_0x341809(0x1ed9)](_0x341809(0x751))[_0x341809(0x900)](_0x52c5f5=>{const _0x53ed1b=_0x341809;_0x52c5f5[_0x53ed1b(0x1889)]=updateOfflinePreview;}),document[_0x341809(0x1ed9)]('input[name=\x22offline-bubble-style\x22]')[_0x341809(0x900)](_0x34940b=>{const _0x567a6f=_0x341809;_0x34940b[_0x567a6f(0x1889)]=updateOfflinePreview;}),document['querySelectorAll'](_0x341809(0x662))[_0x341809(0x900)](_0x531875=>{const _0x15149c=_0x341809;_0x531875[_0x15149c(0x1889)]=function(){const _0x29925c=_0x15149c;this[_0x29925c(0xc34)]===_0x29925c(0x13a8)&&showToast(_0x29925c(0x951),_0x29925c(0x2422));};}),document[_0x341809(0x1ed9)]('input[name=\x22offline-bubble-width\x22]')[_0x341809(0x900)](_0x15d5e9=>{const _0x398778=_0x341809;_0x15d5e9[_0x398778(0x1889)]=function(){const _0x512190=_0x398778;this[_0x512190(0xc34)]===_0x512190(0x13a8)?showToast(_0x512190(0x11b),_0x512190(0x2422)):applyDefaultBubbleWidth();};}),document[_0x341809(0x1ed9)](_0x341809(0x104d))[_0x341809(0x900)](_0x4e44b0=>{_0x4e44b0['onchange']=function(){const _0x565b06=_0x3a81;this[_0x565b06(0xc34)]===_0x565b06(0x13a8)?showToast(_0x565b06(0x120f),_0x565b06(0x2422)):applyDefaultBubbleStyle();};});}function applyDefaultBubbleWidth(){const _0x508187=_0x2cf6d4,_0x194e17=document[_0x508187(0x566)](_0x508187(0x255f));_0x194e17&&_0x194e17[_0x508187(0x128)](),showToast(_0x508187(0x95e),'success');}function applyDefaultBubbleStyle(){const _0x19501d=_0x2cf6d4,_0x2fda33=document[_0x19501d(0x566)](_0x19501d(0x1f02));_0x2fda33&&_0x2fda33[_0x19501d(0x128)](),showToast(_0x19501d(0xfdb),'success');}function updateSavedColorsDisplay(){const _0xf4cfc=_0x2cf6d4,_0x4198de=[_0xf4cfc(0x20f2),_0xf4cfc(0xdad),_0xf4cfc(0x1732),_0xf4cfc(0xb31),_0xf4cfc(0x2287),_0xf4cfc(0x1a81)],_0x3f7080={'userNormal':_0xf4cfc(0x1802),'userItalic':_0xf4cfc(0xc0f),'userBold':_0xf4cfc(0x4ca),'aiNormal':_0xf4cfc(0x19f5),'aiItalic':_0xf4cfc(0x2041),'aiBold':_0xf4cfc(0x6b5)};_0x4198de[_0xf4cfc(0x900)](_0x1f38f3=>{const _0x103471=_0xf4cfc,_0x47f145=document[_0x103471(0x566)](_0x3f7080[_0x1f38f3]+_0x103471(0x1ac4));_0x47f145&&(_0x47f145[_0x103471(0xc02)]='',offlineUISettings['savedColors'][_0x1f38f3]&&offlineUISettings[_0x103471(0x15f1)][_0x1f38f3][_0x103471(0x900)](_0x475f46=>{const _0x531ebc=_0x103471,_0x890327=document[_0x531ebc(0x1ad8)](_0x531ebc(0x526));_0x890327[_0x531ebc(0x221)]=_0x531ebc(0x848),_0x890327[_0x531ebc(0x655)][_0x531ebc(0xacd)]=_0x475f46,_0x890327['title']=_0x475f46,_0x890327[_0x531ebc(0x11cf)]=()=>{const _0x10ca65=_0x531ebc;document[_0x10ca65(0x566)](_0x3f7080[_0x1f38f3]+_0x10ca65(0x24c6))[_0x10ca65(0xc34)]=_0x475f46,updateOfflinePreview();},_0x47f145[_0x531ebc(0x1925)](_0x890327);}));});}function updateOfflinePreview(){const _0x41468f=_0x2cf6d4,_0x1c247b=document[_0x41468f(0x566)](_0x41468f(0x1972))[_0x41468f(0xc34)],_0xb1e39c=document['getElementById'](_0x41468f(0x208a))[_0x41468f(0xc34)],_0x1b4d12=document[_0x41468f(0x566)](_0x41468f(0x330))[_0x41468f(0xc34)],_0xef5d60=document['getElementById']('offline-user-normal-text-color')[_0x41468f(0xc34)],_0x1f0bb5=document['getElementById'](_0x41468f(0x1beb))[_0x41468f(0xc34)],_0x30b1ff=document[_0x41468f(0x566)](_0x41468f(0x13e5))[_0x41468f(0xc34)],_0x3637cc=document[_0x41468f(0x566)]('offline-ai-normal-text-color')[_0x41468f(0xc34)],_0x5d5f49=document[_0x41468f(0x566)](_0x41468f(0x9fb))[_0x41468f(0xc34)],_0x45e06c=document[_0x41468f(0x566)](_0x41468f(0x16b6))[_0x41468f(0xc34)],_0x27be8c=document[_0x41468f(0x1788)];_0x27be8c['style']['setProperty'](_0x41468f(0x90d),_0x1c247b),_0x27be8c[_0x41468f(0x655)][_0x41468f(0x16db)](_0x41468f(0x1ce1),_0xb1e39c),_0x27be8c[_0x41468f(0x655)][_0x41468f(0x16db)](_0x41468f(0x24d0),_0xef5d60),_0x27be8c[_0x41468f(0x655)][_0x41468f(0x16db)](_0x41468f(0x216b),_0x1f0bb5),_0x27be8c[_0x41468f(0x655)][_0x41468f(0x16db)]('--offline-user-bold-text-color',_0x30b1ff),_0x27be8c[_0x41468f(0x655)][_0x41468f(0x16db)](_0x41468f(0x238d),_0x3637cc),_0x27be8c[_0x41468f(0x655)][_0x41468f(0x16db)](_0x41468f(0x1949),_0x5d5f49),_0x27be8c['style'][_0x41468f(0x16db)](_0x41468f(0x2203),_0x45e06c);const _0x486353=document[_0x41468f(0x15b8)](_0x41468f(0x9c4)),_0x4e7c9a=document['querySelector'](_0x41468f(0x105b));if(_0x486353){const _0x4a8009=convertColorWithOpacity(_0x1c247b,_0x1b4d12);_0x486353[_0x41468f(0x655)][_0x41468f(0xacd)]=_0x4a8009,_0x486353['style'][_0x41468f(0x671)]=0x1,_0x486353[_0x41468f(0x655)][_0x41468f(0x2099)]=_0xef5d60;const _0x212c17=_0x486353[_0x41468f(0x15b8)]('em'),_0x1d2dab=_0x486353[_0x41468f(0x15b8)]('strong');if(_0x212c17)_0x212c17[_0x41468f(0x655)][_0x41468f(0x2099)]=_0x1f0bb5;if(_0x1d2dab)_0x1d2dab[_0x41468f(0x655)][_0x41468f(0x2099)]=_0x30b1ff;}if(_0x4e7c9a){const _0x21914e=convertColorWithOpacity(_0xb1e39c,_0x1b4d12);_0x4e7c9a[_0x41468f(0x655)]['backgroundColor']=_0x21914e,_0x4e7c9a[_0x41468f(0x655)][_0x41468f(0x671)]=0x1,_0x4e7c9a['style'][_0x41468f(0x2099)]=_0x3637cc;const _0x47774d=_0x4e7c9a[_0x41468f(0x15b8)]('em'),_0x440a94=_0x4e7c9a[_0x41468f(0x15b8)]('strong');if(_0x47774d)_0x47774d['style']['color']=_0x5d5f49;if(_0x440a94)_0x440a94[_0x41468f(0x655)][_0x41468f(0x2099)]=_0x45e06c;}const _0x5429dd=document[_0x41468f(0x566)]('offline-show-user-avatar')['checked'],_0x3626bc=document['getElementById'](_0x41468f(0x10cc))['checked'],_0x8ec1f7=document[_0x41468f(0x566)](_0x41468f(0x6ff)),_0x1c4a80=document[_0x41468f(0x566)](_0x41468f(0x436)),_0x84741c=document['querySelectorAll']('.offline-preview-message');_0x84741c['forEach'](_0x56a122=>{const _0x59df1d=_0x41468f;_0x56a122[_0x59df1d(0x226e)][_0x59df1d(0x128)](_0x59df1d(0x525),_0x59df1d(0xfb0));});_0x8ec1f7&&(_0x8ec1f7[_0x41468f(0x655)][_0x41468f(0x2526)]=_0x5429dd?'flex':_0x41468f(0xfe9));_0x1c4a80&&(_0x1c4a80['style']['display']=_0x3626bc?_0x41468f(0x1f0b):'none');_0x84741c['forEach'](_0x4985db=>{const _0x3cddc0=_0x41468f;!_0x5429dd&&_0x4985db[_0x3cddc0(0x226e)][_0x3cddc0(0xe1)]('no-user-avatar'),!_0x3626bc&&_0x4985db[_0x3cddc0(0x226e)][_0x3cddc0(0xe1)](_0x3cddc0(0xfb0));});const _0x2f35a3=document[_0x41468f(0x15b8)](_0x41468f(0x1e34))[_0x41468f(0xc34)],_0x4d6046=document['querySelector'](_0x41468f(0xef7))[_0x41468f(0xc34)],_0x4c58f9=document[_0x41468f(0x15b8)](_0x41468f(0x1ab2))[_0x41468f(0xc34)],_0x289015=document['querySelectorAll'](_0x41468f(0x168c)),_0x2de4eb=document[_0x41468f(0x1ed9)]('.offline-preview-message');_0x289015[_0x41468f(0x900)](_0x11393b=>{const _0x28988f=_0x41468f;if(_0x2f35a3==='default')_0x11393b[_0x28988f(0x655)]['maxWidth']='';else{const _0x4c06a9=document['getElementById']('offline-custom-css')['value'][_0x28988f(0x1424)]();if(_0x4c06a9){}}}),_0x2de4eb[_0x41468f(0x900)](_0x7c1fee=>{const _0xbacaf8=_0x41468f;_0x4d6046==='side'?_0x7c1fee['classList'][_0xbacaf8(0x1f9)](_0xbacaf8(0x23b2))?_0x7c1fee[_0xbacaf8(0x655)][_0xbacaf8(0x1364)]='row-reverse':_0x7c1fee['style'][_0xbacaf8(0x1364)]=_0xbacaf8(0x1f44):_0x7c1fee[_0xbacaf8(0x655)][_0xbacaf8(0x1364)]='';});}function handleOfflineWallpaperUpload(_0x239781){const _0x5b71fa=_0x2cf6d4,_0x4b9342=_0x239781[_0x5b71fa(0x173e)][0x0];if(!_0x4b9342)return;if(!_0x4b9342[_0x5b71fa(0x23df)]['startsWith']('image/')){showToast('请选择图片文件',_0x5b71fa(0x13bb)),_0x239781['value']='';return;}if(_0x4b9342['size']>0x5*0x400*0x400){showToast(_0x5b71fa(0x1ac7),_0x5b71fa(0x13bb)),_0x239781[_0x5b71fa(0xc34)]='';return;}const _0x14baa6=new FileReader();_0x14baa6[_0x5b71fa(0xc28)]=function(_0x747d12){const _0x5077bf=_0x5b71fa,_0x4fcd35=_0x747d12[_0x5077bf(0x1144)][_0x5077bf(0x1fff)],_0x3be371=document[_0x5077bf(0x566)]('offline-preview-area');_0x3be371[_0x5077bf(0x655)][_0x5077bf(0x1584)]=_0x5077bf(0xcb5)+_0x4fcd35+')',_0x3be371[_0x5077bf(0x655)][_0x5077bf(0x2000)]=_0x5077bf(0xe3e),_0x3be371[_0x5077bf(0x655)][_0x5077bf(0x18b3)]='center',offlineUISettings[_0x5077bf(0xde4)]=_0x4fcd35,showToast('壁纸已上传并预览','success');},_0x14baa6[_0x5b71fa(0x145e)](_0x4b9342);}function clearOfflineWallpaper(){const _0x26fff1=_0x2cf6d4;document['getElementById'](_0x26fff1(0x7da))[_0x26fff1(0xc34)]='';const _0x4c2612=document[_0x26fff1(0x566)](_0x26fff1(0x66e));_0x4c2612[_0x26fff1(0x655)][_0x26fff1(0x1584)]='',offlineUISettings['wallpaperData']='',showToast(_0x26fff1(0x10b0),_0x26fff1(0xb27));}function handleOfflineFontChange(){const _0x1a142e=_0x2cf6d4,_0x421005=document[_0x1a142e(0x566)]('offline-font-select'),_0x21e474=document[_0x1a142e(0x566)](_0x1a142e(0x1430));_0x421005[_0x1a142e(0xc34)]===_0x1a142e(0x13a8)?_0x21e474[_0x1a142e(0x655)]['display']=_0x1a142e(0x2d4):(_0x21e474[_0x1a142e(0x655)][_0x1a142e(0x2526)]='none',applyBuiltinFont(_0x421005[_0x1a142e(0xc34)]));}function applyBuiltinFont(_0x331e4b){const _0x217c6e=_0x2cf6d4,_0x2e4e7e=document[_0x217c6e(0x566)](_0x217c6e(0xd62));_0x2e4e7e&&_0x2e4e7e[_0x217c6e(0x128)](),_0x331e4b&&showToast(_0x217c6e(0x20df),_0x217c6e(0xb27));}function realtimePreviewOfflineCSS(){const _0x2d69be=_0x2cf6d4,_0x4b6303=document[_0x2d69be(0x566)](_0x2d69be(0xe88))[_0x2d69be(0xc34)]['trim'](),_0x43b6ea=document[_0x2d69be(0x566)](_0x2d69be(0xd7));_0x43b6ea&&_0x43b6ea[_0x2d69be(0x128)]();if(!_0x4b6303)return;try{const _0x4b8bd0=document[_0x2d69be(0x1ad8)](_0x2d69be(0x655));_0x4b8bd0['id']=_0x2d69be(0xd7);let _0x5e1505=_0x4b6303;_0x5e1505[_0x2d69be(0x23ec)](_0x2d69be(0x1370))?_0x5e1505=_0x5e1505[_0x2d69be(0x882)](/#offline-mode-overlay/g,'.offline-preview-area'):(_0x5e1505=_0x5e1505[_0x2d69be(0x882)](/\.offline-message/g,_0x2d69be(0x1ec7)),_0x5e1505=_0x5e1505[_0x2d69be(0x882)](/\.offline-avatar/g,_0x2d69be(0x11e7))),_0x4b8bd0[_0x2d69be(0x21dc)]=_0x5e1505,document['head']['appendChild'](_0x4b8bd0);}catch(_0x5d132d){console['error'](_0x2d69be(0x907),_0x5d132d);}}function previewOfflineCSS(){const _0x1ed61d=_0x2cf6d4,_0x53d42a=document[_0x1ed61d(0x566)](_0x1ed61d(0xe88))[_0x1ed61d(0xc34)][_0x1ed61d(0x1424)]();if(!_0x53d42a){showToast(_0x1ed61d(0x21ac),_0x1ed61d(0x13bb));return;}realtimePreviewOfflineCSS(),showToast(_0x1ed61d(0xa03),_0x1ed61d(0xb27));}function clearOfflineCSS(){const _0x4a1289=_0x2cf6d4;document[_0x4a1289(0x566)](_0x4a1289(0xe88))[_0x4a1289(0xc34)]='';const _0x49ce0b=document[_0x4a1289(0x566)](_0x4a1289(0xd7));_0x49ce0b&&_0x49ce0b[_0x4a1289(0x128)]();realtimePreviewOfflineCSS();offlineUISettings&&(offlineUISettings[_0x4a1289(0x200b)]='',console['log'](_0x4a1289(0xac0)));if(currentChatCharacter){const _0x340433=_0x4a1289(0x2195)+currentChatCharacter['id'],_0x43bf84=document[_0x4a1289(0x566)](_0x340433);_0x43bf84&&(_0x43bf84[_0x4a1289(0x128)](),console[_0x4a1289(0xc0d)](_0x4a1289(0x1d58))),setTimeout(()=>{const _0x5d68ad=_0x4a1289;applyOfflineUISettings(),console[_0x5d68ad(0xc0d)](_0x5d68ad(0x1e0c));},0x64);}showToast(_0x4a1289(0x2228),_0x4a1289(0xb27));}function showCSSExamples(){const _0x3e7268=_0x2cf6d4,_0x127eb6=[{'name':_0x3e7268(0xfcc),'code':_0x3e7268(0x2f9)},{'name':_0x3e7268(0x224),'code':_0x3e7268(0x7df)},{'name':_0x3e7268(0xa94),'code':'/*\x20小而精致的头像\x20*/\x0a#offline-mode-overlay\x20.offline-avatar\x20{\x0a\x20\x20\x20\x20width:\x2025px\x20!important;\x0a\x20\x20\x20\x20height:\x2025px\x20!important;\x0a\x20\x20\x20\x20border:\x201px\x20solid\x20#ccc\x20!important;\x0a\x20\x20\x20\x20border-radius:\x206px\x20!important;\x0a}'},{'name':_0x3e7268(0x1fdf),'code':_0x3e7268(0x1cc7)},{'name':_0x3e7268(0x23cd),'code':_0x3e7268(0x1961)}],_0x121bb6=document[_0x3e7268(0x1ad8)]('div');_0x121bb6['className']=_0x3e7268(0xb07),_0x121bb6['style'][_0x3e7268(0x2526)]=_0x3e7268(0x1f0b),_0x121bb6[_0x3e7268(0xc02)]=_0x3e7268(0x23e2)+_0x127eb6[_0x3e7268(0xf6d)]((_0x2cb9d6,_0xd7f785)=>_0x3e7268(0x167c)+_0x2cb9d6[_0x3e7268(0x222f)]+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22applyCSSExample('+_0xd7f785+')\x22\x20style=\x22float:\x20right;\x20background:\x20#007bff;\x20color:\x20white;\x20border:\x20none;\x20padding:\x204px\x208px;\x20border-radius:\x203px;\x20cursor:\x20pointer;\x20font-size:\x2012px;\x22>应用</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<pre\x20style=\x22margin:\x200;\x20padding:\x2015px;\x20background:\x20#f8f9fa;\x20font-family:\x20\x27Courier\x20New\x27,\x20monospace;\x20font-size:\x2012px;\x20line-height:\x201.4;\x20white-space:\x20pre-wrap;\x22><code>'+_0x2cb9d6[_0x3e7268(0xe7e)]+'</code></pre>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20')[_0x3e7268(0x140c)]('')+_0x3e7268(0x21fe),document['body'][_0x3e7268(0x1925)](_0x121bb6),window['applyCSSExample']=function(_0x10f152){const _0x31294d=_0x3e7268,_0x5cb1d6=document[_0x31294d(0x566)]('offline-custom-css'),_0x5a8208=_0x5cb1d6['value']['trim'](),_0x5174fd=_0x127eb6[_0x10f152][_0x31294d(0xe7e)];_0x5a8208?_0x5cb1d6[_0x31294d(0xc34)]=_0x5a8208+'\x0a\x0a'+_0x5174fd:_0x5cb1d6['value']=_0x5174fd,showToast(_0x31294d(0x12c1)+_0x127eb6[_0x10f152][_0x31294d(0x222f)]+_0x31294d(0x186e),_0x31294d(0xb27)),_0x121bb6['remove']();};}function previewOfflineFont(){const _0x4340b0=_0x2cf6d4,_0x474048=document[_0x4340b0(0x566)](_0x4340b0(0xde3))[_0x4340b0(0xc34)]['trim']();if(!_0x474048){showToast(_0x4340b0(0x1cc2),_0x4340b0(0x13bb));return;}const _0x53458a=document[_0x4340b0(0x566)](_0x4340b0(0xd62));_0x53458a&&_0x53458a[_0x4340b0(0x128)]();const _0x6ab66b=document[_0x4340b0(0x566)](_0x4340b0(0x19ff));_0x6ab66b&&_0x6ab66b[_0x4340b0(0x128)]();if(_0x474048['includes'](_0x4340b0(0xd54))||_0x474048[_0x4340b0(0x23ec)](_0x4340b0(0xb9b))||_0x474048[_0x4340b0(0xd7e)]('.css')||_0x474048[_0x4340b0(0x23ec)]('fontsapi')||_0x474048['includes'](_0x4340b0(0x944))){console['log'](_0x4340b0(0xdab),_0x474048);const _0x1eaf19=document['createElement']('link');_0x1eaf19['id']='offline-custom-font-link',_0x1eaf19[_0x4340b0(0xe06)]=_0x4340b0(0x1cb4),_0x1eaf19[_0x4340b0(0xe1d)]=_0x474048,_0x1eaf19['crossOrigin']=_0x4340b0(0xb99),_0x1eaf19[_0x4340b0(0xc28)]=function(){const _0x19ebe7=_0x4340b0;let _0x18d9cb=extractFontFamilyFromGoogleFonts(_0x474048)||_0x19ebe7(0x1ff3);console[_0x19ebe7(0xc0d)]('🎨\x20字体CSS加载成功，提取的字体名称:',_0x18d9cb),console[_0x19ebe7(0xc0d)]('🎨\x20字体URL:',_0x474048);try{const _0x2969d8=document[_0x19ebe7(0x13d9)];for(let _0x27af8d=_0x2969d8[_0x19ebe7(0xcbf)]-0x1;_0x27af8d>=0x0;_0x27af8d--){const _0x35438e=_0x2969d8[_0x27af8d];if(_0x35438e['href']===_0x474048){try{const _0x44a0c7=_0x35438e[_0x19ebe7(0x21aa)]||_0x35438e[_0x19ebe7(0x5fe)];for(let _0x4d6361=0x0;_0x4d6361<_0x44a0c7[_0x19ebe7(0xcbf)];_0x4d6361++){const _0x24527f=_0x44a0c7[_0x4d6361];if(_0x24527f['type']===CSSRule['FONT_FACE_RULE']&&_0x24527f[_0x19ebe7(0x655)][_0x19ebe7(0x16b1)]){_0x18d9cb=_0x24527f[_0x19ebe7(0x655)][_0x19ebe7(0x16b1)][_0x19ebe7(0x882)](/['"]/g,''),console[_0x19ebe7(0xc0d)]('🎨\x20从CSS中提取到真实字体名称:',_0x18d9cb);break;}}}catch(_0xb03109){console[_0x19ebe7(0xc0d)](_0x19ebe7(0x2161));}break;}}}catch(_0x544156){console[_0x19ebe7(0xc0d)](_0x19ebe7(0xa6e));}const _0x2b5f93=document[_0x19ebe7(0x1ad8)]('style');_0x2b5f93['id']=_0x19ebe7(0xd62),_0x2b5f93[_0x19ebe7(0x21dc)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.offline-preview-content,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20#offline-mode-overlay\x20.offline-message-content\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20\x27'+_0x18d9cb+'\x27,\x20sans-serif\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',document['head']['appendChild'](_0x2b5f93),console[_0x19ebe7(0xc0d)](_0x19ebe7(0x2548),_0x18d9cb),window[_0x19ebe7(0x112c)]=_0x18d9cb,setTimeout(()=>{const _0x3a2e9c=_0x19ebe7,_0x4bbb22=document[_0x3a2e9c(0x15b8)](_0x3a2e9c(0x1e48));if(_0x4bbb22){const _0x4e9113=window[_0x3a2e9c(0x13bc)](_0x4bbb22);console[_0x3a2e9c(0xc0d)]('🎨\x20实际应用的字体:',_0x4e9113[_0x3a2e9c(0x16b1)]);}},0x3e8),showToast(_0x19ebe7(0x1a48)+_0x18d9cb,_0x19ebe7(0xb27));},_0x1eaf19[_0x4340b0(0x1795)]=function(){const _0x113c01=_0x4340b0;console[_0x113c01(0x24ab)](_0x113c01(0x1d24),_0x474048),showToast(_0x113c01(0x1b18),_0x113c01(0x24ab));},document[_0x4340b0(0x1e4c)][_0x4340b0(0x1925)](_0x1eaf19);}else{const _0xef80bc=_0x4340b0(0x49a),_0x2bc457=document[_0x4340b0(0x1ad8)]('style');_0x2bc457['id']='offline-custom-font-style',_0x2bc457[_0x4340b0(0x21dc)]=_0x4340b0(0x1c58)+_0xef80bc+_0x4340b0(0xac8)+_0x474048+_0x4340b0(0x2166)+_0xef80bc+_0x4340b0(0xd30),document[_0x4340b0(0x1e4c)]['appendChild'](_0x2bc457),showToast(_0x4340b0(0x13c7),'success');}}function extractFontFamilyFromGoogleFonts(_0x123da7){const _0x2326c0=_0x2cf6d4;try{const _0x1057e9=_0x123da7[_0x2326c0(0x1316)](/family=([^&:]+)/);if(_0x1057e9){let _0x3680e5=decodeURIComponent(_0x1057e9[0x1]);return _0x3680e5=_0x3680e5[_0x2326c0(0x882)](/\+/g,'\x20')[_0x2326c0(0x882)](/:.*$/,''),_0x3680e5;}const _0x3e1573=_0x123da7['match'](/family=([^&]+)/);if(_0x3e1573){let _0x1f9436=decodeURIComponent(_0x3e1573[0x1]);return _0x1f9436=_0x1f9436[_0x2326c0(0x882)](/\+/g,'\x20')[_0x2326c0(0x633)](':')[0x0],_0x1f9436;}const _0xe3cfe2=_0x123da7[_0x2326c0(0x1316)](/\/([^\/]+)\.css/);if(_0xe3cfe2)return _0xe3cfe2[0x1][_0x2326c0(0x882)](/[-_]/g,'\x20');const _0x50dbd7=_0x123da7[_0x2326c0(0x1316)](/\/(\d+)\//);if(_0x50dbd7)return'CustomFont-'+_0x50dbd7[0x1];const _0x2d3320=_0x123da7[_0x2326c0(0x1316)](/\/\/([^.]+)/);if(_0x2d3320)return _0x2d3320[0x1]+_0x2326c0(0x634);}catch(_0x36e59c){console[_0x2326c0(0x17cc)](_0x2326c0(0xcd0),_0x36e59c);}return _0x2326c0(0x1ff3);}function clearOfflineFont(){const _0x2fffb6=_0x2cf6d4;document[_0x2fffb6(0x566)](_0x2fffb6(0xde3))[_0x2fffb6(0xc34)]='';const _0x2a8777=document[_0x2fffb6(0x566)]('offline-custom-font-style');_0x2a8777&&_0x2a8777[_0x2fffb6(0x128)](),showToast(_0x2fffb6(0xa95),'success');}function saveCurrentOfflineColors(){const _0x58c7bf=_0x2cf6d4,_0x56017f=document[_0x58c7bf(0x566)](_0x58c7bf(0x178e))[_0x58c7bf(0xc34)],_0x5e60c5=document['getElementById'](_0x58c7bf(0x1beb))[_0x58c7bf(0xc34)],_0x192475=document[_0x58c7bf(0x566)](_0x58c7bf(0x13e5))['value'],_0x147436=document['getElementById'](_0x58c7bf(0x14ea))[_0x58c7bf(0xc34)],_0x1934ce=document[_0x58c7bf(0x566)](_0x58c7bf(0x9fb))['value'],_0xedfcf3=document['getElementById'](_0x58c7bf(0x16b6))['value'],_0x5a8979=[{'type':_0x58c7bf(0x20f2),'color':_0x56017f},{'type':_0x58c7bf(0xdad),'color':_0x5e60c5},{'type':'userBold','color':_0x192475},{'type':'aiNormal','color':_0x147436},{'type':_0x58c7bf(0x2287),'color':_0x1934ce},{'type':'aiBold','color':_0xedfcf3}];_0x5a8979[_0x58c7bf(0x900)](({type:_0x43739c,color:_0x3aee26})=>{const _0x3ebe38=_0x58c7bf;!offlineUISettings[_0x3ebe38(0x15f1)][_0x43739c]&&(offlineUISettings['savedColors'][_0x43739c]=[]),!offlineUISettings[_0x3ebe38(0x15f1)][_0x43739c][_0x3ebe38(0x23ec)](_0x3aee26)&&offlineUISettings['savedColors'][_0x43739c]['push'](_0x3aee26),offlineUISettings['savedColors'][_0x43739c][_0x3ebe38(0xcbf)]>0xa&&(offlineUISettings[_0x3ebe38(0x15f1)][_0x43739c]=offlineUISettings['savedColors'][_0x43739c][_0x3ebe38(0x136)](-0xa));}),updateSavedColorsDisplay(),showToast(_0x58c7bf(0x1e28),'success');}function resetOfflineColors(){const _0x1b2a55=_0x2cf6d4;document[_0x1b2a55(0x566)](_0x1b2a55(0x1972))[_0x1b2a55(0xc34)]='#BED6EF',document[_0x1b2a55(0x566)](_0x1b2a55(0x208a))[_0x1b2a55(0xc34)]='#f0f0f0',document['getElementById'](_0x1b2a55(0x330))['value']=0.9,document['getElementById'](_0x1b2a55(0xe96))[_0x1b2a55(0x21dc)]=_0x1b2a55(0x1fad),document[_0x1b2a55(0x566)]('offline-font-size')[_0x1b2a55(0xc34)]=0xf,document['getElementById'](_0x1b2a55(0x15fc))['textContent']='15px',document[_0x1b2a55(0x566)]('offline-user-normal-text-color')[_0x1b2a55(0xc34)]=_0x1b2a55(0x1f42),document[_0x1b2a55(0x566)](_0x1b2a55(0x1beb))[_0x1b2a55(0xc34)]=_0x1b2a55(0x17dc),document['getElementById'](_0x1b2a55(0x13e5))[_0x1b2a55(0xc34)]='#000000',document['getElementById'](_0x1b2a55(0x14ea))[_0x1b2a55(0xc34)]='#000000',document[_0x1b2a55(0x566)](_0x1b2a55(0x9fb))[_0x1b2a55(0xc34)]=_0x1b2a55(0x1f39),document['getElementById'](_0x1b2a55(0x16b6))['value']=_0x1b2a55(0x17dc),updateOfflinePreview(),showToast(_0x1b2a55(0x1c55),_0x1b2a55(0xb27));}async function saveOfflineUISettings(){const _0x5dc046=_0x2cf6d4,_0x31551d=currentChatCharacter['id'];try{offlineUISettings={'myBubbleColor':document['getElementById'](_0x5dc046(0x1972))[_0x5dc046(0xc34)],'aiBubbleColor':document[_0x5dc046(0x566)](_0x5dc046(0x208a))[_0x5dc046(0xc34)],'bubbleOpacity':parseFloat(document['getElementById']('offline-bubble-opacity')[_0x5dc046(0xc34)]),'fontSize':parseInt(document[_0x5dc046(0x566)]('offline-font-size')[_0x5dc046(0xc34)]),'wallpaperData':offlineUISettings[_0x5dc046(0xde4)]||'','fontFamily':document[_0x5dc046(0x566)]('offline-font-select')[_0x5dc046(0xc34)],'fontUrl':document[_0x5dc046(0x566)](_0x5dc046(0xde3))[_0x5dc046(0xc34)][_0x5dc046(0x1424)](),'realFontName':window['previewedFontName']||'','userNormalTextColor':document['getElementById'](_0x5dc046(0x178e))[_0x5dc046(0xc34)],'userItalicTextColor':document[_0x5dc046(0x566)]('offline-user-italic-text-color')[_0x5dc046(0xc34)],'userBoldTextColor':document[_0x5dc046(0x566)](_0x5dc046(0x13e5))[_0x5dc046(0xc34)],'aiNormalTextColor':document[_0x5dc046(0x566)]('offline-ai-normal-text-color')[_0x5dc046(0xc34)],'aiItalicTextColor':document[_0x5dc046(0x566)]('offline-ai-italic-text-color')[_0x5dc046(0xc34)],'aiBoldTextColor':document[_0x5dc046(0x566)]('offline-ai-bold-text-color')['value'],'showUserAvatar':document['getElementById'](_0x5dc046(0x22f3))[_0x5dc046(0x306)],'showAiAvatar':document[_0x5dc046(0x566)](_0x5dc046(0x10cc))[_0x5dc046(0x306)],'avatarPosition':document[_0x5dc046(0x15b8)](_0x5dc046(0xef7))[_0x5dc046(0xc34)],'bubbleWidth':document['querySelector']('input[name=\x22offline-bubble-width\x22]:checked')['value'],'bubbleStyle':document[_0x5dc046(0x15b8)](_0x5dc046(0x1ab2))['value'],'customCSS':document[_0x5dc046(0x566)](_0x5dc046(0xe88))['value'][_0x5dc046(0x1424)](),'savedColors':offlineUISettings[_0x5dc046(0x15f1)]||{'userNormal':[],'userItalic':[],'userBold':[],'aiNormal':[],'aiItalic':[],'aiBold':[]}},await saveOfflineUISettingsToDB(),applyOfflineUISettings(),closeOfflineUISettings(),showToast('界面设置已保存','success');}catch(_0x35e0c9){console['error']('保存线下模式界面设置失败:',_0x35e0c9),showToast('保存界面设置失败',_0x5dc046(0x24ab));}}async function saveOfflineUISettingsToDB(){const _0x3bfee4=_0x2cf6d4;if(!currentChatCharacter||!offlineUISettings)return;const _0x55c027=currentChatCharacter['id'];let _0x373ba3=![],_0xf86abc=![];try{const _0x2e514a=windowId?_0x55c027+'_'+windowId+'_ui_settings':_0x55c027+_0x3bfee4(0x11b4);await db[_0x3bfee4(0xe3d)]['put']({'id':_0x2e514a,'characterId':_0x55c027,'windowId':windowId||null,'settings':offlineUISettings,'timestamp':Date[_0x3bfee4(0x18e0)]()}),_0x373ba3=!![],console[_0x3bfee4(0xc0d)](_0x3bfee4(0x12a1)+_0x2e514a+')');}catch(_0x1d14ab){console[_0x3bfee4(0x17cc)](_0x3bfee4(0x51e),_0x1d14ab);}try{const _0x4159dd=windowId?_0x3bfee4(0x2111)+_0x55c027+'_'+windowId:'offlineUISettings_'+_0x55c027,_0x37a905={...offlineUISettings};delete _0x37a905[_0x3bfee4(0xde4)],localStorage['setItem'](_0x4159dd,JSON[_0x3bfee4(0x7fb)](_0x37a905)),_0xf86abc=!![],console['log'](_0x3bfee4(0x49c)+_0x4159dd+')');}catch(_0x5defaf){console[_0x3bfee4(0x17cc)](_0x3bfee4(0x1b96),_0x5defaf);if(_0x5defaf[_0x3bfee4(0x222f)]===_0x3bfee4(0xf22)){console['log']('🧹\x20localStorage空间不足，尝试清理旧的线下模式设置...');try{const _0x1af18f=[];for(let _0x4487db=0x0;_0x4487db<localStorage[_0x3bfee4(0xcbf)];_0x4487db++){const _0x4183b6=localStorage['key'](_0x4487db);_0x4183b6&&_0x4183b6[_0x3bfee4(0x1cab)](_0x3bfee4(0x2111))&&_0x1af18f[_0x3bfee4(0x6ee)](_0x4183b6);}_0x1af18f[_0x3bfee4(0x900)](_0x494d95=>localStorage[_0x3bfee4(0x1c95)](_0x494d95)),console[_0x3bfee4(0xc0d)](_0x3bfee4(0x1be9)+_0x1af18f[_0x3bfee4(0xcbf)]+_0x3bfee4(0xac4));const _0x10a695={...offlineUISettings};delete _0x10a695[_0x3bfee4(0xde4)],localStorage['setItem'](storageKey,JSON[_0x3bfee4(0x7fb)](_0x10a695)),_0xf86abc=!![],console[_0x3bfee4(0xc0d)](_0x3bfee4(0x24ea));}catch(_0x3e5bfb){console[_0x3bfee4(0x17cc)](_0x3bfee4(0xab7),_0x3e5bfb);}}}if(!_0x373ba3&&!_0xf86abc)throw new Error(_0x3bfee4(0x1214));}function applyOfflineUISettings(){const _0x59234a=_0x2cf6d4;if(!offlineUISettings||!currentChatCharacter)return;const _0x4da7b1=document[_0x59234a(0x566)](_0x59234a(0x1634));if(!_0x4da7b1)return;const _0x5372c6=_0x4da7b1['querySelector'](_0x59234a(0xfa5));_0x5372c6&&(_0x5372c6[_0x59234a(0x655)][_0x59234a(0x1584)]='',_0x5372c6[_0x59234a(0x655)][_0x59234a(0xacd)]='');const _0x34db60=offlineUISettings[_0x59234a(0x1aab)]||_0x59234a(0x1f03),_0x3cc85b=offlineUISettings[_0x59234a(0x2116)]||_0x59234a(0x1679),_0x3651be=offlineUISettings[_0x59234a(0xbd8)]!==undefined?offlineUISettings[_0x59234a(0xbd8)]:0.9,_0x318476=offlineUISettings[_0x59234a(0xf21)]||_0x59234a(0x2338),_0x147e22=offlineUISettings[_0x59234a(0x75f)]||'#f0f0f0',_0x33a9af=offlineUISettings[_0x59234a(0x190d)]||_0x59234a(0x2338),_0x1496fd=offlineUISettings[_0x59234a(0x1a4)]||_0x59234a(0x1f42),_0x156719=offlineUISettings[_0x59234a(0xc09)]||_0x59234a(0x1f39),_0x25bfa2=offlineUISettings[_0x59234a(0x1899)]||_0x59234a(0x17dc),_0x4539f0=_0x4da7b1[_0x59234a(0x1ed9)](_0x59234a(0x16a1)),_0x433429=_0x4da7b1[_0x59234a(0x1ed9)](_0x59234a(0x110f)),_0x118f89=offlineUISettings[_0x59234a(0x200b)]&&offlineUISettings[_0x59234a(0x200b)][_0x59234a(0x1424)](),_0x33dc9e=_0x118f89&&(offlineUISettings['customCSS'][_0x59234a(0x23ec)](_0x59234a(0xc3c))||offlineUISettings[_0x59234a(0x200b)][_0x59234a(0x23ec)](_0x59234a(0x2099))||offlineUISettings[_0x59234a(0x200b)][_0x59234a(0x23ec)]('#'));_0x33dc9e?(console[_0x59234a(0xc0d)]('🎨\x20检测到自定义CSS包含颜色设置，完全跳过JavaScript颜色应用'),console[_0x59234a(0xc0d)]('🎨\x20自定义CSS内容:',offlineUISettings[_0x59234a(0x200b)][_0x59234a(0x4b2)](0x0,0xc8)+_0x59234a(0x12da)),_0x4539f0[_0x59234a(0x900)](_0x414e99=>{const _0x526456=_0x59234a;_0x414e99['style'][_0x526456(0xacd)]='',_0x414e99[_0x526456(0x655)][_0x526456(0x2099)]='';}),_0x433429[_0x59234a(0x900)](_0x51fef4=>{const _0x49d24b=_0x59234a;_0x51fef4[_0x49d24b(0x655)][_0x49d24b(0xacd)]='',_0x51fef4['style'][_0x49d24b(0x2099)]='';}),setTimeout(()=>{const _0x5b9677=_0x59234a,_0x38b464=_0x5b9677(0x2195)+currentChatCharacter['id'];let _0x23847e=document[_0x5b9677(0x566)](_0x38b464);_0x23847e&&_0x23847e[_0x5b9677(0x128)]();const _0x367b8=document[_0x5b9677(0x1ad8)](_0x5b9677(0x655));_0x367b8['id']=_0x38b464;let _0xf6cf9a=offlineUISettings[_0x5b9677(0x200b)];!_0xf6cf9a[_0x5b9677(0x23ec)](_0x5b9677(0x1370))&&(_0xf6cf9a=_0xf6cf9a[_0x5b9677(0x882)](/\.offline-/g,_0x5b9677(0xc4c))),_0x367b8[_0x5b9677(0x21dc)]=_0xf6cf9a,document[_0x5b9677(0x1e4c)][_0x5b9677(0x1925)](_0x367b8),console[_0x5b9677(0xc0d)]('🎨\x20强制重新应用自定义CSS');},0xa)):(console[_0x59234a(0xc0d)](_0x59234a(0xbb5)),_0x4539f0[_0x59234a(0x900)](_0x1e277=>{const _0x2825d6=_0x59234a,_0x228f23=convertColorWithOpacity(_0x34db60,_0x3651be);_0x1e277[_0x2825d6(0x655)][_0x2825d6(0xacd)]=_0x228f23,_0x1e277[_0x2825d6(0x655)]['opacity']=0x1,_0x1e277[_0x2825d6(0x655)]['color']=_0x318476;const _0x8d610d=_0x1e277[_0x2825d6(0x1ed9)]('em'),_0xa8613d=_0x1e277[_0x2825d6(0x1ed9)](_0x2825d6(0x8fe));_0x8d610d[_0x2825d6(0x900)](_0x159f02=>_0x159f02['style'][_0x2825d6(0x2099)]=_0x147e22),_0xa8613d[_0x2825d6(0x900)](_0x59761a=>_0x59761a[_0x2825d6(0x655)][_0x2825d6(0x2099)]=_0x33a9af);}));!_0x33dc9e&&_0x433429[_0x59234a(0x900)](_0x346b35=>{const _0x11127e=_0x59234a,_0x4bfb31=convertColorWithOpacity(_0x3cc85b,_0x3651be);_0x346b35[_0x11127e(0x655)][_0x11127e(0xacd)]=_0x4bfb31,_0x346b35[_0x11127e(0x655)]['opacity']=0x1,_0x346b35['style'][_0x11127e(0x2099)]=_0x1496fd;const _0x726d55=_0x346b35['querySelectorAll']('em'),_0x308e3d=_0x346b35[_0x11127e(0x1ed9)](_0x11127e(0x8fe));_0x726d55[_0x11127e(0x900)](_0x58dde3=>_0x58dde3[_0x11127e(0x655)][_0x11127e(0x2099)]=_0x156719),_0x308e3d['forEach'](_0xe0a002=>_0xe0a002[_0x11127e(0x655)]['color']=_0x25bfa2);});_0x5372c6&&offlineUISettings[_0x59234a(0xde4)]&&(_0x5372c6[_0x59234a(0x655)][_0x59234a(0x1584)]='url('+offlineUISettings[_0x59234a(0xde4)]+')',_0x5372c6[_0x59234a(0x655)][_0x59234a(0x2000)]='cover',_0x5372c6[_0x59234a(0x655)][_0x59234a(0x18b3)]=_0x59234a(0x23a1),_0x5372c6[_0x59234a(0x655)]['backgroundAttachment']=_0x59234a(0xeb8));const _0x429b13=_0x59234a(0x7e1)+currentChatCharacter['id'],_0x2764c7=document[_0x59234a(0x566)](_0x59234a(0x170b)+currentChatCharacter['id']);_0x2764c7&&_0x2764c7['remove']();const _0x32e790=document[_0x59234a(0x566)](_0x59234a(0x1232)+currentChatCharacter['id']);_0x32e790&&_0x32e790[_0x59234a(0x128)]();if(offlineUISettings[_0x59234a(0x16b1)]===_0x59234a(0x13a8)&&offlineUISettings[_0x59234a(0x1f53)]){const _0x59df2b=offlineUISettings['fontUrl'];if(_0x59df2b[_0x59234a(0x23ec)](_0x59234a(0xd54))||_0x59df2b['includes']('fonts.google.com')||_0x59df2b[_0x59234a(0xd7e)]('.css')||_0x59df2b[_0x59234a(0x23ec)](_0x59234a(0x163c))||_0x59df2b['includes'](_0x59234a(0x944))){const _0x3dbdc8=document['createElement'](_0x59234a(0xa58));_0x3dbdc8['id']=_0x59234a(0x1232)+currentChatCharacter['id'],_0x3dbdc8[_0x59234a(0xe06)]=_0x59234a(0x1cb4),_0x3dbdc8[_0x59234a(0xe1d)]=_0x59df2b,_0x3dbdc8[_0x59234a(0xc28)]=function(){const _0x448964=_0x59234a;let _0x43b1c7=offlineUISettings[_0x448964(0x9b8)]||extractFontFamilyFromGoogleFonts(_0x59df2b)||'CustomFont';if(!offlineUISettings[_0x448964(0x9b8)])try{const _0x138a47=document[_0x448964(0x13d9)];for(let _0x5130fd=_0x138a47['length']-0x1;_0x5130fd>=0x0;_0x5130fd--){const _0x2a9349=_0x138a47[_0x5130fd];if(_0x2a9349[_0x448964(0xe1d)]===_0x59df2b){try{const _0x4e14b4=_0x2a9349[_0x448964(0x21aa)]||_0x2a9349[_0x448964(0x5fe)];for(let _0xd14099=0x0;_0xd14099<_0x4e14b4[_0x448964(0xcbf)];_0xd14099++){const _0x2dca32=_0x4e14b4[_0xd14099];if(_0x2dca32['type']===CSSRule['FONT_FACE_RULE']&&_0x2dca32['style'][_0x448964(0x16b1)]){_0x43b1c7=_0x2dca32[_0x448964(0x655)]['fontFamily'][_0x448964(0x882)](/['"]/g,''),console[_0x448964(0xc0d)](_0x448964(0x373),_0x43b1c7);break;}}}catch(_0x4c16c9){console[_0x448964(0xc0d)](_0x448964(0x1fc3));}break;}}}catch(_0x2abd8c){console[_0x448964(0xc0d)](_0x448964(0x17f8));}else console[_0x448964(0xc0d)](_0x448964(0x2269),_0x43b1c7);const _0x2f0364=document[_0x448964(0x1ad8)](_0x448964(0x655));_0x2f0364['id']=_0x448964(0x170b)+currentChatCharacter['id'],_0x2f0364[_0x448964(0x21dc)]=_0x448964(0x19f)+_0x43b1c7+'\x27,\x20sans-serif\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',document['head'][_0x448964(0x1925)](_0x2f0364),console[_0x448964(0xc0d)](_0x448964(0x16a),_0x43b1c7);},document[_0x59234a(0x1e4c)][_0x59234a(0x1925)](_0x3dbdc8);}else{const _0x40e573=document[_0x59234a(0x1ad8)](_0x59234a(0x655));_0x40e573['id']=_0x59234a(0x170b)+currentChatCharacter['id'],_0x40e573[_0x59234a(0x21dc)]=_0x59234a(0xcae)+_0x429b13+_0x59234a(0x1826)+_0x59df2b+_0x59234a(0x252d)+_0x429b13+_0x59234a(0x143a),document['head']['appendChild'](_0x40e573),console[_0x59234a(0xc0d)](_0x59234a(0x16a),_0x429b13);}}else{if(globalFontSettings&&globalFontSettings[_0x59234a(0x34d)]&&globalFontSettings['fontName']){const _0x10a27b=document[_0x59234a(0x1ad8)](_0x59234a(0x655));_0x10a27b['id']='offline-font-'+currentChatCharacter['id'],_0x10a27b[_0x59234a(0x21dc)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20#offline-mode-overlay\x20.offline-message-content\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20\x27'+globalFontSettings['fontName']+_0x59234a(0xd30),document['head']['appendChild'](_0x10a27b),console[_0x59234a(0xc0d)]('✅\x20线下模式应用全局字体:',globalFontSettings[_0x59234a(0x747)]);}}const _0x37c8cc=_0x4da7b1[_0x59234a(0x1ed9)](_0x59234a(0x1383));_0x37c8cc[_0x59234a(0x900)](_0x532f2a=>{const _0x4a7cbc=_0x59234a,_0x5743d8=_0x532f2a['querySelector'](_0x4a7cbc(0x186f)),_0x699d8a=_0x532f2a['querySelector'](_0x4a7cbc(0x3fe));_0x532f2a[_0x4a7cbc(0x226e)][_0x4a7cbc(0x128)]('no-user-avatar',_0x4a7cbc(0xfb0)),_0x5743d8&&(_0x5743d8[_0x4a7cbc(0x655)]['display']=offlineUISettings[_0x4a7cbc(0x2366)]?_0x4a7cbc(0x1f0b):_0x4a7cbc(0xfe9)),_0x699d8a&&(_0x699d8a[_0x4a7cbc(0x655)][_0x4a7cbc(0x2526)]=offlineUISettings[_0x4a7cbc(0x13ee)]?_0x4a7cbc(0x1f0b):_0x4a7cbc(0xfe9)),!offlineUISettings[_0x4a7cbc(0x2366)]&&_0x532f2a['classList'][_0x4a7cbc(0xe1)](_0x4a7cbc(0x525)),!offlineUISettings[_0x4a7cbc(0x13ee)]&&_0x532f2a[_0x4a7cbc(0x226e)][_0x4a7cbc(0xe1)]('no-ai-avatar');});if(offlineUISettings[_0x59234a(0x1bd0)]===_0x59234a(0xbf)){const _0x43fbaf=_0x59234a(0x22b9)+currentChatCharacter['id'],_0x1864fd=document[_0x59234a(0x566)](_0x43fbaf);_0x1864fd&&_0x1864fd[_0x59234a(0x128)]();}if(offlineUISettings[_0x59234a(0x8e6)]===_0x59234a(0xd07)){const _0x8e19f4='offline-avatar-'+currentChatCharacter['id'],_0x128cc7=document[_0x59234a(0x566)](_0x8e19f4);_0x128cc7&&_0x128cc7[_0x59234a(0x128)]();const _0x14ed1e=document[_0x59234a(0x1ad8)]('style');_0x14ed1e['id']=_0x8e19f4,_0x14ed1e['textContent']=_0x59234a(0x46f),document[_0x59234a(0x1e4c)][_0x59234a(0x1925)](_0x14ed1e);}if(offlineUISettings[_0x59234a(0x200b)]&&(offlineUISettings[_0x59234a(0x8e6)]===_0x59234a(0x13a8)||offlineUISettings[_0x59234a(0x1bd0)]===_0x59234a(0x13a8)||offlineUISettings[_0x59234a(0xa7e)]==='custom')){const _0x50a37a=_0x59234a(0x2195)+currentChatCharacter['id'],_0x5c10a7=document[_0x59234a(0x566)](_0x50a37a);_0x5c10a7&&_0x5c10a7[_0x59234a(0x128)]();const _0x3d1b12=document[_0x59234a(0x1ad8)](_0x59234a(0x655));_0x3d1b12['id']=_0x50a37a;const _0x20b5d3=offlineUISettings[_0x59234a(0x200b)][_0x59234a(0x882)](/\.offline-/g,_0x59234a(0xc4c));_0x3d1b12['textContent']=_0x20b5d3,document[_0x59234a(0x1e4c)][_0x59234a(0x1925)](_0x3d1b12);}if(offlineUISettings['fontSize']!==undefined){const _0x232f3c=_0x4da7b1[_0x59234a(0x1ed9)](_0x59234a(0x1123));_0x232f3c[_0x59234a(0x900)](_0x23b0bf=>{const _0x546be6=_0x59234a;_0x23b0bf['style'][_0x546be6(0x1ae6)]=offlineUISettings[_0x546be6(0x1ae6)]+'px';});}}async function resetOfflineUISettings(){const _0x41bf2e=_0x2cf6d4;if(confirm('确定要重置所有界面设置为默认值吗？')){offlineUISettings={'myBubbleColor':'#BED6EF','aiBubbleColor':_0x41bf2e(0x1679),'bubbleOpacity':0.9,'fontSize':0xf,'wallpaperData':'','fontFamily':'','fontUrl':'','userNormalTextColor':_0x41bf2e(0x1f42),'userItalicTextColor':'#333333','userBoldTextColor':_0x41bf2e(0x1f42),'aiNormalTextColor':'#000000','aiItalicTextColor':_0x41bf2e(0x1f39),'aiBoldTextColor':_0x41bf2e(0x17dc),'showUserAvatar':![],'showAiAvatar':![],'avatarPosition':'side','bubbleWidth':_0x41bf2e(0xbf),'bubbleStyle':'default','customCSS':'','savedColors':{'userNormal':[],'userItalic':[],'userBold':[],'aiNormal':[],'aiItalic':[],'aiBold':[]}},document[_0x41bf2e(0x566)](_0x41bf2e(0x7da))[_0x41bf2e(0xc34)]='';if(currentChatCharacter)try{await db[_0x41bf2e(0xe3d)][_0x41bf2e(0xc2b)](currentChatCharacter['id']+_0x41bf2e(0x11b4)),console[_0x41bf2e(0xc0d)]('✅\x20数据库中的设置已清除');}catch(_0x449237){console['error']('清除数据库设置失败:',_0x449237);}updateOfflineUISettingsForm(),updateOfflinePreview(),showToast('界面设置已重置',_0x41bf2e(0xb27));}}async function loadAndApplyOfflineUISettings(){const _0x1513ef=_0x2cf6d4;if(!currentChatCharacter)return;const _0x5c92f4=currentChatCharacter['id'];try{let _0x5cdb58=![];try{let _0x4a99e3=null;windowId&&(_0x4a99e3=await db[_0x1513ef(0xe3d)][_0x1513ef(0x46a)](_0x5c92f4+'_'+windowId+_0x1513ef(0x11b4)),_0x4a99e3&&_0x4a99e3[_0x1513ef(0x1fbb)]&&console[_0x1513ef(0xc0d)](_0x1513ef(0x13c)));!_0x4a99e3&&(_0x4a99e3=await db[_0x1513ef(0xe3d)][_0x1513ef(0x46a)](_0x5c92f4+_0x1513ef(0x11b4)),_0x4a99e3&&_0x4a99e3[_0x1513ef(0x1fbb)]&&console[_0x1513ef(0xc0d)](_0x1513ef(0x1da4)));if(!_0x4a99e3){const _0x19e3a0=await db['offlineUISettings'][_0x1513ef(0x4a6)](_0x1513ef(0x10df))[_0x1513ef(0x14a)](_0x5c92f4)[_0x1513ef(0x18c6)]();_0x19e3a0[_0x1513ef(0xcbf)]>0x0&&(_0x4a99e3=_0x19e3a0[_0x1513ef(0x1f0d)]((_0x2924f2,_0x3c6b2a)=>_0x3c6b2a[_0x1513ef(0x7aa)]-_0x2924f2[_0x1513ef(0x7aa)])[0x0],console[_0x1513ef(0xc0d)](_0x1513ef(0x1c32)));}_0x4a99e3&&_0x4a99e3['settings']&&(offlineUISettings=_0x4a99e3['settings'],_0x5cdb58=!![],console[_0x1513ef(0xc0d)](_0x1513ef(0x1e4)));}catch(_0x2c9964){console['warn'](_0x1513ef(0x206c),_0x2c9964);}if(!_0x5cdb58)try{let _0x57cf12=null,_0x16dff6=null;windowId&&(_0x16dff6=_0x1513ef(0x2111)+_0x5c92f4+'_'+windowId,_0x57cf12=localStorage[_0x1513ef(0x2250)](_0x16dff6));!_0x57cf12&&(_0x16dff6='offlineUISettings_'+_0x5c92f4,_0x57cf12=localStorage['getItem'](_0x16dff6));if(_0x57cf12){offlineUISettings=JSON[_0x1513ef(0x168e)](_0x57cf12);if(!offlineUISettings[_0x1513ef(0xde4)])try{let _0x20d1de=null;windowId&&(_0x20d1de=await db[_0x1513ef(0xe3d)][_0x1513ef(0x46a)](_0x5c92f4+'_'+windowId+_0x1513ef(0x11b4))),!_0x20d1de&&(_0x20d1de=await db[_0x1513ef(0xe3d)][_0x1513ef(0x46a)](_0x5c92f4+_0x1513ef(0x11b4))),_0x20d1de&&_0x20d1de[_0x1513ef(0x1fbb)]&&_0x20d1de[_0x1513ef(0x1fbb)]['wallpaperData']&&(offlineUISettings[_0x1513ef(0xde4)]=_0x20d1de['settings'][_0x1513ef(0xde4)],console[_0x1513ef(0xc0d)](_0x1513ef(0x1f9f)));}catch(_0x33f3e9){console[_0x1513ef(0x17cc)](_0x1513ef(0x18ed),_0x33f3e9);}_0x5cdb58=!![],console[_0x1513ef(0xc0d)]('✅\x20从localStorage加载线下模式界面设置成功\x20('+_0x16dff6+')');}}catch(_0x271a33){console[_0x1513ef(0x17cc)](_0x1513ef(0x1cf5),_0x271a33);}_0x5cdb58&&(applyOfflineUISettings(),console[_0x1513ef(0xc0d)](_0x1513ef(0xca1)));}catch(_0x14df8a){console[_0x1513ef(0x24ab)](_0x1513ef(0x693),_0x14df8a);}}function selectAvatarPosition(_0x323c22,_0x22b424){const _0x140e10=_0x2cf6d4,_0x11eb7d=_0x22b424[_0x140e10(0xe9)][_0x140e10(0x1ed9)](_0x140e10(0xc3d));_0x11eb7d[_0x140e10(0x900)](_0x3d8857=>_0x3d8857[_0x140e10(0x226e)]['remove']('selected')),_0x22b424[_0x140e10(0x226e)][_0x140e10(0xe1)](_0x140e10(0x876));const _0x508110=_0x22b424[_0x140e10(0xe9)][_0x140e10(0x1ed9)](_0x140e10(0x662));_0x508110['forEach'](_0xf63f64=>{const _0x3a8338=_0x140e10;_0xf63f64[_0x3a8338(0x306)]=_0xf63f64[_0x3a8338(0xc34)]===_0x323c22;});}function selectBubbleWidth(_0x1a77ef,_0x1d24b9){const _0x5c6d2b=_0x2cf6d4,_0xaa8d86=_0x1d24b9[_0x5c6d2b(0xe9)]['querySelectorAll'](_0x5c6d2b(0xc3d));_0xaa8d86['forEach'](_0x1cfa6d=>_0x1cfa6d['classList'][_0x5c6d2b(0x128)](_0x5c6d2b(0x876))),_0x1d24b9['classList']['add']('selected');const _0x5e1392=_0x1d24b9[_0x5c6d2b(0xe9)][_0x5c6d2b(0x1ed9)](_0x5c6d2b(0x751));_0x5e1392[_0x5c6d2b(0x900)](_0x3a394a=>{const _0x5c633f=_0x5c6d2b;_0x3a394a['checked']=_0x3a394a[_0x5c633f(0xc34)]===_0x1a77ef;});}function selectBubbleStyle(_0x1bd6d9,_0x57a8d4){const _0x9ca9aa=_0x2cf6d4,_0x2e5ec0=_0x57a8d4[_0x9ca9aa(0xe9)][_0x9ca9aa(0x1ed9)](_0x9ca9aa(0xc3d));_0x2e5ec0[_0x9ca9aa(0x900)](_0x3a178d=>_0x3a178d[_0x9ca9aa(0x226e)][_0x9ca9aa(0x128)](_0x9ca9aa(0x876))),_0x57a8d4[_0x9ca9aa(0x226e)][_0x9ca9aa(0xe1)](_0x9ca9aa(0x876));const _0x5c6ff2=_0x57a8d4[_0x9ca9aa(0xe9)][_0x9ca9aa(0x1ed9)]('input[name=\x22offline-bubble-style\x22]');_0x5c6ff2[_0x9ca9aa(0x900)](_0x57ee92=>{const _0x4a18ef=_0x9ca9aa;_0x57ee92[_0x4a18ef(0x306)]=_0x57ee92[_0x4a18ef(0xc34)]===_0x1bd6d9;});}document[_0x2cf6d4(0x167)](_0x2cf6d4(0x346),function(){const _0x3b9fef=_0x2cf6d4,_0x2e5421=document[_0x3b9fef(0x566)](_0x3b9fef(0x2379));if(!_0x2e5421)return;if(document[_0x3b9fef(0x2415)]===_0x3b9fef(0x1e35)){console[_0x3b9fef(0xc0d)](_0x3b9fef(0xcac)),_0x2e5421[_0x3b9fef(0x655)][_0x3b9fef(0xb15)]='running';const _0x26dffb=document[_0x3b9fef(0x1ed9)](_0x3b9fef(0x1439));_0x26dffb[_0x3b9fef(0x900)](_0x40a3f7=>_0x40a3f7[_0x3b9fef(0x655)][_0x3b9fef(0xb15)]='running'),_0x2e5421[_0x3b9fef(0x655)]['opacity']=_0x3b9fef(0x250d),setTimeout(()=>{const _0x540e9d=_0x3b9fef;_0x2e5421[_0x540e9d(0x655)][_0x540e9d(0x671)]='1';},0x10);if(typeof updateTime==='function'){}}else{console[_0x3b9fef(0xc0d)]('💤\x20页面已隐藏，暂停动画以节省资源...'),_0x2e5421[_0x3b9fef(0x655)]['animationPlayState']=_0x3b9fef(0x20d5);const _0x4d4ab0=document[_0x3b9fef(0x1ed9)](_0x3b9fef(0x1439));_0x4d4ab0[_0x3b9fef(0x900)](_0x1651e8=>_0x1651e8[_0x3b9fef(0x655)]['animationPlayState']=_0x3b9fef(0x20d5));}});function showMakeNewsModal(){const _0x45f985=_0x2cf6d4,_0x4e29e6=_0x45f985(0x21f);document['body']['insertAdjacentHTML'](_0x45f985(0x580),_0x4e29e6),setTimeout(()=>document['getElementById'](_0x45f985(0x20e1))[_0x45f985(0x1b12)](),0x64);}function submitMakeNews(){const _0x406239=_0x2cf6d4,_0x3aea05=document[_0x406239(0x566)](_0x406239(0x20e1)),_0x429956=_0x3aea05[_0x406239(0xc34)]['trim']();if(!_0x429956){alert('请输入事件内容！');return;}if(!currentForumId){alert(_0x406239(0xae6));return;}worldEvent={'content':_0x429956,'expires':Date[_0x406239(0x18e0)]()+0x18*0x3c*0x3c*0x3e8},worldEventForumId=currentForumId;const _0x202d70=document[_0x406239(0x566)](_0x406239(0xa9e));if(_0x202d70)_0x202d70['remove']();showToast(_0x406239(0xc10),_0x406239(0xb27)),console[_0x406239(0xc0d)](_0x406239(0x19f1)+currentForumId+_0x406239(0x11d8)+_0x429956),refreshPosts();}function switchProfileTab(_0x1aedf3){const _0x474b82=_0x2cf6d4,_0x1400bd=document[_0x474b82(0x566)]('my-posts-list'),_0x15b8cc=document['getElementById'](_0x474b82(0x230)),_0x2b763b=document[_0x474b82(0x1ed9)](_0x474b82(0x3e1));_0x2b763b['forEach'](_0x4eee62=>_0x4eee62[_0x474b82(0x226e)][_0x474b82(0x128)]('active')),document[_0x474b82(0x15b8)](_0x474b82(0x2c4)+_0x1aedf3+'\x22]')[_0x474b82(0x226e)][_0x474b82(0xe1)](_0x474b82(0x105d)),_0x1aedf3===_0x474b82(0x179c)?(_0x1400bd['style']['display']=_0x474b82(0x2d4),_0x15b8cc['style'][_0x474b82(0x2526)]='none'):(_0x1400bd[_0x474b82(0x655)]['display']=_0x474b82(0xfe9),_0x15b8cc['style'][_0x474b82(0x2526)]=_0x474b82(0x2d4)),isForumMultiSelectMode&&(selectedPostIds[_0x474b82(0x2215)](),renderPostsWithCheckboxes(),updateDeleteButtonState());}async function showSharePostModal(){const _0x25b423=_0x2cf6d4,_0x3ff79f=[];characters[_0x25b423(0x900)](_0x25486c=>{const _0x2e2f02=_0x25b423;contacts[_0x2e2f02(0x23ec)](_0x25486c['id'])&&_0x3ff79f['push']({'id':_0x25486c['id'],'name':_0x25486c[_0x2e2f02(0x222f)],'avatarUrl':_0x25486c[_0x2e2f02(0x10f9)],'isGroup':![]});}),groupChats[_0x25b423(0x900)](_0x3a3d34=>{const _0x443a50=_0x25b423;_0x3ff79f['push']({'id':_0x3a3d34['id'],'name':_0x3a3d34[_0x443a50(0x222f)],'avatarUrl':_0x3a3d34[_0x443a50(0x10f9)],'isGroup':!![]});});const _0x3bac29='\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22share-post-modal\x22\x20class=\x22modal\x22\x20style=\x22display:\x20flex;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22modal-title\x22>分享到...</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-close\x22\x20onclick=\x22this.closest(\x27.modal\x27).remove()\x22>&times;</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22\x20style=\x22max-height:\x20400px;\x20overflow-y:\x20auto;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x3ff79f['map'](_0x410cc4=>_0x25b423(0x1586)+_0x410cc4['id']+'\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-option-icon\x22\x20style=\x22background-image:\x20url(\x27'+(_0x410cc4[_0x25b423(0x10f9)]||createDefaultAvatar(_0x410cc4[_0x25b423(0x222f)]))+_0x25b423(0x189c)+(_0x410cc4[_0x25b423(0x4b7)]&&!_0x410cc4[_0x25b423(0x10f9)]?'群':'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-option-text\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-option-title\x22>'+_0x410cc4[_0x25b423(0x222f)]+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20')[_0x25b423(0x140c)]('')+_0x25b423(0xcd8);document[_0x25b423(0x172c)][_0x25b423(0x22ba)]('beforeend',_0x3bac29);}async function sharePostToChat(_0x477c88){const _0x5b03ee=_0x2cf6d4;if(!window[_0x5b03ee(0x11bf)])return;try{const _0x1409c1=await db[_0x5b03ee(0x1f71)][_0x5b03ee(0x46a)](window['currentPostId']);if(!_0x1409c1){showToast(_0x5b03ee(0x5b1),_0x5b03ee(0x24ab));return;}const _0x2beaf5=await db[_0x5b03ee(0x1a13)][_0x5b03ee(0x46a)](parseInt(currentForumId)),_0x2222c0=personas[_0x5b03ee(0x1aeb)](_0x261168=>_0x261168['id']===_0x2beaf5['personaId']),_0xa79a54=await db[_0x5b03ee(0x1d3c)]['where'](_0x5b03ee(0x12b6))[_0x5b03ee(0x14a)](window[_0x5b03ee(0x11bf)])[_0x5b03ee(0xa3b)](_0x5b03ee(0x7aa));let _0x32acb3=_0x5b03ee(0x656)+_0x1409c1[_0x5b03ee(0x1c18)]+_0x5b03ee(0xd6c)+_0x1409c1[_0x5b03ee(0x16c3)]+_0x5b03ee(0x17b2)+_0x1409c1['content'];_0xa79a54&&_0xa79a54[_0x5b03ee(0xcbf)]>0x0&&(_0x32acb3+=_0x5b03ee(0x7f2),_0xa79a54[_0x5b03ee(0x900)]((_0x146731,_0x4c7cc3)=>{const _0x19bfb8=_0x5b03ee,_0x4b1050=new Date(_0x146731[_0x19bfb8(0x7aa)])['toLocaleString'](_0x19bfb8(0x1c0b),{'month':'2-digit','day':_0x19bfb8(0x19f3),'hour':_0x19bfb8(0x19f3),'minute':_0x19bfb8(0x19f3)});let _0x2f31bf=_0x146731[_0x19bfb8(0x16c3)];if(_0x146731['isAnonymous']&&_0x146731[_0x19bfb8(0x3df)]==='user')_0x2f31bf=_0x146731[_0x19bfb8(0x16c3)];else _0x146731[_0x19bfb8(0x3df)]==='user'&&!_0x146731['isAnonymous']&&(_0x2f31bf=_0x2222c0?_0x2222c0[_0x19bfb8(0x222f)]:_0x146731[_0x19bfb8(0x16c3)]);_0x32acb3+='\x0a'+(_0x4c7cc3+0x1)+'楼\x20'+_0x2f31bf+'\x20('+_0x4b1050+'):\x0a'+_0x146731[_0x19bfb8(0x1423)]+'\x0a';}));const _0x488b83=(_0x1409c1['content']||'')[_0x5b03ee(0x882)](/<[^>]*>/g,'\x20')['replace'](/\s+/g,'\x20')[_0x5b03ee(0x1424)](),_0x279532={'id':Date['now']()[_0x5b03ee(0x9a3)](),'sender':'sent','type':_0x5b03ee(0xe70),'postData':{'id':_0x1409c1['id'],'title':_0x1409c1['title'],'authorName':_0x1409c1[_0x5b03ee(0x16c3)],'content':_0x488b83,'replies':_0xa79a54},'timestamp':Date[_0x5b03ee(0x18e0)](),'senderName':_0x2222c0[_0x5b03ee(0x222f)],'content':_0x32acb3};!chatMessages[_0x477c88]&&(chatMessages[_0x477c88]=[]);chatMessages[_0x477c88]['push'](_0x279532);try{const _0x59bb63=_0x477c88+'_'+_0x279532['id']+'_'+(chatMessages[_0x477c88][_0x5b03ee(0xcbf)]-0x1);await db[_0x5b03ee(0x464)][_0x5b03ee(0xe1)]({'id':_0x59bb63,'characterId':_0x477c88,'timestamp':_0x279532[_0x5b03ee(0x7aa)],'messageOrder':chatMessages[_0x477c88]['length']-0x1,'originalMessageId':_0x279532['id'],'messageData':_0x279532}),console['log'](_0x5b03ee(0xb4e));}catch(_0x4b2944){console[_0x5b03ee(0x24ab)](_0x5b03ee(0x1fcc),_0x4b2944),await saveChatMessages();}const _0x349c5c=document[_0x5b03ee(0x566)](_0x5b03ee(0xe2d));if(_0x349c5c)_0x349c5c[_0x5b03ee(0x128)]();showToast(_0x5b03ee(0x1363),_0x5b03ee(0xb27)),currentChatCharacter&&currentChatCharacter['id']===_0x477c88&&renderChatMessages(_0x477c88),renderMessageList();}catch(_0x15cdb6){console[_0x5b03ee(0x24ab)](_0x5b03ee(0xfa1),_0x15cdb6),showToast(_0x5b03ee(0x772),_0x5b03ee(0x24ab));}}document[_0x2cf6d4(0x167)]('DOMContentLoaded',function(){const _0x3d26fe=_0x2cf6d4,_0x417a01=document['getElementById']('local-music-input');_0x417a01&&_0x417a01[_0x3d26fe(0x167)](_0x3d26fe(0x17ef),function(_0x533a09){const _0x2078f1=_0x3d26fe,_0x2c7167=_0x533a09[_0x2078f1(0x1144)]['files'][0x0];if(_0x2c7167){const _0x239608=document[_0x2078f1(0x566)](_0x2078f1(0x218c)),_0x41b029=document[_0x2078f1(0x566)](_0x2078f1(0xa09));_0x239608['placeholder']='已选择:\x20'+_0x2c7167['name'],_0x239608['style']['color']=_0x2078f1(0x1f03),_0x239608[_0x2078f1(0xc34)]='',!_0x41b029['value'][_0x2078f1(0x1424)]()&&(_0x41b029['value']=_0x2c7167['name'][_0x2078f1(0x882)](/\.[^/.]+$/,''));}});const _0x56356b=document[_0x3d26fe(0x566)](_0x3d26fe(0x24fb));_0x56356b&&_0x56356b[_0x3d26fe(0x167)]('change',function(_0x3a44ea){const _0x5d7bef=_0x3d26fe,_0x5e5b8a=_0x3a44ea[_0x5d7bef(0x1144)][_0x5d7bef(0x173e)][0x0];if(_0x5e5b8a){const _0x3c816b=document[_0x5d7bef(0x566)](_0x5d7bef(0x1969)),_0x4eb085=_0x5e5b8a[_0x5d7bef(0x222f)][_0x5d7bef(0x1d64)]();let _0x251b50='歌词文件';if(_0x4eb085[_0x5d7bef(0xd7e)](_0x5d7bef(0x16e6)))_0x251b50=_0x5d7bef(0x573);else{if(_0x4eb085[_0x5d7bef(0xd7e)](_0x5d7bef(0x53b)))_0x251b50='bin歌词';else _0x4eb085[_0x5d7bef(0xd7e)](_0x5d7bef(0xd0a))?_0x251b50=_0x5d7bef(0x1044):(_0x251b50='文件',console[_0x5d7bef(0xc0d)](_0x5d7bef(0x14e2),_0x5e5b8a[_0x5d7bef(0x222f)]));}_0x3c816b&&(_0x3c816b[_0x5d7bef(0x21dc)]='已选择'+_0x251b50+':\x20'+_0x5e5b8a['name'],_0x3c816b[_0x5d7bef(0x655)]['display']=_0x5d7bef(0x2d4),_0x3c816b[_0x5d7bef(0x655)][_0x5d7bef(0x2099)]='#007AFF');}});});function closeModal(){const _0x36b5dd=_0x2cf6d4,_0x3077dd=document[_0x36b5dd(0x15b8)](_0x36b5dd(0x89c));_0x3077dd&&_0x3077dd[_0x36b5dd(0x128)]();}function clearVoteHistory(){const _0x4df656=_0x2cf6d4;if(confirm(_0x4df656(0x24eb)))try{Object['keys'](localStorage)['filter'](_0x35ae70=>_0x35ae70[_0x4df656(0x1cab)](_0x4df656(0x139))||_0x35ae70[_0x4df656(0x1cab)](_0x4df656(0xa7c)))[_0x4df656(0x900)](_0x34bcc7=>localStorage['removeItem'](_0x34bcc7)),showToast(_0x4df656(0x51d),_0x4df656(0xb27)),closeModal();}catch(_0xfc3ee5){console[_0x4df656(0x24ab)]('清空投票历史失败:',_0xfc3ee5),showToast(_0x4df656(0x2fc),'error');}}let isForumMultiSelectMode=![],selectedPostIds=new Set();function toggleMultiSelectMode(){const _0x5603cb=_0x2cf6d4;isForumMultiSelectMode=!isForumMultiSelectMode,selectedPostIds[_0x5603cb(0x2215)]();const _0x5b0d56=document[_0x5603cb(0x566)](_0x5603cb(0x19bf)),_0x536511=_0x5b0d56['querySelector']('i');isForumMultiSelectMode?(_0x536511[_0x5603cb(0x221)]='fas\x20fa-times',_0x5b0d56[_0x5603cb(0x1c18)]='退出多选',_0x5b0d56[_0x5603cb(0x655)][_0x5603cb(0x2099)]=_0x5603cb(0x919),renderPostsWithCheckboxes(),showDeleteButton()):(_0x536511['className']=_0x5603cb(0x57c),_0x5b0d56[_0x5603cb(0x1c18)]=_0x5603cb(0x152f),_0x5b0d56['style'][_0x5603cb(0x2099)]='',showForumProfile(),hideDeleteButton());}async function renderPostsWithCheckboxes(){const _0x51493a=_0x2cf6d4,_0x6c01b2=document['querySelector']('.profile-tab.active')[_0x51493a(0x21dc)];_0x6c01b2===_0x51493a(0x826)?await renderMyPostsWithCheckboxes():await renderFavoritePostsWithCheckboxes();}async function renderMyPostsWithCheckboxes(){const _0x48225a=_0x2cf6d4,_0x48c159=document['getElementById'](_0x48225a(0x181a)),_0x125169=await db['forumPosts'][_0x48225a(0x18c6)](),_0x5d8c2b=_0x125169['filter'](_0x3e68be=>_0x3e68be[_0x48225a(0xb7)]===!![])[_0x48225a(0x1f0d)]((_0x2321e0,_0x1a9d62)=>_0x1a9d62[_0x48225a(0x7aa)]-_0x2321e0[_0x48225a(0x7aa)]);if(_0x5d8c2b[_0x48225a(0xcbf)]===0x0){_0x48c159[_0x48225a(0xc02)]='<div\x20class=\x22forum-empty-state\x22><p>你还没有发过帖子</p></div>';return;}const _0x3c564e=await Promise[_0x48225a(0x2339)](_0x5d8c2b[_0x48225a(0xf6d)](async _0x51564c=>{const _0x3865f8=_0x48225a,_0x2fc486=await db[_0x3865f8(0x3b2)][_0x3865f8(0x4a6)]('postId')[_0x3865f8(0x14a)](_0x51564c['id'])[_0x3865f8(0x35e)]()>0x0,_0xfe4ba6=selectedPostIds['has'](_0x51564c['id']);return _0x3865f8(0x1a1)+(_0xfe4ba6?_0x3865f8(0x876):'')+'\x22\x20data-post-id=\x22'+_0x51564c['id']+_0x3865f8(0x1a83)+_0x51564c['id']+',\x20event)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-checkbox\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20'+(_0xfe4ba6?_0x3865f8(0x2fd):_0x3865f8(0xe84))+_0x3865f8(0x24f7)+_0x51564c[_0x3865f8(0x1c18)]+_0x3865f8(0x2010)+(_0x2fc486?_0x3865f8(0x22e1):'')+_0x3865f8(0x8c2)+_0x51564c[_0x3865f8(0x16c3)]+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>'+formatTime(_0x51564c['timestamp'])+_0x3865f8(0x12cc);}));_0x48c159[_0x48225a(0xc02)]=_0x3c564e['join']('');}async function renderFavoritePostsWithCheckboxes(){const _0x1f23a7=_0x2cf6d4,_0x56199a=document[_0x1f23a7(0x566)](_0x1f23a7(0x230)),_0x51b442=await db['forumFavorites'][_0x1f23a7(0x4a6)]('userId')[_0x1f23a7(0x14a)](_0x1f23a7(0x23b2))[_0x1f23a7(0x18c6)](),_0x2fb2d7=_0x51b442[_0x1f23a7(0xf6d)](_0x3a42f7=>_0x3a42f7[_0x1f23a7(0x12b6)]);if(_0x2fb2d7['length']===0x0){_0x56199a[_0x1f23a7(0xc02)]=_0x1f23a7(0x10e1);return;}const _0x519fe0=await db[_0x1f23a7(0x1f71)][_0x1f23a7(0x4a6)]('id')[_0x1f23a7(0xe07)](_0x2fb2d7)[_0x1f23a7(0x18c6)](),_0x58496e=await Promise['all'](_0x519fe0[_0x1f23a7(0x1f0d)]((_0x439ed0,_0x5bb9bf)=>_0x5bb9bf[_0x1f23a7(0x7aa)]-_0x439ed0[_0x1f23a7(0x7aa)])['map'](async _0x358589=>{const _0x412563=_0x1f23a7,_0x315374=await db[_0x412563(0x3b2)]['where'](_0x412563(0x12b6))[_0x412563(0x14a)](_0x358589['id'])[_0x412563(0x35e)]()>0x0,_0xe931f0=selectedPostIds['has'](_0x358589['id']);return _0x412563(0x1a1)+(_0xe931f0?_0x412563(0x876):'')+_0x412563(0x3b4)+_0x358589['id']+_0x412563(0x1a83)+_0x358589['id']+',\x20event)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-checkbox\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20'+(_0xe931f0?_0x412563(0x2fd):'fa-square')+_0x412563(0x24f7)+_0x358589[_0x412563(0x1c18)]+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x315374?'<svg\x20class=\x22image-post-badge\x22\x20viewBox=\x220\x200\x2024\x2024\x22><path\x20d=\x22M21\x2019V5c0-1.1-.9-2-2-2H5c-1.1\x200-2\x20.9-2\x202v14c0\x201.1.9\x202\x202\x202h14c1.1\x200\x202-.9\x202-2zM8.5\x2013.5l2.5\x203.01L14.5\x2012l4.5\x206H5l3.5-4.5z\x22/></svg>':'')+_0x412563(0x11c6)+(_0x358589['isUserPost']?'<span\x20class=\x22user-post-badge\x22>我</span>':'')+_0x412563(0x1eff)+_0x358589[_0x412563(0x16c3)]+_0x412563(0x18a4)+formatTime(_0x358589[_0x412563(0x7aa)])+_0x412563(0x12cc);}));_0x56199a[_0x1f23a7(0xc02)]=_0x58496e['join']('');}function togglePostSelection(_0x1486d1,_0x55a03b){const _0x552294=_0x2cf6d4;_0x55a03b[_0x552294(0x1023)]();const _0x4f5754=document[_0x552294(0x15b8)](_0x552294(0x21eb)+_0x1486d1+'\x22]'),_0x2e870e=_0x4f5754[_0x552294(0x15b8)](_0x552294(0xf0c));selectedPostIds['has'](_0x1486d1)?(selectedPostIds[_0x552294(0xc2b)](_0x1486d1),_0x4f5754[_0x552294(0x226e)][_0x552294(0x128)](_0x552294(0x876)),_0x2e870e[_0x552294(0x221)]=_0x552294(0x1af)):(selectedPostIds['add'](_0x1486d1),_0x4f5754['classList'][_0x552294(0xe1)](_0x552294(0x876)),_0x2e870e[_0x552294(0x221)]=_0x552294(0x143e)),updateDeleteButtonState();}function showDeleteButton(){const _0x3d3ff8=_0x2cf6d4,_0x899cd7=document[_0x3d3ff8(0x566)](_0x3d3ff8(0xed2));if(_0x899cd7)return;const _0x4d82ce=document[_0x3d3ff8(0x1ad8)]('div');_0x4d82ce['id']=_0x3d3ff8(0xed2),_0x4d82ce[_0x3d3ff8(0x221)]=_0x3d3ff8(0x1540),_0x4d82ce[_0x3d3ff8(0xc02)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22select-all-btn\x22\x20onclick=\x22toggleSelectAll()\x22\x20title=\x22全选/取消全选\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-check-double\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22delete-action-btn\x22\x20onclick=\x22confirmDeleteSelectedPosts()\x22\x20title=\x22删除选中的帖子\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-trash\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22selected-count\x22>0</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22cancel-action-btn\x22\x20onclick=\x22toggleMultiSelectMode()\x22\x20title=\x22取消多选模式\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20取消\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',document[_0x3d3ff8(0x566)]('forum-profile-screen')['appendChild'](_0x4d82ce);}function hideDeleteButton(){const _0x1defb2=_0x2cf6d4,_0xa062ba=document[_0x1defb2(0x566)](_0x1defb2(0xed2));_0xa062ba&&_0xa062ba[_0x1defb2(0x128)]();}function updateDeleteButtonState(){const _0x48920c=_0x2cf6d4,_0x130f9c=document[_0x48920c(0x566)](_0x48920c(0x1e5c)),_0x2a2bcd=document['getElementById']('multi-delete-btn');_0x130f9c&&(_0x130f9c[_0x48920c(0x21dc)]=selectedPostIds[_0x48920c(0x41a)]),_0x2a2bcd&&(_0x2a2bcd[_0x48920c(0x655)][_0x48920c(0x671)]=selectedPostIds[_0x48920c(0x41a)]>0x0?'1':_0x48920c(0x1ffd),_0x2a2bcd[_0x48920c(0x655)][_0x48920c(0x20d6)]=selectedPostIds['size']>0x0?_0x48920c(0x153f):'none');}async function confirmDeleteSelectedPosts(){const _0x37d959=_0x2cf6d4;if(selectedPostIds['size']===0x0){showToast('请先选择要删除的帖子',_0x37d959(0x13bb));return;}const _0x4febc6=document[_0x37d959(0x15b8)](_0x37d959(0x653))['textContent'],_0x35455e=_0x4febc6===_0x37d959(0x826)?_0x37d959(0x21d2):_0x37d959(0x607);if(!confirm(_0x37d959(0xd00)+_0x35455e+'吗？共\x20'+selectedPostIds['size']+'\x20个项目。'+(_0x4febc6===_0x37d959(0x826)?_0x37d959(0x6ca):'')))return;try{_0x4febc6==='我的帖子'?await deleteSelectedPosts():await unfavoriteSelectedPosts(),showToast('成功'+_0x35455e,_0x37d959(0xb27)),toggleMultiSelectMode(),await showForumProfile();}catch(_0x5ba394){console[_0x37d959(0x24ab)](_0x37d959(0x1358),_0x5ba394),showToast(_0x37d959(0x2ba),_0x37d959(0x24ab));}}async function deleteSelectedPosts(){const _0xcf14c3=_0x2cf6d4,_0x47c31b=Array[_0xcf14c3(0x2308)](selectedPostIds);await Promise[_0xcf14c3(0x2339)]([db[_0xcf14c3(0x1f71)][_0xcf14c3(0x4a6)]('id')[_0xcf14c3(0xe07)](_0x47c31b)['delete'](),db[_0xcf14c3(0x1d3c)]['where']('postId')['anyOf'](_0x47c31b)[_0xcf14c3(0xc2b)](),db[_0xcf14c3(0x1dd3)][_0xcf14c3(0x4a6)]('postId')[_0xcf14c3(0xe07)](_0x47c31b)['delete'](),db['forumPostImages'][_0xcf14c3(0x4a6)](_0xcf14c3(0x12b6))[_0xcf14c3(0xe07)](_0x47c31b)[_0xcf14c3(0xc2b)](),db[_0xcf14c3(0x11ba)]['where'](_0xcf14c3(0x12b6))['anyOf'](_0x47c31b)['delete']()]);}async function unfavoriteSelectedPosts(){const _0x1f7966=_0x2cf6d4,_0x3c5e4e=Array[_0x1f7966(0x2308)](selectedPostIds);await db[_0x1f7966(0x1dd3)]['where'](_0x1f7966(0x12b6))['anyOf'](_0x3c5e4e)[_0x1f7966(0x1534)](_0x1d839e=>_0x1d839e[_0x1f7966(0x193)]===_0x1f7966(0x23b2))[_0x1f7966(0xc2b)]();}function toggleSelectAll(){const _0x2690c0=_0x2cf6d4,_0x184d54=document[_0x2690c0(0x1ed9)](_0x2690c0(0x198a)),_0x39f278=Array['from'](_0x184d54)[_0x2690c0(0xf6d)](_0x125b8e=>parseInt(_0x125b8e['dataset'][_0x2690c0(0x12b6)])),_0x49be10=_0x39f278[_0x2690c0(0xb05)](_0x51199f=>selectedPostIds['has'](_0x51199f));_0x49be10?(selectedPostIds[_0x2690c0(0x2215)](),_0x184d54[_0x2690c0(0x900)](_0x3053e3=>{const _0x363bc1=_0x2690c0;_0x3053e3['classList'][_0x363bc1(0x128)](_0x363bc1(0x876));const _0x1c69cc=_0x3053e3[_0x363bc1(0x15b8)](_0x363bc1(0xf0c));_0x1c69cc[_0x363bc1(0x221)]=_0x363bc1(0x1af);})):(_0x39f278['forEach'](_0x279735=>selectedPostIds[_0x2690c0(0xe1)](_0x279735)),_0x184d54[_0x2690c0(0x900)](_0x5c5f3b=>{const _0x414cd5=_0x2690c0;_0x5c5f3b[_0x414cd5(0x226e)][_0x414cd5(0xe1)](_0x414cd5(0x876));const _0x564f5e=_0x5c5f3b[_0x414cd5(0x15b8)]('.post-checkbox\x20i');_0x564f5e['className']=_0x414cd5(0x143e);})),updateDeleteButtonState();}function startEmojiSelection(){const _0x321047=_0x2cf6d4;document[_0x321047(0x566)](_0x321047(0x1a53))[_0x321047(0x655)][_0x321047(0x2526)]=_0x321047(0xfe9),document['getElementById'](_0x321047(0xa74))[_0x321047(0x655)][_0x321047(0x2526)]='flex';const _0x1bd377=document[_0x321047(0x1ed9)](_0x321047(0x1832));_0x1bd377[_0x321047(0x900)](_0xe2ba24=>_0xe2ba24[_0x321047(0x655)][_0x321047(0x2526)]=_0x321047(0x2d4));}function selectAllEmojis(){const _0xbdef28=_0x2cf6d4,_0x3d1646=document[_0xbdef28(0x1ed9)](_0xbdef28(0x1832));_0x3d1646[_0xbdef28(0x900)](_0x3294e8=>_0x3294e8['checked']=!![]);}async function deleteSelectedEmojis(){const _0x44368d=_0x2cf6d4,_0x576362=document[_0x44368d(0x1ed9)]('.emoji-checkbox:checked');if(_0x576362[_0x44368d(0xcbf)]===0x0){alert(_0x44368d(0x1cb7));return;}if(!confirm('确定要彻底删除选中的\x20'+_0x576362[_0x44368d(0xcbf)]+_0x44368d(0x18ec)))return;try{for(const _0x40f7cf of _0x576362){await removeEmojiFromLibrary(_0x40f7cf[_0x44368d(0x1f26)][_0x44368d(0x1a7)]);}showToast(_0x44368d(0x174f)+_0x576362[_0x44368d(0xcbf)]+'\x20个表情包',_0x44368d(0xb27));}catch(_0x5e457f){console[_0x44368d(0x24ab)]('批量删除失败:',_0x5e457f),showToast('删除失败',_0x44368d(0x24ab));}cancelSelection();}function cancelSelection(){const _0x23d37c=_0x2cf6d4;document[_0x23d37c(0x566)]('start-selection-btn')[_0x23d37c(0x655)][_0x23d37c(0x2526)]=_0x23d37c(0x2d4),document[_0x23d37c(0x566)](_0x23d37c(0xa74))['style'][_0x23d37c(0x2526)]=_0x23d37c(0xfe9);const _0x1b62a2=document[_0x23d37c(0x1ed9)](_0x23d37c(0x1832));_0x1b62a2[_0x23d37c(0x900)](_0x485848=>{const _0x3cefbc=_0x23d37c;_0x485848[_0x3cefbc(0x655)][_0x3cefbc(0x2526)]='none',_0x485848[_0x3cefbc(0x306)]=![];});}async function testRegenerateTimelineCleanup(){const _0xfd0bc3=_0x2cf6d4;console[_0xfd0bc3(0xc0d)](_0xfd0bc3(0x234b));if(!currentChatCharacter){console[_0xfd0bc3(0xc0d)]('❌\x20请先选择一个角色');return;}const _0x346287=currentChatCharacter['id'];try{const _0x45e618=await getCrossAppTimeline(_0x346287,0x32);console[_0xfd0bc3(0xc0d)](_0xfd0bc3(0xbed)+_0x45e618[_0xfd0bc3(0xcbf)]);const _0x3bf08f={'id':_0xfd0bc3(0x354)+Date[_0xfd0bc3(0x18e0)](),'sender':_0xfd0bc3(0x232),'content':_0xfd0bc3(0x11b8),'timestamp':Date['now']()};!chatMessages[_0x346287]&&(chatMessages[_0x346287]=[]);chatMessages[_0x346287][_0xfd0bc3(0x6ee)](_0x3bf08f),await recordCrossAppEvent(_0x346287,'chat',_0xfd0bc3(0x21bf),{'content':_0x3bf08f[_0xfd0bc3(0x1423)],'id':_0x346287,'type':_0xfd0bc3(0x10d7),'sender':'ai'},_0x3bf08f['id']),await new Promise(_0x20e0df=>setTimeout(_0x20e0df,0x1f4));const _0x5be3ea=await getCrossAppTimeline(_0x346287,0x32);console[_0xfd0bc3(0xc0d)](_0xfd0bc3(0x472)+_0x5be3ea[_0xfd0bc3(0xcbf)]),console[_0xfd0bc3(0xc0d)]('🔄\x20调用重回功能...'),await regenerateLastResponse(),await new Promise(_0x12b282=>setTimeout(_0x12b282,0x3e8));const _0x3f8e43=await getCrossAppTimeline(_0x346287,0x32);console[_0xfd0bc3(0xc0d)](_0xfd0bc3(0x1c94)+_0x3f8e43[_0xfd0bc3(0xcbf)]);const _0x206a18=_0x3f8e43[_0xfd0bc3(0x803)](_0x12155e=>_0x12155e[_0xfd0bc3(0x30b)]?.[_0xfd0bc3(0x1423)]?.[_0xfd0bc3(0x23ec)](_0xfd0bc3(0x2337)));_0x206a18[_0xfd0bc3(0xcbf)]===0x0?console[_0xfd0bc3(0xc0d)](_0xfd0bc3(0xe60)):(console[_0xfd0bc3(0xc0d)](_0xfd0bc3(0xe95)),console['log']('🔍\x20残留的时间线记录:',_0x206a18));}catch(_0x5559c3){console[_0xfd0bc3(0x24ab)](_0xfd0bc3(0x550),_0x5559c3);}}async function testOfflineContinuationRegenerate(){const _0x58d15f=_0x2cf6d4;console[_0x58d15f(0xc0d)](_0x58d15f(0x1539));if(!currentChatCharacter){console['log'](_0x58d15f(0x1db));return;}try{console['log'](_0x58d15f(0x23b1)),offlineMessages['length']=0x0;const _0x4d9080={'id':'user_'+Date['now'](),'sender':'user','content':'今天天气真好','timestamp':new Date()[_0x58d15f(0xa4b)]()};offlineMessages['push'](_0x4d9080);const _0x3d0a8f={'id':'ai_reply_'+Date['now'](),'sender':'ai','content':_0x58d15f(0x1a52),'timestamp':new Date()[_0x58d15f(0xa4b)]()};offlineMessages[_0x58d15f(0x6ee)](_0x3d0a8f);const _0x23b458={'id':'ai_continue_'+Date[_0x58d15f(0x18e0)](),'sender':'ai','content':_0x58d15f(0xee9),'timestamp':new Date()['toISOString']()};offlineMessages[_0x58d15f(0x6ee)](_0x23b458),console['log'](_0x58d15f(0xd23),offlineMessages[_0x58d15f(0xf6d)](_0x3c07ab=>_0x3c07ab[_0x58d15f(0xf75)]+':\x20'+_0x3c07ab[_0x58d15f(0x1423)])),console['log'](_0x58d15f(0x2a8));const _0x40d0c6=offlineMessages[_0x58d15f(0x23ba)](_0x592b80=>_0x592b80['id']===_0x3d0a8f['id']);console[_0x58d15f(0xc0d)](_0x58d15f(0x18b5)+_0x40d0c6);let _0x5f2ca9=![];for(let _0x3440b7=_0x40d0c6+0x1;_0x3440b7<offlineMessages[_0x58d15f(0xcbf)];_0x3440b7++){if(offlineMessages[_0x3440b7][_0x58d15f(0xf75)]===_0x58d15f(0x23b2)){_0x5f2ca9=!![];break;}}let _0x18774e=_0x40d0c6>0x0&&offlineMessages[_0x40d0c6-0x1][_0x58d15f(0xf75)]==='ai',_0x388765=!_0x5f2ca9&&_0x18774e;console['log'](_0x58d15f(0x3f9)+_0x5f2ca9+_0x58d15f(0x15de)+_0x18774e+_0x58d15f(0x935)+_0x388765),console[_0x58d15f(0xc0d)](_0x58d15f(0x155)+(_0x388765?_0x58d15f(0x1480):'正常回复')+'\x20(期望:\x20正常回复)'),console[_0x58d15f(0xc0d)](_0x58d15f(0x9a1));const _0x29337b=offlineMessages['findIndex'](_0x36aa7e=>_0x36aa7e['id']===_0x23b458['id']);console['log'](_0x58d15f(0x2395)+_0x29337b);let _0x43c0e7=![];for(let _0x62ad69=_0x29337b+0x1;_0x62ad69<offlineMessages[_0x58d15f(0xcbf)];_0x62ad69++){if(offlineMessages[_0x62ad69]['sender']===_0x58d15f(0x23b2)){_0x43c0e7=!![];break;}}let _0x4e29cb=_0x29337b>0x0&&offlineMessages[_0x29337b-0x1][_0x58d15f(0xf75)]==='ai',_0x50135b=!_0x43c0e7&&_0x4e29cb;console[_0x58d15f(0xc0d)]('📊\x20续写消息分析:\x20hasUserAfter='+_0x43c0e7+',\x20isPrevAI='+_0x4e29cb+_0x58d15f(0x935)+_0x50135b),console[_0x58d15f(0xc0d)]('✅\x20续写消息应该被识别为:\x20'+(_0x50135b?_0x58d15f(0x1480):_0x58d15f(0x1073))+_0x58d15f(0xc86));const _0x2afe29=!_0x388765,_0x6c8130=_0x50135b;_0x2afe29&&_0x6c8130?console[_0x58d15f(0xc0d)](_0x58d15f(0x256a)):(console[_0x58d15f(0xc0d)]('❌\x20测试失败！线下模式续写重新生成逻辑有问题'),console[_0x58d15f(0xc0d)](_0x58d15f(0xd5f)+(_0x2afe29?'✅':'❌')),console['log'](_0x58d15f(0x144)+(_0x6c8130?'✅':'❌')));}catch(_0x4b81d5){console['error'](_0x58d15f(0x550),_0x4b81d5);}}function isDesktop(){const _0x21a97c=_0x2cf6d4;return window[_0x21a97c(0x2145)]>0x300&&!(_0x21a97c(0x1448)in window);}if(isDesktop()){document['addEventListener'](_0x2cf6d4(0xd3e),function(_0x4dc024){const _0x4f8b66=_0x2cf6d4;return _0x4dc024[_0x4f8b66(0x4d9)](),![];}),document[_0x2cf6d4(0x167)]('keydown',function(_0x56fe8d){const _0xeb1ff4=_0x2cf6d4;if(_0x56fe8d['ctrlKey']&&_0x56fe8d[_0xeb1ff4(0x157f)]==='a')return _0x56fe8d[_0xeb1ff4(0x4d9)](),![];if(_0x56fe8d['ctrlKey']&&_0x56fe8d[_0xeb1ff4(0x157f)]==='c')return _0x56fe8d[_0xeb1ff4(0x4d9)](),![];if(_0x56fe8d[_0xeb1ff4(0x1870)]&&_0x56fe8d[_0xeb1ff4(0x157f)]==='v')return _0x56fe8d['preventDefault'](),![];if(_0x56fe8d[_0xeb1ff4(0x1870)]&&_0x56fe8d[_0xeb1ff4(0x157f)]==='x')return _0x56fe8d['preventDefault'](),![];if(_0x56fe8d[_0xeb1ff4(0x1870)]&&_0x56fe8d[_0xeb1ff4(0x157f)]==='s')return _0x56fe8d[_0xeb1ff4(0x4d9)](),![];if(_0x56fe8d['ctrlKey']&&_0x56fe8d[_0xeb1ff4(0x157f)]==='u')return _0x56fe8d['preventDefault'](),![];if(_0x56fe8d['ctrlKey']&&_0x56fe8d[_0xeb1ff4(0x1dad)]&&_0x56fe8d[_0xeb1ff4(0x157f)]==='I')return _0x56fe8d[_0xeb1ff4(0x4d9)](),![];if(_0x56fe8d['key']===_0xeb1ff4(0x11e8))return _0x56fe8d[_0xeb1ff4(0x4d9)](),![];if(_0x56fe8d[_0xeb1ff4(0x1870)]&&_0x56fe8d[_0xeb1ff4(0x1dad)]&&_0x56fe8d[_0xeb1ff4(0x157f)]==='J')return _0x56fe8d['preventDefault'](),![];if(_0x56fe8d[_0xeb1ff4(0x1870)]&&_0x56fe8d[_0xeb1ff4(0x1dad)]&&_0x56fe8d['key']==='C')return _0x56fe8d['preventDefault'](),![];}),document[_0x2cf6d4(0x167)](_0x2cf6d4(0x164b),function(_0x38fb54){const _0x4f8d44=_0x2cf6d4;return _0x38fb54[_0x4f8d44(0x4d9)](),![];}),document['addEventListener'](_0x2cf6d4(0x173),function(_0x20a550){const _0x42e019=_0x2cf6d4;return _0x20a550[_0x42e019(0x4d9)](),![];});let devtools={'open':![],'orientation':null};setInterval(function(){const _0x1b3b02=_0x2cf6d4;window['outerHeight']-window['innerHeight']>0xa0||window['outerWidth']-window[_0x1b3b02(0x2145)]>0xa0?!devtools[_0x1b3b02(0x11cc)]&&(devtools[_0x1b3b02(0x11cc)]=!![],console[_0x1b3b02(0x2215)](),console[_0x1b3b02(0xc0d)](_0x1b3b02(0x2344),'color:\x20red;\x20font-size:\x2020px;\x20font-weight:\x20bold;')):devtools[_0x1b3b02(0x11cc)]=![];},0x1f4),typeof console!=='undefined'&&(console[_0x2cf6d4(0x2215)](),console[_0x2cf6d4(0xc0d)](_0x2cf6d4(0x2419),_0x2cf6d4(0x10ce)));}